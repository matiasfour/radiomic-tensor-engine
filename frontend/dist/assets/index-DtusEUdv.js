const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/blosc-CrUiACa7.js","assets/chunk-INHXZS53-D3tQiqtZ.js","assets/lz4-B_Exjfmr.js","assets/zstd-u5eweWyS.js"])))=>i.map(i=>d[i]);
var nx=i=>{throw TypeError(i)};var Vp=(i,e,t)=>e.has(i)||nx("Cannot "+t);var Ot=(i,e,t)=>(Vp(i,e,"read from private field"),t?t.call(i):e.get(i)),as=(i,e,t)=>e.has(i)?nx("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),Ji=(i,e,t,n)=>(Vp(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t),os=(i,e,t)=>(Vp(i,e,"access private method"),t);var sx=(i,e,t,n)=>({set _(s){Ji(i,e,s,t)},get _(){return Ot(i,e,n)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();function Rg(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var jp={exports:{}},ql={};var rx;function _E(){if(rx)return ql;rx=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,s,r){var a=null;if(r!==void 0&&(a=""+r),s.key!==void 0&&(a=""+s.key),"key"in s){r={};for(var l in s)l!=="key"&&(r[l]=s[l])}else r=s;return s=r.ref,{$$typeof:i,type:n,key:a,ref:s!==void 0?s:null,props:r}}return ql.Fragment=e,ql.jsx=t,ql.jsxs=t,ql}var ax;function FE(){return ax||(ax=1,jp.exports=_E()),jp.exports}var v=FE(),zp={exports:{}},He={};var ox;function PE(){if(ox)return He;ox=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),a=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.for("react.activity"),p=Symbol.iterator;function g(j){return j===null||typeof j!="object"?null:(j=p&&j[p]||j["@@iterator"],typeof j=="function"?j:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,b={};function w(j,W,K){this.props=j,this.context=W,this.refs=b,this.updater=K||y}w.prototype.isReactComponent={},w.prototype.setState=function(j,W){if(typeof j!="object"&&typeof j!="function"&&j!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,j,W,"setState")},w.prototype.forceUpdate=function(j){this.updater.enqueueForceUpdate(this,j,"forceUpdate")};function S(){}S.prototype=w.prototype;function C(j,W,K){this.props=j,this.context=W,this.refs=b,this.updater=K||y}var E=C.prototype=new S;E.constructor=C,x(E,w.prototype),E.isPureReactComponent=!0;var D=Array.isArray;function M(){}var N={H:null,A:null,T:null,S:null},I=Object.prototype.hasOwnProperty;function _(j,W,K){var ee=K.ref;return{$$typeof:i,type:j,key:W,ref:ee!==void 0?ee:null,props:K}}function F(j,W){return _(j.type,W,j.props)}function B(j){return typeof j=="object"&&j!==null&&j.$$typeof===i}function P(j){var W={"=":"=0",":":"=2"};return"$"+j.replace(/[=:]/g,function(K){return W[K]})}var O=/\/+/g;function k(j,W){return typeof j=="object"&&j!==null&&j.key!=null?P(""+j.key):W.toString(36)}function q(j){switch(j.status){case"fulfilled":return j.value;case"rejected":throw j.reason;default:switch(typeof j.status=="string"?j.then(M,M):(j.status="pending",j.then(function(W){j.status==="pending"&&(j.status="fulfilled",j.value=W)},function(W){j.status==="pending"&&(j.status="rejected",j.reason=W)})),j.status){case"fulfilled":return j.value;case"rejected":throw j.reason}}throw j}function U(j,W,K,ee,le){var he=typeof j;(he==="undefined"||he==="boolean")&&(j=null);var ce=!1;if(j===null)ce=!0;else switch(he){case"bigint":case"string":case"number":ce=!0;break;case"object":switch(j.$$typeof){case i:case e:ce=!0;break;case d:return ce=j._init,U(ce(j._payload),W,K,ee,le)}}if(ce)return le=le(j),ce=ee===""?"."+k(j,0):ee,D(le)?(K="",ce!=null&&(K=ce.replace(O,"$&/")+"/"),U(le,W,K,"",function(Me){return Me})):le!=null&&(B(le)&&(le=F(le,K+(le.key==null||j&&j.key===le.key?"":(""+le.key).replace(O,"$&/")+"/")+ce)),W.push(le)),1;ce=0;var xe=ee===""?".":ee+":";if(D(j))for(var ge=0;ge<j.length;ge++)ee=j[ge],he=xe+k(ee,ge),ce+=U(ee,W,K,he,le);else if(ge=g(j),typeof ge=="function")for(j=ge.call(j),ge=0;!(ee=j.next()).done;)ee=ee.value,he=xe+k(ee,ge++),ce+=U(ee,W,K,he,le);else if(he==="object"){if(typeof j.then=="function")return U(q(j),W,K,ee,le);throw W=String(j),Error("Objects are not valid as a React child (found: "+(W==="[object Object]"?"object with keys {"+Object.keys(j).join(", ")+"}":W)+"). If you meant to render a collection of children, use an array instead.")}return ce}function H(j,W,K){if(j==null)return j;var ee=[],le=0;return U(j,ee,"","",function(he){return W.call(K,he,le++)}),ee}function Y(j){if(j._status===-1){var W=j._result;W=W(),W.then(function(K){(j._status===0||j._status===-1)&&(j._status=1,j._result=K)},function(K){(j._status===0||j._status===-1)&&(j._status=2,j._result=K)}),j._status===-1&&(j._status=0,j._result=W)}if(j._status===1)return j._result.default;throw j._result}var Q=typeof reportError=="function"?reportError:function(j){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var W=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof j=="object"&&j!==null&&typeof j.message=="string"?String(j.message):String(j),error:j});if(!window.dispatchEvent(W))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",j);return}console.error(j)},te={map:H,forEach:function(j,W,K){H(j,function(){W.apply(this,arguments)},K)},count:function(j){var W=0;return H(j,function(){W++}),W},toArray:function(j){return H(j,function(W){return W})||[]},only:function(j){if(!B(j))throw Error("React.Children.only expected to receive a single React element child.");return j}};return He.Activity=f,He.Children=te,He.Component=w,He.Fragment=t,He.Profiler=s,He.PureComponent=C,He.StrictMode=n,He.Suspense=c,He.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=N,He.__COMPILER_RUNTIME={__proto__:null,c:function(j){return N.H.useMemoCache(j)}},He.cache=function(j){return function(){return j.apply(null,arguments)}},He.cacheSignal=function(){return null},He.cloneElement=function(j,W,K){if(j==null)throw Error("The argument must be a React element, but you passed "+j+".");var ee=x({},j.props),le=j.key;if(W!=null)for(he in W.key!==void 0&&(le=""+W.key),W)!I.call(W,he)||he==="key"||he==="__self"||he==="__source"||he==="ref"&&W.ref===void 0||(ee[he]=W[he]);var he=arguments.length-2;if(he===1)ee.children=K;else if(1<he){for(var ce=Array(he),xe=0;xe<he;xe++)ce[xe]=arguments[xe+2];ee.children=ce}return _(j.type,le,ee)},He.createContext=function(j){return j={$$typeof:a,_currentValue:j,_currentValue2:j,_threadCount:0,Provider:null,Consumer:null},j.Provider=j,j.Consumer={$$typeof:r,_context:j},j},He.createElement=function(j,W,K){var ee,le={},he=null;if(W!=null)for(ee in W.key!==void 0&&(he=""+W.key),W)I.call(W,ee)&&ee!=="key"&&ee!=="__self"&&ee!=="__source"&&(le[ee]=W[ee]);var ce=arguments.length-2;if(ce===1)le.children=K;else if(1<ce){for(var xe=Array(ce),ge=0;ge<ce;ge++)xe[ge]=arguments[ge+2];le.children=xe}if(j&&j.defaultProps)for(ee in ce=j.defaultProps,ce)le[ee]===void 0&&(le[ee]=ce[ee]);return _(j,he,le)},He.createRef=function(){return{current:null}},He.forwardRef=function(j){return{$$typeof:l,render:j}},He.isValidElement=B,He.lazy=function(j){return{$$typeof:d,_payload:{_status:-1,_result:j},_init:Y}},He.memo=function(j,W){return{$$typeof:h,type:j,compare:W===void 0?null:W}},He.startTransition=function(j){var W=N.T,K={};N.T=K;try{var ee=j(),le=N.S;le!==null&&le(K,ee),typeof ee=="object"&&ee!==null&&typeof ee.then=="function"&&ee.then(M,Q)}catch(he){Q(he)}finally{W!==null&&K.types!==null&&(W.types=K.types),N.T=W}},He.unstable_useCacheRefresh=function(){return N.H.useCacheRefresh()},He.use=function(j){return N.H.use(j)},He.useActionState=function(j,W,K){return N.H.useActionState(j,W,K)},He.useCallback=function(j,W){return N.H.useCallback(j,W)},He.useContext=function(j){return N.H.useContext(j)},He.useDebugValue=function(){},He.useDeferredValue=function(j,W){return N.H.useDeferredValue(j,W)},He.useEffect=function(j,W){return N.H.useEffect(j,W)},He.useEffectEvent=function(j){return N.H.useEffectEvent(j)},He.useId=function(){return N.H.useId()},He.useImperativeHandle=function(j,W,K){return N.H.useImperativeHandle(j,W,K)},He.useInsertionEffect=function(j,W){return N.H.useInsertionEffect(j,W)},He.useLayoutEffect=function(j,W){return N.H.useLayoutEffect(j,W)},He.useMemo=function(j,W){return N.H.useMemo(j,W)},He.useOptimistic=function(j,W){return N.H.useOptimistic(j,W)},He.useReducer=function(j,W,K){return N.H.useReducer(j,W,K)},He.useRef=function(j){return N.H.useRef(j)},He.useState=function(j){return N.H.useState(j)},He.useSyncExternalStore=function(j,W,K){return N.H.useSyncExternalStore(j,W,K)},He.useTransition=function(){return N.H.useTransition()},He.version="19.2.3",He}var lx;function Yd(){return lx||(lx=1,zp.exports=PE()),zp.exports}var V=Yd();const qd=Rg(V);var Gp={exports:{}},Xl={},Hp={exports:{}},Yp={};var cx;function BE(){return cx||(cx=1,(function(i){function e(U,H){var Y=U.length;U.push(H);e:for(;0<Y;){var Q=Y-1>>>1,te=U[Q];if(0<s(te,H))U[Q]=H,U[Y]=te,Y=Q;else break e}}function t(U){return U.length===0?null:U[0]}function n(U){if(U.length===0)return null;var H=U[0],Y=U.pop();if(Y!==H){U[0]=Y;e:for(var Q=0,te=U.length,j=te>>>1;Q<j;){var W=2*(Q+1)-1,K=U[W],ee=W+1,le=U[ee];if(0>s(K,Y))ee<te&&0>s(le,K)?(U[Q]=le,U[ee]=Y,Q=ee):(U[Q]=K,U[W]=Y,Q=W);else if(ee<te&&0>s(le,Y))U[Q]=le,U[ee]=Y,Q=ee;else break e}}return H}function s(U,H){var Y=U.sortIndex-H.sortIndex;return Y!==0?Y:U.id-H.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;i.unstable_now=function(){return r.now()}}else{var a=Date,l=a.now();i.unstable_now=function(){return a.now()-l}}var c=[],h=[],d=1,f=null,p=3,g=!1,y=!1,x=!1,b=!1,w=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;function E(U){for(var H=t(h);H!==null;){if(H.callback===null)n(h);else if(H.startTime<=U)n(h),H.sortIndex=H.expirationTime,e(c,H);else break;H=t(h)}}function D(U){if(x=!1,E(U),!y)if(t(c)!==null)y=!0,M||(M=!0,P());else{var H=t(h);H!==null&&q(D,H.startTime-U)}}var M=!1,N=-1,I=5,_=-1;function F(){return b?!0:!(i.unstable_now()-_<I)}function B(){if(b=!1,M){var U=i.unstable_now();_=U;var H=!0;try{e:{y=!1,x&&(x=!1,S(N),N=-1),g=!0;var Y=p;try{t:{for(E(U),f=t(c);f!==null&&!(f.expirationTime>U&&F());){var Q=f.callback;if(typeof Q=="function"){f.callback=null,p=f.priorityLevel;var te=Q(f.expirationTime<=U);if(U=i.unstable_now(),typeof te=="function"){f.callback=te,E(U),H=!0;break t}f===t(c)&&n(c),E(U)}else n(c);f=t(c)}if(f!==null)H=!0;else{var j=t(h);j!==null&&q(D,j.startTime-U),H=!1}}break e}finally{f=null,p=Y,g=!1}H=void 0}}finally{H?P():M=!1}}}var P;if(typeof C=="function")P=function(){C(B)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,k=O.port2;O.port1.onmessage=B,P=function(){k.postMessage(null)}}else P=function(){w(B,0)};function q(U,H){N=w(function(){U(i.unstable_now())},H)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(U){U.callback=null},i.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<U?Math.floor(1e3/U):5},i.unstable_getCurrentPriorityLevel=function(){return p},i.unstable_next=function(U){switch(p){case 1:case 2:case 3:var H=3;break;default:H=p}var Y=p;p=H;try{return U()}finally{p=Y}},i.unstable_requestPaint=function(){b=!0},i.unstable_runWithPriority=function(U,H){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var Y=p;p=U;try{return H()}finally{p=Y}},i.unstable_scheduleCallback=function(U,H,Y){var Q=i.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?Q+Y:Q):Y=Q,U){case 1:var te=-1;break;case 2:te=250;break;case 5:te=1073741823;break;case 4:te=1e4;break;default:te=5e3}return te=Y+te,U={id:d++,callback:H,priorityLevel:U,startTime:Y,expirationTime:te,sortIndex:-1},Y>Q?(U.sortIndex=Y,e(h,U),t(c)===null&&U===t(h)&&(x?(S(N),N=-1):x=!0,q(D,Y-Q))):(U.sortIndex=te,e(c,U),y||g||(y=!0,M||(M=!0,P()))),U},i.unstable_shouldYield=F,i.unstable_wrapCallback=function(U){var H=p;return function(){var Y=p;p=H;try{return U.apply(this,arguments)}finally{p=Y}}}})(Yp)),Yp}var ux;function LE(){return ux||(ux=1,Hp.exports=BE()),Hp.exports}var qp={exports:{}},Bi={};var hx;function kE(){if(hx)return Bi;hx=1;var i=Yd();function e(c){var h="https://react.dev/errors/"+c;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)h+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+c+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function r(c,h,d){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:f==null?null:""+f,children:c,containerInfo:h,implementation:d}}var a=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(c,h){if(c==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Bi.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Bi.createPortal=function(c,h){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return r(c,h,null,d)},Bi.flushSync=function(c){var h=a.T,d=n.p;try{if(a.T=null,n.p=2,c)return c()}finally{a.T=h,n.p=d,n.d.f()}},Bi.preconnect=function(c,h){typeof c=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,n.d.C(c,h))},Bi.prefetchDNS=function(c){typeof c=="string"&&n.d.D(c)},Bi.preinit=function(c,h){if(typeof c=="string"&&h&&typeof h.as=="string"){var d=h.as,f=l(d,h.crossOrigin),p=typeof h.integrity=="string"?h.integrity:void 0,g=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;d==="style"?n.d.S(c,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:f,integrity:p,fetchPriority:g}):d==="script"&&n.d.X(c,{crossOrigin:f,integrity:p,fetchPriority:g,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Bi.preinitModule=function(c,h){if(typeof c=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var d=l(h.as,h.crossOrigin);n.d.M(c,{crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&n.d.M(c)},Bi.preload=function(c,h){if(typeof c=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var d=h.as,f=l(d,h.crossOrigin);n.d.L(c,d,{crossOrigin:f,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Bi.preloadModule=function(c,h){if(typeof c=="string")if(h){var d=l(h.as,h.crossOrigin);n.d.m(c,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else n.d.m(c)},Bi.requestFormReset=function(c){n.d.r(c)},Bi.unstable_batchedUpdates=function(c,h){return c(h)},Bi.useFormState=function(c,h,d){return a.H.useFormState(c,h,d)},Bi.useFormStatus=function(){return a.H.useHostTransitionStatus()},Bi.version="19.2.3",Bi}var dx;function OE(){if(dx)return qp.exports;dx=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),qp.exports=kE(),qp.exports}var fx;function UE(){if(fx)return Xl;fx=1;var i=LE(),e=Yd(),t=OE();function n(o){var u="https://react.dev/errors/"+o;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)u+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+o+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function r(o){var u=o,m=o;if(o.alternate)for(;u.return;)u=u.return;else{o=u;do u=o,(u.flags&4098)!==0&&(m=u.return),o=u.return;while(o)}return u.tag===3?m:null}function a(o){if(o.tag===13){var u=o.memoizedState;if(u===null&&(o=o.alternate,o!==null&&(u=o.memoizedState)),u!==null)return u.dehydrated}return null}function l(o){if(o.tag===31){var u=o.memoizedState;if(u===null&&(o=o.alternate,o!==null&&(u=o.memoizedState)),u!==null)return u.dehydrated}return null}function c(o){if(r(o)!==o)throw Error(n(188))}function h(o){var u=o.alternate;if(!u){if(u=r(o),u===null)throw Error(n(188));return u!==o?null:o}for(var m=o,A=u;;){var T=m.return;if(T===null)break;var R=T.alternate;if(R===null){if(A=T.return,A!==null){m=A;continue}break}if(T.child===R.child){for(R=T.child;R;){if(R===m)return c(T),o;if(R===A)return c(T),u;R=R.sibling}throw Error(n(188))}if(m.return!==A.return)m=T,A=R;else{for(var L=!1,z=T.child;z;){if(z===m){L=!0,m=T,A=R;break}if(z===A){L=!0,A=T,m=R;break}z=z.sibling}if(!L){for(z=R.child;z;){if(z===m){L=!0,m=R,A=T;break}if(z===A){L=!0,A=R,m=T;break}z=z.sibling}if(!L)throw Error(n(189))}}if(m.alternate!==A)throw Error(n(190))}if(m.tag!==3)throw Error(n(188));return m.stateNode.current===m?o:u}function d(o){var u=o.tag;if(u===5||u===26||u===27||u===6)return o;for(o=o.child;o!==null;){if(u=d(o),u!==null)return u;o=o.sibling}return null}var f=Object.assign,p=Symbol.for("react.element"),g=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),S=Symbol.for("react.consumer"),C=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),D=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),_=Symbol.for("react.activity"),F=Symbol.for("react.memo_cache_sentinel"),B=Symbol.iterator;function P(o){return o===null||typeof o!="object"?null:(o=B&&o[B]||o["@@iterator"],typeof o=="function"?o:null)}var O=Symbol.for("react.client.reference");function k(o){if(o==null)return null;if(typeof o=="function")return o.$$typeof===O?null:o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case x:return"Fragment";case w:return"Profiler";case b:return"StrictMode";case D:return"Suspense";case M:return"SuspenseList";case _:return"Activity"}if(typeof o=="object")switch(o.$$typeof){case y:return"Portal";case C:return o.displayName||"Context";case S:return(o._context.displayName||"Context")+".Consumer";case E:var u=o.render;return o=o.displayName,o||(o=u.displayName||u.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case N:return u=o.displayName||null,u!==null?u:k(o.type)||"Memo";case I:u=o._payload,o=o._init;try{return k(o(u))}catch{}}return null}var q=Array.isArray,U=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,H=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y={pending:!1,data:null,method:null,action:null},Q=[],te=-1;function j(o){return{current:o}}function W(o){0>te||(o.current=Q[te],Q[te]=null,te--)}function K(o,u){te++,Q[te]=o.current,o.current=u}var ee=j(null),le=j(null),he=j(null),ce=j(null);function xe(o,u){switch(K(he,u),K(le,o),K(ee,null),u.nodeType){case 9:case 11:o=(o=u.documentElement)&&(o=o.namespaceURI)?Ty(o):0;break;default:if(o=u.tagName,u=u.namespaceURI)u=Ty(u),o=My(u,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}W(ee),K(ee,o)}function ge(){W(ee),W(le),W(he)}function Me(o){o.memoizedState!==null&&K(ce,o);var u=ee.current,m=My(u,o.type);u!==m&&(K(le,o),K(ee,m))}function Ie(o){le.current===o&&(W(ee),W(le)),ce.current===o&&(W(ce),zl._currentValue=Y)}var $e,We;function Pe(o){if($e===void 0)try{throw Error()}catch(m){var u=m.stack.trim().match(/\n( *(at )?)/);$e=u&&u[1]||"",We=-1<m.stack.indexOf(`
    at`)?" (<anonymous>)":-1<m.stack.indexOf("@")?"@unknown:0:0":""}return`
`+$e+o+We}var ht=!1;function Qe(o,u){if(!o||ht)return"";ht=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var A={DetermineComponentFrameRoot:function(){try{if(u){var fe=function(){throw Error()};if(Object.defineProperty(fe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(fe,[])}catch(oe){var ae=oe}Reflect.construct(o,[],fe)}else{try{fe.call()}catch(oe){ae=oe}o.call(fe.prototype)}}else{try{throw Error()}catch(oe){ae=oe}(fe=o())&&typeof fe.catch=="function"&&fe.catch(function(){})}}catch(oe){if(oe&&ae&&typeof oe.stack=="string")return[oe.stack,ae.stack]}return[null,null]}};A.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var T=Object.getOwnPropertyDescriptor(A.DetermineComponentFrameRoot,"name");T&&T.configurable&&Object.defineProperty(A.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var R=A.DetermineComponentFrameRoot(),L=R[0],z=R[1];if(L&&z){var Z=L.split(`
`),re=z.split(`
`);for(T=A=0;A<Z.length&&!Z[A].includes("DetermineComponentFrameRoot");)A++;for(;T<re.length&&!re[T].includes("DetermineComponentFrameRoot");)T++;if(A===Z.length||T===re.length)for(A=Z.length-1,T=re.length-1;1<=A&&0<=T&&Z[A]!==re[T];)T--;for(;1<=A&&0<=T;A--,T--)if(Z[A]!==re[T]){if(A!==1||T!==1)do if(A--,T--,0>T||Z[A]!==re[T]){var ue=`
`+Z[A].replace(" at new "," at ");return o.displayName&&ue.includes("<anonymous>")&&(ue=ue.replace("<anonymous>",o.displayName)),ue}while(1<=A&&0<=T);break}}}finally{ht=!1,Error.prepareStackTrace=m}return(m=o?o.displayName||o.name:"")?Pe(m):""}function ft(o,u){switch(o.tag){case 26:case 27:case 5:return Pe(o.type);case 16:return Pe("Lazy");case 13:return o.child!==u&&u!==null?Pe("Suspense Fallback"):Pe("Suspense");case 19:return Pe("SuspenseList");case 0:case 15:return Qe(o.type,!1);case 11:return Qe(o.type.render,!1);case 1:return Qe(o.type,!0);case 31:return Pe("Activity");default:return""}}function gs(o){try{var u="",m=null;do u+=ft(o,m),m=o,o=o.return;while(o);return u}catch(A){return`
Error generating stack: `+A.message+`
`+A.stack}}var Gn=Object.prototype.hasOwnProperty,wn=i.unstable_scheduleCallback,bi=i.unstable_cancelCallback,Sn=i.unstable_shouldYield,el=i.unstable_requestPaint,wi=i.unstable_now,tl=i.unstable_getCurrentPriorityLevel,As=i.unstable_ImmediatePriority,er=i.unstable_UserBlockingPriority,ne=i.unstable_NormalPriority,ye=i.unstable_LowPriority,me=i.unstable_IdlePriority,Be=i.log,st=i.unstable_setDisableYieldValue,Le=null,ke=null;function Ne(o){if(typeof Be=="function"&&st(o),ke&&typeof ke.setStrictMode=="function")try{ke.setStrictMode(Le,o)}catch{}}var dt=Math.clz32?Math.clz32:ti,je=Math.log,Ge=Math.LN2;function ti(o){return o>>>=0,o===0?32:31-(je(o)/Ge|0)|0}var mt=256,_t=262144,hi=4194304;function Hn(o){var u=o&42;if(u!==0)return u;switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return o&261888;case 262144:case 524288:case 1048576:case 2097152:return o&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return o&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return o}}function tr(o,u,m){var A=o.pendingLanes;if(A===0)return 0;var T=0,R=o.suspendedLanes,L=o.pingedLanes;o=o.warmLanes;var z=A&134217727;return z!==0?(A=z&~R,A!==0?T=Hn(A):(L&=z,L!==0?T=Hn(L):m||(m=z&~o,m!==0&&(T=Hn(m))))):(z=A&~R,z!==0?T=Hn(z):L!==0?T=Hn(L):m||(m=A&~o,m!==0&&(T=Hn(m)))),T===0?0:u!==0&&u!==T&&(u&R)===0&&(R=T&-T,m=u&-u,R>=m||R===32&&(m&4194048)!==0)?u:T}function vs(o,u){return(o.pendingLanes&~(o.suspendedLanes&~o.pingedLanes)&u)===0}function yS(o,u){switch(o){case 1:case 2:case 4:case 8:case 64:return u+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function o2(){var o=hi;return hi<<=1,(hi&62914560)===0&&(hi=4194304),o}function Df(o){for(var u=[],m=0;31>m;m++)u.push(o);return u}function il(o,u){o.pendingLanes|=u,u!==268435456&&(o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0)}function xS(o,u,m,A,T,R){var L=o.pendingLanes;o.pendingLanes=m,o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0,o.expiredLanes&=m,o.entangledLanes&=m,o.errorRecoveryDisabledLanes&=m,o.shellSuspendCounter=0;var z=o.entanglements,Z=o.expirationTimes,re=o.hiddenUpdates;for(m=L&~m;0<m;){var ue=31-dt(m),fe=1<<ue;z[ue]=0,Z[ue]=-1;var ae=re[ue];if(ae!==null)for(re[ue]=null,ue=0;ue<ae.length;ue++){var oe=ae[ue];oe!==null&&(oe.lane&=-536870913)}m&=~fe}A!==0&&l2(o,A,0),R!==0&&T===0&&o.tag!==0&&(o.suspendedLanes|=R&~(L&~u))}function l2(o,u,m){o.pendingLanes|=u,o.suspendedLanes&=~u;var A=31-dt(u);o.entangledLanes|=u,o.entanglements[A]=o.entanglements[A]|1073741824|m&261930}function c2(o,u){var m=o.entangledLanes|=u;for(o=o.entanglements;m;){var A=31-dt(m),T=1<<A;T&u|o[A]&u&&(o[A]|=u),m&=~T}}function u2(o,u){var m=u&-u;return m=(m&42)!==0?1:Rf(m),(m&(o.suspendedLanes|u))!==0?0:m}function Rf(o){switch(o){case 2:o=1;break;case 8:o=4;break;case 32:o=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:o=128;break;case 268435456:o=134217728;break;default:o=0}return o}function Nf(o){return o&=-o,2<o?8<o?(o&134217727)!==0?32:268435456:8:2}function h2(){var o=H.p;return o!==0?o:(o=window.event,o===void 0?32:Qy(o.type))}function d2(o,u){var m=H.p;try{return H.p=o,u()}finally{H.p=m}}var ir=Math.random().toString(36).slice(2),Si="__reactFiber$"+ir,Yi="__reactProps$"+ir,Na="__reactContainer$"+ir,If="__reactEvents$"+ir,bS="__reactListeners$"+ir,wS="__reactHandles$"+ir,f2="__reactResources$"+ir,nl="__reactMarker$"+ir;function _f(o){delete o[Si],delete o[Yi],delete o[If],delete o[bS],delete o[wS]}function Ia(o){var u=o[Si];if(u)return u;for(var m=o.parentNode;m;){if(u=m[Na]||m[Si]){if(m=u.alternate,u.child!==null||m!==null&&m.child!==null)for(o=Py(o);o!==null;){if(m=o[Si])return m;o=Py(o)}return u}o=m,m=o.parentNode}return null}function _a(o){if(o=o[Si]||o[Na]){var u=o.tag;if(u===5||u===6||u===13||u===31||u===26||u===27||u===3)return o}return null}function sl(o){var u=o.tag;if(u===5||u===26||u===27||u===6)return o.stateNode;throw Error(n(33))}function Fa(o){var u=o[f2];return u||(u=o[f2]={hoistableStyles:new Map,hoistableScripts:new Map}),u}function di(o){o[nl]=!0}var m2=new Set,p2={};function Vr(o,u){Pa(o,u),Pa(o+"Capture",u)}function Pa(o,u){for(p2[o]=u,o=0;o<u.length;o++)m2.add(u[o])}var SS=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),g2={},A2={};function CS(o){return Gn.call(A2,o)?!0:Gn.call(g2,o)?!1:SS.test(o)?A2[o]=!0:(g2[o]=!0,!1)}function gu(o,u,m){if(CS(u))if(m===null)o.removeAttribute(u);else{switch(typeof m){case"undefined":case"function":case"symbol":o.removeAttribute(u);return;case"boolean":var A=u.toLowerCase().slice(0,5);if(A!=="data-"&&A!=="aria-"){o.removeAttribute(u);return}}o.setAttribute(u,""+m)}}function Au(o,u,m){if(m===null)o.removeAttribute(u);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(u);return}o.setAttribute(u,""+m)}}function ys(o,u,m,A){if(A===null)o.removeAttribute(m);else{switch(typeof A){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(m);return}o.setAttributeNS(u,m,""+A)}}function Cn(o){switch(typeof o){case"bigint":case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function v2(o){var u=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(u==="checkbox"||u==="radio")}function ES(o,u,m){var A=Object.getOwnPropertyDescriptor(o.constructor.prototype,u);if(!o.hasOwnProperty(u)&&typeof A<"u"&&typeof A.get=="function"&&typeof A.set=="function"){var T=A.get,R=A.set;return Object.defineProperty(o,u,{configurable:!0,get:function(){return T.call(this)},set:function(L){m=""+L,R.call(this,L)}}),Object.defineProperty(o,u,{enumerable:A.enumerable}),{getValue:function(){return m},setValue:function(L){m=""+L},stopTracking:function(){o._valueTracker=null,delete o[u]}}}}function Ff(o){if(!o._valueTracker){var u=v2(o)?"checked":"value";o._valueTracker=ES(o,u,""+o[u])}}function y2(o){if(!o)return!1;var u=o._valueTracker;if(!u)return!0;var m=u.getValue(),A="";return o&&(A=v2(o)?o.checked?"true":"false":o.value),o=A,o!==m?(u.setValue(o),!0):!1}function vu(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}var TS=/[\n"\\]/g;function En(o){return o.replace(TS,function(u){return"\\"+u.charCodeAt(0).toString(16)+" "})}function Pf(o,u,m,A,T,R,L,z){o.name="",L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"?o.type=L:o.removeAttribute("type"),u!=null?L==="number"?(u===0&&o.value===""||o.value!=u)&&(o.value=""+Cn(u)):o.value!==""+Cn(u)&&(o.value=""+Cn(u)):L!=="submit"&&L!=="reset"||o.removeAttribute("value"),u!=null?Bf(o,L,Cn(u)):m!=null?Bf(o,L,Cn(m)):A!=null&&o.removeAttribute("value"),T==null&&R!=null&&(o.defaultChecked=!!R),T!=null&&(o.checked=T&&typeof T!="function"&&typeof T!="symbol"),z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"?o.name=""+Cn(z):o.removeAttribute("name")}function x2(o,u,m,A,T,R,L,z){if(R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(o.type=R),u!=null||m!=null){if(!(R!=="submit"&&R!=="reset"||u!=null)){Ff(o);return}m=m!=null?""+Cn(m):"",u=u!=null?""+Cn(u):m,z||u===o.value||(o.value=u),o.defaultValue=u}A=A??T,A=typeof A!="function"&&typeof A!="symbol"&&!!A,o.checked=z?o.checked:!!A,o.defaultChecked=!!A,L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"&&(o.name=L),Ff(o)}function Bf(o,u,m){u==="number"&&vu(o.ownerDocument)===o||o.defaultValue===""+m||(o.defaultValue=""+m)}function Ba(o,u,m,A){if(o=o.options,u){u={};for(var T=0;T<m.length;T++)u["$"+m[T]]=!0;for(m=0;m<o.length;m++)T=u.hasOwnProperty("$"+o[m].value),o[m].selected!==T&&(o[m].selected=T),T&&A&&(o[m].defaultSelected=!0)}else{for(m=""+Cn(m),u=null,T=0;T<o.length;T++){if(o[T].value===m){o[T].selected=!0,A&&(o[T].defaultSelected=!0);return}u!==null||o[T].disabled||(u=o[T])}u!==null&&(u.selected=!0)}}function b2(o,u,m){if(u!=null&&(u=""+Cn(u),u!==o.value&&(o.value=u),m==null)){o.defaultValue!==u&&(o.defaultValue=u);return}o.defaultValue=m!=null?""+Cn(m):""}function w2(o,u,m,A){if(u==null){if(A!=null){if(m!=null)throw Error(n(92));if(q(A)){if(1<A.length)throw Error(n(93));A=A[0]}m=A}m==null&&(m=""),u=m}m=Cn(u),o.defaultValue=m,A=o.textContent,A===m&&A!==""&&A!==null&&(o.value=A),Ff(o)}function La(o,u){if(u){var m=o.firstChild;if(m&&m===o.lastChild&&m.nodeType===3){m.nodeValue=u;return}}o.textContent=u}var MS=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function S2(o,u,m){var A=u.indexOf("--")===0;m==null||typeof m=="boolean"||m===""?A?o.setProperty(u,""):u==="float"?o.cssFloat="":o[u]="":A?o.setProperty(u,m):typeof m!="number"||m===0||MS.has(u)?u==="float"?o.cssFloat=m:o[u]=(""+m).trim():o[u]=m+"px"}function C2(o,u,m){if(u!=null&&typeof u!="object")throw Error(n(62));if(o=o.style,m!=null){for(var A in m)!m.hasOwnProperty(A)||u!=null&&u.hasOwnProperty(A)||(A.indexOf("--")===0?o.setProperty(A,""):A==="float"?o.cssFloat="":o[A]="");for(var T in u)A=u[T],u.hasOwnProperty(T)&&m[T]!==A&&S2(o,T,A)}else for(var R in u)u.hasOwnProperty(R)&&S2(o,R,u[R])}function Lf(o){if(o.indexOf("-")===-1)return!1;switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var DS=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),RS=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function yu(o){return RS.test(""+o)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":o}function xs(){}var kf=null;function Of(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var ka=null,Oa=null;function E2(o){var u=_a(o);if(u&&(o=u.stateNode)){var m=o[Yi]||null;e:switch(o=u.stateNode,u.type){case"input":if(Pf(o,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name),u=m.name,m.type==="radio"&&u!=null){for(m=o;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll('input[name="'+En(""+u)+'"][type="radio"]'),u=0;u<m.length;u++){var A=m[u];if(A!==o&&A.form===o.form){var T=A[Yi]||null;if(!T)throw Error(n(90));Pf(A,T.value,T.defaultValue,T.defaultValue,T.checked,T.defaultChecked,T.type,T.name)}}for(u=0;u<m.length;u++)A=m[u],A.form===o.form&&y2(A)}break e;case"textarea":b2(o,m.value,m.defaultValue);break e;case"select":u=m.value,u!=null&&Ba(o,!!m.multiple,u,!1)}}}var Uf=!1;function T2(o,u,m){if(Uf)return o(u,m);Uf=!0;try{var A=o(u);return A}finally{if(Uf=!1,(ka!==null||Oa!==null)&&(ah(),ka&&(u=ka,o=Oa,Oa=ka=null,E2(u),o)))for(u=0;u<o.length;u++)E2(o[u])}}function rl(o,u){var m=o.stateNode;if(m===null)return null;var A=m[Yi]||null;if(A===null)return null;m=A[u];e:switch(u){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(A=!A.disabled)||(o=o.type,A=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!A;break e;default:o=!1}if(o)return null;if(m&&typeof m!="function")throw Error(n(231,u,typeof m));return m}var bs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Vf=!1;if(bs)try{var al={};Object.defineProperty(al,"passive",{get:function(){Vf=!0}}),window.addEventListener("test",al,al),window.removeEventListener("test",al,al)}catch{Vf=!1}var nr=null,jf=null,xu=null;function M2(){if(xu)return xu;var o,u=jf,m=u.length,A,T="value"in nr?nr.value:nr.textContent,R=T.length;for(o=0;o<m&&u[o]===T[o];o++);var L=m-o;for(A=1;A<=L&&u[m-A]===T[R-A];A++);return xu=T.slice(o,1<A?1-A:void 0)}function bu(o){var u=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&u===13&&(o=13)):o=u,o===10&&(o=13),32<=o||o===13?o:0}function wu(){return!0}function D2(){return!1}function qi(o){function u(m,A,T,R,L){this._reactName=m,this._targetInst=T,this.type=A,this.nativeEvent=R,this.target=L,this.currentTarget=null;for(var z in o)o.hasOwnProperty(z)&&(m=o[z],this[z]=m?m(R):R[z]);return this.isDefaultPrevented=(R.defaultPrevented!=null?R.defaultPrevented:R.returnValue===!1)?wu:D2,this.isPropagationStopped=D2,this}return f(u.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=wu)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=wu)},persist:function(){},isPersistent:wu}),u}var jr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Su=qi(jr),ol=f({},jr,{view:0,detail:0}),NS=qi(ol),zf,Gf,ll,Cu=f({},ol,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yf,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==ll&&(ll&&o.type==="mousemove"?(zf=o.screenX-ll.screenX,Gf=o.screenY-ll.screenY):Gf=zf=0,ll=o),zf)},movementY:function(o){return"movementY"in o?o.movementY:Gf}}),R2=qi(Cu),IS=f({},Cu,{dataTransfer:0}),_S=qi(IS),FS=f({},ol,{relatedTarget:0}),Hf=qi(FS),PS=f({},jr,{animationName:0,elapsedTime:0,pseudoElement:0}),BS=qi(PS),LS=f({},jr,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),kS=qi(LS),OS=f({},jr,{data:0}),N2=qi(OS),US={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},VS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zS(o){var u=this.nativeEvent;return u.getModifierState?u.getModifierState(o):(o=jS[o])?!!u[o]:!1}function Yf(){return zS}var GS=f({},ol,{key:function(o){if(o.key){var u=US[o.key]||o.key;if(u!=="Unidentified")return u}return o.type==="keypress"?(o=bu(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?VS[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yf,charCode:function(o){return o.type==="keypress"?bu(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?bu(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),HS=qi(GS),YS=f({},Cu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),I2=qi(YS),qS=f({},ol,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yf}),XS=qi(qS),WS=f({},jr,{propertyName:0,elapsedTime:0,pseudoElement:0}),KS=qi(WS),QS=f({},Cu,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),ZS=qi(QS),JS=f({},jr,{newState:0,oldState:0}),$S=qi(JS),eC=[9,13,27,32],qf=bs&&"CompositionEvent"in window,cl=null;bs&&"documentMode"in document&&(cl=document.documentMode);var tC=bs&&"TextEvent"in window&&!cl,_2=bs&&(!qf||cl&&8<cl&&11>=cl),F2=" ",P2=!1;function B2(o,u){switch(o){case"keyup":return eC.indexOf(u.keyCode)!==-1;case"keydown":return u.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function L2(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Ua=!1;function iC(o,u){switch(o){case"compositionend":return L2(u);case"keypress":return u.which!==32?null:(P2=!0,F2);case"textInput":return o=u.data,o===F2&&P2?null:o;default:return null}}function nC(o,u){if(Ua)return o==="compositionend"||!qf&&B2(o,u)?(o=M2(),xu=jf=nr=null,Ua=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(u.ctrlKey||u.altKey||u.metaKey)||u.ctrlKey&&u.altKey){if(u.char&&1<u.char.length)return u.char;if(u.which)return String.fromCharCode(u.which)}return null;case"compositionend":return _2&&u.locale!=="ko"?null:u.data;default:return null}}var sC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function k2(o){var u=o&&o.nodeName&&o.nodeName.toLowerCase();return u==="input"?!!sC[o.type]:u==="textarea"}function O2(o,u,m,A){ka?Oa?Oa.push(A):Oa=[A]:ka=A,u=fh(u,"onChange"),0<u.length&&(m=new Su("onChange","change",null,m,A),o.push({event:m,listeners:u}))}var ul=null,hl=null;function rC(o){xy(o,0)}function Eu(o){var u=sl(o);if(y2(u))return o}function U2(o,u){if(o==="change")return u}var V2=!1;if(bs){var Xf;if(bs){var Wf="oninput"in document;if(!Wf){var j2=document.createElement("div");j2.setAttribute("oninput","return;"),Wf=typeof j2.oninput=="function"}Xf=Wf}else Xf=!1;V2=Xf&&(!document.documentMode||9<document.documentMode)}function z2(){ul&&(ul.detachEvent("onpropertychange",G2),hl=ul=null)}function G2(o){if(o.propertyName==="value"&&Eu(hl)){var u=[];O2(u,hl,o,Of(o)),T2(rC,u)}}function aC(o,u,m){o==="focusin"?(z2(),ul=u,hl=m,ul.attachEvent("onpropertychange",G2)):o==="focusout"&&z2()}function oC(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return Eu(hl)}function lC(o,u){if(o==="click")return Eu(u)}function cC(o,u){if(o==="input"||o==="change")return Eu(u)}function uC(o,u){return o===u&&(o!==0||1/o===1/u)||o!==o&&u!==u}var an=typeof Object.is=="function"?Object.is:uC;function dl(o,u){if(an(o,u))return!0;if(typeof o!="object"||o===null||typeof u!="object"||u===null)return!1;var m=Object.keys(o),A=Object.keys(u);if(m.length!==A.length)return!1;for(A=0;A<m.length;A++){var T=m[A];if(!Gn.call(u,T)||!an(o[T],u[T]))return!1}return!0}function H2(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function Y2(o,u){var m=H2(o);o=0;for(var A;m;){if(m.nodeType===3){if(A=o+m.textContent.length,o<=u&&A>=u)return{node:m,offset:u-o};o=A}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=H2(m)}}function q2(o,u){return o&&u?o===u?!0:o&&o.nodeType===3?!1:u&&u.nodeType===3?q2(o,u.parentNode):"contains"in o?o.contains(u):o.compareDocumentPosition?!!(o.compareDocumentPosition(u)&16):!1:!1}function X2(o){o=o!=null&&o.ownerDocument!=null&&o.ownerDocument.defaultView!=null?o.ownerDocument.defaultView:window;for(var u=vu(o.document);u instanceof o.HTMLIFrameElement;){try{var m=typeof u.contentWindow.location.href=="string"}catch{m=!1}if(m)o=u.contentWindow;else break;u=vu(o.document)}return u}function Kf(o){var u=o&&o.nodeName&&o.nodeName.toLowerCase();return u&&(u==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||u==="textarea"||o.contentEditable==="true")}var hC=bs&&"documentMode"in document&&11>=document.documentMode,Va=null,Qf=null,fl=null,Zf=!1;function W2(o,u,m){var A=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;Zf||Va==null||Va!==vu(A)||(A=Va,"selectionStart"in A&&Kf(A)?A={start:A.selectionStart,end:A.selectionEnd}:(A=(A.ownerDocument&&A.ownerDocument.defaultView||window).getSelection(),A={anchorNode:A.anchorNode,anchorOffset:A.anchorOffset,focusNode:A.focusNode,focusOffset:A.focusOffset}),fl&&dl(fl,A)||(fl=A,A=fh(Qf,"onSelect"),0<A.length&&(u=new Su("onSelect","select",null,u,m),o.push({event:u,listeners:A}),u.target=Va)))}function zr(o,u){var m={};return m[o.toLowerCase()]=u.toLowerCase(),m["Webkit"+o]="webkit"+u,m["Moz"+o]="moz"+u,m}var ja={animationend:zr("Animation","AnimationEnd"),animationiteration:zr("Animation","AnimationIteration"),animationstart:zr("Animation","AnimationStart"),transitionrun:zr("Transition","TransitionRun"),transitionstart:zr("Transition","TransitionStart"),transitioncancel:zr("Transition","TransitionCancel"),transitionend:zr("Transition","TransitionEnd")},Jf={},K2={};bs&&(K2=document.createElement("div").style,"AnimationEvent"in window||(delete ja.animationend.animation,delete ja.animationiteration.animation,delete ja.animationstart.animation),"TransitionEvent"in window||delete ja.transitionend.transition);function Gr(o){if(Jf[o])return Jf[o];if(!ja[o])return o;var u=ja[o],m;for(m in u)if(u.hasOwnProperty(m)&&m in K2)return Jf[o]=u[m];return o}var Q2=Gr("animationend"),Z2=Gr("animationiteration"),J2=Gr("animationstart"),dC=Gr("transitionrun"),fC=Gr("transitionstart"),mC=Gr("transitioncancel"),$2=Gr("transitionend"),eA=new Map,$f="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");$f.push("scrollEnd");function Yn(o,u){eA.set(o,u),Vr(u,[o])}var Tu=typeof reportError=="function"?reportError:function(o){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var u=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof o=="object"&&o!==null&&typeof o.message=="string"?String(o.message):String(o),error:o});if(!window.dispatchEvent(u))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",o);return}console.error(o)},Tn=[],za=0,em=0;function Mu(){for(var o=za,u=em=za=0;u<o;){var m=Tn[u];Tn[u++]=null;var A=Tn[u];Tn[u++]=null;var T=Tn[u];Tn[u++]=null;var R=Tn[u];if(Tn[u++]=null,A!==null&&T!==null){var L=A.pending;L===null?T.next=T:(T.next=L.next,L.next=T),A.pending=T}R!==0&&tA(m,T,R)}}function Du(o,u,m,A){Tn[za++]=o,Tn[za++]=u,Tn[za++]=m,Tn[za++]=A,em|=A,o.lanes|=A,o=o.alternate,o!==null&&(o.lanes|=A)}function tm(o,u,m,A){return Du(o,u,m,A),Ru(o)}function Hr(o,u){return Du(o,null,null,u),Ru(o)}function tA(o,u,m){o.lanes|=m;var A=o.alternate;A!==null&&(A.lanes|=m);for(var T=!1,R=o.return;R!==null;)R.childLanes|=m,A=R.alternate,A!==null&&(A.childLanes|=m),R.tag===22&&(o=R.stateNode,o===null||o._visibility&1||(T=!0)),o=R,R=R.return;return o.tag===3?(R=o.stateNode,T&&u!==null&&(T=31-dt(m),o=R.hiddenUpdates,A=o[T],A===null?o[T]=[u]:A.push(u),u.lane=m|536870912),R):null}function Ru(o){if(50<Bl)throw Bl=0,up=null,Error(n(185));for(var u=o.return;u!==null;)o=u,u=o.return;return o.tag===3?o.stateNode:null}var Ga={};function pC(o,u,m,A){this.tag=o,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=u,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=A,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function on(o,u,m,A){return new pC(o,u,m,A)}function im(o){return o=o.prototype,!(!o||!o.isReactComponent)}function ws(o,u){var m=o.alternate;return m===null?(m=on(o.tag,u,o.key,o.mode),m.elementType=o.elementType,m.type=o.type,m.stateNode=o.stateNode,m.alternate=o,o.alternate=m):(m.pendingProps=u,m.type=o.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=o.flags&65011712,m.childLanes=o.childLanes,m.lanes=o.lanes,m.child=o.child,m.memoizedProps=o.memoizedProps,m.memoizedState=o.memoizedState,m.updateQueue=o.updateQueue,u=o.dependencies,m.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext},m.sibling=o.sibling,m.index=o.index,m.ref=o.ref,m.refCleanup=o.refCleanup,m}function iA(o,u){o.flags&=65011714;var m=o.alternate;return m===null?(o.childLanes=0,o.lanes=u,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=m.childLanes,o.lanes=m.lanes,o.child=m.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=m.memoizedProps,o.memoizedState=m.memoizedState,o.updateQueue=m.updateQueue,o.type=m.type,u=m.dependencies,o.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext}),o}function Nu(o,u,m,A,T,R){var L=0;if(A=o,typeof o=="function")im(o)&&(L=1);else if(typeof o=="string")L=xE(o,m,ee.current)?26:o==="html"||o==="head"||o==="body"?27:5;else e:switch(o){case _:return o=on(31,m,u,T),o.elementType=_,o.lanes=R,o;case x:return Yr(m.children,T,R,u);case b:L=8,T|=24;break;case w:return o=on(12,m,u,T|2),o.elementType=w,o.lanes=R,o;case D:return o=on(13,m,u,T),o.elementType=D,o.lanes=R,o;case M:return o=on(19,m,u,T),o.elementType=M,o.lanes=R,o;default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case C:L=10;break e;case S:L=9;break e;case E:L=11;break e;case N:L=14;break e;case I:L=16,A=null;break e}L=29,m=Error(n(130,o===null?"null":typeof o,"")),A=null}return u=on(L,m,u,T),u.elementType=o,u.type=A,u.lanes=R,u}function Yr(o,u,m,A){return o=on(7,o,A,u),o.lanes=m,o}function nm(o,u,m){return o=on(6,o,null,u),o.lanes=m,o}function nA(o){var u=on(18,null,null,0);return u.stateNode=o,u}function sm(o,u,m){return u=on(4,o.children!==null?o.children:[],o.key,u),u.lanes=m,u.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},u}var sA=new WeakMap;function Mn(o,u){if(typeof o=="object"&&o!==null){var m=sA.get(o);return m!==void 0?m:(u={value:o,source:u,stack:gs(u)},sA.set(o,u),u)}return{value:o,source:u,stack:gs(u)}}var Ha=[],Ya=0,Iu=null,ml=0,Dn=[],Rn=0,sr=null,is=1,ns="";function Ss(o,u){Ha[Ya++]=ml,Ha[Ya++]=Iu,Iu=o,ml=u}function rA(o,u,m){Dn[Rn++]=is,Dn[Rn++]=ns,Dn[Rn++]=sr,sr=o;var A=is;o=ns;var T=32-dt(A)-1;A&=~(1<<T),m+=1;var R=32-dt(u)+T;if(30<R){var L=T-T%5;R=(A&(1<<L)-1).toString(32),A>>=L,T-=L,is=1<<32-dt(u)+T|m<<T|A,ns=R+o}else is=1<<R|m<<T|A,ns=o}function rm(o){o.return!==null&&(Ss(o,1),rA(o,1,0))}function am(o){for(;o===Iu;)Iu=Ha[--Ya],Ha[Ya]=null,ml=Ha[--Ya],Ha[Ya]=null;for(;o===sr;)sr=Dn[--Rn],Dn[Rn]=null,ns=Dn[--Rn],Dn[Rn]=null,is=Dn[--Rn],Dn[Rn]=null}function aA(o,u){Dn[Rn++]=is,Dn[Rn++]=ns,Dn[Rn++]=sr,is=u.id,ns=u.overflow,sr=o}var Ci=null,Ft=null,lt=!1,rr=null,Nn=!1,om=Error(n(519));function ar(o){var u=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw pl(Mn(u,o)),om}function oA(o){var u=o.stateNode,m=o.type,A=o.memoizedProps;switch(u[Si]=o,u[Yi]=A,m){case"dialog":tt("cancel",u),tt("close",u);break;case"iframe":case"object":case"embed":tt("load",u);break;case"video":case"audio":for(m=0;m<kl.length;m++)tt(kl[m],u);break;case"source":tt("error",u);break;case"img":case"image":case"link":tt("error",u),tt("load",u);break;case"details":tt("toggle",u);break;case"input":tt("invalid",u),x2(u,A.value,A.defaultValue,A.checked,A.defaultChecked,A.type,A.name,!0);break;case"select":tt("invalid",u);break;case"textarea":tt("invalid",u),w2(u,A.value,A.defaultValue,A.children)}m=A.children,typeof m!="string"&&typeof m!="number"&&typeof m!="bigint"||u.textContent===""+m||A.suppressHydrationWarning===!0||Cy(u.textContent,m)?(A.popover!=null&&(tt("beforetoggle",u),tt("toggle",u)),A.onScroll!=null&&tt("scroll",u),A.onScrollEnd!=null&&tt("scrollend",u),A.onClick!=null&&(u.onclick=xs),u=!0):u=!1,u||ar(o,!0)}function lA(o){for(Ci=o.return;Ci;)switch(Ci.tag){case 5:case 31:case 13:Nn=!1;return;case 27:case 3:Nn=!0;return;default:Ci=Ci.return}}function qa(o){if(o!==Ci)return!1;if(!lt)return lA(o),lt=!0,!1;var u=o.tag,m;if((m=u!==3&&u!==27)&&((m=u===5)&&(m=o.type,m=!(m!=="form"&&m!=="button")||Ep(o.type,o.memoizedProps)),m=!m),m&&Ft&&ar(o),lA(o),u===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));Ft=Fy(o)}else if(u===31){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));Ft=Fy(o)}else u===27?(u=Ft,xr(o.type)?(o=Np,Np=null,Ft=o):Ft=u):Ft=Ci?_n(o.stateNode.nextSibling):null;return!0}function qr(){Ft=Ci=null,lt=!1}function lm(){var o=rr;return o!==null&&(Qi===null?Qi=o:Qi.push.apply(Qi,o),rr=null),o}function pl(o){rr===null?rr=[o]:rr.push(o)}var cm=j(null),Xr=null,Cs=null;function or(o,u,m){K(cm,u._currentValue),u._currentValue=m}function Es(o){o._currentValue=cm.current,W(cm)}function um(o,u,m){for(;o!==null;){var A=o.alternate;if((o.childLanes&u)!==u?(o.childLanes|=u,A!==null&&(A.childLanes|=u)):A!==null&&(A.childLanes&u)!==u&&(A.childLanes|=u),o===m)break;o=o.return}}function hm(o,u,m,A){var T=o.child;for(T!==null&&(T.return=o);T!==null;){var R=T.dependencies;if(R!==null){var L=T.child;R=R.firstContext;e:for(;R!==null;){var z=R;R=T;for(var Z=0;Z<u.length;Z++)if(z.context===u[Z]){R.lanes|=m,z=R.alternate,z!==null&&(z.lanes|=m),um(R.return,m,o),A||(L=null);break e}R=z.next}}else if(T.tag===18){if(L=T.return,L===null)throw Error(n(341));L.lanes|=m,R=L.alternate,R!==null&&(R.lanes|=m),um(L,m,o),L=null}else L=T.child;if(L!==null)L.return=T;else for(L=T;L!==null;){if(L===o){L=null;break}if(T=L.sibling,T!==null){T.return=L.return,L=T;break}L=L.return}T=L}}function Xa(o,u,m,A){o=null;for(var T=u,R=!1;T!==null;){if(!R){if((T.flags&524288)!==0)R=!0;else if((T.flags&262144)!==0)break}if(T.tag===10){var L=T.alternate;if(L===null)throw Error(n(387));if(L=L.memoizedProps,L!==null){var z=T.type;an(T.pendingProps.value,L.value)||(o!==null?o.push(z):o=[z])}}else if(T===ce.current){if(L=T.alternate,L===null)throw Error(n(387));L.memoizedState.memoizedState!==T.memoizedState.memoizedState&&(o!==null?o.push(zl):o=[zl])}T=T.return}o!==null&&hm(u,o,m,A),u.flags|=262144}function _u(o){for(o=o.firstContext;o!==null;){if(!an(o.context._currentValue,o.memoizedValue))return!0;o=o.next}return!1}function Wr(o){Xr=o,Cs=null,o=o.dependencies,o!==null&&(o.firstContext=null)}function Ei(o){return cA(Xr,o)}function Fu(o,u){return Xr===null&&Wr(o),cA(o,u)}function cA(o,u){var m=u._currentValue;if(u={context:u,memoizedValue:m,next:null},Cs===null){if(o===null)throw Error(n(308));Cs=u,o.dependencies={lanes:0,firstContext:u},o.flags|=524288}else Cs=Cs.next=u;return m}var gC=typeof AbortController<"u"?AbortController:function(){var o=[],u=this.signal={aborted:!1,addEventListener:function(m,A){o.push(A)}};this.abort=function(){u.aborted=!0,o.forEach(function(m){return m()})}},AC=i.unstable_scheduleCallback,vC=i.unstable_NormalPriority,ii={$$typeof:C,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function dm(){return{controller:new gC,data:new Map,refCount:0}}function gl(o){o.refCount--,o.refCount===0&&AC(vC,function(){o.controller.abort()})}var Al=null,fm=0,Wa=0,Ka=null;function yC(o,u){if(Al===null){var m=Al=[];fm=0,Wa=gp(),Ka={status:"pending",value:void 0,then:function(A){m.push(A)}}}return fm++,u.then(uA,uA),u}function uA(){if(--fm===0&&Al!==null){Ka!==null&&(Ka.status="fulfilled");var o=Al;Al=null,Wa=0,Ka=null;for(var u=0;u<o.length;u++)(0,o[u])()}}function xC(o,u){var m=[],A={status:"pending",value:null,reason:null,then:function(T){m.push(T)}};return o.then(function(){A.status="fulfilled",A.value=u;for(var T=0;T<m.length;T++)(0,m[T])(u)},function(T){for(A.status="rejected",A.reason=T,T=0;T<m.length;T++)(0,m[T])(void 0)}),A}var hA=U.S;U.S=function(o,u){Wv=wi(),typeof u=="object"&&u!==null&&typeof u.then=="function"&&yC(o,u),hA!==null&&hA(o,u)};var Kr=j(null);function mm(){var o=Kr.current;return o!==null?o:Dt.pooledCache}function Pu(o,u){u===null?K(Kr,Kr.current):K(Kr,u.pool)}function dA(){var o=mm();return o===null?null:{parent:ii._currentValue,pool:o}}var Qa=Error(n(460)),pm=Error(n(474)),Bu=Error(n(542)),Lu={then:function(){}};function fA(o){return o=o.status,o==="fulfilled"||o==="rejected"}function mA(o,u,m){switch(m=o[m],m===void 0?o.push(u):m!==u&&(u.then(xs,xs),u=m),u.status){case"fulfilled":return u.value;case"rejected":throw o=u.reason,gA(o),o;default:if(typeof u.status=="string")u.then(xs,xs);else{if(o=Dt,o!==null&&100<o.shellSuspendCounter)throw Error(n(482));o=u,o.status="pending",o.then(function(A){if(u.status==="pending"){var T=u;T.status="fulfilled",T.value=A}},function(A){if(u.status==="pending"){var T=u;T.status="rejected",T.reason=A}})}switch(u.status){case"fulfilled":return u.value;case"rejected":throw o=u.reason,gA(o),o}throw Zr=u,Qa}}function Qr(o){try{var u=o._init;return u(o._payload)}catch(m){throw m!==null&&typeof m=="object"&&typeof m.then=="function"?(Zr=m,Qa):m}}var Zr=null;function pA(){if(Zr===null)throw Error(n(459));var o=Zr;return Zr=null,o}function gA(o){if(o===Qa||o===Bu)throw Error(n(483))}var Za=null,vl=0;function ku(o){var u=vl;return vl+=1,Za===null&&(Za=[]),mA(Za,o,u)}function yl(o,u){u=u.props.ref,o.ref=u!==void 0?u:null}function Ou(o,u){throw u.$$typeof===p?Error(n(525)):(o=Object.prototype.toString.call(u),Error(n(31,o==="[object Object]"?"object with keys {"+Object.keys(u).join(", ")+"}":o)))}function AA(o){function u(ie,$){if(o){var se=ie.deletions;se===null?(ie.deletions=[$],ie.flags|=16):se.push($)}}function m(ie,$){if(!o)return null;for(;$!==null;)u(ie,$),$=$.sibling;return null}function A(ie){for(var $=new Map;ie!==null;)ie.key!==null?$.set(ie.key,ie):$.set(ie.index,ie),ie=ie.sibling;return $}function T(ie,$){return ie=ws(ie,$),ie.index=0,ie.sibling=null,ie}function R(ie,$,se){return ie.index=se,o?(se=ie.alternate,se!==null?(se=se.index,se<$?(ie.flags|=67108866,$):se):(ie.flags|=67108866,$)):(ie.flags|=1048576,$)}function L(ie){return o&&ie.alternate===null&&(ie.flags|=67108866),ie}function z(ie,$,se,de){return $===null||$.tag!==6?($=nm(se,ie.mode,de),$.return=ie,$):($=T($,se),$.return=ie,$)}function Z(ie,$,se,de){var _e=se.type;return _e===x?ue(ie,$,se.props.children,de,se.key):$!==null&&($.elementType===_e||typeof _e=="object"&&_e!==null&&_e.$$typeof===I&&Qr(_e)===$.type)?($=T($,se.props),yl($,se),$.return=ie,$):($=Nu(se.type,se.key,se.props,null,ie.mode,de),yl($,se),$.return=ie,$)}function re(ie,$,se,de){return $===null||$.tag!==4||$.stateNode.containerInfo!==se.containerInfo||$.stateNode.implementation!==se.implementation?($=sm(se,ie.mode,de),$.return=ie,$):($=T($,se.children||[]),$.return=ie,$)}function ue(ie,$,se,de,_e){return $===null||$.tag!==7?($=Yr(se,ie.mode,de,_e),$.return=ie,$):($=T($,se),$.return=ie,$)}function fe(ie,$,se){if(typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint")return $=nm(""+$,ie.mode,se),$.return=ie,$;if(typeof $=="object"&&$!==null){switch($.$$typeof){case g:return se=Nu($.type,$.key,$.props,null,ie.mode,se),yl(se,$),se.return=ie,se;case y:return $=sm($,ie.mode,se),$.return=ie,$;case I:return $=Qr($),fe(ie,$,se)}if(q($)||P($))return $=Yr($,ie.mode,se,null),$.return=ie,$;if(typeof $.then=="function")return fe(ie,ku($),se);if($.$$typeof===C)return fe(ie,Fu(ie,$),se);Ou(ie,$)}return null}function ae(ie,$,se,de){var _e=$!==null?$.key:null;if(typeof se=="string"&&se!==""||typeof se=="number"||typeof se=="bigint")return _e!==null?null:z(ie,$,""+se,de);if(typeof se=="object"&&se!==null){switch(se.$$typeof){case g:return se.key===_e?Z(ie,$,se,de):null;case y:return se.key===_e?re(ie,$,se,de):null;case I:return se=Qr(se),ae(ie,$,se,de)}if(q(se)||P(se))return _e!==null?null:ue(ie,$,se,de,null);if(typeof se.then=="function")return ae(ie,$,ku(se),de);if(se.$$typeof===C)return ae(ie,$,Fu(ie,se),de);Ou(ie,se)}return null}function oe(ie,$,se,de,_e){if(typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint")return ie=ie.get(se)||null,z($,ie,""+de,_e);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case g:return ie=ie.get(de.key===null?se:de.key)||null,Z($,ie,de,_e);case y:return ie=ie.get(de.key===null?se:de.key)||null,re($,ie,de,_e);case I:return de=Qr(de),oe(ie,$,se,de,_e)}if(q(de)||P(de))return ie=ie.get(se)||null,ue($,ie,de,_e,null);if(typeof de.then=="function")return oe(ie,$,se,ku(de),_e);if(de.$$typeof===C)return oe(ie,$,se,Fu($,de),_e);Ou($,de)}return null}function Ee(ie,$,se,de){for(var _e=null,pt=null,De=$,Ze=$=0,at=null;De!==null&&Ze<se.length;Ze++){De.index>Ze?(at=De,De=null):at=De.sibling;var gt=ae(ie,De,se[Ze],de);if(gt===null){De===null&&(De=at);break}o&&De&&gt.alternate===null&&u(ie,De),$=R(gt,$,Ze),pt===null?_e=gt:pt.sibling=gt,pt=gt,De=at}if(Ze===se.length)return m(ie,De),lt&&Ss(ie,Ze),_e;if(De===null){for(;Ze<se.length;Ze++)De=fe(ie,se[Ze],de),De!==null&&($=R(De,$,Ze),pt===null?_e=De:pt.sibling=De,pt=De);return lt&&Ss(ie,Ze),_e}for(De=A(De);Ze<se.length;Ze++)at=oe(De,ie,Ze,se[Ze],de),at!==null&&(o&&at.alternate!==null&&De.delete(at.key===null?Ze:at.key),$=R(at,$,Ze),pt===null?_e=at:pt.sibling=at,pt=at);return o&&De.forEach(function(Er){return u(ie,Er)}),lt&&Ss(ie,Ze),_e}function Oe(ie,$,se,de){if(se==null)throw Error(n(151));for(var _e=null,pt=null,De=$,Ze=$=0,at=null,gt=se.next();De!==null&&!gt.done;Ze++,gt=se.next()){De.index>Ze?(at=De,De=null):at=De.sibling;var Er=ae(ie,De,gt.value,de);if(Er===null){De===null&&(De=at);break}o&&De&&Er.alternate===null&&u(ie,De),$=R(Er,$,Ze),pt===null?_e=Er:pt.sibling=Er,pt=Er,De=at}if(gt.done)return m(ie,De),lt&&Ss(ie,Ze),_e;if(De===null){for(;!gt.done;Ze++,gt=se.next())gt=fe(ie,gt.value,de),gt!==null&&($=R(gt,$,Ze),pt===null?_e=gt:pt.sibling=gt,pt=gt);return lt&&Ss(ie,Ze),_e}for(De=A(De);!gt.done;Ze++,gt=se.next())gt=oe(De,ie,Ze,gt.value,de),gt!==null&&(o&&gt.alternate!==null&&De.delete(gt.key===null?Ze:gt.key),$=R(gt,$,Ze),pt===null?_e=gt:pt.sibling=gt,pt=gt);return o&&De.forEach(function(IE){return u(ie,IE)}),lt&&Ss(ie,Ze),_e}function Tt(ie,$,se,de){if(typeof se=="object"&&se!==null&&se.type===x&&se.key===null&&(se=se.props.children),typeof se=="object"&&se!==null){switch(se.$$typeof){case g:e:{for(var _e=se.key;$!==null;){if($.key===_e){if(_e=se.type,_e===x){if($.tag===7){m(ie,$.sibling),de=T($,se.props.children),de.return=ie,ie=de;break e}}else if($.elementType===_e||typeof _e=="object"&&_e!==null&&_e.$$typeof===I&&Qr(_e)===$.type){m(ie,$.sibling),de=T($,se.props),yl(de,se),de.return=ie,ie=de;break e}m(ie,$);break}else u(ie,$);$=$.sibling}se.type===x?(de=Yr(se.props.children,ie.mode,de,se.key),de.return=ie,ie=de):(de=Nu(se.type,se.key,se.props,null,ie.mode,de),yl(de,se),de.return=ie,ie=de)}return L(ie);case y:e:{for(_e=se.key;$!==null;){if($.key===_e)if($.tag===4&&$.stateNode.containerInfo===se.containerInfo&&$.stateNode.implementation===se.implementation){m(ie,$.sibling),de=T($,se.children||[]),de.return=ie,ie=de;break e}else{m(ie,$);break}else u(ie,$);$=$.sibling}de=sm(se,ie.mode,de),de.return=ie,ie=de}return L(ie);case I:return se=Qr(se),Tt(ie,$,se,de)}if(q(se))return Ee(ie,$,se,de);if(P(se)){if(_e=P(se),typeof _e!="function")throw Error(n(150));return se=_e.call(se),Oe(ie,$,se,de)}if(typeof se.then=="function")return Tt(ie,$,ku(se),de);if(se.$$typeof===C)return Tt(ie,$,Fu(ie,se),de);Ou(ie,se)}return typeof se=="string"&&se!==""||typeof se=="number"||typeof se=="bigint"?(se=""+se,$!==null&&$.tag===6?(m(ie,$.sibling),de=T($,se),de.return=ie,ie=de):(m(ie,$),de=nm(se,ie.mode,de),de.return=ie,ie=de),L(ie)):m(ie,$)}return function(ie,$,se,de){try{vl=0;var _e=Tt(ie,$,se,de);return Za=null,_e}catch(De){if(De===Qa||De===Bu)throw De;var pt=on(29,De,null,ie.mode);return pt.lanes=de,pt.return=ie,pt}}}var Jr=AA(!0),vA=AA(!1),lr=!1;function gm(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Am(o,u){o=o.updateQueue,u.updateQueue===o&&(u.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,callbacks:null})}function cr(o){return{lane:o,tag:0,payload:null,callback:null,next:null}}function ur(o,u,m){var A=o.updateQueue;if(A===null)return null;if(A=A.shared,(vt&2)!==0){var T=A.pending;return T===null?u.next=u:(u.next=T.next,T.next=u),A.pending=u,u=Ru(o),tA(o,null,m),u}return Du(o,A,u,m),Ru(o)}function xl(o,u,m){if(u=u.updateQueue,u!==null&&(u=u.shared,(m&4194048)!==0)){var A=u.lanes;A&=o.pendingLanes,m|=A,u.lanes=m,c2(o,m)}}function vm(o,u){var m=o.updateQueue,A=o.alternate;if(A!==null&&(A=A.updateQueue,m===A)){var T=null,R=null;if(m=m.firstBaseUpdate,m!==null){do{var L={lane:m.lane,tag:m.tag,payload:m.payload,callback:null,next:null};R===null?T=R=L:R=R.next=L,m=m.next}while(m!==null);R===null?T=R=u:R=R.next=u}else T=R=u;m={baseState:A.baseState,firstBaseUpdate:T,lastBaseUpdate:R,shared:A.shared,callbacks:A.callbacks},o.updateQueue=m;return}o=m.lastBaseUpdate,o===null?m.firstBaseUpdate=u:o.next=u,m.lastBaseUpdate=u}var ym=!1;function bl(){if(ym){var o=Ka;if(o!==null)throw o}}function wl(o,u,m,A){ym=!1;var T=o.updateQueue;lr=!1;var R=T.firstBaseUpdate,L=T.lastBaseUpdate,z=T.shared.pending;if(z!==null){T.shared.pending=null;var Z=z,re=Z.next;Z.next=null,L===null?R=re:L.next=re,L=Z;var ue=o.alternate;ue!==null&&(ue=ue.updateQueue,z=ue.lastBaseUpdate,z!==L&&(z===null?ue.firstBaseUpdate=re:z.next=re,ue.lastBaseUpdate=Z))}if(R!==null){var fe=T.baseState;L=0,ue=re=Z=null,z=R;do{var ae=z.lane&-536870913,oe=ae!==z.lane;if(oe?(rt&ae)===ae:(A&ae)===ae){ae!==0&&ae===Wa&&(ym=!0),ue!==null&&(ue=ue.next={lane:0,tag:z.tag,payload:z.payload,callback:null,next:null});e:{var Ee=o,Oe=z;ae=u;var Tt=m;switch(Oe.tag){case 1:if(Ee=Oe.payload,typeof Ee=="function"){fe=Ee.call(Tt,fe,ae);break e}fe=Ee;break e;case 3:Ee.flags=Ee.flags&-65537|128;case 0:if(Ee=Oe.payload,ae=typeof Ee=="function"?Ee.call(Tt,fe,ae):Ee,ae==null)break e;fe=f({},fe,ae);break e;case 2:lr=!0}}ae=z.callback,ae!==null&&(o.flags|=64,oe&&(o.flags|=8192),oe=T.callbacks,oe===null?T.callbacks=[ae]:oe.push(ae))}else oe={lane:ae,tag:z.tag,payload:z.payload,callback:z.callback,next:null},ue===null?(re=ue=oe,Z=fe):ue=ue.next=oe,L|=ae;if(z=z.next,z===null){if(z=T.shared.pending,z===null)break;oe=z,z=oe.next,oe.next=null,T.lastBaseUpdate=oe,T.shared.pending=null}}while(!0);ue===null&&(Z=fe),T.baseState=Z,T.firstBaseUpdate=re,T.lastBaseUpdate=ue,R===null&&(T.shared.lanes=0),pr|=L,o.lanes=L,o.memoizedState=fe}}function yA(o,u){if(typeof o!="function")throw Error(n(191,o));o.call(u)}function xA(o,u){var m=o.callbacks;if(m!==null)for(o.callbacks=null,o=0;o<m.length;o++)yA(m[o],u)}var Ja=j(null),Uu=j(0);function bA(o,u){o=Ps,K(Uu,o),K(Ja,u),Ps=o|u.baseLanes}function xm(){K(Uu,Ps),K(Ja,Ja.current)}function bm(){Ps=Uu.current,W(Ja),W(Uu)}var ln=j(null),In=null;function hr(o){var u=o.alternate;K(Zt,Zt.current&1),K(ln,o),In===null&&(u===null||Ja.current!==null||u.memoizedState!==null)&&(In=o)}function wm(o){K(Zt,Zt.current),K(ln,o),In===null&&(In=o)}function wA(o){o.tag===22?(K(Zt,Zt.current),K(ln,o),In===null&&(In=o)):dr()}function dr(){K(Zt,Zt.current),K(ln,ln.current)}function cn(o){W(ln),In===o&&(In=null),W(Zt)}var Zt=j(0);function Vu(o){for(var u=o;u!==null;){if(u.tag===13){var m=u.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||Dp(m)||Rp(m)))return u}else if(u.tag===19&&(u.memoizedProps.revealOrder==="forwards"||u.memoizedProps.revealOrder==="backwards"||u.memoizedProps.revealOrder==="unstable_legacy-backwards"||u.memoizedProps.revealOrder==="together")){if((u.flags&128)!==0)return u}else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===o)break;for(;u.sibling===null;){if(u.return===null||u.return===o)return null;u=u.return}u.sibling.return=u.return,u=u.sibling}return null}var Ts=0,Ke=null,Ct=null,ni=null,ju=!1,$a=!1,$r=!1,zu=0,Sl=0,eo=null,bC=0;function Xt(){throw Error(n(321))}function Sm(o,u){if(u===null)return!1;for(var m=0;m<u.length&&m<o.length;m++)if(!an(o[m],u[m]))return!1;return!0}function Cm(o,u,m,A,T,R){return Ts=R,Ke=u,u.memoizedState=null,u.updateQueue=null,u.lanes=0,U.H=o===null||o.memoizedState===null?rv:Um,$r=!1,R=m(A,T),$r=!1,$a&&(R=CA(u,m,A,T)),SA(o),R}function SA(o){U.H=Tl;var u=Ct!==null&&Ct.next!==null;if(Ts=0,ni=Ct=Ke=null,ju=!1,Sl=0,eo=null,u)throw Error(n(300));o===null||si||(o=o.dependencies,o!==null&&_u(o)&&(si=!0))}function CA(o,u,m,A){Ke=o;var T=0;do{if($a&&(eo=null),Sl=0,$a=!1,25<=T)throw Error(n(301));if(T+=1,ni=Ct=null,o.updateQueue!=null){var R=o.updateQueue;R.lastEffect=null,R.events=null,R.stores=null,R.memoCache!=null&&(R.memoCache.index=0)}U.H=av,R=u(m,A)}while($a);return R}function wC(){var o=U.H,u=o.useState()[0];return u=typeof u.then=="function"?Cl(u):u,o=o.useState()[0],(Ct!==null?Ct.memoizedState:null)!==o&&(Ke.flags|=1024),u}function Em(){var o=zu!==0;return zu=0,o}function Tm(o,u,m){u.updateQueue=o.updateQueue,u.flags&=-2053,o.lanes&=~m}function Mm(o){if(ju){for(o=o.memoizedState;o!==null;){var u=o.queue;u!==null&&(u.pending=null),o=o.next}ju=!1}Ts=0,ni=Ct=Ke=null,$a=!1,Sl=zu=0,eo=null}function Ui(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ni===null?Ke.memoizedState=ni=o:ni=ni.next=o,ni}function Jt(){if(Ct===null){var o=Ke.alternate;o=o!==null?o.memoizedState:null}else o=Ct.next;var u=ni===null?Ke.memoizedState:ni.next;if(u!==null)ni=u,Ct=o;else{if(o===null)throw Ke.alternate===null?Error(n(467)):Error(n(310));Ct=o,o={memoizedState:Ct.memoizedState,baseState:Ct.baseState,baseQueue:Ct.baseQueue,queue:Ct.queue,next:null},ni===null?Ke.memoizedState=ni=o:ni=ni.next=o}return ni}function Gu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Cl(o){var u=Sl;return Sl+=1,eo===null&&(eo=[]),o=mA(eo,o,u),u=Ke,(ni===null?u.memoizedState:ni.next)===null&&(u=u.alternate,U.H=u===null||u.memoizedState===null?rv:Um),o}function Hu(o){if(o!==null&&typeof o=="object"){if(typeof o.then=="function")return Cl(o);if(o.$$typeof===C)return Ei(o)}throw Error(n(438,String(o)))}function Dm(o){var u=null,m=Ke.updateQueue;if(m!==null&&(u=m.memoCache),u==null){var A=Ke.alternate;A!==null&&(A=A.updateQueue,A!==null&&(A=A.memoCache,A!=null&&(u={data:A.data.map(function(T){return T.slice()}),index:0})))}if(u==null&&(u={data:[],index:0}),m===null&&(m=Gu(),Ke.updateQueue=m),m.memoCache=u,m=u.data[u.index],m===void 0)for(m=u.data[u.index]=Array(o),A=0;A<o;A++)m[A]=F;return u.index++,m}function Ms(o,u){return typeof u=="function"?u(o):u}function Yu(o){var u=Jt();return Rm(u,Ct,o)}function Rm(o,u,m){var A=o.queue;if(A===null)throw Error(n(311));A.lastRenderedReducer=m;var T=o.baseQueue,R=A.pending;if(R!==null){if(T!==null){var L=T.next;T.next=R.next,R.next=L}u.baseQueue=T=R,A.pending=null}if(R=o.baseState,T===null)o.memoizedState=R;else{u=T.next;var z=L=null,Z=null,re=u,ue=!1;do{var fe=re.lane&-536870913;if(fe!==re.lane?(rt&fe)===fe:(Ts&fe)===fe){var ae=re.revertLane;if(ae===0)Z!==null&&(Z=Z.next={lane:0,revertLane:0,gesture:null,action:re.action,hasEagerState:re.hasEagerState,eagerState:re.eagerState,next:null}),fe===Wa&&(ue=!0);else if((Ts&ae)===ae){re=re.next,ae===Wa&&(ue=!0);continue}else fe={lane:0,revertLane:re.revertLane,gesture:null,action:re.action,hasEagerState:re.hasEagerState,eagerState:re.eagerState,next:null},Z===null?(z=Z=fe,L=R):Z=Z.next=fe,Ke.lanes|=ae,pr|=ae;fe=re.action,$r&&m(R,fe),R=re.hasEagerState?re.eagerState:m(R,fe)}else ae={lane:fe,revertLane:re.revertLane,gesture:re.gesture,action:re.action,hasEagerState:re.hasEagerState,eagerState:re.eagerState,next:null},Z===null?(z=Z=ae,L=R):Z=Z.next=ae,Ke.lanes|=fe,pr|=fe;re=re.next}while(re!==null&&re!==u);if(Z===null?L=R:Z.next=z,!an(R,o.memoizedState)&&(si=!0,ue&&(m=Ka,m!==null)))throw m;o.memoizedState=R,o.baseState=L,o.baseQueue=Z,A.lastRenderedState=R}return T===null&&(A.lanes=0),[o.memoizedState,A.dispatch]}function Nm(o){var u=Jt(),m=u.queue;if(m===null)throw Error(n(311));m.lastRenderedReducer=o;var A=m.dispatch,T=m.pending,R=u.memoizedState;if(T!==null){m.pending=null;var L=T=T.next;do R=o(R,L.action),L=L.next;while(L!==T);an(R,u.memoizedState)||(si=!0),u.memoizedState=R,u.baseQueue===null&&(u.baseState=R),m.lastRenderedState=R}return[R,A]}function EA(o,u,m){var A=Ke,T=Jt(),R=lt;if(R){if(m===void 0)throw Error(n(407));m=m()}else m=u();var L=!an((Ct||T).memoizedState,m);if(L&&(T.memoizedState=m,si=!0),T=T.queue,Fm(DA.bind(null,A,T,o),[o]),T.getSnapshot!==u||L||ni!==null&&ni.memoizedState.tag&1){if(A.flags|=2048,to(9,{destroy:void 0},MA.bind(null,A,T,m,u),null),Dt===null)throw Error(n(349));R||(Ts&127)!==0||TA(A,u,m)}return m}function TA(o,u,m){o.flags|=16384,o={getSnapshot:u,value:m},u=Ke.updateQueue,u===null?(u=Gu(),Ke.updateQueue=u,u.stores=[o]):(m=u.stores,m===null?u.stores=[o]:m.push(o))}function MA(o,u,m,A){u.value=m,u.getSnapshot=A,RA(u)&&NA(o)}function DA(o,u,m){return m(function(){RA(u)&&NA(o)})}function RA(o){var u=o.getSnapshot;o=o.value;try{var m=u();return!an(o,m)}catch{return!0}}function NA(o){var u=Hr(o,2);u!==null&&Zi(u,o,2)}function Im(o){var u=Ui();if(typeof o=="function"){var m=o;if(o=m(),$r){Ne(!0);try{m()}finally{Ne(!1)}}}return u.memoizedState=u.baseState=o,u.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ms,lastRenderedState:o},u}function IA(o,u,m,A){return o.baseState=m,Rm(o,Ct,typeof A=="function"?A:Ms)}function SC(o,u,m,A,T){if(Wu(o))throw Error(n(485));if(o=u.action,o!==null){var R={payload:T,action:o,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(L){R.listeners.push(L)}};U.T!==null?m(!0):R.isTransition=!1,A(R),m=u.pending,m===null?(R.next=u.pending=R,_A(u,R)):(R.next=m.next,u.pending=m.next=R)}}function _A(o,u){var m=u.action,A=u.payload,T=o.state;if(u.isTransition){var R=U.T,L={};U.T=L;try{var z=m(T,A),Z=U.S;Z!==null&&Z(L,z),FA(o,u,z)}catch(re){_m(o,u,re)}finally{R!==null&&L.types!==null&&(R.types=L.types),U.T=R}}else try{R=m(T,A),FA(o,u,R)}catch(re){_m(o,u,re)}}function FA(o,u,m){m!==null&&typeof m=="object"&&typeof m.then=="function"?m.then(function(A){PA(o,u,A)},function(A){return _m(o,u,A)}):PA(o,u,m)}function PA(o,u,m){u.status="fulfilled",u.value=m,BA(u),o.state=m,u=o.pending,u!==null&&(m=u.next,m===u?o.pending=null:(m=m.next,u.next=m,_A(o,m)))}function _m(o,u,m){var A=o.pending;if(o.pending=null,A!==null){A=A.next;do u.status="rejected",u.reason=m,BA(u),u=u.next;while(u!==A)}o.action=null}function BA(o){o=o.listeners;for(var u=0;u<o.length;u++)(0,o[u])()}function LA(o,u){return u}function kA(o,u){if(lt){var m=Dt.formState;if(m!==null){e:{var A=Ke;if(lt){if(Ft){t:{for(var T=Ft,R=Nn;T.nodeType!==8;){if(!R){T=null;break t}if(T=_n(T.nextSibling),T===null){T=null;break t}}R=T.data,T=R==="F!"||R==="F"?T:null}if(T){Ft=_n(T.nextSibling),A=T.data==="F!";break e}}ar(A)}A=!1}A&&(u=m[0])}}return m=Ui(),m.memoizedState=m.baseState=u,A={pending:null,lanes:0,dispatch:null,lastRenderedReducer:LA,lastRenderedState:u},m.queue=A,m=iv.bind(null,Ke,A),A.dispatch=m,A=Im(!1),R=Om.bind(null,Ke,!1,A.queue),A=Ui(),T={state:u,dispatch:null,action:o,pending:null},A.queue=T,m=SC.bind(null,Ke,T,R,m),T.dispatch=m,A.memoizedState=o,[u,m,!1]}function OA(o){var u=Jt();return UA(u,Ct,o)}function UA(o,u,m){if(u=Rm(o,u,LA)[0],o=Yu(Ms)[0],typeof u=="object"&&u!==null&&typeof u.then=="function")try{var A=Cl(u)}catch(L){throw L===Qa?Bu:L}else A=u;u=Jt();var T=u.queue,R=T.dispatch;return m!==u.memoizedState&&(Ke.flags|=2048,to(9,{destroy:void 0},CC.bind(null,T,m),null)),[A,R,o]}function CC(o,u){o.action=u}function VA(o){var u=Jt(),m=Ct;if(m!==null)return UA(u,m,o);Jt(),u=u.memoizedState,m=Jt();var A=m.queue.dispatch;return m.memoizedState=o,[u,A,!1]}function to(o,u,m,A){return o={tag:o,create:m,deps:A,inst:u,next:null},u=Ke.updateQueue,u===null&&(u=Gu(),Ke.updateQueue=u),m=u.lastEffect,m===null?u.lastEffect=o.next=o:(A=m.next,m.next=o,o.next=A,u.lastEffect=o),o}function jA(){return Jt().memoizedState}function qu(o,u,m,A){var T=Ui();Ke.flags|=o,T.memoizedState=to(1|u,{destroy:void 0},m,A===void 0?null:A)}function Xu(o,u,m,A){var T=Jt();A=A===void 0?null:A;var R=T.memoizedState.inst;Ct!==null&&A!==null&&Sm(A,Ct.memoizedState.deps)?T.memoizedState=to(u,R,m,A):(Ke.flags|=o,T.memoizedState=to(1|u,R,m,A))}function zA(o,u){qu(8390656,8,o,u)}function Fm(o,u){Xu(2048,8,o,u)}function EC(o){Ke.flags|=4;var u=Ke.updateQueue;if(u===null)u=Gu(),Ke.updateQueue=u,u.events=[o];else{var m=u.events;m===null?u.events=[o]:m.push(o)}}function GA(o){var u=Jt().memoizedState;return EC({ref:u,nextImpl:o}),function(){if((vt&2)!==0)throw Error(n(440));return u.impl.apply(void 0,arguments)}}function HA(o,u){return Xu(4,2,o,u)}function YA(o,u){return Xu(4,4,o,u)}function qA(o,u){if(typeof u=="function"){o=o();var m=u(o);return function(){typeof m=="function"?m():u(null)}}if(u!=null)return o=o(),u.current=o,function(){u.current=null}}function XA(o,u,m){m=m!=null?m.concat([o]):null,Xu(4,4,qA.bind(null,u,o),m)}function Pm(){}function WA(o,u){var m=Jt();u=u===void 0?null:u;var A=m.memoizedState;return u!==null&&Sm(u,A[1])?A[0]:(m.memoizedState=[o,u],o)}function KA(o,u){var m=Jt();u=u===void 0?null:u;var A=m.memoizedState;if(u!==null&&Sm(u,A[1]))return A[0];if(A=o(),$r){Ne(!0);try{o()}finally{Ne(!1)}}return m.memoizedState=[A,u],A}function Bm(o,u,m){return m===void 0||(Ts&1073741824)!==0&&(rt&261930)===0?o.memoizedState=u:(o.memoizedState=m,o=Qv(),Ke.lanes|=o,pr|=o,m)}function QA(o,u,m,A){return an(m,u)?m:Ja.current!==null?(o=Bm(o,m,A),an(o,u)||(si=!0),o):(Ts&42)===0||(Ts&1073741824)!==0&&(rt&261930)===0?(si=!0,o.memoizedState=m):(o=Qv(),Ke.lanes|=o,pr|=o,u)}function ZA(o,u,m,A,T){var R=H.p;H.p=R!==0&&8>R?R:8;var L=U.T,z={};U.T=z,Om(o,!1,u,m);try{var Z=T(),re=U.S;if(re!==null&&re(z,Z),Z!==null&&typeof Z=="object"&&typeof Z.then=="function"){var ue=xC(Z,A);El(o,u,ue,dn(o))}else El(o,u,A,dn(o))}catch(fe){El(o,u,{then:function(){},status:"rejected",reason:fe},dn())}finally{H.p=R,L!==null&&z.types!==null&&(L.types=z.types),U.T=L}}function TC(){}function Lm(o,u,m,A){if(o.tag!==5)throw Error(n(476));var T=JA(o).queue;ZA(o,T,u,Y,m===null?TC:function(){return $A(o),m(A)})}function JA(o){var u=o.memoizedState;if(u!==null)return u;u={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ms,lastRenderedState:Y},next:null};var m={};return u.next={memoizedState:m,baseState:m,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ms,lastRenderedState:m},next:null},o.memoizedState=u,o=o.alternate,o!==null&&(o.memoizedState=u),u}function $A(o){var u=JA(o);u.next===null&&(u=o.alternate.memoizedState),El(o,u.next.queue,{},dn())}function km(){return Ei(zl)}function ev(){return Jt().memoizedState}function tv(){return Jt().memoizedState}function MC(o){for(var u=o.return;u!==null;){switch(u.tag){case 24:case 3:var m=dn();o=cr(m);var A=ur(u,o,m);A!==null&&(Zi(A,u,m),xl(A,u,m)),u={cache:dm()},o.payload=u;return}u=u.return}}function DC(o,u,m){var A=dn();m={lane:A,revertLane:0,gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},Wu(o)?nv(u,m):(m=tm(o,u,m,A),m!==null&&(Zi(m,o,A),sv(m,u,A)))}function iv(o,u,m){var A=dn();El(o,u,m,A)}function El(o,u,m,A){var T={lane:A,revertLane:0,gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null};if(Wu(o))nv(u,T);else{var R=o.alternate;if(o.lanes===0&&(R===null||R.lanes===0)&&(R=u.lastRenderedReducer,R!==null))try{var L=u.lastRenderedState,z=R(L,m);if(T.hasEagerState=!0,T.eagerState=z,an(z,L))return Du(o,u,T,0),Dt===null&&Mu(),!1}catch{}if(m=tm(o,u,T,A),m!==null)return Zi(m,o,A),sv(m,u,A),!0}return!1}function Om(o,u,m,A){if(A={lane:2,revertLane:gp(),gesture:null,action:A,hasEagerState:!1,eagerState:null,next:null},Wu(o)){if(u)throw Error(n(479))}else u=tm(o,m,A,2),u!==null&&Zi(u,o,2)}function Wu(o){var u=o.alternate;return o===Ke||u!==null&&u===Ke}function nv(o,u){$a=ju=!0;var m=o.pending;m===null?u.next=u:(u.next=m.next,m.next=u),o.pending=u}function sv(o,u,m){if((m&4194048)!==0){var A=u.lanes;A&=o.pendingLanes,m|=A,u.lanes=m,c2(o,m)}}var Tl={readContext:Ei,use:Hu,useCallback:Xt,useContext:Xt,useEffect:Xt,useImperativeHandle:Xt,useLayoutEffect:Xt,useInsertionEffect:Xt,useMemo:Xt,useReducer:Xt,useRef:Xt,useState:Xt,useDebugValue:Xt,useDeferredValue:Xt,useTransition:Xt,useSyncExternalStore:Xt,useId:Xt,useHostTransitionStatus:Xt,useFormState:Xt,useActionState:Xt,useOptimistic:Xt,useMemoCache:Xt,useCacheRefresh:Xt};Tl.useEffectEvent=Xt;var rv={readContext:Ei,use:Hu,useCallback:function(o,u){return Ui().memoizedState=[o,u===void 0?null:u],o},useContext:Ei,useEffect:zA,useImperativeHandle:function(o,u,m){m=m!=null?m.concat([o]):null,qu(4194308,4,qA.bind(null,u,o),m)},useLayoutEffect:function(o,u){return qu(4194308,4,o,u)},useInsertionEffect:function(o,u){qu(4,2,o,u)},useMemo:function(o,u){var m=Ui();u=u===void 0?null:u;var A=o();if($r){Ne(!0);try{o()}finally{Ne(!1)}}return m.memoizedState=[A,u],A},useReducer:function(o,u,m){var A=Ui();if(m!==void 0){var T=m(u);if($r){Ne(!0);try{m(u)}finally{Ne(!1)}}}else T=u;return A.memoizedState=A.baseState=T,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:T},A.queue=o,o=o.dispatch=DC.bind(null,Ke,o),[A.memoizedState,o]},useRef:function(o){var u=Ui();return o={current:o},u.memoizedState=o},useState:function(o){o=Im(o);var u=o.queue,m=iv.bind(null,Ke,u);return u.dispatch=m,[o.memoizedState,m]},useDebugValue:Pm,useDeferredValue:function(o,u){var m=Ui();return Bm(m,o,u)},useTransition:function(){var o=Im(!1);return o=ZA.bind(null,Ke,o.queue,!0,!1),Ui().memoizedState=o,[!1,o]},useSyncExternalStore:function(o,u,m){var A=Ke,T=Ui();if(lt){if(m===void 0)throw Error(n(407));m=m()}else{if(m=u(),Dt===null)throw Error(n(349));(rt&127)!==0||TA(A,u,m)}T.memoizedState=m;var R={value:m,getSnapshot:u};return T.queue=R,zA(DA.bind(null,A,R,o),[o]),A.flags|=2048,to(9,{destroy:void 0},MA.bind(null,A,R,m,u),null),m},useId:function(){var o=Ui(),u=Dt.identifierPrefix;if(lt){var m=ns,A=is;m=(A&~(1<<32-dt(A)-1)).toString(32)+m,u="_"+u+"R_"+m,m=zu++,0<m&&(u+="H"+m.toString(32)),u+="_"}else m=bC++,u="_"+u+"r_"+m.toString(32)+"_";return o.memoizedState=u},useHostTransitionStatus:km,useFormState:kA,useActionState:kA,useOptimistic:function(o){var u=Ui();u.memoizedState=u.baseState=o;var m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return u.queue=m,u=Om.bind(null,Ke,!0,m),m.dispatch=u,[o,u]},useMemoCache:Dm,useCacheRefresh:function(){return Ui().memoizedState=MC.bind(null,Ke)},useEffectEvent:function(o){var u=Ui(),m={impl:o};return u.memoizedState=m,function(){if((vt&2)!==0)throw Error(n(440));return m.impl.apply(void 0,arguments)}}},Um={readContext:Ei,use:Hu,useCallback:WA,useContext:Ei,useEffect:Fm,useImperativeHandle:XA,useInsertionEffect:HA,useLayoutEffect:YA,useMemo:KA,useReducer:Yu,useRef:jA,useState:function(){return Yu(Ms)},useDebugValue:Pm,useDeferredValue:function(o,u){var m=Jt();return QA(m,Ct.memoizedState,o,u)},useTransition:function(){var o=Yu(Ms)[0],u=Jt().memoizedState;return[typeof o=="boolean"?o:Cl(o),u]},useSyncExternalStore:EA,useId:ev,useHostTransitionStatus:km,useFormState:OA,useActionState:OA,useOptimistic:function(o,u){var m=Jt();return IA(m,Ct,o,u)},useMemoCache:Dm,useCacheRefresh:tv};Um.useEffectEvent=GA;var av={readContext:Ei,use:Hu,useCallback:WA,useContext:Ei,useEffect:Fm,useImperativeHandle:XA,useInsertionEffect:HA,useLayoutEffect:YA,useMemo:KA,useReducer:Nm,useRef:jA,useState:function(){return Nm(Ms)},useDebugValue:Pm,useDeferredValue:function(o,u){var m=Jt();return Ct===null?Bm(m,o,u):QA(m,Ct.memoizedState,o,u)},useTransition:function(){var o=Nm(Ms)[0],u=Jt().memoizedState;return[typeof o=="boolean"?o:Cl(o),u]},useSyncExternalStore:EA,useId:ev,useHostTransitionStatus:km,useFormState:VA,useActionState:VA,useOptimistic:function(o,u){var m=Jt();return Ct!==null?IA(m,Ct,o,u):(m.baseState=o,[o,m.queue.dispatch])},useMemoCache:Dm,useCacheRefresh:tv};av.useEffectEvent=GA;function Vm(o,u,m,A){u=o.memoizedState,m=m(A,u),m=m==null?u:f({},u,m),o.memoizedState=m,o.lanes===0&&(o.updateQueue.baseState=m)}var jm={enqueueSetState:function(o,u,m){o=o._reactInternals;var A=dn(),T=cr(A);T.payload=u,m!=null&&(T.callback=m),u=ur(o,T,A),u!==null&&(Zi(u,o,A),xl(u,o,A))},enqueueReplaceState:function(o,u,m){o=o._reactInternals;var A=dn(),T=cr(A);T.tag=1,T.payload=u,m!=null&&(T.callback=m),u=ur(o,T,A),u!==null&&(Zi(u,o,A),xl(u,o,A))},enqueueForceUpdate:function(o,u){o=o._reactInternals;var m=dn(),A=cr(m);A.tag=2,u!=null&&(A.callback=u),u=ur(o,A,m),u!==null&&(Zi(u,o,m),xl(u,o,m))}};function ov(o,u,m,A,T,R,L){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(A,R,L):u.prototype&&u.prototype.isPureReactComponent?!dl(m,A)||!dl(T,R):!0}function lv(o,u,m,A){o=u.state,typeof u.componentWillReceiveProps=="function"&&u.componentWillReceiveProps(m,A),typeof u.UNSAFE_componentWillReceiveProps=="function"&&u.UNSAFE_componentWillReceiveProps(m,A),u.state!==o&&jm.enqueueReplaceState(u,u.state,null)}function ea(o,u){var m=u;if("ref"in u){m={};for(var A in u)A!=="ref"&&(m[A]=u[A])}if(o=o.defaultProps){m===u&&(m=f({},m));for(var T in o)m[T]===void 0&&(m[T]=o[T])}return m}function cv(o){Tu(o)}function uv(o){console.error(o)}function hv(o){Tu(o)}function Ku(o,u){try{var m=o.onUncaughtError;m(u.value,{componentStack:u.stack})}catch(A){setTimeout(function(){throw A})}}function dv(o,u,m){try{var A=o.onCaughtError;A(m.value,{componentStack:m.stack,errorBoundary:u.tag===1?u.stateNode:null})}catch(T){setTimeout(function(){throw T})}}function zm(o,u,m){return m=cr(m),m.tag=3,m.payload={element:null},m.callback=function(){Ku(o,u)},m}function fv(o){return o=cr(o),o.tag=3,o}function mv(o,u,m,A){var T=m.type.getDerivedStateFromError;if(typeof T=="function"){var R=A.value;o.payload=function(){return T(R)},o.callback=function(){dv(u,m,A)}}var L=m.stateNode;L!==null&&typeof L.componentDidCatch=="function"&&(o.callback=function(){dv(u,m,A),typeof T!="function"&&(gr===null?gr=new Set([this]):gr.add(this));var z=A.stack;this.componentDidCatch(A.value,{componentStack:z!==null?z:""})})}function RC(o,u,m,A,T){if(m.flags|=32768,A!==null&&typeof A=="object"&&typeof A.then=="function"){if(u=m.alternate,u!==null&&Xa(u,m,T,!0),m=ln.current,m!==null){switch(m.tag){case 31:case 13:return In===null?oh():m.alternate===null&&Wt===0&&(Wt=3),m.flags&=-257,m.flags|=65536,m.lanes=T,A===Lu?m.flags|=16384:(u=m.updateQueue,u===null?m.updateQueue=new Set([A]):u.add(A),fp(o,A,T)),!1;case 22:return m.flags|=65536,A===Lu?m.flags|=16384:(u=m.updateQueue,u===null?(u={transitions:null,markerInstances:null,retryQueue:new Set([A])},m.updateQueue=u):(m=u.retryQueue,m===null?u.retryQueue=new Set([A]):m.add(A)),fp(o,A,T)),!1}throw Error(n(435,m.tag))}return fp(o,A,T),oh(),!1}if(lt)return u=ln.current,u!==null?((u.flags&65536)===0&&(u.flags|=256),u.flags|=65536,u.lanes=T,A!==om&&(o=Error(n(422),{cause:A}),pl(Mn(o,m)))):(A!==om&&(u=Error(n(423),{cause:A}),pl(Mn(u,m))),o=o.current.alternate,o.flags|=65536,T&=-T,o.lanes|=T,A=Mn(A,m),T=zm(o.stateNode,A,T),vm(o,T),Wt!==4&&(Wt=2)),!1;var R=Error(n(520),{cause:A});if(R=Mn(R,m),Pl===null?Pl=[R]:Pl.push(R),Wt!==4&&(Wt=2),u===null)return!0;A=Mn(A,m),m=u;do{switch(m.tag){case 3:return m.flags|=65536,o=T&-T,m.lanes|=o,o=zm(m.stateNode,A,o),vm(m,o),!1;case 1:if(u=m.type,R=m.stateNode,(m.flags&128)===0&&(typeof u.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(gr===null||!gr.has(R))))return m.flags|=65536,T&=-T,m.lanes|=T,T=fv(T),mv(T,o,m,A),vm(m,T),!1}m=m.return}while(m!==null);return!1}var Gm=Error(n(461)),si=!1;function Ti(o,u,m,A){u.child=o===null?vA(u,null,m,A):Jr(u,o.child,m,A)}function pv(o,u,m,A,T){m=m.render;var R=u.ref;if("ref"in A){var L={};for(var z in A)z!=="ref"&&(L[z]=A[z])}else L=A;return Wr(u),A=Cm(o,u,m,L,R,T),z=Em(),o!==null&&!si?(Tm(o,u,T),Ds(o,u,T)):(lt&&z&&rm(u),u.flags|=1,Ti(o,u,A,T),u.child)}function gv(o,u,m,A,T){if(o===null){var R=m.type;return typeof R=="function"&&!im(R)&&R.defaultProps===void 0&&m.compare===null?(u.tag=15,u.type=R,Av(o,u,R,A,T)):(o=Nu(m.type,null,A,u,u.mode,T),o.ref=u.ref,o.return=u,u.child=o)}if(R=o.child,!Zm(o,T)){var L=R.memoizedProps;if(m=m.compare,m=m!==null?m:dl,m(L,A)&&o.ref===u.ref)return Ds(o,u,T)}return u.flags|=1,o=ws(R,A),o.ref=u.ref,o.return=u,u.child=o}function Av(o,u,m,A,T){if(o!==null){var R=o.memoizedProps;if(dl(R,A)&&o.ref===u.ref)if(si=!1,u.pendingProps=A=R,Zm(o,T))(o.flags&131072)!==0&&(si=!0);else return u.lanes=o.lanes,Ds(o,u,T)}return Hm(o,u,m,A,T)}function vv(o,u,m,A){var T=A.children,R=o!==null?o.memoizedState:null;if(o===null&&u.stateNode===null&&(u.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),A.mode==="hidden"){if((u.flags&128)!==0){if(R=R!==null?R.baseLanes|m:m,o!==null){for(A=u.child=o.child,T=0;A!==null;)T=T|A.lanes|A.childLanes,A=A.sibling;A=T&~R}else A=0,u.child=null;return yv(o,u,R,m,A)}if((m&536870912)!==0)u.memoizedState={baseLanes:0,cachePool:null},o!==null&&Pu(u,R!==null?R.cachePool:null),R!==null?bA(u,R):xm(),wA(u);else return A=u.lanes=536870912,yv(o,u,R!==null?R.baseLanes|m:m,m,A)}else R!==null?(Pu(u,R.cachePool),bA(u,R),dr(),u.memoizedState=null):(o!==null&&Pu(u,null),xm(),dr());return Ti(o,u,T,m),u.child}function Ml(o,u){return o!==null&&o.tag===22||u.stateNode!==null||(u.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),u.sibling}function yv(o,u,m,A,T){var R=mm();return R=R===null?null:{parent:ii._currentValue,pool:R},u.memoizedState={baseLanes:m,cachePool:R},o!==null&&Pu(u,null),xm(),wA(u),o!==null&&Xa(o,u,A,!0),u.childLanes=T,null}function Qu(o,u){return u=Ju({mode:u.mode,children:u.children},o.mode),u.ref=o.ref,o.child=u,u.return=o,u}function xv(o,u,m){return Jr(u,o.child,null,m),o=Qu(u,u.pendingProps),o.flags|=2,cn(u),u.memoizedState=null,o}function NC(o,u,m){var A=u.pendingProps,T=(u.flags&128)!==0;if(u.flags&=-129,o===null){if(lt){if(A.mode==="hidden")return o=Qu(u,A),u.lanes=536870912,Ml(null,o);if(wm(u),(o=Ft)?(o=_y(o,Nn),o=o!==null&&o.data==="&"?o:null,o!==null&&(u.memoizedState={dehydrated:o,treeContext:sr!==null?{id:is,overflow:ns}:null,retryLane:536870912,hydrationErrors:null},m=nA(o),m.return=u,u.child=m,Ci=u,Ft=null)):o=null,o===null)throw ar(u);return u.lanes=536870912,null}return Qu(u,A)}var R=o.memoizedState;if(R!==null){var L=R.dehydrated;if(wm(u),T)if(u.flags&256)u.flags&=-257,u=xv(o,u,m);else if(u.memoizedState!==null)u.child=o.child,u.flags|=128,u=null;else throw Error(n(558));else if(si||Xa(o,u,m,!1),T=(m&o.childLanes)!==0,si||T){if(A=Dt,A!==null&&(L=u2(A,m),L!==0&&L!==R.retryLane))throw R.retryLane=L,Hr(o,L),Zi(A,o,L),Gm;oh(),u=xv(o,u,m)}else o=R.treeContext,Ft=_n(L.nextSibling),Ci=u,lt=!0,rr=null,Nn=!1,o!==null&&aA(u,o),u=Qu(u,A),u.flags|=4096;return u}return o=ws(o.child,{mode:A.mode,children:A.children}),o.ref=u.ref,u.child=o,o.return=u,o}function Zu(o,u){var m=u.ref;if(m===null)o!==null&&o.ref!==null&&(u.flags|=4194816);else{if(typeof m!="function"&&typeof m!="object")throw Error(n(284));(o===null||o.ref!==m)&&(u.flags|=4194816)}}function Hm(o,u,m,A,T){return Wr(u),m=Cm(o,u,m,A,void 0,T),A=Em(),o!==null&&!si?(Tm(o,u,T),Ds(o,u,T)):(lt&&A&&rm(u),u.flags|=1,Ti(o,u,m,T),u.child)}function bv(o,u,m,A,T,R){return Wr(u),u.updateQueue=null,m=CA(u,A,m,T),SA(o),A=Em(),o!==null&&!si?(Tm(o,u,R),Ds(o,u,R)):(lt&&A&&rm(u),u.flags|=1,Ti(o,u,m,R),u.child)}function wv(o,u,m,A,T){if(Wr(u),u.stateNode===null){var R=Ga,L=m.contextType;typeof L=="object"&&L!==null&&(R=Ei(L)),R=new m(A,R),u.memoizedState=R.state!==null&&R.state!==void 0?R.state:null,R.updater=jm,u.stateNode=R,R._reactInternals=u,R=u.stateNode,R.props=A,R.state=u.memoizedState,R.refs={},gm(u),L=m.contextType,R.context=typeof L=="object"&&L!==null?Ei(L):Ga,R.state=u.memoizedState,L=m.getDerivedStateFromProps,typeof L=="function"&&(Vm(u,m,L,A),R.state=u.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof R.getSnapshotBeforeUpdate=="function"||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(L=R.state,typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount(),L!==R.state&&jm.enqueueReplaceState(R,R.state,null),wl(u,A,R,T),bl(),R.state=u.memoizedState),typeof R.componentDidMount=="function"&&(u.flags|=4194308),A=!0}else if(o===null){R=u.stateNode;var z=u.memoizedProps,Z=ea(m,z);R.props=Z;var re=R.context,ue=m.contextType;L=Ga,typeof ue=="object"&&ue!==null&&(L=Ei(ue));var fe=m.getDerivedStateFromProps;ue=typeof fe=="function"||typeof R.getSnapshotBeforeUpdate=="function",z=u.pendingProps!==z,ue||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(z||re!==L)&&lv(u,R,A,L),lr=!1;var ae=u.memoizedState;R.state=ae,wl(u,A,R,T),bl(),re=u.memoizedState,z||ae!==re||lr?(typeof fe=="function"&&(Vm(u,m,fe,A),re=u.memoizedState),(Z=lr||ov(u,m,Z,A,ae,re,L))?(ue||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(u.flags|=4194308)):(typeof R.componentDidMount=="function"&&(u.flags|=4194308),u.memoizedProps=A,u.memoizedState=re),R.props=A,R.state=re,R.context=L,A=Z):(typeof R.componentDidMount=="function"&&(u.flags|=4194308),A=!1)}else{R=u.stateNode,Am(o,u),L=u.memoizedProps,ue=ea(m,L),R.props=ue,fe=u.pendingProps,ae=R.context,re=m.contextType,Z=Ga,typeof re=="object"&&re!==null&&(Z=Ei(re)),z=m.getDerivedStateFromProps,(re=typeof z=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(L!==fe||ae!==Z)&&lv(u,R,A,Z),lr=!1,ae=u.memoizedState,R.state=ae,wl(u,A,R,T),bl();var oe=u.memoizedState;L!==fe||ae!==oe||lr||o!==null&&o.dependencies!==null&&_u(o.dependencies)?(typeof z=="function"&&(Vm(u,m,z,A),oe=u.memoizedState),(ue=lr||ov(u,m,ue,A,ae,oe,Z)||o!==null&&o.dependencies!==null&&_u(o.dependencies))?(re||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(A,oe,Z),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(A,oe,Z)),typeof R.componentDidUpdate=="function"&&(u.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(u.flags|=1024)):(typeof R.componentDidUpdate!="function"||L===o.memoizedProps&&ae===o.memoizedState||(u.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||L===o.memoizedProps&&ae===o.memoizedState||(u.flags|=1024),u.memoizedProps=A,u.memoizedState=oe),R.props=A,R.state=oe,R.context=Z,A=ue):(typeof R.componentDidUpdate!="function"||L===o.memoizedProps&&ae===o.memoizedState||(u.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||L===o.memoizedProps&&ae===o.memoizedState||(u.flags|=1024),A=!1)}return R=A,Zu(o,u),A=(u.flags&128)!==0,R||A?(R=u.stateNode,m=A&&typeof m.getDerivedStateFromError!="function"?null:R.render(),u.flags|=1,o!==null&&A?(u.child=Jr(u,o.child,null,T),u.child=Jr(u,null,m,T)):Ti(o,u,m,T),u.memoizedState=R.state,o=u.child):o=Ds(o,u,T),o}function Sv(o,u,m,A){return qr(),u.flags|=256,Ti(o,u,m,A),u.child}var Ym={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function qm(o){return{baseLanes:o,cachePool:dA()}}function Xm(o,u,m){return o=o!==null?o.childLanes&~m:0,u&&(o|=hn),o}function Cv(o,u,m){var A=u.pendingProps,T=!1,R=(u.flags&128)!==0,L;if((L=R)||(L=o!==null&&o.memoizedState===null?!1:(Zt.current&2)!==0),L&&(T=!0,u.flags&=-129),L=(u.flags&32)!==0,u.flags&=-33,o===null){if(lt){if(T?hr(u):dr(),(o=Ft)?(o=_y(o,Nn),o=o!==null&&o.data!=="&"?o:null,o!==null&&(u.memoizedState={dehydrated:o,treeContext:sr!==null?{id:is,overflow:ns}:null,retryLane:536870912,hydrationErrors:null},m=nA(o),m.return=u,u.child=m,Ci=u,Ft=null)):o=null,o===null)throw ar(u);return Rp(o)?u.lanes=32:u.lanes=536870912,null}var z=A.children;return A=A.fallback,T?(dr(),T=u.mode,z=Ju({mode:"hidden",children:z},T),A=Yr(A,T,m,null),z.return=u,A.return=u,z.sibling=A,u.child=z,A=u.child,A.memoizedState=qm(m),A.childLanes=Xm(o,L,m),u.memoizedState=Ym,Ml(null,A)):(hr(u),Wm(u,z))}var Z=o.memoizedState;if(Z!==null&&(z=Z.dehydrated,z!==null)){if(R)u.flags&256?(hr(u),u.flags&=-257,u=Km(o,u,m)):u.memoizedState!==null?(dr(),u.child=o.child,u.flags|=128,u=null):(dr(),z=A.fallback,T=u.mode,A=Ju({mode:"visible",children:A.children},T),z=Yr(z,T,m,null),z.flags|=2,A.return=u,z.return=u,A.sibling=z,u.child=A,Jr(u,o.child,null,m),A=u.child,A.memoizedState=qm(m),A.childLanes=Xm(o,L,m),u.memoizedState=Ym,u=Ml(null,A));else if(hr(u),Rp(z)){if(L=z.nextSibling&&z.nextSibling.dataset,L)var re=L.dgst;L=re,A=Error(n(419)),A.stack="",A.digest=L,pl({value:A,source:null,stack:null}),u=Km(o,u,m)}else if(si||Xa(o,u,m,!1),L=(m&o.childLanes)!==0,si||L){if(L=Dt,L!==null&&(A=u2(L,m),A!==0&&A!==Z.retryLane))throw Z.retryLane=A,Hr(o,A),Zi(L,o,A),Gm;Dp(z)||oh(),u=Km(o,u,m)}else Dp(z)?(u.flags|=192,u.child=o.child,u=null):(o=Z.treeContext,Ft=_n(z.nextSibling),Ci=u,lt=!0,rr=null,Nn=!1,o!==null&&aA(u,o),u=Wm(u,A.children),u.flags|=4096);return u}return T?(dr(),z=A.fallback,T=u.mode,Z=o.child,re=Z.sibling,A=ws(Z,{mode:"hidden",children:A.children}),A.subtreeFlags=Z.subtreeFlags&65011712,re!==null?z=ws(re,z):(z=Yr(z,T,m,null),z.flags|=2),z.return=u,A.return=u,A.sibling=z,u.child=A,Ml(null,A),A=u.child,z=o.child.memoizedState,z===null?z=qm(m):(T=z.cachePool,T!==null?(Z=ii._currentValue,T=T.parent!==Z?{parent:Z,pool:Z}:T):T=dA(),z={baseLanes:z.baseLanes|m,cachePool:T}),A.memoizedState=z,A.childLanes=Xm(o,L,m),u.memoizedState=Ym,Ml(o.child,A)):(hr(u),m=o.child,o=m.sibling,m=ws(m,{mode:"visible",children:A.children}),m.return=u,m.sibling=null,o!==null&&(L=u.deletions,L===null?(u.deletions=[o],u.flags|=16):L.push(o)),u.child=m,u.memoizedState=null,m)}function Wm(o,u){return u=Ju({mode:"visible",children:u},o.mode),u.return=o,o.child=u}function Ju(o,u){return o=on(22,o,null,u),o.lanes=0,o}function Km(o,u,m){return Jr(u,o.child,null,m),o=Wm(u,u.pendingProps.children),o.flags|=2,u.memoizedState=null,o}function Ev(o,u,m){o.lanes|=u;var A=o.alternate;A!==null&&(A.lanes|=u),um(o.return,u,m)}function Qm(o,u,m,A,T,R){var L=o.memoizedState;L===null?o.memoizedState={isBackwards:u,rendering:null,renderingStartTime:0,last:A,tail:m,tailMode:T,treeForkCount:R}:(L.isBackwards=u,L.rendering=null,L.renderingStartTime=0,L.last=A,L.tail=m,L.tailMode=T,L.treeForkCount=R)}function Tv(o,u,m){var A=u.pendingProps,T=A.revealOrder,R=A.tail;A=A.children;var L=Zt.current,z=(L&2)!==0;if(z?(L=L&1|2,u.flags|=128):L&=1,K(Zt,L),Ti(o,u,A,m),A=lt?ml:0,!z&&o!==null&&(o.flags&128)!==0)e:for(o=u.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&Ev(o,m,u);else if(o.tag===19)Ev(o,m,u);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===u)break e;for(;o.sibling===null;){if(o.return===null||o.return===u)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}switch(T){case"forwards":for(m=u.child,T=null;m!==null;)o=m.alternate,o!==null&&Vu(o)===null&&(T=m),m=m.sibling;m=T,m===null?(T=u.child,u.child=null):(T=m.sibling,m.sibling=null),Qm(u,!1,T,m,R,A);break;case"backwards":case"unstable_legacy-backwards":for(m=null,T=u.child,u.child=null;T!==null;){if(o=T.alternate,o!==null&&Vu(o)===null){u.child=T;break}o=T.sibling,T.sibling=m,m=T,T=o}Qm(u,!0,m,null,R,A);break;case"together":Qm(u,!1,null,null,void 0,A);break;default:u.memoizedState=null}return u.child}function Ds(o,u,m){if(o!==null&&(u.dependencies=o.dependencies),pr|=u.lanes,(m&u.childLanes)===0)if(o!==null){if(Xa(o,u,m,!1),(m&u.childLanes)===0)return null}else return null;if(o!==null&&u.child!==o.child)throw Error(n(153));if(u.child!==null){for(o=u.child,m=ws(o,o.pendingProps),u.child=m,m.return=u;o.sibling!==null;)o=o.sibling,m=m.sibling=ws(o,o.pendingProps),m.return=u;m.sibling=null}return u.child}function Zm(o,u){return(o.lanes&u)!==0?!0:(o=o.dependencies,!!(o!==null&&_u(o)))}function IC(o,u,m){switch(u.tag){case 3:xe(u,u.stateNode.containerInfo),or(u,ii,o.memoizedState.cache),qr();break;case 27:case 5:Me(u);break;case 4:xe(u,u.stateNode.containerInfo);break;case 10:or(u,u.type,u.memoizedProps.value);break;case 31:if(u.memoizedState!==null)return u.flags|=128,wm(u),null;break;case 13:var A=u.memoizedState;if(A!==null)return A.dehydrated!==null?(hr(u),u.flags|=128,null):(m&u.child.childLanes)!==0?Cv(o,u,m):(hr(u),o=Ds(o,u,m),o!==null?o.sibling:null);hr(u);break;case 19:var T=(o.flags&128)!==0;if(A=(m&u.childLanes)!==0,A||(Xa(o,u,m,!1),A=(m&u.childLanes)!==0),T){if(A)return Tv(o,u,m);u.flags|=128}if(T=u.memoizedState,T!==null&&(T.rendering=null,T.tail=null,T.lastEffect=null),K(Zt,Zt.current),A)break;return null;case 22:return u.lanes=0,vv(o,u,m,u.pendingProps);case 24:or(u,ii,o.memoizedState.cache)}return Ds(o,u,m)}function Mv(o,u,m){if(o!==null)if(o.memoizedProps!==u.pendingProps)si=!0;else{if(!Zm(o,m)&&(u.flags&128)===0)return si=!1,IC(o,u,m);si=(o.flags&131072)!==0}else si=!1,lt&&(u.flags&1048576)!==0&&rA(u,ml,u.index);switch(u.lanes=0,u.tag){case 16:e:{var A=u.pendingProps;if(o=Qr(u.elementType),u.type=o,typeof o=="function")im(o)?(A=ea(o,A),u.tag=1,u=wv(null,u,o,A,m)):(u.tag=0,u=Hm(null,u,o,A,m));else{if(o!=null){var T=o.$$typeof;if(T===E){u.tag=11,u=pv(null,u,o,A,m);break e}else if(T===N){u.tag=14,u=gv(null,u,o,A,m);break e}}throw u=k(o)||o,Error(n(306,u,""))}}return u;case 0:return Hm(o,u,u.type,u.pendingProps,m);case 1:return A=u.type,T=ea(A,u.pendingProps),wv(o,u,A,T,m);case 3:e:{if(xe(u,u.stateNode.containerInfo),o===null)throw Error(n(387));A=u.pendingProps;var R=u.memoizedState;T=R.element,Am(o,u),wl(u,A,null,m);var L=u.memoizedState;if(A=L.cache,or(u,ii,A),A!==R.cache&&hm(u,[ii],m,!0),bl(),A=L.element,R.isDehydrated)if(R={element:A,isDehydrated:!1,cache:L.cache},u.updateQueue.baseState=R,u.memoizedState=R,u.flags&256){u=Sv(o,u,A,m);break e}else if(A!==T){T=Mn(Error(n(424)),u),pl(T),u=Sv(o,u,A,m);break e}else for(o=u.stateNode.containerInfo,o.nodeType===9?o=o.body:o=o.nodeName==="HTML"?o.ownerDocument.body:o,Ft=_n(o.firstChild),Ci=u,lt=!0,rr=null,Nn=!0,m=vA(u,null,A,m),u.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling;else{if(qr(),A===T){u=Ds(o,u,m);break e}Ti(o,u,A,m)}u=u.child}return u;case 26:return Zu(o,u),o===null?(m=Oy(u.type,null,u.pendingProps,null))?u.memoizedState=m:lt||(m=u.type,o=u.pendingProps,A=mh(he.current).createElement(m),A[Si]=u,A[Yi]=o,Mi(A,m,o),di(A),u.stateNode=A):u.memoizedState=Oy(u.type,o.memoizedProps,u.pendingProps,o.memoizedState),null;case 27:return Me(u),o===null&&lt&&(A=u.stateNode=By(u.type,u.pendingProps,he.current),Ci=u,Nn=!0,T=Ft,xr(u.type)?(Np=T,Ft=_n(A.firstChild)):Ft=T),Ti(o,u,u.pendingProps.children,m),Zu(o,u),o===null&&(u.flags|=4194304),u.child;case 5:return o===null&&lt&&((T=A=Ft)&&(A=oE(A,u.type,u.pendingProps,Nn),A!==null?(u.stateNode=A,Ci=u,Ft=_n(A.firstChild),Nn=!1,T=!0):T=!1),T||ar(u)),Me(u),T=u.type,R=u.pendingProps,L=o!==null?o.memoizedProps:null,A=R.children,Ep(T,R)?A=null:L!==null&&Ep(T,L)&&(u.flags|=32),u.memoizedState!==null&&(T=Cm(o,u,wC,null,null,m),zl._currentValue=T),Zu(o,u),Ti(o,u,A,m),u.child;case 6:return o===null&&lt&&((o=m=Ft)&&(m=lE(m,u.pendingProps,Nn),m!==null?(u.stateNode=m,Ci=u,Ft=null,o=!0):o=!1),o||ar(u)),null;case 13:return Cv(o,u,m);case 4:return xe(u,u.stateNode.containerInfo),A=u.pendingProps,o===null?u.child=Jr(u,null,A,m):Ti(o,u,A,m),u.child;case 11:return pv(o,u,u.type,u.pendingProps,m);case 7:return Ti(o,u,u.pendingProps,m),u.child;case 8:return Ti(o,u,u.pendingProps.children,m),u.child;case 12:return Ti(o,u,u.pendingProps.children,m),u.child;case 10:return A=u.pendingProps,or(u,u.type,A.value),Ti(o,u,A.children,m),u.child;case 9:return T=u.type._context,A=u.pendingProps.children,Wr(u),T=Ei(T),A=A(T),u.flags|=1,Ti(o,u,A,m),u.child;case 14:return gv(o,u,u.type,u.pendingProps,m);case 15:return Av(o,u,u.type,u.pendingProps,m);case 19:return Tv(o,u,m);case 31:return NC(o,u,m);case 22:return vv(o,u,m,u.pendingProps);case 24:return Wr(u),A=Ei(ii),o===null?(T=mm(),T===null&&(T=Dt,R=dm(),T.pooledCache=R,R.refCount++,R!==null&&(T.pooledCacheLanes|=m),T=R),u.memoizedState={parent:A,cache:T},gm(u),or(u,ii,T)):((o.lanes&m)!==0&&(Am(o,u),wl(u,null,null,m),bl()),T=o.memoizedState,R=u.memoizedState,T.parent!==A?(T={parent:A,cache:A},u.memoizedState=T,u.lanes===0&&(u.memoizedState=u.updateQueue.baseState=T),or(u,ii,A)):(A=R.cache,or(u,ii,A),A!==T.cache&&hm(u,[ii],m,!0))),Ti(o,u,u.pendingProps.children,m),u.child;case 29:throw u.pendingProps}throw Error(n(156,u.tag))}function Rs(o){o.flags|=4}function Jm(o,u,m,A,T){if((u=(o.mode&32)!==0)&&(u=!1),u){if(o.flags|=16777216,(T&335544128)===T)if(o.stateNode.complete)o.flags|=8192;else if(ey())o.flags|=8192;else throw Zr=Lu,pm}else o.flags&=-16777217}function Dv(o,u){if(u.type!=="stylesheet"||(u.state.loading&4)!==0)o.flags&=-16777217;else if(o.flags|=16777216,!Gy(u))if(ey())o.flags|=8192;else throw Zr=Lu,pm}function $u(o,u){u!==null&&(o.flags|=4),o.flags&16384&&(u=o.tag!==22?o2():536870912,o.lanes|=u,ro|=u)}function Dl(o,u){if(!lt)switch(o.tailMode){case"hidden":u=o.tail;for(var m=null;u!==null;)u.alternate!==null&&(m=u),u=u.sibling;m===null?o.tail=null:m.sibling=null;break;case"collapsed":m=o.tail;for(var A=null;m!==null;)m.alternate!==null&&(A=m),m=m.sibling;A===null?u||o.tail===null?o.tail=null:o.tail.sibling=null:A.sibling=null}}function Pt(o){var u=o.alternate!==null&&o.alternate.child===o.child,m=0,A=0;if(u)for(var T=o.child;T!==null;)m|=T.lanes|T.childLanes,A|=T.subtreeFlags&65011712,A|=T.flags&65011712,T.return=o,T=T.sibling;else for(T=o.child;T!==null;)m|=T.lanes|T.childLanes,A|=T.subtreeFlags,A|=T.flags,T.return=o,T=T.sibling;return o.subtreeFlags|=A,o.childLanes=m,u}function _C(o,u,m){var A=u.pendingProps;switch(am(u),u.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pt(u),null;case 1:return Pt(u),null;case 3:return m=u.stateNode,A=null,o!==null&&(A=o.memoizedState.cache),u.memoizedState.cache!==A&&(u.flags|=2048),Es(ii),ge(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(o===null||o.child===null)&&(qa(u)?Rs(u):o===null||o.memoizedState.isDehydrated&&(u.flags&256)===0||(u.flags|=1024,lm())),Pt(u),null;case 26:var T=u.type,R=u.memoizedState;return o===null?(Rs(u),R!==null?(Pt(u),Dv(u,R)):(Pt(u),Jm(u,T,null,A,m))):R?R!==o.memoizedState?(Rs(u),Pt(u),Dv(u,R)):(Pt(u),u.flags&=-16777217):(o=o.memoizedProps,o!==A&&Rs(u),Pt(u),Jm(u,T,o,A,m)),null;case 27:if(Ie(u),m=he.current,T=u.type,o!==null&&u.stateNode!=null)o.memoizedProps!==A&&Rs(u);else{if(!A){if(u.stateNode===null)throw Error(n(166));return Pt(u),null}o=ee.current,qa(u)?oA(u):(o=By(T,A,m),u.stateNode=o,Rs(u))}return Pt(u),null;case 5:if(Ie(u),T=u.type,o!==null&&u.stateNode!=null)o.memoizedProps!==A&&Rs(u);else{if(!A){if(u.stateNode===null)throw Error(n(166));return Pt(u),null}if(R=ee.current,qa(u))oA(u);else{var L=mh(he.current);switch(R){case 1:R=L.createElementNS("http://www.w3.org/2000/svg",T);break;case 2:R=L.createElementNS("http://www.w3.org/1998/Math/MathML",T);break;default:switch(T){case"svg":R=L.createElementNS("http://www.w3.org/2000/svg",T);break;case"math":R=L.createElementNS("http://www.w3.org/1998/Math/MathML",T);break;case"script":R=L.createElement("div"),R.innerHTML="<script><\/script>",R=R.removeChild(R.firstChild);break;case"select":R=typeof A.is=="string"?L.createElement("select",{is:A.is}):L.createElement("select"),A.multiple?R.multiple=!0:A.size&&(R.size=A.size);break;default:R=typeof A.is=="string"?L.createElement(T,{is:A.is}):L.createElement(T)}}R[Si]=u,R[Yi]=A;e:for(L=u.child;L!==null;){if(L.tag===5||L.tag===6)R.appendChild(L.stateNode);else if(L.tag!==4&&L.tag!==27&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===u)break e;for(;L.sibling===null;){if(L.return===null||L.return===u)break e;L=L.return}L.sibling.return=L.return,L=L.sibling}u.stateNode=R;e:switch(Mi(R,T,A),T){case"button":case"input":case"select":case"textarea":A=!!A.autoFocus;break e;case"img":A=!0;break e;default:A=!1}A&&Rs(u)}}return Pt(u),Jm(u,u.type,o===null?null:o.memoizedProps,u.pendingProps,m),null;case 6:if(o&&u.stateNode!=null)o.memoizedProps!==A&&Rs(u);else{if(typeof A!="string"&&u.stateNode===null)throw Error(n(166));if(o=he.current,qa(u)){if(o=u.stateNode,m=u.memoizedProps,A=null,T=Ci,T!==null)switch(T.tag){case 27:case 5:A=T.memoizedProps}o[Si]=u,o=!!(o.nodeValue===m||A!==null&&A.suppressHydrationWarning===!0||Cy(o.nodeValue,m)),o||ar(u,!0)}else o=mh(o).createTextNode(A),o[Si]=u,u.stateNode=o}return Pt(u),null;case 31:if(m=u.memoizedState,o===null||o.memoizedState!==null){if(A=qa(u),m!==null){if(o===null){if(!A)throw Error(n(318));if(o=u.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(557));o[Si]=u}else qr(),(u.flags&128)===0&&(u.memoizedState=null),u.flags|=4;Pt(u),o=!1}else m=lm(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=m),o=!0;if(!o)return u.flags&256?(cn(u),u):(cn(u),null);if((u.flags&128)!==0)throw Error(n(558))}return Pt(u),null;case 13:if(A=u.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(T=qa(u),A!==null&&A.dehydrated!==null){if(o===null){if(!T)throw Error(n(318));if(T=u.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(n(317));T[Si]=u}else qr(),(u.flags&128)===0&&(u.memoizedState=null),u.flags|=4;Pt(u),T=!1}else T=lm(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=T),T=!0;if(!T)return u.flags&256?(cn(u),u):(cn(u),null)}return cn(u),(u.flags&128)!==0?(u.lanes=m,u):(m=A!==null,o=o!==null&&o.memoizedState!==null,m&&(A=u.child,T=null,A.alternate!==null&&A.alternate.memoizedState!==null&&A.alternate.memoizedState.cachePool!==null&&(T=A.alternate.memoizedState.cachePool.pool),R=null,A.memoizedState!==null&&A.memoizedState.cachePool!==null&&(R=A.memoizedState.cachePool.pool),R!==T&&(A.flags|=2048)),m!==o&&m&&(u.child.flags|=8192),$u(u,u.updateQueue),Pt(u),null);case 4:return ge(),o===null&&xp(u.stateNode.containerInfo),Pt(u),null;case 10:return Es(u.type),Pt(u),null;case 19:if(W(Zt),A=u.memoizedState,A===null)return Pt(u),null;if(T=(u.flags&128)!==0,R=A.rendering,R===null)if(T)Dl(A,!1);else{if(Wt!==0||o!==null&&(o.flags&128)!==0)for(o=u.child;o!==null;){if(R=Vu(o),R!==null){for(u.flags|=128,Dl(A,!1),o=R.updateQueue,u.updateQueue=o,$u(u,o),u.subtreeFlags=0,o=m,m=u.child;m!==null;)iA(m,o),m=m.sibling;return K(Zt,Zt.current&1|2),lt&&Ss(u,A.treeForkCount),u.child}o=o.sibling}A.tail!==null&&wi()>sh&&(u.flags|=128,T=!0,Dl(A,!1),u.lanes=4194304)}else{if(!T)if(o=Vu(R),o!==null){if(u.flags|=128,T=!0,o=o.updateQueue,u.updateQueue=o,$u(u,o),Dl(A,!0),A.tail===null&&A.tailMode==="hidden"&&!R.alternate&&!lt)return Pt(u),null}else 2*wi()-A.renderingStartTime>sh&&m!==536870912&&(u.flags|=128,T=!0,Dl(A,!1),u.lanes=4194304);A.isBackwards?(R.sibling=u.child,u.child=R):(o=A.last,o!==null?o.sibling=R:u.child=R,A.last=R)}return A.tail!==null?(o=A.tail,A.rendering=o,A.tail=o.sibling,A.renderingStartTime=wi(),o.sibling=null,m=Zt.current,K(Zt,T?m&1|2:m&1),lt&&Ss(u,A.treeForkCount),o):(Pt(u),null);case 22:case 23:return cn(u),bm(),A=u.memoizedState!==null,o!==null?o.memoizedState!==null!==A&&(u.flags|=8192):A&&(u.flags|=8192),A?(m&536870912)!==0&&(u.flags&128)===0&&(Pt(u),u.subtreeFlags&6&&(u.flags|=8192)):Pt(u),m=u.updateQueue,m!==null&&$u(u,m.retryQueue),m=null,o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(m=o.memoizedState.cachePool.pool),A=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(A=u.memoizedState.cachePool.pool),A!==m&&(u.flags|=2048),o!==null&&W(Kr),null;case 24:return m=null,o!==null&&(m=o.memoizedState.cache),u.memoizedState.cache!==m&&(u.flags|=2048),Es(ii),Pt(u),null;case 25:return null;case 30:return null}throw Error(n(156,u.tag))}function FC(o,u){switch(am(u),u.tag){case 1:return o=u.flags,o&65536?(u.flags=o&-65537|128,u):null;case 3:return Es(ii),ge(),o=u.flags,(o&65536)!==0&&(o&128)===0?(u.flags=o&-65537|128,u):null;case 26:case 27:case 5:return Ie(u),null;case 31:if(u.memoizedState!==null){if(cn(u),u.alternate===null)throw Error(n(340));qr()}return o=u.flags,o&65536?(u.flags=o&-65537|128,u):null;case 13:if(cn(u),o=u.memoizedState,o!==null&&o.dehydrated!==null){if(u.alternate===null)throw Error(n(340));qr()}return o=u.flags,o&65536?(u.flags=o&-65537|128,u):null;case 19:return W(Zt),null;case 4:return ge(),null;case 10:return Es(u.type),null;case 22:case 23:return cn(u),bm(),o!==null&&W(Kr),o=u.flags,o&65536?(u.flags=o&-65537|128,u):null;case 24:return Es(ii),null;case 25:return null;default:return null}}function Rv(o,u){switch(am(u),u.tag){case 3:Es(ii),ge();break;case 26:case 27:case 5:Ie(u);break;case 4:ge();break;case 31:u.memoizedState!==null&&cn(u);break;case 13:cn(u);break;case 19:W(Zt);break;case 10:Es(u.type);break;case 22:case 23:cn(u),bm(),o!==null&&W(Kr);break;case 24:Es(ii)}}function Rl(o,u){try{var m=u.updateQueue,A=m!==null?m.lastEffect:null;if(A!==null){var T=A.next;m=T;do{if((m.tag&o)===o){A=void 0;var R=m.create,L=m.inst;A=R(),L.destroy=A}m=m.next}while(m!==T)}}catch(z){St(u,u.return,z)}}function fr(o,u,m){try{var A=u.updateQueue,T=A!==null?A.lastEffect:null;if(T!==null){var R=T.next;A=R;do{if((A.tag&o)===o){var L=A.inst,z=L.destroy;if(z!==void 0){L.destroy=void 0,T=u;var Z=m,re=z;try{re()}catch(ue){St(T,Z,ue)}}}A=A.next}while(A!==R)}}catch(ue){St(u,u.return,ue)}}function Nv(o){var u=o.updateQueue;if(u!==null){var m=o.stateNode;try{xA(u,m)}catch(A){St(o,o.return,A)}}}function Iv(o,u,m){m.props=ea(o.type,o.memoizedProps),m.state=o.memoizedState;try{m.componentWillUnmount()}catch(A){St(o,u,A)}}function Nl(o,u){try{var m=o.ref;if(m!==null){switch(o.tag){case 26:case 27:case 5:var A=o.stateNode;break;case 30:A=o.stateNode;break;default:A=o.stateNode}typeof m=="function"?o.refCleanup=m(A):m.current=A}}catch(T){St(o,u,T)}}function ss(o,u){var m=o.ref,A=o.refCleanup;if(m!==null)if(typeof A=="function")try{A()}catch(T){St(o,u,T)}finally{o.refCleanup=null,o=o.alternate,o!=null&&(o.refCleanup=null)}else if(typeof m=="function")try{m(null)}catch(T){St(o,u,T)}else m.current=null}function _v(o){var u=o.type,m=o.memoizedProps,A=o.stateNode;try{e:switch(u){case"button":case"input":case"select":case"textarea":m.autoFocus&&A.focus();break e;case"img":m.src?A.src=m.src:m.srcSet&&(A.srcset=m.srcSet)}}catch(T){St(o,o.return,T)}}function $m(o,u,m){try{var A=o.stateNode;tE(A,o.type,m,u),A[Yi]=u}catch(T){St(o,o.return,T)}}function Fv(o){return o.tag===5||o.tag===3||o.tag===26||o.tag===27&&xr(o.type)||o.tag===4}function ep(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||Fv(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.tag===27&&xr(o.type)||o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function tp(o,u,m){var A=o.tag;if(A===5||A===6)o=o.stateNode,u?(m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m).insertBefore(o,u):(u=m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m,u.appendChild(o),m=m._reactRootContainer,m!=null||u.onclick!==null||(u.onclick=xs));else if(A!==4&&(A===27&&xr(o.type)&&(m=o.stateNode,u=null),o=o.child,o!==null))for(tp(o,u,m),o=o.sibling;o!==null;)tp(o,u,m),o=o.sibling}function eh(o,u,m){var A=o.tag;if(A===5||A===6)o=o.stateNode,u?m.insertBefore(o,u):m.appendChild(o);else if(A!==4&&(A===27&&xr(o.type)&&(m=o.stateNode),o=o.child,o!==null))for(eh(o,u,m),o=o.sibling;o!==null;)eh(o,u,m),o=o.sibling}function Pv(o){var u=o.stateNode,m=o.memoizedProps;try{for(var A=o.type,T=u.attributes;T.length;)u.removeAttributeNode(T[0]);Mi(u,A,m),u[Si]=o,u[Yi]=m}catch(R){St(o,o.return,R)}}var Ns=!1,ri=!1,ip=!1,Bv=typeof WeakSet=="function"?WeakSet:Set,fi=null;function PC(o,u){if(o=o.containerInfo,Sp=bh,o=X2(o),Kf(o)){if("selectionStart"in o)var m={start:o.selectionStart,end:o.selectionEnd};else e:{m=(m=o.ownerDocument)&&m.defaultView||window;var A=m.getSelection&&m.getSelection();if(A&&A.rangeCount!==0){m=A.anchorNode;var T=A.anchorOffset,R=A.focusNode;A=A.focusOffset;try{m.nodeType,R.nodeType}catch{m=null;break e}var L=0,z=-1,Z=-1,re=0,ue=0,fe=o,ae=null;t:for(;;){for(var oe;fe!==m||T!==0&&fe.nodeType!==3||(z=L+T),fe!==R||A!==0&&fe.nodeType!==3||(Z=L+A),fe.nodeType===3&&(L+=fe.nodeValue.length),(oe=fe.firstChild)!==null;)ae=fe,fe=oe;for(;;){if(fe===o)break t;if(ae===m&&++re===T&&(z=L),ae===R&&++ue===A&&(Z=L),(oe=fe.nextSibling)!==null)break;fe=ae,ae=fe.parentNode}fe=oe}m=z===-1||Z===-1?null:{start:z,end:Z}}else m=null}m=m||{start:0,end:0}}else m=null;for(Cp={focusedElem:o,selectionRange:m},bh=!1,fi=u;fi!==null;)if(u=fi,o=u.child,(u.subtreeFlags&1028)!==0&&o!==null)o.return=u,fi=o;else for(;fi!==null;){switch(u=fi,R=u.alternate,o=u.flags,u.tag){case 0:if((o&4)!==0&&(o=u.updateQueue,o=o!==null?o.events:null,o!==null))for(m=0;m<o.length;m++)T=o[m],T.ref.impl=T.nextImpl;break;case 11:case 15:break;case 1:if((o&1024)!==0&&R!==null){o=void 0,m=u,T=R.memoizedProps,R=R.memoizedState,A=m.stateNode;try{var Ee=ea(m.type,T);o=A.getSnapshotBeforeUpdate(Ee,R),A.__reactInternalSnapshotBeforeUpdate=o}catch(Oe){St(m,m.return,Oe)}}break;case 3:if((o&1024)!==0){if(o=u.stateNode.containerInfo,m=o.nodeType,m===9)Mp(o);else if(m===1)switch(o.nodeName){case"HEAD":case"HTML":case"BODY":Mp(o);break;default:o.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((o&1024)!==0)throw Error(n(163))}if(o=u.sibling,o!==null){o.return=u.return,fi=o;break}fi=u.return}}function Lv(o,u,m){var A=m.flags;switch(m.tag){case 0:case 11:case 15:_s(o,m),A&4&&Rl(5,m);break;case 1:if(_s(o,m),A&4)if(o=m.stateNode,u===null)try{o.componentDidMount()}catch(L){St(m,m.return,L)}else{var T=ea(m.type,u.memoizedProps);u=u.memoizedState;try{o.componentDidUpdate(T,u,o.__reactInternalSnapshotBeforeUpdate)}catch(L){St(m,m.return,L)}}A&64&&Nv(m),A&512&&Nl(m,m.return);break;case 3:if(_s(o,m),A&64&&(o=m.updateQueue,o!==null)){if(u=null,m.child!==null)switch(m.child.tag){case 27:case 5:u=m.child.stateNode;break;case 1:u=m.child.stateNode}try{xA(o,u)}catch(L){St(m,m.return,L)}}break;case 27:u===null&&A&4&&Pv(m);case 26:case 5:_s(o,m),u===null&&A&4&&_v(m),A&512&&Nl(m,m.return);break;case 12:_s(o,m);break;case 31:_s(o,m),A&4&&Uv(o,m);break;case 13:_s(o,m),A&4&&Vv(o,m),A&64&&(o=m.memoizedState,o!==null&&(o=o.dehydrated,o!==null&&(m=GC.bind(null,m),cE(o,m))));break;case 22:if(A=m.memoizedState!==null||Ns,!A){u=u!==null&&u.memoizedState!==null||ri,T=Ns;var R=ri;Ns=A,(ri=u)&&!R?Fs(o,m,(m.subtreeFlags&8772)!==0):_s(o,m),Ns=T,ri=R}break;case 30:break;default:_s(o,m)}}function kv(o){var u=o.alternate;u!==null&&(o.alternate=null,kv(u)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(u=o.stateNode,u!==null&&_f(u)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}var kt=null,Xi=!1;function Is(o,u,m){for(m=m.child;m!==null;)Ov(o,u,m),m=m.sibling}function Ov(o,u,m){if(ke&&typeof ke.onCommitFiberUnmount=="function")try{ke.onCommitFiberUnmount(Le,m)}catch{}switch(m.tag){case 26:ri||ss(m,u),Is(o,u,m),m.memoizedState?m.memoizedState.count--:m.stateNode&&(m=m.stateNode,m.parentNode.removeChild(m));break;case 27:ri||ss(m,u);var A=kt,T=Xi;xr(m.type)&&(kt=m.stateNode,Xi=!1),Is(o,u,m),Ul(m.stateNode),kt=A,Xi=T;break;case 5:ri||ss(m,u);case 6:if(A=kt,T=Xi,kt=null,Is(o,u,m),kt=A,Xi=T,kt!==null)if(Xi)try{(kt.nodeType===9?kt.body:kt.nodeName==="HTML"?kt.ownerDocument.body:kt).removeChild(m.stateNode)}catch(R){St(m,u,R)}else try{kt.removeChild(m.stateNode)}catch(R){St(m,u,R)}break;case 18:kt!==null&&(Xi?(o=kt,Ny(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,m.stateNode),mo(o)):Ny(kt,m.stateNode));break;case 4:A=kt,T=Xi,kt=m.stateNode.containerInfo,Xi=!0,Is(o,u,m),kt=A,Xi=T;break;case 0:case 11:case 14:case 15:fr(2,m,u),ri||fr(4,m,u),Is(o,u,m);break;case 1:ri||(ss(m,u),A=m.stateNode,typeof A.componentWillUnmount=="function"&&Iv(m,u,A)),Is(o,u,m);break;case 21:Is(o,u,m);break;case 22:ri=(A=ri)||m.memoizedState!==null,Is(o,u,m),ri=A;break;default:Is(o,u,m)}}function Uv(o,u){if(u.memoizedState===null&&(o=u.alternate,o!==null&&(o=o.memoizedState,o!==null))){o=o.dehydrated;try{mo(o)}catch(m){St(u,u.return,m)}}}function Vv(o,u){if(u.memoizedState===null&&(o=u.alternate,o!==null&&(o=o.memoizedState,o!==null&&(o=o.dehydrated,o!==null))))try{mo(o)}catch(m){St(u,u.return,m)}}function BC(o){switch(o.tag){case 31:case 13:case 19:var u=o.stateNode;return u===null&&(u=o.stateNode=new Bv),u;case 22:return o=o.stateNode,u=o._retryCache,u===null&&(u=o._retryCache=new Bv),u;default:throw Error(n(435,o.tag))}}function th(o,u){var m=BC(o);u.forEach(function(A){if(!m.has(A)){m.add(A);var T=HC.bind(null,o,A);A.then(T,T)}})}function Wi(o,u){var m=u.deletions;if(m!==null)for(var A=0;A<m.length;A++){var T=m[A],R=o,L=u,z=L;e:for(;z!==null;){switch(z.tag){case 27:if(xr(z.type)){kt=z.stateNode,Xi=!1;break e}break;case 5:kt=z.stateNode,Xi=!1;break e;case 3:case 4:kt=z.stateNode.containerInfo,Xi=!0;break e}z=z.return}if(kt===null)throw Error(n(160));Ov(R,L,T),kt=null,Xi=!1,R=T.alternate,R!==null&&(R.return=null),T.return=null}if(u.subtreeFlags&13886)for(u=u.child;u!==null;)jv(u,o),u=u.sibling}var qn=null;function jv(o,u){var m=o.alternate,A=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:Wi(u,o),Ki(o),A&4&&(fr(3,o,o.return),Rl(3,o),fr(5,o,o.return));break;case 1:Wi(u,o),Ki(o),A&512&&(ri||m===null||ss(m,m.return)),A&64&&Ns&&(o=o.updateQueue,o!==null&&(A=o.callbacks,A!==null&&(m=o.shared.hiddenCallbacks,o.shared.hiddenCallbacks=m===null?A:m.concat(A))));break;case 26:var T=qn;if(Wi(u,o),Ki(o),A&512&&(ri||m===null||ss(m,m.return)),A&4){var R=m!==null?m.memoizedState:null;if(A=o.memoizedState,m===null)if(A===null)if(o.stateNode===null){e:{A=o.type,m=o.memoizedProps,T=T.ownerDocument||T;t:switch(A){case"title":R=T.getElementsByTagName("title")[0],(!R||R[nl]||R[Si]||R.namespaceURI==="http://www.w3.org/2000/svg"||R.hasAttribute("itemprop"))&&(R=T.createElement(A),T.head.insertBefore(R,T.querySelector("head > title"))),Mi(R,A,m),R[Si]=o,di(R),A=R;break e;case"link":var L=jy("link","href",T).get(A+(m.href||""));if(L){for(var z=0;z<L.length;z++)if(R=L[z],R.getAttribute("href")===(m.href==null||m.href===""?null:m.href)&&R.getAttribute("rel")===(m.rel==null?null:m.rel)&&R.getAttribute("title")===(m.title==null?null:m.title)&&R.getAttribute("crossorigin")===(m.crossOrigin==null?null:m.crossOrigin)){L.splice(z,1);break t}}R=T.createElement(A),Mi(R,A,m),T.head.appendChild(R);break;case"meta":if(L=jy("meta","content",T).get(A+(m.content||""))){for(z=0;z<L.length;z++)if(R=L[z],R.getAttribute("content")===(m.content==null?null:""+m.content)&&R.getAttribute("name")===(m.name==null?null:m.name)&&R.getAttribute("property")===(m.property==null?null:m.property)&&R.getAttribute("http-equiv")===(m.httpEquiv==null?null:m.httpEquiv)&&R.getAttribute("charset")===(m.charSet==null?null:m.charSet)){L.splice(z,1);break t}}R=T.createElement(A),Mi(R,A,m),T.head.appendChild(R);break;default:throw Error(n(468,A))}R[Si]=o,di(R),A=R}o.stateNode=A}else zy(T,o.type,o.stateNode);else o.stateNode=Vy(T,A,o.memoizedProps);else R!==A?(R===null?m.stateNode!==null&&(m=m.stateNode,m.parentNode.removeChild(m)):R.count--,A===null?zy(T,o.type,o.stateNode):Vy(T,A,o.memoizedProps)):A===null&&o.stateNode!==null&&$m(o,o.memoizedProps,m.memoizedProps)}break;case 27:Wi(u,o),Ki(o),A&512&&(ri||m===null||ss(m,m.return)),m!==null&&A&4&&$m(o,o.memoizedProps,m.memoizedProps);break;case 5:if(Wi(u,o),Ki(o),A&512&&(ri||m===null||ss(m,m.return)),o.flags&32){T=o.stateNode;try{La(T,"")}catch(Ee){St(o,o.return,Ee)}}A&4&&o.stateNode!=null&&(T=o.memoizedProps,$m(o,T,m!==null?m.memoizedProps:T)),A&1024&&(ip=!0);break;case 6:if(Wi(u,o),Ki(o),A&4){if(o.stateNode===null)throw Error(n(162));A=o.memoizedProps,m=o.stateNode;try{m.nodeValue=A}catch(Ee){St(o,o.return,Ee)}}break;case 3:if(Ah=null,T=qn,qn=ph(u.containerInfo),Wi(u,o),qn=T,Ki(o),A&4&&m!==null&&m.memoizedState.isDehydrated)try{mo(u.containerInfo)}catch(Ee){St(o,o.return,Ee)}ip&&(ip=!1,zv(o));break;case 4:A=qn,qn=ph(o.stateNode.containerInfo),Wi(u,o),Ki(o),qn=A;break;case 12:Wi(u,o),Ki(o);break;case 31:Wi(u,o),Ki(o),A&4&&(A=o.updateQueue,A!==null&&(o.updateQueue=null,th(o,A)));break;case 13:Wi(u,o),Ki(o),o.child.flags&8192&&o.memoizedState!==null!=(m!==null&&m.memoizedState!==null)&&(nh=wi()),A&4&&(A=o.updateQueue,A!==null&&(o.updateQueue=null,th(o,A)));break;case 22:T=o.memoizedState!==null;var Z=m!==null&&m.memoizedState!==null,re=Ns,ue=ri;if(Ns=re||T,ri=ue||Z,Wi(u,o),ri=ue,Ns=re,Ki(o),A&8192)e:for(u=o.stateNode,u._visibility=T?u._visibility&-2:u._visibility|1,T&&(m===null||Z||Ns||ri||ta(o)),m=null,u=o;;){if(u.tag===5||u.tag===26){if(m===null){Z=m=u;try{if(R=Z.stateNode,T)L=R.style,typeof L.setProperty=="function"?L.setProperty("display","none","important"):L.display="none";else{z=Z.stateNode;var fe=Z.memoizedProps.style,ae=fe!=null&&fe.hasOwnProperty("display")?fe.display:null;z.style.display=ae==null||typeof ae=="boolean"?"":(""+ae).trim()}}catch(Ee){St(Z,Z.return,Ee)}}}else if(u.tag===6){if(m===null){Z=u;try{Z.stateNode.nodeValue=T?"":Z.memoizedProps}catch(Ee){St(Z,Z.return,Ee)}}}else if(u.tag===18){if(m===null){Z=u;try{var oe=Z.stateNode;T?Iy(oe,!0):Iy(Z.stateNode,!1)}catch(Ee){St(Z,Z.return,Ee)}}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===o)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===o)break e;for(;u.sibling===null;){if(u.return===null||u.return===o)break e;m===u&&(m=null),u=u.return}m===u&&(m=null),u.sibling.return=u.return,u=u.sibling}A&4&&(A=o.updateQueue,A!==null&&(m=A.retryQueue,m!==null&&(A.retryQueue=null,th(o,m))));break;case 19:Wi(u,o),Ki(o),A&4&&(A=o.updateQueue,A!==null&&(o.updateQueue=null,th(o,A)));break;case 30:break;case 21:break;default:Wi(u,o),Ki(o)}}function Ki(o){var u=o.flags;if(u&2){try{for(var m,A=o.return;A!==null;){if(Fv(A)){m=A;break}A=A.return}if(m==null)throw Error(n(160));switch(m.tag){case 27:var T=m.stateNode,R=ep(o);eh(o,R,T);break;case 5:var L=m.stateNode;m.flags&32&&(La(L,""),m.flags&=-33);var z=ep(o);eh(o,z,L);break;case 3:case 4:var Z=m.stateNode.containerInfo,re=ep(o);tp(o,re,Z);break;default:throw Error(n(161))}}catch(ue){St(o,o.return,ue)}o.flags&=-3}u&4096&&(o.flags&=-4097)}function zv(o){if(o.subtreeFlags&1024)for(o=o.child;o!==null;){var u=o;zv(u),u.tag===5&&u.flags&1024&&u.stateNode.reset(),o=o.sibling}}function _s(o,u){if(u.subtreeFlags&8772)for(u=u.child;u!==null;)Lv(o,u.alternate,u),u=u.sibling}function ta(o){for(o=o.child;o!==null;){var u=o;switch(u.tag){case 0:case 11:case 14:case 15:fr(4,u,u.return),ta(u);break;case 1:ss(u,u.return);var m=u.stateNode;typeof m.componentWillUnmount=="function"&&Iv(u,u.return,m),ta(u);break;case 27:Ul(u.stateNode);case 26:case 5:ss(u,u.return),ta(u);break;case 22:u.memoizedState===null&&ta(u);break;case 30:ta(u);break;default:ta(u)}o=o.sibling}}function Fs(o,u,m){for(m=m&&(u.subtreeFlags&8772)!==0,u=u.child;u!==null;){var A=u.alternate,T=o,R=u,L=R.flags;switch(R.tag){case 0:case 11:case 15:Fs(T,R,m),Rl(4,R);break;case 1:if(Fs(T,R,m),A=R,T=A.stateNode,typeof T.componentDidMount=="function")try{T.componentDidMount()}catch(re){St(A,A.return,re)}if(A=R,T=A.updateQueue,T!==null){var z=A.stateNode;try{var Z=T.shared.hiddenCallbacks;if(Z!==null)for(T.shared.hiddenCallbacks=null,T=0;T<Z.length;T++)yA(Z[T],z)}catch(re){St(A,A.return,re)}}m&&L&64&&Nv(R),Nl(R,R.return);break;case 27:Pv(R);case 26:case 5:Fs(T,R,m),m&&A===null&&L&4&&_v(R),Nl(R,R.return);break;case 12:Fs(T,R,m);break;case 31:Fs(T,R,m),m&&L&4&&Uv(T,R);break;case 13:Fs(T,R,m),m&&L&4&&Vv(T,R);break;case 22:R.memoizedState===null&&Fs(T,R,m),Nl(R,R.return);break;case 30:break;default:Fs(T,R,m)}u=u.sibling}}function np(o,u){var m=null;o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(m=o.memoizedState.cachePool.pool),o=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(o=u.memoizedState.cachePool.pool),o!==m&&(o!=null&&o.refCount++,m!=null&&gl(m))}function sp(o,u){o=null,u.alternate!==null&&(o=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==o&&(u.refCount++,o!=null&&gl(o))}function Xn(o,u,m,A){if(u.subtreeFlags&10256)for(u=u.child;u!==null;)Gv(o,u,m,A),u=u.sibling}function Gv(o,u,m,A){var T=u.flags;switch(u.tag){case 0:case 11:case 15:Xn(o,u,m,A),T&2048&&Rl(9,u);break;case 1:Xn(o,u,m,A);break;case 3:Xn(o,u,m,A),T&2048&&(o=null,u.alternate!==null&&(o=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==o&&(u.refCount++,o!=null&&gl(o)));break;case 12:if(T&2048){Xn(o,u,m,A),o=u.stateNode;try{var R=u.memoizedProps,L=R.id,z=R.onPostCommit;typeof z=="function"&&z(L,u.alternate===null?"mount":"update",o.passiveEffectDuration,-0)}catch(Z){St(u,u.return,Z)}}else Xn(o,u,m,A);break;case 31:Xn(o,u,m,A);break;case 13:Xn(o,u,m,A);break;case 23:break;case 22:R=u.stateNode,L=u.alternate,u.memoizedState!==null?R._visibility&2?Xn(o,u,m,A):Il(o,u):R._visibility&2?Xn(o,u,m,A):(R._visibility|=2,io(o,u,m,A,(u.subtreeFlags&10256)!==0||!1)),T&2048&&np(L,u);break;case 24:Xn(o,u,m,A),T&2048&&sp(u.alternate,u);break;default:Xn(o,u,m,A)}}function io(o,u,m,A,T){for(T=T&&((u.subtreeFlags&10256)!==0||!1),u=u.child;u!==null;){var R=o,L=u,z=m,Z=A,re=L.flags;switch(L.tag){case 0:case 11:case 15:io(R,L,z,Z,T),Rl(8,L);break;case 23:break;case 22:var ue=L.stateNode;L.memoizedState!==null?ue._visibility&2?io(R,L,z,Z,T):Il(R,L):(ue._visibility|=2,io(R,L,z,Z,T)),T&&re&2048&&np(L.alternate,L);break;case 24:io(R,L,z,Z,T),T&&re&2048&&sp(L.alternate,L);break;default:io(R,L,z,Z,T)}u=u.sibling}}function Il(o,u){if(u.subtreeFlags&10256)for(u=u.child;u!==null;){var m=o,A=u,T=A.flags;switch(A.tag){case 22:Il(m,A),T&2048&&np(A.alternate,A);break;case 24:Il(m,A),T&2048&&sp(A.alternate,A);break;default:Il(m,A)}u=u.sibling}}var _l=8192;function no(o,u,m){if(o.subtreeFlags&_l)for(o=o.child;o!==null;)Hv(o,u,m),o=o.sibling}function Hv(o,u,m){switch(o.tag){case 26:no(o,u,m),o.flags&_l&&o.memoizedState!==null&&bE(m,qn,o.memoizedState,o.memoizedProps);break;case 5:no(o,u,m);break;case 3:case 4:var A=qn;qn=ph(o.stateNode.containerInfo),no(o,u,m),qn=A;break;case 22:o.memoizedState===null&&(A=o.alternate,A!==null&&A.memoizedState!==null?(A=_l,_l=16777216,no(o,u,m),_l=A):no(o,u,m));break;default:no(o,u,m)}}function Yv(o){var u=o.alternate;if(u!==null&&(o=u.child,o!==null)){u.child=null;do u=o.sibling,o.sibling=null,o=u;while(o!==null)}}function Fl(o){var u=o.deletions;if((o.flags&16)!==0){if(u!==null)for(var m=0;m<u.length;m++){var A=u[m];fi=A,Xv(A,o)}Yv(o)}if(o.subtreeFlags&10256)for(o=o.child;o!==null;)qv(o),o=o.sibling}function qv(o){switch(o.tag){case 0:case 11:case 15:Fl(o),o.flags&2048&&fr(9,o,o.return);break;case 3:Fl(o);break;case 12:Fl(o);break;case 22:var u=o.stateNode;o.memoizedState!==null&&u._visibility&2&&(o.return===null||o.return.tag!==13)?(u._visibility&=-3,ih(o)):Fl(o);break;default:Fl(o)}}function ih(o){var u=o.deletions;if((o.flags&16)!==0){if(u!==null)for(var m=0;m<u.length;m++){var A=u[m];fi=A,Xv(A,o)}Yv(o)}for(o=o.child;o!==null;){switch(u=o,u.tag){case 0:case 11:case 15:fr(8,u,u.return),ih(u);break;case 22:m=u.stateNode,m._visibility&2&&(m._visibility&=-3,ih(u));break;default:ih(u)}o=o.sibling}}function Xv(o,u){for(;fi!==null;){var m=fi;switch(m.tag){case 0:case 11:case 15:fr(8,m,u);break;case 23:case 22:if(m.memoizedState!==null&&m.memoizedState.cachePool!==null){var A=m.memoizedState.cachePool.pool;A!=null&&A.refCount++}break;case 24:gl(m.memoizedState.cache)}if(A=m.child,A!==null)A.return=m,fi=A;else e:for(m=o;fi!==null;){A=fi;var T=A.sibling,R=A.return;if(kv(A),A===m){fi=null;break e}if(T!==null){T.return=R,fi=T;break e}fi=R}}}var LC={getCacheForType:function(o){var u=Ei(ii),m=u.data.get(o);return m===void 0&&(m=o(),u.data.set(o,m)),m},cacheSignal:function(){return Ei(ii).controller.signal}},kC=typeof WeakMap=="function"?WeakMap:Map,vt=0,Dt=null,et=null,rt=0,wt=0,un=null,mr=!1,so=!1,rp=!1,Ps=0,Wt=0,pr=0,ia=0,ap=0,hn=0,ro=0,Pl=null,Qi=null,op=!1,nh=0,Wv=0,sh=1/0,rh=null,gr=null,li=0,Ar=null,ao=null,Bs=0,lp=0,cp=null,Kv=null,Bl=0,up=null;function dn(){return(vt&2)!==0&&rt!==0?rt&-rt:U.T!==null?gp():h2()}function Qv(){if(hn===0)if((rt&536870912)===0||lt){var o=_t;_t<<=1,(_t&3932160)===0&&(_t=262144),hn=o}else hn=536870912;return o=ln.current,o!==null&&(o.flags|=32),hn}function Zi(o,u,m){(o===Dt&&(wt===2||wt===9)||o.cancelPendingCommit!==null)&&(oo(o,0),vr(o,rt,hn,!1)),il(o,m),((vt&2)===0||o!==Dt)&&(o===Dt&&((vt&2)===0&&(ia|=m),Wt===4&&vr(o,rt,hn,!1)),rs(o))}function Zv(o,u,m){if((vt&6)!==0)throw Error(n(327));var A=!m&&(u&127)===0&&(u&o.expiredLanes)===0||vs(o,u),T=A?VC(o,u):dp(o,u,!0),R=A;do{if(T===0){so&&!A&&vr(o,u,0,!1);break}else{if(m=o.current.alternate,R&&!OC(m)){T=dp(o,u,!1),R=!1;continue}if(T===2){if(R=u,o.errorRecoveryDisabledLanes&R)var L=0;else L=o.pendingLanes&-536870913,L=L!==0?L:L&536870912?536870912:0;if(L!==0){u=L;e:{var z=o;T=Pl;var Z=z.current.memoizedState.isDehydrated;if(Z&&(oo(z,L).flags|=256),L=dp(z,L,!1),L!==2){if(rp&&!Z){z.errorRecoveryDisabledLanes|=R,ia|=R,T=4;break e}R=Qi,Qi=T,R!==null&&(Qi===null?Qi=R:Qi.push.apply(Qi,R))}T=L}if(R=!1,T!==2)continue}}if(T===1){oo(o,0),vr(o,u,0,!0);break}e:{switch(A=o,R=T,R){case 0:case 1:throw Error(n(345));case 4:if((u&4194048)!==u)break;case 6:vr(A,u,hn,!mr);break e;case 2:Qi=null;break;case 3:case 5:break;default:throw Error(n(329))}if((u&62914560)===u&&(T=nh+300-wi(),10<T)){if(vr(A,u,hn,!mr),tr(A,0,!0)!==0)break e;Bs=u,A.timeoutHandle=Dy(Jv.bind(null,A,m,Qi,rh,op,u,hn,ia,ro,mr,R,"Throttled",-0,0),T);break e}Jv(A,m,Qi,rh,op,u,hn,ia,ro,mr,R,null,-0,0)}}break}while(!0);rs(o)}function Jv(o,u,m,A,T,R,L,z,Z,re,ue,fe,ae,oe){if(o.timeoutHandle=-1,fe=u.subtreeFlags,fe&8192||(fe&16785408)===16785408){fe={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:xs},Hv(u,R,fe);var Ee=(R&62914560)===R?nh-wi():(R&4194048)===R?Wv-wi():0;if(Ee=wE(fe,Ee),Ee!==null){Bs=R,o.cancelPendingCommit=Ee(ay.bind(null,o,u,R,m,A,T,L,z,Z,ue,fe,null,ae,oe)),vr(o,R,L,!re);return}}ay(o,u,R,m,A,T,L,z,Z)}function OC(o){for(var u=o;;){var m=u.tag;if((m===0||m===11||m===15)&&u.flags&16384&&(m=u.updateQueue,m!==null&&(m=m.stores,m!==null)))for(var A=0;A<m.length;A++){var T=m[A],R=T.getSnapshot;T=T.value;try{if(!an(R(),T))return!1}catch{return!1}}if(m=u.child,u.subtreeFlags&16384&&m!==null)m.return=u,u=m;else{if(u===o)break;for(;u.sibling===null;){if(u.return===null||u.return===o)return!0;u=u.return}u.sibling.return=u.return,u=u.sibling}}return!0}function vr(o,u,m,A){u&=~ap,u&=~ia,o.suspendedLanes|=u,o.pingedLanes&=~u,A&&(o.warmLanes|=u),A=o.expirationTimes;for(var T=u;0<T;){var R=31-dt(T),L=1<<R;A[R]=-1,T&=~L}m!==0&&l2(o,m,u)}function ah(){return(vt&6)===0?(Ll(0),!1):!0}function hp(){if(et!==null){if(wt===0)var o=et.return;else o=et,Cs=Xr=null,Mm(o),Za=null,vl=0,o=et;for(;o!==null;)Rv(o.alternate,o),o=o.return;et=null}}function oo(o,u){var m=o.timeoutHandle;m!==-1&&(o.timeoutHandle=-1,sE(m)),m=o.cancelPendingCommit,m!==null&&(o.cancelPendingCommit=null,m()),Bs=0,hp(),Dt=o,et=m=ws(o.current,null),rt=u,wt=0,un=null,mr=!1,so=vs(o,u),rp=!1,ro=hn=ap=ia=pr=Wt=0,Qi=Pl=null,op=!1,(u&8)!==0&&(u|=u&32);var A=o.entangledLanes;if(A!==0)for(o=o.entanglements,A&=u;0<A;){var T=31-dt(A),R=1<<T;u|=o[T],A&=~R}return Ps=u,Mu(),m}function $v(o,u){Ke=null,U.H=Tl,u===Qa||u===Bu?(u=pA(),wt=3):u===pm?(u=pA(),wt=4):wt=u===Gm?8:u!==null&&typeof u=="object"&&typeof u.then=="function"?6:1,un=u,et===null&&(Wt=1,Ku(o,Mn(u,o.current)))}function ey(){var o=ln.current;return o===null?!0:(rt&4194048)===rt?In===null:(rt&62914560)===rt||(rt&536870912)!==0?o===In:!1}function ty(){var o=U.H;return U.H=Tl,o===null?Tl:o}function iy(){var o=U.A;return U.A=LC,o}function oh(){Wt=4,mr||(rt&4194048)!==rt&&ln.current!==null||(so=!0),(pr&134217727)===0&&(ia&134217727)===0||Dt===null||vr(Dt,rt,hn,!1)}function dp(o,u,m){var A=vt;vt|=2;var T=ty(),R=iy();(Dt!==o||rt!==u)&&(rh=null,oo(o,u)),u=!1;var L=Wt;e:do try{if(wt!==0&&et!==null){var z=et,Z=un;switch(wt){case 8:hp(),L=6;break e;case 3:case 2:case 9:case 6:ln.current===null&&(u=!0);var re=wt;if(wt=0,un=null,lo(o,z,Z,re),m&&so){L=0;break e}break;default:re=wt,wt=0,un=null,lo(o,z,Z,re)}}UC(),L=Wt;break}catch(ue){$v(o,ue)}while(!0);return u&&o.shellSuspendCounter++,Cs=Xr=null,vt=A,U.H=T,U.A=R,et===null&&(Dt=null,rt=0,Mu()),L}function UC(){for(;et!==null;)ny(et)}function VC(o,u){var m=vt;vt|=2;var A=ty(),T=iy();Dt!==o||rt!==u?(rh=null,sh=wi()+500,oo(o,u)):so=vs(o,u);e:do try{if(wt!==0&&et!==null){u=et;var R=un;t:switch(wt){case 1:wt=0,un=null,lo(o,u,R,1);break;case 2:case 9:if(fA(R)){wt=0,un=null,sy(u);break}u=function(){wt!==2&&wt!==9||Dt!==o||(wt=7),rs(o)},R.then(u,u);break e;case 3:wt=7;break e;case 4:wt=5;break e;case 7:fA(R)?(wt=0,un=null,sy(u)):(wt=0,un=null,lo(o,u,R,7));break;case 5:var L=null;switch(et.tag){case 26:L=et.memoizedState;case 5:case 27:var z=et;if(L?Gy(L):z.stateNode.complete){wt=0,un=null;var Z=z.sibling;if(Z!==null)et=Z;else{var re=z.return;re!==null?(et=re,lh(re)):et=null}break t}}wt=0,un=null,lo(o,u,R,5);break;case 6:wt=0,un=null,lo(o,u,R,6);break;case 8:hp(),Wt=6;break e;default:throw Error(n(462))}}jC();break}catch(ue){$v(o,ue)}while(!0);return Cs=Xr=null,U.H=A,U.A=T,vt=m,et!==null?0:(Dt=null,rt=0,Mu(),Wt)}function jC(){for(;et!==null&&!Sn();)ny(et)}function ny(o){var u=Mv(o.alternate,o,Ps);o.memoizedProps=o.pendingProps,u===null?lh(o):et=u}function sy(o){var u=o,m=u.alternate;switch(u.tag){case 15:case 0:u=bv(m,u,u.pendingProps,u.type,void 0,rt);break;case 11:u=bv(m,u,u.pendingProps,u.type.render,u.ref,rt);break;case 5:Mm(u);default:Rv(m,u),u=et=iA(u,Ps),u=Mv(m,u,Ps)}o.memoizedProps=o.pendingProps,u===null?lh(o):et=u}function lo(o,u,m,A){Cs=Xr=null,Mm(u),Za=null,vl=0;var T=u.return;try{if(RC(o,T,u,m,rt)){Wt=1,Ku(o,Mn(m,o.current)),et=null;return}}catch(R){if(T!==null)throw et=T,R;Wt=1,Ku(o,Mn(m,o.current)),et=null;return}u.flags&32768?(lt||A===1?o=!0:so||(rt&536870912)!==0?o=!1:(mr=o=!0,(A===2||A===9||A===3||A===6)&&(A=ln.current,A!==null&&A.tag===13&&(A.flags|=16384))),ry(u,o)):lh(u)}function lh(o){var u=o;do{if((u.flags&32768)!==0){ry(u,mr);return}o=u.return;var m=_C(u.alternate,u,Ps);if(m!==null){et=m;return}if(u=u.sibling,u!==null){et=u;return}et=u=o}while(u!==null);Wt===0&&(Wt=5)}function ry(o,u){do{var m=FC(o.alternate,o);if(m!==null){m.flags&=32767,et=m;return}if(m=o.return,m!==null&&(m.flags|=32768,m.subtreeFlags=0,m.deletions=null),!u&&(o=o.sibling,o!==null)){et=o;return}et=o=m}while(o!==null);Wt=6,et=null}function ay(o,u,m,A,T,R,L,z,Z){o.cancelPendingCommit=null;do ch();while(li!==0);if((vt&6)!==0)throw Error(n(327));if(u!==null){if(u===o.current)throw Error(n(177));if(R=u.lanes|u.childLanes,R|=em,xS(o,m,R,L,z,Z),o===Dt&&(et=Dt=null,rt=0),ao=u,Ar=o,Bs=m,lp=R,cp=T,Kv=A,(u.subtreeFlags&10256)!==0||(u.flags&10256)!==0?(o.callbackNode=null,o.callbackPriority=0,YC(ne,function(){return hy(),null})):(o.callbackNode=null,o.callbackPriority=0),A=(u.flags&13878)!==0,(u.subtreeFlags&13878)!==0||A){A=U.T,U.T=null,T=H.p,H.p=2,L=vt,vt|=4;try{PC(o,u,m)}finally{vt=L,H.p=T,U.T=A}}li=1,oy(),ly(),cy()}}function oy(){if(li===1){li=0;var o=Ar,u=ao,m=(u.flags&13878)!==0;if((u.subtreeFlags&13878)!==0||m){m=U.T,U.T=null;var A=H.p;H.p=2;var T=vt;vt|=4;try{jv(u,o);var R=Cp,L=X2(o.containerInfo),z=R.focusedElem,Z=R.selectionRange;if(L!==z&&z&&z.ownerDocument&&q2(z.ownerDocument.documentElement,z)){if(Z!==null&&Kf(z)){var re=Z.start,ue=Z.end;if(ue===void 0&&(ue=re),"selectionStart"in z)z.selectionStart=re,z.selectionEnd=Math.min(ue,z.value.length);else{var fe=z.ownerDocument||document,ae=fe&&fe.defaultView||window;if(ae.getSelection){var oe=ae.getSelection(),Ee=z.textContent.length,Oe=Math.min(Z.start,Ee),Tt=Z.end===void 0?Oe:Math.min(Z.end,Ee);!oe.extend&&Oe>Tt&&(L=Tt,Tt=Oe,Oe=L);var ie=Y2(z,Oe),$=Y2(z,Tt);if(ie&&$&&(oe.rangeCount!==1||oe.anchorNode!==ie.node||oe.anchorOffset!==ie.offset||oe.focusNode!==$.node||oe.focusOffset!==$.offset)){var se=fe.createRange();se.setStart(ie.node,ie.offset),oe.removeAllRanges(),Oe>Tt?(oe.addRange(se),oe.extend($.node,$.offset)):(se.setEnd($.node,$.offset),oe.addRange(se))}}}}for(fe=[],oe=z;oe=oe.parentNode;)oe.nodeType===1&&fe.push({element:oe,left:oe.scrollLeft,top:oe.scrollTop});for(typeof z.focus=="function"&&z.focus(),z=0;z<fe.length;z++){var de=fe[z];de.element.scrollLeft=de.left,de.element.scrollTop=de.top}}bh=!!Sp,Cp=Sp=null}finally{vt=T,H.p=A,U.T=m}}o.current=u,li=2}}function ly(){if(li===2){li=0;var o=Ar,u=ao,m=(u.flags&8772)!==0;if((u.subtreeFlags&8772)!==0||m){m=U.T,U.T=null;var A=H.p;H.p=2;var T=vt;vt|=4;try{Lv(o,u.alternate,u)}finally{vt=T,H.p=A,U.T=m}}li=3}}function cy(){if(li===4||li===3){li=0,el();var o=Ar,u=ao,m=Bs,A=Kv;(u.subtreeFlags&10256)!==0||(u.flags&10256)!==0?li=5:(li=0,ao=Ar=null,uy(o,o.pendingLanes));var T=o.pendingLanes;if(T===0&&(gr=null),Nf(m),u=u.stateNode,ke&&typeof ke.onCommitFiberRoot=="function")try{ke.onCommitFiberRoot(Le,u,void 0,(u.current.flags&128)===128)}catch{}if(A!==null){u=U.T,T=H.p,H.p=2,U.T=null;try{for(var R=o.onRecoverableError,L=0;L<A.length;L++){var z=A[L];R(z.value,{componentStack:z.stack})}}finally{U.T=u,H.p=T}}(Bs&3)!==0&&ch(),rs(o),T=o.pendingLanes,(m&261930)!==0&&(T&42)!==0?o===up?Bl++:(Bl=0,up=o):Bl=0,Ll(0)}}function uy(o,u){(o.pooledCacheLanes&=u)===0&&(u=o.pooledCache,u!=null&&(o.pooledCache=null,gl(u)))}function ch(){return oy(),ly(),cy(),hy()}function hy(){if(li!==5)return!1;var o=Ar,u=lp;lp=0;var m=Nf(Bs),A=U.T,T=H.p;try{H.p=32>m?32:m,U.T=null,m=cp,cp=null;var R=Ar,L=Bs;if(li=0,ao=Ar=null,Bs=0,(vt&6)!==0)throw Error(n(331));var z=vt;if(vt|=4,qv(R.current),Gv(R,R.current,L,m),vt=z,Ll(0,!1),ke&&typeof ke.onPostCommitFiberRoot=="function")try{ke.onPostCommitFiberRoot(Le,R)}catch{}return!0}finally{H.p=T,U.T=A,uy(o,u)}}function dy(o,u,m){u=Mn(m,u),u=zm(o.stateNode,u,2),o=ur(o,u,2),o!==null&&(il(o,2),rs(o))}function St(o,u,m){if(o.tag===3)dy(o,o,m);else for(;u!==null;){if(u.tag===3){dy(u,o,m);break}else if(u.tag===1){var A=u.stateNode;if(typeof u.type.getDerivedStateFromError=="function"||typeof A.componentDidCatch=="function"&&(gr===null||!gr.has(A))){o=Mn(m,o),m=fv(2),A=ur(u,m,2),A!==null&&(mv(m,A,u,o),il(A,2),rs(A));break}}u=u.return}}function fp(o,u,m){var A=o.pingCache;if(A===null){A=o.pingCache=new kC;var T=new Set;A.set(u,T)}else T=A.get(u),T===void 0&&(T=new Set,A.set(u,T));T.has(m)||(rp=!0,T.add(m),o=zC.bind(null,o,u,m),u.then(o,o))}function zC(o,u,m){var A=o.pingCache;A!==null&&A.delete(u),o.pingedLanes|=o.suspendedLanes&m,o.warmLanes&=~m,Dt===o&&(rt&m)===m&&(Wt===4||Wt===3&&(rt&62914560)===rt&&300>wi()-nh?(vt&2)===0&&oo(o,0):ap|=m,ro===rt&&(ro=0)),rs(o)}function fy(o,u){u===0&&(u=o2()),o=Hr(o,u),o!==null&&(il(o,u),rs(o))}function GC(o){var u=o.memoizedState,m=0;u!==null&&(m=u.retryLane),fy(o,m)}function HC(o,u){var m=0;switch(o.tag){case 31:case 13:var A=o.stateNode,T=o.memoizedState;T!==null&&(m=T.retryLane);break;case 19:A=o.stateNode;break;case 22:A=o.stateNode._retryCache;break;default:throw Error(n(314))}A!==null&&A.delete(u),fy(o,m)}function YC(o,u){return wn(o,u)}var uh=null,co=null,mp=!1,hh=!1,pp=!1,yr=0;function rs(o){o!==co&&o.next===null&&(co===null?uh=co=o:co=co.next=o),hh=!0,mp||(mp=!0,XC())}function Ll(o,u){if(!pp&&hh){pp=!0;do for(var m=!1,A=uh;A!==null;){if(o!==0){var T=A.pendingLanes;if(T===0)var R=0;else{var L=A.suspendedLanes,z=A.pingedLanes;R=(1<<31-dt(42|o)+1)-1,R&=T&~(L&~z),R=R&201326741?R&201326741|1:R?R|2:0}R!==0&&(m=!0,Ay(A,R))}else R=rt,R=tr(A,A===Dt?R:0,A.cancelPendingCommit!==null||A.timeoutHandle!==-1),(R&3)===0||vs(A,R)||(m=!0,Ay(A,R));A=A.next}while(m);pp=!1}}function qC(){my()}function my(){hh=mp=!1;var o=0;yr!==0&&nE()&&(o=yr);for(var u=wi(),m=null,A=uh;A!==null;){var T=A.next,R=py(A,u);R===0?(A.next=null,m===null?uh=T:m.next=T,T===null&&(co=m)):(m=A,(o!==0||(R&3)!==0)&&(hh=!0)),A=T}li!==0&&li!==5||Ll(o),yr!==0&&(yr=0)}function py(o,u){for(var m=o.suspendedLanes,A=o.pingedLanes,T=o.expirationTimes,R=o.pendingLanes&-62914561;0<R;){var L=31-dt(R),z=1<<L,Z=T[L];Z===-1?((z&m)===0||(z&A)!==0)&&(T[L]=yS(z,u)):Z<=u&&(o.expiredLanes|=z),R&=~z}if(u=Dt,m=rt,m=tr(o,o===u?m:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),A=o.callbackNode,m===0||o===u&&(wt===2||wt===9)||o.cancelPendingCommit!==null)return A!==null&&A!==null&&bi(A),o.callbackNode=null,o.callbackPriority=0;if((m&3)===0||vs(o,m)){if(u=m&-m,u===o.callbackPriority)return u;switch(A!==null&&bi(A),Nf(m)){case 2:case 8:m=er;break;case 32:m=ne;break;case 268435456:m=me;break;default:m=ne}return A=gy.bind(null,o),m=wn(m,A),o.callbackPriority=u,o.callbackNode=m,u}return A!==null&&A!==null&&bi(A),o.callbackPriority=2,o.callbackNode=null,2}function gy(o,u){if(li!==0&&li!==5)return o.callbackNode=null,o.callbackPriority=0,null;var m=o.callbackNode;if(ch()&&o.callbackNode!==m)return null;var A=rt;return A=tr(o,o===Dt?A:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),A===0?null:(Zv(o,A,u),py(o,wi()),o.callbackNode!=null&&o.callbackNode===m?gy.bind(null,o):null)}function Ay(o,u){if(ch())return null;Zv(o,u,!0)}function XC(){rE(function(){(vt&6)!==0?wn(As,qC):my()})}function gp(){if(yr===0){var o=Wa;o===0&&(o=mt,mt<<=1,(mt&261888)===0&&(mt=256)),yr=o}return yr}function vy(o){return o==null||typeof o=="symbol"||typeof o=="boolean"?null:typeof o=="function"?o:yu(""+o)}function yy(o,u){var m=u.ownerDocument.createElement("input");return m.name=u.name,m.value=u.value,o.id&&m.setAttribute("form",o.id),u.parentNode.insertBefore(m,u),o=new FormData(o),m.parentNode.removeChild(m),o}function WC(o,u,m,A,T){if(u==="submit"&&m&&m.stateNode===T){var R=vy((T[Yi]||null).action),L=A.submitter;L&&(u=(u=L[Yi]||null)?vy(u.formAction):L.getAttribute("formAction"),u!==null&&(R=u,L=null));var z=new Su("action","action",null,A,T);o.push({event:z,listeners:[{instance:null,listener:function(){if(A.defaultPrevented){if(yr!==0){var Z=L?yy(T,L):new FormData(T);Lm(m,{pending:!0,data:Z,method:T.method,action:R},null,Z)}}else typeof R=="function"&&(z.preventDefault(),Z=L?yy(T,L):new FormData(T),Lm(m,{pending:!0,data:Z,method:T.method,action:R},R,Z))},currentTarget:T}]})}}for(var Ap=0;Ap<$f.length;Ap++){var vp=$f[Ap],KC=vp.toLowerCase(),QC=vp[0].toUpperCase()+vp.slice(1);Yn(KC,"on"+QC)}Yn(Q2,"onAnimationEnd"),Yn(Z2,"onAnimationIteration"),Yn(J2,"onAnimationStart"),Yn("dblclick","onDoubleClick"),Yn("focusin","onFocus"),Yn("focusout","onBlur"),Yn(dC,"onTransitionRun"),Yn(fC,"onTransitionStart"),Yn(mC,"onTransitionCancel"),Yn($2,"onTransitionEnd"),Pa("onMouseEnter",["mouseout","mouseover"]),Pa("onMouseLeave",["mouseout","mouseover"]),Pa("onPointerEnter",["pointerout","pointerover"]),Pa("onPointerLeave",["pointerout","pointerover"]),Vr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Vr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Vr("onBeforeInput",["compositionend","keypress","textInput","paste"]),Vr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Vr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Vr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var kl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ZC=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(kl));function xy(o,u){u=(u&4)!==0;for(var m=0;m<o.length;m++){var A=o[m],T=A.event;A=A.listeners;e:{var R=void 0;if(u)for(var L=A.length-1;0<=L;L--){var z=A[L],Z=z.instance,re=z.currentTarget;if(z=z.listener,Z!==R&&T.isPropagationStopped())break e;R=z,T.currentTarget=re;try{R(T)}catch(ue){Tu(ue)}T.currentTarget=null,R=Z}else for(L=0;L<A.length;L++){if(z=A[L],Z=z.instance,re=z.currentTarget,z=z.listener,Z!==R&&T.isPropagationStopped())break e;R=z,T.currentTarget=re;try{R(T)}catch(ue){Tu(ue)}T.currentTarget=null,R=Z}}}}function tt(o,u){var m=u[If];m===void 0&&(m=u[If]=new Set);var A=o+"__bubble";m.has(A)||(by(u,o,2,!1),m.add(A))}function yp(o,u,m){var A=0;u&&(A|=4),by(m,o,A,u)}var dh="_reactListening"+Math.random().toString(36).slice(2);function xp(o){if(!o[dh]){o[dh]=!0,m2.forEach(function(m){m!=="selectionchange"&&(ZC.has(m)||yp(m,!1,o),yp(m,!0,o))});var u=o.nodeType===9?o:o.ownerDocument;u===null||u[dh]||(u[dh]=!0,yp("selectionchange",!1,u))}}function by(o,u,m,A){switch(Qy(u)){case 2:var T=EE;break;case 8:T=TE;break;default:T=Bp}m=T.bind(null,u,m,o),T=void 0,!Vf||u!=="touchstart"&&u!=="touchmove"&&u!=="wheel"||(T=!0),A?T!==void 0?o.addEventListener(u,m,{capture:!0,passive:T}):o.addEventListener(u,m,!0):T!==void 0?o.addEventListener(u,m,{passive:T}):o.addEventListener(u,m,!1)}function bp(o,u,m,A,T){var R=A;if((u&1)===0&&(u&2)===0&&A!==null)e:for(;;){if(A===null)return;var L=A.tag;if(L===3||L===4){var z=A.stateNode.containerInfo;if(z===T)break;if(L===4)for(L=A.return;L!==null;){var Z=L.tag;if((Z===3||Z===4)&&L.stateNode.containerInfo===T)return;L=L.return}for(;z!==null;){if(L=Ia(z),L===null)return;if(Z=L.tag,Z===5||Z===6||Z===26||Z===27){A=R=L;continue e}z=z.parentNode}}A=A.return}T2(function(){var re=R,ue=Of(m),fe=[];e:{var ae=eA.get(o);if(ae!==void 0){var oe=Su,Ee=o;switch(o){case"keypress":if(bu(m)===0)break e;case"keydown":case"keyup":oe=HS;break;case"focusin":Ee="focus",oe=Hf;break;case"focusout":Ee="blur",oe=Hf;break;case"beforeblur":case"afterblur":oe=Hf;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":oe=R2;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":oe=_S;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":oe=XS;break;case Q2:case Z2:case J2:oe=BS;break;case $2:oe=KS;break;case"scroll":case"scrollend":oe=NS;break;case"wheel":oe=ZS;break;case"copy":case"cut":case"paste":oe=kS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":oe=I2;break;case"toggle":case"beforetoggle":oe=$S}var Oe=(u&4)!==0,Tt=!Oe&&(o==="scroll"||o==="scrollend"),ie=Oe?ae!==null?ae+"Capture":null:ae;Oe=[];for(var $=re,se;$!==null;){var de=$;if(se=de.stateNode,de=de.tag,de!==5&&de!==26&&de!==27||se===null||ie===null||(de=rl($,ie),de!=null&&Oe.push(Ol($,de,se))),Tt)break;$=$.return}0<Oe.length&&(ae=new oe(ae,Ee,null,m,ue),fe.push({event:ae,listeners:Oe}))}}if((u&7)===0){e:{if(ae=o==="mouseover"||o==="pointerover",oe=o==="mouseout"||o==="pointerout",ae&&m!==kf&&(Ee=m.relatedTarget||m.fromElement)&&(Ia(Ee)||Ee[Na]))break e;if((oe||ae)&&(ae=ue.window===ue?ue:(ae=ue.ownerDocument)?ae.defaultView||ae.parentWindow:window,oe?(Ee=m.relatedTarget||m.toElement,oe=re,Ee=Ee?Ia(Ee):null,Ee!==null&&(Tt=r(Ee),Oe=Ee.tag,Ee!==Tt||Oe!==5&&Oe!==27&&Oe!==6)&&(Ee=null)):(oe=null,Ee=re),oe!==Ee)){if(Oe=R2,de="onMouseLeave",ie="onMouseEnter",$="mouse",(o==="pointerout"||o==="pointerover")&&(Oe=I2,de="onPointerLeave",ie="onPointerEnter",$="pointer"),Tt=oe==null?ae:sl(oe),se=Ee==null?ae:sl(Ee),ae=new Oe(de,$+"leave",oe,m,ue),ae.target=Tt,ae.relatedTarget=se,de=null,Ia(ue)===re&&(Oe=new Oe(ie,$+"enter",Ee,m,ue),Oe.target=se,Oe.relatedTarget=Tt,de=Oe),Tt=de,oe&&Ee)t:{for(Oe=JC,ie=oe,$=Ee,se=0,de=ie;de;de=Oe(de))se++;de=0;for(var _e=$;_e;_e=Oe(_e))de++;for(;0<se-de;)ie=Oe(ie),se--;for(;0<de-se;)$=Oe($),de--;for(;se--;){if(ie===$||$!==null&&ie===$.alternate){Oe=ie;break t}ie=Oe(ie),$=Oe($)}Oe=null}else Oe=null;oe!==null&&wy(fe,ae,oe,Oe,!1),Ee!==null&&Tt!==null&&wy(fe,Tt,Ee,Oe,!0)}}e:{if(ae=re?sl(re):window,oe=ae.nodeName&&ae.nodeName.toLowerCase(),oe==="select"||oe==="input"&&ae.type==="file")var pt=U2;else if(k2(ae))if(V2)pt=cC;else{pt=oC;var De=aC}else oe=ae.nodeName,!oe||oe.toLowerCase()!=="input"||ae.type!=="checkbox"&&ae.type!=="radio"?re&&Lf(re.elementType)&&(pt=U2):pt=lC;if(pt&&(pt=pt(o,re))){O2(fe,pt,m,ue);break e}De&&De(o,ae,re),o==="focusout"&&re&&ae.type==="number"&&re.memoizedProps.value!=null&&Bf(ae,"number",ae.value)}switch(De=re?sl(re):window,o){case"focusin":(k2(De)||De.contentEditable==="true")&&(Va=De,Qf=re,fl=null);break;case"focusout":fl=Qf=Va=null;break;case"mousedown":Zf=!0;break;case"contextmenu":case"mouseup":case"dragend":Zf=!1,W2(fe,m,ue);break;case"selectionchange":if(hC)break;case"keydown":case"keyup":W2(fe,m,ue)}var Ze;if(qf)e:{switch(o){case"compositionstart":var at="onCompositionStart";break e;case"compositionend":at="onCompositionEnd";break e;case"compositionupdate":at="onCompositionUpdate";break e}at=void 0}else Ua?B2(o,m)&&(at="onCompositionEnd"):o==="keydown"&&m.keyCode===229&&(at="onCompositionStart");at&&(_2&&m.locale!=="ko"&&(Ua||at!=="onCompositionStart"?at==="onCompositionEnd"&&Ua&&(Ze=M2()):(nr=ue,jf="value"in nr?nr.value:nr.textContent,Ua=!0)),De=fh(re,at),0<De.length&&(at=new N2(at,o,null,m,ue),fe.push({event:at,listeners:De}),Ze?at.data=Ze:(Ze=L2(m),Ze!==null&&(at.data=Ze)))),(Ze=tC?iC(o,m):nC(o,m))&&(at=fh(re,"onBeforeInput"),0<at.length&&(De=new N2("onBeforeInput","beforeinput",null,m,ue),fe.push({event:De,listeners:at}),De.data=Ze)),WC(fe,o,re,m,ue)}xy(fe,u)})}function Ol(o,u,m){return{instance:o,listener:u,currentTarget:m}}function fh(o,u){for(var m=u+"Capture",A=[];o!==null;){var T=o,R=T.stateNode;if(T=T.tag,T!==5&&T!==26&&T!==27||R===null||(T=rl(o,m),T!=null&&A.unshift(Ol(o,T,R)),T=rl(o,u),T!=null&&A.push(Ol(o,T,R))),o.tag===3)return A;o=o.return}return[]}function JC(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5&&o.tag!==27);return o||null}function wy(o,u,m,A,T){for(var R=u._reactName,L=[];m!==null&&m!==A;){var z=m,Z=z.alternate,re=z.stateNode;if(z=z.tag,Z!==null&&Z===A)break;z!==5&&z!==26&&z!==27||re===null||(Z=re,T?(re=rl(m,R),re!=null&&L.unshift(Ol(m,re,Z))):T||(re=rl(m,R),re!=null&&L.push(Ol(m,re,Z)))),m=m.return}L.length!==0&&o.push({event:u,listeners:L})}var $C=/\r\n?/g,eE=/\u0000|\uFFFD/g;function Sy(o){return(typeof o=="string"?o:""+o).replace($C,`
`).replace(eE,"")}function Cy(o,u){return u=Sy(u),Sy(o)===u}function Et(o,u,m,A,T,R){switch(m){case"children":typeof A=="string"?u==="body"||u==="textarea"&&A===""||La(o,A):(typeof A=="number"||typeof A=="bigint")&&u!=="body"&&La(o,""+A);break;case"className":Au(o,"class",A);break;case"tabIndex":Au(o,"tabindex",A);break;case"dir":case"role":case"viewBox":case"width":case"height":Au(o,m,A);break;case"style":C2(o,A,R);break;case"data":if(u!=="object"){Au(o,"data",A);break}case"src":case"href":if(A===""&&(u!=="a"||m!=="href")){o.removeAttribute(m);break}if(A==null||typeof A=="function"||typeof A=="symbol"||typeof A=="boolean"){o.removeAttribute(m);break}A=yu(""+A),o.setAttribute(m,A);break;case"action":case"formAction":if(typeof A=="function"){o.setAttribute(m,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof R=="function"&&(m==="formAction"?(u!=="input"&&Et(o,u,"name",T.name,T,null),Et(o,u,"formEncType",T.formEncType,T,null),Et(o,u,"formMethod",T.formMethod,T,null),Et(o,u,"formTarget",T.formTarget,T,null)):(Et(o,u,"encType",T.encType,T,null),Et(o,u,"method",T.method,T,null),Et(o,u,"target",T.target,T,null)));if(A==null||typeof A=="symbol"||typeof A=="boolean"){o.removeAttribute(m);break}A=yu(""+A),o.setAttribute(m,A);break;case"onClick":A!=null&&(o.onclick=xs);break;case"onScroll":A!=null&&tt("scroll",o);break;case"onScrollEnd":A!=null&&tt("scrollend",o);break;case"dangerouslySetInnerHTML":if(A!=null){if(typeof A!="object"||!("__html"in A))throw Error(n(61));if(m=A.__html,m!=null){if(T.children!=null)throw Error(n(60));o.innerHTML=m}}break;case"multiple":o.multiple=A&&typeof A!="function"&&typeof A!="symbol";break;case"muted":o.muted=A&&typeof A!="function"&&typeof A!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(A==null||typeof A=="function"||typeof A=="boolean"||typeof A=="symbol"){o.removeAttribute("xlink:href");break}m=yu(""+A),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",m);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":A!=null&&typeof A!="function"&&typeof A!="symbol"?o.setAttribute(m,""+A):o.removeAttribute(m);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":A&&typeof A!="function"&&typeof A!="symbol"?o.setAttribute(m,""):o.removeAttribute(m);break;case"capture":case"download":A===!0?o.setAttribute(m,""):A!==!1&&A!=null&&typeof A!="function"&&typeof A!="symbol"?o.setAttribute(m,A):o.removeAttribute(m);break;case"cols":case"rows":case"size":case"span":A!=null&&typeof A!="function"&&typeof A!="symbol"&&!isNaN(A)&&1<=A?o.setAttribute(m,A):o.removeAttribute(m);break;case"rowSpan":case"start":A==null||typeof A=="function"||typeof A=="symbol"||isNaN(A)?o.removeAttribute(m):o.setAttribute(m,A);break;case"popover":tt("beforetoggle",o),tt("toggle",o),gu(o,"popover",A);break;case"xlinkActuate":ys(o,"http://www.w3.org/1999/xlink","xlink:actuate",A);break;case"xlinkArcrole":ys(o,"http://www.w3.org/1999/xlink","xlink:arcrole",A);break;case"xlinkRole":ys(o,"http://www.w3.org/1999/xlink","xlink:role",A);break;case"xlinkShow":ys(o,"http://www.w3.org/1999/xlink","xlink:show",A);break;case"xlinkTitle":ys(o,"http://www.w3.org/1999/xlink","xlink:title",A);break;case"xlinkType":ys(o,"http://www.w3.org/1999/xlink","xlink:type",A);break;case"xmlBase":ys(o,"http://www.w3.org/XML/1998/namespace","xml:base",A);break;case"xmlLang":ys(o,"http://www.w3.org/XML/1998/namespace","xml:lang",A);break;case"xmlSpace":ys(o,"http://www.w3.org/XML/1998/namespace","xml:space",A);break;case"is":gu(o,"is",A);break;case"innerText":case"textContent":break;default:(!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(m=DS.get(m)||m,gu(o,m,A))}}function wp(o,u,m,A,T,R){switch(m){case"style":C2(o,A,R);break;case"dangerouslySetInnerHTML":if(A!=null){if(typeof A!="object"||!("__html"in A))throw Error(n(61));if(m=A.__html,m!=null){if(T.children!=null)throw Error(n(60));o.innerHTML=m}}break;case"children":typeof A=="string"?La(o,A):(typeof A=="number"||typeof A=="bigint")&&La(o,""+A);break;case"onScroll":A!=null&&tt("scroll",o);break;case"onScrollEnd":A!=null&&tt("scrollend",o);break;case"onClick":A!=null&&(o.onclick=xs);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!p2.hasOwnProperty(m))e:{if(m[0]==="o"&&m[1]==="n"&&(T=m.endsWith("Capture"),u=m.slice(2,T?m.length-7:void 0),R=o[Yi]||null,R=R!=null?R[m]:null,typeof R=="function"&&o.removeEventListener(u,R,T),typeof A=="function")){typeof R!="function"&&R!==null&&(m in o?o[m]=null:o.hasAttribute(m)&&o.removeAttribute(m)),o.addEventListener(u,A,T);break e}m in o?o[m]=A:A===!0?o.setAttribute(m,""):gu(o,m,A)}}}function Mi(o,u,m){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":tt("error",o),tt("load",o);var A=!1,T=!1,R;for(R in m)if(m.hasOwnProperty(R)){var L=m[R];if(L!=null)switch(R){case"src":A=!0;break;case"srcSet":T=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,u));default:Et(o,u,R,L,m,null)}}T&&Et(o,u,"srcSet",m.srcSet,m,null),A&&Et(o,u,"src",m.src,m,null);return;case"input":tt("invalid",o);var z=R=L=T=null,Z=null,re=null;for(A in m)if(m.hasOwnProperty(A)){var ue=m[A];if(ue!=null)switch(A){case"name":T=ue;break;case"type":L=ue;break;case"checked":Z=ue;break;case"defaultChecked":re=ue;break;case"value":R=ue;break;case"defaultValue":z=ue;break;case"children":case"dangerouslySetInnerHTML":if(ue!=null)throw Error(n(137,u));break;default:Et(o,u,A,ue,m,null)}}x2(o,R,z,Z,re,L,T,!1);return;case"select":tt("invalid",o),A=L=R=null;for(T in m)if(m.hasOwnProperty(T)&&(z=m[T],z!=null))switch(T){case"value":R=z;break;case"defaultValue":L=z;break;case"multiple":A=z;default:Et(o,u,T,z,m,null)}u=R,m=L,o.multiple=!!A,u!=null?Ba(o,!!A,u,!1):m!=null&&Ba(o,!!A,m,!0);return;case"textarea":tt("invalid",o),R=T=A=null;for(L in m)if(m.hasOwnProperty(L)&&(z=m[L],z!=null))switch(L){case"value":A=z;break;case"defaultValue":T=z;break;case"children":R=z;break;case"dangerouslySetInnerHTML":if(z!=null)throw Error(n(91));break;default:Et(o,u,L,z,m,null)}w2(o,A,T,R);return;case"option":for(Z in m)m.hasOwnProperty(Z)&&(A=m[Z],A!=null)&&(Z==="selected"?o.selected=A&&typeof A!="function"&&typeof A!="symbol":Et(o,u,Z,A,m,null));return;case"dialog":tt("beforetoggle",o),tt("toggle",o),tt("cancel",o),tt("close",o);break;case"iframe":case"object":tt("load",o);break;case"video":case"audio":for(A=0;A<kl.length;A++)tt(kl[A],o);break;case"image":tt("error",o),tt("load",o);break;case"details":tt("toggle",o);break;case"embed":case"source":case"link":tt("error",o),tt("load",o);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(re in m)if(m.hasOwnProperty(re)&&(A=m[re],A!=null))switch(re){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,u));default:Et(o,u,re,A,m,null)}return;default:if(Lf(u)){for(ue in m)m.hasOwnProperty(ue)&&(A=m[ue],A!==void 0&&wp(o,u,ue,A,m,void 0));return}}for(z in m)m.hasOwnProperty(z)&&(A=m[z],A!=null&&Et(o,u,z,A,m,null))}function tE(o,u,m,A){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var T=null,R=null,L=null,z=null,Z=null,re=null,ue=null;for(oe in m){var fe=m[oe];if(m.hasOwnProperty(oe)&&fe!=null)switch(oe){case"checked":break;case"value":break;case"defaultValue":Z=fe;default:A.hasOwnProperty(oe)||Et(o,u,oe,null,A,fe)}}for(var ae in A){var oe=A[ae];if(fe=m[ae],A.hasOwnProperty(ae)&&(oe!=null||fe!=null))switch(ae){case"type":R=oe;break;case"name":T=oe;break;case"checked":re=oe;break;case"defaultChecked":ue=oe;break;case"value":L=oe;break;case"defaultValue":z=oe;break;case"children":case"dangerouslySetInnerHTML":if(oe!=null)throw Error(n(137,u));break;default:oe!==fe&&Et(o,u,ae,oe,A,fe)}}Pf(o,L,z,Z,re,ue,R,T);return;case"select":oe=L=z=ae=null;for(R in m)if(Z=m[R],m.hasOwnProperty(R)&&Z!=null)switch(R){case"value":break;case"multiple":oe=Z;default:A.hasOwnProperty(R)||Et(o,u,R,null,A,Z)}for(T in A)if(R=A[T],Z=m[T],A.hasOwnProperty(T)&&(R!=null||Z!=null))switch(T){case"value":ae=R;break;case"defaultValue":z=R;break;case"multiple":L=R;default:R!==Z&&Et(o,u,T,R,A,Z)}u=z,m=L,A=oe,ae!=null?Ba(o,!!m,ae,!1):!!A!=!!m&&(u!=null?Ba(o,!!m,u,!0):Ba(o,!!m,m?[]:"",!1));return;case"textarea":oe=ae=null;for(z in m)if(T=m[z],m.hasOwnProperty(z)&&T!=null&&!A.hasOwnProperty(z))switch(z){case"value":break;case"children":break;default:Et(o,u,z,null,A,T)}for(L in A)if(T=A[L],R=m[L],A.hasOwnProperty(L)&&(T!=null||R!=null))switch(L){case"value":ae=T;break;case"defaultValue":oe=T;break;case"children":break;case"dangerouslySetInnerHTML":if(T!=null)throw Error(n(91));break;default:T!==R&&Et(o,u,L,T,A,R)}b2(o,ae,oe);return;case"option":for(var Ee in m)ae=m[Ee],m.hasOwnProperty(Ee)&&ae!=null&&!A.hasOwnProperty(Ee)&&(Ee==="selected"?o.selected=!1:Et(o,u,Ee,null,A,ae));for(Z in A)ae=A[Z],oe=m[Z],A.hasOwnProperty(Z)&&ae!==oe&&(ae!=null||oe!=null)&&(Z==="selected"?o.selected=ae&&typeof ae!="function"&&typeof ae!="symbol":Et(o,u,Z,ae,A,oe));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Oe in m)ae=m[Oe],m.hasOwnProperty(Oe)&&ae!=null&&!A.hasOwnProperty(Oe)&&Et(o,u,Oe,null,A,ae);for(re in A)if(ae=A[re],oe=m[re],A.hasOwnProperty(re)&&ae!==oe&&(ae!=null||oe!=null))switch(re){case"children":case"dangerouslySetInnerHTML":if(ae!=null)throw Error(n(137,u));break;default:Et(o,u,re,ae,A,oe)}return;default:if(Lf(u)){for(var Tt in m)ae=m[Tt],m.hasOwnProperty(Tt)&&ae!==void 0&&!A.hasOwnProperty(Tt)&&wp(o,u,Tt,void 0,A,ae);for(ue in A)ae=A[ue],oe=m[ue],!A.hasOwnProperty(ue)||ae===oe||ae===void 0&&oe===void 0||wp(o,u,ue,ae,A,oe);return}}for(var ie in m)ae=m[ie],m.hasOwnProperty(ie)&&ae!=null&&!A.hasOwnProperty(ie)&&Et(o,u,ie,null,A,ae);for(fe in A)ae=A[fe],oe=m[fe],!A.hasOwnProperty(fe)||ae===oe||ae==null&&oe==null||Et(o,u,fe,ae,A,oe)}function Ey(o){switch(o){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function iE(){if(typeof performance.getEntriesByType=="function"){for(var o=0,u=0,m=performance.getEntriesByType("resource"),A=0;A<m.length;A++){var T=m[A],R=T.transferSize,L=T.initiatorType,z=T.duration;if(R&&z&&Ey(L)){for(L=0,z=T.responseEnd,A+=1;A<m.length;A++){var Z=m[A],re=Z.startTime;if(re>z)break;var ue=Z.transferSize,fe=Z.initiatorType;ue&&Ey(fe)&&(Z=Z.responseEnd,L+=ue*(Z<z?1:(z-re)/(Z-re)))}if(--A,u+=8*(R+L)/(T.duration/1e3),o++,10<o)break}}if(0<o)return u/o/1e6}return navigator.connection&&(o=navigator.connection.downlink,typeof o=="number")?o:5}var Sp=null,Cp=null;function mh(o){return o.nodeType===9?o:o.ownerDocument}function Ty(o){switch(o){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function My(o,u){if(o===0)switch(u){case"svg":return 1;case"math":return 2;default:return 0}return o===1&&u==="foreignObject"?0:o}function Ep(o,u){return o==="textarea"||o==="noscript"||typeof u.children=="string"||typeof u.children=="number"||typeof u.children=="bigint"||typeof u.dangerouslySetInnerHTML=="object"&&u.dangerouslySetInnerHTML!==null&&u.dangerouslySetInnerHTML.__html!=null}var Tp=null;function nE(){var o=window.event;return o&&o.type==="popstate"?o===Tp?!1:(Tp=o,!0):(Tp=null,!1)}var Dy=typeof setTimeout=="function"?setTimeout:void 0,sE=typeof clearTimeout=="function"?clearTimeout:void 0,Ry=typeof Promise=="function"?Promise:void 0,rE=typeof queueMicrotask=="function"?queueMicrotask:typeof Ry<"u"?function(o){return Ry.resolve(null).then(o).catch(aE)}:Dy;function aE(o){setTimeout(function(){throw o})}function xr(o){return o==="head"}function Ny(o,u){var m=u,A=0;do{var T=m.nextSibling;if(o.removeChild(m),T&&T.nodeType===8)if(m=T.data,m==="/$"||m==="/&"){if(A===0){o.removeChild(T),mo(u);return}A--}else if(m==="$"||m==="$?"||m==="$~"||m==="$!"||m==="&")A++;else if(m==="html")Ul(o.ownerDocument.documentElement);else if(m==="head"){m=o.ownerDocument.head,Ul(m);for(var R=m.firstChild;R;){var L=R.nextSibling,z=R.nodeName;R[nl]||z==="SCRIPT"||z==="STYLE"||z==="LINK"&&R.rel.toLowerCase()==="stylesheet"||m.removeChild(R),R=L}}else m==="body"&&Ul(o.ownerDocument.body);m=T}while(m);mo(u)}function Iy(o,u){var m=o;o=0;do{var A=m.nextSibling;if(m.nodeType===1?u?(m._stashedDisplay=m.style.display,m.style.display="none"):(m.style.display=m._stashedDisplay||"",m.getAttribute("style")===""&&m.removeAttribute("style")):m.nodeType===3&&(u?(m._stashedText=m.nodeValue,m.nodeValue=""):m.nodeValue=m._stashedText||""),A&&A.nodeType===8)if(m=A.data,m==="/$"){if(o===0)break;o--}else m!=="$"&&m!=="$?"&&m!=="$~"&&m!=="$!"||o++;m=A}while(m)}function Mp(o){var u=o.firstChild;for(u&&u.nodeType===10&&(u=u.nextSibling);u;){var m=u;switch(u=u.nextSibling,m.nodeName){case"HTML":case"HEAD":case"BODY":Mp(m),_f(m);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(m.rel.toLowerCase()==="stylesheet")continue}o.removeChild(m)}}function oE(o,u,m,A){for(;o.nodeType===1;){var T=m;if(o.nodeName.toLowerCase()!==u.toLowerCase()){if(!A&&(o.nodeName!=="INPUT"||o.type!=="hidden"))break}else if(A){if(!o[nl])switch(u){case"meta":if(!o.hasAttribute("itemprop"))break;return o;case"link":if(R=o.getAttribute("rel"),R==="stylesheet"&&o.hasAttribute("data-precedence"))break;if(R!==T.rel||o.getAttribute("href")!==(T.href==null||T.href===""?null:T.href)||o.getAttribute("crossorigin")!==(T.crossOrigin==null?null:T.crossOrigin)||o.getAttribute("title")!==(T.title==null?null:T.title))break;return o;case"style":if(o.hasAttribute("data-precedence"))break;return o;case"script":if(R=o.getAttribute("src"),(R!==(T.src==null?null:T.src)||o.getAttribute("type")!==(T.type==null?null:T.type)||o.getAttribute("crossorigin")!==(T.crossOrigin==null?null:T.crossOrigin))&&R&&o.hasAttribute("async")&&!o.hasAttribute("itemprop"))break;return o;default:return o}}else if(u==="input"&&o.type==="hidden"){var R=T.name==null?null:""+T.name;if(T.type==="hidden"&&o.getAttribute("name")===R)return o}else return o;if(o=_n(o.nextSibling),o===null)break}return null}function lE(o,u,m){if(u==="")return null;for(;o.nodeType!==3;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!m||(o=_n(o.nextSibling),o===null))return null;return o}function _y(o,u){for(;o.nodeType!==8;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!u||(o=_n(o.nextSibling),o===null))return null;return o}function Dp(o){return o.data==="$?"||o.data==="$~"}function Rp(o){return o.data==="$!"||o.data==="$?"&&o.ownerDocument.readyState!=="loading"}function cE(o,u){var m=o.ownerDocument;if(o.data==="$~")o._reactRetry=u;else if(o.data!=="$?"||m.readyState!=="loading")u();else{var A=function(){u(),m.removeEventListener("DOMContentLoaded",A)};m.addEventListener("DOMContentLoaded",A),o._reactRetry=A}}function _n(o){for(;o!=null;o=o.nextSibling){var u=o.nodeType;if(u===1||u===3)break;if(u===8){if(u=o.data,u==="$"||u==="$!"||u==="$?"||u==="$~"||u==="&"||u==="F!"||u==="F")break;if(u==="/$"||u==="/&")return null}}return o}var Np=null;function Fy(o){o=o.nextSibling;for(var u=0;o;){if(o.nodeType===8){var m=o.data;if(m==="/$"||m==="/&"){if(u===0)return _n(o.nextSibling);u--}else m!=="$"&&m!=="$!"&&m!=="$?"&&m!=="$~"&&m!=="&"||u++}o=o.nextSibling}return null}function Py(o){o=o.previousSibling;for(var u=0;o;){if(o.nodeType===8){var m=o.data;if(m==="$"||m==="$!"||m==="$?"||m==="$~"||m==="&"){if(u===0)return o;u--}else m!=="/$"&&m!=="/&"||u++}o=o.previousSibling}return null}function By(o,u,m){switch(u=mh(m),o){case"html":if(o=u.documentElement,!o)throw Error(n(452));return o;case"head":if(o=u.head,!o)throw Error(n(453));return o;case"body":if(o=u.body,!o)throw Error(n(454));return o;default:throw Error(n(451))}}function Ul(o){for(var u=o.attributes;u.length;)o.removeAttributeNode(u[0]);_f(o)}var Fn=new Map,Ly=new Set;function ph(o){return typeof o.getRootNode=="function"?o.getRootNode():o.nodeType===9?o:o.ownerDocument}var Ls=H.d;H.d={f:uE,r:hE,D:dE,C:fE,L:mE,m:pE,X:AE,S:gE,M:vE};function uE(){var o=Ls.f(),u=ah();return o||u}function hE(o){var u=_a(o);u!==null&&u.tag===5&&u.type==="form"?$A(u):Ls.r(o)}var uo=typeof document>"u"?null:document;function ky(o,u,m){var A=uo;if(A&&typeof u=="string"&&u){var T=En(u);T='link[rel="'+o+'"][href="'+T+'"]',typeof m=="string"&&(T+='[crossorigin="'+m+'"]'),Ly.has(T)||(Ly.add(T),o={rel:o,crossOrigin:m,href:u},A.querySelector(T)===null&&(u=A.createElement("link"),Mi(u,"link",o),di(u),A.head.appendChild(u)))}}function dE(o){Ls.D(o),ky("dns-prefetch",o,null)}function fE(o,u){Ls.C(o,u),ky("preconnect",o,u)}function mE(o,u,m){Ls.L(o,u,m);var A=uo;if(A&&o&&u){var T='link[rel="preload"][as="'+En(u)+'"]';u==="image"&&m&&m.imageSrcSet?(T+='[imagesrcset="'+En(m.imageSrcSet)+'"]',typeof m.imageSizes=="string"&&(T+='[imagesizes="'+En(m.imageSizes)+'"]')):T+='[href="'+En(o)+'"]';var R=T;switch(u){case"style":R=ho(o);break;case"script":R=fo(o)}Fn.has(R)||(o=f({rel:"preload",href:u==="image"&&m&&m.imageSrcSet?void 0:o,as:u},m),Fn.set(R,o),A.querySelector(T)!==null||u==="style"&&A.querySelector(Vl(R))||u==="script"&&A.querySelector(jl(R))||(u=A.createElement("link"),Mi(u,"link",o),di(u),A.head.appendChild(u)))}}function pE(o,u){Ls.m(o,u);var m=uo;if(m&&o){var A=u&&typeof u.as=="string"?u.as:"script",T='link[rel="modulepreload"][as="'+En(A)+'"][href="'+En(o)+'"]',R=T;switch(A){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":R=fo(o)}if(!Fn.has(R)&&(o=f({rel:"modulepreload",href:o},u),Fn.set(R,o),m.querySelector(T)===null)){switch(A){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(m.querySelector(jl(R)))return}A=m.createElement("link"),Mi(A,"link",o),di(A),m.head.appendChild(A)}}}function gE(o,u,m){Ls.S(o,u,m);var A=uo;if(A&&o){var T=Fa(A).hoistableStyles,R=ho(o);u=u||"default";var L=T.get(R);if(!L){var z={loading:0,preload:null};if(L=A.querySelector(Vl(R)))z.loading=5;else{o=f({rel:"stylesheet",href:o,"data-precedence":u},m),(m=Fn.get(R))&&Ip(o,m);var Z=L=A.createElement("link");di(Z),Mi(Z,"link",o),Z._p=new Promise(function(re,ue){Z.onload=re,Z.onerror=ue}),Z.addEventListener("load",function(){z.loading|=1}),Z.addEventListener("error",function(){z.loading|=2}),z.loading|=4,gh(L,u,A)}L={type:"stylesheet",instance:L,count:1,state:z},T.set(R,L)}}}function AE(o,u){Ls.X(o,u);var m=uo;if(m&&o){var A=Fa(m).hoistableScripts,T=fo(o),R=A.get(T);R||(R=m.querySelector(jl(T)),R||(o=f({src:o,async:!0},u),(u=Fn.get(T))&&_p(o,u),R=m.createElement("script"),di(R),Mi(R,"link",o),m.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},A.set(T,R))}}function vE(o,u){Ls.M(o,u);var m=uo;if(m&&o){var A=Fa(m).hoistableScripts,T=fo(o),R=A.get(T);R||(R=m.querySelector(jl(T)),R||(o=f({src:o,async:!0,type:"module"},u),(u=Fn.get(T))&&_p(o,u),R=m.createElement("script"),di(R),Mi(R,"link",o),m.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},A.set(T,R))}}function Oy(o,u,m,A){var T=(T=he.current)?ph(T):null;if(!T)throw Error(n(446));switch(o){case"meta":case"title":return null;case"style":return typeof m.precedence=="string"&&typeof m.href=="string"?(u=ho(m.href),m=Fa(T).hoistableStyles,A=m.get(u),A||(A={type:"style",instance:null,count:0,state:null},m.set(u,A)),A):{type:"void",instance:null,count:0,state:null};case"link":if(m.rel==="stylesheet"&&typeof m.href=="string"&&typeof m.precedence=="string"){o=ho(m.href);var R=Fa(T).hoistableStyles,L=R.get(o);if(L||(T=T.ownerDocument||T,L={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},R.set(o,L),(R=T.querySelector(Vl(o)))&&!R._p&&(L.instance=R,L.state.loading=5),Fn.has(o)||(m={rel:"preload",as:"style",href:m.href,crossOrigin:m.crossOrigin,integrity:m.integrity,media:m.media,hrefLang:m.hrefLang,referrerPolicy:m.referrerPolicy},Fn.set(o,m),R||yE(T,o,m,L.state))),u&&A===null)throw Error(n(528,""));return L}if(u&&A!==null)throw Error(n(529,""));return null;case"script":return u=m.async,m=m.src,typeof m=="string"&&u&&typeof u!="function"&&typeof u!="symbol"?(u=fo(m),m=Fa(T).hoistableScripts,A=m.get(u),A||(A={type:"script",instance:null,count:0,state:null},m.set(u,A)),A):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,o))}}function ho(o){return'href="'+En(o)+'"'}function Vl(o){return'link[rel="stylesheet"]['+o+"]"}function Uy(o){return f({},o,{"data-precedence":o.precedence,precedence:null})}function yE(o,u,m,A){o.querySelector('link[rel="preload"][as="style"]['+u+"]")?A.loading=1:(u=o.createElement("link"),A.preload=u,u.addEventListener("load",function(){return A.loading|=1}),u.addEventListener("error",function(){return A.loading|=2}),Mi(u,"link",m),di(u),o.head.appendChild(u))}function fo(o){return'[src="'+En(o)+'"]'}function jl(o){return"script[async]"+o}function Vy(o,u,m){if(u.count++,u.instance===null)switch(u.type){case"style":var A=o.querySelector('style[data-href~="'+En(m.href)+'"]');if(A)return u.instance=A,di(A),A;var T=f({},m,{"data-href":m.href,"data-precedence":m.precedence,href:null,precedence:null});return A=(o.ownerDocument||o).createElement("style"),di(A),Mi(A,"style",T),gh(A,m.precedence,o),u.instance=A;case"stylesheet":T=ho(m.href);var R=o.querySelector(Vl(T));if(R)return u.state.loading|=4,u.instance=R,di(R),R;A=Uy(m),(T=Fn.get(T))&&Ip(A,T),R=(o.ownerDocument||o).createElement("link"),di(R);var L=R;return L._p=new Promise(function(z,Z){L.onload=z,L.onerror=Z}),Mi(R,"link",A),u.state.loading|=4,gh(R,m.precedence,o),u.instance=R;case"script":return R=fo(m.src),(T=o.querySelector(jl(R)))?(u.instance=T,di(T),T):(A=m,(T=Fn.get(R))&&(A=f({},m),_p(A,T)),o=o.ownerDocument||o,T=o.createElement("script"),di(T),Mi(T,"link",A),o.head.appendChild(T),u.instance=T);case"void":return null;default:throw Error(n(443,u.type))}else u.type==="stylesheet"&&(u.state.loading&4)===0&&(A=u.instance,u.state.loading|=4,gh(A,m.precedence,o));return u.instance}function gh(o,u,m){for(var A=m.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),T=A.length?A[A.length-1]:null,R=T,L=0;L<A.length;L++){var z=A[L];if(z.dataset.precedence===u)R=z;else if(R!==T)break}R?R.parentNode.insertBefore(o,R.nextSibling):(u=m.nodeType===9?m.head:m,u.insertBefore(o,u.firstChild))}function Ip(o,u){o.crossOrigin==null&&(o.crossOrigin=u.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=u.referrerPolicy),o.title==null&&(o.title=u.title)}function _p(o,u){o.crossOrigin==null&&(o.crossOrigin=u.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=u.referrerPolicy),o.integrity==null&&(o.integrity=u.integrity)}var Ah=null;function jy(o,u,m){if(Ah===null){var A=new Map,T=Ah=new Map;T.set(m,A)}else T=Ah,A=T.get(m),A||(A=new Map,T.set(m,A));if(A.has(o))return A;for(A.set(o,null),m=m.getElementsByTagName(o),T=0;T<m.length;T++){var R=m[T];if(!(R[nl]||R[Si]||o==="link"&&R.getAttribute("rel")==="stylesheet")&&R.namespaceURI!=="http://www.w3.org/2000/svg"){var L=R.getAttribute(u)||"";L=o+L;var z=A.get(L);z?z.push(R):A.set(L,[R])}}return A}function zy(o,u,m){o=o.ownerDocument||o,o.head.insertBefore(m,u==="title"?o.querySelector("head > title"):null)}function xE(o,u,m){if(m===1||u.itemProp!=null)return!1;switch(o){case"meta":case"title":return!0;case"style":if(typeof u.precedence!="string"||typeof u.href!="string"||u.href==="")break;return!0;case"link":if(typeof u.rel!="string"||typeof u.href!="string"||u.href===""||u.onLoad||u.onError)break;return u.rel==="stylesheet"?(o=u.disabled,typeof u.precedence=="string"&&o==null):!0;case"script":if(u.async&&typeof u.async!="function"&&typeof u.async!="symbol"&&!u.onLoad&&!u.onError&&u.src&&typeof u.src=="string")return!0}return!1}function Gy(o){return!(o.type==="stylesheet"&&(o.state.loading&3)===0)}function bE(o,u,m,A){if(m.type==="stylesheet"&&(typeof A.media!="string"||matchMedia(A.media).matches!==!1)&&(m.state.loading&4)===0){if(m.instance===null){var T=ho(A.href),R=u.querySelector(Vl(T));if(R){u=R._p,u!==null&&typeof u=="object"&&typeof u.then=="function"&&(o.count++,o=vh.bind(o),u.then(o,o)),m.state.loading|=4,m.instance=R,di(R);return}R=u.ownerDocument||u,A=Uy(A),(T=Fn.get(T))&&Ip(A,T),R=R.createElement("link"),di(R);var L=R;L._p=new Promise(function(z,Z){L.onload=z,L.onerror=Z}),Mi(R,"link",A),m.instance=R}o.stylesheets===null&&(o.stylesheets=new Map),o.stylesheets.set(m,u),(u=m.state.preload)&&(m.state.loading&3)===0&&(o.count++,m=vh.bind(o),u.addEventListener("load",m),u.addEventListener("error",m))}}var Fp=0;function wE(o,u){return o.stylesheets&&o.count===0&&xh(o,o.stylesheets),0<o.count||0<o.imgCount?function(m){var A=setTimeout(function(){if(o.stylesheets&&xh(o,o.stylesheets),o.unsuspend){var R=o.unsuspend;o.unsuspend=null,R()}},6e4+u);0<o.imgBytes&&Fp===0&&(Fp=62500*iE());var T=setTimeout(function(){if(o.waitingForImages=!1,o.count===0&&(o.stylesheets&&xh(o,o.stylesheets),o.unsuspend)){var R=o.unsuspend;o.unsuspend=null,R()}},(o.imgBytes>Fp?50:800)+u);return o.unsuspend=m,function(){o.unsuspend=null,clearTimeout(A),clearTimeout(T)}}:null}function vh(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)xh(this,this.stylesheets);else if(this.unsuspend){var o=this.unsuspend;this.unsuspend=null,o()}}}var yh=null;function xh(o,u){o.stylesheets=null,o.unsuspend!==null&&(o.count++,yh=new Map,u.forEach(SE,o),yh=null,vh.call(o))}function SE(o,u){if(!(u.state.loading&4)){var m=yh.get(o);if(m)var A=m.get(null);else{m=new Map,yh.set(o,m);for(var T=o.querySelectorAll("link[data-precedence],style[data-precedence]"),R=0;R<T.length;R++){var L=T[R];(L.nodeName==="LINK"||L.getAttribute("media")!=="not all")&&(m.set(L.dataset.precedence,L),A=L)}A&&m.set(null,A)}T=u.instance,L=T.getAttribute("data-precedence"),R=m.get(L)||A,R===A&&m.set(null,T),m.set(L,T),this.count++,A=vh.bind(this),T.addEventListener("load",A),T.addEventListener("error",A),R?R.parentNode.insertBefore(T,R.nextSibling):(o=o.nodeType===9?o.head:o,o.insertBefore(T,o.firstChild)),u.state.loading|=4}}var zl={$$typeof:C,Provider:null,Consumer:null,_currentValue:Y,_currentValue2:Y,_threadCount:0};function CE(o,u,m,A,T,R,L,z,Z){this.tag=1,this.containerInfo=o,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Df(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Df(0),this.hiddenUpdates=Df(null),this.identifierPrefix=A,this.onUncaughtError=T,this.onCaughtError=R,this.onRecoverableError=L,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Z,this.incompleteTransitions=new Map}function Hy(o,u,m,A,T,R,L,z,Z,re,ue,fe){return o=new CE(o,u,m,L,Z,re,ue,fe,z),u=1,R===!0&&(u|=24),R=on(3,null,null,u),o.current=R,R.stateNode=o,u=dm(),u.refCount++,o.pooledCache=u,u.refCount++,R.memoizedState={element:A,isDehydrated:m,cache:u},gm(R),o}function Yy(o){return o?(o=Ga,o):Ga}function qy(o,u,m,A,T,R){T=Yy(T),A.context===null?A.context=T:A.pendingContext=T,A=cr(u),A.payload={element:m},R=R===void 0?null:R,R!==null&&(A.callback=R),m=ur(o,A,u),m!==null&&(Zi(m,o,u),xl(m,o,u))}function Xy(o,u){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var m=o.retryLane;o.retryLane=m!==0&&m<u?m:u}}function Pp(o,u){Xy(o,u),(o=o.alternate)&&Xy(o,u)}function Wy(o){if(o.tag===13||o.tag===31){var u=Hr(o,67108864);u!==null&&Zi(u,o,67108864),Pp(o,67108864)}}function Ky(o){if(o.tag===13||o.tag===31){var u=dn();u=Rf(u);var m=Hr(o,u);m!==null&&Zi(m,o,u),Pp(o,u)}}var bh=!0;function EE(o,u,m,A){var T=U.T;U.T=null;var R=H.p;try{H.p=2,Bp(o,u,m,A)}finally{H.p=R,U.T=T}}function TE(o,u,m,A){var T=U.T;U.T=null;var R=H.p;try{H.p=8,Bp(o,u,m,A)}finally{H.p=R,U.T=T}}function Bp(o,u,m,A){if(bh){var T=Lp(A);if(T===null)bp(o,u,A,wh,m),Zy(o,A);else if(DE(T,o,u,m,A))A.stopPropagation();else if(Zy(o,A),u&4&&-1<ME.indexOf(o)){for(;T!==null;){var R=_a(T);if(R!==null)switch(R.tag){case 3:if(R=R.stateNode,R.current.memoizedState.isDehydrated){var L=Hn(R.pendingLanes);if(L!==0){var z=R;for(z.pendingLanes|=2,z.entangledLanes|=2;L;){var Z=1<<31-dt(L);z.entanglements[1]|=Z,L&=~Z}rs(R),(vt&6)===0&&(sh=wi()+500,Ll(0))}}break;case 31:case 13:z=Hr(R,2),z!==null&&Zi(z,R,2),ah(),Pp(R,2)}if(R=Lp(A),R===null&&bp(o,u,A,wh,m),R===T)break;T=R}T!==null&&A.stopPropagation()}else bp(o,u,A,null,m)}}function Lp(o){return o=Of(o),kp(o)}var wh=null;function kp(o){if(wh=null,o=Ia(o),o!==null){var u=r(o);if(u===null)o=null;else{var m=u.tag;if(m===13){if(o=a(u),o!==null)return o;o=null}else if(m===31){if(o=l(u),o!==null)return o;o=null}else if(m===3){if(u.stateNode.current.memoizedState.isDehydrated)return u.tag===3?u.stateNode.containerInfo:null;o=null}else u!==o&&(o=null)}}return wh=o,null}function Qy(o){switch(o){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(tl()){case As:return 2;case er:return 8;case ne:case ye:return 32;case me:return 268435456;default:return 32}default:return 32}}var Op=!1,br=null,wr=null,Sr=null,Gl=new Map,Hl=new Map,Cr=[],ME="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Zy(o,u){switch(o){case"focusin":case"focusout":br=null;break;case"dragenter":case"dragleave":wr=null;break;case"mouseover":case"mouseout":Sr=null;break;case"pointerover":case"pointerout":Gl.delete(u.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hl.delete(u.pointerId)}}function Yl(o,u,m,A,T,R){return o===null||o.nativeEvent!==R?(o={blockedOn:u,domEventName:m,eventSystemFlags:A,nativeEvent:R,targetContainers:[T]},u!==null&&(u=_a(u),u!==null&&Wy(u)),o):(o.eventSystemFlags|=A,u=o.targetContainers,T!==null&&u.indexOf(T)===-1&&u.push(T),o)}function DE(o,u,m,A,T){switch(u){case"focusin":return br=Yl(br,o,u,m,A,T),!0;case"dragenter":return wr=Yl(wr,o,u,m,A,T),!0;case"mouseover":return Sr=Yl(Sr,o,u,m,A,T),!0;case"pointerover":var R=T.pointerId;return Gl.set(R,Yl(Gl.get(R)||null,o,u,m,A,T)),!0;case"gotpointercapture":return R=T.pointerId,Hl.set(R,Yl(Hl.get(R)||null,o,u,m,A,T)),!0}return!1}function Jy(o){var u=Ia(o.target);if(u!==null){var m=r(u);if(m!==null){if(u=m.tag,u===13){if(u=a(m),u!==null){o.blockedOn=u,d2(o.priority,function(){Ky(m)});return}}else if(u===31){if(u=l(m),u!==null){o.blockedOn=u,d2(o.priority,function(){Ky(m)});return}}else if(u===3&&m.stateNode.current.memoizedState.isDehydrated){o.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}o.blockedOn=null}function Sh(o){if(o.blockedOn!==null)return!1;for(var u=o.targetContainers;0<u.length;){var m=Lp(o.nativeEvent);if(m===null){m=o.nativeEvent;var A=new m.constructor(m.type,m);kf=A,m.target.dispatchEvent(A),kf=null}else return u=_a(m),u!==null&&Wy(u),o.blockedOn=m,!1;u.shift()}return!0}function $y(o,u,m){Sh(o)&&m.delete(u)}function RE(){Op=!1,br!==null&&Sh(br)&&(br=null),wr!==null&&Sh(wr)&&(wr=null),Sr!==null&&Sh(Sr)&&(Sr=null),Gl.forEach($y),Hl.forEach($y)}function Ch(o,u){o.blockedOn===u&&(o.blockedOn=null,Op||(Op=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,RE)))}var Eh=null;function ex(o){Eh!==o&&(Eh=o,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){Eh===o&&(Eh=null);for(var u=0;u<o.length;u+=3){var m=o[u],A=o[u+1],T=o[u+2];if(typeof A!="function"){if(kp(A||m)===null)continue;break}var R=_a(m);R!==null&&(o.splice(u,3),u-=3,Lm(R,{pending:!0,data:T,method:m.method,action:A},A,T))}}))}function mo(o){function u(Z){return Ch(Z,o)}br!==null&&Ch(br,o),wr!==null&&Ch(wr,o),Sr!==null&&Ch(Sr,o),Gl.forEach(u),Hl.forEach(u);for(var m=0;m<Cr.length;m++){var A=Cr[m];A.blockedOn===o&&(A.blockedOn=null)}for(;0<Cr.length&&(m=Cr[0],m.blockedOn===null);)Jy(m),m.blockedOn===null&&Cr.shift();if(m=(o.ownerDocument||o).$$reactFormReplay,m!=null)for(A=0;A<m.length;A+=3){var T=m[A],R=m[A+1],L=T[Yi]||null;if(typeof R=="function")L||ex(m);else if(L){var z=null;if(R&&R.hasAttribute("formAction")){if(T=R,L=R[Yi]||null)z=L.formAction;else if(kp(T)!==null)continue}else z=L.action;typeof z=="function"?m[A+1]=z:(m.splice(A,3),A-=3),ex(m)}}}function tx(){function o(R){R.canIntercept&&R.info==="react-transition"&&R.intercept({handler:function(){return new Promise(function(L){return T=L})},focusReset:"manual",scroll:"manual"})}function u(){T!==null&&(T(),T=null),A||setTimeout(m,20)}function m(){if(!A&&!navigation.transition){var R=navigation.currentEntry;R&&R.url!=null&&navigation.navigate(R.url,{state:R.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var A=!1,T=null;return navigation.addEventListener("navigate",o),navigation.addEventListener("navigatesuccess",u),navigation.addEventListener("navigateerror",u),setTimeout(m,100),function(){A=!0,navigation.removeEventListener("navigate",o),navigation.removeEventListener("navigatesuccess",u),navigation.removeEventListener("navigateerror",u),T!==null&&(T(),T=null)}}}function Up(o){this._internalRoot=o}Th.prototype.render=Up.prototype.render=function(o){var u=this._internalRoot;if(u===null)throw Error(n(409));var m=u.current,A=dn();qy(m,A,o,u,null,null)},Th.prototype.unmount=Up.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var u=o.containerInfo;qy(o.current,2,null,o,null,null),ah(),u[Na]=null}};function Th(o){this._internalRoot=o}Th.prototype.unstable_scheduleHydration=function(o){if(o){var u=h2();o={blockedOn:null,target:o,priority:u};for(var m=0;m<Cr.length&&u!==0&&u<Cr[m].priority;m++);Cr.splice(m,0,o),m===0&&Jy(o)}};var ix=e.version;if(ix!=="19.2.3")throw Error(n(527,ix,"19.2.3"));H.findDOMNode=function(o){var u=o._reactInternals;if(u===void 0)throw typeof o.render=="function"?Error(n(188)):(o=Object.keys(o).join(","),Error(n(268,o)));return o=h(u),o=o!==null?d(o):null,o=o===null?null:o.stateNode,o};var NE={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:U,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Mh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Mh.isDisabled&&Mh.supportsFiber)try{Le=Mh.inject(NE),ke=Mh}catch{}}return Xl.createRoot=function(o,u){if(!s(o))throw Error(n(299));var m=!1,A="",T=cv,R=uv,L=hv;return u!=null&&(u.unstable_strictMode===!0&&(m=!0),u.identifierPrefix!==void 0&&(A=u.identifierPrefix),u.onUncaughtError!==void 0&&(T=u.onUncaughtError),u.onCaughtError!==void 0&&(R=u.onCaughtError),u.onRecoverableError!==void 0&&(L=u.onRecoverableError)),u=Hy(o,1,!1,null,null,m,A,null,T,R,L,tx),o[Na]=u.current,xp(o),new Up(u)},Xl.hydrateRoot=function(o,u,m){if(!s(o))throw Error(n(299));var A=!1,T="",R=cv,L=uv,z=hv,Z=null;return m!=null&&(m.unstable_strictMode===!0&&(A=!0),m.identifierPrefix!==void 0&&(T=m.identifierPrefix),m.onUncaughtError!==void 0&&(R=m.onUncaughtError),m.onCaughtError!==void 0&&(L=m.onCaughtError),m.onRecoverableError!==void 0&&(z=m.onRecoverableError),m.formState!==void 0&&(Z=m.formState)),u=Hy(o,1,!0,u,m??null,A,T,Z,R,L,z,tx),u.context=Yy(null),m=u.current,A=dn(),A=Rf(A),T=cr(A),T.callback=null,ur(m,T,A),m=A,u.current.lanes=m,il(u,m),rs(u),o[Na]=u.current,xp(o),new Th(u)},Xl.version="19.2.3",Xl}var mx;function VE(){if(mx)return Gp.exports;mx=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Gp.exports=UE(),Gp.exports}var jE=VE(),Xp={exports:{}},Wp={};var px;function zE(){if(px)return Wp;px=1;var i=Yd();function e(c,h){return c===h&&(c!==0||1/c===1/h)||c!==c&&h!==h}var t=typeof Object.is=="function"?Object.is:e,n=i.useSyncExternalStore,s=i.useRef,r=i.useEffect,a=i.useMemo,l=i.useDebugValue;return Wp.useSyncExternalStoreWithSelector=function(c,h,d,f,p){var g=s(null);if(g.current===null){var y={hasValue:!1,value:null};g.current=y}else y=g.current;g=a(function(){function b(D){if(!w){if(w=!0,S=D,D=f(D),p!==void 0&&y.hasValue){var M=y.value;if(p(M,D))return C=M}return C=D}if(M=C,t(S,D))return M;var N=f(D);return p!==void 0&&p(M,N)?(S=D,M):(S=D,C=N)}var w=!1,S,C,E=d===void 0?null:d;return[function(){return b(h())},E===null?void 0:function(){return b(E())}]},[h,d,f,p]);var x=n(c,g[0],g[1]);return r(function(){y.hasValue=!0,y.value=x},[x]),l(x),x},Wp}var gx;function GE(){return gx||(gx=1,Xp.exports=zE()),Xp.exports}var HE=GE();function Yw(i){i()}function YE(){let i=null,e=null;return{clear(){i=null,e=null},notify(){Yw(()=>{let t=i;for(;t;)t.callback(),t=t.next})},get(){const t=[];let n=i;for(;n;)t.push(n),n=n.next;return t},subscribe(t){let n=!0;const s=e={callback:t,next:null,prev:e};return s.prev?s.prev.next=s:i=s,function(){!n||i===null||(n=!1,s.next?s.next.prev=s.prev:e=s.prev,s.prev?s.prev.next=s.next:i=s.next)}}}}var Ax={notify(){},get:()=>[]};function qE(i,e){let t,n=Ax,s=0,r=!1;function a(x){d();const b=n.subscribe(x);let w=!1;return()=>{w||(w=!0,b(),f())}}function l(){n.notify()}function c(){y.onStateChange&&y.onStateChange()}function h(){return r}function d(){s++,t||(t=i.subscribe(c),n=YE())}function f(){s--,t&&s===0&&(t(),t=void 0,n.clear(),n=Ax)}function p(){r||(r=!0,d())}function g(){r&&(r=!1,f())}const y={addNestedSub:a,notifyNestedSubs:l,handleChangeWrapper:c,isSubscribed:h,trySubscribe:p,tryUnsubscribe:g,getListeners:()=>n};return y}var XE=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",WE=XE(),KE=()=>typeof navigator<"u"&&navigator.product==="ReactNative",QE=KE(),ZE=()=>WE||QE?V.useLayoutEffect:V.useEffect,JE=ZE();function vx(i,e){return i===e?i!==0||e!==0||1/i===1/e:i!==i&&e!==e}function xc(i,e){if(vx(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;const t=Object.keys(i),n=Object.keys(e);if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(!Object.prototype.hasOwnProperty.call(e,t[s])||!vx(i[t[s]],e[t[s]]))return!1;return!0}var $E=Symbol.for("react-redux-context"),eT=typeof globalThis<"u"?globalThis:{};function tT(){if(!V.createContext)return{};const i=eT[$E]??=new Map;let e=i.get(V.createContext);return e||(e=V.createContext(null),i.set(V.createContext,e)),e}var Br=tT();function iT(i){const{children:e,context:t,serverState:n,store:s}=i,r=V.useMemo(()=>{const c=qE(s);return{store:s,subscription:c,getServerState:n?()=>n:void 0}},[s,n]),a=V.useMemo(()=>s.getState(),[s]);JE(()=>{const{subscription:c}=r;return c.onStateChange=c.notifyNestedSubs,c.trySubscribe(),a!==s.getState()&&c.notifyNestedSubs(),()=>{c.tryUnsubscribe(),c.onStateChange=void 0}},[r,a]);const l=t||Br;return V.createElement(l.Provider,{value:r},e)}var nT=iT;function Ng(i=Br){return function(){return V.useContext(i)}}var qw=Ng();function Xw(i=Br){const e=i===Br?qw:Ng(i),t=()=>{const{store:n}=e();return n};return Object.assign(t,{withTypes:()=>t}),t}var Ww=Xw();function sT(i=Br){const e=i===Br?Ww:Xw(i),t=()=>e().dispatch;return Object.assign(t,{withTypes:()=>t}),t}var rT=sT(),aT=(i,e)=>i===e;function oT(i=Br){const e=i===Br?qw:Ng(i),t=(n,s={})=>{const{equalityFn:r=aT}=typeof s=="function"?{equalityFn:s}:s,a=e(),{store:l,subscription:c,getServerState:h}=a;V.useRef(!0);const d=V.useCallback({[n.name](p){return n(p)}}[n.name],[n]),f=HE.useSyncExternalStoreWithSelector(c.addNestedSub,l.getState,h||l.getState,d,r);return V.useDebugValue(f),f};return Object.assign(t,{withTypes:()=>t}),t}var lT=oT(),cT=Yw;var yx="popstate";function uT(i={}){function e(n,s){let{pathname:r,search:a,hash:l}=n.location;return j0("",{pathname:r,search:a,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(n,s){return typeof s=="string"?s:Nc(s)}return dT(e,t,null,i)}function zt(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function jn(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function hT(){return Math.random().toString(36).substring(2,10)}function xx(i,e){return{usr:i.state,key:i.key,idx:e}}function j0(i,e,t=null,n){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof e=="string"?Ho(e):e,state:t,key:e&&e.key||n||hT()}}function Nc({pathname:i="/",search:e="",hash:t=""}){return e&&e!=="?"&&(i+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(i+=t.charAt(0)==="#"?t:"#"+t),i}function Ho(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substring(t),i=i.substring(0,t));let n=i.indexOf("?");n>=0&&(e.search=i.substring(n),i=i.substring(0,n)),i&&(e.pathname=i)}return e}function dT(i,e,t,n={}){let{window:s=document.defaultView,v5Compat:r=!1}=n,a=s.history,l="POP",c=null,h=d();h==null&&(h=0,a.replaceState({...a.state,idx:h},""));function d(){return(a.state||{idx:null}).idx}function f(){l="POP";let b=d(),w=b==null?null:b-h;h=b,c&&c({action:l,location:x.location,delta:w})}function p(b,w){l="PUSH";let S=j0(x.location,b,w);h=d()+1;let C=xx(S,h),E=x.createHref(S);try{a.pushState(C,"",E)}catch(D){if(D instanceof DOMException&&D.name==="DataCloneError")throw D;s.location.assign(E)}r&&c&&c({action:l,location:x.location,delta:1})}function g(b,w){l="REPLACE";let S=j0(x.location,b,w);h=d();let C=xx(S,h),E=x.createHref(S);a.replaceState(C,"",E),r&&c&&c({action:l,location:x.location,delta:0})}function y(b){return fT(b)}let x={get action(){return l},get location(){return i(s,a)},listen(b){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(yx,f),c=b,()=>{s.removeEventListener(yx,f),c=null}},createHref(b){return e(s,b)},createURL:y,encodeLocation(b){let w=y(b);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:p,replace:g,go(b){return a.go(b)}};return x}function fT(i,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),zt(t,"No window.location.(origin|href) available to create URL");let n=typeof i=="string"?i:Nc(i);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=t+n),new URL(n,t)}function Kw(i,e,t="/"){return mT(i,e,t,!1)}function mT(i,e,t,n){let s=typeof e=="string"?Ho(e):e,r=Xs(s.pathname||"/",t);if(r==null)return null;let a=Qw(i);pT(a);let l=null;for(let c=0;l==null&&c<a.length;++c){let h=TT(r);l=CT(a[c],h,n)}return l}function Qw(i,e=[],t=[],n="",s=!1){let r=(a,l,c=s,h)=>{let d={relativePath:h===void 0?a.path||"":h,caseSensitive:a.caseSensitive===!0,childrenIndex:l,route:a};if(d.relativePath.startsWith("/")){if(!d.relativePath.startsWith(n)&&c)return;zt(d.relativePath.startsWith(n),`Absolute route path "${d.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),d.relativePath=d.relativePath.slice(n.length)}let f=Ys([n,d.relativePath]),p=t.concat(d);a.children&&a.children.length>0&&(zt(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${f}".`),Qw(a.children,e,p,f,c)),!(a.path==null&&!a.index)&&e.push({path:f,score:wT(f,a.index),routesMeta:p})};return i.forEach((a,l)=>{if(a.path===""||!a.path?.includes("?"))r(a,l);else for(let c of Zw(a.path))r(a,l,!0,c)}),e}function Zw(i){let e=i.split("/");if(e.length===0)return[];let[t,...n]=e,s=t.endsWith("?"),r=t.replace(/\?$/,"");if(n.length===0)return s?[r,""]:[r];let a=Zw(n.join("/")),l=[];return l.push(...a.map(c=>c===""?r:[r,c].join("/"))),s&&l.push(...a),l.map(c=>i.startsWith("/")&&c===""?"/":c)}function pT(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:ST(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}var gT=/^:[\w-]+$/,AT=3,vT=2,yT=1,xT=10,bT=-2,bx=i=>i==="*";function wT(i,e){let t=i.split("/"),n=t.length;return t.some(bx)&&(n+=bT),e&&(n+=vT),t.filter(s=>!bx(s)).reduce((s,r)=>s+(gT.test(r)?AT:r===""?yT:xT),n)}function ST(i,e){return i.length===e.length&&i.slice(0,-1).every((n,s)=>n===e[s])?i[i.length-1]-e[e.length-1]:0}function CT(i,e,t=!1){let{routesMeta:n}=i,s={},r="/",a=[];for(let l=0;l<n.length;++l){let c=n[l],h=l===n.length-1,d=r==="/"?e:e.slice(r.length)||"/",f=xd({path:c.relativePath,caseSensitive:c.caseSensitive,end:h},d),p=c.route;if(!f&&h&&t&&!n[n.length-1].route.index&&(f=xd({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},d)),!f)return null;Object.assign(s,f.params),a.push({params:s,pathname:Ys([r,f.pathname]),pathnameBase:NT(Ys([r,f.pathnameBase])),route:p}),f.pathnameBase!=="/"&&(r=Ys([r,f.pathnameBase]))}return a}function xd(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,n]=ET(i.path,i.caseSensitive,i.end),s=e.match(t);if(!s)return null;let r=s[0],a=r.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:n.reduce((h,{paramName:d,isOptional:f},p)=>{if(d==="*"){let y=l[p]||"";a=r.slice(0,r.length-y.length).replace(/(.)\/+$/,"$1")}const g=l[p];return f&&!g?h[d]=void 0:h[d]=(g||"").replace(/%2F/g,"/"),h},{}),pathname:r,pathnameBase:a,pattern:i}}function ET(i,e=!1,t=!0){jn(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let n=[],s="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,c)=>(n.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return i.endsWith("*")?(n.push({paramName:"*"}),s+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":i!==""&&i!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),n]}function TT(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return jn(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),i}}function Xs(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=i.charAt(t);return n&&n!=="/"?null:i.slice(t)||"/"}var Jw=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,MT=i=>Jw.test(i);function DT(i,e="/"){let{pathname:t,search:n="",hash:s=""}=typeof i=="string"?Ho(i):i,r;if(t)if(MT(t))r=t;else{if(t.includes("//")){let a=t;t=t.replace(/\/\/+/g,"/"),jn(!1,`Pathnames cannot have embedded double slashes - normalizing ${a} -> ${t}`)}t.startsWith("/")?r=wx(t.substring(1),"/"):r=wx(t,e)}else r=e;return{pathname:r,search:IT(n),hash:_T(s)}}function wx(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function Kp(i,e,t,n){return`Cannot include a '${i}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function RT(i){return i.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Ig(i){let e=RT(i);return e.map((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)}function _g(i,e,t,n=!1){let s;typeof i=="string"?s=Ho(i):(s={...i},zt(!s.pathname||!s.pathname.includes("?"),Kp("?","pathname","search",s)),zt(!s.pathname||!s.pathname.includes("#"),Kp("#","pathname","hash",s)),zt(!s.search||!s.search.includes("#"),Kp("#","search","hash",s)));let r=i===""||s.pathname==="",a=r?"/":s.pathname,l;if(a==null)l=t;else{let f=e.length-1;if(!n&&a.startsWith("..")){let p=a.split("/");for(;p[0]==="..";)p.shift(),f-=1;s.pathname=p.join("/")}l=f>=0?e[f]:"/"}let c=DT(s,l),h=a&&a!=="/"&&a.endsWith("/"),d=(r||a===".")&&t.endsWith("/");return!c.pathname.endsWith("/")&&(h||d)&&(c.pathname+="/"),c}var Ys=i=>i.join("/").replace(/\/\/+/g,"/"),NT=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),IT=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,_T=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i,FT=class{constructor(i,e,t,n=!1){this.status=i,this.statusText=e||"",this.internal=n,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function PT(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}function BT(i){return i.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var $w=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function e5(i,e){let t=i;if(typeof t!="string"||!Jw.test(t))return{absoluteURL:void 0,isExternal:!1,to:t};let n=t,s=!1;if($w)try{let r=new URL(window.location.href),a=t.startsWith("//")?new URL(r.protocol+t):new URL(t),l=Xs(a.pathname,e);a.origin===r.origin&&l!=null?t=l+a.search+a.hash:s=!0}catch{jn(!1,`<Link to="${t}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:n,isExternal:s,to:t}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var t5=["POST","PUT","PATCH","DELETE"];new Set(t5);var LT=["GET",...t5];new Set(LT);var Yo=V.createContext(null);Yo.displayName="DataRouter";var Xd=V.createContext(null);Xd.displayName="DataRouterState";var kT=V.createContext(!1),i5=V.createContext({isTransitioning:!1});i5.displayName="ViewTransition";var OT=V.createContext(new Map);OT.displayName="Fetchers";var UT=V.createContext(null);UT.displayName="Await";var xn=V.createContext(null);xn.displayName="Navigation";var Yc=V.createContext(null);Yc.displayName="Location";var zn=V.createContext({outlet:null,matches:[],isDataRoute:!1});zn.displayName="Route";var Fg=V.createContext(null);Fg.displayName="RouteError";var n5="REACT_ROUTER_ERROR",VT="REDIRECT",jT="ROUTE_ERROR_RESPONSE";function zT(i){if(i.startsWith(`${n5}:${VT}:{`))try{let e=JSON.parse(i.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function GT(i){if(i.startsWith(`${n5}:${jT}:{`))try{let e=JSON.parse(i.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new FT(e.status,e.statusText,e.data)}catch{}}function HT(i,{relative:e}={}){zt(qo(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:n}=V.useContext(xn),{hash:s,pathname:r,search:a}=qc(i,{relative:e}),l=r;return t!=="/"&&(l=r==="/"?t:Ys([t,r])),n.createHref({pathname:l,search:a,hash:s})}function qo(){return V.useContext(Yc)!=null}function $s(){return zt(qo(),"useLocation() may be used only in the context of a <Router> component."),V.useContext(Yc).location}var s5="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function r5(i){V.useContext(xn).static||V.useLayoutEffect(i)}function bn(){let{isDataRoute:i}=V.useContext(zn);return i?rM():YT()}function YT(){zt(qo(),"useNavigate() may be used only in the context of a <Router> component.");let i=V.useContext(Yo),{basename:e,navigator:t}=V.useContext(xn),{matches:n}=V.useContext(zn),{pathname:s}=$s(),r=JSON.stringify(Ig(n)),a=V.useRef(!1);return r5(()=>{a.current=!0}),V.useCallback((c,h={})=>{if(jn(a.current,s5),!a.current)return;if(typeof c=="number"){t.go(c);return}let d=_g(c,JSON.parse(r),s,h.relative==="path");i==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Ys([e,d.pathname])),(h.replace?t.replace:t.push)(d,h.state,h)},[e,t,r,s,i])}var qT=V.createContext(null);function XT(i){let e=V.useContext(zn).outlet;return V.useMemo(()=>e&&V.createElement(qT.Provider,{value:i},e),[e,i])}function Wd(){let{matches:i}=V.useContext(zn),e=i[i.length-1];return e?e.params:{}}function qc(i,{relative:e}={}){let{matches:t}=V.useContext(zn),{pathname:n}=$s(),s=JSON.stringify(Ig(t));return V.useMemo(()=>_g(i,JSON.parse(s),n,e==="path"),[i,s,n,e])}function WT(i,e){return a5(i,e)}function a5(i,e,t,n,s){zt(qo(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=V.useContext(xn),{matches:a}=V.useContext(zn),l=a[a.length-1],c=l?l.params:{},h=l?l.pathname:"/",d=l?l.pathnameBase:"/",f=l&&l.route;{let S=f&&f.path||"";l5(h,!f||S.endsWith("*")||S.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${S}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${S}"> to <Route path="${S==="/"?"*":`${S}/*`}">.`)}let p=$s(),g;if(e){let S=typeof e=="string"?Ho(e):e;zt(d==="/"||S.pathname?.startsWith(d),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${S.pathname}" was given in the \`location\` prop.`),g=S}else g=p;let y=g.pathname||"/",x=y;if(d!=="/"){let S=d.replace(/^\//,"").split("/");x="/"+y.replace(/^\//,"").split("/").slice(S.length).join("/")}let b=Kw(i,{pathname:x});jn(f||b!=null,`No routes matched location "${g.pathname}${g.search}${g.hash}" `),jn(b==null||b[b.length-1].route.element!==void 0||b[b.length-1].route.Component!==void 0||b[b.length-1].route.lazy!==void 0,`Matched leaf route at location "${g.pathname}${g.search}${g.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let w=$T(b&&b.map(S=>Object.assign({},S,{params:Object.assign({},c,S.params),pathname:Ys([d,r.encodeLocation?r.encodeLocation(S.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:S.pathname]),pathnameBase:S.pathnameBase==="/"?d:Ys([d,r.encodeLocation?r.encodeLocation(S.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:S.pathnameBase])})),a,t,n,s);return e&&w?V.createElement(Yc.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...g},navigationType:"POP"}},w):w}function KT(){let i=sM(),e=PT(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),t=i instanceof Error?i.stack:null,n="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:n},r={padding:"2px 4px",backgroundColor:n},a=null;return console.error("Error handled by React Router default ErrorBoundary:",i),a=V.createElement(V.Fragment,null,V.createElement("p",null," Hey developer "),V.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",V.createElement("code",{style:r},"ErrorBoundary")," or"," ",V.createElement("code",{style:r},"errorElement")," prop on your route.")),V.createElement(V.Fragment,null,V.createElement("h2",null,"Unexpected Application Error!"),V.createElement("h3",{style:{fontStyle:"italic"}},e),t?V.createElement("pre",{style:s},t):null,a)}var QT=V.createElement(KT,null),o5=class extends V.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,e){return e.location!==i.location||e.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:e.error,location:e.location,revalidation:i.revalidation||e.revalidation}}componentDidCatch(i,e){this.props.onError?this.props.onError(i,e):console.error("React Router caught the following error during render",i)}render(){let i=this.state.error;if(this.context&&typeof i=="object"&&i&&"digest"in i&&typeof i.digest=="string"){const t=GT(i.digest);t&&(i=t)}let e=i!==void 0?V.createElement(zn.Provider,{value:this.props.routeContext},V.createElement(Fg.Provider,{value:i,children:this.props.component})):this.props.children;return this.context?V.createElement(ZT,{error:i},e):e}};o5.contextType=kT;var Qp=new WeakMap;function ZT({children:i,error:e}){let{basename:t}=V.useContext(xn);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let n=zT(e.digest);if(n){let s=Qp.get(e);if(s)throw s;let r=e5(n.location,t);if($w&&!Qp.get(e))if(r.isExternal||n.reloadDocument)window.location.href=r.absoluteURL||r.to;else{const a=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(r.to,{replace:n.replace}));throw Qp.set(e,a),a}return V.createElement("meta",{httpEquiv:"refresh",content:`0;url=${r.absoluteURL||r.to}`})}}return i}function JT({routeContext:i,match:e,children:t}){let n=V.useContext(Yo);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),V.createElement(zn.Provider,{value:i},t)}function $T(i,e=[],t=null,n=null,s=null){if(i==null){if(!t)return null;if(t.errors)i=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)i=t.matches;else return null}let r=i,a=t?.errors;if(a!=null){let d=r.findIndex(f=>f.route.id&&a?.[f.route.id]!==void 0);zt(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),r=r.slice(0,Math.min(r.length,d+1))}let l=!1,c=-1;if(t)for(let d=0;d<r.length;d++){let f=r[d];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(c=d),f.route.id){let{loaderData:p,errors:g}=t,y=f.route.loader&&!p.hasOwnProperty(f.route.id)&&(!g||g[f.route.id]===void 0);if(f.route.lazy||y){l=!0,c>=0?r=r.slice(0,c+1):r=[r[0]];break}}}let h=t&&n?(d,f)=>{n(d,{location:t.location,params:t.matches?.[0]?.params??{},unstable_pattern:BT(t.matches),errorInfo:f})}:void 0;return r.reduceRight((d,f,p)=>{let g,y=!1,x=null,b=null;t&&(g=a&&f.route.id?a[f.route.id]:void 0,x=f.route.errorElement||QT,l&&(c<0&&p===0?(l5("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),y=!0,b=null):c===p&&(y=!0,b=f.route.hydrateFallbackElement||null)));let w=e.concat(r.slice(0,p+1)),S=()=>{let C;return g?C=x:y?C=b:f.route.Component?C=V.createElement(f.route.Component,null):f.route.element?C=f.route.element:C=d,V.createElement(JT,{match:f,routeContext:{outlet:d,matches:w,isDataRoute:t!=null},children:C})};return t&&(f.route.ErrorBoundary||f.route.errorElement||p===0)?V.createElement(o5,{location:t.location,revalidation:t.revalidation,component:x,error:g,children:S(),routeContext:{outlet:null,matches:w,isDataRoute:!0},onError:h}):S()},null)}function Pg(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function eM(i){let e=V.useContext(Yo);return zt(e,Pg(i)),e}function tM(i){let e=V.useContext(Xd);return zt(e,Pg(i)),e}function iM(i){let e=V.useContext(zn);return zt(e,Pg(i)),e}function Bg(i){let e=iM(i),t=e.matches[e.matches.length-1];return zt(t.route.id,`${i} can only be used on routes that contain a unique "id"`),t.route.id}function nM(){return Bg("useRouteId")}function sM(){let i=V.useContext(Fg),e=tM("useRouteError"),t=Bg("useRouteError");return i!==void 0?i:e.errors?.[t]}function rM(){let{router:i}=eM("useNavigate"),e=Bg("useNavigate"),t=V.useRef(!1);return r5(()=>{t.current=!0}),V.useCallback(async(s,r={})=>{jn(t.current,s5),t.current&&(typeof s=="number"?await i.navigate(s):await i.navigate(s,{fromRouteId:e,...r}))},[i,e])}var Sx={};function l5(i,e,t){!e&&!Sx[i]&&(Sx[i]=!0,jn(!1,t))}V.memo(aM);function aM({routes:i,future:e,state:t,onError:n}){return a5(i,void 0,t,n,e)}function oM({to:i,replace:e,state:t,relative:n}){zt(qo(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=V.useContext(xn);jn(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:r}=V.useContext(zn),{pathname:a}=$s(),l=bn(),c=_g(i,Ig(r),a,n==="path"),h=JSON.stringify(c);return V.useEffect(()=>{l(JSON.parse(h),{replace:e,state:t,relative:n})},[l,h,n,e,t]),null}function lM(i){return XT(i.context)}function Di(i){zt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function cM({basename:i="/",children:e=null,location:t,navigationType:n="POP",navigator:s,static:r=!1,unstable_useTransitions:a}){zt(!qo(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let l=i.replace(/^\/*/,"/"),c=V.useMemo(()=>({basename:l,navigator:s,static:r,unstable_useTransitions:a,future:{}}),[l,s,r,a]);typeof t=="string"&&(t=Ho(t));let{pathname:h="/",search:d="",hash:f="",state:p=null,key:g="default"}=t,y=V.useMemo(()=>{let x=Xs(h,l);return x==null?null:{location:{pathname:x,search:d,hash:f,state:p,key:g},navigationType:n}},[l,h,d,f,p,g,n]);return jn(y!=null,`<Router basename="${l}"> is not able to match the URL "${h}${d}${f}" because it does not start with the basename, so the <Router> won't render anything.`),y==null?null:V.createElement(xn.Provider,{value:c},V.createElement(Yc.Provider,{children:e,value:y}))}function uM({children:i,location:e}){return WT(z0(i),e)}function z0(i,e=[]){let t=[];return V.Children.forEach(i,(n,s)=>{if(!V.isValidElement(n))return;let r=[...e,s];if(n.type===V.Fragment){t.push.apply(t,z0(n.props.children,r));return}zt(n.type===Di,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),zt(!n.props.index||!n.props.children,"An index route cannot have child routes.");let a={id:n.props.id||r.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,middleware:n.props.middleware,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(a.children=z0(n.props.children,r)),t.push(a)}),t}var td="get",id="application/x-www-form-urlencoded";function Kd(i){return typeof HTMLElement<"u"&&i instanceof HTMLElement}function hM(i){return Kd(i)&&i.tagName.toLowerCase()==="button"}function dM(i){return Kd(i)&&i.tagName.toLowerCase()==="form"}function fM(i){return Kd(i)&&i.tagName.toLowerCase()==="input"}function mM(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function pM(i,e){return i.button===0&&(!e||e==="_self")&&!mM(i)}var Dh=null;function gM(){if(Dh===null)try{new FormData(document.createElement("form"),0),Dh=!1}catch{Dh=!0}return Dh}var AM=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Zp(i){return i!=null&&!AM.has(i)?(jn(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${id}"`),null):i}function vM(i,e){let t,n,s,r,a;if(dM(i)){let l=i.getAttribute("action");n=l?Xs(l,e):null,t=i.getAttribute("method")||td,s=Zp(i.getAttribute("enctype"))||id,r=new FormData(i)}else if(hM(i)||fM(i)&&(i.type==="submit"||i.type==="image")){let l=i.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=i.getAttribute("formaction")||l.getAttribute("action");if(n=c?Xs(c,e):null,t=i.getAttribute("formmethod")||l.getAttribute("method")||td,s=Zp(i.getAttribute("formenctype"))||Zp(l.getAttribute("enctype"))||id,r=new FormData(l,i),!gM()){let{name:h,type:d,value:f}=i;if(d==="image"){let p=h?`${h}.`:"";r.append(`${p}x`,"0"),r.append(`${p}y`,"0")}else h&&r.append(h,f)}}else{if(Kd(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=td,n=null,s=id,a=i}return r&&s==="text/plain"&&(a=r,r=void 0),{action:n,method:t.toLowerCase(),encType:s,formData:r,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Lg(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function yM(i,e,t){let n=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return n.pathname==="/"?n.pathname=`_root.${t}`:e&&Xs(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:n.pathname=`${n.pathname.replace(/\/$/,"")}.${t}`,n}async function xM(i,e){if(i.id in e)return e[i.id];try{let t=await import(i.module);return e[i.id]=t,t}catch(t){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function bM(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function wM(i,e,t){let n=await Promise.all(i.map(async s=>{let r=e.routes[s.route.id];if(r){let a=await xM(r,t);return a.links?a.links():[]}return[]}));return TM(n.flat(1).filter(bM).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function Cx(i,e,t,n,s,r){let a=(c,h)=>t[h]?c.route.id!==t[h].route.id:!0,l=(c,h)=>t[h].pathname!==c.pathname||t[h].route.path?.endsWith("*")&&t[h].params["*"]!==c.params["*"];return r==="assets"?e.filter((c,h)=>a(c,h)||l(c,h)):r==="data"?e.filter((c,h)=>{let d=n.routes[c.route.id];if(!d||!d.hasLoader)return!1;if(a(c,h)||l(c,h))return!0;if(c.route.shouldRevalidate){let f=c.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(i,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof f=="boolean")return f}return!0}):[]}function SM(i,e,{includeHydrateFallback:t}={}){return CM(i.map(n=>{let s=e.routes[n.route.id];if(!s)return[];let r=[s.module];return s.clientActionModule&&(r=r.concat(s.clientActionModule)),s.clientLoaderModule&&(r=r.concat(s.clientLoaderModule)),t&&s.hydrateFallbackModule&&(r=r.concat(s.hydrateFallbackModule)),s.imports&&(r=r.concat(s.imports)),r}).flat(1))}function CM(i){return[...new Set(i)]}function EM(i){let e={},t=Object.keys(i).sort();for(let n of t)e[n]=i[n];return e}function TM(i,e){let t=new Set;return new Set(e),i.reduce((n,s)=>{let r=JSON.stringify(EM(s));return t.has(r)||(t.add(r),n.push({key:r,link:s})),n},[])}function c5(){let i=V.useContext(Yo);return Lg(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function MM(){let i=V.useContext(Xd);return Lg(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var kg=V.createContext(void 0);kg.displayName="FrameworkContext";function u5(){let i=V.useContext(kg);return Lg(i,"You must render this element inside a <HydratedRouter> element"),i}function DM(i,e){let t=V.useContext(kg),[n,s]=V.useState(!1),[r,a]=V.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:h,onMouseLeave:d,onTouchStart:f}=e,p=V.useRef(null);V.useEffect(()=>{if(i==="render"&&a(!0),i==="viewport"){let x=w=>{w.forEach(S=>{a(S.isIntersecting)})},b=new IntersectionObserver(x,{threshold:.5});return p.current&&b.observe(p.current),()=>{b.disconnect()}}},[i]),V.useEffect(()=>{if(n){let x=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(x)}}},[n]);let g=()=>{s(!0)},y=()=>{s(!1),a(!1)};return t?i!=="intent"?[r,p,{}]:[r,p,{onFocus:Wl(l,g),onBlur:Wl(c,y),onMouseEnter:Wl(h,g),onMouseLeave:Wl(d,y),onTouchStart:Wl(f,g)}]:[!1,p,{}]}function Wl(i,e){return t=>{i&&i(t),t.defaultPrevented||e(t)}}function RM({page:i,...e}){let{router:t}=c5(),n=V.useMemo(()=>Kw(t.routes,i,t.basename),[t.routes,i,t.basename]);return n?V.createElement(IM,{page:i,matches:n,...e}):null}function NM(i){let{manifest:e,routeModules:t}=u5(),[n,s]=V.useState([]);return V.useEffect(()=>{let r=!1;return wM(i,e,t).then(a=>{r||s(a)}),()=>{r=!0}},[i,e,t]),n}function IM({page:i,matches:e,...t}){let n=$s(),{manifest:s,routeModules:r}=u5(),{basename:a}=c5(),{loaderData:l,matches:c}=MM(),h=V.useMemo(()=>Cx(i,e,c,s,n,"data"),[i,e,c,s,n]),d=V.useMemo(()=>Cx(i,e,c,s,n,"assets"),[i,e,c,s,n]),f=V.useMemo(()=>{if(i===n.pathname+n.search+n.hash)return[];let y=new Set,x=!1;if(e.forEach(w=>{let S=s.routes[w.route.id];!S||!S.hasLoader||(!h.some(C=>C.route.id===w.route.id)&&w.route.id in l&&r[w.route.id]?.shouldRevalidate||S.hasClientLoader?x=!0:y.add(w.route.id))}),y.size===0)return[];let b=yM(i,a,"data");return x&&y.size>0&&b.searchParams.set("_routes",e.filter(w=>y.has(w.route.id)).map(w=>w.route.id).join(",")),[b.pathname+b.search]},[a,l,n,s,h,e,i,r]),p=V.useMemo(()=>SM(d,s),[d,s]),g=NM(d);return V.createElement(V.Fragment,null,f.map(y=>V.createElement("link",{key:y,rel:"prefetch",as:"fetch",href:y,...t})),p.map(y=>V.createElement("link",{key:y,rel:"modulepreload",href:y,...t})),g.map(({key:y,link:x})=>V.createElement("link",{key:y,nonce:t.nonce,...x})))}function _M(...i){return e=>{i.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var FM=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{FM&&(window.__reactRouterVersion="7.11.0")}catch{}function PM({basename:i,children:e,unstable_useTransitions:t,window:n}){let s=V.useRef();s.current==null&&(s.current=uT({window:n,v5Compat:!0}));let r=s.current,[a,l]=V.useState({action:r.action,location:r.location}),c=V.useCallback(h=>{t===!1?l(h):V.startTransition(()=>l(h))},[t]);return V.useLayoutEffect(()=>r.listen(c),[r,c]),V.createElement(cM,{basename:i,children:e,location:a.location,navigationType:a.action,navigator:r,unstable_useTransitions:t})}var h5=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ci=V.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:s,reloadDocument:r,replace:a,state:l,target:c,to:h,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:p,...g},y){let{basename:x,unstable_useTransitions:b}=V.useContext(xn),w=typeof h=="string"&&h5.test(h),S=e5(h,x);h=S.to;let C=HT(h,{relative:s}),[E,D,M]=DM(n,g),N=OM(h,{replace:a,state:l,target:c,preventScrollReset:d,relative:s,viewTransition:f,unstable_defaultShouldRevalidate:p,unstable_useTransitions:b});function I(F){e&&e(F),F.defaultPrevented||N(F)}let _=V.createElement("a",{...g,...M,href:S.absoluteURL||C,onClick:S.isExternal||r?e:I,ref:_M(y,D),target:c,"data-discover":!w&&t==="render"?"true":void 0});return E&&!w?V.createElement(V.Fragment,null,_,V.createElement(RM,{page:C})):_});ci.displayName="Link";var BM=V.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:s=!1,style:r,to:a,viewTransition:l,children:c,...h},d){let f=qc(a,{relative:h.relative}),p=$s(),g=V.useContext(Xd),{navigator:y,basename:x}=V.useContext(xn),b=g!=null&&GM(f)&&l===!0,w=y.encodeLocation?y.encodeLocation(f).pathname:f.pathname,S=p.pathname,C=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;t||(S=S.toLowerCase(),C=C?C.toLowerCase():null,w=w.toLowerCase()),C&&x&&(C=Xs(C,x)||C);const E=w!=="/"&&w.endsWith("/")?w.length-1:w.length;let D=S===w||!s&&S.startsWith(w)&&S.charAt(E)==="/",M=C!=null&&(C===w||!s&&C.startsWith(w)&&C.charAt(w.length)==="/"),N={isActive:D,isPending:M,isTransitioning:b},I=D?e:void 0,_;typeof n=="function"?_=n(N):_=[n,D?"active":null,M?"pending":null,b?"transitioning":null].filter(Boolean).join(" ");let F=typeof r=="function"?r(N):r;return V.createElement(ci,{...h,"aria-current":I,className:_,ref:d,style:F,to:a,viewTransition:l},typeof c=="function"?c(N):c)});BM.displayName="NavLink";var LM=V.forwardRef(({discover:i="render",fetcherKey:e,navigate:t,reloadDocument:n,replace:s,state:r,method:a=td,action:l,onSubmit:c,relative:h,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:p,...g},y)=>{let{unstable_useTransitions:x}=V.useContext(xn),b=jM(),w=zM(l,{relative:h}),S=a.toLowerCase()==="get"?"get":"post",C=typeof l=="string"&&h5.test(l),E=D=>{if(c&&c(D),D.defaultPrevented)return;D.preventDefault();let M=D.nativeEvent.submitter,N=M?.getAttribute("formmethod")||a,I=()=>b(M||D.currentTarget,{fetcherKey:e,method:N,navigate:t,replace:s,state:r,relative:h,preventScrollReset:d,viewTransition:f,unstable_defaultShouldRevalidate:p});x&&t!==!1?V.startTransition(()=>I()):I()};return V.createElement("form",{ref:y,method:S,action:w,onSubmit:n?c:E,...g,"data-discover":!C&&i==="render"?"true":void 0})});LM.displayName="Form";function kM(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function d5(i){let e=V.useContext(Yo);return zt(e,kM(i)),e}function OM(i,{target:e,replace:t,state:n,preventScrollReset:s,relative:r,viewTransition:a,unstable_defaultShouldRevalidate:l,unstable_useTransitions:c}={}){let h=bn(),d=$s(),f=qc(i,{relative:r});return V.useCallback(p=>{if(pM(p,e)){p.preventDefault();let g=t!==void 0?t:Nc(d)===Nc(f),y=()=>h(i,{replace:g,state:n,preventScrollReset:s,relative:r,viewTransition:a,unstable_defaultShouldRevalidate:l});c?V.startTransition(()=>y()):y()}},[d,h,f,t,n,e,i,s,r,a,l,c])}var UM=0,VM=()=>`__${String(++UM)}__`;function jM(){let{router:i}=d5("useSubmit"),{basename:e}=V.useContext(xn),t=nM(),n=i.fetch,s=i.navigate;return V.useCallback(async(r,a={})=>{let{action:l,method:c,encType:h,formData:d,body:f}=vM(r,e);if(a.navigate===!1){let p=a.fetcherKey||VM();await n(p,t,a.action||l,{unstable_defaultShouldRevalidate:a.unstable_defaultShouldRevalidate,preventScrollReset:a.preventScrollReset,formData:d,body:f,formMethod:a.method||c,formEncType:a.encType||h,flushSync:a.flushSync})}else await s(a.action||l,{unstable_defaultShouldRevalidate:a.unstable_defaultShouldRevalidate,preventScrollReset:a.preventScrollReset,formData:d,body:f,formMethod:a.method||c,formEncType:a.encType||h,replace:a.replace,state:a.state,fromRouteId:t,flushSync:a.flushSync,viewTransition:a.viewTransition})},[n,s,e,t])}function zM(i,{relative:e}={}){let{basename:t}=V.useContext(xn),n=V.useContext(zn);zt(n,"useFormAction must be used inside a RouteContext");let[s]=n.matches.slice(-1),r={...qc(i||".",{relative:e})},a=$s();if(i==null){r.search=a.search;let l=new URLSearchParams(r.search),c=l.getAll("index");if(c.some(d=>d==="")){l.delete("index"),c.filter(f=>f).forEach(f=>l.append("index",f));let d=l.toString();r.search=d?`?${d}`:""}}return(!i||i===".")&&s.route.index&&(r.search=r.search?r.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(r.pathname=r.pathname==="/"?t:Ys([t,r.pathname])),Nc(r)}function GM(i,{relative:e}={}){let t=V.useContext(i5);zt(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=d5("useViewTransitionState"),s=qc(i,{relative:e});if(!t.isTransitioning)return!1;let r=Xs(t.currentLocation.pathname,n)||t.currentLocation.pathname,a=Xs(t.nextLocation.pathname,n)||t.nextLocation.pathname;return xd(s.pathname,a)!=null||xd(s.pathname,r)!=null}function Ni(i){return`Minified Redux error #${i}; visit https://redux.js.org/Errors?code=${i} for the full message or use the non-minified dev environment for full errors. `}var HM=typeof Symbol=="function"&&Symbol.observable||"@@observable",Ex=HM,Jp=()=>Math.random().toString(36).substring(7).split("").join("."),YM={INIT:`@@redux/INIT${Jp()}`,REPLACE:`@@redux/REPLACE${Jp()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Jp()}`},bd=YM;function Lr(i){if(typeof i!="object"||i===null)return!1;let e=i;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(i)===e||Object.getPrototypeOf(i)===null}function f5(i,e,t){if(typeof i!="function")throw new Error(Ni(2));if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error(Ni(0));if(typeof e=="function"&&typeof t>"u"&&(t=e,e=void 0),typeof t<"u"){if(typeof t!="function")throw new Error(Ni(1));return t(f5)(i,e)}let n=i,s=e,r=new Map,a=r,l=0,c=!1;function h(){a===r&&(a=new Map,r.forEach((b,w)=>{a.set(w,b)}))}function d(){if(c)throw new Error(Ni(3));return s}function f(b){if(typeof b!="function")throw new Error(Ni(4));if(c)throw new Error(Ni(5));let w=!0;h();const S=l++;return a.set(S,b),function(){if(w){if(c)throw new Error(Ni(6));w=!1,h(),a.delete(S),r=null}}}function p(b){if(!Lr(b))throw new Error(Ni(7));if(typeof b.type>"u")throw new Error(Ni(8));if(typeof b.type!="string")throw new Error(Ni(17));if(c)throw new Error(Ni(9));try{c=!0,s=n(s,b)}finally{c=!1}return(r=a).forEach(S=>{S()}),b}function g(b){if(typeof b!="function")throw new Error(Ni(10));n=b,p({type:bd.REPLACE})}function y(){const b=f;return{subscribe(w){if(typeof w!="object"||w===null)throw new Error(Ni(11));function S(){const E=w;E.next&&E.next(d())}return S(),{unsubscribe:b(S)}},[Ex](){return this}}}return p({type:bd.INIT}),{dispatch:p,subscribe:f,getState:d,replaceReducer:g,[Ex]:y}}function qM(i){Object.keys(i).forEach(e=>{const t=i[e];if(typeof t(void 0,{type:bd.INIT})>"u")throw new Error(Ni(12));if(typeof t(void 0,{type:bd.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Ni(13))})}function m5(i){const e=Object.keys(i),t={};for(let r=0;r<e.length;r++){const a=e[r];typeof i[a]=="function"&&(t[a]=i[a])}const n=Object.keys(t);let s;try{qM(t)}catch(r){s=r}return function(a={},l){if(s)throw s;let c=!1;const h={};for(let d=0;d<n.length;d++){const f=n[d],p=t[f],g=a[f],y=p(g,l);if(typeof y>"u")throw l&&l.type,new Error(Ni(14));h[f]=y,c=c||y!==g}return c=c||n.length!==Object.keys(a).length,c?h:a}}function wd(...i){return i.length===0?e=>e:i.length===1?i[0]:i.reduce((e,t)=>(...n)=>e(t(...n)))}function XM(...i){return e=>(t,n)=>{const s=e(t,n);let r=()=>{throw new Error(Ni(15))};const a={getState:s.getState,dispatch:(c,...h)=>r(c,...h)},l=i.map(c=>c(a));return r=wd(...l)(s.dispatch),{...s,dispatch:r}}}function p5(i){return Lr(i)&&"type"in i&&typeof i.type=="string"}var Og=Symbol.for("immer-nothing"),bc=Symbol.for("immer-draftable"),yi=Symbol.for("immer-state");function Fi(i,...e){throw new Error(`[Immer] minified error nr: ${i}. Full error at: https://bit.ly/3cXEKWf`)}var gn=Object,va=gn.getPrototypeOf,Ic="constructor",Xc="prototype",G0="configurable",Sd="enumerable",nd="writable",_c="value",An=i=>!!i&&!!i[yi];function vn(i){return i?g5(i)||Wc(i)||!!i[bc]||!!i[Ic]?.[bc]||Kc(i)||Qc(i):!1}var WM=gn[Xc][Ic].toString(),Tx=new WeakMap;function g5(i){if(!i||!Oo(i))return!1;const e=va(i);if(e===null||e===gn[Xc])return!0;const t=gn.hasOwnProperty.call(e,Ic)&&e[Ic];if(t===Object)return!0;if(!oa(t))return!1;let n=Tx.get(t);return n===void 0&&(n=Function.toString.call(t),Tx.set(t,n)),n===WM}function KM(i){return An(i)||Fi(15,i),i[yi].base_}function Xo(i,e,t=!0){ya(i)===0?(t?Reflect.ownKeys(i):gn.keys(i)).forEach(s=>{e(s,i[s],i)}):i.forEach((n,s)=>e(s,n,i))}function ya(i){const e=i[yi];return e?e.type_:Wc(i)?1:Kc(i)?2:Qc(i)?3:0}var wc=(i,e,t=ya(i))=>t===2?i.has(e):gn[Xc].hasOwnProperty.call(i,e),Vs=(i,e,t=ya(i))=>t===2?i.get(e):i[e],Cd=(i,e,t,n=ya(i))=>{n===2?i.set(e,t):n===3?i.add(t):i[e]=t};function QM(i,e){return i===e?i!==0||1/i===1/e:i!==i&&e!==e}var Wc=Array.isArray,Kc=i=>i instanceof Map,Qc=i=>i instanceof Set,Oo=i=>typeof i=="object",oa=i=>typeof i=="function",$p=i=>typeof i=="boolean";function ZM(i){const e=+i;return Number.isInteger(e)&&String(e)===i}var JM=i=>Oo(i)?i?.[yi]:null,js=i=>i.copy_||i.base_,Ug=i=>i.modified_?i.copy_:i.base_;function H0(i,e){if(Kc(i))return new Map(i);if(Qc(i))return new Set(i);if(Wc(i))return Array[Xc].slice.call(i);const t=g5(i);if(e===!0||e==="class_only"&&!t){const n=gn.getOwnPropertyDescriptors(i);delete n[yi];let s=Reflect.ownKeys(n);for(let r=0;r<s.length;r++){const a=s[r],l=n[a];l[nd]===!1&&(l[nd]=!0,l[G0]=!0),(l.get||l.set)&&(n[a]={[G0]:!0,[nd]:!0,[Sd]:l[Sd],[_c]:i[a]})}return gn.create(va(i),n)}else{const n=va(i);if(n!==null&&t)return{...i};const s=gn.create(n);return gn.assign(s,i)}}function Vg(i,e=!1){return Qd(i)||An(i)||!vn(i)||(ya(i)>1&&gn.defineProperties(i,{set:Rh,add:Rh,clear:Rh,delete:Rh}),gn.freeze(i),e&&Xo(i,(t,n)=>{Vg(n,!0)},!1)),i}function $M(){Fi(2)}var Rh={[_c]:$M};function Qd(i){return i===null||!Oo(i)?!0:gn.isFrozen(i)}var Ed="MapSet",Td="Patches",Mx="ArrayMethods",Md={};function xa(i){const e=Md[i];return e||Fi(0,i),e}var Dx=i=>!!Md[i];function eD(i,e){Md[i]||(Md[i]=e)}var Fc,A5=()=>Fc,tD=(i,e)=>({drafts_:[],parent_:i,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0,handledSet_:new Set,processedForPatches_:new Set,mapSetPlugin_:Dx(Ed)?xa(Ed):void 0,arrayMethodsPlugin_:Dx(Mx)?xa(Mx):void 0});function Rx(i,e){e&&(i.patchPlugin_=xa(Td),i.patches_=[],i.inversePatches_=[],i.patchListener_=e)}function Y0(i){q0(i),i.drafts_.forEach(iD),i.drafts_=null}function q0(i){i===Fc&&(Fc=i.parent_)}var Nx=i=>Fc=tD(Fc,i);function iD(i){const e=i[yi];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function Ix(i,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];if(i!==void 0&&i!==t){t[yi].modified_&&(Y0(e),Fi(4)),vn(i)&&(i=_x(e,i));const{patchPlugin_:s}=e;s&&s.generateReplacementPatches_(t[yi].base_,i,e)}else i=_x(e,t);return nD(e,i,!0),Y0(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),i!==Og?i:void 0}function _x(i,e){if(Qd(e))return e;const t=e[yi];if(!t)return jg(e,i.handledSet_,i);if(!Zd(t,i))return e;if(!t.modified_)return t.base_;if(!t.finalized_){const{callbacks_:n}=t;if(n)for(;n.length>0;)n.pop()(i);x5(t,i)}return t.copy_}function nD(i,e,t=!1){!i.parent_&&i.immer_.autoFreeze_&&i.canAutoFreeze_&&Vg(e,t)}function v5(i){i.finalized_=!0,i.scope_.unfinalizedDrafts_--}var Zd=(i,e)=>i.scope_===e,sD=[];function y5(i,e,t,n){const s=js(i),r=i.type_;if(n!==void 0&&Vs(s,n,r)===e){Cd(s,n,t,r);return}if(!i.draftLocations_){const l=i.draftLocations_=new Map;Xo(s,(c,h)=>{if(An(h)){const d=l.get(h)||[];d.push(c),l.set(h,d)}})}const a=i.draftLocations_.get(e)??sD;for(const l of a)Cd(s,l,t,r)}function rD(i,e,t){i.callbacks_.push(function(s){const r=e;if(!r||!Zd(r,s))return;s.mapSetPlugin_?.fixSetContents(r);const a=Ug(r);y5(i,r.draft_??r,a,t),x5(r,s)})}function x5(i,e){if(i.modified_&&!i.finalized_&&(i.type_===3||i.type_===1&&i.allIndicesReassigned_||(i.assigned_?.size??0)>0)){const{patchPlugin_:n}=e;if(n){const s=n.getPath(i);s&&n.generatePatches_(i,s,e)}v5(i)}}function aD(i,e,t){const{scope_:n}=i;if(An(t)){const s=t[yi];Zd(s,n)&&s.callbacks_.push(function(){sd(i);const a=Ug(s);y5(i,t,a,e)})}else vn(t)&&i.callbacks_.push(function(){const r=js(i);Vs(r,e,i.type_)===t&&n.drafts_.length>1&&(i.assigned_.get(e)??!1)===!0&&i.copy_&&jg(Vs(i.copy_,e,i.type_),n.handledSet_,n)})}function jg(i,e,t){return!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1||An(i)||e.has(i)||!vn(i)||Qd(i)||(e.add(i),Xo(i,(n,s)=>{if(An(s)){const r=s[yi];if(Zd(r,t)){const a=Ug(r);Cd(i,n,a,i.type_),v5(r)}}else vn(s)&&jg(s,e,t)})),i}function oD(i,e){const t=Wc(i),n={type_:t?1:0,scope_:e?e.scope_:A5(),modified_:!1,finalized_:!1,assigned_:void 0,parent_:e,base_:i,draft_:null,copy_:null,revoke_:null,isManual_:!1,callbacks_:void 0};let s=n,r=zg;t&&(s=[n],r=Pc);const{revoke:a,proxy:l}=Proxy.revocable(s,r);return n.draft_=l,n.revoke_=a,[l,n]}var zg={get(i,e){if(e===yi)return i;let t=i.scope_.arrayMethodsPlugin_;const n=i.type_===1&&typeof e=="string";if(n&&t?.isArrayOperationMethod(e))return t.createMethodInterceptor(i,e);const s=js(i);if(!wc(s,e,i.type_))return lD(i,s,e);const r=s[e];if(i.finalized_||!vn(r)||n&&i.operationMethod&&t?.isMutatingArrayMethod(i.operationMethod)&&ZM(e))return r;if(r===e0(i.base_,e)){sd(i);const a=i.type_===1?+e:e,l=W0(i.scope_,r,i,a);return i.copy_[a]=l}return r},has(i,e){return e in js(i)},ownKeys(i){return Reflect.ownKeys(js(i))},set(i,e,t){const n=b5(js(i),e);if(n?.set)return n.set.call(i.draft_,t),!0;if(!i.modified_){const s=e0(js(i),e),r=s?.[yi];if(r&&r.base_===t)return i.copy_[e]=t,i.assigned_.set(e,!1),!0;if(QM(t,s)&&(t!==void 0||wc(i.base_,e,i.type_)))return!0;sd(i),X0(i)}return i.copy_[e]===t&&(t!==void 0||e in i.copy_)||Number.isNaN(t)&&Number.isNaN(i.copy_[e])||(i.copy_[e]=t,i.assigned_.set(e,!0),aD(i,e,t)),!0},deleteProperty(i,e){return sd(i),e0(i.base_,e)!==void 0||e in i.base_?(i.assigned_.set(e,!1),X0(i)):i.assigned_.delete(e),i.copy_&&delete i.copy_[e],!0},getOwnPropertyDescriptor(i,e){const t=js(i),n=Reflect.getOwnPropertyDescriptor(t,e);return n&&{[nd]:!0,[G0]:i.type_!==1||e!=="length",[Sd]:n[Sd],[_c]:t[e]}},defineProperty(){Fi(11)},getPrototypeOf(i){return va(i.base_)},setPrototypeOf(){Fi(12)}},Pc={};Xo(zg,(i,e)=>{Pc[i]=function(){const t=arguments;return t[0]=t[0][0],e.apply(this,t)}});Pc.deleteProperty=function(i,e){return Pc.set.call(this,i,e,void 0)};Pc.set=function(i,e,t){return zg.set.call(this,i[0],e,t,i[0])};function e0(i,e){const t=i[yi];return(t?js(t):i)[e]}function lD(i,e,t){const n=b5(e,t);return n?_c in n?n[_c]:n.get?.call(i.draft_):void 0}function b5(i,e){if(!(e in i))return;let t=va(i);for(;t;){const n=Object.getOwnPropertyDescriptor(t,e);if(n)return n;t=va(t)}}function X0(i){i.modified_||(i.modified_=!0,i.parent_&&X0(i.parent_))}function sd(i){i.copy_||(i.assigned_=new Map,i.copy_=H0(i.base_,i.scope_.immer_.useStrictShallowCopy_))}var cD=class{constructor(i){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!1,this.produce=(e,t,n)=>{if(oa(e)&&!oa(t)){const r=t;t=e;const a=this;return function(c=r,...h){return a.produce(c,d=>t.call(this,d,...h))}}oa(t)||Fi(6),n!==void 0&&!oa(n)&&Fi(7);let s;if(vn(e)){const r=Nx(this),a=W0(r,e,void 0);let l=!0;try{s=t(a),l=!1}finally{l?Y0(r):q0(r)}return Rx(r,n),Ix(s,r)}else if(!e||!Oo(e)){if(s=t(e),s===void 0&&(s=e),s===Og&&(s=void 0),this.autoFreeze_&&Vg(s,!0),n){const r=[],a=[];xa(Td).generateReplacementPatches_(e,s,{patches_:r,inversePatches_:a}),n(r,a)}return s}else Fi(1,e)},this.produceWithPatches=(e,t)=>{if(oa(e))return(a,...l)=>this.produceWithPatches(a,c=>e(c,...l));let n,s;return[this.produce(e,t,(a,l)=>{n=a,s=l}),n,s]},$p(i?.autoFreeze)&&this.setAutoFreeze(i.autoFreeze),$p(i?.useStrictShallowCopy)&&this.setUseStrictShallowCopy(i.useStrictShallowCopy),$p(i?.useStrictIteration)&&this.setUseStrictIteration(i.useStrictIteration)}createDraft(i){vn(i)||Fi(8),An(i)&&(i=w5(i));const e=Nx(this),t=W0(e,i,void 0);return t[yi].isManual_=!0,q0(e),t}finishDraft(i,e){const t=i&&i[yi];(!t||!t.isManual_)&&Fi(9);const{scope_:n}=t;return Rx(n,e),Ix(void 0,n)}setAutoFreeze(i){this.autoFreeze_=i}setUseStrictShallowCopy(i){this.useStrictShallowCopy_=i}setUseStrictIteration(i){this.useStrictIteration_=i}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(i,e){let t;for(t=e.length-1;t>=0;t--){const s=e[t];if(s.path.length===0&&s.op==="replace"){i=s.value;break}}t>-1&&(e=e.slice(t+1));const n=xa(Td).applyPatches_;return An(i)?n(i,e):this.produce(i,s=>n(s,e))}};function W0(i,e,t,n){const[s,r]=Kc(e)?xa(Ed).proxyMap_(e,t):Qc(e)?xa(Ed).proxySet_(e,t):oD(e,t);return(t?.scope_??A5()).drafts_.push(s),r.callbacks_=t?.callbacks_??[],r.key_=n,t&&n!==void 0?rD(t,r,n):r.callbacks_.push(function(c){c.mapSetPlugin_?.fixSetContents(r);const{patchPlugin_:h}=c;r.modified_&&h&&h.generatePatches_(r,[],c)}),s}function w5(i){return An(i)||Fi(10,i),S5(i)}function S5(i){if(!vn(i)||Qd(i))return i;const e=i[yi];let t,n=!0;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,t=H0(i,e.scope_.immer_.useStrictShallowCopy_),n=e.scope_.immer_.shouldUseStrictIteration()}else t=H0(i,!0);return Xo(t,(s,r)=>{Cd(t,s,S5(r))},n),e&&(e.finalized_=!1),t}function uD(){function e(y,x=[]){if("key_"in y&&y.key_!==void 0){const b=y.parent_.copy_??y.parent_.base_,w=JM(Vs(b,y.key_)),S=Vs(b,y.key_);if(S===void 0||S!==y.draft_&&S!==y.base_&&S!==y.copy_||w!=null&&w.base_!==y.base_)return null;const C=y.parent_.type_===3;let E;if(C){const D=y.parent_;E=Array.from(D.drafts_.keys()).indexOf(y.key_)}else E=y.key_;if(!(C&&b.size>E||wc(b,E)))return null;x.push(E)}if(y.parent_)return e(y.parent_,x);x.reverse();try{t(y.copy_,x)}catch{return null}return x}function t(y,x){let b=y;for(let w=0;w<x.length-1;w++){const S=x[w];if(b=Vs(b,S),!Oo(b)||b===null)throw new Error(`Cannot resolve path at '${x.join("/")}'`)}return b}const n="replace",s="add",r="remove";function a(y,x,b){if(y.scope_.processedForPatches_.has(y))return;y.scope_.processedForPatches_.add(y);const{patches_:w,inversePatches_:S}=b;switch(y.type_){case 0:case 2:return c(y,x,w,S);case 1:return l(y,x,w,S);case 3:return h(y,x,w,S)}}function l(y,x,b,w){let{base_:S,assigned_:C}=y,E=y.copy_;E.length<S.length&&([S,E]=[E,S],[b,w]=[w,b]);const D=y.allIndicesReassigned_===!0;for(let M=0;M<S.length;M++){const N=E[M],I=S[M];if((D||C?.get(M.toString()))&&N!==I){const F=N?.[yi];if(F&&F.modified_)continue;const B=x.concat([M]);b.push({op:n,path:B,value:g(N)}),w.push({op:n,path:B,value:g(I)})}}for(let M=S.length;M<E.length;M++){const N=x.concat([M]);b.push({op:s,path:N,value:g(E[M])})}for(let M=E.length-1;S.length<=M;--M){const N=x.concat([M]);w.push({op:r,path:N})}}function c(y,x,b,w){const{base_:S,copy_:C,type_:E}=y;Xo(y.assigned_,(D,M)=>{const N=Vs(S,D,E),I=Vs(C,D,E),_=M?wc(S,D)?n:s:r;if(N===I&&_===n)return;const F=x.concat(D);b.push(_===r?{op:_,path:F}:{op:_,path:F,value:g(I)}),w.push(_===s?{op:r,path:F}:_===r?{op:s,path:F,value:g(N)}:{op:n,path:F,value:g(N)})})}function h(y,x,b,w){let{base_:S,copy_:C}=y,E=0;S.forEach(D=>{if(!C.has(D)){const M=x.concat([E]);b.push({op:r,path:M,value:D}),w.unshift({op:s,path:M,value:D})}E++}),E=0,C.forEach(D=>{if(!S.has(D)){const M=x.concat([E]);b.push({op:s,path:M,value:D}),w.unshift({op:r,path:M,value:D})}E++})}function d(y,x,b){const{patches_:w,inversePatches_:S}=b;w.push({op:n,path:[],value:x===Og?void 0:x}),S.push({op:n,path:[],value:y})}function f(y,x){return x.forEach(b=>{const{path:w,op:S}=b;let C=y;for(let N=0;N<w.length-1;N++){const I=ya(C);let _=w[N];typeof _!="string"&&typeof _!="number"&&(_=""+_),(I===0||I===1)&&(_==="__proto__"||_===Ic)&&Fi(19),oa(C)&&_===Xc&&Fi(19),C=Vs(C,_),Oo(C)||Fi(18,w.join("/"))}const E=ya(C),D=p(b.value),M=w[w.length-1];switch(S){case n:switch(E){case 2:return C.set(M,D);case 3:Fi(16);default:return C[M]=D}case s:switch(E){case 1:return M==="-"?C.push(D):C.splice(M,0,D);case 2:return C.set(M,D);case 3:return C.add(D);default:return C[M]=D}case r:switch(E){case 1:return C.splice(M,1);case 2:return C.delete(M);case 3:return C.delete(b.value);default:return delete C[M]}default:Fi(17,S)}}),y}function p(y){if(!vn(y))return y;if(Wc(y))return y.map(p);if(Kc(y))return new Map(Array.from(y.entries()).map(([b,w])=>[b,p(w)]));if(Qc(y))return new Set(Array.from(y).map(p));const x=Object.create(va(y));for(const b in y)x[b]=p(y[b]);return wc(y,bc)&&(x[bc]=y[bc]),x}function g(y){return An(y)?p(y):y}eD(Td,{applyPatches_:f,generatePatches_:a,generateReplacementPatches_:d,getPath:e})}var Bc=new cD,Zc=Bc.produce,C5=Bc.produceWithPatches.bind(Bc),Fx=Bc.applyPatches.bind(Bc);function hD(i,e=`expected a function, instead received ${typeof i}`){if(typeof i!="function")throw new TypeError(e)}function dD(i,e=`expected an object, instead received ${typeof i}`){if(typeof i!="object")throw new TypeError(e)}function fD(i,e="expected all items to be functions, instead received the following types: "){if(!i.every(t=>typeof t=="function")){const t=i.map(n=>typeof n=="function"?`function ${n.name||"unnamed"}()`:typeof n).join(", ");throw new TypeError(`${e}[${t}]`)}}var Px=i=>Array.isArray(i)?i:[i];function mD(i){const e=Array.isArray(i[0])?i[0]:i;return fD(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function pD(i,e){const t=[],{length:n}=i;for(let s=0;s<n;s++)t.push(i[s].apply(null,e));return t}var gD=class{constructor(i){this.value=i}deref(){return this.value}},AD=typeof WeakRef<"u"?WeakRef:gD,vD=0,Bx=1;function Nh(){return{s:vD,v:void 0,o:null,p:null}}function Dd(i,e={}){let t=Nh();const{resultEqualityCheck:n}=e;let s,r=0;function a(){let l=t;const{length:c}=arguments;for(let f=0,p=c;f<p;f++){const g=arguments[f];if(typeof g=="function"||typeof g=="object"&&g!==null){let y=l.o;y===null&&(l.o=y=new WeakMap);const x=y.get(g);x===void 0?(l=Nh(),y.set(g,l)):l=x}else{let y=l.p;y===null&&(l.p=y=new Map);const x=y.get(g);x===void 0?(l=Nh(),y.set(g,l)):l=x}}const h=l;let d;if(l.s===Bx)d=l.v;else if(d=i.apply(null,arguments),r++,n){const f=s?.deref?.()??s;f!=null&&n(f,d)&&(d=f,r!==0&&r--),s=typeof d=="object"&&d!==null||typeof d=="function"?new AD(d):d}return h.s=Bx,h.v=d,d}return a.clearCache=()=>{t=Nh(),a.resetResultsCount()},a.resultsCount=()=>r,a.resetResultsCount=()=>{r=0},a}function yD(i,...e){const t=typeof i=="function"?{memoize:i,memoizeOptions:e}:i,n=(...s)=>{let r=0,a=0,l,c={},h=s.pop();typeof h=="object"&&(c=h,h=s.pop()),hD(h,`createSelector expects an output function after the inputs, but received: [${typeof h}]`);const d={...t,...c},{memoize:f,memoizeOptions:p=[],argsMemoize:g=Dd,argsMemoizeOptions:y=[]}=d,x=Px(p),b=Px(y),w=mD(s),S=f(function(){return r++,h.apply(null,arguments)},...x),C=g(function(){a++;const D=pD(w,arguments);return l=S.apply(null,D),l},...b);return Object.assign(C,{resultFunc:h,memoizedResultFunc:S,dependencies:w,dependencyRecomputations:()=>a,resetDependencyRecomputations:()=>{a=0},lastResult:()=>l,recomputations:()=>r,resetRecomputations:()=>{r=0},memoize:f,argsMemoize:g})};return Object.assign(n,{withTypes:()=>n}),n}var Gg=yD(Dd),xD=Object.assign((i,e=Gg)=>{dD(i,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof i}`);const t=Object.keys(i),n=t.map(r=>i[r]);return e(n,(...r)=>r.reduce((a,l,c)=>(a[t[c]]=l,a),{}))},{withTypes:()=>xD});function E5(i){return({dispatch:t,getState:n})=>s=>r=>typeof r=="function"?r(t,n,i):s(r)}var bD=E5(),wD=E5,SD=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?wd:wd.apply(null,arguments)},CD=i=>i&&typeof i.match=="function";function $n(i,e){function t(...n){if(e){let s=e(...n);if(!s)throw new Error(Un(0));return{type:i,payload:s.payload,..."meta"in s&&{meta:s.meta},..."error"in s&&{error:s.error}}}return{type:i,payload:n[0]}}return t.toString=()=>`${i}`,t.type=i,t.match=n=>p5(n)&&n.type===i,t}var T5=class rc extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,rc.prototype)}static get[Symbol.species](){return rc}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new rc(...e[0].concat(this)):new rc(...e.concat(this))}};function Lx(i){return vn(i)?Zc(i,()=>{}):i}function Ih(i,e,t){return i.has(e)?i.get(e):i.set(e,t(e)).get(e)}function ED(i){return typeof i=="boolean"}var TD=()=>function(e){const{thunk:t=!0,immutableCheck:n=!0,serializableCheck:s=!0,actionCreatorCheck:r=!0}=e??{};let a=new T5;return t&&(ED(t)?a.push(bD):a.push(wD(t.extraArgument))),a},Jd="RTK_autoBatch",Kl=()=>i=>({payload:i,meta:{[Jd]:!0}}),kx=i=>e=>{setTimeout(e,i)},MD=(i={type:"raf"})=>e=>(...t)=>{const n=e(...t);let s=!0,r=!1,a=!1;const l=new Set,c=i.type==="tick"?queueMicrotask:i.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:kx(10):i.type==="callback"?i.queueNotification:kx(i.timeout),h=()=>{a=!1,r&&(r=!1,l.forEach(d=>d()))};return Object.assign({},n,{subscribe(d){const f=()=>s&&d(),p=n.subscribe(f);return l.add(d),()=>{p(),l.delete(d)}},dispatch(d){try{return s=!d?.meta?.[Jd],r=!s,r&&(a||(a=!0,c(h))),n.dispatch(d)}finally{s=!0}}})},DD=i=>function(t){const{autoBatch:n=!0}=t??{};let s=new T5(i);return n&&s.push(MD(typeof n=="object"?n:void 0)),s};function RD(i){const e=TD(),{reducer:t=void 0,middleware:n,devTools:s=!0,preloadedState:r=void 0,enhancers:a=void 0}=i||{};let l;if(typeof t=="function")l=t;else if(Lr(t))l=m5(t);else throw new Error(Un(1));let c;typeof n=="function"?c=n(e):c=e();let h=wd;s&&(h=SD({trace:!1,...typeof s=="object"&&s}));const d=XM(...c),f=DD(d);let p=typeof a=="function"?a(f):f();const g=h(...p);return f5(l,r,g)}function M5(i){const e={},t=[];let n;const s={addCase(r,a){const l=typeof r=="string"?r:r.type;if(!l)throw new Error(Un(28));if(l in e)throw new Error(Un(29));return e[l]=a,s},addAsyncThunk(r,a){return a.pending&&(e[r.pending.type]=a.pending),a.rejected&&(e[r.rejected.type]=a.rejected),a.fulfilled&&(e[r.fulfilled.type]=a.fulfilled),a.settled&&t.push({matcher:r.settled,reducer:a.settled}),s},addMatcher(r,a){return t.push({matcher:r,reducer:a}),s},addDefaultCase(r){return n=r,s}};return i(s),[e,t,n]}function ND(i){return typeof i=="function"}function ID(i,e){let[t,n,s]=M5(e),r;if(ND(i))r=()=>Lx(i());else{const l=Lx(i);r=()=>l}function a(l=r(),c){let h=[t[c.type],...n.filter(({matcher:d})=>d(c)).map(({reducer:d})=>d)];return h.filter(d=>!!d).length===0&&(h=[s]),h.reduce((d,f)=>{if(f)if(An(d)){const g=f(d,c);return g===void 0?d:g}else{if(vn(d))return Zc(d,p=>f(p,c));{const p=f(d,c);if(p===void 0){if(d===null)return d;throw Error("A case reducer on a non-draftable value must not return undefined")}return p}}return d},l)}return a.getInitialState=r,a}var D5=(i,e)=>CD(i)?i.match(e):i(e);function Ws(...i){return e=>i.some(t=>D5(t,e))}function Sc(...i){return e=>i.every(t=>D5(t,e))}function $d(i,e){if(!i||!i.meta)return!1;const t=typeof i.meta.requestId=="string",n=e.indexOf(i.meta.requestStatus)>-1;return t&&n}function Jc(i){return typeof i[0]=="function"&&"pending"in i[0]&&"fulfilled"in i[0]&&"rejected"in i[0]}function Hg(...i){return i.length===0?e=>$d(e,["pending"]):Jc(i)?Ws(...i.map(e=>e.pending)):Hg()(i[0])}function Uo(...i){return i.length===0?e=>$d(e,["rejected"]):Jc(i)?Ws(...i.map(e=>e.rejected)):Uo()(i[0])}function ef(...i){const e=t=>t&&t.meta&&t.meta.rejectedWithValue;return i.length===0?Sc(Uo(...i),e):Jc(i)?Sc(Uo(...i),e):ef()(i[0])}function kr(...i){return i.length===0?e=>$d(e,["fulfilled"]):Jc(i)?Ws(...i.map(e=>e.fulfilled)):kr()(i[0])}function K0(...i){return i.length===0?e=>$d(e,["pending","fulfilled","rejected"]):Jc(i)?Ws(...i.flatMap(e=>[e.pending,e.rejected,e.fulfilled])):K0()(i[0])}var _D="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",Yg=(i=21)=>{let e="",t=i;for(;t--;)e+=_D[Math.random()*64|0];return e},FD=["name","message","stack","code"],t0=class{constructor(i,e){this.payload=i,this.meta=e}_type},Ox=class{constructor(i,e){this.payload=i,this.meta=e}_type},PD=i=>{if(typeof i=="object"&&i!==null){const e={};for(const t of FD)typeof i[t]=="string"&&(e[t]=i[t]);return e}return{message:String(i)}},Ux="External signal was aborted",Vx=(()=>{function i(e,t,n){const s=$n(e+"/fulfilled",(c,h,d,f)=>({payload:c,meta:{...f||{},arg:d,requestId:h,requestStatus:"fulfilled"}})),r=$n(e+"/pending",(c,h,d)=>({payload:void 0,meta:{...d||{},arg:h,requestId:c,requestStatus:"pending"}})),a=$n(e+"/rejected",(c,h,d,f,p)=>({payload:f,error:(n&&n.serializeError||PD)(c||"Rejected"),meta:{...p||{},arg:d,requestId:h,rejectedWithValue:!!f,requestStatus:"rejected",aborted:c?.name==="AbortError",condition:c?.name==="ConditionError"}}));function l(c,{signal:h}={}){return(d,f,p)=>{const g=n?.idGenerator?n.idGenerator(c):Yg(),y=new AbortController;let x,b;function w(C){b=C,y.abort()}h&&(h.aborted?w(Ux):h.addEventListener("abort",()=>w(Ux),{once:!0}));const S=(async function(){let C;try{let D=n?.condition?.(c,{getState:f,extra:p});if(LD(D)&&(D=await D),D===!1||y.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};const M=new Promise((N,I)=>{x=()=>{I({name:"AbortError",message:b||"Aborted"})},y.signal.addEventListener("abort",x,{once:!0})});d(r(g,c,n?.getPendingMeta?.({requestId:g,arg:c},{getState:f,extra:p}))),C=await Promise.race([M,Promise.resolve(t(c,{dispatch:d,getState:f,extra:p,requestId:g,signal:y.signal,abort:w,rejectWithValue:(N,I)=>new t0(N,I),fulfillWithValue:(N,I)=>new Ox(N,I)})).then(N=>{if(N instanceof t0)throw N;return N instanceof Ox?s(N.payload,g,c,N.meta):s(N,g,c)})])}catch(D){C=D instanceof t0?a(null,g,c,D.payload,D.meta):a(D,g,c)}finally{x&&y.signal.removeEventListener("abort",x)}return n&&!n.dispatchConditionRejection&&a.match(C)&&C.meta.condition||d(C),C})();return Object.assign(S,{abort:w,requestId:g,arg:c,unwrap(){return S.then(BD)}})}}return Object.assign(l,{pending:r,rejected:a,fulfilled:s,settled:Ws(a,s),typePrefix:e})}return i.withTypes=()=>i,i})();function BD(i){if(i.meta&&i.meta.rejectedWithValue)throw i.payload;if(i.error)throw i.error;return i.payload}function LD(i){return i!==null&&typeof i=="object"&&typeof i.then=="function"}var kD=Symbol.for("rtk-slice-createasyncthunk");function OD(i,e){return`${i}/${e}`}function UD({creators:i}={}){const e=i?.asyncThunk?.[kD];return function(n){const{name:s,reducerPath:r=s}=n;if(!s)throw new Error(Un(11));const a=(typeof n.reducers=="function"?n.reducers(jD()):n.reducers)||{},l=Object.keys(a),c={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},h={addCase(C,E){const D=typeof C=="string"?C:C.type;if(!D)throw new Error(Un(12));if(D in c.sliceCaseReducersByType)throw new Error(Un(13));return c.sliceCaseReducersByType[D]=E,h},addMatcher(C,E){return c.sliceMatchers.push({matcher:C,reducer:E}),h},exposeAction(C,E){return c.actionCreators[C]=E,h},exposeCaseReducer(C,E){return c.sliceCaseReducersByName[C]=E,h}};l.forEach(C=>{const E=a[C],D={reducerName:C,type:OD(s,C),createNotation:typeof n.reducers=="function"};GD(E)?YD(D,E,h,e):zD(D,E,h)});function d(){const[C={},E=[],D=void 0]=typeof n.extraReducers=="function"?M5(n.extraReducers):[n.extraReducers],M={...C,...c.sliceCaseReducersByType};return ID(n.initialState,N=>{for(let I in M)N.addCase(I,M[I]);for(let I of c.sliceMatchers)N.addMatcher(I.matcher,I.reducer);for(let I of E)N.addMatcher(I.matcher,I.reducer);D&&N.addDefaultCase(D)})}const f=C=>C,p=new Map,g=new WeakMap;let y;function x(C,E){return y||(y=d()),y(C,E)}function b(){return y||(y=d()),y.getInitialState()}function w(C,E=!1){function D(N){let I=N[C];return typeof I>"u"&&E&&(I=Ih(g,D,b)),I}function M(N=f){const I=Ih(p,E,()=>new WeakMap);return Ih(I,N,()=>{const _={};for(const[F,B]of Object.entries(n.selectors??{}))_[F]=VD(B,N,()=>Ih(g,N,b),E);return _})}return{reducerPath:C,getSelectors:M,get selectors(){return M(D)},selectSlice:D}}const S={name:s,reducer:x,actions:c.actionCreators,caseReducers:c.sliceCaseReducersByName,getInitialState:b,...w(r),injectInto(C,{reducerPath:E,...D}={}){const M=E??r;return C.inject({reducerPath:M,reducer:x},D),{...S,...w(M,!0)}}};return S}}function VD(i,e,t,n){function s(r,...a){let l=e(r);return typeof l>"u"&&n&&(l=t()),i(l,...a)}return s.unwrapped=i,s}var po=UD();function jD(){function i(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return i.withTypes=()=>i,{reducer(e){return Object.assign({[e.name](...t){return e(...t)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,t){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}},asyncThunk:i}}function zD({type:i,reducerName:e,createNotation:t},n,s){let r,a;if("reducer"in n){if(t&&!HD(n))throw new Error(Un(17));r=n.reducer,a=n.prepare}else r=n;s.addCase(i,r).exposeCaseReducer(e,r).exposeAction(e,a?$n(i,a):$n(i))}function GD(i){return i._reducerDefinitionType==="asyncThunk"}function HD(i){return i._reducerDefinitionType==="reducerWithPrepare"}function YD({type:i,reducerName:e},t,n,s){if(!s)throw new Error(Un(18));const{payloadCreator:r,fulfilled:a,pending:l,rejected:c,settled:h,options:d}=t,f=s(i,r,d);n.exposeAction(e,f),a&&n.addCase(f.fulfilled,a),l&&n.addCase(f.pending,l),c&&n.addCase(f.rejected,c),h&&n.addMatcher(f.settled,h),n.exposeCaseReducer(e,{fulfilled:a||_h,pending:l||_h,rejected:c||_h,settled:h||_h})}function _h(){}function Un(i){return`Minified Redux Toolkit error #${i}; visit https://redux-toolkit.js.org/Errors?code=${i} for the full message or use the non-minified dev environment for full errors. `}var qD=class extends Error{issues;constructor(i){super(i[0].message),this.name="SchemaError",this.issues=i}},R5=(i=>(i.uninitialized="uninitialized",i.pending="pending",i.fulfilled="fulfilled",i.rejected="rejected",i))(R5||{}),Ks="uninitialized",Q0="pending",ac="fulfilled",oc="rejected";function jx(i){return{status:i,isUninitialized:i===Ks,isLoading:i===Q0,isSuccess:i===ac,isError:i===oc}}var zx=Lr;function qg(i,e){if(i===e||!(zx(i)&&zx(e)||Array.isArray(i)&&Array.isArray(e)))return e;const t=Object.keys(e),n=Object.keys(i);let s=t.length===n.length;const r=Array.isArray(e)?[]:{};for(const a of t)r[a]=qg(i[a],e[a]),s&&(s=i[a]===r[a]);return s?i:r}function Z0(i,e,t){return i.reduce((n,s,r)=>(e(s,r)&&n.push(t(s,r)),n),[]).flat()}function XD(i){return new RegExp("(^|:)//").test(i)}function WD(){return typeof document>"u"?!0:document.visibilityState!=="hidden"}function Xg(i){return i!=null}function Gx(i){return[...i?.values()??[]].filter(Xg)}function KD(){return typeof navigator>"u"||navigator.onLine===void 0?!0:navigator.onLine}var QD=i=>i.replace(/\/$/,""),ZD=i=>i.replace(/^\//,"");function JD(i,e){if(!i)return e;if(!e)return i;if(XD(e))return e;const t=i.endsWith("/")||!e.startsWith("?")?"/":"";return i=QD(i),e=ZD(e),`${i}${t}${e}`}function Rd(i,e,t){return i.has(e)?i.get(e):i.set(e,t(e)).get(e)}var J0=()=>new Map,$D=i=>{const e=new AbortController;return setTimeout(()=>{const t="signal timed out",n="TimeoutError";e.abort(typeof DOMException<"u"?new DOMException(t,n):Object.assign(new Error(t),{name:n}))},i),e.signal},e6=(...i)=>{for(const t of i)if(t.aborted)return AbortSignal.abort(t.reason);const e=new AbortController;for(const t of i)t.addEventListener("abort",()=>e.abort(t.reason),{signal:e.signal,once:!0});return e.signal},Hx=(...i)=>fetch(...i),t6=i=>i.status>=200&&i.status<=299,i6=i=>/ion\/(vnd\.api\+)?json/.test(i.get("content-type")||"");function Yx(i){if(!Lr(i))return i;const e={...i};for(const[t,n]of Object.entries(e))n===void 0&&delete e[t];return e}var n6=i=>typeof i=="object"&&(Lr(i)||Array.isArray(i)||typeof i.toJSON=="function");function s6({baseUrl:i,prepareHeaders:e=f=>f,fetchFn:t=Hx,paramsSerializer:n,isJsonContentType:s=i6,jsonContentType:r="application/json",jsonReplacer:a,timeout:l,responseHandler:c,validateStatus:h,...d}={}){return typeof fetch>"u"&&t===Hx&&console.warn("Warning: `fetch` is not available. Please supply a custom `fetchFn` property to use `fetchBaseQuery` on SSR environments."),async(p,g,y)=>{const{getState:x,extra:b,endpoint:w,forced:S,type:C}=g;let E,{url:D,headers:M=new Headers(d.headers),params:N=void 0,responseHandler:I=c??"json",validateStatus:_=h??t6,timeout:F=l,...B}=typeof p=="string"?{url:p}:p,P={...d,signal:F?e6(g.signal,$D(F)):g.signal,...B};M=new Headers(Yx(M)),P.headers=await e(M,{getState:x,arg:p,extra:b,endpoint:w,forced:S,type:C,extraOptions:y})||M;const O=n6(P.body);if(P.body!=null&&!O&&typeof P.body!="string"&&P.headers.delete("content-type"),!P.headers.has("content-type")&&O&&P.headers.set("content-type",r),O&&s(P.headers)&&(P.body=JSON.stringify(P.body,a)),P.headers.has("accept")||(I==="json"?P.headers.set("accept","application/json"):I==="text"&&P.headers.set("accept","text/plain, text/html, */*")),N){const te=~D.indexOf("?")?"&":"?",j=n?n(N):new URLSearchParams(Yx(N));D+=te+j}D=JD(i,D);const k=new Request(D,P);E={request:new Request(D,P)};let U;try{U=await t(k)}catch(te){return{error:{status:(te instanceof Error||typeof DOMException<"u"&&te instanceof DOMException)&&te.name==="TimeoutError"?"TIMEOUT_ERROR":"FETCH_ERROR",error:String(te)},meta:E}}const H=U.clone();E.response=H;let Y,Q="";try{let te;if(await Promise.all([f(U,I).then(j=>Y=j,j=>te=j),H.text().then(j=>Q=j,()=>{})]),te)throw te}catch(te){return{error:{status:"PARSING_ERROR",originalStatus:U.status,data:Q,error:String(te)},meta:E}}return _(U,Y)?{data:Y,meta:E}:{error:{status:U.status,data:Y},meta:E}};async function f(p,g){if(typeof g=="function")return g(p);if(g==="content-type"&&(g=s(p.headers)?"json":"text"),g==="json"){const y=await p.text();return y.length?JSON.parse(y):null}return p.text()}}var qx=class{constructor(i,e=void 0){this.value=i,this.meta=e}},tf="__rtkq/",N5="online",I5="offline",r6="focus",_5="focused",a6="visibilitychange",nf=$n(`${tf}${_5}`),Wg=$n(`${tf}un${_5}`),sf=$n(`${tf}${N5}`),Kg=$n(`${tf}${I5}`),Fh=!1;function o6(i,e){function t(){const[n,s,r,a]=[nf,Wg,sf,Kg].map(h=>()=>i(h())),l=()=>{window.document.visibilityState==="visible"?n():s()};let c=()=>{Fh=!1};if(!Fh&&typeof window<"u"&&window.addEventListener){let h=function(f){Object.entries(d).forEach(([p,g])=>{f?window.addEventListener(p,g,!1):window.removeEventListener(p,g)})};const d={[r6]:n,[a6]:l,[N5]:r,[I5]:a};h(!0),Fh=!0,c=()=>{h(!1),Fh=!1}}return c}return t()}var $c="query",F5="mutation",P5="infinitequery";function rf(i){return i.type===$c}function l6(i){return i.type===F5}function af(i){return i.type===P5}function Nd(i){return rf(i)||af(i)}function Qg(i,e,t,n,s,r){const a=c6(i)?i(e,t,n,s):i;return a?Z0(a,Xg,l=>r(B5(l))):[]}function c6(i){return typeof i=="function"}function B5(i){return typeof i=="string"?{type:i}:i}function u6(i,e){return i.catch(e)}var Vo=(i,e)=>i.endpointDefinitions[e],Lc=Symbol("forceQueryFn"),$0=i=>typeof i[Lc]=="function";function h6({serializeQueryArgs:i,queryThunk:e,infiniteQueryThunk:t,mutationThunk:n,api:s,context:r,getInternalState:a}){const l=E=>a(E)?.runningQueries,c=E=>a(E)?.runningMutations,{unsubscribeQueryResult:h,removeMutationResult:d,updateSubscriptionOptions:f}=s.internalActions;return{buildInitiateQuery:w,buildInitiateInfiniteQuery:S,buildInitiateMutation:C,getRunningQueryThunk:p,getRunningMutationThunk:g,getRunningQueriesThunk:y,getRunningMutationsThunk:x};function p(E,D){return M=>{const N=Vo(r,E),I=i({queryArgs:D,endpointDefinition:N,endpointName:E});return l(M)?.get(I)}}function g(E,D){return M=>c(M)?.get(D)}function y(){return E=>Gx(l(E))}function x(){return E=>Gx(c(E))}function b(E,D){const M=(N,{subscribe:I=!0,forceRefetch:_,subscriptionOptions:F,[Lc]:B,...P}={})=>(O,k)=>{const q=i({queryArgs:N,endpointDefinition:D,endpointName:E});let U;const H={...P,type:$c,subscribe:I,forceRefetch:_,subscriptionOptions:F,endpointName:E,originalArgs:N,queryCacheKey:q,[Lc]:B};if(rf(D))U=e(H);else{const{direction:ce,initialPageParam:xe,refetchCachedPages:ge}=P;U=t({...H,direction:ce,initialPageParam:xe,refetchCachedPages:ge})}const Y=s.endpoints[E].select(N),Q=O(U),te=Y(k()),{requestId:j,abort:W}=Q,K=te.requestId!==j,ee=l(O)?.get(q),le=()=>Y(k()),he=Object.assign(B?Q.then(le):K&&!ee?Promise.resolve(te):Promise.all([ee,Q]).then(le),{arg:N,requestId:j,subscriptionOptions:F,queryCacheKey:q,abort:W,async unwrap(){const ce=await he;if(ce.isError)throw ce.error;return ce.data},refetch:ce=>O(M(N,{subscribe:!1,forceRefetch:!0,...ce})),unsubscribe(){I&&O(h({queryCacheKey:q,requestId:j}))},updateSubscriptionOptions(ce){he.subscriptionOptions=ce,O(f({endpointName:E,requestId:j,queryCacheKey:q,options:ce}))}});if(!ee&&!K&&!B){const ce=l(O);ce.set(q,he),he.then(()=>{ce.delete(q)})}return he};return M}function w(E,D){return b(E,D)}function S(E,D){return b(E,D)}function C(E){return(D,{track:M=!0,fixedCacheKey:N}={})=>(I,_)=>{const F=n({type:"mutation",endpointName:E,originalArgs:D,track:M,fixedCacheKey:N}),B=I(F),{requestId:P,abort:O,unwrap:k}=B,q=u6(B.unwrap().then(Q=>({data:Q})),Q=>({error:Q})),U=()=>{I(d({requestId:P,fixedCacheKey:N}))},H=Object.assign(q,{arg:B.arg,requestId:P,abort:O,unwrap:k,reset:U}),Y=c(I);return Y.set(P,H),H.then(()=>{Y.delete(P)}),N&&(Y.set(N,H),H.then(()=>{Y.get(N)===H&&Y.delete(N)})),H}}}var L5=class extends qD{constructor(i,e,t,n){super(i),this.value=e,this.schemaName=t,this._bqMeta=n}},na=(i,e)=>Array.isArray(i)?i.includes(e):!!i;async function sa(i,e,t,n){const s=await i["~standard"].validate(e);if(s.issues)throw new L5(s.issues,e,t,n);return s.value}function Xx(i){return i}var Ql=(i={})=>({...i,[Jd]:!0});function d6({reducerPath:i,baseQuery:e,context:{endpointDefinitions:t},serializeQueryArgs:n,api:s,assertTagType:r,selectors:a,onSchemaFailure:l,catchSchemaFailure:c,skipSchemaValidation:h}){const d=(B,P,O,k)=>(q,U)=>{const H=t[B],Y=n({queryArgs:P,endpointDefinition:H,endpointName:B});if(q(s.internalActions.queryResultPatched({queryCacheKey:Y,patches:O})),!k)return;const Q=s.endpoints[B].select(P)(U()),te=Qg(H.providesTags,Q.data,void 0,P,{},r);q(s.internalActions.updateProvidedBy([{queryCacheKey:Y,providedTags:te}]))};function f(B,P,O=0){const k=[P,...B];return O&&k.length>O?k.slice(0,-1):k}function p(B,P,O=0){const k=[...B,P];return O&&k.length>O?k.slice(1):k}const g=(B,P,O,k=!0)=>(q,U)=>{const Y=s.endpoints[B].select(P)(U()),Q={patches:[],inversePatches:[],undo:()=>q(s.util.patchQueryData(B,P,Q.inversePatches,k))};if(Y.status===Ks)return Q;let te;if("data"in Y)if(vn(Y.data)){const[j,W,K]=C5(Y.data,O);Q.patches.push(...W),Q.inversePatches.push(...K),te=j}else te=O(Y.data),Q.patches.push({op:"replace",path:[],value:te}),Q.inversePatches.push({op:"replace",path:[],value:Y.data});return Q.patches.length===0||q(s.util.patchQueryData(B,P,Q.patches,k)),Q},y=(B,P,O)=>k=>k(s.endpoints[B].initiate(P,{subscribe:!1,forceRefetch:!0,[Lc]:()=>({data:O})})),x=(B,P)=>B.query&&B[P]?B[P]:Xx,b=async(B,{signal:P,abort:O,rejectWithValue:k,fulfillWithValue:q,dispatch:U,getState:H,extra:Y})=>{const Q=t[B.endpointName],{metaSchema:te,skipSchemaValidation:j=h}=Q,W=B.type===$c;try{let K=Xx;const ee={signal:P,abort:O,dispatch:U,getState:H,extra:Y,endpoint:B.endpointName,type:B.type,forced:W?w(B,H()):void 0,queryCacheKey:W?B.queryCacheKey:void 0},le=W?B[Lc]:void 0;let he;const ce=async(ge,Me,Ie,$e)=>{if(Me==null&&ge.pages.length)return Promise.resolve({data:ge});const We={queryArg:B.originalArgs,pageParam:Me},Pe=await xe(We),ht=$e?f:p;return{data:{pages:ht(ge.pages,Pe.data,Ie),pageParams:ht(ge.pageParams,Me,Ie)},meta:Pe.meta}};async function xe(ge){let Me;const{extraOptions:Ie,argSchema:$e,rawResponseSchema:We,responseSchema:Pe}=Q;if($e&&!na(j,"arg")&&(ge=await sa($e,ge,"argSchema",{})),le?Me=le():Q.query?(K=x(Q,"transformResponse"),Me=await e(Q.query(ge),ee,Ie)):Me=await Q.queryFn(ge,ee,Ie,ft=>e(ft,ee,Ie)),typeof process<"u",Me.error)throw new qx(Me.error,Me.meta);let{data:ht}=Me;We&&!na(j,"rawResponse")&&(ht=await sa(We,Me.data,"rawResponseSchema",Me.meta));let Qe=await K(ht,Me.meta,ge);return Pe&&!na(j,"response")&&(Qe=await sa(Pe,Qe,"responseSchema",Me.meta)),{...Me,data:Qe}}if(W&&"infiniteQueryOptions"in Q){const{infiniteQueryOptions:ge}=Q,{maxPages:Me=1/0}=ge,Ie=B.refetchCachedPages??ge.refetchCachedPages??!0;let $e;const We={pages:[],pageParams:[]},Pe=a.selectQueryEntry(H(),B.queryCacheKey)?.data,Qe=w(B,H())&&!B.direction||!Pe?We:Pe;if("direction"in B&&B.direction&&Qe.pages.length){const ft=B.direction==="backward",Gn=(ft?k5:eg)(ge,Qe,B.originalArgs);$e=await ce(Qe,Gn,Me,ft)}else{const{initialPageParam:ft=ge.initialPageParam}=B,gs=Pe?.pageParams??[],Gn=gs[0]??ft,wn=gs.length;if($e=await ce(Qe,Gn,Me),le&&($e={data:$e.data.pages[0]}),Ie)for(let bi=1;bi<wn;bi++){const Sn=eg(ge,$e.data,B.originalArgs);$e=await ce($e.data,Sn,Me)}}he=$e}else he=await xe(B.originalArgs);return te&&!na(j,"meta")&&he.meta&&(he.meta=await sa(te,he.meta,"metaSchema",he.meta)),q(he.data,Ql({fulfilledTimeStamp:Date.now(),baseQueryMeta:he.meta}))}catch(K){let ee=K;if(ee instanceof qx){let le=x(Q,"transformErrorResponse");const{rawErrorResponseSchema:he,errorResponseSchema:ce}=Q;let{value:xe,meta:ge}=ee;try{he&&!na(j,"rawErrorResponse")&&(xe=await sa(he,xe,"rawErrorResponseSchema",ge)),te&&!na(j,"meta")&&(ge=await sa(te,ge,"metaSchema",ge));let Me=await le(xe,ge,B.originalArgs);return ce&&!na(j,"errorResponse")&&(Me=await sa(ce,Me,"errorResponseSchema",ge)),k(Me,Ql({baseQueryMeta:ge}))}catch(Me){ee=Me}}try{if(ee instanceof L5){const le={endpoint:B.endpointName,arg:B.originalArgs,type:B.type,queryCacheKey:W?B.queryCacheKey:void 0};Q.onSchemaFailure?.(ee,le),l?.(ee,le);const{catchSchemaFailure:he=c}=Q;if(he)return k(he(ee,le),Ql({baseQueryMeta:ee._bqMeta}))}}catch(le){ee=le}throw console.error(ee),ee}};function w(B,P){const O=a.selectQueryEntry(P,B.queryCacheKey),k=a.selectConfig(P).refetchOnMountOrArgChange,q=O?.fulfilledTimeStamp,U=B.forceRefetch??(B.subscribe&&k);return U?U===!0||(Number(new Date)-Number(q))/1e3>=U:!1}const S=()=>Vx(`${i}/executeQuery`,b,{getPendingMeta({arg:P}){const O=t[P.endpointName];return Ql({startedTimeStamp:Date.now(),...af(O)?{direction:P.direction}:{}})},condition(P,{getState:O}){const k=O(),q=a.selectQueryEntry(k,P.queryCacheKey),U=q?.fulfilledTimeStamp,H=P.originalArgs,Y=q?.originalArgs,Q=t[P.endpointName],te=P.direction;return $0(P)?!0:q?.status==="pending"?!1:w(P,k)||rf(Q)&&Q?.forceRefetch?.({currentArg:H,previousArg:Y,endpointState:q,state:k})?!0:!(U&&!te)},dispatchConditionRejection:!0}),C=S(),E=S(),D=Vx(`${i}/executeMutation`,b,{getPendingMeta(){return Ql({startedTimeStamp:Date.now()})}}),M=B=>"force"in B,N=B=>"ifOlderThan"in B,I=(B,P,O={})=>(k,q)=>{const U=M(O)&&O.force,H=N(O)&&O.ifOlderThan,Y=(te=!0)=>{const j={forceRefetch:te,subscribe:!1};return s.endpoints[B].initiate(P,j)},Q=s.endpoints[B].select(P)(q());if(U)k(Y());else if(H){const te=Q?.fulfilledTimeStamp;if(!te){k(Y());return}(Number(new Date)-Number(new Date(te)))/1e3>=H&&k(Y())}else k(Y(!1))};function _(B){return P=>P?.meta?.arg?.endpointName===B}function F(B,P){return{matchPending:Sc(Hg(B),_(P)),matchFulfilled:Sc(kr(B),_(P)),matchRejected:Sc(Uo(B),_(P))}}return{queryThunk:C,mutationThunk:D,infiniteQueryThunk:E,prefetch:I,updateQueryData:g,upsertQueryData:y,patchQueryData:d,buildMatchThunkActions:F}}function eg(i,{pages:e,pageParams:t},n){const s=e.length-1;return i.getNextPageParam(e[s],e,t[s],t,n)}function k5(i,{pages:e,pageParams:t},n){return i.getPreviousPageParam?.(e[0],e,t[0],t,n)}function O5(i,e,t,n){return Qg(t[i.meta.arg.endpointName][e],kr(i)?i.payload:void 0,ef(i)?i.payload:void 0,i.meta.arg.originalArgs,"baseQueryMeta"in i.meta?i.meta.baseQueryMeta:void 0,n)}function Wx(i){return An(i)?w5(i):i}function Ph(i,e,t){const n=i[e];n&&t(n)}function kc(i){return("arg"in i?i.arg.fixedCacheKey:i.fixedCacheKey)??i.requestId}function Kx(i,e,t){const n=i[kc(e)];n&&t(n)}var Bh={};function f6({reducerPath:i,queryThunk:e,mutationThunk:t,serializeQueryArgs:n,context:{endpointDefinitions:s,apiUid:r,extractRehydrationInfo:a,hasRehydrationInfo:l},assertTagType:c,config:h}){const d=$n(`${i}/resetApiState`);function f(_,F,B,P){_[F.queryCacheKey]??={status:Ks,endpointName:F.endpointName},Ph(_,F.queryCacheKey,O=>{O.status=Q0,O.requestId=B&&O.requestId?O.requestId:P.requestId,F.originalArgs!==void 0&&(O.originalArgs=F.originalArgs),O.startedTimeStamp=P.startedTimeStamp;const k=s[P.arg.endpointName];af(k)&&"direction"in F&&(O.direction=F.direction)})}function p(_,F,B,P){Ph(_,F.arg.queryCacheKey,O=>{if(O.requestId!==F.requestId&&!P)return;const{merge:k}=s[F.arg.endpointName];if(O.status=ac,k)if(O.data!==void 0){const{fulfilledTimeStamp:q,arg:U,baseQueryMeta:H,requestId:Y}=F;let Q=Zc(O.data,te=>k(te,B,{arg:U.originalArgs,baseQueryMeta:H,fulfilledTimeStamp:q,requestId:Y}));O.data=Q}else O.data=B;else O.data=s[F.arg.endpointName].structuralSharing??!0?qg(An(O.data)?KM(O.data):O.data,B):B;delete O.error,O.fulfilledTimeStamp=F.fulfilledTimeStamp})}const g=po({name:`${i}/queries`,initialState:Bh,reducers:{removeQueryResult:{reducer(_,{payload:{queryCacheKey:F}}){delete _[F]},prepare:Kl()},cacheEntriesUpserted:{reducer(_,F){for(const B of F.payload){const{queryDescription:P,value:O}=B;f(_,P,!0,{arg:P,requestId:F.meta.requestId,startedTimeStamp:F.meta.timestamp}),p(_,{arg:P,requestId:F.meta.requestId,fulfilledTimeStamp:F.meta.timestamp,baseQueryMeta:{}},O,!0)}},prepare:_=>({payload:_.map(P=>{const{endpointName:O,arg:k,value:q}=P,U=s[O];return{queryDescription:{type:$c,endpointName:O,originalArgs:P.arg,queryCacheKey:n({queryArgs:k,endpointDefinition:U,endpointName:O})},value:q}}),meta:{[Jd]:!0,requestId:Yg(),timestamp:Date.now()}})},queryResultPatched:{reducer(_,{payload:{queryCacheKey:F,patches:B}}){Ph(_,F,P=>{P.data=Fx(P.data,B.concat())})},prepare:Kl()}},extraReducers(_){_.addCase(e.pending,(F,{meta:B,meta:{arg:P}})=>{const O=$0(P);f(F,P,O,B)}).addCase(e.fulfilled,(F,{meta:B,payload:P})=>{const O=$0(B.arg);p(F,B,P,O)}).addCase(e.rejected,(F,{meta:{condition:B,arg:P,requestId:O},error:k,payload:q})=>{Ph(F,P.queryCacheKey,U=>{if(!B){if(U.requestId!==O)return;U.status=oc,U.error=q??k}})}).addMatcher(l,(F,B)=>{const{queries:P}=a(B);for(const[O,k]of Object.entries(P))(k?.status===ac||k?.status===oc)&&(F[O]=k)})}}),y=po({name:`${i}/mutations`,initialState:Bh,reducers:{removeMutationResult:{reducer(_,{payload:F}){const B=kc(F);B in _&&delete _[B]},prepare:Kl()}},extraReducers(_){_.addCase(t.pending,(F,{meta:B,meta:{requestId:P,arg:O,startedTimeStamp:k}})=>{O.track&&(F[kc(B)]={requestId:P,status:Q0,endpointName:O.endpointName,startedTimeStamp:k})}).addCase(t.fulfilled,(F,{payload:B,meta:P})=>{P.arg.track&&Kx(F,P,O=>{O.requestId===P.requestId&&(O.status=ac,O.data=B,O.fulfilledTimeStamp=P.fulfilledTimeStamp)})}).addCase(t.rejected,(F,{payload:B,error:P,meta:O})=>{O.arg.track&&Kx(F,O,k=>{k.requestId===O.requestId&&(k.status=oc,k.error=B??P)})}).addMatcher(l,(F,B)=>{const{mutations:P}=a(B);for(const[O,k]of Object.entries(P))(k?.status===ac||k?.status===oc)&&O!==k?.requestId&&(F[O]=k)})}}),x={tags:{},keys:{}},b=po({name:`${i}/invalidation`,initialState:x,reducers:{updateProvidedBy:{reducer(_,F){for(const{queryCacheKey:B,providedTags:P}of F.payload){w(_,B);for(const{type:O,id:k}of P){const q=(_.tags[O]??={})[k||"__internal_without_id"]??=[];q.includes(B)||q.push(B)}_.keys[B]=P}},prepare:Kl()}},extraReducers(_){_.addCase(g.actions.removeQueryResult,(F,{payload:{queryCacheKey:B}})=>{w(F,B)}).addMatcher(l,(F,B)=>{const{provided:P}=a(B);for(const[O,k]of Object.entries(P.tags??{}))for(const[q,U]of Object.entries(k)){const H=(F.tags[O]??={})[q||"__internal_without_id"]??=[];for(const Y of U)H.includes(Y)||H.push(Y),F.keys[Y]=P.keys[Y]}}).addMatcher(Ws(kr(e),ef(e)),(F,B)=>{S(F,[B])}).addMatcher(g.actions.cacheEntriesUpserted.match,(F,B)=>{const P=B.payload.map(({queryDescription:O,value:k})=>({type:"UNKNOWN",payload:k,meta:{requestStatus:"fulfilled",requestId:"UNKNOWN",arg:O}}));S(F,P)})}});function w(_,F){const B=Wx(_.keys[F]??[]);for(const P of B){const O=P.type,k=P.id??"__internal_without_id",q=_.tags[O]?.[k];q&&(_.tags[O][k]=Wx(q).filter(U=>U!==F))}delete _.keys[F]}function S(_,F){const B=F.map(P=>{const O=O5(P,"providesTags",s,c),{queryCacheKey:k}=P.meta.arg;return{queryCacheKey:k,providedTags:O}});b.caseReducers.updateProvidedBy(_,b.actions.updateProvidedBy(B))}const C=po({name:`${i}/subscriptions`,initialState:Bh,reducers:{updateSubscriptionOptions(_,F){},unsubscribeQueryResult(_,F){},internal_getRTKQSubscriptions(){}}}),E=po({name:`${i}/internalSubscriptions`,initialState:Bh,reducers:{subscriptionsUpdated:{reducer(_,F){return Fx(_,F.payload)},prepare:Kl()}}}),D=po({name:`${i}/config`,initialState:{online:KD(),focused:WD(),middlewareRegistered:!1,...h},reducers:{middlewareRegistered(_,{payload:F}){_.middlewareRegistered=_.middlewareRegistered==="conflict"||r!==F?"conflict":!0}},extraReducers:_=>{_.addCase(sf,F=>{F.online=!0}).addCase(Kg,F=>{F.online=!1}).addCase(nf,F=>{F.focused=!0}).addCase(Wg,F=>{F.focused=!1}).addMatcher(l,F=>({...F}))}}),M=m5({queries:g.reducer,mutations:y.reducer,provided:b.reducer,subscriptions:E.reducer,config:D.reducer}),N=(_,F)=>M(d.match(F)?void 0:_,F),I={...D.actions,...g.actions,...C.actions,...E.actions,...y.actions,...b.actions,resetApiState:d};return{reducer:N,actions:I}}var Qn=Symbol.for("RTKQ/skipToken"),U5={status:Ks},Qx=Zc(U5,()=>{}),Zx=Zc(U5,()=>{});function m6({serializeQueryArgs:i,reducerPath:e,createSelector:t}){const n=C=>Qx,s=C=>Zx;return{buildQuerySelector:p,buildInfiniteQuerySelector:g,buildMutationSelector:y,selectInvalidatedBy:x,selectCachedArgsForQuery:b,selectApiState:a,selectQueries:l,selectMutations:h,selectQueryEntry:c,selectConfig:d};function r(C){return{...C,...jx(C.status)}}function a(C){return C[e]}function l(C){return a(C)?.queries}function c(C,E){return l(C)?.[E]}function h(C){return a(C)?.mutations}function d(C){return a(C)?.config}function f(C,E,D){return M=>{if(M===Qn)return t(n,D);const N=i({queryArgs:M,endpointDefinition:E,endpointName:C});return t(_=>c(_,N)??Qx,D)}}function p(C,E){return f(C,E,r)}function g(C,E){const{infiniteQueryOptions:D}=E;function M(N){const I={...N,...jx(N.status)},{isLoading:_,isError:F,direction:B}=I,P=B==="forward",O=B==="backward";return{...I,hasNextPage:w(D,I.data,I.originalArgs),hasPreviousPage:S(D,I.data,I.originalArgs),isFetchingNextPage:_&&P,isFetchingPreviousPage:_&&O,isFetchNextPageError:F&&P,isFetchPreviousPageError:F&&O}}return f(C,E,M)}function y(){return C=>{let E;return typeof C=="object"?E=kc(C)??Qn:E=C,t(E===Qn?s:N=>a(N)?.mutations?.[E]??Zx,r)}}function x(C,E){const D=C[e],M=new Set,N=Z0(E,Xg,B5);for(const I of N){const _=D.provided.tags[I.type];if(!_)continue;let F=(I.id!==void 0?_[I.id]:Object.values(_).flat())??[];for(const B of F)M.add(B)}return Array.from(M.values()).flatMap(I=>{const _=D.queries[I];return _?{queryCacheKey:I,endpointName:_.endpointName,originalArgs:_.originalArgs}:[]})}function b(C,E){return Z0(Object.values(l(C)),D=>D?.endpointName===E&&D.status!==Ks,D=>D.originalArgs)}function w(C,E,D){return E?eg(C,E,D)!=null:!1}function S(C,E,D){return!E||!C.getPreviousPageParam?!1:k5(C,E,D)!=null}}var Jx=WeakMap?new WeakMap:void 0,$x=({endpointName:i,queryArgs:e})=>{let t="";const n=Jx?.get(e);if(typeof n=="string")t=n;else{const s=JSON.stringify(e,(r,a)=>(a=typeof a=="bigint"?{$bigint:a.toString()}:a,a=Lr(a)?Object.keys(a).sort().reduce((l,c)=>(l[c]=a[c],l),{}):a,a));Lr(e)&&Jx?.set(e,s),t=s}return`${i}(${t})`};function V5(...i){return function(t){const n=Dd(h=>t.extractRehydrationInfo?.(h,{reducerPath:t.reducerPath??"api"})),s={reducerPath:"api",keepUnusedDataFor:60,refetchOnMountOrArgChange:!1,refetchOnFocus:!1,refetchOnReconnect:!1,invalidationBehavior:"delayed",...t,extractRehydrationInfo:n,serializeQueryArgs(h){let d=$x;if("serializeQueryArgs"in h.endpointDefinition){const f=h.endpointDefinition.serializeQueryArgs;d=p=>{const g=f(p);return typeof g=="string"?g:$x({...p,queryArgs:g})}}else t.serializeQueryArgs&&(d=t.serializeQueryArgs);return d(h)},tagTypes:[...t.tagTypes||[]]},r={endpointDefinitions:{},batch(h){h()},apiUid:Yg(),extractRehydrationInfo:n,hasRehydrationInfo:Dd(h=>n(h)!=null)},a={injectEndpoints:c,enhanceEndpoints({addTagTypes:h,endpoints:d}){if(h)for(const f of h)s.tagTypes.includes(f)||s.tagTypes.push(f);if(d)for(const[f,p]of Object.entries(d))typeof p=="function"?p(Vo(r,f)):Object.assign(Vo(r,f)||{},p);return a}},l=i.map(h=>h.init(a,s,r));function c(h){const d=h.endpoints({query:f=>({...f,type:$c}),mutation:f=>({...f,type:F5}),infiniteQuery:f=>({...f,type:P5})});for(const[f,p]of Object.entries(d)){if(h.overrideExisting!==!0&&f in r.endpointDefinitions){if(h.overrideExisting==="throw")throw new Error(Un(39));continue}r.endpointDefinitions[f]=p;for(const g of l)g.injectEndpoint(f,p)}return a}return a.injectEndpoints({endpoints:t.endpoints})}}function ks(i,...e){return Object.assign(i,...e)}var p6=({api:i,queryThunk:e,internalState:t,mwApi:n})=>{const s=`${i.reducerPath}/subscriptions`;let r=null,a=null;const{updateSubscriptionOptions:l,unsubscribeQueryResult:c}=i.internalActions,h=(x,b)=>{if(l.match(b)){const{queryCacheKey:S,requestId:C,options:E}=b.payload,D=x.get(S);return D?.has(C)&&D.set(C,E),!0}if(c.match(b)){const{queryCacheKey:S,requestId:C}=b.payload,E=x.get(S);return E&&E.delete(C),!0}if(i.internalActions.removeQueryResult.match(b))return x.delete(b.payload.queryCacheKey),!0;if(e.pending.match(b)){const{meta:{arg:S,requestId:C}}=b,E=Rd(x,S.queryCacheKey,J0);return S.subscribe&&E.set(C,S.subscriptionOptions??E.get(C)??{}),!0}let w=!1;if(e.rejected.match(b)){const{meta:{condition:S,arg:C,requestId:E}}=b;if(S&&C.subscribe){const D=Rd(x,C.queryCacheKey,J0);D.set(E,C.subscriptionOptions??D.get(E)??{}),w=!0}}return w},d=()=>t.currentSubscriptions,g={getSubscriptions:d,getSubscriptionCount:x=>d().get(x)?.size??0,isRequestSubscribed:(x,b)=>!!d()?.get(x)?.get(b)};function y(x){return JSON.parse(JSON.stringify(Object.fromEntries([...x].map(([b,w])=>[b,Object.fromEntries(w)]))))}return(x,b)=>{if(r||(r=y(t.currentSubscriptions)),i.util.resetApiState.match(x))return r={},t.currentSubscriptions.clear(),a=null,[!0,!1];if(i.internalActions.internal_getRTKQSubscriptions.match(x))return[!1,g];const w=h(t.currentSubscriptions,x);let S=!0;if(w){a||(a=setTimeout(()=>{const D=y(t.currentSubscriptions),[,M]=C5(r,()=>D);b.next(i.internalActions.subscriptionsUpdated(M)),r=D,a=null},500));const C=typeof x.type=="string"&&!!x.type.startsWith(s),E=e.rejected.match(x)&&x.meta.condition&&!!x.meta.arg.subscribe;S=!C&&!E}return[S,!1]}},g6=2147483647/1e3-1,A6=({reducerPath:i,api:e,queryThunk:t,context:n,internalState:s,selectors:{selectQueryEntry:r,selectConfig:a},getRunningQueryThunk:l,mwApi:c})=>{const{removeQueryResult:h,unsubscribeQueryResult:d,cacheEntriesUpserted:f}=e.internalActions,p=Ws(d.match,t.fulfilled,t.rejected,f.match);function g(C){const E=s.currentSubscriptions.get(C);return E?E.size>0:!1}const y={};function x(C){for(const E of C.values())E?.abort?.()}const b=(C,E)=>{const D=E.getState(),M=a(D);if(p(C)){let N;if(f.match(C))N=C.payload.map(I=>I.queryDescription.queryCacheKey);else{const{queryCacheKey:I}=d.match(C)?C.payload:C.meta.arg;N=[I]}w(N,E,M)}if(e.util.resetApiState.match(C)){for(const[N,I]of Object.entries(y))I&&clearTimeout(I),delete y[N];x(s.runningQueries),x(s.runningMutations)}if(n.hasRehydrationInfo(C)){const{queries:N}=n.extractRehydrationInfo(C);w(Object.keys(N),E,M)}};function w(C,E,D){const M=E.getState();for(const N of C){const I=r(M,N);I?.endpointName&&S(N,I.endpointName,E,D)}}function S(C,E,D,M){const I=Vo(n,E)?.keepUnusedDataFor??M.keepUnusedDataFor;if(I===1/0)return;const _=Math.max(0,Math.min(I,g6));if(!g(C)){const F=y[C];F&&clearTimeout(F),y[C]=setTimeout(()=>{if(!g(C)){const B=r(D.getState(),C);B?.endpointName&&D.dispatch(l(B.endpointName,B.originalArgs))?.abort(),D.dispatch(h({queryCacheKey:C}))}delete y[C]},_*1e3)}}return b},eb=new Error("Promise never resolved before cacheEntryRemoved."),v6=({api:i,reducerPath:e,context:t,queryThunk:n,mutationThunk:s,internalState:r,selectors:{selectQueryEntry:a,selectApiState:l}})=>{const c=K0(n),h=K0(s),d=kr(n,s),f={},{removeQueryResult:p,removeMutationResult:g,cacheEntriesUpserted:y}=i.internalActions;function x(D,M,N){const I=f[D];I?.valueResolved&&(I.valueResolved({data:M,meta:N}),delete I.valueResolved)}function b(D){const M=f[D];M&&(delete f[D],M.cacheEntryRemoved())}function w(D){const{arg:M,requestId:N}=D.meta,{endpointName:I,originalArgs:_}=M;return[I,_,N]}const S=(D,M,N)=>{const I=C(D);function _(F,B,P,O){const k=a(N,B),q=a(M.getState(),B);!k&&q&&E(F,O,B,M,P)}if(n.pending.match(D)){const[F,B,P]=w(D);_(F,I,P,B)}else if(y.match(D))for(const{queryDescription:F,value:B}of D.payload){const{endpointName:P,originalArgs:O,queryCacheKey:k}=F;_(P,k,D.meta.requestId,O),x(k,B,{})}else if(s.pending.match(D)){if(M.getState()[e].mutations[I]){const[B,P,O]=w(D);E(B,P,I,M,O)}}else if(d(D))x(I,D.payload,D.meta.baseQueryMeta);else if(p.match(D)||g.match(D))b(I);else if(i.util.resetApiState.match(D))for(const F of Object.keys(f))b(F)};function C(D){return c(D)?D.meta.arg.queryCacheKey:h(D)?D.meta.arg.fixedCacheKey??D.meta.requestId:p.match(D)?D.payload.queryCacheKey:g.match(D)?kc(D.payload):""}function E(D,M,N,I,_){const F=Vo(t,D),B=F?.onCacheEntryAdded;if(!B)return;const P={},O=new Promise(Q=>{P.cacheEntryRemoved=Q}),k=Promise.race([new Promise(Q=>{P.valueResolved=Q}),O.then(()=>{throw eb})]);k.catch(()=>{}),f[N]=P;const q=i.endpoints[D].select(Nd(F)?M:N),U=I.dispatch((Q,te,j)=>j),H={...I,getCacheEntry:()=>q(I.getState()),requestId:_,extra:U,updateCachedData:Nd(F)?Q=>I.dispatch(i.util.updateQueryData(D,M,Q)):void 0,cacheDataLoaded:k,cacheEntryRemoved:O},Y=B(M,H);Promise.resolve(Y).catch(Q=>{if(Q!==eb)throw Q})}return S},y6=({api:i,context:{apiUid:e},reducerPath:t})=>(n,s)=>{i.util.resetApiState.match(n)&&s.dispatch(i.internalActions.middlewareRegistered(e))},x6=({reducerPath:i,context:e,context:{endpointDefinitions:t},mutationThunk:n,queryThunk:s,api:r,assertTagType:a,refetchQuery:l,internalState:c})=>{const{removeQueryResult:h}=r.internalActions,d=Ws(kr(n),ef(n)),f=Ws(kr(s,n),Uo(s,n));let p=[],g=0;const y=(w,S)=>{(s.pending.match(w)||n.pending.match(w))&&g++,f(w)&&(g=Math.max(0,g-1)),d(w)?b(O5(w,"invalidatesTags",t,a),S):f(w)?b([],S):r.util.invalidateTags.match(w)&&b(Qg(w.payload,void 0,void 0,void 0,void 0,a),S)};function x(){return g>0}function b(w,S){const C=S.getState(),E=C[i];if(p.push(...w),E.config.invalidationBehavior==="delayed"&&x())return;const D=p;if(p=[],D.length===0)return;const M=r.util.selectInvalidatedBy(C,D);e.batch(()=>{const N=Array.from(M.values());for(const{queryCacheKey:I}of N){const _=E.queries[I],F=Rd(c.currentSubscriptions,I,J0);_&&(F.size===0?S.dispatch(h({queryCacheKey:I})):_.status!==Ks&&S.dispatch(l(_)))}})}return y},b6=({reducerPath:i,queryThunk:e,api:t,refetchQuery:n,internalState:s})=>{const{currentPolls:r,currentSubscriptions:a}=s,l=new Set;let c=null;const h=(b,w)=>{(t.internalActions.updateSubscriptionOptions.match(b)||t.internalActions.unsubscribeQueryResult.match(b))&&d(b.payload.queryCacheKey,w),(e.pending.match(b)||e.rejected.match(b)&&b.meta.condition)&&d(b.meta.arg.queryCacheKey,w),(e.fulfilled.match(b)||e.rejected.match(b)&&!b.meta.condition)&&f(b.meta.arg,w),t.util.resetApiState.match(b)&&(y(),c&&(clearTimeout(c),c=null),l.clear())};function d(b,w){l.add(b),c||(c=setTimeout(()=>{for(const S of l)p({queryCacheKey:S},w);l.clear(),c=null},0))}function f({queryCacheKey:b},w){const S=w.getState()[i],C=S.queries[b],E=a.get(b);if(!C||C.status===Ks)return;const{lowestPollingInterval:D,skipPollingIfUnfocused:M}=x(E);if(!Number.isFinite(D))return;const N=r.get(b);N?.timeout&&(clearTimeout(N.timeout),N.timeout=void 0);const I=Date.now()+D;r.set(b,{nextPollTimestamp:I,pollingInterval:D,timeout:setTimeout(()=>{(S.config.focused||!M)&&w.dispatch(n(C)),f({queryCacheKey:b},w)},D)})}function p({queryCacheKey:b},w){const C=w.getState()[i].queries[b],E=a.get(b);if(!C||C.status===Ks)return;const{lowestPollingInterval:D}=x(E);if(!Number.isFinite(D)){g(b);return}const M=r.get(b),N=Date.now()+D;(!M||N<M.nextPollTimestamp)&&f({queryCacheKey:b},w)}function g(b){const w=r.get(b);w?.timeout&&clearTimeout(w.timeout),r.delete(b)}function y(){for(const b of r.keys())g(b)}function x(b=new Map){let w=!1,S=Number.POSITIVE_INFINITY;for(const C of b.values())C.pollingInterval&&(S=Math.min(C.pollingInterval,S),w=C.skipPollingIfUnfocused||w);return{lowestPollingInterval:S,skipPollingIfUnfocused:w}}return h},w6=({api:i,context:e,queryThunk:t,mutationThunk:n})=>{const s=Hg(t,n),r=Uo(t,n),a=kr(t,n),l={};return(h,d)=>{if(s(h)){const{requestId:f,arg:{endpointName:p,originalArgs:g}}=h.meta,y=Vo(e,p),x=y?.onQueryStarted;if(x){const b={},w=new Promise((D,M)=>{b.resolve=D,b.reject=M});w.catch(()=>{}),l[f]=b;const S=i.endpoints[p].select(Nd(y)?g:f),C=d.dispatch((D,M,N)=>N),E={...d,getCacheEntry:()=>S(d.getState()),requestId:f,extra:C,updateCachedData:Nd(y)?D=>d.dispatch(i.util.updateQueryData(p,g,D)):void 0,queryFulfilled:w};x(g,E)}}else if(a(h)){const{requestId:f,baseQueryMeta:p}=h.meta;l[f]?.resolve({data:h.payload,meta:p}),delete l[f]}else if(r(h)){const{requestId:f,rejectedWithValue:p,baseQueryMeta:g}=h.meta;l[f]?.reject({error:h.payload??h.error,isUnhandledError:!p,meta:g}),delete l[f]}}},S6=({reducerPath:i,context:e,api:t,refetchQuery:n,internalState:s})=>{const{removeQueryResult:r}=t.internalActions,a=(c,h)=>{nf.match(c)&&l(h,"refetchOnFocus"),sf.match(c)&&l(h,"refetchOnReconnect")};function l(c,h){const d=c.getState()[i],f=d.queries,p=s.currentSubscriptions;e.batch(()=>{for(const g of p.keys()){const y=f[g],x=p.get(g);if(!x||!y)continue;const b=[...x.values()];(b.some(S=>S[h]===!0)||b.every(S=>S[h]===void 0)&&d.config[h])&&(x.size===0?c.dispatch(r({queryCacheKey:g})):y.status!==Ks&&c.dispatch(n(y)))}})}return a};function C6(i){const{reducerPath:e,queryThunk:t,api:n,context:s,getInternalState:r}=i,{apiUid:a}=s,l={invalidateTags:$n(`${e}/invalidateTags`)},c=p=>p.type.startsWith(`${e}/`),h=[y6,A6,x6,b6,v6,w6];return{middleware:p=>{let g=!1;const y=r(p.dispatch),x={...i,internalState:y,refetchQuery:f,isThisApiSliceAction:c,mwApi:p},b=h.map(C=>C(x)),w=p6(x),S=S6(x);return C=>E=>{if(!p5(E))return C(E);g||(g=!0,p.dispatch(n.internalActions.middlewareRegistered(a)));const D={...p,next:C},M=p.getState(),[N,I]=w(E,D,M);let _;if(N?_=C(E):_=I,p.getState()[e]&&(S(E,D,M),c(E)||s.hasRehydrationInfo(E)))for(const F of b)F(E,D,M);return _}},actions:l};function f(p){return i.api.endpoints[p.endpointName].initiate(p.originalArgs,{subscribe:!1,forceRefetch:!0})}}var tb=Symbol(),j5=({createSelector:i=Gg}={})=>({name:tb,init(e,{baseQuery:t,tagTypes:n,reducerPath:s,serializeQueryArgs:r,keepUnusedDataFor:a,refetchOnMountOrArgChange:l,refetchOnFocus:c,refetchOnReconnect:h,invalidationBehavior:d,onSchemaFailure:f,catchSchemaFailure:p,skipSchemaValidation:g},y){uD();const x=ce=>ce;Object.assign(e,{reducerPath:s,endpoints:{},internalActions:{onOnline:sf,onOffline:Kg,onFocus:nf,onFocusLost:Wg},util:{}});const b=m6({serializeQueryArgs:r,reducerPath:s,createSelector:i}),{selectInvalidatedBy:w,selectCachedArgsForQuery:S,buildQuerySelector:C,buildInfiniteQuerySelector:E,buildMutationSelector:D}=b;ks(e.util,{selectInvalidatedBy:w,selectCachedArgsForQuery:S});const{queryThunk:M,infiniteQueryThunk:N,mutationThunk:I,patchQueryData:_,updateQueryData:F,upsertQueryData:B,prefetch:P,buildMatchThunkActions:O}=d6({baseQuery:t,reducerPath:s,context:y,api:e,serializeQueryArgs:r,assertTagType:x,selectors:b,onSchemaFailure:f,catchSchemaFailure:p,skipSchemaValidation:g}),{reducer:k,actions:q}=f6({context:y,queryThunk:M,mutationThunk:I,serializeQueryArgs:r,reducerPath:s,assertTagType:x,config:{refetchOnFocus:c,refetchOnReconnect:h,refetchOnMountOrArgChange:l,keepUnusedDataFor:a,reducerPath:s,invalidationBehavior:d}});ks(e.util,{patchQueryData:_,updateQueryData:F,upsertQueryData:B,prefetch:P,resetApiState:q.resetApiState,upsertQueryEntries:q.cacheEntriesUpserted}),ks(e.internalActions,q);const U=new WeakMap,H=ce=>Rd(U,ce,()=>({currentSubscriptions:new Map,currentPolls:new Map,runningQueries:new Map,runningMutations:new Map})),{buildInitiateQuery:Y,buildInitiateInfiniteQuery:Q,buildInitiateMutation:te,getRunningMutationThunk:j,getRunningMutationsThunk:W,getRunningQueriesThunk:K,getRunningQueryThunk:ee}=h6({queryThunk:M,mutationThunk:I,infiniteQueryThunk:N,api:e,serializeQueryArgs:r,context:y,getInternalState:H});ks(e.util,{getRunningMutationThunk:j,getRunningMutationsThunk:W,getRunningQueryThunk:ee,getRunningQueriesThunk:K});const{middleware:le,actions:he}=C6({reducerPath:s,context:y,queryThunk:M,mutationThunk:I,infiniteQueryThunk:N,api:e,assertTagType:x,selectors:b,getRunningQueryThunk:ee,getInternalState:H});return ks(e.util,he),ks(e,{reducer:k,middleware:le}),{name:tb,injectEndpoint(ce,xe){const ge=e,Me=ge.endpoints[ce]??={};rf(xe)&&ks(Me,{name:ce,select:C(ce,xe),initiate:Y(ce,xe)},O(M,ce)),l6(xe)&&ks(Me,{name:ce,select:D(),initiate:te(ce)},O(I,ce)),af(xe)&&ks(Me,{name:ce,select:E(ce,xe),initiate:Q(ce,xe)},O(M,ce))}}}});j5();function Lh(i){return i.replace(i[0],i[0].toUpperCase())}var E6="query",T6="mutation",M6="infinitequery";function D6(i){return i.type===E6}function R6(i){return i.type===T6}function z5(i){return i.type===M6}function Zl(i,...e){return Object.assign(i,...e)}var i0=Symbol();function n0(i){const e=V.useRef(i),t=V.useMemo(()=>qg(e.current,i),[i]);return V.useEffect(()=>{e.current!==t&&(e.current=t)},[t]),t}function go(i){const e=V.useRef(i);return V.useEffect(()=>{xc(e.current,i)||(e.current=i)},[i]),xc(e.current,i)?e.current:i}var N6=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",I6=N6(),_6=()=>typeof navigator<"u"&&navigator.product==="ReactNative",F6=_6(),P6=()=>I6||F6?V.useLayoutEffect:V.useEffect,B6=P6(),ib=i=>i.isUninitialized?{...i,isUninitialized:!1,isFetching:!0,isLoading:i.data===void 0,status:R5.pending}:i;function s0(i,...e){const t={};return e.forEach(n=>{t[n]=i[n]}),t}var r0=["data","status","isLoading","isSuccess","isError","error"];function L6({api:i,moduleOptions:{batch:e,hooks:{useDispatch:t,useSelector:n,useStore:s},unstable__sideEffectsInRender:r,createSelector:a},serializeQueryArgs:l,context:c}){const h=r?M=>M():V.useEffect,d=M=>M.current?.unsubscribe?.(),f=c.endpointDefinitions;return{buildQueryHooks:C,buildInfiniteQueryHooks:E,buildMutationHook:D,usePrefetch:y};function p(M,N,I){if(N?.endpointName&&M.isUninitialized){const{endpointName:k}=N,q=f[k];I!==Qn&&l({queryArgs:N.originalArgs,endpointDefinition:q,endpointName:k})===l({queryArgs:I,endpointDefinition:q,endpointName:k})&&(N=void 0)}let _=M.isSuccess?M.data:N?.data;_===void 0&&(_=M.data);const F=_!==void 0,B=M.isLoading,P=(!N||N.isLoading||N.isUninitialized)&&!F&&B,O=M.isSuccess||F&&(B&&!N?.isError||M.isUninitialized);return{...M,data:_,currentData:M.data,isFetching:B,isLoading:P,isSuccess:O}}function g(M,N,I){if(N?.endpointName&&M.isUninitialized){const{endpointName:k}=N,q=f[k];I!==Qn&&l({queryArgs:N.originalArgs,endpointDefinition:q,endpointName:k})===l({queryArgs:I,endpointDefinition:q,endpointName:k})&&(N=void 0)}let _=M.isSuccess?M.data:N?.data;_===void 0&&(_=M.data);const F=_!==void 0,B=M.isLoading,P=(!N||N.isLoading||N.isUninitialized)&&!F&&B,O=M.isSuccess||B&&F;return{...M,data:_,currentData:M.data,isFetching:B,isLoading:P,isSuccess:O}}function y(M,N){const I=t(),_=go(N);return V.useCallback((F,B)=>I(i.util.prefetch(M,F,{..._,...B})),[M,I,_])}function x(M,N,{refetchOnReconnect:I,refetchOnFocus:_,refetchOnMountOrArgChange:F,skip:B=!1,pollingInterval:P=0,skipPollingIfUnfocused:O=!1,...k}={}){const{initiate:q}=i.endpoints[M],U=t(),H=V.useRef(void 0);if(!H.current){const ge=U(i.internalActions.internal_getRTKQSubscriptions());H.current=ge}const Y=n0(B?Qn:N),Q=go({refetchOnReconnect:I,refetchOnFocus:_,pollingInterval:P,skipPollingIfUnfocused:O}),te=k.initialPageParam,j=go(te),W=k.refetchCachedPages,K=go(W),ee=V.useRef(void 0);let{queryCacheKey:le,requestId:he}=ee.current||{},ce=!1;le&&he&&(ce=H.current.isRequestSubscribed(le,he));const xe=!ce&&ee.current!==void 0;return h(()=>{xe&&(ee.current=void 0)},[xe]),h(()=>{const ge=ee.current;if(Y===Qn){ge?.unsubscribe(),ee.current=void 0;return}const Me=ee.current?.subscriptionOptions;if(!ge||ge.arg!==Y){ge?.unsubscribe();const Ie=U(q(Y,{subscriptionOptions:Q,forceRefetch:F,...z5(f[M])?{initialPageParam:j,refetchCachedPages:K}:{}}));ee.current=Ie}else Q!==Me&&ge.updateSubscriptionOptions(Q)},[U,q,F,Y,Q,xe,j,K,M]),[ee,U,q,Q]}function b(M,N){return(_,{skip:F=!1,selectFromResult:B}={})=>{const{select:P}=i.endpoints[M],O=n0(F?Qn:_),k=V.useRef(void 0),q=V.useMemo(()=>a([P(O),(te,j)=>j,te=>O],N,{memoizeOptions:{resultEqualityCheck:xc}}),[P,O]),U=V.useMemo(()=>B?a([q],B,{devModeChecks:{identityFunctionCheck:"never"}}):q,[q,B]),H=n(te=>U(te,k.current),xc),Y=s(),Q=q(Y.getState(),k.current);return B6(()=>{k.current=Q},[Q]),H}}function w(M){V.useEffect(()=>()=>{d(M),M.current=void 0},[M])}function S(M){if(!M.current)throw new Error(Un(38));return M.current.refetch()}function C(M){const N=(F,B={})=>{const[P]=x(M,F,B);return w(P),V.useMemo(()=>({refetch:()=>S(P)}),[P])},I=({refetchOnReconnect:F,refetchOnFocus:B,pollingInterval:P=0,skipPollingIfUnfocused:O=!1}={})=>{const{initiate:k}=i.endpoints[M],q=t(),[U,H]=V.useState(i0),Y=V.useRef(void 0),Q=go({refetchOnReconnect:F,refetchOnFocus:B,pollingInterval:P,skipPollingIfUnfocused:O});h(()=>{const K=Y.current?.subscriptionOptions;Q!==K&&Y.current?.updateSubscriptionOptions(Q)},[Q]);const te=V.useRef(Q);h(()=>{te.current=Q},[Q]);const j=V.useCallback(function(K,ee=!1){let le;return e(()=>{d(Y),Y.current=le=q(k(K,{subscriptionOptions:te.current,forceRefetch:!ee})),H(K)}),le},[q,k]),W=V.useCallback(()=>{Y.current?.queryCacheKey&&q(i.internalActions.removeQueryResult({queryCacheKey:Y.current?.queryCacheKey}))},[q]);return V.useEffect(()=>()=>{d(Y)},[]),V.useEffect(()=>{U!==i0&&!Y.current&&j(U,!0)},[U,j]),V.useMemo(()=>[j,U,{reset:W}],[j,U,W])},_=b(M,p);return{useQueryState:_,useQuerySubscription:N,useLazyQuerySubscription:I,useLazyQuery(F){const[B,P,{reset:O}]=I(F),k=_(P,{...F,skip:P===i0}),q=V.useMemo(()=>({lastArg:P}),[P]);return V.useMemo(()=>[B,{...k,reset:O},q],[B,k,O,q])},useQuery(F,B){const P=N(F,B),O=_(F,{selectFromResult:F===Qn||B?.skip?void 0:ib,...B}),k=s0(O,...r0);return V.useDebugValue(k),V.useMemo(()=>({...O,...P}),[O,P])}}}function E(M){const N=(_,F={})=>{const[B,P,O,k]=x(M,_,F),q=V.useRef(k);h(()=>{q.current=k},[k]);const U=F.refetchCachedPages,H=go(U),Y=V.useCallback(function(j,W){let K;return e(()=>{d(B),B.current=K=P(O(j,{subscriptionOptions:q.current,direction:W}))}),K},[B,P,O]);w(B);const Q=n0(F.skip?Qn:_),te=V.useCallback(j=>{if(!B.current)throw new Error(Un(38));const W={refetchCachedPages:j?.refetchCachedPages??H};return B.current.refetch(W)},[B,H]);return V.useMemo(()=>({trigger:Y,refetch:te,fetchNextPage:()=>Y(Q,"forward"),fetchPreviousPage:()=>Y(Q,"backward")}),[te,Y,Q])},I=b(M,g);return{useInfiniteQueryState:I,useInfiniteQuerySubscription:N,useInfiniteQuery(_,F){const{refetch:B,fetchNextPage:P,fetchPreviousPage:O}=N(_,F),k=I(_,{selectFromResult:_===Qn||F?.skip?void 0:ib,...F}),q=s0(k,...r0,"hasNextPage","hasPreviousPage");return V.useDebugValue(q),V.useMemo(()=>({...k,fetchNextPage:P,fetchPreviousPage:O,refetch:B}),[k,P,O,B])}}}function D(M){return({selectFromResult:N,fixedCacheKey:I}={})=>{const{select:_,initiate:F}=i.endpoints[M],B=t(),[P,O]=V.useState();V.useEffect(()=>()=>{P?.arg.fixedCacheKey||P?.reset()},[P]);const k=V.useCallback(function(K){const ee=B(F(K,{fixedCacheKey:I}));return O(ee),ee},[B,F,I]),{requestId:q}=P||{},U=V.useMemo(()=>_({fixedCacheKey:I,requestId:P?.requestId}),[I,P,_]),H=V.useMemo(()=>N?a([U],N):U,[N,U]),Y=n(H,xc),Q=I==null?P?.arg.originalArgs:void 0,te=V.useCallback(()=>{e(()=>{P&&O(void 0),I&&B(i.internalActions.removeMutationResult({requestId:q,fixedCacheKey:I}))})},[B,I,P,q]),j=s0(Y,...r0,"endpointName");V.useDebugValue(j);const W=V.useMemo(()=>({...Y,originalArgs:Q,reset:te}),[Y,Q,te]);return V.useMemo(()=>[k,W],[k,W])}}}var k6=Symbol(),O6=({batch:i=cT,hooks:e={useDispatch:rT,useSelector:lT,useStore:Ww},createSelector:t=Gg,unstable__sideEffectsInRender:n=!1,...s}={})=>({name:k6,init(r,{serializeQueryArgs:a},l){const c=r,{buildQueryHooks:h,buildInfiniteQueryHooks:d,buildMutationHook:f,usePrefetch:p}=L6({api:r,moduleOptions:{batch:i,hooks:e,unstable__sideEffectsInRender:n,createSelector:t},serializeQueryArgs:a,context:l});return Zl(c,{usePrefetch:p}),Zl(l,{batch:i}),{injectEndpoint(g,y){if(D6(y)){const{useQuery:x,useLazyQuery:b,useLazyQuerySubscription:w,useQueryState:S,useQuerySubscription:C}=h(g);Zl(c.endpoints[g],{useQuery:x,useLazyQuery:b,useLazyQuerySubscription:w,useQueryState:S,useQuerySubscription:C}),r[`use${Lh(g)}Query`]=x,r[`useLazy${Lh(g)}Query`]=b}if(R6(y)){const x=f(g);Zl(c.endpoints[g],{useMutation:x}),r[`use${Lh(g)}Mutation`]=x}else if(z5(y)){const{useInfiniteQuery:x,useInfiniteQuerySubscription:b,useInfiniteQueryState:w}=d(g);Zl(c.endpoints[g],{useInfiniteQuery:x,useInfiniteQuerySubscription:b,useInfiniteQueryState:w}),r[`use${Lh(g)}InfiniteQuery`]=x}}}}}),U6=V5(j5(),O6());const rd=U6({reducerPath:"api",baseQuery:s6({baseUrl:"/api/"}),tagTypes:["Study"],endpoints:i=>({getStudies:i.query({query:()=>"studies/",providesTags:["Study"]}),getStudy:i.query({query:e=>`studies/${e}/`,providesTags:(e,t,n)=>[{type:"Study",id:n}]}),createStudy:i.mutation({query:e=>({url:"studies/",method:"POST",body:e}),invalidatesTags:["Study"]}),processStudy:i.mutation({query:e=>({url:`studies/${e}/process/`,method:"POST"}),invalidatesTags:(e,t,n)=>[{type:"Study",id:n}]}),getROIStats:i.mutation({query:({id:e,roiData:t})=>({url:`studies/${e}/roi_stats/`,method:"POST",body:t})}),deleteStudy:i.mutation({query:e=>({url:`studies/${e}/`,method:"DELETE"}),invalidatesTags:["Study"]})})}),{useGetStudiesQuery:of,useGetStudyQuery:lf,useCreateStudyMutation:cf,useProcessStudyMutation:Wo,useGetROIStatsMutation:V6,useDeleteStudyMutation:Ko}=rd,G5=RD({reducer:{[rd.reducerPath]:rd.reducer},middleware:i=>i().concat(rd.middleware)});o6(G5.dispatch);const j6=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),z6=i=>i.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),nb=i=>{const e=z6(i);return e.charAt(0).toUpperCase()+e.slice(1)},H5=(...i)=>i.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim(),G6=i=>{for(const e in i)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var H6={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Y6=V.forwardRef(({color:i="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:s="",children:r,iconNode:a,...l},c)=>V.createElement("svg",{ref:c,...H6,width:e,height:e,stroke:i,strokeWidth:n?Number(t)*24/Number(e):t,className:H5("lucide",s),...!r&&!G6(l)&&{"aria-hidden":"true"},...l},[...a.map(([h,d])=>V.createElement(h,d)),...Array.isArray(r)?r:[r]]));const xt=(i,e)=>{const t=V.forwardRef(({className:n,...s},r)=>V.createElement(Y6,{ref:r,iconNode:e,className:H5(`lucide-${j6(nb(i))}`,`lucide-${i}`,n),...s}));return t.displayName=nb(i),t};const q6=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],ps=xt("activity",q6);const X6=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],W6=xt("box",X6);const K6=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],Y5=xt("brain",K6);const Q6=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Z6=xt("chevron-left",Q6);const J6=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],$6=xt("chevron-right",J6);const eR=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Qs=xt("circle-alert",eR);const tR=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Zg=xt("circle-check-big",tR);const iR=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Jg=xt("circle-x",iR);const nR=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],pa=xt("clock",nR);const sR=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Do=xt("download",sR);const rR=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Id=xt("eye-off",rR);const aR=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ba=xt("eye",aR);const oR=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],$g=xt("file-text",oR);const lR=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],e1=xt("file",lR);const cR=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],q5=xt("grid-3x3",cR);const uR=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],X5=xt("info",uR);const hR=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],W5=xt("layers",hR);const dR=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],a0=xt("list",dR);const fR=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],o0=xt("loader",fR);const mR=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],pR=xt("map-pin",mR);const gR=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],K5=xt("maximize-2",gR);const AR=[["path",{d:"M12.586 12.586 19 19",key:"ea5xo7"}],["path",{d:"M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z",key:"277e5u"}]],vR=xt("mouse-pointer",AR);const yR=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],xR=xt("pen-tool",yR);const bR=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],es=xt("play",bR);const wR=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],sb=xt("plus",wR);const SR=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Q5=xt("rotate-ccw",SR);const CR=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]],ER=xt("scan",CR);const TR=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],MR=xt("search",TR);const DR=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],eu=xt("trash-2",DR);const RR=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Z5=xt("triangle-alert",RR);const NR=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Ro=xt("upload",NR),IR="_container_gcqab_1",_R="_header_gcqab_8",FR="_headerContent_gcqab_14",PR="_logoSection_gcqab_24",BR="_logoIcon_gcqab_35",LR="_title_gcqab_41",kR="_nav_gcqab_47",OR="_navLink_gcqab_52",UR="_navButton_gcqab_68",VR="_main_gcqab_85",Li={container:IR,header:_R,headerContent:FR,logoSection:PR,logoIcon:BR,title:LR,nav:kR,navLink:OR,navButton:UR,main:VR},jR=()=>{const i=$s(),e=i.pathname.startsWith("/mri"),t=i.pathname.startsWith("/ct"),n=i.pathname.startsWith("/tep");return v.jsxs("div",{className:Li.container,children:[v.jsx("header",{className:Li.header,children:v.jsxs("div",{className:Li.headerContent,children:[v.jsxs(ci,{to:"/",className:Li.logoSection,children:[v.jsx(ps,{className:Li.logoIcon}),v.jsx("span",{className:Li.title,children:"Medical Imaging Analysis"})]}),e&&v.jsxs("nav",{className:Li.nav,children:[v.jsxs(ci,{to:"/mri/studies",className:Li.navLink,children:[v.jsx(a0,{className:"h-4 w-4"}),"MRI Studies"]}),v.jsxs(ci,{to:"/mri/upload",className:Li.navButton,children:[v.jsx(Ro,{className:"h-4 w-4"}),"New MRI Study"]})]}),t&&v.jsxs("nav",{className:Li.nav,children:[v.jsxs(ci,{to:"/ct/studies",className:Li.navLink,children:[v.jsx(a0,{className:"h-4 w-4"}),"CT Studies"]}),v.jsxs(ci,{to:"/ct/upload",className:Li.navButton,children:[v.jsx(Ro,{className:"h-4 w-4"}),"New CT Study"]})]}),n&&v.jsxs("nav",{className:Li.nav,children:[v.jsxs(ci,{to:"/tep/studies",className:Li.navLink,children:[v.jsx(a0,{className:"h-4 w-4"}),"TEP Studies"]}),v.jsxs(ci,{to:"/tep/upload",className:Li.navButton,style:{backgroundColor:"#dc2626"},children:[v.jsx(Ro,{className:"h-4 w-4"}),"New TEP Study"]})]})]})}),v.jsx("main",{className:Li.main,children:v.jsx(lM,{})})]})},zR="_container_ticey_1",GR="_hero_ticey_7",HR="_title_ticey_12",YR="_subtitle_ticey_19",qR="_cardsGrid_ticey_25",XR="_card_ticey_25",WR="_cardIcon_ticey_58",KR="_cardTitle_ticey_70",QR="_cardDescription_ticey_77",ZR="_cardFooter_ticey_84",JR="_cardAction_ticey_90",Gt={container:zR,hero:GR,title:HR,subtitle:YR,cardsGrid:qR,card:XR,cardIcon:WR,cardTitle:KR,cardDescription:QR,cardFooter:ZR,cardAction:JR},$R=()=>{const i=bn();return v.jsxs("div",{className:Gt.container,children:[v.jsxs("div",{className:Gt.hero,children:[v.jsx("h1",{className:Gt.title,children:"Medical Imaging Analysis Platform"}),v.jsx("p",{className:Gt.subtitle,children:"Advanced analysis tools for medical imaging modalities"})]}),v.jsxs("div",{className:Gt.cardsGrid,children:[v.jsxs("div",{className:Gt.card,onClick:()=>i("/mri/studies"),children:[v.jsx("div",{className:Gt.cardIcon,children:v.jsx(Y5,{size:48})}),v.jsx("h3",{className:Gt.cardTitle,children:"Magnetic Resonance Imaging"}),v.jsx("p",{className:Gt.cardDescription,children:"DKI (Diffusion Kurtosis Imaging) analysis for advanced diffusion MRI processing. Calculate parametric maps including Mean Kurtosis, Fractional Anisotropy, and Mean Diffusivity."}),v.jsx("div",{className:Gt.cardFooter,children:v.jsx("span",{className:Gt.cardAction,children:"Start Analysis "})})]}),v.jsxs("div",{className:`${Gt.card}`,onClick:()=>i("/ct/studies"),children:[v.jsx("div",{className:Gt.cardIcon,children:v.jsx(ER,{size:48})}),v.jsx("h3",{className:Gt.cardTitle,children:"CT Brain Ischemia"}),v.jsx("p",{className:Gt.cardDescription,children:"Bio-Tensor SMART analysis for ischemic stroke. Detects penumbra vs. core using GLCM texture analysis, Shannon entropy, and volumetric quantification."}),v.jsx("div",{className:Gt.cardFooter,children:v.jsx("span",{className:Gt.cardAction,children:"Start Analysis "})})]}),v.jsxs("div",{className:`${Gt.card}`,onClick:()=>i("/tep/studies"),style:{borderColor:"#dc2626"},children:[v.jsx("div",{className:Gt.cardIcon,style:{color:"#dc2626"},children:v.jsx(ps,{size:48})}),v.jsx("h3",{className:Gt.cardTitle,children:"Pulmonary Embolism (TEP)"}),v.jsx("p",{className:Gt.cardDescription,children:"CT Angiography analysis for pulmonary embolism detection. Automated thrombus identification, Qanadli score calculation, and per-branch obstruction quantification."}),v.jsx("div",{className:Gt.cardFooter,children:v.jsx("span",{className:Gt.cardAction,style:{color:"#dc2626"},children:"Start Analysis "})})]})]})]})},e8="_container_g6fw3_1",t8="_header_g6fw3_8",i8="_title_g6fw3_16",n8="_subtitle_g6fw3_24",s8="_uploadButton_g6fw3_31",r8="_list_g6fw3_48",a8="_listItem_g6fw3_54",o8="_listItemContent_g6fw3_62",l8="_itemInfo_g6fw3_74",c8="_patientId_g6fw3_79",u8="_date_g6fw3_89",h8="_itemActions_g6fw3_95",d8="_processButton_g6fw3_101",f8="_deleteButton_g6fw3_123",m8="_viewButton_g6fw3_145",p8="_emptyState_g6fw3_163",g8="_loadingContainer_g6fw3_169",A8="_spinner_g6fw3_176",v8="_errorContainer_g6fw3_194",y8="_errorMessage_g6fw3_201",x8="_badge_g6fw3_207",b8="_badgePending_g6fw3_216",w8="_badgeProcessing_g6fw3_221",S8="_badgeCompleted_g6fw3_226",C8="_badgeFailed_g6fw3_231",E8="_badgeDefault_g6fw3_236",T8="_loading_g6fw3_169",M8="_error_g6fw3_194",D8="_retryButton_g6fw3_269",R8="_empty_g6fw3_163",N8="_emptyButton_g6fw3_306",I8="_studyList_g6fw3_324",_8="_studyCard_g6fw3_329",F8="_studyHeader_g6fw3_344",P8="_studyInfo_g6fw3_351",B8="_studyTitle_g6fw3_357",L8="_studyDate_g6fw3_367",k8="_studyMeta_g6fw3_372",O8="_metaItem_g6fw3_380",U8="_results_g6fw3_385",V8="_resultGrid_g6fw3_399",j8="_resultItem_g6fw3_405",z8="_resultLabel_g6fw3_411",G8="_resultValue_g6fw3_417",H8="_processingInfo_g6fw3_423",Y8="_errorInfo_g6fw3_435",q8="_studyActions_g6fw3_447",X8="_badgeSuccess_g6fw3_474",W8="_badgeWarning_g6fw3_479",K8="_badgeError_g6fw3_484",pe={container:e8,header:t8,title:i8,subtitle:n8,uploadButton:s8,list:r8,listItem:a8,listItemContent:o8,itemInfo:l8,patientId:c8,date:u8,itemActions:h8,processButton:d8,deleteButton:f8,viewButton:m8,emptyState:p8,loadingContainer:g8,spinner:A8,errorContainer:v8,errorMessage:y8,badge:x8,badgePending:b8,badgeProcessing:w8,badgeCompleted:S8,badgeFailed:C8,badgeDefault:E8,loading:T8,error:M8,retryButton:D8,empty:R8,emptyButton:N8,studyList:I8,studyCard:_8,studyHeader:F8,studyInfo:P8,studyTitle:B8,studyDate:L8,studyMeta:k8,metaItem:O8,results:U8,resultGrid:V8,resultItem:j8,resultLabel:z8,resultValue:G8,processingInfo:H8,errorInfo:Y8,studyActions:q8,badgeSuccess:X8,badgeWarning:W8,badgeError:K8},Q8=({status:i})=>{const e={UPLOADED:pe.badgePending,VALIDATING:pe.badgeProcessing,PROCESSING:pe.badgeProcessing,COMPLETED:pe.badgeCompleted,FAILED:pe.badgeFailed},n={UPLOADED:pa,VALIDATING:pa,PROCESSING:pa,COMPLETED:Zg,FAILED:Jg}[i]||Z5,s=e[i]||pe.badgeDefault;return v.jsxs("span",{className:`${pe.badge} ${s}`,children:[v.jsx(n,{className:"w-3 h-3 mr-1"}),i]})},Z8=()=>{const{data:i,isLoading:e,error:t}=of(),[n]=Wo(),[s]=Ko(),r=async(l,c)=>{if(c.preventDefault(),c.stopPropagation(),window.confirm("Start processing this study?"))try{await n(l).unwrap()}catch(h){console.error("Failed to start processing:",h)}},a=async(l,c)=>{if(c.preventDefault(),c.stopPropagation(),window.confirm("Are you sure you want to delete this study? This action cannot be undone."))try{await s(l).unwrap()}catch(h){console.error("Failed to delete study:",h)}};return e?v.jsx("div",{className:pe.loadingContainer,children:v.jsx("div",{className:pe.spinner})}):t?v.jsx("div",{className:pe.errorContainer,children:v.jsx("div",{className:"flex",children:v.jsx("div",{className:"ml-3",children:v.jsx("p",{className:pe.errorMessage,children:"Error loading studies. Please try again later."})})})}):v.jsxs("div",{className:pe.container,children:[v.jsxs("div",{className:pe.header,children:[v.jsxs("div",{children:[v.jsx("h3",{className:pe.title,children:"Recent Studies"}),v.jsx("p",{className:pe.subtitle,children:"List of all uploaded DICOM series and their processing status."})]}),v.jsx(ci,{to:"/mri/upload",className:pe.uploadButton,children:"Upload New Study"})]}),v.jsx("div",{className:"border-t border-gray-200",children:v.jsx("ul",{className:pe.list,children:i&&i.length>0?i.map(l=>v.jsx("li",{className:pe.listItem,children:v.jsxs("div",{className:pe.listItemContent,children:[v.jsxs("div",{className:pe.itemInfo,children:[v.jsxs("p",{className:pe.patientId,children:["Patient ID: ",l.patient_id]}),v.jsxs("p",{className:pe.date,children:["Uploaded on"," ",new Date(l.created_at).toLocaleDateString()]})]}),v.jsxs("div",{className:pe.itemActions,children:[v.jsx(Q8,{status:l.status}),(l.status==="UPLOADED"||l.status==="FAILED")&&v.jsx("button",{onClick:c=>r(l.id,c),className:pe.processButton,title:"Start processing",children:v.jsx(es,{className:"h-4 w-4"})}),v.jsxs(ci,{to:`/mri/studies/${l.id}`,className:pe.viewButton,children:[v.jsx(ba,{className:"h-4 w-4 mr-1"}),"View"]})," ",v.jsx("button",{onClick:c=>a(l.id,c),className:pe.deleteButton,title:"Delete study",children:v.jsx(eu,{className:"h-4 w-4"})})," "]})]})},l.id)):v.jsx("li",{className:pe.emptyState,children:"No studies found. Upload a new study to get started."})})})]})},J8="_container_1yxpr_1",$8="_card_1yxpr_6",eN="_header_1yxpr_13",tN="_title_1yxpr_17",iN="_description_1yxpr_24",nN="_form_1yxpr_30",sN="_dropzone_1yxpr_36",rN="_dropzoneContent_1yxpr_48",aN="_uploadIcon_1yxpr_55",oN="_dropzoneText_1yxpr_62",lN="_dropzoneSubtext_1yxpr_68",cN="_fileInput_1yxpr_74",uN="_fileList_1yxpr_78",hN="_fileListContent_1yxpr_84",dN="_fileIcon_1yxpr_89",fN="_fileCount_1yxpr_96",mN="_errorContainer_1yxpr_101",pN="_errorContent_1yxpr_107",gN="_errorIcon_1yxpr_111",AN="_errorMessage_1yxpr_117",vN="_actions_1yxpr_123",yN="_cancelButton_1yxpr_129",xN="_submitButton_1yxpr_145",bN="_spinner_1yxpr_168",wN="_alert_1yxpr_187",SN="_alertContent_1yxpr_197",CN="_alertTitle_1yxpr_201",EN="_requirementsList_1yxpr_208",TN="_dropzoneTitle_1yxpr_224",MN="_fileInfo_1yxpr_256",DN="_error_1yxpr_101",we={container:J8,card:$8,header:eN,title:tN,description:iN,form:nN,dropzone:sN,dropzoneContent:rN,uploadIcon:aN,dropzoneText:oN,dropzoneSubtext:lN,fileInput:cN,fileList:uN,fileListContent:hN,fileIcon:dN,fileCount:fN,errorContainer:mN,errorContent:pN,errorIcon:gN,errorMessage:AN,actions:vN,cancelButton:yN,submitButton:xN,spinner:bN,alert:wN,alertContent:SN,alertTitle:CN,requirementsList:EN,dropzoneTitle:TN,fileInfo:MN,error:DN},RN=()=>{const[i,e]=V.useState(null),[t,{isLoading:n,error:s}]=cf(),r=bn(),a=V.useRef(null),l=h=>{h.target.files&&h.target.files.length>0&&e(h.target.files)},c=async h=>{if(h.preventDefault(),!i||i.length===0)return;const d=new FormData;for(let f=0;f<i.length;f++)d.append("dicom_files",i[f]);try{await t(d).unwrap(),r("/mri/studies")}catch(f){console.error("Failed to upload study:",f)}};return v.jsx("div",{className:we.container,children:v.jsxs("div",{className:we.card,children:[v.jsxs("div",{className:we.header,children:[v.jsx("h2",{className:we.title,children:"Upload New Study"}),v.jsx("p",{className:we.description,children:"Select a folder containing a complete DICOM series for DKI analysis. Ensure all files are present and unmodified."})]}),v.jsxs("form",{onSubmit:c,className:we.form,children:[v.jsxs("div",{className:we.dropzone,children:[v.jsx("input",{type:"file",ref:a,onChange:l,multiple:!0,className:we.fileInput,webkitdirectory:"",directory:""}),v.jsxs("div",{className:we.dropzoneContent,onClick:()=>a.current?.click(),children:[v.jsx(Ro,{className:we.uploadIcon}),v.jsx("span",{className:we.dropzoneText,children:"Click to select DICOM folder"}),v.jsx("span",{className:we.dropzoneSubtext,children:"or drag and drop folder here"})]})]}),i&&i.length>0&&v.jsx("div",{className:we.fileList,children:v.jsxs("div",{className:we.fileListContent,children:[v.jsx(e1,{className:we.fileIcon}),v.jsxs("span",{className:we.fileCount,children:[i.length," files selected"]})]})}),s&&v.jsx("div",{className:we.errorContainer,children:v.jsxs("div",{className:we.errorContent,children:[v.jsx(Qs,{className:we.errorIcon}),v.jsx("div",{className:we.errorMessage,children:v.jsx("p",{children:s?.data?.detail||s?.data?.message||"Error uploading study. Please check the files and try again."})})]})}),v.jsxs("div",{className:we.actions,children:[v.jsx("button",{type:"button",onClick:()=>r("/"),className:we.cancelButton,children:"Cancel"}),v.jsx("button",{type:"submit",disabled:!i||n,className:we.submitButton,children:n?v.jsxs(v.Fragment,{children:[v.jsxs("svg",{className:we.spinner,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[v.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),v.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Uploading..."]}):"Upload Study"})]})]})]})})};var NN=1e-6,xi=typeof Float32Array<"u"?Float32Array:Array;function tg(){var i=new xi(9);return xi!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function IN(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i}function Nr(i,e,t,n,s,r,a,l,c){var h=new xi(9);return h[0]=i,h[1]=e,h[2]=t,h[3]=n,h[4]=s,h[5]=r,h[6]=a,h[7]=l,h[8]=c,h}function _N(i,e){var t=e[0],n=e[1],s=e[2],r=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=d*a-l*h,p=-d*r+l*c,g=h*r-a*c,y=t*f+n*p+s*g;return y?(y=1/y,i[0]=f*y,i[1]=(-d*n+s*h)*y,i[2]=(l*n-s*a)*y,i[3]=p*y,i[4]=(d*t-s*c)*y,i[5]=(-l*t+s*r)*y,i[6]=g*y,i[7]=(-h*t+n*c)*y,i[8]=(a*t-n*r)*y,i):null}function J5(i,e,t){var n=e[0],s=e[1],r=e[2],a=e[3],l=e[4],c=e[5],h=e[6],d=e[7],f=e[8],p=t[0],g=t[1],y=t[2],x=t[3],b=t[4],w=t[5],S=t[6],C=t[7],E=t[8];return i[0]=p*n+g*a+y*h,i[1]=p*s+g*l+y*d,i[2]=p*r+g*c+y*f,i[3]=x*n+b*a+w*h,i[4]=x*s+b*l+w*d,i[5]=x*r+b*c+w*f,i[6]=S*n+C*a+E*h,i[7]=S*s+C*l+E*d,i[8]=S*r+C*c+E*f,i}function it(){var i=new xi(16);return xi!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function Qt(i){var e=new xi(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function FN(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Vn(i,e,t,n,s,r,a,l,c,h,d,f,p,g,y,x){var b=new xi(16);return b[0]=i,b[1]=e,b[2]=t,b[3]=n,b[4]=s,b[5]=r,b[6]=a,b[7]=l,b[8]=c,b[9]=h,b[10]=d,b[11]=f,b[12]=p,b[13]=g,b[14]=y,b[15]=x,b}function $5(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function sn(i,e){if(i===e){var t=e[1],n=e[2],s=e[3],r=e[6],a=e[7],l=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=t,i[6]=e[9],i[7]=e[13],i[8]=n,i[9]=r,i[11]=e[14],i[12]=s,i[13]=a,i[14]=l}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i}function rn(i,e){var t=e[0],n=e[1],s=e[2],r=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=e[9],p=e[10],g=e[11],y=e[12],x=e[13],b=e[14],w=e[15],S=t*l-n*a,C=t*c-s*a,E=t*h-r*a,D=n*c-s*l,M=n*h-r*l,N=s*h-r*c,I=d*x-f*y,_=d*b-p*y,F=d*w-g*y,B=f*b-p*x,P=f*w-g*x,O=p*w-g*b,k=S*O-C*P+E*B+D*F-M*_+N*I;return k?(k=1/k,i[0]=(l*O-c*P+h*B)*k,i[1]=(s*P-n*O-r*B)*k,i[2]=(x*N-b*M+w*D)*k,i[3]=(p*M-f*N-g*D)*k,i[4]=(c*F-a*O-h*_)*k,i[5]=(t*O-s*F+r*_)*k,i[6]=(b*E-y*N-w*C)*k,i[7]=(d*N-p*E+g*C)*k,i[8]=(a*P-l*F+h*I)*k,i[9]=(n*F-t*P-r*I)*k,i[10]=(y*M-x*E+w*S)*k,i[11]=(f*E-d*M-g*S)*k,i[12]=(l*_-a*B-c*I)*k,i[13]=(t*B-n*_+s*I)*k,i[14]=(x*C-y*D-b*S)*k,i[15]=(d*D-f*C+p*S)*k,i):null}function ga(i,e,t){var n=e[0],s=e[1],r=e[2],a=e[3],l=e[4],c=e[5],h=e[6],d=e[7],f=e[8],p=e[9],g=e[10],y=e[11],x=e[12],b=e[13],w=e[14],S=e[15],C=t[0],E=t[1],D=t[2],M=t[3];return i[0]=C*n+E*l+D*f+M*x,i[1]=C*s+E*c+D*p+M*b,i[2]=C*r+E*h+D*g+M*w,i[3]=C*a+E*d+D*y+M*S,C=t[4],E=t[5],D=t[6],M=t[7],i[4]=C*n+E*l+D*f+M*x,i[5]=C*s+E*c+D*p+M*b,i[6]=C*r+E*h+D*g+M*w,i[7]=C*a+E*d+D*y+M*S,C=t[8],E=t[9],D=t[10],M=t[11],i[8]=C*n+E*l+D*f+M*x,i[9]=C*s+E*c+D*p+M*b,i[10]=C*r+E*h+D*g+M*w,i[11]=C*a+E*d+D*y+M*S,C=t[12],E=t[13],D=t[14],M=t[15],i[12]=C*n+E*l+D*f+M*x,i[13]=C*s+E*c+D*p+M*b,i[14]=C*r+E*h+D*g+M*w,i[15]=C*a+E*d+D*y+M*S,i}function No(i,e,t){var n=t[0],s=t[1],r=t[2],a,l,c,h,d,f,p,g,y,x,b,w;return e===i?(i[12]=e[0]*n+e[4]*s+e[8]*r+e[12],i[13]=e[1]*n+e[5]*s+e[9]*r+e[13],i[14]=e[2]*n+e[6]*s+e[10]*r+e[14],i[15]=e[3]*n+e[7]*s+e[11]*r+e[15]):(a=e[0],l=e[1],c=e[2],h=e[3],d=e[4],f=e[5],p=e[6],g=e[7],y=e[8],x=e[9],b=e[10],w=e[11],i[0]=a,i[1]=l,i[2]=c,i[3]=h,i[4]=d,i[5]=f,i[6]=p,i[7]=g,i[8]=y,i[9]=x,i[10]=b,i[11]=w,i[12]=a*n+d*s+y*r+e[12],i[13]=l*n+f*s+x*r+e[13],i[14]=c*n+p*s+b*r+e[14],i[15]=h*n+g*s+w*r+e[15]),i}function e3(i,e,t){var n=t[0],s=t[1],r=t[2];return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*s,i[5]=e[5]*s,i[6]=e[6]*s,i[7]=e[7]*s,i[8]=e[8]*r,i[9]=e[9]*r,i[10]=e[10]*r,i[11]=e[11]*r,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function _d(i,e,t){var n=Math.sin(t),s=Math.cos(t),r=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],p=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=r*s+h*n,i[5]=a*s+d*n,i[6]=l*s+f*n,i[7]=c*s+p*n,i[8]=h*s-r*n,i[9]=d*s-a*n,i[10]=f*s-l*n,i[11]=p*s-c*n,i}function Fd(i,e,t){var n=Math.sin(t),s=Math.cos(t),r=e[0],a=e[1],l=e[2],c=e[3],h=e[4],d=e[5],f=e[6],p=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=r*s+h*n,i[1]=a*s+d*n,i[2]=l*s+f*n,i[3]=c*s+p*n,i[4]=h*s-r*n,i[5]=d*s-a*n,i[6]=f*s-l*n,i[7]=p*s-c*n,i}function PN(i,e,t){var n=t[0],s=t[1],r=t[2],a=Math.sqrt(n*n+s*s+r*r),l,c,h;return a<NN?null:(a=1/a,n*=a,s*=a,r*=a,l=Math.sin(e),c=Math.cos(e),h=1-c,i[0]=n*n*h+c,i[1]=s*n*h+r*l,i[2]=r*n*h-s*l,i[3]=0,i[4]=n*s*h-r*l,i[5]=s*s*h+c,i[6]=r*s*h+n*l,i[7]=0,i[8]=n*r*h+s*l,i[9]=s*r*h-n*l,i[10]=r*r*h+c,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}function BN(i,e,t,n,s,r,a){var l=1/(e-t),c=1/(n-s),h=1/(r-a);return i[0]=-2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*c,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*h,i[11]=0,i[12]=(e+t)*l,i[13]=(s+n)*c,i[14]=(a+r)*h,i[15]=1,i}var Pd=BN;function LN(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i[4]=e[4]*t,i[5]=e[5]*t,i[6]=e[6]*t,i[7]=e[7]*t,i[8]=e[8]*t,i[9]=e[9]*t,i[10]=e[10]*t,i[11]=e[11]*t,i[12]=e[12]*t,i[13]=e[13]*t,i[14]=e[14]*t,i[15]=e[15]*t,i}var t3=ga;function bt(){var i=new xi(3);return xi!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function kn(i){var e=new xi(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function Fr(i){var e=i[0],t=i[1],n=i[2];return Math.sqrt(e*e+t*t+n*n)}function Ae(i,e,t){var n=new xi(3);return n[0]=i,n[1]=e,n[2]=t,n}function rb(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i}function Aa(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i}function It(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function t1(i,e,t){return i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.min(e[2],t[2]),i}function i1(i,e,t){return i[0]=Math.max(e[0],t[0]),i[1]=Math.max(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i}function kN(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i}function ON(i,e){var t=e[0]-i[0],n=e[1]-i[1],s=e[2]-i[2];return Math.sqrt(t*t+n*n+s*s)}function UN(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i}function On(i,e){var t=e[0],n=e[1],s=e[2],r=t*t+n*n+s*s;return r>0&&(r=1/Math.sqrt(r)),i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i}function VN(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function ad(i,e,t){var n=e[0],s=e[1],r=e[2],a=t[0],l=t[1],c=t[2];return i[0]=s*c-r*l,i[1]=r*a-n*c,i[2]=n*l-s*a,i}function jN(i,e,t,n){var s=e[0],r=e[1],a=e[2];return i[0]=s+n*(t[0]-s),i[1]=r+n*(t[1]-r),i[2]=a+n*(t[2]-a),i}function ab(i,e,t){var n=e[0],s=e[1],r=e[2];return i[0]=n*t[0]+s*t[3]+r*t[6],i[1]=n*t[1]+s*t[4]+r*t[7],i[2]=n*t[2]+s*t[5]+r*t[8],i}function l0(i,e){var t=i[0],n=i[1],s=i[2],r=e[0],a=e[1],l=e[2],c=Math.sqrt((t*t+n*n+s*s)*(r*r+a*a+l*l)),h=c&&VN(i,e)/c;return Math.acos(Math.min(Math.max(h,-1),1))}var ob=It,Oc=Fr;(function(){var i=bt();return function(e,t,n,s,r,a){var l,c;for(t||(t=3),n||(n=0),s?c=Math.min(s*t+n,e.length):c=e.length,l=n;l<c;l+=t)i[0]=e[l],i[1]=e[l+1],i[2]=e[l+2],r(i,i,a),e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2];return e}})();function qs(){var i=new xi(4);return xi!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function Gs(i){var e=new xi(4);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Lt(i,e,t,n){var s=new xi(4);return s[0]=i,s[1]=e,s[2]=t,s[3]=n,s}function lb(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i}function zN(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i}function GN(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function Pi(i,e,t){var n=e[0],s=e[1],r=e[2],a=e[3];return i[0]=t[0]*n+t[4]*s+t[8]*r+t[12]*a,i[1]=t[1]*n+t[5]*s+t[9]*r+t[13]*a,i[2]=t[2]*n+t[6]*s+t[10]*r+t[14]*a,i[3]=t[3]*n+t[7]*s+t[11]*r+t[15]*a,i}var HN=zN;(function(){var i=qs();return function(e,t,n,s,r,a){var l,c;for(t||(t=4),n||(n=0),s?c=Math.min(s*t+n,e.length):c=e.length,l=n;l<c;l+=t)i[0]=e[l],i[1]=e[l+1],i[2]=e[l+2],i[3]=e[l+3],r(i,i,a),e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2],e[l+3]=i[3];return e}})();function YN(){var i=new xi(2);return xi!=Float32Array&&(i[0]=0,i[1]=0),i}function qN(i,e){var t=new xi(2);return t[0]=i,t[1]=e,t}(function(){var i=YN();return function(e,t,n,s,r,a){var l,c;for(t||(t=2),n||(n=0),s?c=Math.min(s*t+n,e.length):c=e.length,l=n;l<c;l+=t)i[0]=e[l],i[1]=e[l+1],r(i,i,a),e[l]=i[0],e[l+1]=i[1];return e}})();var ua=256,od=[],kh;for(;ua--;)od[ua]=(ua+256).toString(16).substring(1);function ig(){var i=0,e,t="";if(!kh||ua+16>256){for(kh=Array(i=256);i--;)kh[i]=256*Math.random()|0;i=ua=0}for(;i<16;i++)e=kh[ua+i],i==6?t+=od[e&15|64]:i==8?t+=od[e&63|128]:t+=od[e],i&1&&i>1&&i<11&&(t+="-");return ua++,t}var c0,cb;function XN(){return cb||(cb=1,c0=function(e,t){var n=e.length;if(e===t)return!0;if(n!==t.length)return!1;for(var s=0;s<n;s++)if(e[s]!==t[s])return!1;return!0}),c0}var WN=XN();const KN=Rg(WN),i3=-1,uf=0,Cc=1,Bd=2,n1=3,s1=4,r1=5,a1=6,n3=7,s3=8,ub=typeof self=="object"?self:globalThis,QN=(i,e)=>{const t=(s,r)=>(i.set(r,s),s),n=s=>{if(i.has(s))return i.get(s);const[r,a]=e[s];switch(r){case uf:case i3:return t(a,s);case Cc:{const l=t([],s);for(const c of a)l.push(n(c));return l}case Bd:{const l=t({},s);for(const[c,h]of a)l[n(c)]=n(h);return l}case n1:return t(new Date(a),s);case s1:{const{source:l,flags:c}=a;return t(new RegExp(l,c),s)}case r1:{const l=t(new Map,s);for(const[c,h]of a)l.set(n(c),n(h));return l}case a1:{const l=t(new Set,s);for(const c of a)l.add(n(c));return l}case n3:{const{name:l,message:c}=a;return t(new ub[l](c),s)}case s3:return t(BigInt(a),s);case"BigInt":return t(Object(BigInt(a)),s);case"ArrayBuffer":return t(new Uint8Array(a).buffer,a);case"DataView":{const{buffer:l}=new Uint8Array(a);return t(new DataView(l),a)}}return t(new ub[r](a),s)};return n},ZN=i=>QN(new Map,i)(0),Ao="",{toString:JN}={},{keys:$N}=Object,Jl=i=>{const e=typeof i;if(e!=="object"||!i)return[uf,e];const t=JN.call(i).slice(8,-1);switch(t){case"Array":return[Cc,Ao];case"Object":return[Bd,Ao];case"Date":return[n1,Ao];case"RegExp":return[s1,Ao];case"Map":return[r1,Ao];case"Set":return[a1,Ao];case"DataView":return[Cc,t]}return t.includes("Array")?[Cc,t]:t.includes("Error")?[n3,t]:[Bd,t]},Oh=([i,e])=>i===uf&&(e==="function"||e==="symbol"),eI=(i,e,t,n)=>{const s=(a,l)=>{const c=n.push(a)-1;return t.set(l,c),c},r=a=>{if(t.has(a))return t.get(a);let[l,c]=Jl(a);switch(l){case uf:{let d=a;switch(c){case"bigint":l=s3,d=a.toString();break;case"function":case"symbol":if(i)throw new TypeError("unable to serialize "+c);d=null;break;case"undefined":return s([i3],a)}return s([l,d],a)}case Cc:{if(c){let p=a;return c==="DataView"?p=new Uint8Array(a.buffer):c==="ArrayBuffer"&&(p=new Uint8Array(a)),s([c,[...p]],a)}const d=[],f=s([l,d],a);for(const p of a)d.push(r(p));return f}case Bd:{if(c)switch(c){case"BigInt":return s([c,a.toString()],a);case"Boolean":case"Number":case"String":return s([c,a.valueOf()],a)}if(e&&"toJSON"in a)return r(a.toJSON());const d=[],f=s([l,d],a);for(const p of $N(a))(i||!Oh(Jl(a[p])))&&d.push([r(p),r(a[p])]);return f}case n1:return s([l,a.toISOString()],a);case s1:{const{source:d,flags:f}=a;return s([l,{source:d,flags:f}],a)}case r1:{const d=[],f=s([l,d],a);for(const[p,g]of a)(i||!(Oh(Jl(p))||Oh(Jl(g))))&&d.push([r(p),r(g)]);return f}case a1:{const d=[],f=s([l,d],a);for(const p of a)(i||!Oh(Jl(p)))&&d.push(r(p));return f}}const{message:h}=a;return s([l,{name:c,message:h}],a)};return r},tI=(i,{json:e,lossy:t}={})=>{const n=[];return eI(!(e||t),!!e,new Map,n)(i),n};var Ai=Uint8Array,Eo=Uint16Array,iI=Int32Array,r3=new Ai([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a3=new Ai([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),nI=new Ai([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o3=function(i,e){for(var t=new Eo(31),n=0;n<31;++n)t[n]=e+=1<<i[n-1];for(var s=new iI(t[30]),n=1;n<30;++n)for(var r=t[n];r<t[n+1];++r)s[r]=r-t[n]<<5|n;return{b:t,r:s}},l3=o3(r3,2),c3=l3.b,sI=l3.r;c3[28]=258,sI[258]=28;var rI=o3(a3,0),aI=rI.b,ng=new Eo(32768);for(var Bt=0;Bt<32768;++Bt){var Tr=(Bt&43690)>>1|(Bt&21845)<<1;Tr=(Tr&52428)>>2|(Tr&13107)<<2,Tr=(Tr&61680)>>4|(Tr&3855)<<4,ng[Bt]=((Tr&65280)>>8|(Tr&255)<<8)>>1}var Ec=(function(i,e,t){for(var n=i.length,s=0,r=new Eo(e);s<n;++s)i[s]&&++r[i[s]-1];var a=new Eo(e);for(s=1;s<e;++s)a[s]=a[s-1]+r[s-1]<<1;var l;if(t){l=new Eo(1<<e);var c=15-e;for(s=0;s<n;++s)if(i[s])for(var h=s<<4|i[s],d=e-i[s],f=a[i[s]-1]++<<d,p=f|(1<<d)-1;f<=p;++f)l[ng[f]>>c]=h}else for(l=new Eo(n),s=0;s<n;++s)i[s]&&(l[s]=ng[a[i[s]-1]++]>>15-i[s]);return l}),tu=new Ai(288);for(var Bt=0;Bt<144;++Bt)tu[Bt]=8;for(var Bt=144;Bt<256;++Bt)tu[Bt]=9;for(var Bt=256;Bt<280;++Bt)tu[Bt]=7;for(var Bt=280;Bt<288;++Bt)tu[Bt]=8;var u3=new Ai(32);for(var Bt=0;Bt<32;++Bt)u3[Bt]=5;var oI=Ec(tu,9,1),lI=Ec(u3,5,1),u0=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},Wn=function(i,e,t){var n=e/8|0;return(i[n]|i[n+1]<<8)>>(e&7)&t},h0=function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(e&7)},h3=function(i){return(i+7)/8|0},ld=function(i,e,t){return(e==null||e<0)&&(e=0),(t==null||t>i.length)&&(t=i.length),new Ai(i.subarray(e,t))},cI=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ji=function(i,e,t){var n=new Error(e||cI[i]);if(n.code=i,Error.captureStackTrace&&Error.captureStackTrace(n,ji),!t)throw n;return n},hf=function(i,e,t,n){var s=i.length,r=0;if(!s||e.f&&!e.l)return t||new Ai(0);var a=!t,l=a||e.i!=2,c=e.i;a&&(t=new Ai(s*3));var h=function(Ie){var $e=t.length;if(Ie>$e){var We=new Ai(Math.max($e*2,Ie));We.set(t),t=We}},d=e.f||0,f=e.p||0,p=e.b||0,g=e.l,y=e.d,x=e.m,b=e.n,w=s*8;do{if(!g){d=Wn(i,f,1);var S=Wn(i,f+1,3);if(f+=3,S)if(S==1)g=oI,y=lI,x=9,b=5;else if(S==2){var M=Wn(i,f,31)+257,N=Wn(i,f+10,15)+4,I=M+Wn(i,f+5,31)+1;f+=14;for(var _=new Ai(I),F=new Ai(19),B=0;B<N;++B)F[nI[B]]=Wn(i,f+B*3,7);f+=N*3;for(var P=u0(F),O=(1<<P)-1,k=Ec(F,P,1),B=0;B<I;){var q=k[Wn(i,f,O)];f+=q&15;var C=q>>4;if(C<16)_[B++]=C;else{var U=0,H=0;for(C==16?(H=3+Wn(i,f,3),f+=2,U=_[B-1]):C==17?(H=3+Wn(i,f,7),f+=3):C==18&&(H=11+Wn(i,f,127),f+=7);H--;)_[B++]=U}}var Y=_.subarray(0,M),Q=_.subarray(M);x=u0(Y),b=u0(Q),g=Ec(Y,x,1),y=Ec(Q,b,1)}else ji(1);else{var C=h3(f)+4,E=i[C-4]|i[C-3]<<8,D=C+E;if(D>s){c&&ji(0);break}l&&h(p+E),t.set(i.subarray(C,D),p),e.b=p+=E,e.p=f=D*8,e.f=d;continue}if(f>w){c&&ji(0);break}}l&&h(p+131072);for(var te=(1<<x)-1,j=(1<<b)-1,W=f;;W=f){var U=g[h0(i,f)&te],K=U>>4;if(f+=U&15,f>w){c&&ji(0);break}if(U||ji(2),K<256)t[p++]=K;else if(K==256){W=f,g=null;break}else{var ee=K-254;if(K>264){var B=K-257,le=r3[B];ee=Wn(i,f,(1<<le)-1)+c3[B],f+=le}var he=y[h0(i,f)&j],ce=he>>4;he||ji(3),f+=he&15;var Q=aI[ce];if(ce>3){var le=a3[ce];Q+=h0(i,f)&(1<<le)-1,f+=le}if(f>w){c&&ji(0);break}l&&h(p+131072);var xe=p+ee;if(p<Q){var ge=r-Q,Me=Math.min(Q,xe);for(ge+p<0&&ji(3);p<Me;++p)t[p]=n[ge+p]}for(;p<xe;++p)t[p]=t[p-Q]}}e.l=g,e.p=W,e.b=p,e.f=d,g&&(d=1,e.m=x,e.d=y,e.n=b)}while(!d);return p!=t.length&&a?ld(t,0,p):t.subarray(0,p)},uI=new Ai(0),d3=function(i){(i[0]!=31||i[1]!=139||i[2]!=8)&&ji(6,"invalid gzip data");var e=i[3],t=10;e&4&&(t+=(i[10]|i[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!i[t++]);return t+(e&2)},hI=function(i){var e=i.length;return(i[e-4]|i[e-3]<<8|i[e-2]<<16|i[e-1]<<24)>>>0},dI=function(i,e){return((i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31)&&ji(6,"invalid zlib data"),(i[1]>>5&1)==1&&ji(6,"invalid zlib data: "+(i[1]&32?"need":"unexpected")+" dictionary"),(i[1]>>3&4)+2},d0=(function(){function i(e,t){typeof e=="function"&&(t=e,e={}),this.ondata=t;var n=e&&e.dictionary&&e.dictionary.subarray(-32768);this.s={i:0,b:n?n.length:0},this.o=new Ai(32768),this.p=new Ai(0),n&&this.o.set(n)}return i.prototype.e=function(e){if(this.ondata||ji(5),this.d&&ji(4),!this.p.length)this.p=e;else if(e.length){var t=new Ai(this.p.length+e.length);t.set(this.p),t.set(e,this.p.length),this.p=t}},i.prototype.c=function(e){this.s.i=+(this.d=e||!1);var t=this.s.b,n=hf(this.p,this.s,this.o);this.ondata(ld(n,t,this.s.b),this.d),this.o=ld(n,this.s.b-32768),this.s.b=this.o.length,this.p=ld(this.p,this.s.p/8|0),this.s.p&=7},i.prototype.push=function(e,t){this.e(e),this.c(t)},i})();function fI(i,e){return hf(i,{i:2},e,e)}var mI=(function(){function i(e,t){this.v=1,this.r=0,d0.call(this,e,t)}return i.prototype.push=function(e,t){if(d0.prototype.e.call(this,e),this.r+=e.length,this.v){var n=this.p.subarray(this.v-1),s=n.length>3?d3(n):4;if(s>n.length){if(!t)return}else this.v>1&&this.onmember&&this.onmember(this.r-n.length);this.p=n.subarray(s),this.v=0}d0.prototype.c.call(this,t),this.s.f&&!this.s.l&&!t&&(this.v=h3(this.s.p)+9,this.s={i:0},this.o=new Ai(0),this.push(new Ai(0),t))},i})();function pI(i,e){var t=d3(i);return t+8>i.length&&ji(6,"invalid gzip data"),hf(i.subarray(t,-8),{i:2},new Ai(hI(i)),e)}function gI(i,e){return hf(i.subarray(dI(i),-4),{i:2},e,e)}function AI(i,e){return i[0]==31&&i[1]==139&&i[2]==8?pI(i,e):(i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31?fI(i,e):gI(i,e)}var vI=typeof TextDecoder<"u"&&new TextDecoder,yI=0;try{vI.decode(uI,{stream:!0}),yI=1}catch{}class f3{esize;ecode;edata;littleEndian;constructor(e,t,n,s){if(e%16!=0)throw new Error("This does not appear to be a NIFTI extension");this.esize=e,this.ecode=t,this.edata=n,this.littleEndian=s}toArrayBuffer(){let e=new Uint8Array(this.esize),t=new Uint8Array(this.edata);e.set(t,8);let n=new DataView(e.buffer);return n.setInt32(0,this.esize,this.littleEndian),n.setInt32(4,this.ecode,this.littleEndian),e.buffer}}class ve{static crcTable=null;static GUNZIP_MAGIC_COOKIE1=31;static GUNZIP_MAGIC_COOKIE2=139;static getStringAt(e,t,n){var s="",r,a;for(r=t;r<n;r+=1)a=e.getUint8(r),a!==0&&(s+=String.fromCharCode(a));return s}static getByteAt=function(e,t){return e.getUint8(t)};static getShortAt=function(e,t,n){return e.getInt16(t,n)};static getIntAt(e,t,n){return e.getInt32(t,n)}static getFloatAt(e,t,n){return e.getFloat32(t,n)}static getDoubleAt(e,t,n){return e.getFloat64(t,n)}static getInt64At(e,t,n){const s=e.getUint32(t,n),r=e.getInt32(t+4,n);let a;return n?a=r*2**32+s:a=s*2**32+r,r<0&&(a+=-1*2**32*2**32),a}static getUint64At(e,t,n){const s=e.getUint32(t+(n?0:4),n),r=e.getUint32(t+(n?4:0),n);return n?r*2**32+s:s*2**32+r}static getExtensionsAt(e,t,n,s){let r=[],a=t;for(;a<s;){let l=n,c=ve.getIntAt(e,a,n);if(!c)break;if(c+a>s&&(l=!l,c=ve.getIntAt(e,a,l),c+a>s))throw new Error("This does not appear to be a valid NIFTI extension");if(c%16!=0)throw new Error("This does not appear to be a NIFTI extension");let h=ve.getIntAt(e,a+4,l),d=e.buffer.slice(a+8,a+c),f=new f3(c,h,d,l);r.push(f),a+=c}return r}static toArrayBuffer(e){var t,n,s;for(t=new ArrayBuffer(e.length),n=new Uint8Array(t),s=0;s<e.length;s+=1)n[s]=e[s];return t}static isString(e){return typeof e=="string"||e instanceof String}static formatNumber(e,t=void 0){let n;return ve.isString(e)?n=Number(e):n=e,t?n=n.toPrecision(5):n=n.toPrecision(7),parseFloat(n)}static makeCRCTable(){let e,t=[];for(var n=0;n<256;n++){e=n;for(var s=0;s<8;s++)e=e&1?3988292384^e>>>1:e>>>1;t[n]=e}return t}static crc32(e){ve.crcTable||(ve.crcTable=ve.makeCRCTable());const t=ve.crcTable;let n=-1;for(var s=0;s<e.byteLength;s++)n=n>>>8^t[(n^e.getUint8(s))&255];return(n^-1)>>>0}}class be{littleEndian=!1;dim_info=0;dims=[];intent_p1=0;intent_p2=0;intent_p3=0;intent_code=0;datatypeCode=0;numBitsPerVoxel=0;slice_start=0;slice_end=0;slice_code=0;pixDims=[];vox_offset=0;scl_slope=1;scl_inter=0;xyzt_units=0;cal_max=0;cal_min=0;slice_duration=0;toffset=0;description="";aux_file="";intent_name="";qform_code=0;sform_code=0;quatern_a=0;quatern_b=0;quatern_c=0;quatern_d=0;qoffset_x=0;qoffset_y=0;qoffset_z=0;affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];qfac=1;quatern_R;magic="0";isHDR=!1;extensionFlag=[0,0,0,0];extensionSize=0;extensionCode=0;extensions=[];static TYPE_NONE=0;static TYPE_BINARY=1;static TYPE_UINT8=2;static TYPE_INT16=4;static TYPE_INT32=8;static TYPE_FLOAT32=16;static TYPE_COMPLEX64=32;static TYPE_FLOAT64=64;static TYPE_RGB24=128;static TYPE_INT8=256;static TYPE_UINT16=512;static TYPE_UINT32=768;static TYPE_INT64=1024;static TYPE_UINT64=1280;static TYPE_FLOAT128=1536;static TYPE_COMPLEX128=1792;static TYPE_COMPLEX256=2048;static XFORM_UNKNOWN=0;static XFORM_SCANNER_ANAT=1;static XFORM_ALIGNED_ANAT=2;static XFORM_TALAIRACH=3;static XFORM_MNI_152=4;static SPATIAL_UNITS_MASK=7;static TEMPORAL_UNITS_MASK=56;static UNITS_UNKNOWN=0;static UNITS_METER=1;static UNITS_MM=2;static UNITS_MICRON=3;static UNITS_SEC=8;static UNITS_MSEC=16;static UNITS_USEC=24;static UNITS_HZ=32;static UNITS_PPM=40;static UNITS_RADS=48;static MAGIC_COOKIE=348;static STANDARD_HEADER_SIZE=348;static MAGIC_NUMBER_LOCATION=344;static MAGIC_NUMBER=[110,43,49];static MAGIC_NUMBER2=[110,105,49];static EXTENSION_HEADER_SIZE=8;readHeader(e){var t=new DataView(e),n=ve.getIntAt(t,0,this.littleEndian),s,r,a,l;if(n!==be.MAGIC_COOKIE&&(this.littleEndian=!0,n=ve.getIntAt(t,0,this.littleEndian)),n!==be.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=ve.getByteAt(t,39),s=0;s<8;s+=1)l=40+s*2,this.dims[s]=ve.getShortAt(t,l,this.littleEndian);for(this.intent_p1=ve.getFloatAt(t,56,this.littleEndian),this.intent_p2=ve.getFloatAt(t,60,this.littleEndian),this.intent_p3=ve.getFloatAt(t,64,this.littleEndian),this.intent_code=ve.getShortAt(t,68,this.littleEndian),this.datatypeCode=ve.getShortAt(t,70,this.littleEndian),this.numBitsPerVoxel=ve.getShortAt(t,72,this.littleEndian),this.slice_start=ve.getShortAt(t,74,this.littleEndian),s=0;s<8;s+=1)l=76+s*4,this.pixDims[s]=ve.getFloatAt(t,l,this.littleEndian);if(this.vox_offset=ve.getFloatAt(t,108,this.littleEndian),this.scl_slope=ve.getFloatAt(t,112,this.littleEndian),this.scl_inter=ve.getFloatAt(t,116,this.littleEndian),this.slice_end=ve.getShortAt(t,120,this.littleEndian),this.slice_code=ve.getByteAt(t,122),this.xyzt_units=ve.getByteAt(t,123),this.cal_max=ve.getFloatAt(t,124,this.littleEndian),this.cal_min=ve.getFloatAt(t,128,this.littleEndian),this.slice_duration=ve.getFloatAt(t,132,this.littleEndian),this.toffset=ve.getFloatAt(t,136,this.littleEndian),this.description=ve.getStringAt(t,148,228),this.aux_file=ve.getStringAt(t,228,252),this.qform_code=ve.getShortAt(t,252,this.littleEndian),this.sform_code=ve.getShortAt(t,254,this.littleEndian),this.quatern_b=ve.getFloatAt(t,256,this.littleEndian),this.quatern_c=ve.getFloatAt(t,260,this.littleEndian),this.quatern_d=ve.getFloatAt(t,264,this.littleEndian),this.quatern_a=Math.sqrt(1-(Math.pow(this.quatern_b,2)+Math.pow(this.quatern_c,2)+Math.pow(this.quatern_d,2))),this.qoffset_x=ve.getFloatAt(t,268,this.littleEndian),this.qoffset_y=ve.getFloatAt(t,272,this.littleEndian),this.qoffset_z=ve.getFloatAt(t,276,this.littleEndian),this.qform_code<1&&this.sform_code<1&&(this.affine[0][0]=this.pixDims[1],this.affine[1][1]=this.pixDims[2],this.affine[2][2]=this.pixDims[3]),this.qform_code>0&&this.sform_code<this.qform_code){const c=this.quatern_a,h=this.quatern_b,d=this.quatern_c,f=this.quatern_d;for(this.qfac=this.pixDims[0]===0?1:this.pixDims[0],this.quatern_R=[[c*c+h*h-d*d-f*f,2*h*d-2*c*f,2*h*f+2*c*d],[2*h*d+2*c*f,c*c+d*d-h*h-f*f,2*d*f-2*c*h],[2*h*f-2*c*d,2*d*f+2*c*h,c*c+f*f-d*d-h*h]],r=0;r<3;r+=1)for(a=0;a<3;a+=1)this.affine[r][a]=this.quatern_R[r][a]*this.pixDims[a+1],a===2&&(this.affine[r][a]*=this.qfac);this.affine[0][3]=this.qoffset_x,this.affine[1][3]=this.qoffset_y,this.affine[2][3]=this.qoffset_z}else if(this.sform_code>0)for(r=0;r<3;r+=1)for(a=0;a<4;a+=1)l=280+(r*4+a)*4,this.affine[r][a]=ve.getFloatAt(t,l,this.littleEndian);if(this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=ve.getStringAt(t,328,344),this.magic=ve.getStringAt(t,344,348),this.isHDR=this.magic===String.fromCharCode.apply(null,be.MAGIC_NUMBER2),t.byteLength>be.MAGIC_COOKIE){this.extensionFlag[0]=ve.getByteAt(t,348),this.extensionFlag[1]=ve.getByteAt(t,349),this.extensionFlag[2]=ve.getByteAt(t,350),this.extensionFlag[3]=ve.getByteAt(t,351);let c=!0;!this.isHDR&&this.vox_offset<=352&&(c=!1),t.byteLength<=368&&(c=!1),c&&this.extensionFlag[0]&&(this.extensions=ve.getExtensionsAt(t,this.getExtensionLocation(),this.littleEndian,this.vox_offset),this.extensionSize=this.extensions[0].esize,this.extensionCode=this.extensions[0].ecode)}}toFormattedString(){var e=ve.formatNumber,t="";return t+="Dim Info = "+this.dim_info+`
`,t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+`
`,t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+`
`,t+="Intent Code = "+this.intent_code+`
`,t+="Datatype = "+this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+`)
`,t+="Bits Per Voxel = "+this.numBitsPerVoxel+`
`,t+="Slice Start = "+this.slice_start+`
`,t+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+`
`,t+="Image Offset = "+this.vox_offset+`
`,t+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+`
`,t+="Slice End = "+this.slice_end+`
`,t+="Slice Code = "+this.slice_code+`
`,t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(be.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(be.TEMPORAL_UNITS_MASK&this.xyzt_units)+`)
`,t+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+`
`,t+="Slice Duration = "+this.slice_duration+`
`,t+="Time Axis Shift = "+this.toffset+`
`,t+='Description: "'+this.description+`"
`,t+='Auxiliary File: "'+this.aux_file+`"
`,t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+`)
`,t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+`)
`,t+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+`
`,t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+`
`,t+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+`
`,t+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+`
`,t+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+`
`,t+='Intent Name: "'+this.intent_name+`"
`,this.extensionFlag[0]&&(t+="Extension: Size = "+this.extensionSize+"  Code = "+this.extensionCode+`
`),t}getDatatypeCodeString=function(e){return e===be.TYPE_UINT8?"1-Byte Unsigned Integer":e===be.TYPE_INT16?"2-Byte Signed Integer":e===be.TYPE_INT32?"4-Byte Signed Integer":e===be.TYPE_FLOAT32?"4-Byte Float":e===be.TYPE_FLOAT64?"8-Byte Float":e===be.TYPE_RGB24?"RGB":e===be.TYPE_INT8?"1-Byte Signed Integer":e===be.TYPE_UINT16?"2-Byte Unsigned Integer":e===be.TYPE_UINT32?"4-Byte Unsigned Integer":e===be.TYPE_INT64?"8-Byte Signed Integer":e===be.TYPE_UINT64?"8-Byte Unsigned Integer":"Unknown"};getTransformCodeString=function(e){return e===be.XFORM_SCANNER_ANAT?"Scanner":e===be.XFORM_ALIGNED_ANAT?"Aligned":e===be.XFORM_TALAIRACH?"Talairach":e===be.XFORM_MNI_152?"MNI":"Unknown"};getUnitsCodeString=function(e){return e===be.UNITS_METER?"Meters":e===be.UNITS_MM?"Millimeters":e===be.UNITS_MICRON?"Microns":e===be.UNITS_SEC?"Seconds":e===be.UNITS_MSEC?"Milliseconds":e===be.UNITS_USEC?"Microseconds":e===be.UNITS_HZ?"Hz":e===be.UNITS_PPM?"PPM":e===be.UNITS_RADS?"Rads":"Unknown"};getQformMat(){return this.convertNiftiQFormToNiftiSForm(this.quatern_b,this.quatern_c,this.quatern_d,this.qoffset_x,this.qoffset_y,this.qoffset_z,this.pixDims[1],this.pixDims[2],this.pixDims[3],this.pixDims[0])}convertNiftiQFormToNiftiSForm(e,t,n,s,r,a,l,c,h,d){var f=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],p,g=e,y=t,x=n,b,w,S;return f[3][0]=f[3][1]=f[3][2]=0,f[3][3]=1,p=1-(g*g+y*y+x*x),p<1e-7?(p=1/Math.sqrt(g*g+y*y+x*x),g*=p,y*=p,x*=p,p=0):p=Math.sqrt(p),b=l>0?l:1,w=c>0?c:1,S=h>0?h:1,d<0&&(S=-S),f[0][0]=(p*p+g*g-y*y-x*x)*b,f[0][1]=2*(g*y-p*x)*w,f[0][2]=2*(g*x+p*y)*S,f[1][0]=2*(g*y+p*x)*b,f[1][1]=(p*p+y*y-g*g-x*x)*w,f[1][2]=2*(y*x-p*g)*S,f[2][0]=2*(g*x-p*y)*b,f[2][1]=2*(y*x+p*g)*w,f[2][2]=(p*p+x*x-y*y-g*g)*S,f[0][3]=s,f[1][3]=r,f[2][3]=a,f}convertNiftiSFormToNEMA(e){var t,n,s,r,a,l,c,h,d,f,p,g,y,x,b,w,S,C,E,D,M,N,I,_,F,B,P,O,k,q,U,H,Y,Q;if(b=0,P=[[0,0,0],[0,0,0],[0,0,0]],O=[[0,0,0],[0,0,0],[0,0,0]],t=e[0][0],n=e[0][1],s=e[0][2],r=e[1][0],a=e[1][1],l=e[1][2],c=e[2][0],h=e[2][1],d=e[2][2],f=Math.sqrt(t*t+r*r+c*c),f===0||(t/=f,r/=f,c/=f,f=Math.sqrt(n*n+a*a+h*h),f===0))return null;if(n/=f,a/=f,h/=f,f=t*n+r*a+c*h,Math.abs(f)>1e-4){if(n-=f*t,a-=f*r,h-=f*c,f=Math.sqrt(n*n+a*a+h*h),f===0)return null;n/=f,a/=f,h/=f}if(f=Math.sqrt(s*s+l*l+d*d),f===0?(s=r*h-c*a,l=c*n-h*t,d=t*a-r*n):(s/=f,l/=f,d/=f),f=t*s+r*l+c*d,Math.abs(f)>1e-4){if(s-=f*t,l-=f*r,d-=f*c,f=Math.sqrt(s*s+l*l+d*d),f===0)return null;s/=f,l/=f,d/=f}if(f=n*s+a*l+h*d,Math.abs(f)>1e-4){if(s-=f*n,l-=f*a,d-=f*h,f=Math.sqrt(s*s+l*l+d*d),f===0)return null;s/=f,l/=f,d/=f}if(P[0][0]=t,P[0][1]=n,P[0][2]=s,P[1][0]=r,P[1][1]=a,P[1][2]=l,P[2][0]=c,P[2][1]=h,P[2][2]=d,p=this.nifti_mat33_determ(P),p===0)return null;for(B=-666,E=N=I=_=1,D=2,M=3,y=1;y<=3;y+=1)for(x=1;x<=3;x+=1)if(y!==x){for(b=1;b<=3;b+=1)if(!(y===b||x===b))for(O[0][0]=O[0][1]=O[0][2]=O[1][0]=O[1][1]=O[1][2]=O[2][0]=O[2][1]=O[2][2]=0,w=-1;w<=1;w+=2)for(S=-1;S<=1;S+=2)for(C=-1;C<=1;C+=2)O[0][y-1]=w,O[1][x-1]=S,O[2][b-1]=C,g=this.nifti_mat33_determ(O),g*p>0&&(F=this.nifti_mat33_mul(O,P),f=F[0][0]+F[1][1]+F[2][2],f>B&&(B=f,E=y,D=x,M=b,N=w,I=S,_=C))}switch(k=q=U=H=Y=Q="",E*N){case 1:k="X",H="+";break;case-1:k="X",H="-";break;case 2:k="Y",H="+";break;case-2:k="Y",H="-";break;case 3:k="Z",H="+";break;case-3:k="Z",H="-";break}switch(D*I){case 1:q="X",Y="+";break;case-1:q="X",Y="-";break;case 2:q="Y",Y="+";break;case-2:q="Y",Y="-";break;case 3:q="Z",Y="+";break;case-3:q="Z",Y="-";break}switch(M*_){case 1:U="X",Q="+";break;case-1:U="X",Q="-";break;case 2:U="Y",Q="+";break;case-2:U="Y",Q="-";break;case 3:U="Z",Q="+";break;case-3:U="Z",Q="-";break}return k+q+U+H+Y+Q}nifti_mat33_mul=function(e,t){var n=[[0,0,0],[0,0,0],[0,0,0]],s,r;for(s=0;s<3;s+=1)for(r=0;r<3;r+=1)n[s][r]=e[s][0]*t[0][r]+e[s][1]*t[1][r]+e[s][2]*t[2][r];return n};nifti_mat33_determ=function(e){var t,n,s,r,a,l,c,h,d;return t=e[0][0],n=e[0][1],s=e[0][2],r=e[1][0],a=e[1][1],l=e[1][2],c=e[2][0],h=e[2][1],d=e[2][2],t*a*d-t*h*l-r*n*d+r*h*s+c*n*l-c*a*s};getExtensionLocation(){return be.MAGIC_COOKIE+4}getExtensionSize(e){return ve.getIntAt(e,this.getExtensionLocation(),this.littleEndian)}getExtensionCode(e){return ve.getIntAt(e,this.getExtensionLocation()+4,this.littleEndian)}addExtension(e,t=-1){t==-1?this.extensions.push(e):this.extensions.splice(t,0,e),this.vox_offset+=e.esize}removeExtension(e){let t=this.extensions[e];t&&(this.vox_offset-=t.esize),this.extensions.splice(e,1)}toArrayBuffer(e=!1){let s=352;if(e)for(let c of this.extensions)s+=c.esize;let r=new Uint8Array(s),a=new DataView(r.buffer);a.setInt32(0,348,this.littleEndian),a.setUint8(39,this.dim_info);for(let c=0;c<8;c++)a.setUint16(40+2*c,this.dims[c],this.littleEndian);a.setFloat32(56,this.intent_p1,this.littleEndian),a.setFloat32(60,this.intent_p2,this.littleEndian),a.setFloat32(64,this.intent_p3,this.littleEndian),a.setInt16(68,this.intent_code,this.littleEndian),a.setInt16(70,this.datatypeCode,this.littleEndian),a.setInt16(72,this.numBitsPerVoxel,this.littleEndian),a.setInt16(74,this.slice_start,this.littleEndian);for(let c=0;c<8;c++)a.setFloat32(76+4*c,this.pixDims[c],this.littleEndian);a.setFloat32(108,this.vox_offset,this.littleEndian),a.setFloat32(112,this.scl_slope,this.littleEndian),a.setFloat32(116,this.scl_inter,this.littleEndian),a.setInt16(120,this.slice_end,this.littleEndian),a.setUint8(122,this.slice_code),a.setUint8(123,this.xyzt_units),a.setFloat32(124,this.cal_max,this.littleEndian),a.setFloat32(128,this.cal_min,this.littleEndian),a.setFloat32(132,this.slice_duration,this.littleEndian),a.setFloat32(136,this.toffset,this.littleEndian),r.set(new TextEncoder().encode(this.description),148),r.set(new TextEncoder().encode(this.aux_file),228),a.setInt16(252,this.qform_code,this.littleEndian),a.setInt16(254,this.sform_code,this.littleEndian),a.setFloat32(256,this.quatern_b,this.littleEndian),a.setFloat32(260,this.quatern_c,this.littleEndian),a.setFloat32(264,this.quatern_d,this.littleEndian),a.setFloat32(268,this.qoffset_x,this.littleEndian),a.setFloat32(272,this.qoffset_y,this.littleEndian),a.setFloat32(276,this.qoffset_z,this.littleEndian);const l=this.affine.flat();for(let c=0;c<12;c++)a.setFloat32(280+4*c,l[c],this.littleEndian);if(r.set(new TextEncoder().encode(this.intent_name),328),r.set(new TextEncoder().encode(this.magic),344),e){r.set(Uint8Array.from([1,0,0,0]),348);let c=this.getExtensionLocation();for(const h of this.extensions)a.setInt32(c,h.esize,h.littleEndian),a.setInt32(c+4,h.ecode,h.littleEndian),r.set(new Uint8Array(h.edata),c+8),c+=h.esize}else r.set(new Uint8Array(4).fill(0),348);return r.buffer}}class Ii{littleEndian=!1;dim_info=0;dims=[];intent_p1=0;intent_p2=0;intent_p3=0;intent_code=0;datatypeCode=0;numBitsPerVoxel=0;slice_start=0;slice_end=0;slice_code=0;pixDims=[];vox_offset=0;scl_slope=1;scl_inter=0;xyzt_units=0;cal_max=0;cal_min=0;slice_duration=0;toffset=0;description="";aux_file="";intent_name="";qform_code=0;sform_code=0;quatern_b=0;quatern_c=0;quatern_d=0;qoffset_x=0;qoffset_y=0;qoffset_z=0;affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];magic="0";extensionFlag=[0,0,0,0];extensions=[];extensionSize=0;extensionCode=0;static MAGIC_COOKIE=540;static MAGIC_NUMBER_LOCATION=4;static MAGIC_NUMBER=[110,43,50,0,13,10,26,10];static MAGIC_NUMBER2=[110,105,50,0,13,10,26,10];readHeader(e){var t=new DataView(e),n=ve.getIntAt(t,0,this.littleEndian),s,r,a,l;if(n!==Ii.MAGIC_COOKIE&&(this.littleEndian=!0,n=ve.getIntAt(t,0,this.littleEndian)),n!==Ii.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.magic=ve.getStringAt(t,4,12),this.datatypeCode=ve.getShortAt(t,12,this.littleEndian),this.numBitsPerVoxel=ve.getShortAt(t,14,this.littleEndian),s=0;s<8;s+=1)l=16+s*8,this.dims[s]=ve.getInt64At(t,l,this.littleEndian);for(this.intent_p1=ve.getDoubleAt(t,80,this.littleEndian),this.intent_p2=ve.getDoubleAt(t,88,this.littleEndian),this.intent_p3=ve.getDoubleAt(t,96,this.littleEndian),s=0;s<8;s+=1)l=104+s*8,this.pixDims[s]=ve.getDoubleAt(t,l,this.littleEndian);for(this.vox_offset=ve.getInt64At(t,168,this.littleEndian),this.scl_slope=ve.getDoubleAt(t,176,this.littleEndian),this.scl_inter=ve.getDoubleAt(t,184,this.littleEndian),this.cal_max=ve.getDoubleAt(t,192,this.littleEndian),this.cal_min=ve.getDoubleAt(t,200,this.littleEndian),this.slice_duration=ve.getDoubleAt(t,208,this.littleEndian),this.toffset=ve.getDoubleAt(t,216,this.littleEndian),this.slice_start=ve.getInt64At(t,224,this.littleEndian),this.slice_end=ve.getInt64At(t,232,this.littleEndian),this.description=ve.getStringAt(t,240,320),this.aux_file=ve.getStringAt(t,320,344),this.qform_code=ve.getIntAt(t,344,this.littleEndian),this.sform_code=ve.getIntAt(t,348,this.littleEndian),this.quatern_b=ve.getDoubleAt(t,352,this.littleEndian),this.quatern_c=ve.getDoubleAt(t,360,this.littleEndian),this.quatern_d=ve.getDoubleAt(t,368,this.littleEndian),this.qoffset_x=ve.getDoubleAt(t,376,this.littleEndian),this.qoffset_y=ve.getDoubleAt(t,384,this.littleEndian),this.qoffset_z=ve.getDoubleAt(t,392,this.littleEndian),r=0;r<3;r+=1)for(a=0;a<4;a+=1)l=400+(r*4+a)*8,this.affine[r][a]=ve.getDoubleAt(t,l,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=ve.getIntAt(t,496,this.littleEndian),this.xyzt_units=ve.getIntAt(t,500,this.littleEndian),this.intent_code=ve.getIntAt(t,504,this.littleEndian),this.intent_name=ve.getStringAt(t,508,524),this.dim_info=ve.getByteAt(t,524),t.byteLength>Ii.MAGIC_COOKIE&&(this.extensionFlag[0]=ve.getByteAt(t,540),this.extensionFlag[1]=ve.getByteAt(t,541),this.extensionFlag[2]=ve.getByteAt(t,542),this.extensionFlag[3]=ve.getByteAt(t,543),this.extensionFlag[0]&&(this.extensions=ve.getExtensionsAt(t,this.getExtensionLocation(),this.littleEndian,this.vox_offset),this.extensionSize=this.extensions[0].esize,this.extensionCode=this.extensions[0].ecode))}toFormattedString(){var e=ve.formatNumber,t="";return t+="Datatype = "+ +this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+`)
`,t+="Bits Per Voxel =  = "+this.numBitsPerVoxel+`
`,t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+`
`,t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+`
`,t+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+`
`,t+="Image Offset = "+this.vox_offset+`
`,t+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+`
`,t+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+`
`,t+="Slice Duration = "+this.slice_duration+`
`,t+="Time Axis Shift = "+this.toffset+`
`,t+="Slice Start = "+this.slice_start+`
`,t+="Slice End = "+this.slice_end+`
`,t+='Description: "'+this.description+`"
`,t+='Auxiliary File: "'+this.aux_file+`"
`,t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+`)
`,t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+`)
`,t+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+`
`,t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+`
`,t+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+`
`,t+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+`
`,t+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+`
`,t+="Slice Code = "+this.slice_code+`
`,t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(be.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(be.TEMPORAL_UNITS_MASK&this.xyzt_units)+`)
`,t+="Intent Code = "+this.intent_code+`
`,t+='Intent Name: "'+this.intent_name+`"
`,t+="Dim Info = "+this.dim_info+`
`,t}getExtensionLocation=function(){return Ii.MAGIC_COOKIE+4};getExtensionSize=be.prototype.getExtensionSize;getExtensionCode=be.prototype.getExtensionCode;addExtension=be.prototype.addExtension;removeExtension=be.prototype.removeExtension;getDatatypeCodeString=be.prototype.getDatatypeCodeString;getTransformCodeString=be.prototype.getTransformCodeString;getUnitsCodeString=be.prototype.getUnitsCodeString;getQformMat=be.prototype.getQformMat;convertNiftiQFormToNiftiSForm=be.prototype.convertNiftiQFormToNiftiSForm;convertNiftiSFormToNEMA=be.prototype.convertNiftiSFormToNEMA;nifti_mat33_mul=be.prototype.nifti_mat33_mul;nifti_mat33_determ=be.prototype.nifti_mat33_determ;toArrayBuffer(e=!1){let s=544;if(e)for(let c of this.extensions)s+=c.esize;let r=new Uint8Array(s),a=new DataView(r.buffer);a.setInt32(0,540,this.littleEndian),r.set(new TextEncoder().encode(this.magic),4),a.setInt16(12,this.datatypeCode,this.littleEndian),a.setInt16(14,this.numBitsPerVoxel,this.littleEndian);for(let c=0;c<8;c++)a.setBigInt64(16+8*c,BigInt(this.dims[c]),this.littleEndian);a.setFloat64(80,this.intent_p1,this.littleEndian),a.setFloat64(88,this.intent_p2,this.littleEndian),a.setFloat64(96,this.intent_p3,this.littleEndian);for(let c=0;c<8;c++)a.setFloat64(104+8*c,this.pixDims[c],this.littleEndian);a.setBigInt64(168,BigInt(this.vox_offset),this.littleEndian),a.setFloat64(176,this.scl_slope,this.littleEndian),a.setFloat64(184,this.scl_inter,this.littleEndian),a.setFloat64(192,this.cal_max,this.littleEndian),a.setFloat64(200,this.cal_min,this.littleEndian),a.setFloat64(208,this.slice_duration,this.littleEndian),a.setFloat64(216,this.toffset,this.littleEndian),a.setBigInt64(224,BigInt(this.slice_start),this.littleEndian),a.setBigInt64(232,BigInt(this.slice_end),this.littleEndian),r.set(new TextEncoder().encode(this.description),240),r.set(new TextEncoder().encode(this.aux_file),320),a.setInt32(344,this.qform_code,this.littleEndian),a.setInt32(348,this.sform_code,this.littleEndian),a.setFloat64(352,this.quatern_b,this.littleEndian),a.setFloat64(360,this.quatern_c,this.littleEndian),a.setFloat64(368,this.quatern_d,this.littleEndian),a.setFloat64(376,this.qoffset_x,this.littleEndian),a.setFloat64(384,this.qoffset_y,this.littleEndian),a.setFloat64(392,this.qoffset_z,this.littleEndian);const l=this.affine.flat();for(let c=0;c<12;c++)a.setFloat64(400+8*c,l[c],this.littleEndian);if(a.setInt32(496,this.slice_code,this.littleEndian),a.setInt32(500,this.xyzt_units,this.littleEndian),a.setInt32(504,this.intent_code,this.littleEndian),r.set(new TextEncoder().encode(this.intent_name),508),a.setUint8(524,this.dim_info),e){r.set(Uint8Array.from([1,0,0,0]),540);let c=this.getExtensionLocation();for(const h of this.extensions)a.setInt32(c,h.esize,h.littleEndian),a.setInt32(c+4,h.ecode,h.littleEndian),r.set(new Uint8Array(h.edata),c+8),c+=h.esize}else r.set(new Uint8Array(4).fill(0),540);return r.buffer}}function xI(i,e=!1){var t,n,s,r;return i.byteLength<be.STANDARD_HEADER_SIZE?!1:(t=new DataView(i),t&&(n=t.getUint8(be.MAGIC_NUMBER_LOCATION)),s=t.getUint8(be.MAGIC_NUMBER_LOCATION+1),r=t.getUint8(be.MAGIC_NUMBER_LOCATION+2),e&&n===be.MAGIC_NUMBER2[0]&&s===be.MAGIC_NUMBER2[1]&&r===be.MAGIC_NUMBER2[2]?!0:n===be.MAGIC_NUMBER[0]&&s===be.MAGIC_NUMBER[1]&&r===be.MAGIC_NUMBER[2])}function bI(i,e=!1){var t,n,s,r;return i.byteLength<be.STANDARD_HEADER_SIZE?!1:(t=new DataView(i),n=t.getUint8(Ii.MAGIC_NUMBER_LOCATION),s=t.getUint8(Ii.MAGIC_NUMBER_LOCATION+1),r=t.getUint8(Ii.MAGIC_NUMBER_LOCATION+2),e&&n===Ii.MAGIC_NUMBER2[0]&&s===Ii.MAGIC_NUMBER2[1]&&r===Ii.MAGIC_NUMBER2[2]?!0:n===Ii.MAGIC_NUMBER[0]&&s===Ii.MAGIC_NUMBER[1]&&r===Ii.MAGIC_NUMBER[2])}function o1(i){var e,t,n;return!!(i&&(e=new DataView(i),t=e.getUint8(0),n=e.getUint8(1),t===ve.GUNZIP_MAGIC_COOKIE1||n===ve.GUNZIP_MAGIC_COOKIE2))}function wI(i){return AI(new Uint8Array(i)).buffer}async function SI(i){const e=new Uint8Array(i),t=e[0]===31&&e[1]===139&&e[2]===8?"gzip":e[0]===120&&(e[1]===1||e[1]===94||e[1]===156||e[1]===218)?"deflate":"deflate-raw",n=new DecompressionStream(t),s=n.writable.getWriter();s.write(e).catch(console.error);const r=s.close().catch(console.error),l=await new Response(n.readable).arrayBuffer();return await r,l}async function hb(i,e=1/0){const t=g=>g[0]===31&&g[1]===139&&g[2]===8?"gzip":g[0]===120&&[1,94,156,218].includes(g[1])?"deflate":"deflate-raw",n=new Uint8Array(i),s=t(n),r=new DecompressionStream(s),a=new TransformStream({transform(g,y){y.enqueue(g)},flush(g){g.terminate()}}),{readable:l,writable:c}=r,h=c.getWriter(),d=l.pipeThrough(a).getReader();h.write(n).catch(g=>{g instanceof Error&&g.name==="AbortError"||console.error("Error during write:",g)});const f=[];let p=0;try{for(;p<e;){const{done:g,value:y}=await d.read();if(g)break;const x=e-p,b=y.subarray(0,Math.min(y.length,x));if(f.push(b),p+=b.length,p>=e){await Promise.all([d.cancel().catch(()=>{}),h.abort().catch(()=>{})]);break}}}catch(g){g instanceof Error&&g.name==="AbortError"||console.error("Error during decompression:",g)}finally{await Promise.allSettled([d.cancel().catch(()=>{}),h.close().catch(()=>{})])}return f.length===1?f[0].buffer:f.reduce((g,y)=>{const x=new Uint8Array(g.byteLength+y.byteLength);return x.set(new Uint8Array(g),0),x.set(y,g.byteLength),x.buffer},new ArrayBuffer(0))}function CI(i,e=!1){let t=null;if(o1(i)&&(i=wI(i)),xI(i,e)?t=new be:bI(i,e)&&(t=new Ii),t)t.readHeader(i);else throw new Error("That file does not appear to be NIFTI!");return t}async function iu(i,e=!1){if(!o1(i))return CI(i,e);let t=null,n=await hb(i,540),s=!0,r=!0;var a=new DataView(n);const l=a.getInt32(0,!0),c=a.getInt32(0,!1);if(l!==348)if(c===348)s=!1;else if(l===540)r=!1;else if(c===540)r=!1,s=!1;else throw new Error("That file does not appear to be NIFTI!");let h=Math.round(a.getFloat32(108,s));return Ii&&(h=ve.getUint64At(a,168,s)),h>n.byteLength&&(n=await hb(i,h)),r?t=new be:t=new Ii,t.readHeader(n),t}function EI(i){return i.extensionFlag[0]!=0}function db(i,e){var t=i.vox_offset,n=1,s=1;i.dims[4]&&(n=i.dims[4]),i.dims[5]&&(s=i.dims[5]);var r=i.dims[1]*i.dims[2]*i.dims[3]*n*s*(i.numBitsPerVoxel/8);return e.slice(t,t+r)}function m3(i,e,t,n={}){return e!==void 0&&t!==void 0&&(n={...n,headers:{...n.headers,Range:`bytes=${e}-${e+t-1}`}}),fetch(i,n)}function TI(i,e){return{...i,...e,headers:{...i.headers,...e.headers}}}function fb(i,e){const t=typeof i=="string"?new URL(i):i;t.pathname.endsWith("/")||(t.pathname+="/");const n=new URL(e.slice(1),t);return n.search=t.search,n}async function mb(i){if(i.status!==404){if(i.status===200||i.status===206)return new Uint8Array(await i.arrayBuffer());throw new Error(`Unexpected response status ${i.status} ${i.statusText}`)}}async function MI(i,e,t,n){if(n)return fetch(i,{...t,headers:{...t.headers,Range:`bytes=-${e}`}});let s=await fetch(i,{...t,method:"HEAD"});if(!s.ok)return s;let r=s.headers.get("Content-Length"),a=Number(r);return m3(i,a-e,a,t)}class DI{url;#e;#t;constructor(e,t={}){this.url=e,this.#e=t.overrides??{},this.#t=t.useSuffixRequest??!1}#n(e){return TI(this.#e,e)}async get(e,t={}){let n=fb(this.url,e).href,s=await fetch(n,this.#n(t));return mb(s)}async getRange(e,t,n={}){let s=fb(this.url,e),r=this.#n(n),a;return"suffixLength"in t?a=await MI(s,t.suffixLength,r,this.#t):a=await m3(s,t.offset,t.length,r),mb(a)}}const RI="modulepreload",NI=function(i){return"/"+i},pb={},f0=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let c=function(h){return Promise.all(h.map(d=>Promise.resolve(d).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");s=c(t.map(h=>{if(h=NI(h),h in pb)return;pb[h]=!0;const d=h.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${f}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":RI,d||(p.as="script"),p.crossOrigin="",p.href=h,l&&p.setAttribute("nonce",l),document.head.appendChild(p),d)return new Promise((g,y)=>{p.addEventListener("load",g),p.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${h}`)))})}))}function r(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return s.then(a=>{for(const l of a||[])l.status==="rejected"&&r(l.reason);return e().catch(r)})};class p3{#e;constructor(e,t,n){typeof e=="number"?this.#e=new Uint8Array(e):e instanceof ArrayBuffer?this.#e=new Uint8Array(e,t,n):this.#e=new Uint8Array(Array.from(e,s=>s?1:0))}get BYTES_PER_ELEMENT(){return 1}get byteOffset(){return this.#e.byteOffset}get byteLength(){return this.#e.byteLength}get buffer(){return this.#e.buffer}get length(){return this.#e.length}get(e){let t=this.#e[e];return typeof t=="number"?t!==0:t}set(e,t){this.#e[e]=t?1:0}fill(e){this.#e.fill(e?1:0)}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.get(e)}}class l1{_data;chars;#e;constructor(e,t,n,s){if(this.chars=e,this.#e=new TextEncoder,typeof t=="number")this._data=new Uint8Array(t*e);else if(t instanceof ArrayBuffer)s&&(s=s*e),this._data=new Uint8Array(t,n,s);else{let r=Array.from(t);this._data=new Uint8Array(r.length*e);for(let a=0;a<r.length;a++)this.set(a,r[a])}}get BYTES_PER_ELEMENT(){return this.chars}get byteOffset(){return this._data.byteOffset}get byteLength(){return this._data.byteLength}get buffer(){return this._data.buffer}get length(){return this.byteLength/this.BYTES_PER_ELEMENT}get(e){const t=new Uint8Array(this.buffer,this.byteOffset+this.chars*e,this.chars);return new TextDecoder().decode(t).replace(/\x00/g,"")}set(e,t){const n=new Uint8Array(this.buffer,this.byteOffset+this.chars*e,this.chars);n.fill(0),n.set(this.#e.encode(t))}fill(e){const t=this.#e.encode(e);for(let n=0;n<this.length;n++)this._data.set(t,n*this.chars)}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.get(e)}}class nu{#e;chars;constructor(e,t,n,s){if(this.chars=e,typeof t=="number")this.#e=new Int32Array(t*e);else if(t instanceof ArrayBuffer)s&&(s*=e),this.#e=new Int32Array(t,n,s);else{const r=t,a=new nu(e,1);this.#e=new Int32Array((function*(){for(let l of r)a.set(0,l),yield*a.#e})())}}get BYTES_PER_ELEMENT(){return this.#e.BYTES_PER_ELEMENT*this.chars}get byteLength(){return this.#e.byteLength}get byteOffset(){return this.#e.byteOffset}get buffer(){return this.#e.buffer}get length(){return this.#e.length/this.chars}get(e){const t=this.chars*e;let n="";for(let s=0;s<this.chars;s++)n+=String.fromCodePoint(this.#e[t+s]);return n.replace(/\u0000/g,"")}set(e,t){const n=this.chars*e,s=this.#e.subarray(n,n+this.chars);s.fill(0);for(let r=0;r<this.chars;r++)s[r]=t.codePointAt(r)??0}fill(e){this.set(0,e);let t=this.#e.subarray(0,this.chars);for(let n=1;n<this.length;n++)this.#e.set(t,n*this.chars)}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.get(e)}}function su(i){const e=new TextDecoder().decode(i);return JSON.parse(e)}function gb(i,e){const t=e/2,n=e-1;let s=0;for(let r=0;r<i.length;r+=e)for(let a=0;a<t;a+=1)s=i[r+a],i[r+a]=i[r+n-a],i[r+n-a]=s}function g3(i){if(i==="v2:object")return globalThis.Array;let e=i.match(/v2:([US])(\d+)/);if(e){let[,n,s]=e;return(n==="U"?nu:l1).bind(null,Number(s))}let t={int8:Int8Array,int16:Int16Array,int32:Int32Array,int64:globalThis.BigInt64Array,uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,uint64:globalThis.BigUint64Array,float16:globalThis.Float16Array,float32:Float32Array,float64:Float64Array,bool:p3}[i];return ui(t,`Unknown or unsupported data_type: ${i}`),t}function wa(i,e){const t=i.length;typeof e=="string"&&(e=e==="C"?Array.from({length:t},(r,a)=>a):Array.from({length:t},(r,a)=>t-1-a)),ui(t===e.length,"Order length must match the number of dimensions.");let n=1,s=new Array(t);for(let r=e.length-1;r>=0;r--)s[e[r]]=n,n*=i[e[r]];return s}function II({name:i,configuration:e}){if(i==="default"){const t=e?.separator??"/";return n=>["c",...n].join(t)}if(i==="v2"){const t=e?.separator??".";return n=>n.join(t)||"0"}throw new Error(`Unknown chunk key encoding: ${i}`)}function _I(i){if(i==="|O")return{data_type:"v2:object"};let e=i.match(/^([<|>])(.*)$/);ui(e,`Invalid dtype: ${i}`);let[,t,n]=e,s={b1:"bool",i1:"int8",u1:"uint8",i2:"int16",u2:"uint16",i4:"int32",u4:"uint32",i8:"int64",u8:"uint64",f2:"float16",f4:"float32",f8:"float64"}[n]??(n.startsWith("S")||n.startsWith("U")?`v2:${n}`:void 0);return ui(s,`Unsupported or unknown dtype: ${i}`),t==="|"?{data_type:s}:{data_type:s,endian:t==="<"?"little":"big"}}function FI(i,e={}){let t=[],n=_I(i.dtype);i.order==="F"&&t.push({name:"transpose",configuration:{order:"F"}}),"endian"in n&&n.endian==="big"&&t.push({name:"bytes",configuration:{endian:"big"}});for(let{id:s,...r}of i.filters??[])t.push({name:s,configuration:r});if(i.compressor){let{id:s,...r}=i.compressor;t.push({name:s,configuration:r})}return{zarr_format:3,node_type:"array",shape:i.shape,data_type:n.data_type,chunk_grid:{name:"regular",configuration:{chunk_shape:i.chunks}},chunk_key_encoding:{name:"v2",configuration:{separator:i.dimension_separator??"."}},codecs:t,fill_value:i.fill_value,attributes:e}}function PI(i,e={}){return{zarr_format:3,node_type:"group",attributes:e}}function BI(i,e){if(e!=="number"&&e!=="bigint"&&e!=="boolean"&&e!=="object"&&e!=="string")return i===e;let t=i==="bool";if(e==="boolean")return t;let n=i.startsWith("v2:U")||i.startsWith("v2:S");if(e==="string")return n;let s=i==="int64"||i==="uint64";if(e==="bigint")return s;let r=i==="v2:object";return e==="object"?r:!n&&!s&&!t&&!r}function LI(i){return i?.name==="sharding_indexed"}function A3(i){return(i.data_type==="uint64"||i.data_type==="int64")&&i.fill_value!=null?BigInt(i.fill_value):i.fill_value}function v3(i,...e){if(!e.some(t=>i instanceof t))throw i}function ui(i,e=""){if(!i)throw new Error(e)}async function y3(i,{format:e,signal:t}){const n=i instanceof Response?i:new Response(i);ui(n.body,"Response does not contain body.");try{return await new Response(n.body.pipeThrough(new DecompressionStream(e),{signal:t})).arrayBuffer()}catch{throw t?.throwIfAborted(),new Error(`Failed to decode ${e}`)}}class c1{kind="array_to_array";constructor(e,t){ui(e.keepbits>=0,"keepbits must be zero or positive")}static fromConfig(e,t){return new c1(e,t)}encode(e){throw new Error("`BitroundCodec.encode` is not implemented. Please open an issue at https://github.com/manzt/zarrita.js/issues.")}decode(e){return e}}const Ab=kI();function kI(){const i=new Uint32Array([305419896]);return new Uint8Array(i.buffer,i.byteOffset,i.byteLength)[0]!==18}function vb(i){return"BYTES_PER_ELEMENT"in i?i.BYTES_PER_ELEMENT:4}class df{kind="array_to_bytes";#e;#t;#n;#i;#r;constructor(e,t){this.#r=e?.endian,this.#t=g3(t.data_type),this.#i=t.shape,this.#e=wa(t.shape,"C");const n=new this.#t(0);this.#n=n.BYTES_PER_ELEMENT}static fromConfig(e,t){return new df(e,t)}encode(e){let t=new Uint8Array(e.data.buffer);return Ab&&this.#r==="big"&&gb(t,vb(this.#t)),t}decode(e){return Ab&&this.#r==="big"&&gb(e,vb(this.#t)),{data:new this.#t(e.buffer,e.byteOffset,e.byteLength/this.#n),shape:this.#i,stride:this.#e}}}class u1{kind="bytes_to_bytes";static fromConfig(){return new u1}encode(e){throw new Error("Not implemented")}decode(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength-4)}}class h1{kind="bytes_to_bytes";static fromConfig(e){return new h1}encode(e){throw new Error("Gzip encoding is not enabled by default. Please register a custom codec with `numcodecs/gzip`.")}async decode(e){const t=await y3(e,{format:"gzip"});return new Uint8Array(t)}}function OI(i,e){return ui(!Number.isNaN(e),"JsonCodec allow_nan is false but NaN was encountered during encoding."),ui(e!==Number.POSITIVE_INFINITY,"JsonCodec allow_nan is false but Infinity was encountered during encoding."),ui(e!==Number.NEGATIVE_INFINITY,"JsonCodec allow_nan is false but -Infinity was encountered during encoding."),e}function UI(i,e){return e instanceof Object&&!Array.isArray(e)?Object.keys(e).sort().reduce((t,n)=>(t[n]=e[n],t),{}):e}class d1{configuration;kind="array_to_bytes";#e;#t;constructor(e={}){this.configuration=e;const{encoding:t="utf-8",skipkeys:n=!1,ensure_ascii:s=!0,check_circular:r=!0,allow_nan:a=!0,sort_keys:l=!0,indent:c,strict:h=!0}=e;let d=e.separators;d||(c?d=[", ",": "]:d=[",",":"]),this.#e={encoding:t,skipkeys:n,ensure_ascii:s,check_circular:r,allow_nan:a,indent:c,separators:d,sort_keys:l},this.#t={strict:h}}static fromConfig(e){return new d1(e)}encode(e){const{indent:t,encoding:n,ensure_ascii:s,check_circular:r,allow_nan:a,sort_keys:l}=this.#e;ui(n==="utf-8","JsonCodec does not yet support non-utf-8 encoding.");const c=[];ui(r,"JsonCodec does not yet support skipping the check for circular references during encoding."),a||c.push(OI),l&&c.push(UI);const h=Array.from(e.data);h.push("|O"),h.push(e.shape);let d;c.length&&(d=(p,g)=>{let y=g;for(let x of c)y=x(p,y);return y});let f=JSON.stringify(h,d,t);return s&&(f=f.replace(/[\u007F-\uFFFF]/g,p=>{const g=`0000${p.charCodeAt(0).toString(16)}`;return`\\u${g.substring(g.length-4)}`})),new TextEncoder().encode(f)}decode(e){const{strict:t}=this.#t;ui(t,"JsonCodec does not yet support non-strict decoding.");const n=su(e),s=n.pop();n.pop(),ui(s,"0D not implemented for JsonCodec.");const r=wa(s,"C");return{data:n,shape:s,stride:r}}}function yb(i){return i instanceof p3||i instanceof l1||i instanceof nu?new Proxy(i,{get(t,n){return t.get(Number(n))},set(t,n,s){return t.set(Number(n),s),!0}}):i}function VI(i,e){let t;return i.data instanceof l1||i.data instanceof nu?t=new i.constructor(i.data.length,i.data.chars):t=new i.constructor(i.data.length),{data:t,shape:i.shape,stride:wa(i.shape,e)}}function jI(i,e){let t=VI(i,e),n=i.shape.length,s=i.data.length,r=Array(n).fill(0),a=yb(i.data),l=yb(t.data);for(let c=0;c<s;c++){let h=0;for(let d=0;d<n;d++)h+=r[d]*t.stride[d];l[h]=a[c],r[0]+=1;for(let d=0;d<n;d++)if(r[d]===i.shape[d]){if(d+1===n)break;r[d]=0,r[d+1]+=1}}return t}function zI(i){let e=i.shape.length;return ui(e===i.stride.length,"Shape and stride must have the same length."),i.stride.map((t,n)=>({stride:t,index:n})).sort((t,n)=>n.stride-t.stride).map(t=>t.index)}function GI(i,e){let t=zI(i);return ui(t.length===e.length,"Orders must match"),t.every((n,s)=>n===e[s])}class f1{kind="array_to_array";#e;#t;constructor(e,t){let n=e.order??"C",s=t.shape.length,r=new Array(s),a=new Array(s);if(n==="C")for(let l=0;l<s;++l)r[l]=l,a[l]=l;else if(n==="F")for(let l=0;l<s;++l)r[l]=s-l-1,a[l]=s-l-1;else r=n,r.forEach((l,c)=>{ui(a[l]===void 0,`Invalid permutation: ${JSON.stringify(n)}`),a[l]=c});this.#e=r,this.#t=a}static fromConfig(e,t){return new f1(e,t)}encode(e){return GI(e,this.#t)?e:jI(e,this.#t)}decode(e){return{data:e.data,shape:e.shape,stride:wa(e.shape,this.#e)}}}class m1{kind="array_to_bytes";#e;#t;constructor(e){this.#e=e,this.#t=wa(e,"C")}static fromConfig(e,t){return new m1(t.shape)}encode(e){throw new Error("Method not implemented.")}decode(e){let t=new TextDecoder,n=new DataView(e.buffer),s=Array(n.getUint32(0,!0)),r=4;for(let a=0;a<s.length;a++){let l=n.getUint32(r,!0);r+=4,s[a]=t.decode(e.buffer.slice(r,r+l)),r+=l}return{data:s,shape:this.#e,stride:this.#t}}}class p1{kind="bytes_to_bytes";static fromConfig(e){return new p1}encode(e){throw new Error("Zlib encoding is not enabled by default. Please register a codec with `numcodecs/zlib`.")}async decode(e){const t=await y3(e,{format:"deflate"});return new Uint8Array(t)}}function HI(){return new Map().set("blosc",()=>f0(()=>import("./blosc-CrUiACa7.js"),__vite__mapDeps([0,1])).then(i=>i.default)).set("lz4",()=>f0(()=>import("./lz4-B_Exjfmr.js"),__vite__mapDeps([2,1])).then(i=>i.default)).set("zstd",()=>f0(()=>import("./zstd-u5eweWyS.js"),__vite__mapDeps([3,1])).then(i=>i.default)).set("gzip",()=>h1).set("zlib",()=>p1).set("transpose",()=>f1).set("bytes",()=>df).set("crc32c",()=>u1).set("vlen-utf8",()=>m1).set("json2",()=>d1).set("bitround",()=>c1)}const YI=HI();function sg(i){let e;return{async encode(t){e||(e=await xb(i));for(const s of e.array_to_array)t=await s.encode(t);let n=await e.array_to_bytes.encode(t);for(const s of e.bytes_to_bytes)n=await s.encode(n);return n},async decode(t){e||(e=await xb(i));for(let s=e.bytes_to_bytes.length-1;s>=0;s--)t=await e.bytes_to_bytes[s].decode(t);let n=await e.array_to_bytes.decode(t);for(let s=e.array_to_array.length-1;s>=0;s--)n=await e.array_to_array[s].decode(n);return n}}}async function xb(i){let e=i.codecs.map(async r=>{let a=await YI.get(r.name)?.();return ui(a,`Unknown codec: ${r.name}`),{Codec:a,meta:r}}),t=[],n,s=[];for await(let{Codec:r,meta:a}of e){let l=r.fromConfig(a.configuration,i);switch(l.kind){case"array_to_array":t.push(l);break;case"array_to_bytes":n=l;break;default:s.push(l)}}return n||(ui(qI(i),`Cannot encode ${i.data_type} to bytes without a codec`),n=df.fromConfig({endian:"little"},i)),{array_to_array:t,array_to_bytes:n,bytes_to_bytes:s}}function qI(i){return i.data_type!=="v2:object"}class ru extends Error{constructor(e,t={}){super(`Node not found: ${e}`,t),this.name="NodeNotFoundError"}}class g1 extends Error{constructor(e){super(`Missing key: ${e}`),this.name="KeyError"}}const bb=18446744073709551615n;function XI(i,e,t,n){ui(i.store.getRange,"Store does not support range requests");let s=i.store.getRange.bind(i.store),r=e.map((c,h)=>c/n.chunk_shape[h]),a=sg({data_type:"uint64",shape:[...r,2],codecs:n.index_codecs}),l={};return async c=>{let h=c.map((S,C)=>Math.floor(S/r[C])),d=i.resolve(t(h)).path,f;if(d in l)f=l[d];else{let S=4,C=16*r.reduce((D,M)=>D*M,1),E=await s(d,{suffixLength:C+S});f=l[d]=E?await a.decode(E):null}if(f===null)return;let{data:p,shape:g,stride:y}=f,x=c.map((S,C)=>S%g[C]).reduce((S,C,E)=>S+C*y[E],0),b=p[x],w=p[x+1];if(!(b===bb&&w===bb))return s(d,{offset:Number(b),length:Number(w)})}}class Ma{store;path;constructor(e,t="/"){this.store=e,this.path=t}resolve(e){let t=new URL(`file://${this.path.endsWith("/")?this.path:`${this.path}/`}`);return new Ma(this.store,decodeURIComponent(new URL(e,t).pathname))}}function WI(i){return new Ma(i??new Map)}class A1 extends Ma{kind="group";#e;constructor(e,t,n){super(e,t),this.#e=n}get attrs(){return this.#e.attributes}}function wb(i){return i.find(t=>t.name==="transpose")?.configuration?.order??"C"}const lc=Symbol("zarrita.context");function KI(i){return i[lc]}function QI(i,e){let{configuration:t}=e.codecs.find(LI)??{},n={encode_chunk_key:II(e.chunk_key_encoding),TypedArray:g3(e.data_type),fill_value:e.fill_value};if(t){let r=wb(t.codecs);return{...n,kind:"sharded",chunk_shape:t.chunk_shape,codec:sg({data_type:e.data_type,shape:t.chunk_shape,codecs:t.codecs}),get_strides(a){return wa(a,r)},get_chunk_bytes:XI(i,e.chunk_grid.configuration.chunk_shape,n.encode_chunk_key,t)}}let s=wb(e.codecs);return{...n,kind:"regular",chunk_shape:e.chunk_grid.configuration.chunk_shape,codec:sg({data_type:e.data_type,shape:e.chunk_grid.configuration.chunk_shape,codecs:e.codecs}),get_strides(r){return wa(r,s)},async get_chunk_bytes(r,a){let l=n.encode_chunk_key(r),c=i.resolve(l).path;return i.store.get(c,a)}}}let Ld=class extends Ma{kind="array";#e;[lc];constructor(e,t,n){super(e,t),this.#e={...n,fill_value:A3(n)},this[lc]=QI(this,n)}get attrs(){return this.#e.attributes}get shape(){return this.#e.shape}get chunks(){return this[lc].chunk_shape}get dtype(){return this.#e.data_type}async getChunk(e,t){let n=this[lc],s=await n.get_chunk_bytes(e,t);if(!s){let r=n.chunk_shape.reduce((l,c)=>l*c,1),a=new n.TypedArray(r);return a.fill(n.fill_value),{data:a,shape:n.chunk_shape,stride:n.get_strides(n.chunk_shape)}}return n.codec.decode(s)}is(e){return BI(this.dtype,e)}};function*ZI(i,e,t=1){e===void 0&&(e=i,i=0);for(let n=i;n<e;n+=t)yield n}function*JI(...i){if(i.length===0)return;const e=i.map(n=>n[Symbol.iterator]()),t=e.map(n=>n.next());if(t.some(n=>n.done))throw new Error("Input contains an empty iterator.");for(let n=0;;){if(t[n].done){if(e[n]=i[n][Symbol.iterator](),t[n]=e[n].next(),++n>=e.length)return}else yield t.map(({value:s})=>s),n=0;t[n]=e[n].next()}}function $I({start:i,stop:e,step:t},n){if(t===0)throw new Error("slice step cannot be zero");t=t??1;const s=t<0,[r,a]=s?[-1,n-1]:[0,n];return i===null?i=s?a:r:i<0?(i+=n,i<r&&(i=r)):i>a&&(i=a),e===null?e=s?r:a:e<0?(e+=n,e<r&&(e=r)):e>a&&(e=a),[i,e,t]}function Tc(i,e,t=null){return e===void 0&&(e=i,i=null),{start:i,stop:e,step:t}}function e_(){const i=[];return{add:e=>i.push(e()),onIdle:()=>Promise.all(i)}}class v1 extends Error{constructor(e){super(e),this.name="IndexError"}}function t_(i,e){throw new v1(`too many indicies for array; expected ${e.length}, got ${i.length}`)}function i_(i){throw new v1(`index out of bounds for dimension with length ${i}`)}function n_(){throw new v1("only slices with step >= 1 are supported")}function s_(i,e){i.length>e.length&&t_(i,e)}function r_(i,e){return i=Math.trunc(i),i<0&&(i=e+i),(i>=e||i<0)&&i_(e),i}class a_{dim_sel;dim_len;dim_chunk_len;nitems;constructor({dim_sel:e,dim_len:t,dim_chunk_len:n}){e=r_(e,t),this.dim_sel=e,this.dim_len=t,this.dim_chunk_len=n,this.nitems=1}*[Symbol.iterator](){const e=Math.floor(this.dim_sel/this.dim_chunk_len),t=e*this.dim_chunk_len,n=this.dim_sel-t;yield{dim_chunk_ix:e,dim_chunk_sel:n}}}class Sb{start;stop;step;dim_len;dim_chunk_len;nitems;nchunks;constructor({dim_sel:e,dim_len:t,dim_chunk_len:n}){const[s,r,a]=$I(e,t);this.start=s,this.stop=r,this.step=a,this.step<1&&n_(),this.dim_len=t,this.dim_chunk_len=n,this.nitems=Math.max(0,Math.ceil((this.stop-this.start)/this.step)),this.nchunks=Math.ceil(this.dim_len/this.dim_chunk_len)}*[Symbol.iterator](){const e=Math.floor(this.start/this.dim_chunk_len),t=Math.ceil(this.stop/this.dim_chunk_len);for(const n of ZI(e,t)){const s=n*this.dim_chunk_len,r=Math.min(this.dim_len,(n+1)*this.dim_chunk_len),a=r-s;let l=0,c=0;if(this.start<s){const g=(s-this.start)%this.step;g&&(c+=this.step-g),l=Math.ceil((s-this.start)/this.step)}else c=this.start-s;const h=this.stop>r?a:this.stop-s,d=[c,h,this.step],f=Math.ceil((h-c)/this.step),p=[l,l+f,1];yield{dim_chunk_ix:n,dim_chunk_sel:d,dim_out_sel:p}}}}function o_(i,e){let t=[];return i===null?t=e.map(n=>Tc(null)):Array.isArray(i)&&(t=i.map(n=>n??Tc(null))),s_(t,e),t}class l_{dim_indexers;shape;constructor({selection:e,shape:t,chunk_shape:n}){this.dim_indexers=o_(e,t).map((s,r)=>new(typeof s=="number"?a_:Sb)({dim_sel:s,dim_len:t[r],dim_chunk_len:n[r]})),this.shape=this.dim_indexers.filter(s=>s instanceof Sb).map(s=>s.nitems)}*[Symbol.iterator](){for(const e of JI(...this.dim_indexers)){const t=e.map(s=>s.dim_chunk_ix),n=e.map(s=>"dim_out_sel"in s?{from:s.dim_chunk_sel,to:s.dim_out_sel}:{from:s.dim_chunk_sel,to:null});yield{chunk_coords:t,mapping:n}}}}function c_(i,e){return"get"in i?i.get(e):i[e]}async function u_(i,e,t,n){let s=KI(i),r=new l_({selection:e,shape:i.shape,chunk_shape:i.chunks}),a=n.prepare(new s.TypedArray(r.shape.reduce((c,h)=>c*h,1)),r.shape,s.get_strides(r.shape)),l=t.create_queue?.()??e_();for(const{chunk_coords:c,mapping:h}of r)l.add(async()=>{let{data:d,shape:f,stride:p}=await i.getChunk(c,t.opts),g=n.prepare(d,f,p);n.set_from_chunk(a,g,h)});return await l.onIdle(),r.shape.length===0?c_(a.data,0):a}function y1(i,e=0,t){let n=t??i.length-e;return{length:n,subarray(s,r=n){return y1(i,e+s,r-s)},set(s,r=0){for(let a=0;a<s.length;a++)i[e+r+a]=s.get(a)},get(s){return i[e+s]}}}function m0(i){return globalThis.Array.isArray(i.data)?{data:y1(i.data),stride:i.stride,bytes_per_element:1}:{data:new Uint8Array(i.data.buffer,i.data.byteOffset,i.data.byteLength),stride:i.stride,bytes_per_element:i.data.BYTES_PER_ELEMENT}}function h_(i){return"chars"in i?i.constructor.bind(null,i.chars):i.constructor}function d_(i,e){if(globalThis.Array.isArray(i.data))return y1([e]);let t=h_(i.data),n=new t([e]);return new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}const f_={prepare(i,e,t){return{data:i,shape:e,stride:t}},set_scalar(i,e,t){let n=m0(i);rg(n,e,d_(i,t),n.bytes_per_element)},set_from_chunk(i,e,t){let n=m0(i);cd(n,m0(e),n.bytes_per_element,t)}};async function Cb(i,e=null,t={}){return u_(i,e,t,f_)}function x3(i,e,t){return t<0&&e<i?Math.floor((i-e-1)/-t)+1:i<e?Math.floor((e-i-1)/t)+1:0}function rg(i,e,t,n){if(e.length===0){i.data.set(t,0);return}const[s,...r]=e,[a,...l]=i.stride;if(typeof s=="number"){const p=i.data.subarray(a*s*n);rg({data:p,stride:l},r,t,n);return}const[c,h,d]=s,f=x3(c,h,d);if(r.length===0){for(let p=0;p<f;p++)i.data.set(t,a*(c+d*p)*n);return}for(let p=0;p<f;p++){const g=i.data.subarray(a*(c+d*p)*n);rg({data:g,stride:l},r,t,n)}}function cd(i,e,t,n){const[s,...r]=n,[a,...l]=i.stride,[c,...h]=e.stride;if(s.from===null){if(r.length===0){i.data.set(e.data.subarray(0,t),s.to*t);return}cd({data:i.data.subarray(a*s.to*t),stride:l},e,t,r);return}if(s.to===null){if(r.length===0){let w=s.from*t;i.data.set(e.data.subarray(w,w+t),0);return}cd(i,{data:e.data.subarray(c*s.from*t),stride:h},t,r);return}const[d,f,p]=s.to,[g,y,x]=s.from,b=x3(d,f,p);if(r.length===0){if(p===1&&x===1&&a===1&&c===1){let w=g*t,S=b*t;i.data.set(e.data.subarray(w,w+S),d*t);return}for(let w=0;w<b;w++){let S=c*(g+x*w)*t;i.data.set(e.data.subarray(S,S+t),a*(d+p*w)*t)}return}for(let w=0;w<b;w++)cd({data:i.data.subarray(a*(d+w*p)*t),stride:l},{data:e.data.subarray(c*(g+w*x)*t),stride:h},t,r)}let ff=m_();function m_(){let i=new WeakMap;function e(t){let n=i.get(t)??{v2:0,v3:0};return i.set(t,n),n}return{increment(t,n){e(t)[n]+=1},version_max(t){let n=e(t);return n.v3>n.v2?"v3":"v2"}}}async function p_(i){let e=await i.store.get(i.resolve(".zattrs").path);return e?su(e):{}}async function g_(i,e={}){let t="store"in i?i:new Ma(i),n={};return(e.attrs??!0)&&(n=await p_(t)),e.kind==="array"?Eb(t,n):e.kind==="group"?Tb(t,n):Eb(t,n).catch(s=>(v3(s,ru),Tb(t,n)))}async function Eb(i,e){let{path:t}=i.resolve(".zarray"),n=await i.store.get(t);if(!n)throw new ru("v2 array",{cause:new g1(t)});return ff.increment(i.store,"v2"),new Ld(i.store,i.path,FI(su(n),e))}async function Tb(i,e){let{path:t}=i.resolve(".zgroup"),n=await i.store.get(t);if(!n)throw new ru("v2 group",{cause:new g1(t)});return ff.increment(i.store,"v2"),new A1(i.store,i.path,PI(su(n),e))}async function A_(i){let{store:e,path:t}=i.resolve("zarr.json"),n=await i.store.get(t);if(!n)throw new ru("v3 array or group",{cause:new g1(t)});let s=su(n);return s.node_type==="array"&&(s.fill_value=A3(s)),s.node_type==="array"?new Ld(e,i.path,s):new A1(e,i.path,s)}async function v_(i,e={}){let t="store"in i?i:new Ma(i),n=await A_(t);if(ff.increment(t.store,"v3"),e.kind===void 0||e.kind==="array"&&n instanceof Ld||e.kind==="group"&&n instanceof A1)return n;let s=n instanceof Ld?"array":"group";throw new Error(`Expected node of kind ${e.kind}, found ${s}.`)}async function Ir(i,e={}){let t="store"in i?i.store:i,n=ff.version_max(t),s=n==="v2"?Ir.v2:Ir.v3,r=n==="v2"?Ir.v3:Ir.v2;return s(i,e).catch(a=>(v3(a,ru),r(i,e)))}Ir.v2=g_;Ir.v3=v_;var b3=Object.defineProperty,w3=i=>{throw TypeError(i)},y_=(i,e,t)=>e in i?b3(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Hi=(i,e)=>{for(var t in e)b3(i,t,{get:e[t],enumerable:!0})},G=(i,e,t)=>y_(i,typeof e!="symbol"?e+"":e,t),S3=(i,e,t)=>e.has(i)||w3("Cannot "+t),Te=(i,e,t)=>(S3(i,e,"read from private field"),t?t.call(i):e.get(i)),yo=(i,e,t)=>e.has(i)?w3("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),Dr=(i,e,t,n)=>(S3(i,e,"write to private field"),e.set(i,t),t),x_={version:"0.66.0"},ct={TEXTURE0_BACK_VOL:33984,TEXTURE1_COLORMAPS:33985,TEXTURE2_OVERLAY_VOL:33986,TEXTURE3_FONT:33987,TEXTURE5_MATCAP:33989,TEXTURE6_GRADIENT:33990,TEXTURE7_DRAW:33991,TEXTURE8_PAQD:33992,TEXTURE9_ORIENT:33993,TEXTURE11_GC_BACK:33995,TEXTURE12_GC_STRENGTH0:33996,TEXTURE13_GC_STRENGTH1:33997,TEXTURE14_GC_LABEL0:33998,TEXTURE15_GC_LABEL1:33999},b_=new Float32Array([-1,-1,-1,.28,.28,.28,-1,-1,-1,.28,.28,.28,-1,1,-1,.28,.28,.28,1,-1,-1,.28,.28,.28,1,1,-1,.28,.28,.28,1,1,-1,.28,.28,.28,-1,-1,1,.8,.8,.8,-1,-1,1,.8,.8,.8,1,-1,1,.8,.8,.8,-1,1,1,.8,.8,.8,1,1,1,.8,.8,.8,1,1,1,.8,.8,.8,-1,1,-1,0,0,.74,-1,1,-1,0,0,.74,-1,1,1,0,0,.74,1,1,-1,0,0,.74,1,1,1,0,0,.74,1,1,1,0,0,.74,-1,-1,-1,.42,0,.42,-1,-1,-1,.42,0,.42,1,-1,-1,.42,0,.42,-1,-1,1,.42,0,.42,1,-1,1,.42,0,.42,1,-1,1,.42,0,.42,-1,-1,-1,.64,0,0,-1,-1,-1,.64,0,0,-1,-1,1,.64,0,0,-1,1,-1,.64,0,0,-1,1,1,.64,0,0,-1,1,1,.64,0,0,1,-1,-1,0,.5,0,1,-1,-1,0,.5,0,1,1,-1,0,.5,0,1,-1,1,0,.5,0,1,1,1,0,.5,0,1,1,1,0,.5,0,-.45,1,-.8,0,0,0,-.45,1,-.8,0,0,0,-.45,1,.8,0,0,0,-.25,1,-.8,0,0,0,-.25,1,.8,0,0,0,-.25,1,.8,0,0,0,-.25,1,.6,0,0,0,-.25,1,.6,0,0,0,-.25,1,.8,0,0,0,.45,1,.6,0,0,0,.25,1,.8,0,0,0,.25,1,.8,0,0,0,.25,1,.1,0,0,0,.25,1,.1,0,0,0,.25,1,.6,0,0,0,.45,1,.1,0,0,0,.45,1,.6,0,0,0,.45,1,.6,0,0,0,-.25,1,-.1,0,0,0,-.25,1,-.1,0,0,0,-.25,1,.1,0,0,0,.25,1,-.1,0,0,0,.45,1,.1,0,0,0,.45,1,.1,0,0,0,.45,-1,-.8,0,0,0,.45,-1,-.8,0,0,0,.05,-1,.8,0,0,0,.25,-1,-.8,0,0,0,-.15,-1,.8,0,0,0,-.15,-1,.8,0,0,0,-.25,-1,-.8,0,0,0,-.25,-1,-.8,0,0,0,.05,-1,.8,0,0,0,-.45,-1,-.8,0,0,0,-.15,-1,.8,0,0,0,-.15,-1,.8,0,0,0,.13,-1,-.3,0,0,0,.13,-1,-.3,0,0,0,.07,-1,-.1,0,0,0,-.33,-1,-.3,0,0,0,-.27,-1,-.1,0,0,0,-.27,-1,-.1,0,0,0,-.45,.6,1,0,0,0,-.45,.6,1,0,0,0,-.45,.4,1,0,0,0,-.25,.8,1,0,0,0,-.25,.4,1,0,0,0,-.25,.4,1,0,0,0,-.25,.8,1,0,0,0,-.25,.8,1,0,0,0,-.25,.6,1,0,0,0,.25,.8,1,0,0,0,.45,.6,1,0,0,0,.45,.6,1,0,0,0,.25,.8,1,0,0,0,.25,.8,1,0,0,0,.25,-.1,1,0,0,0,.45,.6,1,0,0,0,.45,.1,1,0,0,0,.45,.1,1,0,0,0,-.25,.1,1,0,0,0,-.25,.1,1,0,0,0,-.45,-.1,1,0,0,0,.25,.1,1,0,0,0,.25,-.1,1,0,0,0,.25,-.1,1,0,0,0,-.45,-.1,1,0,0,0,-.45,-.1,1,0,0,0,-.45,-.6,1,0,0,0,-.25,-.1,1,0,0,0,-.25,-.8,1,0,0,0,-.25,-.8,1,0,0,0,-.25,-.6,1,0,0,0,-.25,-.6,1,0,0,0,-.25,-.8,1,0,0,0,.45,-.6,1,0,0,0,.25,-.8,1,0,0,0,.25,-.8,1,0,0,0,.25,-.4,1,0,0,0,.25,-.4,1,0,0,0,.25,-.6,1,0,0,0,.45,-.4,1,0,0,0,.45,-.6,1,0,0,0,.45,-.6,1,0,0,0,-.1,-.8,-1,0,0,0,-.1,-.8,-1,0,0,0,-.1,.8,-1,0,0,0,.1,-.8,-1,0,0,0,.1,.8,-1,0,0,0,.1,.8,-1,0,0,0,-1,-.45,-.8,0,0,0,-1,-.45,-.8,0,0,0,-1,-.45,.8,0,0,0,-1,-.25,-.8,0,0,0,-1,-.25,.8,0,0,0,-1,-.25,.8,0,0,0,-1,-.25,-.8,0,0,0,-1,-.25,-.8,0,0,0,-1,-.25,-.6,0,0,0,-1,.45,-.8,0,0,0,-1,.45,-.6,0,0,0,-1,.45,-.6,0,0,0,1,.45,-.8,0,0,0,1,.45,-.8,0,0,0,1,.45,.8,0,0,0,1,.25,-.8,0,0,0,1,.25,.8,0,0,0,1,.25,.8,0,0,0,1,.25,.6,0,0,0,1,.25,.6,0,0,0,1,.25,.8,0,0,0,1,-.45,.6,0,0,0,1,-.25,.8,0,0,0,1,-.25,.8,0,0,0,1,-.25,.1,0,0,0,1,-.25,.1,0,0,0,1,-.25,.6,0,0,0,1,-.45,.1,0,0,0,1,-.45,.6,0,0,0,1,-.45,.6,0,0,0,1,.25,-.1,0,0,0,1,.25,-.1,0,0,0,1,.25,.1,0,0,0,1,-.25,-.1,0,0,0,1,-.45,.1,0,0,0,1,-.45,.1,0,0,0,1,-.25,-.8,0,0,0,1,-.25,-.8,0,0,0,1,-.05,-.1,0,0,0,1,-.45,-.8,0,0,0,1,-.25,-.1,0,0,0,1,-.25,-.1,0,0,0]),At=class{constructor(e,t,n,s,r=null,a=null){G(this,"sphereIdx",[]),G(this,"sphereVtx",[]),G(this,"renderShaders",[]),G(this,"isVisible",!0),G(this,"isPickable",!0),G(this,"vertexBuffer"),G(this,"indexCount"),G(this,"indexBuffer"),G(this,"vao"),G(this,"mode"),G(this,"glFlags",0),G(this,"id"),G(this,"colorId"),G(this,"modelMatrix",it()),G(this,"scale",[1,1,1]),G(this,"position",[0,0,0]),G(this,"rotation",[0,0,0]),G(this,"rotationRadians",0),G(this,"extentsMin",[]),G(this,"extentsMax",[]),G(this,"furthestVertexFromOrigin"),G(this,"originNegate"),G(this,"fieldOfViewDeObliqueMM"),G(this,"mm"),this.vertexBuffer=t,this.indexCount=s,this.indexBuffer=r,this.vao=a,this.mode=n,this.id=e,this.colorId=[(e>>0&255)/255,(e>>8&255)/255,(e>>16&255)/255,(e>>24&255)/255]}};G(At,"BLEND",1);G(At,"CULL_FACE",2);G(At,"CULL_FRONT",4);G(At,"CULL_BACK",8);G(At,"ENABLE_DEPTH_TEST",16);G(At,"generateCrosshairs",function(i,e,t,n,s,r,a=20,l=0){const c=At.generateCrosshairsGeometry(i,t,n,s,r,a,l);return new At(e,c.vertexBuffer,i.TRIANGLES,c.indexCount,c.indexBuffer,c.vao)});G(At,"generateCrosshairsGeometry",function(i,e,t,n,s,r=20,a=0){const l=[],c=[],h=s*a;if(h<=0){let g=Ae(t[0],e[1],e[2]),y=Ae(n[0],e[1],e[2]);At.makeCylinder(l,c,g,y,s,r),g=Ae(e[0],t[1],e[2]),y=Ae(e[0],n[1],e[2]),At.makeCylinder(l,c,g,y,s,r),g=Ae(e[0],e[1],t[2]),y=Ae(e[0],e[1],n[2]),At.makeCylinder(l,c,g,y,s,r)}else{let g=Ae(t[0],e[1],e[2]),y=Ae(e[0]-h,e[1],e[2]);At.makeCylinder(l,c,g,y,s,r,!1),g=Ae(e[0]+h,e[1],e[2]),y=Ae(n[0],e[1],e[2]),At.makeCylinder(l,c,g,y,s,r,!1),g=Ae(e[0],t[1],e[2]),y=Ae(e[0],e[1]-h,e[2]),At.makeCylinder(l,c,g,y,s,r,!1),g=Ae(e[0],e[1]+h,e[2]),y=Ae(e[0],n[1],e[2]),At.makeCylinder(l,c,g,y,s,r,!1),g=Ae(e[0],e[1],t[2]),y=Ae(e[0],e[1],e[2]-h),At.makeCylinder(l,c,g,y,s,r,!1),g=Ae(e[0],e[1],e[2]+h),y=Ae(e[0],e[1],n[2]),At.makeCylinder(l,c,g,y,s,r,!1)}const d=i.createBuffer();if(d===null)throw new Error("could not instantiate vertex buffer");i.bindBuffer(i.ARRAY_BUFFER,d),i.bufferData(i.ARRAY_BUFFER,new Float32Array(l),i.STATIC_DRAW);const f=i.createBuffer();if(f===null)throw new Error("could not instantiate index buffer");i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,f),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint32Array(c),i.STATIC_DRAW);const p=i.createVertexArray();return i.bindVertexArray(p),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,f),i.bindBuffer(i.ARRAY_BUFFER,d),i.enableVertexAttribArray(0),i.vertexAttribPointer(0,3,i.FLOAT,!1,0,0),i.bindVertexArray(null),{vertexBuffer:d,indexBuffer:f,indexCount:c.length,vao:p}});G(At,"getFirstPerpVector",function(i){const e=Ae(0,0,0);return i[0]===0?e[0]=1:i[1]===0?e[1]=1:i[2]===0?e[2]=1:(e[0]=i[2],e[1]=i[2],e[2]=-(i[0]+i[1]),On(e,e)),e});G(At,"subdivide",function(i,e){let t=i.length/3,n=e.length/3;const s=n,r=bt(),a=bt();for(let l=0;l<s;l++){const c=e[l*3+0],h=e[l*3+1],d=e[l*3+2],f=Ae(i[c*3+0],i[c*3+1],i[c*3+2]),p=Ae(i[h*3+0],i[h*3+1],i[h*3+2]),g=Ae(i[d*3+0],i[d*3+1],i[d*3+2]);Aa(r,f,p),On(a,r),i.push(...a),Aa(r,p,g),On(a,r),i.push(...a),Aa(r,f,g),On(a,r),i.push(...a);let y=[t,t+1,t+2];e.push(...y),y=[c,t,t+2],e.push(...y),y=[t,h,t+1],e.push(...y),e[l*3+0]=t+2,e[l*3+1]=t+1,e[l*3+2]=d,n=n+3,t=t+3}});G(At,"weldVertices",function(i,e){const t=i.length/3;let n=0;const s=new Int32Array(t);for(let l=0;l<t-1;l++){if(s[l]!==0)continue;s[l]=n;let c=l*3;const h=i[c],d=i[c+1],f=i[c+2];for(let p=l+1;p<t;p++)c+=3,h===i[c]&&d===i[c+1]&&f===i[c+2]&&(s[p]=n);n++}if(n===t)return i;const r=e.length;for(let l=0;l<r;l++)e[l]=s[e[l]];const a=i.slice(0,n*3-1);for(let l=0;l<t-1;l++){const c=l*3,h=s[l]*3;a[h]=i[c],a[h+1]=i[c+1],a[h+2]=i[c+2]}return a});G(At,"makeSphere",function(i,e,t,n=[0,0,0]){let s=[0,0,1,.894,0,.447,.276,.851,.447,-.724,.526,.447,-.724,-.526,.447,.276,-.851,.447,.724,.526,-.447,-.276,.851,-.447,-.894,0,-.447,-.276,-.851,-.447,.724,-.526,-.447,0,0,-1];const r=[0,1,2,0,2,3,0,3,4,0,4,5,0,5,1,7,6,11,8,7,11,9,8,11,10,9,11,6,10,11,6,2,1,7,3,2,8,4,3,9,5,4,10,1,5,6,7,2,7,8,3,8,9,4,9,10,5,10,6,1];At.subdivide(s,r),At.subdivide(s,r),s=At.weldVertices(s,r);for(let h=0;h<s.length;h++)s[h]=s[h]*t;const a=s.length/3;let l=0;for(let h=0;h<a;h++)s[l]=s[l]+n[0],l++,s[l]=s[l]+n[1],l++,s[l]=s[l]+n[2],l++;const c=Math.floor(i.length/3);for(let h=0;h<r.length;h++)r[h]=r[h]+c;e.push(...r),i.push(...s)});G(At,"makeCylinder",function(i,e,t,n,s,r=20,a=!0){r<3&&(r=3);const l=bt();It(l,n,t),On(l,l);const c=At.getFirstPerpVector(l),h=bt();ad(h,l,c),On(h,h);let d=2*r,f=2*r;a&&(f+=2*r,d+=2);const p=Math.floor(i.length/3),g=new Uint32Array(f*3),y=new Float32Array(d*3);function x(D,M){y[D*3+0]=M[0],y[D*3+1]=M[1],y[D*3+2]=M[2]}function b(D,M,N,I){g[D*3+0]=M+p,g[D*3+1]=N+p,g[D*3+2]=I+p}const w=2*r,S=w+1;a&&(x(w,t),x(S,n));const C=bt(),E=bt();for(let D=0;D<r;D++){const M=Math.cos(D/r*2*Math.PI),N=Math.sin(D/r*2*Math.PI);C[0]=s*(M*c[0]+N*h[0]),C[1]=s*(M*c[1]+N*h[1]),C[2]=s*(M*c[2]+N*h[2]),Aa(E,t,C),x(D,E),Aa(E,n,C),x(D+r,E);let I=0;D<r-1&&(I=D+1),b(D*2,D,I,D+r),b(D*2+1,I,I+r,D+r),a&&(b(r*2+D,D,w,I),b(r*2+D+r,S,D+r,I+r))}e.push(...g),i.push(...y)});G(At,"makeColoredCylinder",function(i,e,t,n,s,r,a=[192,0,0,255],l=20,c=!1){let h=i.length/3;At.makeCylinder(i,e,n,s,r,l,c),h=i.length/3-h;const d=[];for(let f=0;f<h*4-1;f+=4)d[f]=a[0],d[f+1]=a[1],d[f+2]=a[2],d[f+3]=a[3];t.push(...d)});G(At,"makeColoredSphere",function(i,e,t,n,s=[0,0,0],r=[0,0,192,255]){let a=i.length/3;At.makeSphere(i,e,n,s),a=i.length/3-a;const l=[];for(let c=0;c<a*4-1;c+=4)l[c]=r[0],l[c+1]=r[1],l[c+2]=r[2],l[c+3]=r[3];t.push(...l)});var Sa=At,C3=class Kn{constructor({name:e="niivue",level:t="info"}={}){G(this,"level"),G(this,"name"),this.name=`${e}`,this.level=t}debug(...e){Kn.levels[this.level]>Kn.levels.debug||console.debug(`${this.name}-debug`,...e)}info(...e){Kn.levels[this.level]>Kn.levels.info||console.info(`${this.name}-info`,...e)}warn(...e){Kn.levels[this.level]>Kn.levels.warn||console.warn(`${this.name}-warn`,...e)}error(...e){Kn.levels[this.level]>Kn.levels.error||console.error(`${this.name}-error`,...e)}fatal(...e){Kn.levels[this.level]>Kn.levels.fatal||console.error(`${this.name}-fatal`,...e)}setLogLevel(e){this.level=e}setName(e){this.name=e}};G(C3,"levels",{debug:0,info:1,warn:2,error:3,fatal:4,silent:1/0});var w_=C3,X=new w_({name:"niivue",level:"info"}),ud={};Hi(ud,{$itksnap:()=>S_,$slicer3d:()=>C_,actc:()=>E_,afni_blues_inv:()=>OF,afni_reds_inv:()=>UF,batlow:()=>T_,bcgwhw:()=>D_,bcgwhw_dark:()=>M_,blue:()=>F_,blue2cyan:()=>I_,blue2magenta:()=>N_,blue2red:()=>R_,bluegrn:()=>__,bone:()=>P_,bronze:()=>B_,cet_l17:()=>L_,cividis:()=>k_,cool:()=>O_,copper:()=>V_,copper2:()=>U_,ct_airways:()=>j_,ct_artery:()=>z_,ct_bones:()=>G_,ct_brain:()=>Y_,ct_brain_gray:()=>H_,ct_cardiac:()=>q_,ct_head:()=>X_,ct_kidneys:()=>W_,ct_liver:()=>K_,ct_muscles:()=>Q_,ct_scalp:()=>Z_,ct_skull:()=>J_,ct_soft:()=>$_,ct_soft_tissue:()=>eF,ct_surface:()=>tF,ct_vessels:()=>iF,ct_w_contrast:()=>nF,cubehelix:()=>sF,electric_blue:()=>rF,freesurfer:()=>aF,ge_color:()=>oF,gold:()=>lF,gray:()=>cF,green:()=>uF,green2cyan:()=>hF,green2orange:()=>dF,hot:()=>mF,hotiron:()=>fF,hsv:()=>pF,inferno:()=>gF,jet:()=>AF,kry:()=>vF,linspecer:()=>yF,lipari:()=>xF,magma:()=>bF,mako:()=>wF,navia:()=>SF,nih:()=>CF,plasma:()=>EF,random:()=>TF,red:()=>MF,redyell:()=>DF,rocket:()=>RF,roi_i256:()=>VF,surface:()=>NF,thermal:()=>IF,turbo:()=>_F,violet:()=>FF,viridis:()=>PF,warm:()=>BF,winter:()=>LF,x_rain:()=>kF});var S_={R:[0,255,0,0,255,0,255,255,0,205,210,102,0,0,46,255,106,221,233,165,255,147,218,75,255,60,255,255,218,0,188,255,255,222,127,139,124,255,70,0,238,238,240,245,184,32,255,25,112,34,248,245,255,144,173,65,255,250,128,50,244,255,123,255,173,255,127,255,143,220,253,255,0,0,128,255,250,148,178,255,135,100,240,250,255,107,135,0,139,245,186,255,255,0,210,255,47,72,175,128,176,255,139,240,255,216,119,219,72,255,199,154,189,240,230,0,85,64,153,205,250,95,0,255,224,176,138,30,240,152,160],G:[0,0,255,0,255,255,0,239,0,133,180,205,0,139,139,228,90,160,150,42,250,112,112,0,182,179,235,228,165,128,143,105,218,184,255,69,252,255,130,100,130,232,255,222,134,178,20,25,128,139,248,255,160,238,255,105,99,240,0,205,164,255,104,165,216,192,255,140,188,20,245,250,206,255,0,250,128,0,34,127,206,149,230,235,245,142,206,0,0,245,85,228,222,191,105,248,79,61,238,128,224,240,0,255,215,191,136,112,209,0,21,205,183,248,230,250,107,224,50,92,250,158,128,69,255,196,43,144,128,251,82],B:[0,0,0,255,0,255,255,213,205,63,140,170,128,139,87,225,205,221,122,42,250,219,214,130,193,113,205,196,32,128,143,180,185,135,0,19,0,224,180,0,238,170,240,179,11,170,147,112,144,34,255,250,122,144,47,225,71,230,0,50,96,240,238,0,230,203,212,0,143,60,230,240,209,127,128,205,114,211,34,80,235,237,140,215,238,35,250,139,139,220,211,181,173,255,30,220,79,139,238,0,230,245,0,255,0,216,153,147,204,255,133,50,107,255,250,154,47,208,204,92,210,160,0,0,255,222,226,255,128,152,45],A:[0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],I:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130]},C_={labels:["background","tissue","bone","skin","connective tissue","blood","organ","mass","muscle","foreign object","waste","teeth","fat","gray matter","white matter","nerve","vein","artery","capillary","ligament","tendon","cartilage","meniscus","lymph node","lymphatic vessel","cerebro-spinal fluid","bile","urine","feces","gas","fluid","edema","bleeding","necrosis","clot","embolism","head","central nervous system","brain","gray matter of brain","telencephalon","cerebral cortex","right frontal lobe","left frontal lobe","right temporal lobe","left temporal lobe","right parietal lobe","left parietal lobe","right occipital lobe","left occipital lobe","right insular lobe","left insular lobe","right limbic lobe","left limbic lobe","right striatum","left striatum","right caudate nucleus","left caudate nucleus","right putamen","left putamen","right pallidum","left pallidum","right amygdaloid complex","left amygdaloid complex","diencephalon","thalamus","right thalamus","left thalamus","pineal gland","midbrain","substantia nigra","right substantia nigra","left substantia nigra","cerebral white matter","right superior longitudinal fasciculus","left superior longitudinal fasciculus","right inferior longitudinal fasciculus","left inferior longitudinal fasciculus","right arcuate fasciculus","left arcuate fasciculus","right uncinate fasciculus","left uncinate fasciculus","right cingulum bundle","left cingulum bundle","projection fibers","right corticospinal tract","left corticospinal tract","right optic radiation","left optic radiation","right medial lemniscus","left medial lemniscus","right superior cerebellar peduncle","left superior cerebellar peduncle","right middle cerebellar peduncle","left middle cerebellar peduncle","right inferior cerebellar peduncle","left inferior cerebellar peduncle","optic chiasm","right optic tract","left optic tract","right fornix","left fornix","commissural fibers","corpus callosum","posterior commissure","cerebellar white matter","CSF space","ventricles of brain","right lateral ventricle","left lateral ventricle","right third ventricle","left third ventricle","cerebral aqueduct","fourth ventricle","subarachnoid space","spinal cord","gray matter of spinal cord","white matter of spinal cord","endocrine system of brain","pituitary gland","adenohypophysis","neurohypophysis","meninges","dura mater","arachnoid","pia mater","muscles of head","salivary glands","lips","nose","tongue","soft palate","right inner ear","left inner ear","right external ear","left external ear","right middle ear","left middle ear","right eyeball","left eyeball","skull","right frontal bone","left frontal bone","right parietal bone","left parietal bone","right temporal bone","left temporal bone","right sphenoid bone","left sphenoid bone","right ethmoid bone","left ethmoid bone","occipital bone","maxilla","right zygomatic bone","right lacrimal bone","vomer bone","right palatine bone","left palatine bone","mandible","neck","muscles of neck","pharynx","larynx","thyroid gland","right parathyroid glands","left parathyroid glands","skeleton of neck","hyoid bone","cervical vertebral column","thorax","trachea","bronchi","right lung","left lung","superior lobe of right lung","superior lobe of left lung","middle lobe of right lung","inferior lobe of right lung","inferior lobe of left lung","pleura","heart","right atrium","left atrium","atrial septum","ventricular septum","right ventricle of heart","left ventricle of heart","mitral valve","tricuspid valve","aortic valve","pulmonary valve","aorta","pericardium","pericardial cavity","esophagus","thymus","mediastinum","skin of thoracic wall","muscles of thoracic wall","skeleton of thorax","thoracic vertebral column","ribs","sternum","right clavicle","left clavicle","abdominal cavity","abdomen","peritoneum","omentum","peritoneal cavity","retroperitoneal space","stomach","duodenum","small bowel","colon","anus","liver","biliary tree","gallbladder","pancreas","spleen","urinary system","right kidney","left kidney","right ureter","left ureter","urinary bladder","urethra","right adrenal gland","left adrenal gland","female internal genitalia","uterus","right fallopian tube","left fallopian tube","right ovary","left ovary","vagina","male internal genitalia","prostate","right seminal vesicle","left seminal vesicle","right deferent duct","left deferent duct","skin of abdominal wall","muscles of abdominal wall","skeleton of abdomen","lumbar vertebral column","female external genitalia","male external genitalia","skeleton of upper limb","muscles of upper limb","right upper limb","left upper limb","right shoulder","left shoulder","right arm"],R:[0,128,241,177,111,216,221,144,192,220,78,255,230,200,250,244,0,216,183,183,152,111,178,68,111,85,0,214,78,218,170,140,188,216,145,150,177,244,250,200,68,128,83,83,162,162,141,141,182,182,188,188,154,154,177,177,30,30,210,210,48,48,98,98,69,166,122,122,253,145,46,0,0,250,127,127,159,159,125,125,106,106,154,154,126,201,201,78,78,174,174,139,139,148,148,186,186,99,156,156,64,64,138,97,126,194,85,88,88,88,88,88,88,88,88,244,200,250,82,57,60,92,255,255,255,255,201,70,188,177,166,182,229,229,174,174,201,201,194,194,241,203,203,229,229,255,255,209,209,248,248,255,196,255,255,255,242,242,222,177,213,184,150,62,62,62,242,250,255,177,182,175,197,197,172,172,202,224,224,255,206,210,203,233,195,181,152,159,166,218,225,224,255,184,211,47,255,173,188,255,226,253,244,205,205,186,177,255,234,204,180,216,255,205,204,255,221,0,139,249,157,203,185,185,247,247,222,124,249,249,244,255,255,227,213,213,193,216,230,245,245,241,241,177,171,217,212,185,185,198,194,177,177,177,177,177],G:[0,174,214,122,184,101,130,238,104,245,63,250,220,200,250,214,151,101,156,214,189,184,212,172,197,188,145,230,63,255,250,224,65,191,60,98,122,214,250,200,131,174,146,146,115,115,93,93,166,166,135,135,150,150,140,140,111,111,157,157,129,129,153,153,110,113,101,101,135,92,101,108,108,250,150,150,116,116,102,102,174,174,146,146,126,160,160,152,152,140,140,126,126,120,120,135,135,106,171,171,123,123,95,113,161,195,188,106,106,106,106,106,106,106,106,214,200,250,174,157,143,162,244,244,244,244,121,163,91,122,84,105,147,147,122,122,112,112,142,142,213,179,179,204,204,243,243,185,185,223,223,230,172,255,250,237,217,217,198,122,124,105,208,162,162,162,206,210,255,122,228,216,165,165,138,138,164,186,186,245,110,115,108,138,100,85,55,63,70,123,130,97,244,122,171,150,244,121,95,239,202,232,217,179,179,124,122,255,234,142,119,132,253,167,168,224,130,145,150,180,108,136,102,102,182,182,154,186,186,186,170,181,190,153,141,141,123,146,158,172,172,172,172,124,85,198,188,135,135,175,98,122,122,122,122,122],B:[0,128,145,101,210,79,101,144,88,20,0,220,70,235,210,49,206,79,220,211,207,210,242,100,131,255,30,130,0,255,250,228,28,216,66,83,101,49,225,215,98,128,164,164,105,105,137,137,110,110,166,166,201,201,190,190,85,85,166,166,126,126,112,112,53,137,38,38,192,109,131,112,112,225,88,88,163,163,154,154,155,155,83,83,55,133,133,141,141,103,103,177,177,72,72,135,135,24,108,108,147,147,74,158,197,164,255,215,215,215,215,215,215,215,215,49,215,225,128,110,83,109,209,209,209,209,77,117,95,101,94,107,118,118,90,90,73,73,0,0,144,77,77,109,109,152,152,85,85,131,131,138,68,167,160,145,123,123,101,101,109,108,243,114,114,114,142,139,207,101,255,244,145,145,115,115,140,162,162,217,84,89,81,112,73,57,13,27,38,97,104,76,209,154,143,103,209,88,76,172,134,158,154,108,108,161,101,220,194,178,153,105,229,142,143,199,101,30,98,111,162,116,83,83,164,164,132,223,150,150,147,158,165,130,113,113,103,127,140,147,147,151,151,92,68,131,102,134,134,125,79,101,101,101,101,101],A:[0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],I:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]},E_={R:[0,0,24,248,255],G:[0,0,177,254,0],B:[0,136,0,0,0],A:[0,32,64,78,128],I:[0,64,128,156,255]},T_={R:[1,10,15,17,21,27,36,49,65,82,99,118,140,161,183,203,222,238,248,253,253,253,252,250],G:[25,42,56,68,79,88,97,105,111,116,122,127,133,138,142,146,150,155,162,170,178,186,195,204],B:[89,92,95,96,98,98,96,91,83,74,64,55,46,43,49,62,79,100,126,151,175,199,223,250],A:[0,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64],I:[0,11,22,33,44,55,66,77,88,99,110,121,133,144,155,166,177,188,199,210,221,232,243,255]},M_={R:[0,248,242,235,229,222,212,202,193,183,173,145,117,78,39,0,0,0,0,0,0,64,128,191,255,255,255,255,255,238,221,204,214,224,235,245,255,249,242,236,229,223,217,210,204,197,191,184,176,169,161,154,146,139,132,124,117,109,102,0],G:[0,251,247,243,239,235,235,235,235,235,235,216,197,174,150,127,153,178,204,229,255,255,255,255,255,220,185,150,115,77,38,0,31,61,92,122,153,138,122,107,92,77,61,46,31,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0],B:[0,254,253,252,251,250,251,252,253,254,255,226,198,132,66,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40,80,120,160,200,199,198,197,196,196,195,194,193,192,191,184,176,169,161,154,146,139,132,124,117,109,102,0],A:[256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256],I:[0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,255]},D_={R:[255,248,242,235,229,222,212,202,193,183,173,145,117,78,39,0,0,0,0,0,0,64,128,191,255,255,255,255,255,238,221,204,214,224,235,245,255,249,242,236,229,223,217,210,204,197,191,184,176,169,161,154,146,139,132,124,117,109,102,0],G:[255,251,247,243,239,235,235,235,235,235,235,216,197,174,150,127,153,178,204,229,255,255,255,255,255,220,185,150,115,77,38,0,31,61,92,122,153,138,122,107,92,77,61,46,31,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0],B:[255,254,253,252,251,250,251,252,253,254,255,226,198,132,66,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40,80,120,160,200,199,198,197,196,196,195,194,193,192,191,184,176,169,161,154,146,139,132,124,117,109,102,0],A:[256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256,256],I:[0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,255]},R_={R:[0,0,0,0,196,255],G:[0,32,128,128,128,32],B:[0,255,196,0,0,0],A:[0,128,64,64,64,128],I:[0,1,64,128,192,255]},N_={R:[0,255],G:[0,0],B:[255,255],A:[0,128],I:[0,255]},I_={R:[0,0],G:[0,255],B:[255,255],A:[0,128],I:[0,255]},__={R:[0,0,0,0],G:[0,1,128,255],B:[0,222,127,32],A:[0,0,64,128],I:[0,1,128,255]},F_={R:[0,0,0],G:[0,0,0],B:[0,128,255],A:[0,64,128],I:[0,128,255]},P_={R:[0,103,255],G:[0,126,255],B:[0,165,255],A:[0,76,128],I:[0,153,255]},B_={R:[0,43,103,199,216,255],G:[0,0,37,155,213,255],B:[0,0,20,97,201,255],A:[0,44,48,54,56,56],I:[0,64,128,196,240,255]},L_={R:[0,9,24,33,40,46,52,57,62,66,70,74,78,81,85,88,91,94,98,101,103,106,109,112,114,117,119,121,124,126,128,130,133,135,137,139,141,143,145,147,149,151,153,155,157,159,161,163,164,166,168,169,171,172,174,175,177,178,180,181,183,184,186,187,189,190,191,193,194,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,222,223,224,224,225,226,226,227,228,228,229,229,230,231,231,232,233,233,234,234,235,235,236,236,236,237,237,237,238,238,238,239,239,239,240,240,240,241,241,241,242,242,242,243,243,243,243,243,243,243,243,244,244,244,244,244,244,244,244,244,244,244,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,243,243,243,243,243,243,243,243,243,243,243,243,242,242,242,242,242,242,242,242,241,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,243,243,244,244,245,246,246,247,247,248,249,249,250,250,251,251,252,252,253,253,254,254,254],G:[42,41,41,41,40,40,40,39,39,39,38,38,37,37,36,36,35,35,34,34,33,32,32,31,30,30,30,30,29,29,29,29,28,28,28,27,27,27,26,26,26,25,25,25,24,24,24,24,24,25,25,26,27,27,28,28,29,30,30,31,31,32,33,33,34,34,35,36,36,37,38,39,40,42,43,44,45,47,48,49,50,51,53,54,55,56,57,58,59,60,62,63,64,65,66,68,69,71,72,73,75,76,77,79,80,81,83,84,85,87,88,89,90,92,93,94,95,97,98,100,101,102,104,105,107,108,109,111,112,113,115,116,117,119,120,121,122,124,125,126,128,129,130,132,133,134,136,137,138,140,141,142,144,145,146,147,149,150,151,153,154,155,156,158,159,160,161,163,164,165,167,168,169,170,172,173,174,175,176,178,179,180,181,183,184,185,186,187,189,190,191,192,193,194,196,197,198,199,200,201,203,204,205,206,207,208,209,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,228,229,230,231,232,233,234,235,236,237,238,238,239,240,241,241,242,243,244,244,245,246,247,248,248,249,250,251,251,252,253,254,255],B:[167,167,166,166,166,165,165,165,164,164,164,163,163,162,162,162,161,161,161,160,160,160,159,159,158,158,157,157,156,155,155,154,154,153,153,152,151,151,150,150,149,149,148,147,147,146,146,145,144,144,143,143,142,141,141,140,139,139,138,137,137,136,135,135,134,133,133,132,131,131,130,130,129,128,128,127,127,126,125,125,124,124,123,123,122,121,121,120,119,119,118,118,117,116,116,116,115,115,114,114,113,113,113,112,112,111,111,110,110,109,109,109,108,108,107,107,106,106,106,106,106,105,105,105,105,105,105,105,104,104,104,104,104,103,103,103,103,103,102,102,102,103,103,103,103,104,104,104,104,104,105,105,105,105,106,106,106,106,106,107,107,107,107,108,108,109,110,111,111,112,113,113,114,115,115,116,117,117,118,119,120,120,121,122,122,123,124,125,126,128,129,130,131,132,134,135,136,137,138,140,141,142,143,144,146,147,148,149,150,152,153,155,157,158,160,162,163,165,167,168,170,172,173,175,177,178,180,182,183,185,187,188,190,193,196,199,201,204,207,210,212,215,218,221,224,226,229,232,235,238,240,243,246,249,252,255],A:[0,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64],I:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]},k_={R:[0,86,166,255],G:[32,92,156,233],B:[76,108,117,69],A:[0,56,80,88],I:[0,64,192,255]},O_={R:[0,0,0],G:[127,196,254],B:[255,255,255],A:[0,64,128],I:[0,128,255]},U_={R:[0,61,122,183,244,255],G:[0,41,81,122,163,255],B:[0,25,51,76,102,255],A:[0,25,51,71,102,128],I:[0,51,102,153,204,255]},V_={R:[0,61,122,183,244,255],G:[0,41,81,122,163,203],B:[0,25,51,76,102,127],A:[0,25,51,71,102,128],I:[0,51,102,153,204,255]},j_={min:-643,max:-235,R:[0,0,0],G:[154,154,154],B:[179,179,101],A:[0,32,0],I:[0,163,255]},z_={min:114,max:800,R:[0,255,255,255],G:[0,0,129,255],B:[0,0,0,255],A:[0,64,88,228],I:[0,80,160,255]},G_={min:180,max:600,R:[0,0,113,255],G:[0,0,109,250],B:[0,0,101,245],A:[0,0,100,160],I:[0,1,128,255]},H_={min:-10,max:110,R:[0,127,255],G:[0,127,255],B:[0,127,255],A:[0,48,128],I:[0,124,255]},Y_={min:-10,max:110,R:[0,199,255],G:[0,127,255],B:[0,127,255],A:[0,48,128],I:[0,124,255]},q_={min:-80,max:1e3,R:[0,189,150,150,150,150,255],G:[0,169,54,54,54,54,240],B:[0,153,52,52,52,52,242],A:[0,32,64,0,0,64,64],I:[0,1,82,92,234,242,255]},X_={min:-590,max:600,R:[0,241,241,248,248,178,178,232,255,255,255],G:[0,156,156,222,222,36,36,51,255,255,255],B:[0,130,130,169,169,24,24,37,255,255,255],A:[0,8,0,0,0,64,64,0,0,222,222],I:[0,2,3,64,122,142,172,182,252,253,255]},W_={min:114,max:302,R:[0,255,255],G:[0,129,255],B:[0,0,255],A:[0,88,228],I:[0,103,255]},K_={min:-23,max:246,R:[0,44,255,255,255],G:[0,128,90,255,255],B:[0,0,70,0,255],A:[0,0,82,184,228],I:[0,64,131,196,255]},Q_={min:-100,max:246,R:[0,128,159,255,255,255,255],G:[0,0,56,90,0,255,255],B:[0,0,41,70,0,0,255],A:[0,63,105,135,167,184,228],I:[0,100,128,155,180,209,255]},Z_={min:-590,max:600,R:[0,241,241,248,248,178,232,255,255],G:[0,156,156,222,222,36,51,255,255],B:[0,130,130,169,169,24,37,255,255],A:[0,63,105,135,167,184,228,228,228],I:[0,1,52,127,137,162,172,252,255]},J_={min:140,max:1024,R:[0,2,113,255],G:[0,1,109,250],B:[0,1,101,245],A:[0,1,96,168],I:[0,1,128,255]},$_={min:-923,max:679,R:[0,0,0,0,0,255,255,255],G:[154,154,154,154,0,0,254,255],B:[179,179,179,179,0,0,0,255],A:[0,3,8,0,0,10,15,20],I:[0,30,62,88,170,200,232,255]},eF={min:-10,max:110,R:[0,199,255],G:[0,127,255],B:[0,127,255],A:[0,48,128],I:[0,124,255]},tF={min:-600,max:100,R:[0,134,255],G:[0,109,250],B:[0,101,245],A:[0,60,148],I:[0,128,255]},iF={min:114,max:246,R:[0,255,255],G:[0,128,255],B:[0,128,255],A:[0,64,96],I:[0,87,255]},nF={min:50,max:1e3,R:[98,210,169,128,255],G:[94,26,77,128,255],B:[45,21,74,128,255],A:[0,25,0,4,168],I:[0,41,87,154,255]},sF={R:[0,13,21,26,27,25,22,21,22,28,39,54,75,98,124,148,171,189,202,210,213,211,206,200,195,193,195,201,211,225,240,255],G:[0,5,11,20,31,44,58,72,86,99,109,116,120,122,122,122,121,121,124,129,137,147,161,175,190,205,218,229,238,245,251,255],B:[0,14,30,46,61,71,77,78,75,68,60,52,48,47,53,65,83,105,131,157,183,205,222,235,241,243,242,240,239,240,245,255],A:[0,4,8,12,17,21,25,29,33,37,41,45,50,54,58,62,66,70,74,78,83,87,91,95,99,103,107,111,116,120,124,128],I:[0,8,16,25,33,41,49,58,66,74,82,90,99,107,115,123,132,140,148,156,165,173,181,189,197,206,214,222,230,239,247,255]},rF={R:[0,10,136,255],G:[0,39,220,255],B:[0,223,253,255],A:[0,48,64,70],I:[0,92,192,255]},aF={R:[0,245,205,120,196,220,230,0,122,236,12,204,42,119,220,103,60,255,165,160,0,245,205,120,196,220,230,0,122,236,13,220,103,255,165,160,0,120,200,255,255,164,164,164,234,0,0,0,0,0],G:[0,245,62,18,58,248,148,118,186,13,48,182,204,159,216,255,60,165,42,32,200,245,62,18,58,248,148,118,186,13,48,216,255,165,42,32,200,190,70,148,148,108,108,108,169,0,0,0,0,0],B:[0,245,78,134,250,164,34,14,220,176,255,142,164,176,20,255,60,0,42,240,200,245,78,134,250,164,34,14,220,176,255,20,255,0,42,240,221,150,255,10,10,226,226,226,30,64,112,160,208,255],A:[0,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64],I:[0,2,3,4,5,7,8,10,11,12,13,14,15,16,17,18,24,26,28,30,31,41,42,43,44,46,47,49,50,51,52,53,54,58,60,62,63,72,77,78,79,80,81,82,85,251,252,253,254,255]},oF={R:[0,0,128,255,255],G:[0,128,0,128,255],B:[0,125,255,0,255],A:[0,32,64,96,128],I:[0,63,128,192,255]},lF={R:[0,142,227,255],G:[0,85,170,255],B:[0,14,76,255],A:[0,42,84,128],I:[0,85,170,255]},cF={R:[0,255],G:[0,255],B:[0,255],A:[0,128],I:[0,255]},uF={R:[0,0,0],G:[0,128,255],B:[0,0,0],A:[0,64,128],I:[0,128,255]},hF={R:[0,0,0],G:[72,72,255],B:[0,255,255],A:[0,64,128],I:[0,88,255]},dF={R:[0,255,255],G:[72,88,255],B:[0,0,0],A:[0,64,128],I:[0,88,255]},fF={R:[0,255,255,255],G:[0,0,126,255],B:[0,0,0,255],A:[0,64,96,128],I:[0,128,191,255]},mF={R:[3,255,255,255],G:[0,0,255,255],B:[0,0,0,255],A:[0,48,96,128],I:[0,95,191,255]},pF={R:[255,255,0,0,0,255,255],G:[0,255,255,255,0,0,0],B:[0,0,0,255,255,255,0],A:[0,14,28,43,57,71,85],I:[0,43,85,128,170,213,255]},gF={R:[0,120,237,240],G:[0,28,105,249],B:[4,109,37,33],A:[0,56,80,88],I:[0,64,192,255]},AF={R:[0,0,127,255,127],G:[0,127,255,127,0],B:[127,255,127,0,0],A:[0,32,64,96,128],I:[0,63,128,192,255]},vF={R:[0,255,255],G:[0,0,255],B:[0,0,0],A:[0,64,64],I:[0,86,255]},yF={R:[94,50,90,152,215,238,249,254,252,241,209,158],G:[79,131,186,214,240,244,237,210,157,100,57,1],B:[162,189,167,164,155,169,168,123,86,68,79,66],A:[0,12,23,35,47,58,70,81,93,105,116,128],I:[0,23,46,70,93,116,139,162,185,209,232,255]},xF={R:[3,7,13,25,45,67,84,98,110,124,138,154,173,191,210,225,233,233,231,229,230,235,243,253],G:[19,33,48,63,77,87,92,94,95,96,96,97,99,101,106,118,133,149,163,177,192,208,225,245],B:[38,58,79,99,114,122,122,120,117,113,110,105,101,97,94,96,103,112,122,134,149,169,192,218],A:[0,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64],I:[0,11,22,33,44,55,66,77,88,99,110,121,133,144,155,166,177,188,199,210,221,232,243,255]},bF={R:[0,148,183,223,247,252],G:[0,44,55,74,112,253],B:[4,128,121,104,92,191],A:[0,44,53,64,75,107],I:[0,107,128,154,179,255]},wF={R:[11,59,55,222],G:[4,45,165,245],B:[5,91,172,229],A:[0,23,70,107],I:[0,56,167,255]},SF={R:[3,5,6,8,12,19,28,36,42,48,54,61,68,76,86,96,110,129,154,181,205,224,239,252],G:[19,32,44,58,72,86,98,108,116,122,128,134,141,149,157,167,178,191,204,216,225,232,239,244],B:[39,60,82,104,123,137,144,145,142,138,134,130,126,121,116,110,105,104,112,131,155,178,198,217],A:[0,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64],I:[0,11,22,33,44,55,66,77,88,99,110,121,133,144,155,166,177,188,199,210,221,232,243,255]},CF={R:[0,85,0,0,0,0,0,0,85,255,255,255,172],G:[0,0,0,0,85,170,255,255,255,255,85,0,0],B:[0,170,85,255,255,170,170,0,85,0,0,0,0],A:[0,5,10,21,26,32,37,42,48,53,64,72,85],I:[0,15,31,63,79,95,111,127,143,159,191,217,255]},EF={R:[13,156,237,240],G:[8,23,121,249],B:[135,158,83,33],A:[0,56,80,88],I:[0,64,192,255]},TF={R:[208,71,33,192,32,195,208,173,233,202,25,210,145,89,87,245,246,38,3,25,57,167,245,86,227,208,81,64,90,199,140,48,212,180,70,120,9,192,245,177,65,157,9,193,100,181,125,145,62,8,108,36,140,237,242,248,161,189,41,114,65,121,97,50,238,149,44,214,124,167,40,167,127,178,231,30,173,244,193,203,204,238,139,135,71,234,234,217,66,14,129,19,97,165,112,244,35,73,192,12,149,71,33,192,32,195,208,173,233,202,25,210,145,89,87,245,246,38,3,25,57,167,245,86,227,208,81,64,90,199,140,48,212,180,70,120,9,192,245,177,65,157,9,193,100,181,125,145,62,8,108,36,140,237,242,248,161,189,41,114,65,121,97,50,238,149,44,214,124,167,40,167,127,178,231,30,173,244,193,203,204,238,139,135,71,234,234,217,66,14,129,19,97,165,112,244,35,73,192,12,149,71,33,192,32,195,208,173,233,202,25,210,145,89,87,245,246,38,3,25,57,167,245,86,227,208,81,64,90,199,140,48,212,180,70,120,9,192,245,177,65,157,9,193,100,181,125,145,62,8,108,36,140,237,242,248],G:[182,46,78,199,79,89,41,208,135,20,154,35,21,43,230,113,191,147,208,37,28,27,86,203,25,209,148,187,139,111,48,102,76,110,106,130,37,160,34,222,90,165,245,222,102,47,19,130,4,232,137,211,240,11,140,21,42,22,241,61,99,115,199,166,114,190,204,60,233,66,115,230,125,103,203,125,13,176,94,131,39,198,167,124,67,175,254,1,15,198,62,237,159,31,218,58,244,47,61,67,94,46,78,199,79,89,41,208,135,20,154,35,21,43,230,113,191,147,208,37,28,27,86,203,25,209,148,187,139,111,48,102,76,110,106,130,37,160,34,222,90,165,245,222,102,47,19,130,4,232,137,211,240,11,140,21,42,22,241,61,99,115,199,166,114,190,204,60,233,66,115,230,125,103,203,125,13,176,94,131,39,198,167,124,67,175,254,1,15,198,62,237,159,31,218,58,244,47,61,67,94,46,78,199,79,89,41,208,135,20,154,35,21,43,230,113,191,147,208,37,28,27,86,203,25,209,148,187,139,111,48,102,76,110,106,130,37,160,34,222,90,165,245,222,102,47,19,130,4,232,137,211,240,11,140,21],B:[191,154,43,10,207,204,164,231,136,58,239,30,147,230,101,111,150,35,128,57,252,79,173,120,25,126,81,85,8,7,122,237,190,152,246,182,130,219,67,76,167,178,235,250,28,61,186,250,199,67,58,50,86,182,108,77,89,112,59,125,226,50,205,227,125,128,104,27,59,66,53,133,159,203,97,125,139,159,158,7,215,47,140,226,223,231,44,110,184,61,233,47,67,148,22,120,173,156,117,181,94,154,43,10,207,204,164,231,136,58,239,30,147,230,101,111,150,35,128,57,252,79,173,120,25,126,81,85,8,7,122,237,190,152,246,182,130,219,67,76,167,178,235,250,28,61,186,250,199,67,58,50,86,182,108,77,89,112,59,125,226,50,205,227,125,128,104,27,59,66,53,133,159,203,97,125,139,159,158,7,215,47,140,226,223,231,44,110,184,61,233,47,67,148,22,120,173,156,117,181,94,154,43,10,207,204,164,231,136,58,239,30,147,230,101,111,150,35,128,57,252,79,173,120,25,126,81,85,8,7,122,237,190,152,246,182,130,219,67,76,167,178,235,250,28,61,186,250,199,67,58,50,86,182,108,77],A:[0,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64],I:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]},MF={R:[0,128,255],G:[0,0,0],B:[0,0,0],A:[0,64,128],I:[0,128,255]},DF={R:[192,224,255],G:[1,128,255],B:[0,0,0],A:[0,64,128],I:[0,128,255]},RF={R:[3,112,144,188,236,246,255],G:[5,31,29,22,76,158,250],B:[26,87,91,86,62,117,235],A:[0,30,38,49,67,85,107],I:[0,73,92,118,160,205,255]},NF={R:[1,240,255],G:[1,128,255],B:[1,128,255],A:[0,76,128],I:[0,153,255]},IF={R:[0,5,18,34,53,72,90,107,126,144,161,178,194,209,222,233,242,248,251,251,249,244,241,252],G:[0,4,10,11,9,11,17,23,30,36,43,50,59,70,83,98,117,136,157,177,199,220,240,254],B:[3,24,50,76,96,106,109,110,108,104,97,89,79,67,55,42,26,12,6,22,47,79,121,164],A:[0,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64],I:[0,11,22,33,44,55,66,77,88,99,110,121,133,144,155,166,177,188,199,210,221,232,243,255]},_F={R:[48,48,64,70,65,25,132,195,244,254,218,122],G:[18,18,64,107,150,226,255,241,199,158,57,4],B:[59,59,162,227,255,187,81,52,58,47,7,3],A:[0,22,26,30,34,43,52,57,63,67,77,86],I:[0,1,16,32,49,83,118,140,164,181,219,255]},FF={R:[0,128,255],G:[0,0,0],B:[0,128,255],A:[0,64,128],I:[0,128,255]},PF={R:[68,49,53,253],G:[1,104,183,231],B:[84,142,121,37],A:[0,56,80,88],I:[0,64,192,255]},BF={R:[255,255,255],G:[127,196,254],B:[0,0,0],A:[0,64,128],I:[0,128,255]},LF={R:[0,0,0],G:[0,128,255],B:[255,196,128],A:[0,64,128],I:[0,128,255]},kF={R:[3,64,0,0,255,255,255],G:[0,0,0,255,255,192,3],B:[0,32,48,56,64,96,128],A:[0,8,16,24,32,52,80],I:[0,32,64,96,160,192,255]},OF={min:0,max:0,R:[0,37],G:[242,0],B:[255,255],A:[0,64],I:[0,255]},UF={R:[255,255],G:[255,11],B:[0,0],A:[0,64],I:[0,255]},VF={min:0,max:0,R:[65,10,223,120,216,207,251,93,252,217,21,253,131,165,173,143,144,217,86,89,63,254,172,1,142,107,42,78,221,8,222,71,127,126,167,33,104,2,208,216,0,251,7,105,2,101,248,190,253,62,255,224,166,37,110,138,45,34,6,37,69,201,43,122,199,37,173,194,103,211,75,159,96,4,239,98,110,193,253,166,40,255,48,130,140,243,101,9,177,220,133,32,4,81,48,48,210,109,60,132,1,119,1,159,247,33,212,187,253,144,196,254,168,79,64,196,39,97,73,173,104,216,217,43,101,119,254,5,237,103,203,122,57,87,251,164,19,75,200,2,252,150,66,0,255,157,23,254,55,16,240,161,69,253,207,195,5,60,255,251,200,217,134,123,253,180,27,246,130,136,250,232,4,125,140,22,253,255,13,180,123,61,254,111,10,185,76,192,255,223,186,61,198,5,172,13,83,172,171,6,23,73,134,133,109,61,213,55,57,132,36,209,2,144,1,253,68,155,3,160,2,77,121,70,67,176,223,131,4,162,232,255,150,94,235,191,207,10,246,0,225,4,209,116,57,112,172,253,1,6,92,227,73,62,135,223],G:[162,50,112,245,4,124,176,243,56,125,183,139,182,68,189,4,225,10,20,223,7,46,31,193,225,250,219,41,2,100,83,181,34,150,72,223,168,248,80,253,7,117,214,2,248,10,3,59,179,160,90,244,146,4,207,4,125,255,96,100,1,208,130,51,116,181,236,53,244,5,165,28,181,86,96,42,254,1,134,194,214,92,41,204,137,86,207,3,143,3,100,239,164,94,65,251,131,244,173,57,143,107,217,53,210,0,148,250,45,198,81,40,61,218,252,88,171,0,248,24,248,4,41,100,187,46,208,145,43,168,121,46,175,250,125,107,233,112,207,231,174,215,53,9,43,153,52,124,128,65,210,147,255,147,63,200,148,254,0,179,241,42,239,2,230,8,82,135,87,16,3,87,86,151,254,8,255,86,53,19,7,192,171,201,253,247,197,103,251,126,0,149,54,183,61,126,79,113,10,103,184,75,11,195,222,136,149,131,8,99,240,177,252,255,198,16,7,68,178,66,191,150,73,26,211,109,78,209,240,254,1,166,247,131,2,0,167,127,133,10,43,99,235,3,214,142,176,82,132,38,10,249,255,215,44,81],B:[176,182,248,37,117,35,96,69,32,152,108,20,237,250,2,89,141,216,111,251,211,149,10,44,214,103,31,251,3,32,252,246,97,1,219,167,197,4,36,116,206,118,106,43,205,204,114,69,127,205,87,80,41,251,145,204,253,161,247,1,149,9,43,253,97,72,136,161,171,181,26,255,108,80,218,214,231,255,84,31,109,4,218,3,217,36,68,85,241,39,221,2,240,2,173,42,206,5,110,46,103,27,212,184,2,207,246,45,116,72,110,253,38,105,248,159,243,81,192,93,141,145,24,157,234,131,57,178,62,75,65,176,148,40,253,66,76,240,51,154,17,251,139,253,207,9,114,49,200,254,96,73,138,118,204,102,137,89,145,161,4,112,66,234,147,178,212,205,185,11,203,131,2,250,118,169,1,185,154,53,171,197,61,175,249,96,15,254,95,5,222,75,246,194,2,61,180,25,133,165,15,233,59,35,221,140,109,7,114,255,198,0,115,168,252,23,242,80,75,142,137,255,12,182,68,201,4,111,37,228,83,248,24,192,249,5,54,223,160,122,160,114,145,119,252,31,253,250,10,214,8,47,0,142,222,70],A:[0,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64],I:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]},jF=class{constructor(){G(this,"gamma",1),G(this,"version",.1),G(this,"cluts",{});const e=Object.keys(ud).filter(t=>!t.startsWith("$")).sort(new Intl.Collator("en").compare);for(const t of e)this.cluts[t]=ud[t]}addColormap(i,e){this.cluts[i]=e}colormaps(){return Object.keys(this.cluts)}colorMaps(){return this.colormaps()}colormapFromKey(i){let e=this.cluts[i];return e!==void 0||(e=this.cluts[i.toLowerCase()],e!==void 0)?e:(i.length>0&&X.warn("No color map named "+i),{min:0,max:0,R:[0,255],G:[0,255],B:[0,255],A:[0,255],I:[0,255]})}colormap(i="",e=!1){const t=this.colormapFromKey(i);return this.makeLut(t.R,t.G,t.B,t.A,t.I,e)}makeLabelLut(i,e=255,t=1/0){if(i.R===void 0||i.G===void 0||i.B===void 0)throw new Error(`Invalid colormap table: ${i}`);const n=i.R.length,s=i.I??[...Array(n).keys()];let r=!1;for(let p=0;p<s.length;p++)s[p]>t&&(r=!0,s[p]=t);if(r&&X.warn("Some colormap indices clamped to match label range."),n!==i.G.length||n!==i.B.length||n!==s.length)throw new Error(`colormap does not make sense: ${i} Rs ${i.R.length} Gs ${i.G.length} Bs ${i.B.length} Is ${s.length}`);let a=new Uint8ClampedArray(n).fill(e);a[0]=0,i.A!==void 0&&(a=Uint8ClampedArray.from(i.A));const l=Math.min(...s),c=Math.max(...s),h=c-l+1,d=new Uint8ClampedArray(h*4).fill(0);for(let p=0;p<n;p++){let g=(s[p]-l)*4;d[g++]=i.R[p],d[g++]=i.G[p],d[g++]=i.B[p],d[g++]=a[p]}const f={lut:d,min:l,max:c};if(i.labels){const p=i.labels.length;if(p===h)f.labels=i.labels;else if(p===n){f.labels=Array(h).fill("?");for(let g=0;g<n;g++){const y=s[g];f.labels[y]=i.labels[g]}}}return f}async makeLabelLutFromUrl(i,e=255,t=1/0){const s=await(await fetch(i)).json();return this.makeLabelLut(s,e,t)}makeDrawLut(i){let e=typeof i=="object"?i:ud[i];e===void 0&&(X.warn("colormap undefined ",i),e=this.colormapFromKey(""));const t=this.makeLabelLut(e,255);if(t.labels===void 0&&(t.labels=[]),t.labels.length<256){const a=t.labels.length;for(let l=a;l<256;l++)t.labels.push(l.toString())}const n=new Uint8ClampedArray(256*4);let s=0;for(let a=0;a<256;a++)n[s++]=255,n[s++]=0,n[s++]=0,n[s++]=255;n[3]=0;const r=Math.min(t.lut.length,256*4);if(r>0)for(let a=0;a<r;a++)n[a]=t.lut[a];return{lut:n,labels:t.labels}}makeLut(i,e,t,n,s,r){const a=i.length,l=[...i],c=[...e],h=[...t];if(!s){s=new Array(a);for(let g=0;g<a;g++)s[g]=g/(a-1)*255}n||(n=new Array(a).fill(64),n[0]=0);let d=Uint8ClampedArray.from(n),f=Uint8ClampedArray.from(s);if(r)for(let g=0;g<a;g++)l[g]=i[a-1-g],c[g]=e[a-1-g],h[g]=t[a-1-g],d[g]=255-n[a-1-g],f[g]=255-s[a-1-g];const p=new Uint8ClampedArray(256*4);if(typeof f>"u"){f=new Uint8ClampedArray(a).fill(0);for(let g=0;g<a;g++)f[g]=Math.round(g*255/(a-1))}typeof d>"u"&&(d=new Uint8ClampedArray(a).fill(64),d[0]=0);for(let g=0;g<a-1;g++){const y=f[g];let x=f[g+1];g===0&&y!==0&&X.warn("colormap issue: indices expected to start with 0 not ",y),g===f.length-2&&x!==255&&(X.warn("padding colormap: indices expected end with 255 not ",x),x=255);const b=x-y;let w=y*4;for(let S=y;S<=x;S++){const C=(S-y)/b;p[w++]=l[g]+C*(l[g+1]-l[g]),p[w++]=c[g]+C*(c[g+1]-c[g]),p[w++]=h[g]+C*(h[g+1]-h[g]),p[w++]=d[g]+C*(d[g+1]-d[g])}}if(this.gamma===1)return p;for(let g=0;g<1020;g++)g%4!==3&&(p[g]=Math.pow(p[g]/255,1/this.gamma)*255);return p}},yt=new jF,la=class{static getClusterBoundaryU8(i,e){const t=new Array(i.length).fill(!1),n=new Array(i.length).fill(!1);for(let a=0;a<i.length;a++)i[a]>0&&(n[a]=!0);const s=e.length/3;let r=0;for(let a=0;a<s;a++){const l=e[r],c=e[r+1],h=e[r+2];r+=3,!(n[l]===n[c]&&n[l]===n[h]&&n[c]===n[h])&&(t[l]=!0,t[c]=!0,t[h]=!0)}return t}static async gzip(i){const e=new CompressionStream("gzip"),t=e.writable.getWriter();t.write(i).catch(console.error);const n=t.close().catch(console.error),s=new Response(e.readable),r=new Uint8Array(await s.arrayBuffer());return await n,r}static createMZ3(i,e,t=!1,n=null,s=null,r=null){const p=e?e.length/3:0,g=i?i.length/3:0;if(!Number.isInteger(p)||p<0)throw new Error("indices length must be a multiple of 3");if(!Number.isInteger(g)||g<0)throw new Error("vertices length must be a multiple of 3");const y=e&&e.length>0,x=i&&i.length>0,b=n instanceof Uint8Array&&n.length===g*4;let w=null,S=0;if(r!=null){const U=typeof r=="string"?r:JSON.stringify(r);w=new TextEncoder().encode(U),S=w.byteLength}let C=!1,E=0;if(s!=null){if(!(s instanceof Float32Array))throw new Error("scalars must be a Float32Array or null/undefined");if(g===0)throw new Error("cannot have scalars without vertices (nvert === 0)");if(s.length>0&&s.length%g===0)C=!0,E=s.length/g;else throw new Error(`scalars.length (${s.length}) must be a positive integer multiple of nvert (${g})`)}let D=0;y&&(D|=1),x&&(D|=2),b&&(D|=4),C&&(D|=8),w&&(D|=64);const M=16,N=y?p*3*4:0,I=x?g*3*4:0,_=b?g*4:0,F=C?E*g*4:0,B=M+S+N+I+_+F,P=new ArrayBuffer(B),O=new DataView(P);let k=0;O.setUint16(k,23117,!0),k+=2,O.setUint16(k,D,!0),k+=2,O.setUint32(k,p,!0),k+=4,O.setUint32(k,g,!0),k+=4,O.setUint32(k,S,!0),k+=4;let q=M;if(S>0&&w&&(new Uint8Array(P,q,w.length).set(w),q+=S),y&&(new Uint32Array(P,q,e.length).set(e),q+=N),x&&(new Float32Array(P,q,i.length).set(i),q+=I),b&&(new Uint8Array(P,q,n.length).set(n),q+=_),C&&(new Float32Array(P,q,s.length).set(s),q+=F),q!==B)throw new Error(`mz3 internal size mismatch: offset ${q} !== totalSize ${B}`);if(t)throw new Error("Call async createMZ3Async() for compression");return P}static async createMZ3Async(i,e,t=!1,n=null,s=null,r=null){const a=this.createMZ3(i,e,t,n,s,r);return t?await this.gzip(new Uint8Array(a)):a}static createOBJ(i,e){let t="";for(let r=0;r<i.length;r+=3)t+=`v ${i[r]} ${i[r+1]} ${i[r+2]}
`;for(let r=0;r<e.length;r+=3)t+=`f ${e[r]+1} ${e[r+1]+1} ${e[r+2]+1}
`;return new TextEncoder().encode(t).buffer}static createSTL(i,e){const t=e.length/3,n=84+t*50,s=new ArrayBuffer(n),r=new DataView(s);for(let l=0;l<80;l++)r.setUint8(l,0);r.setUint32(80,t,!0);let a=84;for(let l=0;l<e.length;l+=3){const c=e[l]*3,h=e[l+1]*3,d=e[l+2]*3;r.setFloat32(a,0,!0),r.setFloat32(a+4,0,!0),r.setFloat32(a+8,0,!0),a+=12,r.setFloat32(a,i[c],!0),r.setFloat32(a+4,i[c+1],!0),r.setFloat32(a+8,i[c+2],!0),a+=12,r.setFloat32(a,i[h],!0),r.setFloat32(a+4,i[h+1],!0),r.setFloat32(a+8,i[h+2],!0),a+=12,r.setFloat32(a,i[d],!0),r.setFloat32(a+4,i[d+1],!0),r.setFloat32(a+8,i[d+2],!0),a+=12,r.setUint16(a,0,!0),a+=2}return s}static downloadArrayBuffer(i,e){const t=new Blob([i],{type:"application/octet-stream"}),n=URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.download=e,document.body.appendChild(s),s.style.display="none",s.click(),setTimeout(()=>{document.body.removeChild(s),URL.revokeObjectURL(n)},0)}static async saveMesh(i,e,t=".mz3",n=!1){let s=new ArrayBuffer(0);return/\.obj$/i.test(t)?s=this.createOBJ(i,e):/\.stl$/i.test(t)?s=this.createSTL(i,e):(/\.mz3$/i.test(t)||(t+=".mz3"),s=await this.createMZ3Async(i,e,n)),t.length>4&&this.downloadArrayBuffer(s,t),s}static getClusterBoundary(i,e){const t=new Uint32Array(i.buffer),n=new Array(t.length).fill(!1),s=e.length/3;let r=0;for(let a=0;a<s;a++){const l=e[r],c=e[r+1],h=e[r+2];r+=3,!(t[l]===t[c]&&t[l]===t[h]&&t[c]===t[h])&&(n[l]=!0,n[c]=!0,n[h]=!0)}return n}static getExtents(i){if(!ArrayBuffer.isView(i)&&!Array.isArray(i)||i.length<3)return{mxDx:0,extentsMin:0,extentsMax:0};let e=0;const t=Ae(i[0],i[1],i[2]),n=Ae(i[0],i[1],i[2]);for(let a=0;a<i.length;a+=3){const l=Ae(i[a],i[a+1],i[a+2]);e=Math.max(e,Oc(l)),t1(t,t,l),i1(n,n,l)}const s=[t[0],t[1],t[2]],r=[n[0],n[1],n[2]];return{mxDx:e,extentsMin:s,extentsMax:r}}static generateNormals(i,e){const t=[];let n;const s=i.length;let r,a,l,c,h,d,f,p,g;const y=new Float32Array(s),x=e.length;for(n=0;n<x;n+=3){f=e[n]*3,p=e[n+1]*3,g=e[n+2]*3;const b=[i[f],i[f+1],i[f+2]],w=[i[p],i[p+1],i[p+2]],S=[i[g],i[g+1],i[g+2]];r=w[0]-b[0],a=w[1]-b[1],l=w[2]-b[2],c=S[0]-b[0],h=S[1]-b[1],d=S[2]-b[2],t[0]=h*l-d*a,t[1]=d*r-c*l,t[2]=c*a-h*r,y[f]+=t[0],y[f+1]+=t[1],y[f+2]+=t[2],y[p]+=t[0],y[p+1]+=t[1],y[p+2]+=t[2],y[g]+=t[0],y[g+1]+=t[1],y[g+2]+=t[2]}for(n=0;n<s;n+=3){t[0]=-1*y[n],t[1]=-1*y[n+1],t[2]=-1*y[n+2];let b=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];b>0&&(b=1/Math.sqrt(b),t[0]*=b,t[1]*=b,t[2]*=b),y[n]=t[0],y[n+1]=t[1],y[n+2]=t[2]}return y}},Ue,en,hd,ag,cc,E3=class{constructor(i){yo(this,Ue),yo(this,en,0),yo(this,hd,[]),yo(this,ag,[]),yo(this,cc),Dr(this,Ue,new DataView(i)),this.read()}async extract(i){const e=new Uint8Array(Te(this,Ue).buffer.slice(i.startsAt,i.startsAt+i.compressedSize));if(i.compressionMethod===0)return e;if(i.compressionMethod===8){const t=new DecompressionStream("deflate-raw"),n=t.writable.getWriter();n.write(e).catch(console.error);const s=n.close().catch(console.error),r=new Response(t.readable),a=new Uint8Array(await r.arrayBuffer());return await s,a}throw new Error(`Unsupported compression method: ${i.compressionMethod}`)}read(){for(;!Te(this,cc)&&Te(this,en)<Te(this,Ue).byteLength;){const i=Te(this,Ue).getUint32(Te(this,en),!0);if(i===67324752){const e=this.readLocalFile(Te(this,en));e.extract=this.extract.bind(this,e),Te(this,hd).push(e);const t=(e.generalPurpose&8)!==0;if(e.startsAt=Te(this,en)+30+e.fileNameLength+e.extraLength,e.compressedSize===0&&t){let n=e.startsAt;for(;n+20<=Te(this,Ue).byteLength;){if(Te(this,Ue).getUint32(n,!0)===134695760&&Te(this,Ue).getUint16(n+16,!0)===19280){n+=4;break}n++}e.crc=Te(this,Ue).getUint32(n,!0),e.compressedSize=Te(this,Ue).getUint32(n+4,!0),e.uncompressedSize=Te(this,Ue).getUint32(n+8,!0),Dr(this,en,n+12)}else Dr(this,en,e.startsAt+e.compressedSize)}else if(i===33639248){const e=this.readCentralDirectory(Te(this,en));Te(this,ag).push(e),Dr(this,en,Te(this,en)+(46+e.fileNameLength+e.extraLength+e.fileCommentLength))}else if(i===101010256){Dr(this,cc,this.readEndCentralDirectory(Te(this,en)));break}else if(i===101075792){Dr(this,cc,this.readEndCentralDirectory64(Te(this,en)));break}else{console.error(`Unexpected ZIP signature 0x${i.toString(16).padStart(8,"0")} at index ${Te(this,en)}`);break}}}readLocalFile(i){let e=Te(this,Ue).getUint32(i+18,!0),t=Te(this,Ue).getUint32(i+22,!0);const n=Te(this,Ue).getUint16(i+26,!0),s=Te(this,Ue).getUint16(i+28,!0),r=i+30+n;if(this.readString(r,s),e===4294967295&&t===4294967295){let a=r,l=!1;for(;a<r+s-4;){const c=Te(this,Ue).getUint16(a,!0),h=Te(this,Ue).getUint16(a+2,!0);if(a+=4,c===1)if(h>=16){t=Number(Te(this,Ue).getBigUint64(a,!0)),a+=8,e=Number(Te(this,Ue).getBigUint64(a,!0)),l=!0;break}else throw new Error(`ZIP64 extra field found but is too small (expected at least 16 bytes, got ${h}).`);a+=h}if(!l)throw new Error("ZIP64 format missing extra field with signature 0x0001.")}return{signature:this.readString(i,4),version:Te(this,Ue).getUint16(i+4,!0),generalPurpose:Te(this,Ue).getUint16(i+6,!0),compressionMethod:Te(this,Ue).getUint16(i+8,!0),lastModifiedTime:Te(this,Ue).getUint16(i+10,!0),lastModifiedDate:Te(this,Ue).getUint16(i+12,!0),crc:Te(this,Ue).getUint32(i+14,!0),compressedSize:e,uncompressedSize:t,fileNameLength:n,extraLength:s,fileName:this.readString(i+30,n),extra:this.readString(i+30+n,s)}}readCentralDirectory(i){return{versionCreated:Te(this,Ue).getUint16(i+4,!0),versionNeeded:Te(this,Ue).getUint16(i+6,!0),fileNameLength:Te(this,Ue).getUint16(i+28,!0),extraLength:Te(this,Ue).getUint16(i+30,!0),fileCommentLength:Te(this,Ue).getUint16(i+32,!0),diskNumber:Te(this,Ue).getUint16(i+34,!0),internalAttributes:Te(this,Ue).getUint16(i+36,!0),externalAttributes:Te(this,Ue).getUint32(i+38,!0),offset:Te(this,Ue).getUint32(i+42,!0),comments:this.readString(i+46,Te(this,Ue).getUint16(i+32,!0))}}readEndCentralDirectory(i){const e=Te(this,Ue).getUint16(i+20,!0);return{numberOfDisks:Te(this,Ue).getUint16(i+4,!0),centralDirectoryStartDisk:Te(this,Ue).getUint16(i+6,!0),numberCentralDirectoryRecordsOnThisDisk:Te(this,Ue).getUint16(i+8,!0),numberCentralDirectoryRecords:Te(this,Ue).getUint16(i+10,!0),centralDirectorySize:Te(this,Ue).getUint32(i+12,!0),centralDirectoryOffset:Te(this,Ue).getUint32(i+16,!0),commentLength:e,comment:this.readString(i+22,e)}}readEndCentralDirectory64(i){const e=Number(Te(this,Ue).getBigUint64(i+0,!0));return{numberOfDisks:Te(this,Ue).getUint32(i+16,!0),centralDirectoryStartDisk:Te(this,Ue).getUint32(i+20,!0),numberCentralDirectoryRecordsOnThisDisk:Number(Te(this,Ue).getBigUint64(i+24,!0)),numberCentralDirectoryRecords:Number(Te(this,Ue).getBigUint64(i+32,!0)),centralDirectorySize:Number(Te(this,Ue).getBigUint64(i+40,!0)),centralDirectoryOffset:Number(Te(this,Ue).getBigUint64(i+48,!0)),commentLength:e,comment:""}}readString(i,e){return Array.from({length:e},(t,n)=>String.fromCharCode(Te(this,Ue).getUint8(i+n))).join("")}get entries(){return Te(this,hd)}};Ue=new WeakMap;en=new WeakMap;hd=new WeakMap;ag=new WeakMap;cc=new WeakMap;var Ve=class xo{static arrayBufferToBase64(e){const t=new Uint8Array(e);return xo.uint8tob64(t)}static async decompress(e){const t=e[0]===31&&e[1]===139&&e[2]===8?"gzip":e[0]===120&&(e[1]===1||e[1]===94||e[1]===156||e[1]===218)?"deflate":"deflate-raw",n=new DecompressionStream(t),s=n.writable.getWriter();s.write(e).catch(console.error);const r=s.close().catch(console.error),a=new Response(n.readable),l=new Uint8Array(await a.arrayBuffer());return await r,l}static async decompressToBuffer(e){const t=await xo.decompress(e);return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}static async readMatV4(e,t=!1){let n=e.byteLength;if(n<40)throw new Error("File too small to be MAT v4: bytes = "+e.byteLength);let s=new DataView(e),r=s.getUint16(0,!0),a=e;if(r===35615||r===8075){const y=await this.decompress(new Uint8Array(e));s=new DataView(y.buffer),r=s.getUint16(0,!0),a=y.buffer,n=a.byteLength}const l=new TextDecoder("utf-8"),c=new Uint8Array(a);let h=0;const d={};function f(y){return Math.floor(y/10)%10}function p(y,x,b){const w=new Uint8Array(c.subarray(x,b));return y===1?new Float32Array(w.buffer):y===2?new Int32Array(w.buffer):y===3?new Int16Array(w.buffer):y===4?new Uint16Array(w.buffer):y===5?new Uint8Array(w.buffer):new Float64Array(w.buffer)}function g(){const y=s.getUint32(h,!0),x=s.getUint32(h+4,!0),b=s.getUint32(h+8,!0),w=s.getUint32(h+12,!0),S=s.getUint32(h+16,!0);if(h+=20,w!==0)throw new Error("Matlab V4 reader does not support imaginary numbers");const C=x*b;if(C<1)throw new Error("mrows * ncols must be greater than one");const E=new Uint8Array(c.subarray(h,h+S));let D=l.decode(E).trim().replaceAll("\0","");t&&(D=D.replaceAll(".","_"));const M=f(y);let N=8;if(M>=1&&M<=2)N=4;else if(M>=3&&M<=4)N=2;else if(M===5)N=1;else if(M!==0)throw new Error("impossible Matlab v4 datatype");if(h+=S,y>50)throw new Error("Does not appear to be little-endian V4 Matlab file");const I=h+C*N;d[D]=p(M,h,I),h=I}for(;h+20<n;)g();return d}static b64toUint8(e){const t=atob(e),n=t.length,s=new Uint8Array(n);for(let r=0;r<n;r++)s[r]=t.charCodeAt(r);return s}static uint8tob64(e){let t="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=e.byteLength,r=s%3,a=s-r;let l,c,h,d,f;for(let p=0;p<a;p=p+3)f=e[p]<<16|e[p+1]<<8|e[p+2],l=(f&16515072)>>18,c=(f&258048)>>12,h=(f&4032)>>6,d=f&63,t+=n[l]+n[c]+n[h]+n[d];return r===1?(f=e[a],l=(f&252)>>2,c=(f&3)<<4,t+=n[l]+n[c]+"=="):r===2&&(f=e[a]<<8|e[a+1],l=(f&64512)>>10,c=(f&1008)>>4,h=(f&15)<<2,t+=n[l]+n[c]+n[h]+"="),t}static download(e,t,n){const s=document.createElement("a"),r=Array.isArray(e)?e:[e],a=new Blob(r,{type:n});s.href=URL.createObjectURL(a),s.download=t,s.click()}static readFileAsync(e){return new Promise((t,n)=>{const s=new FileReader;s.onload=()=>{t(s.result)},s.onerror=n,s.readAsArrayBuffer(e)})}static blobToBase64(e){return new Promise(t=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.readAsDataURL(e)})}static async decompressBase64String(e){const t=atob(e),n=new ArrayBuffer(t.length),s=new Uint8Array(n);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return xo.decompressArrayBuffer(s)}static async compressToBase64String(e){const t=await xo.compressStringToArrayBuffer(e);return xo.uint8tob64(new Uint8Array(t))}static strToU8(e,t){if(t){const c=new Uint8Array(e.length);for(let h=0;h<e.length;++h)c[h]=e.charCodeAt(h);return c}const n=e.length,s=(c,h,d)=>((d==null||d>c.length)&&(d=c.length),new Uint8Array(c.subarray(h,d)));let r=new Uint8Array(e.length+(e.length>>1)),a=0;const l=c=>{r[a++]=c};for(let c=0;c<n;++c){if(a+5>r.length){const d=new Uint8Array(a+8+(n-c<<1));d.set(r),r=d}let h=e.charCodeAt(c);h<128||t?l(h):h<2048?(l(192|h>>6),l(128|h&63)):(h>55295&&h<57344,h=65536+(h&1047552)|e.charCodeAt(++c)&1023,l(240|h>>18),l(128|h>>12&63),l(128|h>>6&63),l(128|h&63))}return s(r,0,a)}static async compress(e,t="gzip"){const n=new CompressionStream(t),s=n.writable.getWriter();s.write(e).catch(console.error);const r=s.close().catch(console.error),l=await new Response(n.readable).arrayBuffer();return await r,l}static async compressStringToArrayBuffer(e){const t=this.strToU8(e);return await this.compress(t)}static isArrayBufferCompressed(e){if(e&&e.byteLength){const t=new Uint8Array(e);return(t[0]<<8|t[1])===8075}else return!1}static strFromU8(e,t){if(t){let n="";for(let s=0;s<e.length;s+=16384)n+=String.fromCharCode.apply(null,e.subarray(s,s+16384));return n}else{const n=(l,c,h)=>((c==null||c<0)&&(c=0),(h==null||h>l.length)&&(h=l.length),new Uint8Array(l.subarray(c,h))),s=l=>{for(let c="",h=0;;){let d=l[h++];const f=(d>127)+(d>223)+(d>239);if(h+f>l.length)return{s:c,r:n(l,h-1)};f?f===3?(d=((d&15)<<18|(l[h++]&63)<<12|(l[h++]&63)<<6|l[h++]&63)-65536,c+=String.fromCharCode(55296|d>>10,56320|d&1023)):f&1?c+=String.fromCharCode((d&31)<<6|l[h++]&63):c+=String.fromCharCode((d&15)<<12|(l[h++]&63)<<6|l[h++]&63):c+=String.fromCharCode(d)}},{s:r,r:a}=s(e);if(a.length)throw new Error("Unexpected trailing bytes in UTF-8 decoding");return r}}static async decompressArrayBuffer(e){const t=await this.decompress(new Uint8Array(e));return this.strFromU8(t)}static arraysAreEqual(e,t){return KN(e,t)}static range(e,t,n){return Array.from({length:(t-e)/n+1},(s,r)=>e+r*n)}static sph2cartDeg(e,t){const n=-t*(Math.PI/180),s=(e-90)%360*(Math.PI/180),r=[Math.cos(n)*Math.cos(s),Math.cos(n)*Math.sin(s),Math.sin(n)],a=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);return a<=0||(r[0]/=a,r[1]/=a,r[2]/=a),r}static vox2mm(e,t){const n=Qt(t);sn(n,n);const s=Lt(e[0],e[1],e[2],1);return Pi(s,s,n),Ae(s[0],s[1],s[2])}},$l=X,Ut=class oi{static readTRACT(e){const t=e.byteLength;if(t<20)throw new Error("File too small to be niml.tract: bytes = "+t);const n=new DataView(e),s=new Uint8Array(e);let r=0;function a(){for(;r<t&&s[r]!==60;)r++;const x=r;for(;r<t&&s[r]!==62;)r++;return r++,r-x<1?"":new TextDecoder().decode(e.slice(x,r-1)).trim()}let l=a();function c(x){const b=l.indexOf(x);if(b<0)return 0;const w=l.indexOf('"',b)+1,S=l.indexOf('"',w),C=l.slice(w,S);return parseInt(C)}const h=c("N_tracts=");(!l.startsWith("<network")||h<1)&&X.warn("This is not a valid niml.tract file "+l);let d=0;const f=[];f.push(d);const p=[],g=[];for(let x=0;x<h;x++){l=a();const b=c("ni_dimen="),w=c("Bundle_Tag="),S=l.includes("binary.lsbfirst");for(let C=0;C<b;C++){r+=4;const E=n.getUint32(r,S)/3;r+=4;for(let D=0;D<E;D++)p.push(n.getFloat32(r,S)),r+=4,p.push(-n.getFloat32(r,S)),r+=4,p.push(n.getFloat32(r,S)),r+=4;d+=E,f.push(d),g.push(w)}l=a()}const y=[];return y.push({id:"tract",vals:Float32Array.from(g)}),{pts:new Float32Array(p),offsetPt0:new Uint32Array(f),dps:y}}static async readTT(e){let t=new Uint32Array(0),n=new Float32Array(0);const s=await Ve.readMatV4(e);if(!("trans_to_mni"in s))throw new Error("TT format file must have 'trans_to_mni'");if(!("voxel_size"in s))throw new Error("TT format file must have 'voxel_size'");if(!("track"in s))throw new Error("TT format file must have 'track'");let r=it();const a=s.trans_to_mni;r=Vn(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]),sn(r,r);function l(c){const h=new DataView(c.buffer),d=[];let f=0,p=0;for(;p<c.length;){d.push(p);const x=h.getUint32(p,!0);p=p+x+13,f+=x}t=new Uint32Array(d.length+1),n=new Float32Array(f);let g=0;for(let x=0;x<d.length;x++){t[x]=g/3;let b=d[x];const w=h.getUint32(b,!0)/3;let S=h.getInt32(b+4,!0),C=h.getInt32(b+8,!0),E=h.getInt32(b+12,!0);b+=16,n[g++]=S,n[g++]=C,n[g++]=E;for(let D=2;D<=w;D++)S=S+h.getInt8(b++),C=C+h.getInt8(b++),E=E+h.getInt8(b++),n[g++]=S,n[g++]=C,n[g++]=E}for(let x=0;x<g;x++)n[x]=n[x]/32;let y=0;for(let x=0;x<g/3;x++){const b=Lt(n[y],n[y+1],n[y+2],1);Pi(b,b,r),n[y++]=b[0],n[y++]=b[1],n[y++]=b[2]}t[d.length]=g/3}return l(s.track),{pts:n,offsetPt0:t}}static assembleDpgFromMap(e,t){if(!Array.isArray(t)||t.length===0)throw new Error('assembleDpgFromMap: "groups" is empty or missing; cannot assemble dpg.');for(let c=0;c<t.length;c++){const h=String(t[c].id);if(!e[h])throw new Error(`assembleDpgFromMap: missing dpgMap entry for group "${h}".`);if(!Array.isArray(e[h]))throw new Error(`assembleDpgFromMap: dpgMap["${h}"] is not an array.`)}const n=String(t[0].id),s=e[n],r=[],a=new Set;for(const c of s){if(!c||typeof c.id!="string")throw new Error(`assembleDpgFromMap: invalid entry in group "${n}".`);if(a.has(c.id))throw new Error(`assembleDpgFromMap: duplicate tag "${c.id}" in group "${n}".`);a.add(c.id),r.push(c.id)}if(a.size===0)throw new Error(`assembleDpgFromMap: no tags found in group "${n}".`);for(let c=1;c<t.length;c++){const h=String(t[c].id),d=e[h],f=new Map;for(const p of d){if(!p||typeof p.id!="string")throw new Error(`assembleDpgFromMap: invalid entry in group "${h}".`);f.set(p.id,(f.get(p.id)||0)+1)}for(const[p,g]of f.entries())if(g>1)throw new Error(`assembleDpgFromMap: multiple entries for tag "${p}" in group "${h}".`);if(f.size!==a.size)throw new Error(`assembleDpgFromMap: tag coverage mismatch for group "${h}". Expected ${a.size} tags but found ${f.size}.`);for(const p of a)if(!f.has(p))throw new Error(`assembleDpgFromMap: group "${h}" missing tag "${p}".`)}const l=[];for(const c of r){const h=[];let d=0;for(let g=0;g<t.length;g++){const y=String(t[g].id),b=e[y].filter(S=>S.id===c);if(b.length===0)throw new Error(`assembleDpgFromMap: missing tag "${c}" for group "${y}".`);if(b.length>1)throw new Error(`assembleDpgFromMap: multiple entries for tag "${c}" in group "${y}".`);const w=b[0];if(w.vals instanceof Float32Array)h.push(w.vals),d+=w.vals.length;else try{const S=Float32Array.from(w.vals);h.push(S),d+=S.length}catch{throw new Error(`assembleDpgFromMap: invalid vals for tag "${c}" in group "${y}".`)}}const f=new Float32Array(d);let p=0;for(const g of h)f.set(g,p),p+=g.length;l.push({id:c,vals:f})}return l}static async readTRX(e){function t(x){const b=(x&31744)>>10,w=x&1023;return(x>>15?-1:1)*(b?b===31?w?NaN:1/0:Math.pow(2,b-15)*(1+w/1024):6103515625e-14*(w/1024))}let n=0,s=0,r=new Float32Array([]);const a=[],l={},c=[],h=[],d=[];let f=[],p=!1;const g=new E3(e);for(let x=0;x<g.entries.length;x++){const b=g.entries[x];if(b.uncompressedSize===0)continue;const w=b.fileName.split("/"),S=w.slice(-1)[0];if(S.startsWith("."))continue;const C=w.slice(-3)[0],E=w.slice(-2)[0],D=S.split(".")[0],M=await b.extract();if(S.includes("header.json")){const _=new TextDecoder().decode(M);f=JSON.parse(_);continue}let N=0,I=[];if(S.endsWith(".uint64")||S.endsWith(".int64")){N=M.length/8,I=new Uint32Array(N);const _=new Uint32Array(M.buffer);let F=0;for(let B=0;B<N;B++)I[B]=_[F],_[F+1]!==0&&(p=!0),F+=2}else if(S.endsWith(".uint32"))I=new Uint32Array(M.buffer);else if(S.endsWith(".uint16"))I=new Uint16Array(M.buffer);else if(S.endsWith(".uint8"))I=new Uint8Array(M.buffer);else if(S.endsWith(".int32"))I=new Int32Array(M.buffer);else if(S.endsWith(".int16"))I=new Int16Array(M.buffer);else if(S.endsWith(".int8"))I=new Int8Array(M.buffer);else if(S.endsWith(".float64"))I=new Float64Array(M.buffer);else if(S.endsWith(".float32"))I=new Float32Array(M.buffer);else if(S.endsWith(".float16")){N=M.length/2,I=new Float32Array(N);const _=new Uint16Array(M.buffer),F=new Float32Array(65536);for(let B=0;B<65536;B++)F[B]=t(B);for(let B=0;B<N;B++)I[B]=F[_[B]]}else continue;if(N=I.length,E.includes("groups")){c.push({id:D,vals:Float32Array.from(I.slice())});continue}if(C.includes("dpg")){const _=String(E);l[_]||(l[_]=[]),l[_].push({id:D,vals:Float32Array.from(I.slice())});continue}if(E.includes("dpv")){d.push({id:D,vals:Float32Array.from(I.slice())});continue}if(E.includes("dps")){h.push({id:D,vals:Float32Array.from(I.slice())});continue}if(S.startsWith("offsets.")){n=N;for(let _=0;_<N;_++)a[_]=I[_]}S.startsWith("positions.3.")&&(s=N,r=new Float32Array(I))}if(n===0||s===0)throw new Error("Failure reading TRX format (no offsets or points).");if(p)throw new Error("Too many vertices: JavaScript does not support 64 bit integers");let y=[];return c.length>0&&l&&Object.keys(l).length>0&&(y=this.assembleDpgFromMap(l,c)),a[n]=s/3,{pts:r,offsetPt0:new Uint32Array(a),dpg:y,dps:h,dpv:d,groups:c,header:f}}static readTXT(e,t=0){const s=new TextDecoder("utf-8").decode(e).split(/\r?\n|\r/).filter(a=>a.trim().length>0);t<=0&&(t=s.length);const r=new Float32Array(t);for(let a=0;a<t&&a<s.length;a++){const l=parseFloat(s[a].trim());r[a]=Number.isFinite(l)?l:0}return r}static readTSF(e,t=0){const n=new Float32Array(t),s=e.byteLength;if(s<20)throw new Error("File too small to be TSF: bytes = "+s);const r=new Uint8Array(e);let a=0;function l(){for(;a<s&&r[a]===10;)a++;const p=a;for(;a<s&&r[a]!==10;)a++;return a++,a-p<1?"":new TextDecoder().decode(e.slice(p,a-1))}let c=l();if(!c.includes("mrtrix track scalars"))throw new Error("Not a valid TSF file");let h=-1;for(;a<s&&!c.includes("END");)if(c=l(),c.toLowerCase().startsWith("file:")&&(h=parseInt(c.split(" ").pop())),c.toLowerCase().startsWith("datatype:")&&!c.endsWith("Float32LE"))throw new Error("Only supports TSF files with Float32LE");if(h<20)throw new Error("Not a valid TSF file (missing file offset)");a=h;const d=new DataView(e);let f=0;for(;a+4<=s&&f<t;){const p=d.getFloat32(a,!0);if(a+=4,isFinite(p))n[f++]=p;else if(!isNaN(p))break}return n}static readTCK(e){const t=e.byteLength;if(t<20)throw new Error("File too small to be TCK: bytes = "+t);const n=new Uint8Array(e);let s=0;function r(){for(;s<t&&n[s]===10;)s++;const y=s;for(;s<t&&n[s]!==10;)s++;return s++,s-y<1?"":new TextDecoder().decode(e.slice(y,s-1))}let a=r();if(!a.includes("mrtrix tracks"))throw new Error("Not a valid TCK file");let l=-1;for(;s<t&&!a.includes("END");)a=r(),a.toLowerCase().startsWith("file:")&&(l=parseInt(a.split(" ").pop()));if(l<20)throw new Error("Not a valid TCK file (missing file offset)");s=l;const c=new DataView(e);let h=0,d=new Uint32Array(t/16),f=0,p=0,g=new Float32Array(t/4);for(d[0]=0;s+12<t;){const y=c.getFloat32(s,!0);s+=4;const x=c.getFloat32(s,!0);s+=4;const b=c.getFloat32(s,!0);if(s+=4,isFinite(y))g[p++]=y,g[p++]=x,g[p++]=b,h++;else if(d[f++]=h,!isNaN(y))break}return g=g.slice(0,p),d=d.slice(0,f),{pts:g,offsetPt0:d}}static async readTRK(e){let t=new DataView(e),n=t.getUint32(0,!0);if(n!==1128354388){let B;if(n===4247762216)throw new Error("zstd TRK decompression is not supported");B=await Ve.decompress(new Uint8Array(e)),e=B.buffer,t=new DataView(e),n=t.getUint32(0,!0)}const s=t.getUint32(992,!0),r=t.getUint32(996,!0);if(s>2||r!==1e3||n!==1128354388)throw new Error("Not a valid TRK file");const a=t.getInt16(36,!0),l=[];for(let B=0;B<a;B++){const P=new Uint8Array(e.slice(38+B*20,58+B*20)),O=new TextDecoder().decode(P).split("\0").shift();l.push({id:O.trim(),vals:[]})}const c=t.getFloat32(12,!0),h=t.getFloat32(16,!0),d=t.getFloat32(20,!0),f=Vn(1/c,0,0,-.5,0,1/h,0,-.5,0,0,1/d,-.5,0,0,0,1),p=t.getInt16(238,!0),g=[];for(let B=0;B<p;B++){const P=new Uint8Array(e.slice(240+B*20,260+B*20)),O=new TextDecoder().decode(P).split("\0").shift();g.push({id:O.trim(),vals:[]})}const y=it();for(let B=0;B<16;B++)y[B]=t.getFloat32(440+B*4,!0);y[15]===0&&(X.warn("TRK vox_to_ras not set"),$5(y));const x=it();t3(x,f,y);let b=null,w=null;b=new Int32Array(e.slice(r)),w=new Float32Array(b.buffer);const S=b.length;if(S<1)throw new Error("Empty TRK file.");let C=0,E=0,D=new Uint32Array(b.length/4),M=0,N=new Float32Array(b.length),I=0;for(;C<S;){const B=b[C];C=C+1,D[M++]=E;for(let P=0;P<B;P++){const O=w[C+0],k=w[C+1],q=w[C+2];if(C+=3,N[I++]=O*x[0]+k*x[1]+q*x[2]+x[3],N[I++]=O*x[4]+k*x[5]+q*x[6]+x[7],N[I++]=O*x[8]+k*x[9]+q*x[10]+x[11],a>0)for(let U=0;U<a;U++)l[U].vals.push(w[C]),C++;E++}if(p>0)for(let P=0;P<p;P++)g[P].vals.push(w[C]),C++}const _=[];for(let B=0;B<g.length;B++)_.push({id:g[B].id,vals:Float32Array.from(g[B].vals)});const F=[];for(let B=0;B<l.length;B++)F.push({id:l[B].id,vals:Float32Array.from(l[B].vals)});return D[M++]=E,N=N.slice(0,I),D=D.slice(0,M),{pts:N,offsetPt0:D,dps:_,dpv:F}}static readTxtVTK(e){const s=new TextDecoder("utf-8").decode(e).split(`
`);if(s.length<7||!s[0].startsWith("# vtk DataFile"))throw new Error("Invalid VTK image");if(!s[2].startsWith("ASCII"))throw new Error("Not ASCII VTK mesh");let a=3;for(;s[a].length<1;)a++;if(!s[a].includes("POLYDATA"))throw new Error("Not ASCII VTK polydata");for(a++;s[a].length<1;)a++;if(!s[a].startsWith("POINTS"))throw new Error("Not VTK POINTS");let l=s[a].trim().split(/\s+/);const c=parseInt(l[1]),h=c*3,d=new Float32Array(c*3);let f=0;for(;f<c*3;){a++;const x=s[a].trim().trim().split(/\s+/);for(let b=0;b<x.length&&!(f>=h);b++)d[f]=parseFloat(x[b]),f++}const p=[];for(a++;s[a].length<1;)a++;if(s[a].startsWith("METADATA")){for(;s[a].length>1;)a++;a++}if(l=s[a].trim().split(/\s+/),a++,l[0].includes("LINES")){const y=parseInt(l[1]);if(y<1)throw new Error("Corrupted VTK ASCII");let x=s[a].trim();const b=[];let w=[];if(x.startsWith("OFFSETS")){a++;let S=0;for(;S<y;){x=s[a].trim(),a++;const C=x.trim().split(/\s+/);for(let E=0;E<C.length&&(b[S]=parseInt(C[E]),S++,!(S>=y));E++);}w=Array.from(d)}else{let S=function(){x=s[a].trim();const M=x.trim().split(/\s+/);E=[];for(let N=0;N<M.length;N++)E.push(parseInt(M[N]));D=0,a++},C=0;b[0]=0;let E=[],D=0;S();for(let M=0;M<y;M++){D>=E.length&&S();const N=E[D++];C+=N,b[M+1]=C;for(let I=0;I<N;I++){D>=E.length&&S();const _=E[D++]*3;w.push(d[_+0]),w.push(d[_+1]),w.push(d[_+2])}}}return{pts:Float32Array.from(w),offsetPt0:Uint32Array.from(b)}}else if(l[0].includes("TRIANGLE_STRIPS")){const y=parseInt(l[1]);for(let x=0;x<y;x++){const b=s[a].trim();a++;const w=b.trim().split(/\s+/),S=parseInt(w[0])-2;let C=1;for(let E=0;E<S;E++)E%2?(p.push(parseInt(w[C+2])),p.push(parseInt(w[C+1])),p.push(parseInt(w[C]))):(p.push(parseInt(w[C])),p.push(parseInt(w[C+1])),p.push(parseInt(w[C+2]))),C+=1}}else if(l[0].includes("POLYGONS")){const y=parseInt(l[1]);for(let x=0;x<y;x++){const b=s[a].trim();a++;const w=b.trim().split(/\s+/),S=parseInt(w[0])-2,C=parseInt(w[1]);let E=parseInt(w[2]);for(let D=0;D<S;D++){const M=parseInt(w[3+D]);p.push(C),p.push(E),p.push(M),E=M}}}else throw new Error("Unsupported ASCII VTK datatype "+l[0]);const g=new Uint32Array(p);return{positions:d,indices:g}}static async readLayer(e="",t,n,s=.5,r="warm",a="winter",l=!1,c=null,h=null,d=0){const f={...YP,colormapInvert:!1,colormapType:0,isTransparentBelowCalMin:!0,isAdditiveBlend:!1,colorbarVisible:!0,colormapLabel:null},p=/(?:\.([^.]+))?$/;let g=p.exec(e)[1];g=g.toUpperCase(),g==="GZ"&&(g=p.exec(e.slice(0,-3))[1],g=g.toUpperCase());const y=n.vertexCount/3;if(n.offsetPt0){const w=e.split("/");let S="Unknown";if(w.length>1&&w.pop()&&(S=S.split(".").slice(0,-1).join(".")),g==="TXT"){const N=n.offsetPt0.length-1,I=oi.readTXT(t,N);if(I.length!==N)throw new Error(`TXT file has ${I.length} items, expected one per streamline (${N}).`);n.dps||(n.dps=[]);const _=I.reduce((B,P)=>Math.min(B,P)),F=I.reduce((B,P)=>Math.max(B,P));return n.dps.push({id:S,vals:Float32Array.from(I.slice()),global_min:_,global_max:F,cal_min:_,cal_max:F}),f}if(g==="NII"){const N=await oi.readNII(t,n.pts,""),I=N.reduce((F,B)=>Math.min(F,B)),_=N.reduce((F,B)=>Math.max(F,B));return n.dpv.push({id:S,vals:Float32Array.from(N.slice()),global_min:I,global_max:_,cal_min:I,cal_max:_}),f}if(g!=="TSF")throw new Error("readLayer for streamlines only supports TSF and TXT files.");const C=n.pts.length/3,E=oi.readTSF(t,C);n.dpv||(n.dpv=[]);const D=E.reduce((N,I)=>Math.min(N,I)),M=E.reduce((N,I)=>Math.max(N,I));return n.dpv.push({id:S,vals:Float32Array.from(E.slice()),global_min:D,global_max:M,cal_min:D,cal_max:M}),f}if(y<3){X.error("n_vert < 3 in layer");return}if(g==="MZ3"){const w=await oi.readMZ3(t,y);f.values=w.scalars,"colormapLabel"in w&&(f.colormapLabel=w.colormapLabel)}else if(g==="ANNOT"){const w=oi.readANNOT(t,y,!0);w instanceof Uint32Array?f.values=w:(f.values=w.scalars,f.colormapLabel=w.colormapLabel)}else if(g==="CRV"||g==="CURV"||g==="THICKNESS"||g==="AREA")f.values=oi.readCURV(t,y),f.isTransparentBelowCalMin=!1;else if(g==="GII"){const w=await oi.readGII(t,y);f.values=w.scalars,f.colormapLabel=w.colormapLabel}else if(g==="MGH"||g==="MGZ"){const w=await oi.readMGH(t,y,!0);"scalars"in w?(f.values=w.scalars,f.colormapLabel=w.colormapLabel):f.values=w}else if(g==="NII")f.values=await oi.readNII(t,n.pts,n.anatomicalStructurePrimary);else if(g==="SMP")f.values=await oi.readSMP(t,y);else if(g==="STC")f.values=oi.readSTC(t,y);else if(oi.isCurv(t))f.values=oi.readCURV(t,y),f.isTransparentBelowCalMin=!1;else return X.warn("Unknown layer overlay format "+e),f;if(!f.values){X.error("no values in layer");return}f.nFrame4D=f.values.length/y,f.frame4D=0,f.outlineBorder=d;let x=f.values[0],b=f.values[0];for(let w=0;w<f.values.length;w++)x=Math.min(x,f.values[w]),b=Math.max(b,f.values[w]);return f.global_min=x,f.global_max=b,f.cal_min=c||0,c||(f.cal_min=x),f.cal_max=h||0,h||(f.cal_max=b),f.cal_minNeg=NaN,f.cal_maxNeg=NaN,f.opacity=s,f.colormap=r,f.colormapNegative=a,f.useNegativeCmap=l,f}static async readSMP(e,t){const n=e.byteLength;let s=new DataView(e),r=s.getUint16(0,!0);if(r>5){const f=await Ve.decompress(new Uint8Array(e));s=new DataView(f.buffer),r=s.getUint16(0,!0),e=f.buffer}r>5&&X.error("Unsupported or invalid BrainVoyager SMP version "+r);const a=s.getUint32(2,!0);a!==t&&X.error("SMP file has "+a+" vertices, background mesh has "+t);const l=s.getUint16(6,!0),c=new Float32Array(a*l);let h=9;function d(){const f=h;for(;h<n&&s.getUint8(h)!==0;)h++;return h++,new TextDecoder().decode(e.slice(f,h-1))}d();for(let f=0;f<l;f++){const p={};p.mapType=s.getUint32(h,!0),h+=4,r>=3&&p.mapType===3&&(p.nLags=s.getUint32(h,!0),h+=4,p.mnLag=s.getUint32(h,!0),h+=4,p.mxLag=s.getUint32(h,!0),h+=4,p.ccOverlay=s.getUint32(h,!0),h+=4),p.clusterSize=s.getUint32(h,!0),h+=4,p.clusterCheck=s.getUint8(h),h+=1,p.critThresh=s.getFloat32(h,!0),h+=4,p.maxThresh=s.getFloat32(h,!0),h+=4,r>=4&&(p.includeValuesGreaterThreshMax=s.getUint32(h,!0),h+=4),p.df1=s.getUint32(h,!0),h+=4,p.df2=s.getUint32(h,!0),h+=4,r>=5?(p.posNegFlag=s.getUint32(h,!0),h+=4):p.posNegFlag=3,p.cortexBonferroni=s.getUint32(h,!0),h+=4,p.posMinRGB=[0,0,0],p.posMaxRGB=[0,0,0],p.negMinRGB=[0,0,0],p.negMaxRGB=[0,0,0],r>=2&&(p.posMinRGB[0]=s.getUint8(h),h++,p.posMinRGB[1]=s.getUint8(h),h++,p.posMinRGB[2]=s.getUint8(h),h++,p.posMaxRGB[0]=s.getUint8(h),h++,p.posMaxRGB[1]=s.getUint8(h),h++,p.posMaxRGB[2]=s.getUint8(h),h++,r>=4&&(p.negMinRGB[0]=s.getUint8(h),h++,p.negMinRGB[1]=s.getUint8(h),h++,p.negMinRGB[2]=s.getUint8(h),h++,p.negMaxRGB[0]=s.getUint8(h),h++,p.negMaxRGB[1]=s.getUint8(h),h++,p.negMaxRGB[2]=s.getUint8(h),h++),p.enableSMPColor=s.getUint8(h),h++,r>=4&&(p.lut=d()),p.colorAlpha=s.getFloat32(h,!0),h+=4),p.name=d();const g=new Float32Array(e,h,a);c.set(g,f*a),h+=a*4}return c}static readSTC(e,t){const n=new DataView(e),s=n.getInt32(8,!1);if(s!==t)throw new Error("Overlay has "+s+" vertices, expected "+t);let r=12+s*4;const a=n.getUint32(r,!1);r+=4;const l=new Float32Array(a*s);for(let c=0;c<a*s;c++)l[c]=n.getFloat32(r,!1),r+=4;return l}static isCurv(e){const t=new DataView(e),n=t.getUint8(0),s=t.getUint8(1),r=t.getUint8(2);return n!==255||s!==255||r!==255?($l.debug("Unable to recognize file type: does not appear to be FreeSurfer format."),!1):!0}static readCURV(e,t){const n=new DataView(e),s=n.getUint8(0),r=n.getUint8(1),a=n.getUint8(2),l=n.getUint32(3,!1),c=n.getUint32(11,!1);if((s!==255||r!==255||a!==255)&&$l.debug("Unable to recognize file type: does not appear to be FreeSurfer format."),t!==l)throw new Error("CURV file has different number of vertices ( "+l+")than mesh ("+t+")");if(e.byteLength<15+4*l*c)throw new Error("CURV file smaller than specified");const h=new Float32Array(c*l);let d=15;for(let y=0;y<c*l;y++)h[y]=n.getFloat32(d,!1),d+=4;let f=h[0],p=h[0];for(let y=0;y<h.length;y++)f=Math.min(f,h[y]),p=Math.max(p,h[y]);const g=1/(p-f);for(let y=0;y<h.length;y++)h[y]=1-(h[y]-f)*g;return h}static readANNOT(e,t,n=!1){const s=new DataView(e),r=s.getUint32(0,!1),a=this.decimateLayerVertices(r,t);if(t!==a)throw new Error("ANNOT file has different number of vertices than mesh");if(e.byteLength<4+8*r)throw new Error("ANNOT file smaller than specified");let l=0;const c=new Uint32Array(r);for(let E=0;E<r;E++){const D=s.getUint32(l+=4,!1);c[D]=s.getUint32(l+=4,!1)}if(!n)return c;let h=0;try{h=s.getInt32(l+=4,!1)}catch{return c}if(h!==1||s.getInt32(l+=4,!1)>0)return c;const p=s.getInt32(l+=4,!1),g=s.getInt32(l+=4,!1);l+=g;const y=s.getInt32(l+=4,!1);if(y<1)return c;const x={R:Array(p).fill(0),G:Array(p).fill(0),B:Array(p).fill(0),A:Array(p).fill(0),I:Array(p).fill(0),labels:Array(p).fill("")};for(let E=0;E<y;E++){const D=s.getInt32(l+=4,!1),M=s.getInt32(l+=4,!1);l+=4;let N="";for(let P=0;P<M;P++){const O=s.getUint8(l++);if(O===0)break;N+=String.fromCharCode(O)}l-=4;const I=s.getInt32(l+=4,!1),_=s.getInt32(l+=4,!1),F=s.getInt32(l+=4,!1),B=s.getInt32(l+=4,!1);if(D<0||D>=p){X.warn("annot entry out of range");continue}x.R[D]=I,x.G[D]=_,x.B[D]=F,x.A[D]=B,x.I[D]=(B<<24)+(F<<16)+(_<<8)+I,x.labels[D]=N}let b=!0;for(let E=0;E<p;E++)x.A[E]>0&&(b=!1);if(b)for(let E=0;E<p;E++)x.A[E]=255;const w=new Float32Array(r);w.fill(-1);let S=0;for(let E=0;E<t;E++){const D=c[E];for(let M=0;M<p;M++)if(x.I[M]===D){w[E]=M;break}w[E]<0&&(S++,w[E]=0)}S>0&&X.error(`annot vertex colors do not match ${S} of ${r} vertices.`);for(let E=0;E<p;E++)x.I[E]=E;const C=yt.makeLabelLut(x);return{scalars:w,colormapLabel:C}}static readNV(e){const t=e.byteLength,n=new Uint8Array(e);let s=0;function r(){for(;s<t&&n[s]===10;)s++;const p=s;for(;s<t&&n[s]!==10;)s++;return s++,s-p<1?"":new TextDecoder().decode(e.slice(p,s-1))}let a=0,l=0,c=0,h=0,d,f;for(;s<t;){const p=r();if(p.startsWith("#"))continue;const g=p.trim().split(/\s+/);if(a<1){a=parseInt(g[0]),d=new Float32Array(a*3);continue}if(c<a*3){d[c]=parseFloat(g[0]),d[c+1]=parseFloat(g[1]),d[c+2]=parseFloat(g[2]),c+=3;continue}if(l<1){l=parseInt(g[0]),f=new Uint32Array(l*3);continue}if(h>=l*3)break;f[h+2]=parseInt(g[0])-1,f[h+1]=parseInt(g[1])-1,f[h+0]=parseInt(g[2])-1,h+=3}return{positions:d,indices:f}}static readASC(e){const t=e.byteLength,n=new Uint8Array(e);let s=0;function r(){for(;s<t&&n[s]===10;)s++;const g=s;for(;s<t&&n[s]!==10;)s++;return s++,s-g<1?"":new TextDecoder().decode(e.slice(g,s-1))}let a=r();a.startsWith("#!ascii")||X.warn("Invalid ASC mesh"),a=r();let l=a.trim().split(/\s+/);const c=parseInt(l[0]),h=parseInt(l[1]),d=new Float32Array(c*3);let f=0;for(let g=0;g<c;g++)a=r(),l=a.trim().split(/\s+/),d[f]=parseFloat(l[0]),d[f+1]=parseFloat(l[1]),d[f+2]=parseFloat(l[2]),f+=3;const p=new Uint32Array(h*3);f=0;for(let g=0;g<h;g++)a=r(),l=a.trim().split(/\s+/),p[f]=parseInt(l[0]),p[f+1]=parseInt(l[1]),p[f+2]=parseInt(l[2]),f+=3;return{positions:d,indices:p}}static readVTK(e){const t=e.byteLength;if(t<20)throw new Error("File too small to be VTK: bytes = "+e.byteLength);const n=new Uint8Array(e);let s=0;function r(x=!0){if(x)for(;s<t&&n[s]===10;)s++;const b=s;for(;s<t&&n[s]!==10;)s++;return s++,s-b<1?"":new TextDecoder().decode(e.slice(b,s-1))}let a=r();if(!a.startsWith("# vtk DataFile"))throw new Error("Invalid VTK mesh");if(a=r(!1),a=r(),a.startsWith("ASCII"))return oi.readTxtVTK(e);if(!a.startsWith("BINARY"))throw new Error("Invalid VTK image, expected ASCII or BINARY "+a);if(a=r(),!a.includes("POLYDATA"))throw new Error("Only able to read VTK POLYDATA "+a);a=r(),(!a.includes("POINTS")||!a.includes("double")&&!a.includes("float"))&&X.warn("Only able to read VTK float or double POINTS"+a);const l=a.includes("double");let c=a.trim().split(/\s+/);const d=parseInt(c[1])*3,f=new Float32Array(d),p=new DataView(e);if(l)for(let x=0;x<d;x++)f[x]=p.getFloat64(s,!1),s+=8;else for(let x=0;x<d;x++)f[x]=p.getFloat32(s,!1),s+=4;a=r(),c=a.trim().split(/\s+/);const g=[];if(c[0].includes("LINES")){const x=parseInt(c[1]),b=s;if(a=r(),a.startsWith("OFFSETS")){let E=!1;a.includes("int64")&&(E=!0);const D=new Uint32Array(x);if(E){let N=!1;for(let I=0;I<x;I++){let _=p.getInt32(s,!1);_!==0&&(N=!0),s+=4,_=p.getInt32(s,!1),s+=4,D[I]=_}N&&X.warn("int32 overflow: JavaScript does not support int64")}else for(let N=0;N<x;N++){const I=p.getInt32(s,!1);s+=4,D[N]=I}return{pts:f,offsetPt0:D}}s=b;let w=0;const S=[],C=[];S.push(w);for(let E=0;E<x;E++){const D=p.getInt32(s,!1);s+=4,w+=D,S.push(w);for(let M=0;M<D;M++){const N=p.getInt32(s,!1)*3;s+=4,C.push(f[N+0]),C.push(f[N+1]),C.push(f[N+2])}}return{pts:Float32Array.from(C),offsetPt0:Uint32Array.from(S)}}else if(c[0].includes("TRIANGLE_STRIPS")){const x=parseInt(c[1]);for(let b=0;b<x;b++){const w=p.getInt32(s,!1)-2;s+=4;for(let S=0;S<w;S++)S%2?(g.push(p.getInt32(s+8,!1)),g.push(p.getInt32(s+4,!1)),g.push(p.getInt32(s,!1))):(g.push(p.getInt32(s,!1)),g.push(p.getInt32(s+4,!1)),g.push(p.getInt32(s+8,!1))),s+=4;s+=8}}else if(c[0].includes("POLYGONS")){const x=parseInt(c[1]),b=s,w=r();if(w.startsWith("OFFSETS")){let S=w.includes("int64");const C=new Uint32Array(x);let E=!1;for(let I=0;I<x;I++)S&&(p.getInt32(s,!1)!==0&&(E=!0),s+=4),C[I]=p.getInt32(s,!1),s+=4;if(!Number.isSafeInteger(x)||x>=2147483648||E)throw new Error("values exceed 2GB limit");const D=r();if(!D.startsWith("CONNECTIVITY"))throw new Error("Expected CONNECTIVITY after OFFSETS");S=D.includes("int64");const M=C[x-1],N=new Uint32Array(M);for(let I=0;I<M;I++)S&&(s+=4),N[I]=p.getInt32(s,!1),s+=4;for(let I=0;I<x;I++){const _=I===0?0:C[I-1],F=C[I];for(let B=1;B<F-_-1;B++)g.push(N[_]),g.push(N[_+B]),g.push(N[_+B+1])}}else{s=b;for(let S=0;S<x;S++){const C=p.getInt32(s,!1)-2;if(S===0&&C>65535)throw new Error("Invalid VTK binary polygons using little-endian data (MRtrix)");s+=4;const E=p.getInt32(s,!1);s+=4;let D=p.getInt32(s,!1);s+=4;for(let M=0;M<C;M++){const N=p.getInt32(s,!1);s+=4,g.push(E,D,N),D=N}}}}else throw new Error("Unsupported binary VTK datatype "+c[0]);const y=new Uint32Array(g);return{positions:f,indices:y}}static readWRL(e){const t=new TextDecoder("utf-8").decode(e),n=/coord\s+Coordinate\s*\{\s*point\s*\[([\s\S]*?)\]/,s=/coordIndex\s*\[([\s\S]*?)\]/,r=/color\s+Color\s*\{\s*color\s*\[([\s\S]*?)\]/,a=n.exec(t),l=s.exec(t),c=r.exec(t);if(!a||!l)throw new Error("Invalid WRL file: Could not find vertices or indices.");const h=new Float32Array(a[1].trim().split(/[\s,]+/).map(Number));let d=null;if(c){d=new Float32Array(c[1].trim().split(/[\s,]+/).map(Number));const p=h.length/3;d.length!==p*3&&(console.warn(`Unexpected color count: expected ${p*3}, got ${d.length}`),d=null)}const f=new Uint32Array(l[1].trim().split(/[\s,]+/).map(Number).filter(p=>p!==-1));return{positions:h,indices:f,colors:d}}static readDFS(e){const t=new DataView(e),n=t.getUint32(0,!0),s=t.getUint16(4,!0);(n!==1599292996||s!==17740)&&X.warn("Not a little-endian brainsuite DFS mesh");const r=t.getUint32(12,!0),a=t.getUint32(24,!0),l=t.getUint32(28,!0),c=t.getUint32(48,!0);let h=r;const d=new Uint32Array(e,h,a*3);h+=a*3*4;const f=new Float32Array(e,h,l*3);for(let g=0;g<l*3;g+=3){const y=f[g];f[g]=f[g+1],f[g+1]=y}let p;return c>=0&&(p=new Float32Array(e,c,l*3)),{positions:f,indices:d,colors:p}}static async readMZ3(e,t=0){if(e.byteLength<20)throw new Error("File too small to be mz3: bytes = "+e.byteLength);let n=new DataView(e),s=e,r=n.getUint16(0,!0);if(r===35615||r===8075){const _=await Ve.decompress(new Uint8Array(e));n=new DataView(_.buffer),r=n.getUint16(0,!0),s=_.buffer}const a=n.getUint16(2,!0),l=n.getUint32(4,!0);let c=n.getUint32(8,!0);const h=n.getUint32(12,!0);if($l.debug("MZ3 magic %d attr %d face %d vert %d skip %d",r,a,l,c,h),r!==23117)throw new Error("Invalid MZ3 file");const d=(a&1)!==0,f=(a&2)!==0,p=(a&4)!==0;let g=(a&8)!==0;const y=(a&16)!==0,x=(a&32)!==0,b=(a&64)!==0;if($l.debug(`isFace=${d} isVert=${f} isRGBA=${p} isSCALAR=${g} isDOUBLE=${y} isAOMAP=${x} isLOOKUP=${b}`),a>127)throw new Error("Unsupported future version of MZ3 file");let w=4;y&&(w=8);let S=0;if(t>0&&!d&&l<1&&!p&&(g=!0),g){const _=t||c,F=16+h+(d?l*12:0)+(f?_*12:0)+(p?_*4:0),B=Math.floor((s.byteLength-F)/w);c!==t&&B%t===0&&(c=t),S=Math.floor(B/c),S<1&&(X.warn("Corrupt MZ3: file reports NSCALAR but not enough bytes"),g=!1)}if(c<3&&t<3)throw new Error("Not a mesh MZ3 file (maybe scalar)");t>0&&t!==c&&X.warn("Layer has "+c+"vertices, but background mesh has "+t);let C=16+h;const E=new DataView(s);let D=null;if(d){D=new Uint32Array(l*3);for(let _=0;_<l*3;_++)D[_]=E.getUint32(C,!0),C+=4}let M=null;if(f){M=new Float32Array(c*3);for(let _=0;_<c*3;_++)M[_]=E.getFloat32(C,!0),C+=4}let N=null;if(p){N=new Float32Array(c*3);for(let _=0;_<c;_++){for(let F=0;F<3;F++)N[_*3+F]=E.getUint8(C++)/255;C++}}let I=new Float32Array;if(g&&S>0)if(y){const _=new Float64Array(S*c);for(let F=0;F<S*c;F++)_[F]=E.getFloat64(C,!0),C+=8;I=Float32Array.from(_)}else{I=new Float32Array(S*c);for(let _=0;_<S*c;_++)I[_]=E.getFloat32(C,!0),C+=4}if(t>0&&b&&g){const _=new TextDecoder("utf-8"),F=new Uint8Array(s,16,h),B=_.decode(F),P=JSON.parse(B),O=yt.makeLabelLut(P);return{scalars:I,colormapLabel:O}}if(t>0&&p&&g){let _=I[0];for(let P=0;P<c;P++)_=Math.max(_,I[P]);const F={R:[],G:[],B:[],A:[],I:[],labels:[]};for(let P=0;P<=_;P++)for(let O=0;O<c;O++)if(P===I[O]){const k=O*3;F.I.push(P),F.R.push(N[k]*255),F.G.push(N[k+1]*255),F.B.push(N[k+2]*255),F.A.push(255),F.labels.push(`${P}`);break}const B=yt.makeLabelLut(F);return{scalars:I,colormapLabel:B}}return t>0?{scalars:I}:{positions:M,indices:D,scalars:I,colors:N}}static readPLY(e){const t=e.byteLength,n=new Uint8Array(e);let s=0;function r(){for(;s<t&&n[s]===10;)s++;const I=s;for(;s<t&&n[s]!==10;)s++;return s++,s-I<1?"":new TextDecoder().decode(e.slice(I,s-1))}let a=r();if(!a.startsWith("ply"))throw new Error("Not a valid PLY file");a=r();const l=a.includes("ascii");function c(I){if(I==="char"||I==="uchar"||I==="int8"||I==="uint8")return 1;if(I==="short"||I==="ushort"||I==="int16"||I==="uint16")return 2;if(I==="int"||I==="uint"||I==="int32"||I==="uint32"||I==="float"||I==="float32")return 4;if(I==="double")return 8;throw new Error("Unknown data type: "+I)}const h=a.includes("binary_little_endian");let d=0,f=!1,p=0,g=0,y=0,x=0,b=0,w=0,S=0;for(;s<t&&!a.startsWith("end_header");){if(a=r(),a.startsWith("comment"))continue;let I=a.split(/\s/);if(a.startsWith("element vertex"))for(d=parseInt(I[I.length-1]),a=r(),I=a.split(/\s/);a.startsWith("property");){const _=I[1];I[2]==="x"&&_.startsWith("double")?f=!0:I[2]==="x"&&!_.startsWith("float")&&X.error("Error: expect ply xyz to be float or double: "+a),p+=c(_),a=r(),I=a.split(/\s/)}if(a.startsWith("element face"))for(S=parseInt(I[I.length-1]),a=r(),I=a.split(/\s/);a.startsWith("property");){if(I[1]==="list")y=c(I[2]),x=c(I[3]),g+=y+3*x;else{const _=c(I[1]);g+=_,x===0&&(b+=_,w++)}a=r(),I=a.split(/\s/)}}if(l){S<1&&X.error(`Malformed ply format: faces ${S} `);const I=new Float32Array(d*3);let _=0;for(let P=0;P<d;P++){a=r();const O=a.split(/\s/);I[_]=parseFloat(O[0]),I[_+1]=parseFloat(O[1]),I[_+2]=parseFloat(O[2]),_+=3}let F=new Uint32Array(S*3),B=0;for(let P=0;P<S;P++){a=r();const O=a.split(/\s/),k=parseInt(O[w])-2;if(k<1)break;if(B+k*3>F.length){const H=new Uint32Array(F.length+F.length);H.set(F),F=H.slice()}const q=parseInt(O[w+1]);let U=parseInt(O[w+2]);for(let H=0;H<k;H++){const Y=parseInt(O[w+3+H]);F[B+0]=q,F[B+1]=U,F[B+2]=Y,U=Y,B+=3}}return F.length!==B&&(F=F.slice(0,B)),{positions:I,indices:F}}(p<12||y<1||x<1||S<1)&&X.warn(`Malformed ply format: stride ${p} count ${y} iBytes ${x} iStrideBytes ${g} iPadBytes ${b} faces ${S}`);const C=new DataView(e);let E;if(s%4===0&&p===12&&h)E=new Float32Array(e,s,d*3),s+=d*p;else{E=new Float32Array(d*3);let I=0;for(let _=0;_<d;_++)f?(E[I]=C.getFloat64(s,h),E[I+1]=C.getFloat64(s+8,h),E[I+2]=C.getFloat64(s+16,h)):(E[I]=C.getFloat32(s,h),E[I+1]=C.getFloat32(s+4,h),E[I+2]=C.getFloat32(s+8,h)),I+=3,s+=p}const D=new Uint32Array(S*3);let M=!0,N=0;if(y===1&&x===4&&g===13)for(let I=0;I<S;I++){const _=C.getUint8(s);s+=y,_!==3&&(M=!1),D[N]=C.getUint32(s,h),s+=4,D[N+1]=C.getUint32(s,h),s+=4,D[N+2]=C.getUint32(s,h),s+=4,N+=3}else{let I=s;for(let _=0;_<S;_++){s=I+b;let F=0;y===1?F=C.getUint8(s):y===2?F=C.getUint16(s,h):y===4&&(F=C.getUint32(s,h)),s+=y,F!==3&&(M=!1);for(let B=0;B<3;B++)x===1?D[N]=C.getUint8(s):x===2?D[N]=C.getUint16(s,h):x===4&&(D[N]=C.getUint32(s,h)),N++,s+=x;I+=g}}return M||X.warn("Only able to read PLY meshes limited to triangles."),{positions:E,indices:D}}static readICO(e){const s=new TextDecoder("utf-8").decode(e).split(`
`);let r=s[0].trim().split(/\s+/);r.length>1&&X.warn("This is not a valid FreeSurfer ICO/TRI mesh.");const a=parseInt(r[0]),l=new Float32Array(a*3);let c=1;for(let f=0;f<a;f++){const p=s[c].trim().split(/\s+/);c++;let g=parseInt(p[0])-1;const y=parseFloat(p[1]),x=parseFloat(p[2]),b=parseFloat(p[3]);if(g<0||g>=a){X.error("ICO vertices corrupted");break}g*=3,l[g]=y,l[g+1]=x,l[g+2]=b}r=s[c].trim().split(/\s+/),c++;const h=parseInt(r[0]),d=new Uint32Array(h*3);for(let f=0;f<h;f++){const p=s[c].trim().split(/\s+/);c++;let g=parseInt(p[0])-1;const y=parseInt(p[1])-1,x=parseInt(p[2])-1,b=parseInt(p[3])-1;if(g<0||g>=h){X.error("ICO indices corrupted");break}g*=3,d[g]=y,d[g+1]=x,d[g+2]=b}for(let f=0;f<d.length;f+=3){const p=d[f];d[f]=d[f+1],d[f+1]=p}return{positions:l,indices:d}}static readGEO(e,t=!1){const r=new TextDecoder("utf-8").decode(e).split(`
`),a=r[0].trim().split(/\s+/),l=parseInt(a[0]);let c=parseInt(a[1]),h=parseInt(a[2]);const d=parseInt(a[3]);(l>1||d!==h*3)&&X.warn("Multi-part BYU/GEO header or not a triangular mesh.");const f=[];c*=3;let p=0,g=2;for(;p<c;){const S=r[g].trim().split(/\s+/);g++;for(let C=0;C<S.length&&(f.push(parseFloat(S[C])),p++,!(p>=c));C++);}const y=[];h*=3;let x=0;for(;x<h;){const S=r[g].trim().split(/\s+/);g++;for(let C=0;C<S.length&&(y.push(Math.abs(parseInt(S[C]))-1),x++,!(x>=h));C++);}if(t)for(let S=0;S<y.length;S+=3){const C=y[S];y[S]=y[S+1],y[S+1]=C}const b=new Float32Array(f),w=new Uint32Array(y);return{positions:b,indices:w}}static readOFF(e){const s=new TextDecoder("utf-8").decode(e).split(`
`),r=[],a=[];let l=0;s[l].includes("OFF")?l++:X.warn("File does not start with OFF");let c=s[l].trim().split(/\s+/);const h=parseInt(c[0]),d=parseInt(c[1]);l++;for(let g=0;g<h;g++)c=s[l].trim().split(/\s+/),r.push(parseFloat(c[0])),r.push(parseFloat(c[1])),r.push(parseFloat(c[2])),l++;for(let g=0;g<d;g++)c=s[l].trim().split(/\s+/),parseInt(c[0])!==3&&X.warn("Only able to read OFF files with triangular meshes"),a.push(parseInt(c[1])),a.push(parseInt(c[2])),a.push(parseInt(c[3])),l++;const f=new Float32Array(r),p=new Uint32Array(a);return{positions:f,indices:p}}static readOBJMNI(e){const s=new TextDecoder("utf-8").decode(e).trim().split(/\s*,\s*|\s+/);(s.length<1||s[0]!=="P")&&X.warn("This is not a valid MNI OBJ mesh.");let r=6;const a=parseInt(s[r++]),l=a*3,c=new Float32Array(l);for(let y=0;y<l;y++)c[y]=parseFloat(s[r++]);r+=l;const h=parseInt(s[r++]),d=parseInt(s[r++]);(h<1||d<0||d>2)&&X.warn("This is not a valid MNI OBJ mesh.");let f=1;d===1?f=h:d===1&&(f=a),r+=f*4,r+=h;const p=h*3,g=new Uint32Array(p);for(let y=0;y<p;y++)g[y]=parseInt(s[r++]);return{positions:c,indices:g}}static async readOBJ(e){const t=new Uint8Array(e,0,2);t[0]===31&&t[1]===139&&(e=await Ve.decompressToBuffer(new Uint8Array(e)));const s=new TextDecoder("utf-8").decode(e);if(s[0]==="P")return this.readOBJMNI(e);const r=s.split(`
`),a=r.length,l=[],c=[];for(let g=0;g<a;g++){const y=r[g];if(y[0]==="v"&&y[1]===" "){const x=y.trim().split(/\s+/);l.push(parseFloat(x[1])),l.push(parseFloat(x[2])),l.push(parseFloat(x[3]))}if(y[0]==="f"){const x=y.trim().split(/\s+/),b=x.length-3;if(b<1)break;let w=x[1].split("/");const S=parseInt(w[0])-1;w=x[2].split("/");let C=parseInt(w[0])-1;for(let E=0;E<b;E++){w=x[3+E].split("/");const D=parseInt(w[0])-1;c.push(S),c.push(C),c.push(D),C=D}}}const h=new Float32Array(l),d=new Uint32Array(c);let f=d[0],p=d[0];for(let g=1;g<d.length;g++)d[g]<f&&(f=d[g]),d[g]>p&&(p=d[g]);if(p-f+1>h.length/3)throw new Error("Not a valid OBJ file");for(let g=0;g<d.length;g++)d[g]-=f;return{positions:h,indices:d}}static readFreeSurfer(e){const t=new Uint8Array(e);if(t[0]===35&&t[1]===33&&t[2]===97)return oi.readASC(e);const n=new DataView(e),s=n.getUint32(0,!1),r=n.getUint32(4,!1);(s!==4294966883||r!==1919246708)&&$l.debug("Unable to recognize file type: does not appear to be FreeSurfer format.");let a=0;for(;n.getUint8(a)!==10;)a++;a+=2;let l=n.getUint32(a,!1);a+=4;let c=n.getUint32(a,!1);a+=4,l*=3;const h=new Float32Array(l);for(let g=0;g<l;g++)h[g]=n.getFloat32(a,!1),a+=4;c*=3;const d=new Uint32Array(c);for(let g=0;g<c;g++)d[g]=n.getUint32(a,!1),a+=4;const f=n.getUint32(a,!1);a+=4;let p=f===20;if(!p){const g=n.getUint32(a,!1);a+=4;const y=n.getUint32(a,!1);a+=4,p=f===2&&g===0&&y===20}if(!p)X.warn("Unknown FreeSurfer Mesh extension code.");else{const y=new TextDecoder().decode(e.slice(a)).trim().split(`
`);for(let x=0;x<y.length;x++){if(!y[x].startsWith("cras"))continue;const w=y[x].split("=")[1].trim().split(" ").map(Number),S=Math.floor(h.length/3);let C=0;for(let E=0;E<S;E++)h[C]+=w[0],C++,h[C]+=w[1],C++,h[C]+=w[2],C++}}return{positions:h,indices:d}}static async readSRF(e){const t=new Uint8Array(e);if(t[0]===35&&t[1]===33&&t[2]===97)return oi.readASC(e);t[0]===31&&t[1]===139&&(e=(await Ve.decompress(new Uint8Array(e))).buffer);const n=new DataView(e),s=n.getFloat32(0,!0),r=n.getUint32(8,!0),a=n.getUint32(12,!0),l=n.getFloat32(16,!0),c=n.getFloat32(20,!0),h=n.getFloat32(24,!0),d=new Float32Array(r*3);let f=28,p=1;for(let M=0;M<r;M++)d[p]=-n.getFloat32(f,!0)+l,p+=3,f+=4;p=2;for(let M=0;M<r;M++)d[p]=-n.getFloat32(f,!0)+c,p+=3,f+=4;p=0;for(let M=0;M<r;M++)d[p]=-n.getFloat32(f,!0)+h,p+=3,f+=4;f=28+24*r;const g=n.getFloat32(f,!0),y=n.getFloat32(f+4,!0),x=n.getFloat32(f+8,!0),b=n.getFloat32(f+16,!0),w=n.getFloat32(f+20,!0),S=n.getFloat32(f+24,!0);f+=32;const C=new Float32Array(r*3),E=new Uint32Array(e,f,r);p=0;for(let M=0;M<r;M++){const N=E[M];N>1056964608&&(C[p+0]=(N>>16&255)/255,C[p+1]=(N>>8&255)/255,C[p+2]=(N&255)/255),N===0&&(C[p+0]=g,C[p+1]=y,C[p+2]=x),N===1&&(C[p+0]=b,C[p+1]=w,C[p+2]=S),p+=3}f+=r*4;for(let M=0;M<r;M++){const N=n.getUint32(f,!0);f+=4+4*N}const D=new Uint32Array(a*3);for(let M=0;M<a*3;M++)D[M]=n.getInt32(f,!0),f+=4;return s!==4&&X.warn("Not valid SRF"),{positions:d,indices:D,colors:C}}static readTxtSTL(e){const s=new TextDecoder("utf-8").decode(e).split(`
`);if(!s[0].startsWith("solid"))throw new Error("Not a valid STL file");const r=[];for(let h=1;h<s.length;h++){if(!s[h].includes("vertex"))continue;const d=s[h].trim().split(/\s+/);for(let f=1;f<d.length;f++)r.push(parseFloat(d[f]))}const a=Math.floor(r.length/3);if(a*3!==r.length)throw new Error("Unable to parse ASCII STL file.");const l=new Float32Array(r),c=new Uint32Array(a);for(let h=0;h<a;h++)c[h]=h;return{positions:l,indices:c}}static readSTL(e){if(e.byteLength<134)throw new Error("File too small to be STL: bytes = "+e.byteLength);const t=new DataView(e);if(t.getUint32(0,!0)===1768714099)return oi.readTxtSTL(e);const s=t.getUint32(80,!0),r=3*s;if(e.byteLength<84+s*50)throw new Error("STL file too small to store triangles = "+s);const a=new Uint32Array(r),l=new Float32Array(r*3);let c=96,h=0;for(let d=0;d<s;d++){for(let f=0;f<9;f++)l[h]=t.getFloat32(c,!0),h+=1,c+=4;c+=14}for(let d=0;d<r;d++)a[d]=d;return{positions:l,indices:a}}static decimateLayerVertices(e,t){if(e%t===0)return e;const n=12,s=Math.round(Math.log((e-2)/(n-2))/Math.log(4)),r=Math.round(Math.log((t-2)/(n-2))/Math.log(4)),a=Math.pow(4,s)*(n-2)+2,l=Math.pow(4,r)*(n-2)+2;return a!==e||l!==t?e:t}static async readNII2(e,t=0,n=""){let s=new Float32Array;const r=e.byteLength;let a=!0;const l=new DataView(e);let c=l.getUint16(0,a);if(c===469893120&&(a=!1,c=l.getUint16(0,a)),c!==540)throw new Error("Not a valid NIfTI-2 dataset");const h=Number(l.getBigInt64(168,a)),d=l.getFloat64(176,a),f=l.getFloat64(184,a);(d!==1||f!==0)&&X.warn("ignoring scale slope and intercept");const p=l.getUint32(504,a),g=l.getUint16(12,a);if(g!==2&&g!==4&&g!==8&&g!==16)throw new Error("Unsupported NIfTI datatype "+g);let y=1;const x=[1,1,1,1,1,1,1,1];for(let b=1;b<8;b++)x[b]=Math.max(Number(l.getBigInt64(16+b*8,a)),1),y*=x[b];if(p>=3e3&&p<=3099&&h>580){let b=function(){for(;_<r&&I[_]===10;)_++;const U=_;for(;_<r&&I[_]!==10;)_++;return _++,_-U<1?"":new TextDecoder().decode(e.slice(U,_-1)).trim()},w=function(){let U=b();if(!U.startsWith("<")||U.endsWith(">"))return U;for(;_<r&&!U.endsWith(">");)U+=b();return U},S=function(U,H=!1){const Y=F.indexOf(U);if(Y<0)return 1;const Q=F.indexOf('"',Y)+1,te=F.indexOf('"',Q),j=F.slice(Q,te);return H?j:parseInt(j)},C=0,E=0,D=0,M="",N=new Uint32Array;const I=new Uint8Array(e);let _=552,F;const B=x[5],P=new Float32Array(t*B);for(;_<r&&(F=w(),!F.includes("</CIFTI>"));)if(F.includes("<BrainModel")){const U=S("SurfaceNumberOfVertices="),H=S("BrainStructure=",!0).toUpperCase();if(U%t!==0)continue;let Y=!1;if(n.includes("CORTEX")&&H.includes("CORTEX")&&(Y=!0),!Y||(Y=!1,n.includes("LEFT")&&H.includes("LEFT")&&(Y=!0),n.includes("RIGHT")&&H.includes("RIGHT")&&(Y=!0),!Y))continue;if(D=U,C=S("IndexOffset="),E=S("IndexCount="),M=H,F.includes("<VertexIndices>")||(F=w()),!F.startsWith("<VertexIndices>")||!F.endsWith("</VertexIndices>"))return X.warn("Unable to find CIfTI <VertexIndices>"),P;F=F.slice(15,-16);const Q=F.trim().split(/\s+/);Q.length<E&&X.error("Error parsing VertexIndices"),N=new Uint32Array(E);for(let te=0;te<E;te++)N[te]=parseInt(Q[te])}if(D===0||N.length===0)return X.warn("Unable to find CIfTI structure that matches the mesh."),P;if(g!==16)return X.warn("Only able to read float32 CIfTI (only known datatype)."),P;const O=new Float32Array(E*B),k=h+B*C*4;for(let U=0;U<E*B;U++)O[U]=l.getFloat32(k+U*4,a);let q=0;for(let U=0;U<E;U++)for(let H=0;H<B;H++)P[N[U]+H*t]=O[q],q++;return X.debug("CIfTI diagnostics",D,M,C,E,C,n),P}if(y=this.decimateLayerVertices(y,t),y%t!==0)throw new Error("Vertices in layer ("+y+") is not a multiple of number of vertices ("+t+")");if(a)g===16?s=new Float32Array(e,h,y):g===8?s=new Int32Array(e,h,y):g===4&&(s=new Int16Array(e,h,y));else if(g===16){s=new Float32Array(y);for(let b=0;b<y;b++)s[b]=l.getFloat32(h+b*4,a)}else if(g===8){s=new Int32Array(y);for(let b=0;b<y;b++)s[b]=l.getInt32(h+b*4,a)}else if(g===4){s=new Int16Array(y);for(let b=0;b<y;b++)s[b]=l.getInt16(h+b*2,a)}return g===2&&(s=new Uint8Array(e,h,y)),s}static async readNII(e,t,n=""){const s=t.length/3;let r=new Float32Array,a=!0,l=new DataView(e),c=l.getUint16(0,a);if(c===540||c===469893120)return oi.readNII2(e,s,n);if(c===23553&&(a=!1,c=l.getUint16(0,a)),c!==348){const M=await Ve.decompress(new Uint8Array(e));if(l=new DataView(M.buffer),e=M.buffer,c=l.getUint16(0,a),c===540||c===469893120)return oi.readNII2(e,s,n);c===23553&&(a=!1,c=l.getUint16(0,a))}c!==348&&X.error("Not a valid NIfTI image.");const h=l.getFloat32(108,a),d=l.getFloat32(112,a),f=l.getFloat32(116,a),p=l.getUint16(252,a),g=l.getUint16(254,a),y=l.getUint16(70,a);if(y!==2&&y!==4&&y!==8&&y!==16)throw new Error("Unsupported NIfTI datatype "+y);const x=it();for(let M=0;M<12;M++)x[M]=l.getFloat32(280+M*4,a);let b=1;const w=new Array(8);for(let M=0;M<8;M++)w[M]=l.getUint16(40+M*2,a),!(M<1)&&(b*=w[M]||1);let S=!1,C=this.decimateLayerVertices(b,s);if(C%s!==0)if(w[0]>=3&&w[1]>1&&w[2]>1&&w[3]>1)S=!0,C=w[1]*w[2]*w[3];else throw new Error("Voxels in layer ("+b+") is not a multiple of number of vertices ("+s+")");if(b=C,a)y===16?r=new Float32Array(e,h,b):y===8?r=new Int32Array(e,h,b):y===4&&(r=new Int16Array(e,h,b));else if(y===16){r=new Float32Array(b);for(let M=0;M<b;M++)r[M]=l.getFloat32(h+M*4,a)}else if(y===8){r=new Int32Array(b);for(let M=0;M<b;M++)r[M]=l.getInt32(h+M*4,a)}else if(y===4){r=new Int16Array(b);for(let M=0;M<b;M++)r[M]=l.getInt16(h+M*2,a)}if(y===2&&(r=new Uint8Array(e,h,b)),Number.isFinite(d)&&Number.isFinite(f)&&d!==0&&(d!==1||f!==0)){const M=new Float32Array(b);for(let N=0;N<b;N++)M[N]=r[N]*d+f;r=M}let E=r[0],D=E;for(let M=0;M<b;M++)isNaN(r[M])&&(r[M]=0),E=Math.min(E,r[M]),D=Math.max(D,r[M]);if(X.debug(`Layer Range ${E}..${D} slope ${d} inter ${f}`),S){let M=function(H,Y){const Q=[0,0,0];return Q[0]=Y[0]*H[0]+Y[1]*H[1]+Y[2]*H[2]+Y[3],Q[1]=Y[4]*H[0]+Y[5]*H[1]+Y[6]*H[2]+Y[7],Q[2]=Y[8]*H[0]+Y[9]*H[1]+Y[10]*H[2]+Y[11],Q};const N=new Float32Array(s);X.warn("Sampling voxel intensities at mesh vertices (assumes precise alignment)."),(p>g||g<=0)&&X.warn(`Requires valid sform (sform_code = ${g})`);const I=it();rn(I,x);const _=w[1],F=w[2],B=w[3],P=_*F;let O=0,k=0,q=0;for(;k<s;){const H=[t[O],t[O+1],t[O+2]],Y=M(H,I);O+=3,k+=1;const Q=Math.floor(Y[0]),te=Math.floor(Y[1]),j=Math.floor(Y[2]),W=Math.ceil(Y[0]),K=Math.ceil(Y[1]),ee=Math.ceil(Y[2]);if(Q<0||W>=_||te<0||K>=F||j<0||ee>=B)continue;const le=Q+te*_+j*P,he=new Float32Array(8);he[0]=r[le],he[1]=r[le+1],he[2]=r[le+_],he[3]=r[le+_+1],he[4]=r[le+P],he[5]=r[le+P+1],he[6]=r[le+P+_],he[7]=r[le+P+_+1];let ce=he[0],xe=ce;for(let ge=1;ge<8;ge++)ce=Math.max(ce,he[ge]),xe=Math.min(xe,he[ge]);Math.abs(xe)>ce&&(ce=xe),N[k-1]=ce,q++}const U=q/s;U<.1&&X.warn(`${q} of ${s} vertices in range (${(U*100).toFixed(1)}%)`),r=N}return r}static async readMGH(e,t=0,n=!1){let s=new DataView(e),r=e;if(s.getUint8(0)===31&&s.getUint8(1)===139){const N=await Ve.decompress(new Uint8Array(e));r=new ArrayBuffer(N.byteLength),new Uint8Array(r).set(new Uint8Array(N)),s=new DataView(N.buffer)}const a=s.getInt32(0,!1),l=Math.max(1,s.getInt32(4,!1)),c=Math.max(1,s.getInt32(8,!1)),h=Math.max(1,s.getInt32(12,!1)),d=Math.max(1,s.getInt32(16,!1)),f=s.getInt32(20,!1);let p=284;const g=!1;(a!==1||f<0||f>4)&&X.warn("Not a valid MGH file");let y=l*c*h*d,x=[];if(y=this.decimateLayerVertices(y,t),y%t!==0)return X.warn("Vertices in layer ("+y+") is not a multiple of number of vertices ("+t+")"),x;if(f===3){x=new Float32Array(y);for(let N=0;N<y;N++)x[N]=s.getFloat32(p+N*4,g)}else if(f===1){x=new Int32Array(y);for(let N=0;N<y;N++)x[N]=s.getInt32(p+N*4,g)}else if(f===4){x=new Int16Array(y);for(let N=0;N<y;N++)x[N]=s.getInt16(p+N*2,g)}else f===0&&(x=new Uint8Array(e,p,y));if(!n)return x;let b=4;f===4&&(b=2),f===0&&(b=1),p+=b*y,p+=16;const w=1,S=2,C=20,E=30,D=r.byteLength;let M;for(;p<D-8;){const N=s.getInt32(p+=4,g);let I=0;switch(N){case E:I=s.getInt32(p+=4,g)-1;break;case C:case S:I=0;break;case w:I=0;{let _=s.getInt32(p+=4,g);if(_>0)return X.warn("unsupported CTABreadFromBinaryV1"),x;if(_=-_,_!==2)return X.warn("CTABreadFromBinary: unknown version"),x;const F=s.getInt32(p+=4,g);if(F<0)return X.warn("CTABreadFromBinaryV2: nentries was ",F),x;const B=s.getInt32(p+=4,g);p+=B;const P=s.getInt32(p+=4,g);if(P<0)return x;const O={R:[],G:[],B:[],A:[],I:[],labels:[]};for(let k=0;k<P;k++){const q=s.getInt32(p+=4,g),U=s.getInt32(p+=4,g);let H=p+4,Y="";for(let K=0;K<U;K++){const ee=s.getUint8(H++);if(ee===0)break;Y+=String.fromCharCode(ee)}p+=U;const Q=s.getInt32(p+=4,g),te=s.getInt32(p+=4,g),j=s.getInt32(p+=4,g),W=255-s.getInt32(p+=4,g);O.I.push(q),O.R.push(Q),O.G.push(te),O.B.push(j),O.A.push(W),O.labels.push(Y)}M=yt.makeLabelLut(O)}break;default:I=s.getInt32(p+=8,g)}p+=I}return{scalars:x,colormapLabel:M}}static readX3D(e){const t=e.byteLength;if(t<20)throw new Error("File too small to be X3D: bytes = "+t);const n=new Uint8Array(e);let s=0;function r(){for(;s<t&&n[s]!==60;)s++;const C=s;for(;s<t&&n[s]!==62;)s++;const E=s;return new TextDecoder().decode(e.slice(C,E+1)).trim()}let a=r();function l(C){const E=a.indexOf(C+"=");if(E<0)return"";const D=a[E+C.length+1],M=a.indexOf(D,E)+1,N=a.indexOf(D,M);return a.slice(M,N)}function c(C){const E=a.indexOf(C+"=");if(E<0)return 1;const D=a[E+C.length+1],M=a.indexOf(D,E)+1,N=a.indexOf(D,M);let I=a.slice(M,N).trim();I=I.replace(/,\s*$/,"");const _=I.trim().split(/\s*,\s*|\s+/);if(_.length<2)return parseFloat(I);let F=new Array(_.length),B=0;for(let P=0;P<_.length;P++){const O=parseFloat(_[P]);isFinite(O)&&(F[B]=O,B++)}return F=F.slice(0,B),F}a.includes("xml version")||X.warn("Not a X3D image");let h=[],d=[],f=[],p=[],g=[0,0,0,0],y=[0,0,0,0],x=[255,255,255,255],b=[255,255,255,255];const w={};function S(){if(!a.endsWith("/>"))if(a.startsWith("<Appearance>"))for(;s<t&&!a.endsWith("</Appearance>");)a+=r();else for(;s<t&&!a.endsWith("/>");)a+=r();const C=l("USE");if(C.length>1){C in w?x=w[C]:X.warn("Unable to find DEF for "+C);return}const E=c("diffuseColor");if(E.length<3)return;x[0]=Math.round(E[0]*255),x[1]=Math.round(E[1]*255),x[2]=Math.round(E[2]*255);const D=l("DEF");D.length<1||(w[D]=x)}for(;s<t;)if(a=r(),x=b.slice(),a.startsWith("<Transform")&&(g=c("translation"),y=c("rotation")),a.startsWith("<Appearance")&&(S(),b=x.slice()),a.startsWith("<Shape")){let C=1,E=1,D=[],M=[];for(;s<t&&(a=r(),a.startsWith("<Appearance")&&S(),!a.startsWith("</Shape"));){if(a.startsWith("<Sphere")&&(C=c("radius"),E=-1),a.startsWith("<Cylinder")&&(C=c("radius"),E=c("height")),a.startsWith("<IndexedFaceSet")&&(E=-2,D=c("coordIndex")),a.startsWith("<IndexedTriangleSet")&&(E=-7,D=c("index")),a.startsWith("<IndexedTriangleStripSet")&&(E=-3,D=c("index")),a.startsWith("<Coordinate")){M=c("point");const N=M.length%3;N!==0&&(M=M.slice(0,-N))}a.startsWith("<Color")&&(p=c("color")),a.startsWith("<Box")&&(E=-4,X.warn("Unsupported x3d shape: Box")),a.startsWith("<Cone")&&(E=-5,X.warn("Unsupported x3d shape: Cone")),a.startsWith("<ElevationGrid")&&(E=-6,X.warn("Unsupported x3d shape: ElevationGrid"))}if(!(E<-3&&E!==-7))if(E<-1){if(D.length<1||M.length<3||M.length===void 0){X.warn("Indexed mesh must specify indices and points");break}const N=Math.floor(h.length/3);let I=2;if(E===-7)d=[...d,...D];else if(E===-2){let B=0;for(;I<D.length;)D[I]>=0?(d.push(D[B]+N),d.push(D[I-1]+N),d.push(D[I-0]+N),I+=1):(I+=3,B=I-2)}else for(;I<D.length;)D[I]>=0?(d.push(D[I-2]+N),d.push(D[I-1]+N),d.push(D[I-0]+N),I+=1):I+=3;h=[...h,...M];const _=Math.floor(M.length/3),F=Array(_).fill(x).flat();if(p.length===_*3){let B=0,P=0;for(let O=0;O<_;O++){for(let k=0;k<3;k++)F[P]=Math.round(p[B]*255),B++,P++;P++}}f=[...f,...F]}else if(E<0)Sa.makeColoredSphere(h,d,f,C,g,x);else{const N=it();PN(N,y[3],[y[0],y[1],y[2]]);const I=Lt(0,-E*.5,0,1),_=Lt(0,+E*.5,0,1);Pi(I,I,N),Pi(_,_,N),lb(I,I,g),lb(_,_,g);const F=Ae(I[0],I[1],I[2]),B=Ae(_[0],_[1],_[2]);Sa.makeColoredCylinder(h,d,f,F,B,C,x)}}return{positions:Float32Array.from(h),indices:Uint32Array.from(d),rgba255:Uint8Array.from(f)}}static async readGII(e,t=0){let n=e.byteLength;if(n<20)throw new Error("File too small to be GII: bytes = "+n);let s=new TextDecoder("ascii").decode(e);if(s[0].charCodeAt(0)===31){const P=await Ve.decompress(new Uint8Array(e));e=P.buffer,s=new TextDecoder("ascii").decode(P.buffer)}let r=0;function a(){let P=!0,O=r;for(;P;){for(;r<n&&s[r]!=="<";)r++;for(O=r;r<n&&s[r]!==">";)r++;if(P=s[r-1]==="/",O+1<n&&s[O+1]==="/"&&(r+=1,P=!0),r>=n)break}const k=new TextDecoder().decode(e.slice(O+1,r)).trim(),q=k.split(" ")[0].trim(),U=r;let H=r,Y=r;if(s[O+1]!=="?"&&s[O+1]!=="!"){const Q="</"+q+">";H=s.indexOf(Q,U),Y=H+Q.length-1}return{name:k,startPos:O,contentStartPos:U,contentEndPos:H,endPos:Y}}let l=a();if(!l.name.startsWith("?xml"))throw new Error("readGII: Invalid XML file");for(;!l.name.startsWith("GIFTI")&&l.endPos<n;)l=a();if(!l.name.startsWith("GIFTI")||l.contentStartPos===l.contentEndPos)throw new Error("readGII: XML file does not include GIFTI tag");n=l.contentEndPos;let c=new Float32Array,h=new Uint32Array,d=new Float32Array,f="",p=!1,g=!1,y=!1,x=!1,b=[1,1,1];const w=[0,0,0];let S=0,C=!1,E=!1,D=0,M=!1;l.endPos=l.contentStartPos;let N="";function I(P,O=!1){const k=N.indexOf(P);if(k<0)return 1;const q=N.indexOf('"',k)+1,U=N.indexOf('"',q),H=N.slice(q,U);return O?parseFloat(H):parseInt(H)}function _(P){const O=N.indexOf(P);if(O<0)return"";const k=O+P.length,q=N.indexOf("]",k);return N.slice(k,q)}const F={R:[],G:[],B:[],A:[],I:[],labels:[]};for(;l.endPos<n&&l.name.length>1;){if(l=a(),l.name.startsWith("Label Key")&&(N=l.name,F.I.push(I("Key=")),F.R.push(Math.round(255*I("Red=",!0))),F.G.push(Math.round(255*I("Green=",!0))),F.B.push(Math.round(255*I("Blue=",!0))),F.A.push(Math.round(255*I("Alpha",!0))),N=new TextDecoder().decode(e.slice(l.contentStartPos+1,l.contentEndPos)).trim(),F.labels.push(_("<![CDATA["))),l.name.trim()==="Data"){if(y)continue;N=new TextDecoder().decode(e.slice(l.contentStartPos+1,l.contentEndPos)).trim();let P;if(E){const O=b[0]*b[1]*b[2],k=N.split(/\s+/);if(O!==k.length)throw new Error("Unable to parse ASCII GIfTI");if(S===2&&(S=8),S===32&&(S=16),S===8){P=new Int32Array(O);for(let q=0;q<O;q++)P[q]=parseInt(k[q])}if(S===16){P=new Float32Array(O);for(let q=0;q<O;q++)P[q]=parseFloat(k[q])}}else if(typeof Buffer>"u"){let O=function(k){const q=atob(k),U=q.length,H=new Uint8Array(U);for(let Y=0;Y<U;Y++)H[Y]=q.charCodeAt(Y);return H};if(C){const k=O(N.slice());P=await Ve.decompress(new Uint8Array(k))}else P=O(N.slice())}else if(C){const O=Buffer.from(N.slice(),"base64");P=await Ve.decompress(new Uint8Array(O))}else P=Buffer.from(N.slice(),"base64");if(g){if(S!==16&&X.warn("expect positions as FLOAT32"),c=new Float32Array(P.buffer),x){const O=c.slice(),k=O.length/3;let q=0;for(let U=0;U<k;U++)for(let H=0;H<3;H++)c[q]=O[H*k+U],q++}}else if(p){if(S!==8&&X.warn("expect indices as INT32"),h=new Uint32Array(P.buffer),x){const O=h.slice(),k=O.length/3;let q=0;for(let U=0;U<k;U++)for(let H=0;H<3;H++)h[q]=O[H*k+U],q++}}else{let O=function(q,U){const H=q.length,Y=new Float32Array(H+U.length);return Y.set(q),Y.set(U,H),Y};D=b[0]*b[1]*b[2],t!==0&&D%t!==0&&X.warn("Number of vertices in scalar overlay ("+D+") does not match mesh ("+t+")");let k;if(S===2){const q=new Uint8Array(P.buffer);k=Float32Array.from(q)}else if(S===8){const q=new Int32Array(P.buffer);k=Float32Array.from(q)}else if(S===16)k=new Float32Array(P.buffer);else if(S===32){const q=new Float64Array(P.buffer);k=Float32Array.from(q)}else throw new Error(`Invalid dataType: ${S}`);d=O(d,k)}continue}if(l.name.trim()==="DataSpace"&&(N=new TextDecoder().decode(e.slice(l.contentStartPos+1,l.contentEndPos)).trim(),N.includes("NIFTI_XFORM_SCANNER_ANAT")&&(M=!0)),l.name.trim()==="MD"&&(N=new TextDecoder().decode(e.slice(l.contentStartPos+1,l.contentEndPos)).trim(),N.includes("AnatomicalStructurePrimary")&&N.includes("CDATA[")&&(f=_("<Value><![CDATA[").toUpperCase()),N.includes("VolGeom")&&N.includes("CDATA["))){let P=-1;if(N.includes("VolGeomC_R")&&(P=0),N.includes("VolGeomC_A")&&(P=1),N.includes("VolGeomC_S")&&(P=2),P<0)continue;w[P]=parseFloat(_("<Value><![CDATA["))}l.name.startsWith("DataArray")&&(N=l.name,b=[1,1,1],C=N.includes('Encoding="GZipBase64Binary"'),E=N.includes('Encoding="ASCII"'),p=N.includes('Intent="NIFTI_INTENT_TRIANGLE"'),g=N.includes('Intent="NIFTI_INTENT_POINTSET"'),y=N.includes('Intent="NIFTI_INTENT_VECTOR"'),x=N.includes('ArrayIndexingOrder="ColumnMajorOrder"'),N.includes('DataType="NIFTI_TYPE_UINT8"')&&(S=2),N.includes('DataType="NIFTI_TYPE_INT32"')&&(S=8),N.includes('DataType="NIFTI_TYPE_FLOAT32"')&&(S=16),N.includes('DataType="NIFTI_TYPE_FLOAT64"')&&(S=32),b[0]=I("Dim0="),b[1]=I("Dim1="),b[2]=I("Dim2="))}let B;if(F.I.length>1&&(F.A.some(O=>O>0)||F.A.fill(255),B=yt.makeLabelLut(F)),t>0)return{scalars:d,colormapLabel:B,anatomicalStructurePrimary:f};if(c.length>2&&!M&&(w[0]!==0||w[1]!==0||w[2]!==0)){D=Math.floor(c.length/3);let P=0;for(let O=0;O<D;O++)c[P]+=w[0],P++,c[P]+=w[1],P++,c[P]+=w[2],P++}return{positions:c,indices:h,scalars:d,colormapLabel:B,anatomicalStructurePrimary:f}}},x1=class{constructor(i,e,t,n,s){G(this,"text"),G(this,"style"),G(this,"points"),G(this,"anchor"),G(this,"onClick"),this.text=i,this.style=e,this.points=t,this.anchor=n||0,this.onClick=s}},og=()=>{const i=new ArrayBuffer(2);return new DataView(i).setInt16(0,256,!0),new Int16Array(i)[0]===256},T3=(i=>(i[i.UNKNOWN=0]="UNKNOWN",i[i.NII=1]="NII",i[i.DCM=2]="DCM",i[i.DCM_MANIFEST=3]="DCM_MANIFEST",i[i.MIH=4]="MIH",i[i.MIF=5]="MIF",i[i.NHDR=6]="NHDR",i[i.NRRD=7]="NRRD",i[i.MHD=8]="MHD",i[i.MHA=9]="MHA",i[i.MGH=10]="MGH",i[i.MGZ=11]="MGZ",i[i.V=12]="V",i[i.V16=13]="V16",i[i.VMR=14]="VMR",i[i.HEAD=15]="HEAD",i[i.DCM_FOLDER=16]="DCM_FOLDER",i[i.SRC=17]="SRC",i[i.FIB=18]="FIB",i[i.BMP=19]="BMP",i[i.ZARR=20]="ZARR",i[i.NPY=21]="NPY",i[i.NPZ=22]="NPZ",i[i.HDR=23]="HDR",i))(T3||{}),Ye=Object.freeze({...T3,parse:i=>{let e=0;switch(i.toUpperCase()){case"":case"DCM":e=2;break;case"TXT":e=3;break;case"FZ":case"GQI":case"QSDR":case"FIB":e=18;break;case"HDR":case"NII":e=1;break;case"MIH":e=4;break;case"MIF":e=5;break;case"NHDR":e=6;break;case"NRRD":e=7;break;case"MHD":e=8;break;case"MHA":e=9;break;case"MGH":e=10;break;case"MGZ":e=11;break;case"NPY":e=21;break;case"NPZ":e=22;break;case"SRC":e=17;break;case"V":e=12;break;case"V16":e=13;break;case"VMR":e=14;break;case"HEAD":e=15;break;case"PNG":case"BMP":case"GIF":case"JPG":case"JPEG":e=19;break;case"ZARR":e=20;break}return e}}),dd=(i,e="",t="",n="gray",s=1,r=NaN,a=NaN,l=!0,c=.02,h=!1,d=!1,f="",p=0,g=Ye.UNKNOWN,y=NaN,x=NaN,b=!0,w=!1,S=null)=>({url:i,urlImageData:e,name:t,colormap:n,colorMap:n,opacity:s,cal_min:r,cal_max:a,trustCalMinMax:l,percentileFrac:c,ignoreZeroVoxels:h,useQFormNotSForm:d,colormapNegative:f,imageType:g,cal_minNeg:y,cal_maxNeg:x,colorbarVisible:b,frame4D:p,alphaThreshold:w,colormapLabel:S});function Mb(i,e=80){i=i.replace(/[`$]/g,"");const t=[],n=Math.min(e,i.length);for(let s=0;s<n;s++){const r=i.charCodeAt(s);t.push(r&255)}return t}function kd(i,e=!1,t=!1){let r=!0;t&&(r=i.littleEndian);const a=new Uint8Array(348),l=new DataView(a.buffer);l.setInt32(0,348,r),l.setUint8(38,114),l.setUint8(39,i.dim_info);for(let h=0;h<8;h++)l.setUint16(40+2*h,i.dims[h],r);l.setFloat32(56,i.intent_p1,r),l.setFloat32(60,i.intent_p2,r),l.setFloat32(64,i.intent_p3,r),l.setInt16(68,i.intent_code,r),e?(l.setInt16(70,2,r),l.setInt16(72,8,r)):(l.setInt16(70,i.datatypeCode,r),l.setInt16(72,i.numBitsPerVoxel,r)),l.setInt16(74,i.slice_start,r);for(let h=0;h<8;h++)l.setFloat32(76+4*h,i.pixDims[h],r);e?(l.setFloat32(108,352,r),l.setFloat32(112,1,r),l.setFloat32(116,0,r)):(l.setFloat32(108,i.vox_offset,r),l.setFloat32(112,i.scl_slope,r),l.setFloat32(116,i.scl_inter,r)),l.setInt16(120,i.slice_end,r),l.setUint8(122,i.slice_code),i.xyzt_units===0?l.setUint8(123,10):l.setUint8(123,i.xyzt_units),e?(l.setFloat32(124,0,r),l.setFloat32(128,0,r)):(l.setFloat32(124,i.cal_max,r),l.setFloat32(128,i.cal_min,r)),l.setFloat32(132,i.slice_duration,r),l.setFloat32(136,i.toffset,r),a.set(Mb(i.description),148),a.set(Mb(i.aux_file),228),l.setInt16(252,i.qform_code,r),i.sform_code<1||i.sform_code<1?l.setInt16(254,1,r):l.setInt16(254,i.sform_code,r),l.setFloat32(256,i.quatern_b,r),l.setFloat32(260,i.quatern_c,r),l.setFloat32(264,i.quatern_d,r),l.setFloat32(268,i.qoffset_x,r),l.setFloat32(272,i.qoffset_y,r),l.setFloat32(276,i.qoffset_z,r);const c=i.affine.flat();for(let h=0;h<12;h++)l.setFloat32(280+4*h,c[h],r);return l.setInt32(344,3222382,!0),a}function zF(i,e=!0){const t=Math.round(i.length/3),n=Ae(0,0,0),s=bt(),r=bt();let a=0,l=1;e&&(l=2);for(let f=0;f<l;f++){a=0;for(let g=0;g<t;g++){const y=Ae(i[g*3],i[g*3+1],i[g*3+2]);g===0&&(rb(s,y),rb(r,y)),t1(s,s,y),i1(r,r,y),It(y,y,n);const x=Oc(y);a=Math.max(a,x)}if(f+1>=l)break;let p=!0;for(let g=0;g<3;++g)s[g]>n[g]&&(p=!1),r[g]<n[g]&&(p=!1);if(p)break;jN(n,s,r,.5),X.debug("origin moved inside volume: ",n)}const c=[s[0],s[1],s[2]],h=[r[0],r[1],r[2]];return{min:c,max:h,furthestVertexFromOrigin:a,origin:n}}function M3(i){const e=[!1,!1,!1,!1],t=[!1,!1,!1,!1];for(let n=0;n<4;n++)for(let s=0;s<4;s++)if(isNaN(i[n][s]))return!1;for(let n=0;n<3;n++)for(let s=0;s<3;s++)i[n][s]!==0&&(e[n]=!0,t[s]=!0);for(let n=0;n<3;n++)if(!e[n]||!t[n])return!1;return!0}async function b1(i){const e=i.getReader(),{done:t,value:n}=await e.read();if(t)return e.releaseLock(),new ReadableStream({start(a){a.close()}});if(!n||n.length<2)return e.releaseLock(),new ReadableStream({start(a){n&&a.enqueue(n),a.close()}});const s=n[0]===31&&n[1]===139,r=new ReadableStream({async start(a){try{for(a.enqueue(n);;){const{done:l,value:c}=await e.read();if(l){a.close(),e.releaseLock();break}a.enqueue(c)}}catch(l){a.error(l),e.releaseLock()}}});return s?r.pipeThrough(new DecompressionStream("gzip")):r}function D3(i=[256,256,256],e=[1,1,1],t=[1,0,0,-128,0,1,0,-128,0,0,1,-128,0,0,0,1],n=2){const s=new be;s.littleEndian=!0,s.dims=[3,1,1,1,0,0,0,0],s.dims[0]=Math.max(3,i.length);for(let a=0;a<i.length;a++)s.dims[a+1]=i[a];s.pixDims=[1,1,1,1,1,0,0,0];for(let a=0;a<i.length;a++)s.pixDims[a+1]=e[a];if(t.length===16){let a=0;for(let l=0;l<4;l++)for(let c=0;c<4;c++)s.affine[l][c]=t[a],a++}let r=8;return n===256||n===2?r=8:n===512||n===4?r=16:n===16||n===768||n===8||n===2304?r=32:n===64?r=64:X.warn("Unsupported NIfTI datatypeCode for header creation: "+n),s.datatypeCode=n,s.numBitsPerVoxel=r,s.scl_inter=0,s.scl_slope=1,s.sform_code=2,s.magic="n+1",s.vox_offset=352,s}function GF(i=[256,256,256],e=[1,1,1],t=[1,0,0,-128,0,1,0,-128,0,0,1,-128,0,0,0,1],n=2,s=new Uint8Array){const r=D3(i,e,t,n),a=kd(r,!1);r.vox_offset=Math.max(352,a.length);const l=kd(r,!1);if(s.length<1)return l;const c=Math.max(0,r.vox_offset-l.length),h=new Uint8Array(c),d=new Uint8Array(s.buffer,s.byteOffset,s.byteLength),f=r.vox_offset+d.length,p=new Uint8Array(f);return p.set(l,0),p.set(h,l.length),p.set(d,r.vox_offset),p}function R3(i,e=null){if(!i.hdr)throw new Error("NVImage header is not defined for toUint8Array");if(!i.img&&e===null)throw new Error("NVImage image data is not defined for toUint8Array");const t=e!==null,n=JSON.parse(JSON.stringify(i.hdr)),s=i.extensions&&i.extensions.length>0,r=new Uint8Array(4);r[0]=s?1:0;let a=new Uint8Array(0);if(s){const b=[];let w=0;for(const C of i.extensions){const E=new Uint8Array(C.edata),D=new Uint8Array(8+E.length),M=new DataView(D.buffer);M.setInt32(0,C.esize,!0),M.setInt32(4,C.ecode,!0),D.set(E,8),b.push(D),w+=D.length}a=new Uint8Array(w);let S=0;for(const C of b)a.set(C,S),S+=C.length}const l=348;n.vox_offset=Math.max(352,l+r.length+a.length),t&&(n.datatypeCode=2,n.numBitsPerVoxel=8,n.scl_slope=1,n.scl_inter=0);const c=kd(n,t);let h;if(t){const b=e,w=i.permRAS;if(w&&(w[0]!==1||w[1]!==2||w[2]!==3)){X.debug("Reorienting drawing bytes back to native space for saving...");const S=i.hdr.dims,C=S[1]*S[2]*S[3],E=i.dimsRAS?i.dimsRAS[1]*i.dimsRAS[2]*i.dimsRAS[3]:C;if(b.length!==E)console.warn(`Drawing length (${b.length}) does not match expected RAS voxel count (${E}). Cannot reorient drawing reliably.`),h=b;else if(!i.img2RASstep||!i.img2RASstart||!i.dimsRAS)console.warn("Missing RAS transformation info (img2RASstep, img2RASstart, dimsRAS). Cannot reorient drawing reliably."),h=b;else{const D=i.img2RASstep,M=i.img2RASstart,N=i.dimsRAS,I=new Uint8Array(C);I.fill(0);const _=b;let F=0;for(let B=0;B<N[3];B++){const P=M[2]+B*D[2];for(let O=0;O<N[2];O++){const k=M[1]+O*D[1];for(let q=0;q<N[1];q++){const H=M[0]+q*D[0]+k+P;H>=0&&H<C?I[H]=_[F]:F<_.length&&console.warn(`Calculated native index ${H} is out of bounds [0..${C-1}] during drawing reorientation.`),F++}}}h=I}}else h=b}else{if(!i.img)throw new Error("NVImage image data is null when trying to save non-drawing.");h=new Uint8Array(i.img.buffer,i.img.byteOffset,i.img.byteLength)}const d=c.length+r.length+a.length,f=Math.max(0,n.vox_offset-d),p=new Uint8Array(f),g=n.vox_offset+h.length,y=new Uint8Array(g);let x=0;return y.set(c,x),x+=c.length,y.set(r,x),x+=r.length,y.set(a,x),x+=a.length,y.set(p,x),x+=p.length,y.set(h,n.vox_offset),y}async function N3(i,e,t=null){const n=R3(i,t);if(e.toLowerCase().endsWith(".gz"))try{const r=await Ve.compress(n,"gzip");return new Uint8Array(r)}catch(r){return X.error("Compression failed:",r),X.warn("Returning uncompressed data due to compression error."),n}else return n}async function HF(i,e="",t=null){const n=await N3(i,e,t);if(!e)return X.debug("saveToDisk: empty file name, returning data as Uint8Array rather than triggering download"),n;try{const s=new Blob([n.buffer],{type:"application/octet-stream"}),r=URL.createObjectURL(s),a=document.createElement("a");a.setAttribute("href",r),a.setAttribute("download",e),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(()=>URL.revokeObjectURL(r),100)}catch(s){X.error("Failed to trigger download:",s)}return n}function I3(i,e,t,n,s=0,r=!1){if(!i.hdr)throw new Error("getValue: NVImage header is not defined.");if(!r&&!i.img)throw new Error("getValue: NVImage image data is not defined.");if(r&&!i.imaginary)return X.warn("getValue: Attempted to read imaginary data, but none exists."),[0];const a=i.hdr.dims[1],l=i.hdr.dims[2],c=i.hdr.dims[3],h=i.permRAS.slice();if(h[0]!==1||h[1]!==2||h[2]!==3){const S=Lt(e,t,n,1);Pi(S,S,i.toRASvox),e=S[0],t=S[1],n=S[2]}e=Math.max(0,Math.min(Math.round(e),a-1)),t=Math.max(0,Math.min(Math.round(t),l-1)),n=Math.max(0,Math.min(Math.round(n),c-1)),s=Math.max(0,s);let d=e+t*a+n*a*l;if(i.hdr.datatypeCode===2304)return i.img?(d*=4,d+3>=i.img.length?(X.warn(`getValue: Calculated index ${d} out of bounds for RGBA data.`),[0]):[i.img[d],i.img[d+1],i.img[d+2],i.img[d+3]]):[0];if(i.hdr.datatypeCode===128)return i.img?(d*=3,d+2>=i.img.length?(X.warn(`getValue: Calculated index ${d} out of bounds for RGB data.`),[0]):[i.img[d],i.img[d+1],i.img[d+2]]):[0];const f=a*l*c,p=s*f,g=d+p,y=r?i.imaginary:i.img;if(g<0||g>=y.length)return[0];const x=y[g],b=isNaN(i.hdr.scl_slope)||i.hdr.scl_slope===0?1:i.hdr.scl_slope,w=isNaN(i.hdr.scl_inter)?0:i.hdr.scl_inter;return[b*x+w]}function YF(i,e,t,n,s=0,r=!1){const a=I3(i,e,t,n,s,r);return a.length<3?a[0]:a[0]*.2126+a[1]*.7152+a[2]*.0722}function qF(i,e=[-1,0,0],t=[0,0,0],n="same"){const s=[new Uint8Array,[0,0,0]];if(!i.hdr||!i.img||!i.dimsRAS||!i.img2RASstep||!i.img2RASstart)return X.error("getVolumeData: Missing required NVImage properties (hdr, img, dimsRAS, img2RASstep/start)."),s;if(e=e.slice(0,3),t=t.slice(0,3),Math.min(...e)<0||Math.min(...t)<0)return X.warn("getVolumeData: Invalid start or end coordinates provided."),s;const r=i.dimsRAS.slice(1,4);for(let b=0;b<3;b++)if(e[b]=Math.max(0,Math.min(Math.round(e[b]),r[b]-1)),t[b]=Math.max(0,Math.min(Math.round(t[b]),r[b]-1)),t[b]<e[b]){const w=t[b];t[b]=e[b],e[b]=w}const a=[t[0]-e[0]+1,t[1]-e[1]+1,t[2]-e[2]+1],l=a[0]*a[1]*a[2];if(l<=0)return X.warn("getVolumeData: Calculated slab size is zero or negative."),s;let c=i.img.constructor;n==="uint8"?c=Uint8Array:n==="int16"?c=Int16Array:n==="uint16"?c=Uint16Array:n==="float32"||n==="scaled"||n==="normalized"||n==="windowed"?c=Float32Array:n==="float64"?c=Float64Array:n!=="same"&&X.warn(`getVolumeData: Unsupported dataType '${n}'. Using 'same'.`);let h;try{h=new c(l)}catch(b){return X.error(`getVolumeData: Failed to create output array for dataType '${n}'.`,b),s}const d=i.img2RASstep,f=i.img2RASstart,p=i.img;let g=0;for(let b=e[2];b<=t[2];b++){const w=f[2]+b*d[2];for(let S=e[1];S<=t[1];S++){const C=f[1]+S*d[1];for(let E=e[0];E<=t[0];E++){const M=f[0]+E*d[0]+C+w;let N=0;M>=0&&M<p.length&&(N=p[M]),h[g++]=N}}}const y=isNaN(i.hdr.scl_slope)||i.hdr.scl_slope===0?1:i.hdr.scl_slope,x=isNaN(i.hdr.scl_inter)?0:i.hdr.scl_inter;if(n==="scaled"||n==="normalized"||n==="windowed"){h instanceof Float32Array||(X.warn(`getVolumeData: Converting output to Float32 for scaling type '${n}'.`),h=Float32Array.from(h));for(let b=0;b<h.length;b++)h[b]=h[b]*y+x}if(n==="normalized"||n==="windowed"){let b=i.cal_min,w=i.cal_max;n==="normalized"&&(b=i.global_min,w=i.global_max);const S=w-b,C=S===0?0:1/S;for(let E=0;E<h.length;E++)h[E]=(h[E]-b)*C,h[E]=Math.max(0,Math.min(h[E],1))}return[h,a]}function XF(i,e=[-1,0,0],t=[0,0,0],n=new Uint8Array){if(!i.hdr||!i.img||!i.dimsRAS||!i.img2RASstep||!i.img2RASstart){X.error("setVolumeData: Missing required NVImage properties (hdr, img, dimsRAS, img2RASstep/start).");return}if(n.length<1){X.warn("setVolumeData: Input slabData is empty.");return}if(e=e.slice(0,3),t=t.slice(0,3),Math.min(...e)<0||Math.min(...t)<0){X.warn("setVolumeData: Invalid start or end coordinates provided.");return}const s=i.dimsRAS.slice(1,4);for(let f=0;f<3;f++)if(e[f]=Math.max(0,Math.min(Math.round(e[f]),s[f]-1)),t[f]=Math.max(0,Math.min(Math.round(t[f]),s[f]-1)),t[f]<e[f]){const p=t[f];t[f]=e[f],e[f]=p}const r=[t[0]-e[0]+1,t[1]-e[1]+1,t[2]-e[2]+1],a=r[0]*r[1]*r[2];if(a<=0){X.warn("setVolumeData: Calculated slab size is zero or negative.");return}if(n.length<a){X.error(`setVolumeData: Input slabData length (${n.length}) is less than the calculated slab size (${a}).`);return}const l=i.img2RASstep,c=i.img2RASstart,h=i.img;let d=0;for(let f=e[2];f<=t[2];f++){const p=c[2]+f*l[2];for(let g=e[1];g<=t[1];g++){const y=c[1]+g*l[1];for(let x=e[0];x<=t[0];x++){const w=c[0]+x*l[0]+y+p;w>=0&&w<h.length&&(h[w]=n[d]),d++}}}}var lg={};Hi(lg,{readHEAD:()=>QF});function Uh(i,e){const t=Qt(e);sn(t,t);const n=Lt(i[0],i[1],i[2],1);return Pi(n,n,t),Ae(n[0],n[1],n[2])}function WF(i){if(!i.hdr)throw new Error("hdr not defined");const e=i.hdr.affine,t=Vn(e[0][0],e[0][1],e[0][2],e[0][3],e[1][0],e[1][1],e[1][2],e[1][3],e[2][0],e[2][1],e[2][2],e[2][3],e[3][0],e[3][1],e[3][2],e[3][3]),n=Uh([0,0,0],t),s=Uh([1,0,0],t);It(s,s,n);const r=Uh([0,1,0],t);It(r,r,n);const a=Uh([0,0,1],t);It(a,a,n),i.hdr.pixDims[1]=Fr(s),i.hdr.pixDims[2]=Fr(r),i.hdr.pixDims[3]=Fr(a)}function KF(i,e,t,n){const s=i.hdr;if(s===null)throw new Error("HDR is not set");s.sform_code=2;const r="xxyyzzg";let a=-1,l=-1,c=-1;const h=["x","y","z"];h[0]=r[n[0]],h[1]=r[n[1]],h[2]=r[n[2]];const d=e.slice(0,3),f=t.slice(0,3);for(let p=0;p<3;p++)h[p]==="x"?a=p:h[p]==="y"?l=p:c=p;a<0||l<0||c<0||a===l||a===c||l===c||(s.pixDims[1]=Math.abs(d[0]),s.pixDims[2]=Math.abs(d[1]),s.pixDims[3]=Math.abs(d[2]),s.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],s.affine[0][a]=-d[a],s.affine[1][l]=-d[l],s.affine[2][c]=d[c],s.affine[0][3]=-f[a],s.affine[1][3]=-f[l],s.affine[2][3]=f[c])}async function QF(i,e,t){i.hdr=new be;const n=i.hdr;n.dims[0]=3,n.pixDims=[1,1,1,1,1,0,0,0];let s=[0,0,0],r=[0,0,0],a=[1,1,1];const c=new TextDecoder().decode(e).split(/\r?\n/),h=(e.byteLength+8)%16,d=e.byteLength+(16-h);X.debug(e.byteLength,"len",d);const f=new ArrayBuffer(d);new Uint8Array(f).set(new Uint8Array(e));const p=new f3(d+8,42,f,!0);n.addExtension(p),n.extensionCode=42,n.extensionFlag[0]=1,n.extensionSize=d+8;const g=c.length;let y=0,x=!1;for(;y<g;){let w=c[y];if(y++,!w.startsWith("type"))continue;const S=w.includes("integer-attribute"),C=w.includes("float-attribute");if(w=c[y],y++,!w.startsWith("name"))continue;let E=w.split("= ");const D=E[1];w=c[y],y++,E=w.split("= ");let M=parseInt(E[1]);if(!(M<1)){if(w=c[y],y++,E=w.trim().split(/\s+/),C||S){for(;E.length<M;){w=c[y],y++;const N=w.trim().split(/\s+/);E.push(...N)}for(let N=0;N<M;N++)E[N]=parseFloat(E[N])}switch(D){case"BYTEORDER_STRING":E[0].includes("LSB_FIRST")?n.littleEndian=!0:E[0].includes("MSB_FIRST")&&(n.littleEndian=!1);break;case"BRICK_TYPES":{n.dims[4]=M;const N=parseInt(E[0]);N===0?(n.numBitsPerVoxel=8,n.datatypeCode=2):N===1?(n.numBitsPerVoxel=16,n.datatypeCode=4):N===3?(n.numBitsPerVoxel=32,n.datatypeCode=16):X.warn("Unknown BRICK_TYPES ",N)}break;case"IJK_TO_DICOM_REAL":if(M<12)break;x=!0,n.sform_code=2,n.affine=[[-E[0],-E[1],-E[2],-E[3]],[-E[4],-E[5],-E[6],-E[7]],[E[8],E[9],E[10],E[11]],[0,0,0,1]];break;case"DATASET_DIMENSIONS":M=Math.max(M,3);for(let N=0;N<M;N++)n.dims[N+1]=E[N];break;case"ORIENT_SPECIFIC":s=E;break;case"ORIGIN":r=E;break;case"DELTA":a=E;break;case"TAXIS_FLOATS":n.pixDims[4]=E[0];break;default:X.warn("Unknown:",D)}}}x?WF(i):KF(i,a,r,s);const b=n.numBitsPerVoxel/8*n.dims[1]*n.dims[2]*n.dims[3]*n.dims[4];if(!t)throw new Error("pairedImgData not set");return t.byteLength<b?await Ve.decompressToBuffer(new Uint8Array(t)):t.slice(0)}var uc={};Hi(uc,{readV16:()=>ZF,readVMR:()=>JF});function ZF(i,e){i.hdr=new be;const t=i.hdr;t.dims=[3,1,1,1,0,0,0,0],t.pixDims=[1,1,1,1,1,0,0,0];const n=new DataView(e);return t.dims[1]=n.getUint16(0,!0),t.dims[2]=n.getUint16(2,!0),t.dims[3]=n.getUint16(4,!0),2*t.dims[1]*t.dims[2]*t.dims[3]+6!==e.byteLength&&X.warn("This does not look like a valid BrainVoyager V16 file"),t.numBitsPerVoxel=16,t.datatypeCode=512,X.warn("Warning: V16 files have no spatial transforms"),t.affine=[[0,0,-t.pixDims[1],(t.dims[1]-2)*.5*t.pixDims[1]],[-t.pixDims[2],0,0,(t.dims[2]-2)*.5*t.pixDims[2]],[0,-t.pixDims[3],0,(t.dims[3]-2)*.5*t.pixDims[3]],[0,0,0,1]],t.littleEndian=!0,e.slice(6)}function JF(i,e){i.hdr=new be;const t=i.hdr;t.dims=[3,1,1,1,0,0,0,0],t.pixDims=[1,1,1,1,1,0,0,0];const n=new DataView(e),s=n.getUint16(0,!0);s!==4&&X.warn("Not a valid version 4 VMR image"),t.dims[1]=n.getUint16(2,!0),t.dims[2]=n.getUint16(4,!0),t.dims[3]=n.getUint16(6,!0);const r=t.dims[1]*t.dims[2]*t.dims[3];if(s>=4){let a=8+r;const l=n.getUint32(a+88,!0);if(a=a+92,l>0){const c=e.byteLength;for(let h=0;h<l;h++){for(;a<c&&n.getUint8(a)!==0;)a++;for(a++,a+=4;a<c&&n.getUint8(a)!==0;)a++;a++;const d=n.getUint32(a,!0);a+=4;for(let f=0;f<d;f++)a+=4}}t.pixDims[1]=n.getFloat32(a+2,!0),t.pixDims[2]=n.getFloat32(a+6,!0),t.pixDims[3]=n.getFloat32(a+10,!0)}return X.warn("Warning: VMR spatial transform not implemented"),t.affine=[[0,0,-t.pixDims[1],(t.dims[1]-2)*.5*t.pixDims[1]],[-t.pixDims[2],0,0,(t.dims[2]-2)*.5*t.pixDims[2]],[0,-t.pixDims[3],0,(t.dims[3]-2)*.5*t.pixDims[3]],[0,0,0,1]],X.debug(t),t.numBitsPerVoxel=8,t.datatypeCode=2,e.slice(8,8+r)}var hc={};Hi(hc,{readFIB:()=>$F,readSRC:()=>eP});async function $F(i,e){i.hdr=new be;const t=i.hdr;t.littleEndian=!1,t.dims=[3,1,1,1,0,0,0,0],t.pixDims=[1,1,1,1,1,0,0,0];const n=await Ve.readMatV4(e,!0);if(!("dimension"in n)||!("dti_fa"in n))throw new Error("Not a valid DSIstudio FIB file");const s="index0"in n&&"index1"in n&&"index2"in n&&"odf_vertices"in n;t.numBitsPerVoxel=32,t.datatypeCode=16,t.dims[1]=n.dimension[0],t.dims[2]=n.dimension[1],t.dims[3]=n.dimension[2],t.dims[4]=1,t.pixDims[1]=n.voxel_size[0],t.pixDims[2]=n.voxel_size[1],t.pixDims[3]=n.voxel_size[2],t.sform_code=1;const r=(t.dims[1]-1)*.5*t.pixDims[1],a=(t.dims[2]-1)*.5*t.pixDims[2],l=(t.dims[3]-1)*.5*t.pixDims[3];t.affine=[[t.pixDims[1],0,0,-r],[0,-t.pixDims[2],0,a],[0,0,t.pixDims[2],-l],[0,0,0,1]],t.littleEndian=!0;const c=t.dims[1]*t.dims[2]*t.dims[3],h=c*Math.ceil(t.numBitsPerVoxel/8),d=h*t.dims[4],f=new Uint8Array(new ArrayBuffer(c*4*3));if(s){const x=t.dims[1]*t.dims[2]*t.dims[3],b=new Float32Array(x),w=new Float32Array(x),S=new Float32Array(x),C=n.index0,E=n.odf_vertices;for(let D=0;D<x;D++){const M=C[D]*3;b[D]=E[M+0],w[D]=E[M+1],S[D]=-E[M+2]}f.set(new Uint8Array(b.buffer,b.byteOffset,b.byteLength),0*h),f.set(new Uint8Array(w.buffer,w.byteOffset,w.byteLength),1*h),f.set(new Uint8Array(S.buffer,S.byteOffset,S.byteLength),2*h)}"report"in n&&(t.description=new TextDecoder().decode(n.report.subarray(0,Math.min(79,n.report.byteLength))));const p=new Uint8Array(new ArrayBuffer(d)),g=Float32Array.from(n.dti_fa);if("mask"in n){let x=1;"dti_fa_slope"in n&&(x=n.dti_fa_slope[0]);let b=1;"dti_fa_inter"in n&&(b=n.dti_fa_inter[0]);const w=t.dims[1]*t.dims[2]*t.dims[3],S=n.mask,C=new Float32Array(w);let E=0;for(let D=0;D<w;D++)S[D]!==0&&(C[D]=g[E]*x+b,E++);return[C.buffer,new Float32Array(f.buffer)]}const y=new Uint8Array(g.buffer,g.byteOffset,g.byteLength);return p.set(y,0),[p.buffer,new Float32Array(f.buffer)]}async function eP(i,e){i.hdr=new be;const t=i.hdr;t.littleEndian=!1,t.dims=[3,1,1,1,0,0,0,0],t.pixDims=[1,1,1,1,1,0,0,0];const n=await Ve.readMatV4(e);if(!("dimension"in n)||!("image0"in n))throw new Error("Not a valid DSIstudio SRC file");let s=0,r=0;for(const[g,y]of Object.entries(n))if(g.startsWith("image")){if(s===0?r=y.length:r!==y.length&&(r=-1),y.constructor!==Uint16Array)throw new Error("DSIstudio SRC files always use Uint16 datatype");s++}if(r<1||s<1)throw new Error("SRC file not valid DSI Studio data. The image(s) should have the same length");t.numBitsPerVoxel=16,t.datatypeCode=512,t.dims[1]=n.dimension[0],t.dims[2]=n.dimension[1],t.dims[3]=n.dimension[2],t.dims[4]=s,t.dims[4]>1&&(t.dims[0]=4),t.pixDims[1]=n.voxel_size[0],t.pixDims[2]=n.voxel_size[1],t.pixDims[3]=n.voxel_size[2],t.sform_code=1;const a=(t.dims[1]-1)*.5*t.pixDims[1],l=(t.dims[2]-1)*.5*t.pixDims[2],c=(t.dims[3]-1)*.5*t.pixDims[3];t.affine=[[t.pixDims[1],0,0,-a],[0,-t.pixDims[2],0,l],[0,0,t.pixDims[2],-c],[0,0,0,1]],t.littleEndian=!0;const h=t.dims[1]*t.dims[2]*t.dims[3]*(t.numBitsPerVoxel/8),d=h*t.dims[4],f=new Uint8Array(new ArrayBuffer(d));let p=0;for(let g=0;g<s;g++){const y=n[`image${g}`],x=new Uint8Array(y.buffer,y.byteOffset,y.byteLength);f.set(x,p),p+=h}return"report"in n&&(t.description=new TextDecoder().decode(n.report.subarray(0,Math.min(79,n.report.byteLength)))),f.buffer}var cg={};Hi(cg,{readECAT:()=>tP});function tP(i,e){i.hdr=new be;const t=i.hdr;t.dims=[3,1,1,1,0,0,0,0],t.pixDims=[1,1,1,1,1,0,0,0];const n=new DataView(e),s=n.getInt32(0,!1),r=n.getInt16(50,!1);if(s!==1296127058||r<1||r>14)throw new Error("Not a valid ECAT file");let a=512,l=0;const c=[];let h=new Float32Array;for(;;){const d=n.getInt32(a,!1),f=n.getInt32(a+12,!1);if(d+f!==31)break;let p=a+20,g=0,y=0;for(;g<31&&(y=n.getInt32(p,!1),p+=16,y!==0);){g++;let x=y*512;const b=x-512,w=n.getUint16(b,!1);t.dims[1]=n.getUint16(b+4,!1),t.dims[2]=n.getUint16(b+6,!1),t.dims[3]=n.getUint16(b+8,!1);const S=n.getFloat32(b+26,!1);t.pixDims[1]=n.getFloat32(b+34,!1)*10,t.pixDims[2]=n.getFloat32(b+38,!1)*10,t.pixDims[3]=n.getFloat32(b+42,!1)*10,t.pixDims[4]=n.getUint32(b+46,!1)/1e3,c.push(t.pixDims[4]);const C=t.dims[1]*t.dims[2]*t.dims[3],E=new Float32Array(C);if(w===1)for(let M=0;M<C;M++)E[M]=n.getUint8(x)*S,x++;else if(w===6)for(let M=0;M<C;M++)E[M]=n.getUint16(x,!1)*S,x+=2;else if(w===7)for(let M=0;M<C;M++)E[M]=n.getUint32(x,!1)*S,x+=4;else X.warn("Unknown ECAT data type "+w);const D=h.slice(0);h=new Float32Array(D.length+E.length),h.set(D),h.set(E,D.length),l++}if(y===0)break;a+=512}if(t.dims[4]=l,t.pixDims[4]=c[0],l>1){t.dims[0]=4;let d=!1;for(let f=0;f<l;f++)c[f]!==c[0]&&(d=!0);d&&X.warn("Frame durations vary")}return t.sform_code=1,t.affine=[[-t.pixDims[1],0,0,(t.dims[1]-2)*.5*t.pixDims[1]],[0,-t.pixDims[2],0,(t.dims[2]-2)*.5*t.pixDims[2]],[0,0,-t.pixDims[3],(t.dims[3]-2)*.5*t.pixDims[3]],[0,0,0,1]],t.numBitsPerVoxel=32,t.datatypeCode=16,h.buffer}var fd={};Hi(fd,{imageDataFromArrayBuffer:()=>_3,readBMP:()=>iP});async function _3(i){return new Promise((e,t)=>{const n=new Blob([i]),s=URL.createObjectURL(n),r=new Image;r.crossOrigin="Anonymous",r.src=s,r.onload=()=>{URL.revokeObjectURL(s);const a=document.createElement("canvas");a.width=r.width,a.height=r.height;const l=a.getContext("2d");if(!l){t(new Error("Failed to get 2D context"));return}l.drawImage(r,0,0),e(l.getImageData(0,0,r.width,r.height))},r.onerror=a=>{URL.revokeObjectURL(s),t(a)}})}async function iP(i,e){const t=await _3(e),{width:n,height:s,data:r}=t;i.hdr=new be;const a=i.hdr;a.dims=[3,n,s,1,0,0,0,0],a.pixDims=[1,1,1,1,1,0,0,0],a.affine=[[a.pixDims[1],0,0,-(a.dims[1]-2)*.5*a.pixDims[1]],[0,-a.pixDims[2],0,(a.dims[2]-2)*.5*a.pixDims[2]],[0,0,-a.pixDims[3],(a.dims[3]-2)*.5*a.pixDims[3]],[0,0,0,1]],a.numBitsPerVoxel=8,a.datatypeCode=2304;let l=!0;for(let c=0;c<r.length;c+=4)if(r[c]!==r[c+1]||r[c]!==r[c+2]){l=!1;break}if(l){a.datatypeCode=2;const c=new Uint8Array(n*s);for(let h=0,d=0;h<r.length;h+=4,d++)c[d]=r[h];return c.buffer}return r.buffer}var ug={};Hi(ug,{readMHA:()=>nP});async function nP(i,e,t){const n=e.byteLength;if(n<20)throw new Error("File too small to be VTK: bytes = "+e.byteLength);const s=new Uint8Array(e);let r=0;function a(x){return x===10||x===13}function l(){for(;r<n&&a(s[r]);)r++;const x=r;for(;r<n&&!a(s[r]);)r++;return r-x<2?"":new TextDecoder().decode(e.slice(x,r))}let c=l();i.hdr=new be;const h=i.hdr;h.pixDims=[1,1,1,1,1,0,0,0],h.dims=[1,1,1,1,1,1,1,1],h.littleEndian=!0;let d=!1,f=!1;const p=Nr(NaN,0,0,0,1,0,0,0,1),g=Ae(0,0,0);for(;c!=="";){let x=c.split(" ");if(x.length>2&&(x=x.slice(2)),c.startsWith("BinaryDataByteOrderMSB")&&x[0].includes("False")&&(h.littleEndian=!0),c.startsWith("BinaryDataByteOrderMSB")&&x[0].includes("True")&&(h.littleEndian=!1),c.startsWith("CompressedData")&&x[0].includes("True")&&(d=!0),c.startsWith("TransformMatrix"))for(let b=0;b<9;b++)p[b]=parseFloat(x[b]);if(c.startsWith("Offset"))for(let b=0;b<Math.min(x.length,3);b++)g[b]=parseFloat(x[b]);if(c.startsWith("ElementSpacing"))for(let b=0;b<x.length;b++)h.pixDims[b+1]=parseFloat(x[b]);if(c.startsWith("DimSize")){h.dims[0]=x.length;for(let b=0;b<x.length;b++)h.dims[b+1]=parseInt(x[b])}if(c.startsWith("ElementType"))switch(x[0]){case"MET_UCHAR":h.numBitsPerVoxel=8,h.datatypeCode=2;break;case"MET_CHAR":h.numBitsPerVoxel=8,h.datatypeCode=256;break;case"MET_SHORT":h.numBitsPerVoxel=16,h.datatypeCode=4;break;case"MET_USHORT":h.numBitsPerVoxel=16,h.datatypeCode=512;break;case"MET_INT":h.numBitsPerVoxel=32,h.datatypeCode=8;break;case"MET_UINT":h.numBitsPerVoxel=32,h.datatypeCode=768;break;case"MET_FLOAT":h.numBitsPerVoxel=32,h.datatypeCode=16;break;case"MET_DOUBLE":h.numBitsPerVoxel=64,h.datatypeCode=64;break;default:throw new Error("Unsupported MHA data type: "+x[0])}if(c.startsWith("ObjectType")&&!x[0].includes("Image")&&X.warn("Only able to read ObjectType = Image, not "+c),c.startsWith("ElementDataFile")){x[0]!=="LOCAL"&&(f=!0);break}c=l()}const y=Nr(h.pixDims[1],0,0,0,h.pixDims[2],0,0,0,h.pixDims[3]);for(J5(p,p,y),h.affine=[[-p[0],-p[3],-p[6],-g[0]],[-p[1],-p[4],-p[7],-g[1]],[p[2],p[5],p[8],g[2]],[0,0,0,1]];s[r]===10;)r++;return h.vox_offset=r,f&&t?d?await Ve.decompressToBuffer(new Uint8Array(t.slice(0))):t.slice(0):d?await Ve.decompressToBuffer(new Uint8Array(e.slice(h.vox_offset))):e.slice(h.vox_offset)}var F3={};Hi(F3,{isFreeSurferLabelImage:()=>B3,optimizeFreeSurferLabels:()=>P3,readMgh:()=>sP});function Db(i,e,t,n=1){const s=e+t;let r=e;const a=[];for(;r+12<=s;){const l=i.getInt32(r,!1),c=i.getInt32(r+8,!1);if(r+=12,c<=0||r+c>s)break;if(l!==n){r+=c;continue}let h=c,d=r;if(n===1){if(r+4>s)break;h=i.getInt32(r,!1),d+=4}if(h>1&&d+h<=s){const f=new Uint8Array(i.buffer,d,h),p=new TextDecoder("utf-8").decode(f.slice(0,-1));a.push(p)}r+=c}return a.join(`

`)}function P3(i,e){if(i.intent_code=1002,i.datatypeCode!==16&&i.datatypeCode!==8)return e;let t=new Float32Array(e);if(i.datatypeCode===8&&(t=new Int32Array(e)),og()){const a=new Uint32Array(e);for(let l=0;l<a.length;l++){const c=a[l];a[l]=(c&255)<<24|(c&65280)<<8|(c&16711680)>>>8|(c&4278190080)>>>24}}i.littleEndian=og();let n=!0,s=1/0,r=-1/0;for(let a=0;a<t.length;a++){const l=t[a];Number.isFinite(l)&&(Number.isInteger(l)||(n=!1),l<s&&(s=l),l>r&&(r=l))}if(!n||s<0||r>2147483647)return X.warn(`FreeSurfer Labels must be integers in INT32 range. range ${s}..${r}`),e;if(r>32767){i.datatypeCode=8;const a=new Int32Array(t.length);for(let l=0;l<t.length;l++)a[l]=Math.trunc(t[l]);return a.buffer}else if(r>255){i.datatypeCode=4,i.numBitsPerVoxel=16;const a=new Int16Array(t.length);for(let l=0;l<t.length;l++)a[l]=Math.trunc(t[l]);return a.buffer}else{i.datatypeCode=2,i.numBitsPerVoxel=8;const a=new Uint8Array(t.length);for(let l=0;l<t.length;l++)a[l]=Math.trunc(t[l]);return a.buffer}}function B3(i,e,t){const n=i.byteLength-e.vox_offset;if(n<t)return X.error(`MGH image data size mismatch: expected ${t}, found ${n}`),!1;if(n===t)return!1;const s=e.vox_offset+t+20,r=i.byteLength-s;return r<=12?!1:Db(new DataView(i),s,r).toLowerCase().endsWith("lut.txt")?!0:Db(new DataView(i),s,r,3).includes("mri_label2vol")}async function sP(i,e){i.hdr||(X.debug("readMgh called before nvImage.hdr was initialized. Creating default."),i.hdr=new be);const t=i.hdr;t.littleEndian=!1;let n=e,s=new DataView(n);if(n.byteLength>=2&&s.getUint8(0)===31&&s.getUint8(1)===139)try{n=await Ve.decompressToBuffer(new Uint8Array(e)),s=new DataView(n)}catch(H){return X.error("Failed to decompress MGZ file.",H),null}if(n.byteLength<284)return X.error("File too small to be a valid MGH/MGZ header."),null;const r=s.getInt32(0,!1),a=s.getInt32(4,!1),l=s.getInt32(8,!1),c=s.getInt32(12,!1),h=s.getInt32(16,!1),d=s.getInt32(20,!1),f=s.getFloat32(30,!1),p=s.getFloat32(34,!1),g=s.getFloat32(38,!1),y=s.getFloat32(42,!1),x=s.getFloat32(46,!1),b=s.getFloat32(50,!1),w=s.getFloat32(54,!1),S=s.getFloat32(58,!1),C=s.getFloat32(62,!1),E=s.getFloat32(66,!1),D=s.getFloat32(70,!1),M=s.getFloat32(74,!1),N=s.getFloat32(78,!1),I=s.getFloat32(82,!1),_=s.getFloat32(86,!1);if(r!==1&&X.warn(`Unexpected MGH version: ${r}.`),a<=0||l<=0||c<=0)return X.error(`Invalid MGH dimensions: ${a}x${l}x${c}`),null;switch(d){case 0:t.numBitsPerVoxel=8,t.datatypeCode=2;break;case 4:t.numBitsPerVoxel=16,t.datatypeCode=4;break;case 1:t.numBitsPerVoxel=32,t.datatypeCode=8;break;case 3:t.numBitsPerVoxel=32,t.datatypeCode=16;break;default:return X.error(`Unsupported MGH data type: ${d}`),null}t.dims[1]=a,t.dims[2]=l,t.dims[3]=c,t.dims[4]=Math.max(1,h),t.dims[0]=t.dims[4]>1?4:3,t.pixDims[0]=1,t.pixDims[1]=Math.abs(f),t.pixDims[2]=Math.abs(p),t.pixDims[3]=Math.abs(g),t.pixDims[4]=0,t.sform_code=1,t.qform_code=0,t.sform_code=1;const F=Vn(y*t.pixDims[1],w*t.pixDims[2],E*t.pixDims[3],0,x*t.pixDims[1],S*t.pixDims[2],D*t.pixDims[3],0,b*t.pixDims[1],C*t.pixDims[2],M*t.pixDims[3],0,0,0,0,1),B=[t.dims[1]/2,t.dims[2]/2,t.dims[3]/2,1],P=[0,0,0,0];for(let H=0;H<3;H++){P[H]=0;for(let Y=0;Y<3;Y++)P[H]=P[H]+F[Y+H*4]*B[Y]}t.affine=[[F[0],F[1],F[2],N-P[0]],[F[4],F[5],F[6],I-P[1]],[F[8],F[9],F[10],_-P[2]],[0,0,0,1]],t.vox_offset=284,t.magic="n+1";const O=t.numBitsPerVoxel/8,q=a*l*c*t.dims[4]*O,U=n.slice(t.vox_offset,t.vox_offset+q);return B3(n,t,q)?P3(t,U):U}var hg={};Hi(hg,{readMIF:()=>rP});async function rP(i,e,t){i.hdr=new be;const n=i.hdr;n.pixDims=[1,1,1,1,1,0,0,0],n.dims=[1,1,1,1,1,1,1,1];let s=e.byteLength;if(s<20)throw new Error("File too small to be MIF: bytes = "+s);let r=new Uint8Array(e);r[0]===31&&r[1]===139&&(X.debug("MIF with GZ decompression"),e=await Ve.decompressToBuffer(new Uint8Array(e)),s=e.byteLength,r=new Uint8Array(e));let a=0;function l(){for(;a<s&&r[a]===10;)a++;const P=a;for(;a<s&&r[a]!==10;)a++;return a++,a-P<1?"":new TextDecoder().decode(e.slice(P,a-1))}let c=l();if(!c.startsWith("mrtrix image"))throw new Error("Not a valid MIF file");const h=[];let d=!1,f=0,p=0,g=!1;for(c=l();a<s&&!c.startsWith("END");){let P=c.split(":");if(c=l(),P.length<2)break;const O=P[0];P=P[1].split(",");for(let k=0;k<P.length;k++)P[k]=P[k].trim();switch(O){case"dim":n.dims[0]=P.length;for(let k=0;k<P.length;k++)n.dims[k+1]=parseInt(P[k]);break;case"vox":for(let k=0;k<P.length;k++)n.pixDims[k+1]=parseFloat(P[k]),isNaN(n.pixDims[k+1])&&(n.pixDims[k+1]=0);break;case"layout":for(let k=0;k<P.length;k++)h.push(parseInt(P[k]));break;case"datatype":{const k=P[0];k.startsWith("Bit")?(d=!0,n.datatypeCode=2):k.startsWith("Int8")?n.datatypeCode=256:k.startsWith("UInt8")?n.datatypeCode=2:k.startsWith("Int16")?n.datatypeCode=4:k.startsWith("UInt16")?n.datatypeCode=512:k.startsWith("Int32")?n.datatypeCode=8:k.startsWith("UInt32")?n.datatypeCode=768:k.startsWith("Float32")?n.datatypeCode=16:k.startsWith("Float64")?n.datatypeCode=64:X.warn("Unsupported datatype "+k),k.includes("8")?n.numBitsPerVoxel=8:k.includes("16")?n.numBitsPerVoxel=16:k.includes("32")?n.numBitsPerVoxel=32:k.includes("64")&&(n.numBitsPerVoxel=64),n.littleEndian=!0,k.endsWith("LE")&&(n.littleEndian=!0),k.endsWith("BE")&&(n.littleEndian=!1)}break;case"transform":if(f>2||P.length!==4)break;n.affine[f][0]=parseFloat(P[0]),n.affine[f][1]=parseFloat(P[1]),n.affine[f][2]=parseFloat(P[2]),n.affine[f][3]=parseFloat(P[3]),f++;break;case"comments":n.description=P[0].substring(0,Math.min(79,P[0].length));break;case"RepetitionTime":p=parseFloat(P[0]);break;case"file":g=!P[0].startsWith(". "),g||(P=P[0].split(" "),n.vox_offset=parseInt(P[1]));break}}const y=n.dims[0];y>5&&X.warn("reader only designed for a maximum of 5 dimensions (XYZTD)");let x=1;for(let P=0;P<y;P++)x*=Math.max(n.dims[P+1],1);for(let P=0;P<3;P++)for(let O=0;O<3;O++)n.affine[P][O]*=n.pixDims[O+1];X.debug("mif affine:"+n.affine[0]),p>0&&(n.pixDims[4]=p),g&&!t&&X.warn("MIH header provided without paired image data");let b;if(t&&g)b=t.slice(0);else if(d){n.numBitsPerVoxel=8;const P=new Uint8Array(x),O=e.slice(n.vox_offset,n.vox_offset+Math.ceil(x/8)),k=new Uint8Array(O);let q=0;for(let U=0;U<x;U++){const H=U%8;P[U]=k[q]>>7-H&1,H===7&&q++}b=P.buffer}else b=e.slice(n.vox_offset,n.vox_offset+x*(n.numBitsPerVoxel/8));h.length!==n.dims[0]&&X.warn("dims does not match layout");let w=1;const S=[1,1,1,1,1],C=[!1,!1,!1,!1,!1];for(let P=0;P<h.length;P++)for(let O=0;O<h.length;O++)Math.abs(h[O])===P&&(S[O]=w,(h[O]<0||Object.is(h[O],-0))&&(C[O]=!0),w*=n.dims[O+1]);let E=Ve.range(0,n.dims[1]-1,1);C[0]&&(E=Ve.range(n.dims[1]-1,0,-1));for(let P=0;P<n.dims[1];P++)E[P]*=S[0];let D=Ve.range(0,n.dims[2]-1,1);C[1]&&(D=Ve.range(n.dims[2]-1,0,-1));for(let P=0;P<n.dims[2];P++)D[P]*=S[1];let M=Ve.range(0,n.dims[3]-1,1);C[2]&&(M=Ve.range(n.dims[3]-1,0,-1));for(let P=0;P<n.dims[3];P++)M[P]*=S[2];let N=Ve.range(0,n.dims[4]-1,1);C[3]&&(N=Ve.range(n.dims[4]-1,0,-1));for(let P=0;P<n.dims[4];P++)N[P]*=S[3];let I=Ve.range(0,n.dims[5]-1,1);C[4]&&(I=Ve.range(n.dims[5]-1,0,-1));for(let P=0;P<n.dims[5];P++)I[P]*=S[4];let _=0,F,B;switch(n.datatypeCode){case 256:F=new Int8Array(b),B=new Int8Array(x);break;case 2:F=new Uint8Array(b),B=new Uint8Array(x);break;case 4:F=new Int16Array(b),B=new Int16Array(x);break;case 512:F=new Uint16Array(b),B=new Uint16Array(x);break;case 8:F=new Int32Array(b),B=new Int32Array(x);break;case 768:F=new Uint32Array(b),B=new Uint32Array(x);break;case 16:F=new Float32Array(b),B=new Float32Array(x);break;case 64:F=new Float64Array(b),B=new Float64Array(x);break;default:throw new Error("unknown datatypeCode")}for(let P=0;P<n.dims[5];P++)for(let O=0;O<n.dims[4];O++)for(let k=0;k<n.dims[3];k++)for(let q=0;q<n.dims[2];q++)for(let U=0;U<n.dims[1];U++)B[_]=F[E[U]+D[q]+M[k]+N[O]+I[P]],_++;return B.buffer}var L3={};Hi(L3,{readNifti:()=>aP});async function aP(i,e,t){let n=e,s=null;try{if(o1(n)&&(X.debug(`Decompressing NIfTI file: ${i.name}`),n=await SI(n),X.debug(`Decompression complete for: ${i.name}`)),!n||n.byteLength===0)throw new Error("Buffer became invalid after decompression attempt.");if(i.hdr=await iu(n,t!=null),EI(i.hdr)&&(i.extensions=i.hdr.extensions),i.hdr===null)throw new Error(`Failed to read NIfTI header: ${i.name}`);if(i.hdr.cal_min===0&&i.hdr.cal_max===255&&i.hdr.datatypeCode!==2&&(X.debug(`Resetting suspicious cal_min/max (0/255) for non-uint8 NIfTI: ${i.name}`),i.hdr.cal_min=0,i.hdr.cal_max=0),s=t?db(i.hdr,t):db(i.hdr,n),s===null)throw new Error(`nifti-reader-js readImage returned null for ${i.name}`);return s}catch(r){return X.error(`Error processing NIfTI file ${i.name}:`,r),i.hdr=null,null}}var k3={};Hi(k3,{readNrrd:()=>oP});async function oP(i,e,t=null){i.hdr||(X.warn("readNrrd called before nvImage.hdr was initialized. Creating default."),i.hdr=new be);const n=i.hdr;n.pixDims=[1,1,1,1,1,0,0,0];const s=e.byteLength;let r=null;const a=new Uint8Array(e);for(let M=1;M<s;M++)if(a[M-1]===10&&a[M]===10){const N=e.slice(0,M-1);r=new TextDecoder().decode(N),n.vox_offset=M+1;break}if(r===null)return X.error("readNrrd: could not extract txt"),null;const l=r.split(`
`);if(!l[0].startsWith("NRRD"))return X.error("Invalid NRRD image (magic signature missing)"),null;const c=l.length;let h=!1,d=!1,f=!1;const p=Nr(NaN,0,0,0,1,0,0,0,1),g=Ae(0,0,0);let y=tg();for(let M=1;M<c;M++){let N=l[M];if((N.length===0||N[0]==="#")&&(N.startsWith("#")||N.trim().length===0))continue;N=N.toLowerCase();const I=N.split(":");if(I.length<2)continue;const _=I[0].trim();let F=I[1].trim();switch(F=F.replaceAll(")"," "),F=F.replaceAll("("," "),F=F.trim(),_){case"data file":f=!0;break;case"encoding":if(F.includes("raw"))h=!1;else if(F.includes("gz"))h=!0;else return X.error("Unsupported NRRD encoding"),null;break;case"type":switch(F){case"uchar":case"unsigned char":case"uint8":case"uint8_t":n.numBitsPerVoxel=8,n.datatypeCode=2;break;case"signed char":case"int8":case"int8_t":n.numBitsPerVoxel=8,n.datatypeCode=256;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":n.numBitsPerVoxel=16,n.datatypeCode=4;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":n.numBitsPerVoxel=16,n.datatypeCode=512;break;case"int":case"signed int":case"int32":case"int32_t":n.numBitsPerVoxel=32,n.datatypeCode=8;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":n.numBitsPerVoxel=32,n.datatypeCode=768;break;case"float":n.numBitsPerVoxel=32,n.datatypeCode=16;break;case"double":n.numBitsPerVoxel=64,n.datatypeCode=64;break;default:return X.error("Unsupported NRRD data type: "+F),null}break;case"spacings":{const B=F.split(/[ ,]+/);for(let P=0;P<B.length;P++)n.pixDims[P+1]=parseFloat(B[P])}break;case"sizes":{const B=F.split(/[ ,]+/);n.dims[0]=B.length;for(let P=0;P<B.length;P++)n.dims[P+1]=parseInt(B[P])}break;case"endian":F.includes("little")?n.littleEndian=!0:F.includes("big")&&(n.littleEndian=!1);break;case"space directions":{const B=F.split(/[ ,]+/);if(B.length===9)for(let P=0;P<9;P++)p[P]=parseFloat(B[P])}break;case"space origin":{const B=F.split(/[ ,]+/);B.length===3&&(g[0]=parseFloat(B[0]),g[1]=parseFloat(B[1]),g[2]=parseFloat(B[2]))}break;case"space units":F.includes("microns")&&(d=!0);break;case"space":F.includes("right-anterior-superior")||F.includes("ras")?y=Nr(1,0,0,0,1,0,0,0,1):F.includes("left-anterior-superior")||F.includes("las")?y=Nr(-1,0,0,0,1,0,0,0,1):F.includes("left-posterior-superior")||F.includes("lps")?y=Nr(-1,0,0,0,-1,0,0,0,1):X.warn("Unsupported NRRD space value:",F);break;default:X.warn("Unknown:",_);break}}if(!isNaN(p[0])){n.sform_code=2,d&&(LN(p,p,.001),g[0]*=.001,g[1]*=.001,g[2]*=.001),y[0]<0&&(g[0]=-g[0]),y[4]<0&&(g[1]=-g[1]),y[8]<0&&(g[2]=-g[2]),J5(p,y,p);const M=Vn(p[0],p[3],p[6],g[0],p[1],p[4],p[7],g[1],p[2],p[5],p[8],g[2],0,0,0,1);if(!i.vox2mm)return null;const N=i.vox2mm([0,0,0],M),I=i.vox2mm([1,0,0],M);It(I,I,N);const _=i.vox2mm([0,1,0],M);It(_,_,N);const F=i.vox2mm([0,0,1],M);It(F,F,N),n.pixDims[0]=1,n.pixDims[1]=Fr(I),n.pixDims[2]=Fr(_),n.pixDims[3]=Fr(F),n.affine=[[M[0],M[1],M[2],M[3]],[M[4],M[5],M[6],M[7]],[M[8],M[9],M[10],M[11]],[0,0,0,1]]}let x=null;const b=f?t:e,w=f?0:n.vox_offset;if(f&&!b)return X.warn("Missing data: NRRD header describes detached data file but only one URL provided"),null;if(!b||w>=b.byteLength)return X.error(`NRRD data offset (${w}) invalid for buffer length (${b?.byteLength??0})`),null;let S=b.slice(w);if(h)try{X.debug("Decompressing NRRD data..."),S=await Ve.decompressToBuffer(new Uint8Array(S)),X.debug("Decompression complete.")}catch(M){return X.error("Failed to decompress NRRD data.",M),null}const C=n.numBitsPerVoxel/8,D=n.dims.slice(1,n.dims[0]+1).reduce((M,N)=>M*Math.max(1,N),1)*C;return S.byteLength<D?(X.error(`NRRD image data size mismatch: expected ${D}, found ${S.byteLength}`),null):(S.byteLength>D&&(X.warn(`NRRD has extra ${S.byteLength-D} bytes after expected image data. Truncating.`),S=S.slice(0,D)),x=S,n.datatypeCode?n.numBitsPerVoxel?x:(X.error("NRRD parsing failed to set numBitsPerVoxel."),null):(X.error("NRRD parsing failed to set datatypeCode."),null))}var dc={};Hi(dc,{readNPY:()=>O3,readNPZ:()=>cP});function Rb(i){return{"|b1":1,"<i1":1,"<u1":1,"<i2":2,"<u2":2,"<i4":4,"<u4":4,"<f4":4,"<f8":8}[i]??1}function lP(i){return{"|b1":2,"<i1":256,"<u1":2,"<i2":4,"<u2":512,"<i4":8,"<u4":768,"<f4":16,"<f8":64}[i]??16}async function O3(i,e){const t=new DataView(e),n=[t.getUint8(0),t.getUint8(1),t.getUint8(2),t.getUint8(3),t.getUint8(4),t.getUint8(5)],s=[147,78,85,77,80,89];if(!n.every((S,C)=>S===s[C]))throw new Error("Not a valid NPY file: Magic number mismatch");const r=t.getUint16(8,!0),a=new TextDecoder("utf-8").decode(e.slice(10,10+r)),l=a.match(/'shape': \((.*?)\)/);if(!l)throw new Error("Invalid NPY header: Shape not found");const c=l[1].split(",").map(S=>S.trim()).filter(S=>S!=="").map(Number),h=a.match(/'descr': '([^']+)'/);if(!h)throw new Error("Invalid NPY header: Data type not found");const d=h[1],f=c.reduce((S,C)=>S*C,1),p=10+r,g=e.slice(p,p+f*Rb(d)),y=c.length>0?c[c.length-1]:1,x=c.length>1?c[c.length-2]:1,b=c.length>2?c[c.length-3]:1;i.hdr=new be;const w=i.hdr;return w.dims=[3,y,x,b,0,0,0,0],w.pixDims=[1,1,1,1,1,0,0,0],w.affine=[[w.pixDims[1],0,0,-(w.dims[1]-2)*.5*w.pixDims[1]],[0,-w.pixDims[2],0,(w.dims[2]-2)*.5*w.pixDims[2]],[0,0,-w.pixDims[3],(w.dims[3]-2)*.5*w.pixDims[3]],[0,0,0,1]],w.numBitsPerVoxel=Rb(d)*8,w.datatypeCode=lP(d),g}async function cP(i,e){const t=new E3(e);for(let n=0;n<t.entries.length;n++){const s=t.entries[n];if(s.fileName.toLowerCase().endsWith(".npy")){const r=await s.extract();return await O3(i,r.buffer)}}}var dg={};Hi(dg,{readZARR:()=>hP});function uP(i,e,t,n){const s=e*t,r=new Uint8Array(s*n*3),a=new Array(n);for(let h=0;h<n;h++)a[h]=s*3*h;let l=0,c=0;for(let h=0;h<s;h++){for(let d=0;d<n;d++)r[a[d]+c]=i[l++],r[a[d]+c+1]=i[l++],r[a[d]+c+2]=i[l++];c+=3}return r}async function hP(i,e,t){let{width:n,height:s,depth:r=1,data:a}=t??{},l=n*s*r*3,c=l===a.length;if(c||(l=n*s*r,r===3&&(c=!0,r=1)),l!==a.length)throw new Error(`Expected RGB ${n}${s}${r}3 =  ${l}, but ZARR length ${a.length}`);i.hdr=new be;const h=i.hdr;if(h.dims=[3,n,s,r,1,1,1,1],h.pixDims=[1,1,1,1,0,0,0,0],h.affine=[[h.pixDims[1],0,0,-(h.dims[1]-2)*.5*h.pixDims[1]],[0,-h.pixDims[2],0,(h.dims[2]-2)*.5*h.pixDims[2]],[0,0,-h.pixDims[3],(h.dims[3]-2)*.5*h.pixDims[3]],[0,0,0,1]],!c){if(h.numBitsPerVoxel=8,h.datatypeCode=2,a instanceof Uint8Array){const g=new ArrayBuffer(a.length);return new Uint8Array(g).set(a),g}return a}h.numBitsPerVoxel=24,h.datatypeCode=128;const d=uP(a,h.dims[1],h.dims[2],h.dims[3]),f=new ArrayBuffer(d.length);return new Uint8Array(f).set(d),f}function Hs(i,e,t){const n=Qt(t);sn(n,n);const s=Lt(e[0],e[1],e[2],1);return Pi(s,s,n),Ae(s[0],s[1],s[2])}function U3(i,e,t=!1){if(!i.matRAS)throw new Error("matRAS undefined");const n=Qt(i.matRAS),s=Qt(n);sn(s,n),rn(s,s);const r=Lt(e[0],e[1],e[2],1);Pi(r,r,s);const a=Ae(r[0],r[1],r[2]);return t?a:new Float32Array([Math.round(a[0]),Math.round(a[1]),Math.round(a[2])])}function dP(i,e){return Ae((e[0]+.5)/i.dimsRAS[1],(e[1]+.5)/i.dimsRAS[2],(e[2]+.5)/i.dimsRAS[3])}function fP(i,e){return Ae(Math.round(e[0]*i.dims[1]-.5),Math.round(e[1]*i.dims[2]-.5),Math.round(e[2]*i.dims[3]-.5))}function mP(i,e,t=!1){const n=Lt(e[0],e[1],e[2],1);return t?Pi(n,n,i.frac2mm):Pi(n,n,i.frac2mmOrtho),n}function pP(i,e,t=!1){const n=Lt(e[0],e[1],e[2],1),s=i.dimsRAS,r=Ae(0,0,0);if(typeof s>"u")return r;if(!t){const l=Qt(i.frac2mmOrtho);return rn(l,l),Pi(n,n,l),r[0]=n[0],r[1]=n[1],r[2]=n[2],r}if(s[1]<1||s[2]<1||s[3]<1)return r;const a=Qt(i.matRAS);return rn(a,a),sn(a,a),Pi(n,n,a),r[0]=(n[0]+.5)/s[1],r[1]=(n[1]+.5)/s[2],r[2]=(n[2]+.5)/s[3],r}function fg(i,e){return Array.isArray(i)&&Array.isArray(e)&&i.length===e.length&&i.every((t,n)=>t===e[n])}function V3(i){const e=Qt(i);sn(e,i);const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),n=Math.max(Math.max(Math.abs(e[0]),Math.abs(e[1])),Math.abs(e[2]))/t,s=Math.sqrt(e[4]*e[4]+e[5]*e[5]+e[6]*e[6]),r=Math.max(Math.max(Math.abs(e[4]),Math.abs(e[5])),Math.abs(e[6]))/s,a=Math.sqrt(e[8]*e[8]+e[9]*e[9]+e[10]*e[10]),l=Math.max(Math.max(Math.abs(e[8]),Math.abs(e[9])),Math.abs(e[10]))/a,c=Math.min(Math.min(n,r),l);let h=Math.abs(Math.acos(c)*180/3.141592653);return h>.01?X.warn("Warning voxels not aligned with world space: "+h+` degrees from plumb.
`):h=0,h}function mg(i){if(!i.matRAS)throw new Error("matRAS not defined");if(i.pixDimsRAS===void 0)throw new Error("pixDimsRAS not defined");if(!i.dimsRAS)throw new Error("dimsRAS not defined");i.oblique_angle=V3(i.matRAS);const e=Hs(i,[0,0,0],i.matRAS),t=Hs(i,[1/i.pixDimsRAS[1],0,0],i.matRAS),n=Hs(i,[0,1/i.pixDimsRAS[2],0],i.matRAS),s=Hs(i,[0,0,1/i.pixDimsRAS[3]],i.matRAS);It(t,t,e),It(n,n,e),It(s,s,e);const r=Vn(t[0],t[1],t[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1);i.obliqueRAS=Qt(r);const a=Math.abs(90-l0(t,n)*(180/Math.PI)),l=Math.abs(90-l0(t,s)*(180/Math.PI)),c=Math.abs(90-l0(n,s)*(180/Math.PI));i.maxShearDeg=Math.max(Math.max(a,l),c),i.maxShearDeg>.1&&X.warn("Warning: voxels are rhomboidal, maximum shear is %f degrees.",i.maxShearDeg);const h=Lt(i.dimsRAS[1],i.dimsRAS[2],i.dimsRAS[3],1),d=Qt(i.matRAS);sn(d,d);const f=Lt(-.5,-.5,-.5,0);No(d,d,Ae(f[0],f[1],f[2])),d[0]*=h[0],d[1]*=h[0],d[2]*=h[0],d[4]*=h[1],d[5]*=h[1],d[6]*=h[1],d[8]*=h[2],d[9]*=h[2],d[10]*=h[2],i.frac2mm=Qt(d);const p=i.pixDimsRAS[1],g=i.pixDimsRAS[2],y=i.pixDimsRAS[3],x=Qt(d);x[0]=p*h[0],x[1]=0,x[2]=0,x[4]=0,x[5]=g*h[1],x[6]=0,x[8]=0,x[9]=0,x[10]=y*h[2];const b=U3(i,[0,0,0],!0);x[12]=(-b[0]-.5)*p,x[13]=(-b[1]-.5)*g,x[14]=(-b[2]-.5)*y,i.frac2mmOrtho=Qt(x),i.extentsMinOrtho=[x[12],x[13],x[14]],i.extentsMaxOrtho=[x[0]+x[12],x[5]+x[13],x[10]+x[14]],i.mm2ortho=it(),rn(i.mm2ortho,r)}function gP(i){if(!i.hdr)throw new Error("hdr not set");const e=i.hdr.affine,t=i.hdr,n=Nr(Math.abs(e[0][0]),Math.abs(e[0][1]),Math.abs(e[0][2]),Math.abs(e[1][0]),Math.abs(e[1][1]),Math.abs(e[1][2]),Math.abs(e[2][0]),Math.abs(e[2][1]),Math.abs(e[2][2])),s=[1,1,1];n[3]>n[0]&&(s[0]=2),n[6]>n[0]&&n[6]>n[3]&&(s[0]=3),s[1]=1,s[0]===1?n[4]>n[7]?s[1]=2:s[1]=3:s[0]===2?n[1]>n[7]?s[1]=1:s[1]=3:n[1]>n[4]?s[1]=1:s[1]=2,s[2]=6-s[1]-s[0];let r=[1,2,3];r[s[0]-1]=1,r[s[1]-1]=2,r[s[2]-1]=3;let a=Vn(e[0][0],e[0][1],e[0][2],e[0][3],e[1][0],e[1][1],e[1][2],e[1][3],e[2][0],e[2][1],e[2][2],e[2][3],0,0,0,1);i.mm000=Hs(i,[-.5,-.5,-.5],a),i.mm100=Hs(i,[t.dims[1]-.5,-.5,-.5],a),i.mm010=Hs(i,[-.5,t.dims[2]-.5,-.5],a),i.mm001=Hs(i,[-.5,-.5,t.dims[3]-.5],a);const l=it();FN(l,a);for(let b=0;b<3;b++)for(let w=0;w<3;w++)l[b*4+w]=a[b*4+r[w]-1];const c=[0,0,0];l[0]<0&&(c[0]=1),l[5]<0&&(c[1]=1),l[10]<0&&(c[2]=1),i.dimsRAS=[t.dims[0],t.dims[r[0]],t.dims[r[1]],t.dims[r[2]]],i.pixDimsRAS=[t.pixDims[0],t.pixDims[r[0]],t.pixDims[r[1]],t.pixDims[r[2]]],i.permRAS=r.slice();for(let b=0;b<3;b++)c[b]===1&&(i.permRAS[b]=-i.permRAS[b]);if(fg(r,[1,2,3])&&fg(c,[0,0,0])){i.toRAS=it(),i.matRAS=Qt(a),mg(i),i.img2RASstep=[1,i.dimsRAS[1],i.dimsRAS[1]*i.dimsRAS[2]],i.img2RASstart=[0,0,0];return}$5(a),a[0]=1-c[0]*2,a[5]=1-c[1]*2,a[10]=1-c[2]*2,a[3]=(t.dims[r[0]]-1)*c[0],a[7]=(t.dims[r[1]]-1)*c[1],a[11]=(t.dims[r[2]]-1)*c[2];const h=it();rn(h,a),ga(h,h,l),i.matRAS=Qt(h),a=Vn(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),a[r[0]-1+0]=-c[0]*2+1,a[r[1]-1+4]=-c[1]*2+1,a[r[2]-1+8]=-c[2]*2+1,a[3]=c[0],a[7]=c[1],a[11]=c[2],i.toRAS=Qt(a),a[3]=0,a[7]=0,a[11]=0,a[12]=0,(i.permRAS[0]===-1||i.permRAS[1]===-1||i.permRAS[2]===-1)&&(a[12]=t.dims[1]-1),a[13]=0,(i.permRAS[0]===-2||i.permRAS[1]===-2||i.permRAS[2]===-2)&&(a[13]=t.dims[2]-1),a[14]=0,(i.permRAS[0]===-3||i.permRAS[1]===-3||i.permRAS[2]===-3)&&(a[14]=t.dims[3]-1),i.toRASvox=Qt(a),X.debug(i.hdr.dims),X.debug(i.dimsRAS);const d=i.hdr;r=i.permRAS;const f=[Math.abs(r[0]),Math.abs(r[1]),Math.abs(r[2])],p=[d.dims[f[0]],d.dims[f[1]],d.dims[f[2]]],g=[1,d.dims[1],d.dims[1]*d.dims[2]],y=[g[f[0]-1],g[f[1]-1],g[f[2]-1]],x=[0,0,0];for(let b=0;b<3;b++)r[b]<0&&(x[b]=y[b]*(p[b]-1),y[b]=-y[b]);i.img2RASstep=y,i.img2RASstart=x,mg(i)}async function AP(i,e=1){if(!i.permRAS)throw new Error("permRAS undefined");if(!i.hdr)throw new Error("hdr undefined");const t=kd({...i.hdr,vox_offset:352},!1),n=await iu(t.buffer,!0);e===1?(n.dims[0]=3,n.dims[4]=1):e>1&&(n.dims[0]=4,n.dims[4]=e);const s=i.permRAS.slice();if(s[0]===1&&s[1]===2&&s[2]===3)return n;n.qform_code=0;for(let a=1;a<4;a++)n.dims[a]=i.dimsRAS[a];for(let a=0;a<i.pixDimsRAS.length;a++)n.pixDims[a]=i.pixDimsRAS[a];let r=0;for(let a=0;a<4;a++)for(let l=0;l<4;l++)n.affine[a][l]=i.matRAS[r],r++;return n}function vP(i,e=0){if(!i.permRAS)throw new Error("permRAS undefined");if(!i.img)throw new Error("img undefined");if(!i.hdr)throw new Error("hdr undefined");const t=i.permRAS.slice();if(t[0]===1&&t[1]===2&&t[2]===3)return i.img;const n=i.hdr,s=n.dims[1]*n.dims[2]*n.dims[3];let r=e*s;(r+s>i.img.length||r<0)&&(r=0,X.warn(`img2RAS nVolume (${e}) out of bounds (${e}+1)${s} > ${i.img.length}`));const a=i.img.slice(0,s),l=[Math.abs(t[0]),Math.abs(t[1]),Math.abs(t[2])],c=[n.dims[l[0]],n.dims[l[1]],n.dims[l[2]]],h=[1,n.dims[1],n.dims[1]*n.dims[2]],d=[h[l[0]-1],h[l[1]-1],h[l[2]-1]],f=[0,0,0];for(let g=0;g<3;g++)t[g]<0&&(f[g]=d[g]*(c[g]-1),d[g]=-d[g]);let p=0;for(let g=0;g<c[2];g++){const y=f[2]+g*d[2];for(let x=0;x<c[1];x++){const b=f[1]+x*d[1];for(let w=0;w<c[0];w++){const S=f[0]+w*d[0];a[p]=i.img[S+b+y+r],p++}}}return a}function j3(i,e){e.length!==i.nVox3D*3&&X.warn("float32V1asRGBA() expects "+i.nVox3D*3+"voxels, got ",+e.length);const t=e.slice();i.hdr.datatypeCode=2304,i.nFrame4D=1;for(let c=4;c<7;c++)i.hdr.dims[c]=1;i.hdr.dims[0]=3;const n=new Uint8Array(i.nVox3D*4);let s=1;for(let c=0;c<i.nVox3D*3;c++)isNaN(t[c])||(s=Math.max(s,Math.abs(t[c])));const r=255/s,a=i.nVox3D*2;let l=0;for(let c=0;c<i.nVox3D;c++){const h=t[c],d=t[c+i.nVox3D],f=t[c+a];n[l]=Math.abs(h*r),n[l+1]=Math.abs(d*r),n[l+2]=Math.abs(f*r);const p=+(h>0)*1,g=+(d>0)*2,y=+(f>0)*4;let x=248+p+g+y;Math.abs(h)+Math.abs(d)+Math.abs(f)<.1&&(x=0),n[l+3]=x,l+=4}return n}function yP(i,e=!1,t=!1,n=!1){let s=i.v1;if(!s&&i.nFrame4D===3&&i.img.constructor===Float32Array&&(s=i.img.slice()),!s)return X.warn("Image does not have V1 data"),!1;if(e)for(let r=0;r<i.nVox3D;r++)s[r]=-s[r];if(t)for(let r=i.nVox3D;r<2*i.nVox3D;r++)s[r]=-s[r];if(n)for(let r=2*i.nVox3D;r<3*i.nVox3D;r++)s[r]=-s[r];return i.img=j3(i,s),!0}function fc(i,e){if(!i.hdr)throw new Error("hdr undefined");return i.hdr.scl_slope===0&&(i.hdr.scl_slope=1),e*i.hdr.scl_slope+i.hdr.scl_inter}function xP(i,e){if(!i.hdr)throw new Error("hdr undefined");return i.hdr.scl_slope===0&&(i.hdr.scl_slope=1),(e-i.hdr.scl_inter)/i.hdr.scl_slope}function w1(i,e=Number.POSITIVE_INFINITY,t=!0){if(!i.hdr)throw new Error("hdr undefined");if(!i.img)throw new Error("img undefined");let n=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,r=0,a=0,l=i.hdr.dims[1]*i.hdr.dims[2]*i.hdr.dims[3];const c=Math.floor(i.img.length/l);e>=c&&(e=i.frame4D),e=Math.min(e,c-1);const h=e*l;let d=[];if(t){const O=[Math.floor(.25*i.hdr.dims[1]),Math.floor(.25*i.hdr.dims[2]),Math.floor(.25*i.hdr.dims[3])],k=[i.hdr.dims[1]-2*O[0],i.hdr.dims[2]-2*O[1],i.hdr.dims[3]-2*O[2]],q=[k[0]+O[0],k[1]+O[1],k[2]+O[2]];l=k[0]*k[1]*k[2],d=new i.img.constructor(l);let U=-1,H=0;for(let Y=0;Y<i.hdr.dims[3];Y++)for(let Q=0;Q<i.hdr.dims[2];Q++)for(let te=0;te<i.hdr.dims[1];te++)U++,!(te<O[0]||Q<O[1]||Y<O[2])&&(te>=q[0]||Q>=q[1]||Y>=q[2]||(d[H]=i.img[U+h],H++))}else{d=new i.img.constructor(l);for(let P=0;P<l;P++)d[P]=i.img[P+h]}const f=d.constructor!==Float64Array&&d.constructor!==Float32Array&&i.ignoreZeroVoxels;if(f)for(let P=0;P<l;P++)n=Math.min(d[P],n),s=Math.max(d[P],s),d[P]===0&&r++;else for(let P=0;P<l;P++){if(isNaN(d[P])){a++;continue}d[P]===0&&(r++,i.ignoreZeroVoxels)||(n=Math.min(d[P],n),s=Math.max(d[P],s))}i.ignoreZeroVoxels&&n===s&&r>0&&(n=0);const p=fc(i,n),g=fc(i,s),y=yt.colormapFromKey(i._colormap);let x=0,b=0;if(y.min!==void 0&&(x=y.min),y.max!==void 0&&(b=y.max),x===b&&i.trustCalMinMax&&isFinite(i.hdr.cal_min)&&isFinite(i.hdr.cal_max)&&i.hdr.cal_max>i.hdr.cal_min)return i.cal_min=i.hdr.cal_min,i.cal_max=i.hdr.cal_max,i.robust_min=i.cal_min,i.robust_max=i.cal_max,i.global_min=p,i.global_max=g,[i.hdr.cal_min,i.hdr.cal_max,i.hdr.cal_min,i.hdr.cal_max];if(x!==b)return i.cal_min=x,i.cal_max=b,i.robust_min=i.cal_min,i.robust_max=i.cal_max,[x,b,x,b];const w=100*r/(l-0);let S=!1;w>60&&!i.ignoreZeroVoxels&&(X.warn(`${Math.round(w)}% of voxels are zero: ignoring zeros for cal_max`),S=!0,i.ignoreZeroVoxels=!0),i.ignoreZeroVoxels||(r=0),r+=a;const C=Math.round((l-0-r)*i.percentileFrac);if(C<1||n===s)return t?w1(i,e,!1):(X.debug("no variability in image intensity?"),i.cal_min=p,i.cal_max=g,i.robust_min=i.cal_min,i.robust_max=i.cal_max,i.global_min=p,i.global_max=g,[p,g,p,g]);const E=1001,D=(E-1)/(s-n),M=new Array(E);for(let P=0;P<E;P++)M[P]=0;if(f)for(let P=0;P<l;P++)M[Math.round((d[P]-n)*D)]++;else if(i.ignoreZeroVoxels)for(let P=0;P<l;P++)d[P]!==0&&(isNaN(d[P])||M[Math.round((d[P]-n)*D)]++);else for(let P=0;P<l;P++)isNaN(d[P])||M[Math.round((d[P]-n)*D)]++;let N=0,I=0;for(;N<C;)N+=M[I],I++;I--,N=0;let _=E;for(;N<C;)_--,N+=M[_];if(I===_){let P=-1;for(;P!==0;)I>0&&(I--,M[I]>0&&(P=0)),P!==0&&_<E-1&&(_++,M[_]>0&&(P=0)),I===0&&_===E-1&&(P=0)}let F=fc(i,I/D+n),B=fc(i,_/D+n);return i.hdr.cal_min<i.hdr.cal_max&&i.hdr.cal_min>=p&&i.hdr.cal_max<=g&&(F=i.hdr.cal_min,B=i.hdr.cal_max),S&&(F=Math.min(F,0)),i.cal_min=F,i.cal_max=B,i.hdr.intent_code===1002&&(i.cal_min=p,i.cal_max=g),i.robust_min=i.cal_min,i.robust_max=i.cal_max,i.global_min=p,i.global_max=g,[F,B,p,g]}function p0(i,e){i._colormap=e,w1(i),i.onColormapChange&&i.onColormapChange(i)}function bP(i,e){i.colormapLabel=yt.makeLabelLut(e)}async function wP(i,e){i.colormapLabel=await yt.makeLabelLutFromUrl(e)}function Nb(i){return i._colormap}function SP(i){return i._opacity}function CP(i,e){i._opacity=e,i.onOpacityChange&&i.onOpacityChange(i)}async function EP(i,e={}){if(i==="")throw Error("url must not be empty");let n=/^(?:[a-z+]+:)?\/\//i.test(i)?i:new URL(i,window.location.href);/(?:.([^.]+))?$/.exec(n.pathname)||(n=new URL("niivue-manifest.txt",i));let a=await fetch(n,{headers:e});if(!a.ok)throw Error(a.statusText);const c=(await a.text()).split(`
`),d=/(.*\/).*/.exec(n)[0],f=[];for(const p of c){const g=new URL(p,d);if(a=await fetch(g,{headers:e}),!a.ok)throw Error(a.statusText);const y=await a.arrayBuffer();f.push({name:p,data:y})}return f}async function md(i,e){const t=i.getReader(),n=new mI,s=[];let r=0,a=!1,l,c;const h=new Promise((f,p)=>{l=f,c=p});function d(){const f=new Uint8Array(r);let p=0;for(const g of s)f.set(g,p),p+=g.length;l(f)}return n.ondata=f=>{s.push(f),r+=f.length,r>=e&&(a=!0,t.cancel().catch(()=>{}),d())},(async()=>{try{for(;!a;){const{done:f,value:p}=await t.read();if(f){a=!0,n.push(new Uint8Array,!0);return}n.push(p,!1)}}catch(f){c(f)}})().catch(()=>{}),h}function TP(i){const t=new URL(i).searchParams.get("response-content-disposition");if(t){const n=t.match(/filename\*?=(?:UTF-8'')?"?([^";]+)"?/);if(n)return decodeURIComponent(n[1])}return i.split("/").pop().split("?")[0]}async function z3(i="",e={},t=NaN){if(isNaN(t))return null;const n=await fetch(i,{headers:e,cache:"force-cache"});let s=352,r=await md(n.body,s);const a=new DataView(r.buffer,r.byteOffset,r.byteLength),l=a.getUint16(0,!0),c=l===348;if(!c&&!(l===23553)||(r.length>111&&(s=a.getFloat32(108,c)),s>r.length&&(r=await md(n.body,s)),!(r[0]===92&&r[1]===1||r[1]===92&&r[0]===1)))return null;const f=await iu(r.buffer);if(!f)throw new Error("Could not read NIfTI header");const p=f.numBitsPerVoxel/8,g=[1,2,3].reduce((C,E)=>C*(f.dims[E]>1?f.dims[E]:1),1),y=[4,5,6].reduce((C,E)=>C*(f.dims[E]>1?f.dims[E]:1),1),x=Math.max(Math.min(t,y),1),b=f.vox_offset+x*g*p;if(x===y)return null;const w=await fetch(i,{headers:e,cache:"force-cache"});return(await md(w.body,b)).buffer.slice(0,b)}async function MP(i="",e={},t=NaN){if(isNaN(t))return null;const s=(await fetch(i,{headers:e,cache:"force-cache"})).body.getReader(),{value:r,done:a}=await s.read();let l=r;if(a||!l||l.length<2)throw new Error("Not enough data to determine compression");const c=new DataView(l.buffer,l.byteOffset,l.byteLength),h=c.getUint16(0,!0);if(h===35615)return await s.cancel(),z3(i,e,t);const f=h===348;if(!f&&!(h===23553))return await s.cancel(),null;let g=352;for(l.length>111&&(g=c.getFloat32(108,f));l.length<g;){let N=function(F,B){const P=new Uint8Array(F.length+B.length);return P.set(F,0),P.set(B,F.length),P};const{value:I,done:_}=await s.read();if(_||!I)break;l=N(l,I)}const y=await iu(l.buffer);if(!y)throw new Error("Could not read NIfTI header");const x=y.numBitsPerVoxel/8,b=[1,2,3].reduce((N,I)=>N*(y.dims[I]>1?y.dims[I]:1),1),w=[4,5,6].reduce((N,I)=>N*(y.dims[I]>1?y.dims[I]:1),1),S=Math.max(Math.min(t,w),1),C=y.vox_offset+S*b*x,E=new Uint8Array(C),D=Math.min(l.length,C);E.set(l.subarray(0,D),0);let M=D;for(;M<C;){const{value:N,done:I}=await s.read();if(I||!N)return await s.cancel(),null;const _=Math.min(N.length,C-M);E.set(N.subarray(0,_),M),M+=_}return await s.cancel(),E.buffer}async function DP(i,e=NaN){let t=i.stream();if(!isNaN(e)){let d=0;const f=new TransformStream({transform(p,g){if(d>=e){g.terminate();return}const y=e-d;p.length>y?(g.enqueue(p.slice(0,y)),g.terminate()):g.enqueue(p),d+=p.length}});t=t.pipeThrough(f)}const n=await b1(t),s=[],r=n.getReader();for(;;){const{done:d,value:f}=await r.read();if(d)break;s.push(f)}const a=s.reduce((d,f)=>d+f.length,0),l=new ArrayBuffer(a),c=new Uint8Array(l);let h=0;for(const d of s)c.set(d,h),h+=d.length;return l}function RP(i){const e=window.atob(i),t=e.length,n=new Uint8Array(t);for(let s=0;s<t;s++)n[s]=e.charCodeAt(s);return n.buffer}function g0(i){const e=i.match(/\.([^.]+)(?:\.gz|\.bz2|\.xz)?$/);return e?e[1]:""}function NP(i){if(!i.hdr)throw new Error("hdr undefined");const e=i.id,t=i.hdr.datatypeCode,n=i.hdr.dims,s=n[1],r=n[2],a=n[3],l=Math.max(1,n[4]),c=i.hdr.pixDims,h=c[1],d=c[2],f=c[3],p=c[4],g=Math.floor(i.hdr.numBitsPerVoxel/8);return{id:e,datatypeCode:t,nx:s,ny:r,nz:a,nt:l,dx:h,dy:d,dz:f,dt:p,bpv:g}}function IP(i){return dd("","",i.name,i._colormap,i.opacity,i.hdr.cal_min,i.hdr.cal_max,i.trustCalMinMax,i.percentileFrac,i.ignoreZeroVoxels,i.useQFormNotSForm,i.colormapNegative,i.frame4D,i.imageType,i.colormapType)}function _P(i,e){i.hdr.cal_min=e.cal_min,i.hdr.cal_max=e.cal_max,Object.assign(i,e)}function FP(i,e){if(!(e.datatypeCode===128||e.datatypeCode===2304||e.littleEndian===og()||e.numBitsPerVoxel<=8)){if(e.numBitsPerVoxel===16){const t=new Uint16Array(i);for(let n=0;n<t.length;n++){const s=t[n];t[n]=((s&255)<<8|s>>8&255)<<16>>16}}else if(e.numBitsPerVoxel===32){const t=new Uint32Array(i);for(let n=0;n<t.length;n++){const s=t[n];t[n]=(s&255)<<24|(s&65280)<<8|s>>8&65280|s>>24&255}}else if(e.numBitsPerVoxel===64){const t=e.numBitsPerVoxel/8,n=new Uint8Array(i);for(let s=0;s<n.length;s+=t){let r=t-1;for(let a=0;a<r;a++){const l=n[s+a];n[s+a]=n[s+r],n[s+r]=l,r--}}}}}function PP(i,e){switch(e.datatypeCode){case 2:return{img:new Uint8Array(i)};case 4:return{img:new Int16Array(i)};case 16:return{img:new Float32Array(i)};case 64:return{img:new Float64Array(i)};case 128:return{img:new Uint8Array(i)};case 512:return{img:new Uint16Array(i)};case 2304:return{img:new Uint8Array(i)};case 256:{const t=new Int8Array(i),n=t.length,s=new Int16Array(n);for(let r=0;r<n;r++)s[r]=t[r];return{img:s,updatedDatatypeCode:4,updatedNumBitsPerVoxel:16}}case 1:{const t=e.dims[1]*e.dims[2]*Math.max(1,e.dims[3])*Math.max(1,e.dims[4]),n=new Uint8Array(i),s=new Uint8Array(t),r=new Uint8Array(8);for(let l=0;l<8;l++)r[l]=Math.pow(2,l);let a=-1;for(let l=0;l<t;l++){const c=l%8;c===0&&a++,(n[a]&r[c])!==0&&(s[l]=1)}return{img:s,updatedDatatypeCode:2,updatedNumBitsPerVoxel:8}}case 768:{const t=new Uint32Array(i),n=t.length,s=new Float64Array(n);for(let r=0;r<n-1;r++)s[r]=t[r];return{img:s,updatedDatatypeCode:64}}case 8:{const t=new Int32Array(i),n=t.length,s=new Float64Array(n);for(let r=0;r<n-1;r++)s[r]=t[r];return{img:s,updatedDatatypeCode:64}}case 1024:{const t=new BigInt64Array(i),n=t.length,s=new Float64Array(n);for(let r=0;r<n-1;r++)s[r]=Number(t[r]);return{img:s,updatedDatatypeCode:64}}case 32:{const t=new Float32Array(i),n=Math.floor(t.length/2),s=new Float32Array(n),r=new Float32Array(n);let a=0;for(let l=0;l<n-1;l++)r[l]=t[a],s[l]=t[a+1],a+=2;return{img:r,imaginary:s,updatedDatatypeCode:16}}default:throw new Error("datatype "+e.datatypeCode+" not supported")}}function BP(i){(i.pixDims[1]===0||i.pixDims[2]===0||i.pixDims[3]===0)&&X.error("pixDims not plausible",i)}function LP(i){(isNaN(i.scl_slope)||i.scl_slope===0)&&(i.scl_slope=1),isNaN(i.scl_inter)&&(i.scl_inter=0)}function kP(i,e){const t=M3(i.affine);if(!e&&t&&i.qform_code<=i.sform_code)return;X.debug("spatial transform based on QForm");const n=i.quatern_b,s=i.quatern_c,r=i.quatern_d,a=Math.sqrt(1-(Math.pow(n,2)+Math.pow(s,2)+Math.pow(r,2))),l=i.pixDims[0]===0?1:i.pixDims[0],c=[[a*a+n*n-s*s-r*r,2*n*s-2*a*r,2*n*r+2*a*s],[2*n*s+2*a*r,a*a+s*s-n*n-r*r,2*s*r-2*a*n],[2*n*r-2*a*s,2*s*r+2*a*n,a*a+r*r-s*s-n*n]],h=i.affine;for(let d=0;d<3;d+=1)for(let f=0;f<3;f+=1)h[d][f]=c[d][f]*i.pixDims[f+1],f===2&&(h[d][f]*=l);h[0][3]=i.qoffset_x,h[1][3]=i.qoffset_y,h[2][3]=i.qoffset_z,i.affine=h}function OP(i){if(M3(i.affine))return;X.debug("Defective NIfTI: spatial transform does not make sense");let e=i.pixDims[1],t=i.pixDims[2],n=i.pixDims[3];(isNaN(e)||e===0)&&(e=1),(isNaN(t)||t===0)&&(t=1),(isNaN(n)||n===0)&&(n=1),i.pixDims[1]=e,i.pixDims[2]=t,i.pixDims[3]=n;const s=[[e,0,0,0],[0,t,0,0],[0,0,n,0],[0,0,0,1]];i.affine=s}function UP(i,e){BP(i),LP(i),kP(i,e),OP(i)}async function VP(i){const e=new URL(i).searchParams,t=e.get("z"),n=e.get("y"),s=e.get("x"),r=t?Tc(parseInt(t),parseInt(t)+1):null,a=n?Tc(parseInt(n),parseInt(n)+1):null,l=s?Tc(parseInt(s),parseInt(s)+1):null,c=i.split("?")[0],h=new DI(c),d=WI(h);let f;try{f=await Ir(d.resolve(i),{kind:"array"})}catch{f=await Ir(d,{kind:"array"})}let p;if(f.shape.length===4){const E=f.shape[2],D=f.shape[1],M=f.shape[0];r&&r[0]>=E&&(r[0]=E-1),a&&a[0]>=D&&(a[0]=D-1),l&&l[0]>=M&&(l[0]=M-1),p=await Cb(f,[l,a,r,null])}else p=await Cb(f,[l,a,r]);const g=p.data,[y,x,b,w]=p.shape;return{dataBuffer:g,zarrData:{data:g,width:x,height:y,depth:b,channels:w}}}async function jP(i,e={}){const t=await fetch(i,{headers:e});if(!t.ok)throw Error(t.statusText);if(!t.body)throw new Error("No readable stream available");const n=await b1(t.body),s=[],r=n.getReader();for(;;){const{done:d,value:f}=await r.read();if(d)break;s.push(f)}const a=s.reduce((d,f)=>d+f.length,0),l=new ArrayBuffer(a),c=new Uint8Array(l);let h=0;for(const d of s)c.set(d,h),h+=d.length;return l}function zP(i,e,t){return t!==""?t:e.toUpperCase()==="HEAD"?i.substring(0,i.lastIndexOf("HEAD"))+"BRIK":e.toUpperCase()==="HDR"?i.substring(0,i.lastIndexOf("HDR"))+"IMG":null}async function GP(i,e={}){try{let t=await fetch(i,{headers:e});if(t.status===404&&(i.includes("BRIK")||i.includes("IMG"))&&(t=await fetch(`${i}.gz`,{headers:e})),!t.ok||!t.body)return null;const n=await b1(t.body),s=[],r=n.getReader();for(;;){const{done:d,value:f}=await r.read();if(d)break;s.push(f)}const a=s.reduce((d,f)=>d+f.length,0),l=new ArrayBuffer(a),c=new Uint8Array(l);let h=0;for(const d of s)c.set(d,h),h+=d.length;return l}catch(t){return console.error("Error loading paired image data:",t),null}}var $i=class pd{constructor(e=null,t="",n="gray",s=1,r=null,a=NaN,l=NaN,c=!0,h=.02,d=!1,f=!1,p="",g=0,y=Ye.UNKNOWN,x=NaN,b=NaN,w=!0,S=null,C=0){G(this,"name"),G(this,"id"),G(this,"url"),G(this,"headers"),G(this,"_colormap"),G(this,"_opacity"),G(this,"percentileFrac"),G(this,"ignoreZeroVoxels"),G(this,"trustCalMinMax"),G(this,"colormapNegative"),G(this,"colormapLabel"),G(this,"colormapInvert"),G(this,"nFrame4D"),G(this,"frame4D"),G(this,"nTotalFrame4D"),G(this,"cal_minNeg"),G(this,"cal_maxNeg"),G(this,"colorbarVisible",!0),G(this,"modulationImage",null),G(this,"modulateAlpha",0),G(this,"series",[]),G(this,"nVox3D"),G(this,"oblique_angle"),G(this,"maxShearDeg"),G(this,"useQFormNotSForm"),G(this,"colormapType"),G(this,"pixDims"),G(this,"matRAS"),G(this,"pixDimsRAS"),G(this,"obliqueRAS"),G(this,"dimsRAS"),G(this,"permRAS"),G(this,"img2RASstep"),G(this,"img2RASstart"),G(this,"toRAS"),G(this,"toRASvox"),G(this,"frac2mm"),G(this,"frac2mmOrtho"),G(this,"extentsMinOrtho"),G(this,"extentsMaxOrtho"),G(this,"mm2ortho"),G(this,"hdr",null),G(this,"extensions"),G(this,"imageType"),G(this,"img"),G(this,"imaginary"),G(this,"v1"),G(this,"fileObject"),G(this,"dims"),G(this,"onColormapChange",()=>{}),G(this,"onOpacityChange",()=>{}),G(this,"mm000"),G(this,"mm100"),G(this,"mm010"),G(this,"mm001"),G(this,"cal_min"),G(this,"cal_max"),G(this,"robust_min"),G(this,"robust_max"),G(this,"global_min"),G(this,"global_max"),G(this,"urlImgData"),G(this,"isManifest"),G(this,"limitFrames4D"),this.init(e,t,n,s,r,a,l,c,h,d,f,p,g,y,x,b,w,S,C)}init(e=null,t="",n="",s=1,r=null,a=NaN,l=NaN,c=!0,h=.02,d=!1,f=!1,p="",g=0,y=Ye.UNKNOWN,x=NaN,b=NaN,w=!0,S=null,C=0,E=null){const D=n==="";if(D&&(n="gray"),this.name=t,this.imageType=y,this.id=ig(),this._colormap=n,this._opacity=s>1?1:s,this.percentileFrac=h,this.ignoreZeroVoxels=d,this.trustCalMinMax=c,this.colormapNegative=p,this.colormapLabel=S,this.frame4D=g,this.cal_minNeg=x,this.cal_maxNeg=b,this.colorbarVisible=w,this.colormapType=C,this.useQFormNotSForm=f,!e)return;if(D&&this.hdr&&this.hdr.intent_code===1002&&(n="random",this._colormap=n),this.hdr&&typeof this.hdr.magic=="number"&&(this.hdr.magic="n+1"),this.nFrame4D=1,this.hdr)for(let _=4;_<7;_++)this.hdr.dims[_]>1&&(this.nFrame4D*=this.hdr.dims[_]);if(this.frame4D=Math.min(this.frame4D,this.nFrame4D-1),this.nTotalFrame4D=this.nFrame4D,!this.hdr||!E)return;this.nVox3D=this.hdr.dims[1]*this.hdr.dims[2]*this.hdr.dims[3];const M=this.nVox3D*(this.hdr.numBitsPerVoxel/8),N=E.byteLength/M;N!==this.nFrame4D&&(N>0&&N*M===E.byteLength?X.debug("Loading the first "+N+" of "+this.nFrame4D+" volumes"):X.warn("This header does not match voxel data",this.hdr,E.byteLength),this.nFrame4D=N),(this.hdr.intent_code===1007||this.hdr.intent_code===2003)&&this.nFrame4D===3&&this.hdr.datatypeCode===16&&(E=this.float32V1asRGBA(new Float32Array(E)).buffer),UP(this.hdr,f),FP(E,this.hdr);const I=PP(E,this.hdr);this.img=I.img,I.imaginary&&(this.imaginary=I.imaginary),I.updatedDatatypeCode!==void 0&&(this.hdr.datatypeCode=I.updatedDatatypeCode),I.updatedNumBitsPerVoxel!==void 0&&(this.hdr.numBitsPerVoxel=I.updatedNumBitsPerVoxel),this.calculateRAS(),isNaN(a)||(this.hdr.cal_min=a),isNaN(l)||(this.hdr.cal_max=l),this.calMinMax()}static async new(e=null,t="",n="",s=1,r=null,a=NaN,l=NaN,c=!0,h=.02,d=!1,f=!1,p="",g=0,y=Ye.UNKNOWN,x=NaN,b=NaN,w=!0,S=null,C=0,E){const D=new pd,M=/(?:\.([^.]+))?$/;let N=M.exec(t)[1]||"";N=N.toUpperCase(),N==="GZ"&&(N=M.exec(t.slice(0,-3))[1],N=N.toUpperCase());let I=null;if(y===Ye.UNKNOWN&&(y=Ye.parse(N)),e instanceof ArrayBuffer&&e.byteLength>=2&&y===Ye.DCM){const _=new Uint8Array(e);(_[0]===92&&_[1]===1||_[1]===92&&_[0]===1)&&(y=Ye.NII)}switch(D.imageType=y,y){case Ye.DCM_FOLDER:case Ye.DCM_MANIFEST:case Ye.DCM:return;case Ye.FIB:[I,D.v1]=await hc.readFIB(D,e);break;case Ye.MIH:case Ye.MIF:I=await hg.readMIF(D,e,r);break;case Ye.NHDR:case Ye.NRRD:if(I=await k3.readNrrd(D,e),I===null)throw new Error(`Failed to parse NHDR/NRRD file ${t}`);break;case Ye.MHD:case Ye.MHA:I=await ug.readMHA(D,e,r);break;case Ye.MGH:case Ye.MGZ:if(I=await F3.readMgh(D,e),I===null)throw new Error(`Failed to parse MGH/MGZ file ${t}`);break;case Ye.SRC:I=await hc.readSRC(D,e);break;case Ye.V:I=cg.readECAT(D,e);break;case Ye.V16:I=uc.readV16(D,e);break;case Ye.VMR:I=uc.readVMR(D,e);break;case Ye.HEAD:I=await lg.readHEAD(D,e,r);break;case Ye.BMP:I=await fd.readBMP(D,e);break;case Ye.NPY:I=await dc.readNPY(D,e);break;case Ye.NPZ:I=await dc.readNPZ(D,e);break;case Ye.ZARR:I=await dg.readZARR(D,e,E);break;case Ye.NII:if(I=await L3.readNifti(D,e,r),I===null)throw new Error(`Failed to parse NIfTI file ${t}.`);break;default:throw new Error("Image type not supported")}return D.init(e,t,n,s,r,a,l,c,h,d,f,p,g,y,x,b,w,S,C,I),D}computeObliqueAngle(e){return V3(e)}float32V1asRGBA(e){return j3(this,e)}loadImgV1(e=!1,t=!1,n=!1){return yP(this,e,t,n)}calculateOblique(){mg(this)}readECAT(e){return cg.readECAT(this,e)}readV16(e){return uc.readV16(this,e)}async readNPY(e){return dc.readNPY(this,e)}async readNPZ(e){return dc.readNPZ(this,e)}async imageDataFromArrayBuffer(e){return fd.imageDataFromArrayBuffer(e)}async readBMP(e){return fd.readBMP(this,e)}async readZARR(e,t){return dg.readZARR(this,e,t)}readVMR(e){return uc.readVMR(this,e)}async readFIB(e){return hc.readFIB(this,e)}async readSRC(e){return hc.readSRC(this,e)}async readHEAD(e,t){return lg.readHEAD(this,e,t)}async readMHA(e,t){return ug.readMHA(this,e,t)}async readMIF(e,t){return hg.readMIF(this,e,t)}calculateRAS(){gP(this)}async hdr2RAS(e=1){return AP(this,e)}img2RAS(e=0){return vP(this,e)}vox2mm(e,t){return Hs(this,e,t)}mm2vox(e,t=!1){return U3(this,e,t)}arrayEquals(e,t){return fg(e,t)}setColormap(e){p0(this,e)}setColormapLabel(e){bP(this,e)}async setColormapLabelFromUrl(e){return wP(this,e)}get colormap(){return Nb(this)}get colorMap(){return Nb(this)}set colormap(e){p0(this,e)}set colorMap(e){p0(this,e)}get opacity(){return SP(this)}set opacity(e){CP(this,e)}calMinMax(e=Number.POSITIVE_INFINITY,t=!0){return w1(this,e,t)}intensityRaw2Scaled(e){return fc(this,e)}intensityScaled2Raw(e){return xP(this,e)}async saveToUint8Array(e,t=null){return N3(this,e,t)}async saveToDisk(e="",t=null){return HF(this,e,t)}static async fetchDicomData(e,t={}){return EP(e,t)}static async readFirstDecompressedBytes(e,t){return md(e,t)}static extractFilenameFromUrl(e){return TP(e)}static async loadInitialVolumesGz(e="",t={},n=NaN){return z3(e,t,n)}static async loadInitialVolumes(e="",t={},n=NaN){return MP(e,t,n)}static async loadFromUrl({url:e="",urlImgData:t="",headers:n={},name:s="",colormap:r="",opacity:a=1,cal_min:l=NaN,cal_max:c=NaN,trustCalMinMax:h=!0,percentileFrac:d=.02,ignoreZeroVoxels:f=!1,useQFormNotSForm:p=!1,colormapNegative:g="",frame4D:y=0,isManifest:x=!1,limitFrames4D:b=NaN,imageType:w=Ye.UNKNOWN,colorbarVisible:S=!0,buffer:C=new ArrayBuffer(0)}={}){if(e==="")throw Error("url must not be empty");let E=null,D=null,M=null;if(e instanceof Uint8Array&&(e=e.slice().buffer),C.byteLength>0&&(e=C),e instanceof ArrayBuffer)if(D=e,s!=="")e=s;else{const B=new Uint8Array(D);e=B[0]===31&&B[1]===139?"array.nii.gz":"array.nii"}let N="";if(s===""?N=g0(e):N=g0(s),w===Ye.UNKNOWN&&(w=Ye.parse(N)),w===Ye.UNKNOWN&&typeof e=="string"){const B=await fetch(e,{});if(B.redirected){const P=this.extractFilenameFromUrl(B.url);P&&P.length>0&&s===""&&(s=P,N=g0(s),w=Ye.parse(N))}}if(w===Ye.ZARR){const B=await VP(e);D=B.dataBuffer,M=B.zarrData}const I=w===Ye.DCM||Ye.NII;!D&&I&&(D=await this.loadInitialVolumes(e,n,b)),D||(x?(D=await pd.fetchDicomData(e,n),w=Ye.DCM_MANIFEST):D=await jP(e,n));const _=zP(e,N.toUpperCase(),t);let F=null;if(_&&(F=await GP(_,n)),!D)throw new Error("Unable to load buffer properly from volume");if(!s){let B;try{B=new URL(e).pathname.split("/")}catch{B=e.split("/")}s=B.slice(-1)[0],s.indexOf("?")>-1&&(s=s.slice(0,s.indexOf("?")))}return E=await this.new(D,s,r,a,F,l,c,h,d,f,p,g,y,w,NaN,NaN,!0,null,0,M),E.url=e,E.colorbarVisible=S,E}static async readFileAsync(e,t=NaN){return DP(e,t)}static async loadFromFile({file:e,name:t="",colormap:n="",opacity:s=1,urlImgData:r=null,cal_min:a=NaN,cal_max:l=NaN,trustCalMinMax:c=!0,percentileFrac:h=.02,ignoreZeroVoxels:d=!1,useQFormNotSForm:f=!1,colormapNegative:p="",frame4D:g=0,limitFrames4D:y=NaN,imageType:x=Ye.UNKNOWN}){let b=null,w=[];try{if(Array.isArray(e))w=await Promise.all(e.map(C=>this.readFileAsync(C)));else{if(isNaN(y))w=await this.readFileAsync(e);else{const C=await this.readFileAsync(e,512),E=new Uint8Array(C);if(!(E[0]===92&&E[1]===1||E[1]===92&&E[0]===1))w=await this.readFileAsync(e);else{const M=await iu(C);if(!M)throw new Error("could not read nifti header");const N=M.numBitsPerVoxel/8,I=[1,2,3].reduce((P,O)=>P*(M.dims[O]>1?M.dims[O]:1),1),_=[4,5,6].reduce((P,O)=>P*(M.dims[O]>1?M.dims[O]:1),1),F=Math.max(Math.min(y,_),1),B=M.vox_offset+F*I*N;w=await this.readFileAsync(e,B)}}t=e.name}let S=null;r&&(S=await this.readFileAsync(r)),b=await this.new(w,t,n,s,S,a,l,c,h,d,f,p,g,x,NaN,NaN,!0,null,0,null),b.fileObject=e}catch(S){throw X.error(S),new Error("could not build NVImage")}if(b===null)throw new Error("could not build NVImage");return b}static createNiftiArray(e=[256,256,256],t=[1,1,1],n=[1,0,0,-128,0,1,0,-128,0,0,1,-128,0,0,0,1],s=2,r=new Uint8Array){return GF(e,t,n,s,r)}static createNiftiHeader(e=[256,256,256],t=[1,1,1],n=[1,0,0,-128,0,1,0,-128,0,0,1,-128,0,0,0,1],s=2){return D3(e,t,n,s)}getVolumeData(e=[-1,0,0],t=[0,0,0],n="same"){return qF(this,e,t,n)}setVolumeData(e=[-1,0,0],t=[0,0,0],n=new Uint8Array){XF(this,e,t,n)}static async loadFromBase64({base64:e,name:t="",colormap:n="",opacity:s=1,cal_min:r=NaN,cal_max:a=NaN,trustCalMinMax:l=!0,percentileFrac:c=.02,ignoreZeroVoxels:h=!1,useQFormNotSForm:d=!1,colormapNegative:f="",frame4D:p=0,imageType:g=Ye.UNKNOWN,cal_minNeg:y=NaN,cal_maxNeg:x=NaN,colorbarVisible:b=!0,colormapLabel:w=null}){let S=null;try{const C=RP(e);S=await this.new(C,t,n,s,null,r,a,l,c,h,d,f,p,g,y,x,b,w,0,null)}catch(C){X.debug(C)}if(S===null)throw new Error("could not load NVImage");return S}clone(){const e=new pd;return e.id=ig(),e.hdr=Object.assign({},this.hdr),e.img=this.img.slice(),e.calculateRAS(),e.calMinMax(),e}zeroImage(){this.img.fill(0)}getImageMetadata(){return NP(this)}static zerosLike(e,t="same"){const n=e.clone();return n.zeroImage(),t==="uint8"&&(n.img=Uint8Array.from(n.img),n.hdr.datatypeCode=2,n.hdr.numBitsPerVoxel=8),t==="float32"&&(n.img=Float32Array.from(n.img),n.hdr.datatypeCode=16,n.hdr.numBitsPerVoxel=32),n}getValue(e,t,n,s=0,r=!1){return YF(this,e,t,n,s,r)}getValues(e,t,n,s=0,r=!1){return I3(this,e,t,n,s,r)}applyOptionsUpdate(e){_P(this,e)}getImageOptions(){return IP(this)}toUint8Array(e=null){return R3(this,e)}convertVox2Frac(e){return dP(this,e)}convertFrac2Vox(e){return fP(this,e)}convertFrac2MM(e,t=!1){return mP(this,e,t)}convertMM2Frac(e,t=!1){return pP(this,e,t)}},zi=(i=>(i[i.AXIAL=0]="AXIAL",i[i.CORONAL=1]="CORONAL",i[i.SAGITTAL=2]="SAGITTAL",i[i.MULTIPLANAR=3]="MULTIPLANAR",i[i.RENDER=4]="RENDER",i))(zi||{}),G3=(i=>(i[i.none=0]="none",i[i.contrast=1]="contrast",i[i.measurement=2]="measurement",i[i.pan=3]="pan",i[i.slicer3D=4]="slicer3D",i[i.callbackOnly=5]="callbackOnly",i[i.roiSelection=6]="roiSelection",i[i.angle=7]="angle",i[i.crosshair=8]="crosshair",i[i.windowing=9]="windowing",i))(G3||{}),Jn={textHeight:-1,fontSizeScaling:.4,fontMinPx:13,colorbarHeight:.05,colorbarWidth:-1,showColorbarBorder:!0,crosshairWidth:1,crosshairWidthUnit:"voxels",crosshairGap:0,rulerWidth:4,show3Dcrosshair:!1,backColor:[0,0,0,1],crosshairColor:[1,0,0,1],fontColor:[.5,.5,.5,1],selectionBoxColor:[1,1,1,.5],clipPlaneColor:[.7,0,.7,.5],isClipPlanesCutaway:!1,paqdUniforms:[.3,.5,.5,1],rulerColor:[1,0,0,.8],colorbarMargin:.05,trustCalMinMax:!0,clipPlaneHotKey:"KeyC",cycleClipPlaneHotKey:"KeyP",viewModeHotKey:"KeyV",doubleTouchTimeout:500,longTouchTimeout:1e3,keyDebounceTime:50,isNearestInterpolation:!1,isResizeCanvas:!0,atlasOutline:0,atlasActiveIndex:0,isRuler:!1,isColorbar:!1,isOrientCube:!1,tileMargin:0,multiplanarPadPixels:0,multiplanarForceRender:!1,multiplanarEqualSize:!1,multiplanarShowRender:2,isRadiologicalConvention:!1,meshThicknessOn2D:1/0,dragMode:1,dragModePrimary:8,mouseEventConfig:void 0,touchEventConfig:void 0,yoke3Dto2DZoom:!1,isDepthPickMesh:!1,isCornerOrientationText:!1,isOrientationTextVisible:!0,showAllOrientationMarkers:!1,heroImageFraction:0,heroSliceType:4,sagittalNoseLeft:!1,isSliceMM:!1,isV1SliceShader:!1,forceDevicePixelRatio:0,logLevel:"info",loadingText:"loading ...",isForceMouseClickToVoxelCenters:!1,dragAndDropEnabled:!0,drawingEnabled:!1,penValue:1,penType:0,floodFillNeighbors:6,isFilledPen:!1,thumbnail:"",maxDrawUndoBitmaps:8,sliceType:3,meshXRay:0,isAntiAlias:null,limitFrames4D:NaN,isAdditiveBlend:!1,showLegend:!0,legendBackgroundColor:[.3,.3,.3,.5],legendTextColor:[1,1,1,1],multiplanarLayout:0,renderOverlayBlend:1,sliceMosaicString:"",centerMosaic:!1,penSize:1,interactive:!0,clickToSegment:!1,clickToSegmentRadius:3,clickToSegmentBright:!0,clickToSegmentAutoIntensity:!1,clickToSegmentIntensityMax:NaN,clickToSegmentIntensityMin:NaN,clickToSegmentPercent:0,clickToSegmentMaxDistanceMM:Number.POSITIVE_INFINITY,clickToSegmentIs2D:!1,selectionBoxLineThickness:4,selectionBoxIsOutline:!1,scrollRequiresFocus:!1,showMeasureUnits:!0,measureTextJustify:"center",measureTextColor:[1,0,0,1],measureLineColor:[1,0,0,1],measureTextHeight:.06,isAlphaClipDark:!1,gradientOrder:1,gradientOpacity:0,renderSilhouette:0,gradientAmount:0,invertScrollDirection:!1,is2DSliceShader:!1,bounds:null,showBoundsBorder:!1,boundsBorderColor:[1,1,1,1]},mc={gamma:1,azimuth:110,elevation:10,crosshairPos:Ae(.5,.5,.5),clipPlanes:[[0,0,0,0]],clipPlaneDepthAziElevs:[[2,0,0]],volScaleMultiplier:1,pan2Dxyzmm:Lt(0,0,0,1)};function HP(i,e){const t={};for(const n in i){const s=i[n],r=e[n],a=Array.isArray(s)&&Array.isArray(r);(a&&s.some((l,c)=>l!==r[c])||!a&&s!==r)&&(t[n]=s)}return t}var A0=class Mr{constructor(){G(this,"data",{title:"Untitled document",imageOptionsArray:[],meshOptionsArray:[],opts:{...Jn},previewImageDataURL:"",labels:[],encodedImageBlobs:[],encodedDrawingBlob:""}),G(this,"scene"),G(this,"volumes",[]),G(this,"meshDataObjects"),G(this,"meshes",[]),G(this,"drawBitmap",null),G(this,"imageOptionsMap",new Map),G(this,"meshOptionsMap",new Map),G(this,"completedMeasurements",[]),G(this,"completedAngles",[]),G(this,"_optsProxy",null),G(this,"_optsChangeCallback",null),this.scene={onAzimuthElevationChange:()=>{},onZoom3DChange:()=>{},sceneData:{...mc,pan2Dxyzmm:Lt(0,0,0,1),crosshairPos:Ae(.5,.5,.5)},get renderAzimuth(){return this.sceneData.azimuth},set renderAzimuth(e){this.sceneData.azimuth=e,this.onAzimuthElevationChange&&this.onAzimuthElevationChange(this.sceneData.azimuth,this.sceneData.elevation)},get renderElevation(){return this.sceneData.elevation},set renderElevation(e){this.sceneData.elevation=e,this.onAzimuthElevationChange&&this.onAzimuthElevationChange(this.sceneData.azimuth,this.sceneData.elevation)},get volScaleMultiplier(){return this.sceneData.volScaleMultiplier},set volScaleMultiplier(e){this.sceneData.volScaleMultiplier=e,this.onZoom3DChange(e)},get crosshairPos(){return this.sceneData.crosshairPos},set crosshairPos(e){this.sceneData.crosshairPos=e},get clipPlane(){return this.sceneData.clipPlanes[0]??[]},set clipPlane(e){this.sceneData.clipPlanes[0]=e},get clipPlanes(){return this.sceneData.clipPlanes},set clipPlanes(e){this.sceneData.clipPlanes=e},get clipPlaneDepthAziElevs(){return this.sceneData.clipPlaneDepthAziElevs},set clipPlaneDepthAziElevs(e){this.sceneData.clipPlaneDepthAziElevs=e},get pan2Dxyzmm(){return this.sceneData.pan2Dxyzmm},set pan2Dxyzmm(e){this.sceneData.pan2Dxyzmm=e},get gamma(){return this.sceneData.gamma},set gamma(e){this.sceneData.gamma=e}}}get title(){return this.data.title}get previewImageDataURL(){return this.data.previewImageDataURL}set previewImageDataURL(e){this.data.previewImageDataURL=e}set title(e){this.data.title=e}get imageOptionsArray(){return this.data.imageOptionsArray}get encodedImageBlobs(){return this.data.encodedImageBlobs}get encodedDrawingBlob(){return this.data.encodedDrawingBlob}get opts(){return this._optsProxy||this._createOptsProxy(),this._optsProxy}set opts(e){this.data.opts={...e},this._optsProxy=null}get labels(){return this.data.labels}set labels(e){this.data.labels=e}get customData(){return this.data.customData}set customData(e){this.data.customData=e}hasImage(e){return this.volumes.find(t=>t.id===e.id)!==void 0}hasImageFromUrl(e){return this.data.imageOptionsArray.find(t=>t.url===e)!==void 0}addImageOptions(e,t){if(!this.hasImage(e)&&!t.name)if(t.url){const s=/^(?:[a-z+]+:)?\/\//i.test(t.url)?new URL(t.url):new URL(t.url,window.location.href);t.name=s.pathname.split("/").pop(),t.name.toLowerCase().endsWith(".gz")&&(t.name=t.name.slice(0,-3)),t.name.toLowerCase().endsWith(".nii")||(t.name+=".nii")}else t.name="untitled.nii";t.imageType=Ye.NII,this.data.imageOptionsArray.push(t),this.imageOptionsMap.set(e.id,this.data.imageOptionsArray.length-1)}removeImage(e){if(this.imageOptionsMap.has(e.id)){const t=this.imageOptionsMap.get(e.id);this.data.imageOptionsArray.length>t&&this.data.imageOptionsArray.splice(t,1),this.imageOptionsMap.delete(e.id)}this.volumes=this.volumes.filter(t=>t.id!==e.id)}async fetchLinkedData(){if(this.data.encodedImageBlobs=[],!!this.imageOptionsArray?.length){for(const e of this.imageOptionsArray)if(e.url)try{const t=await fetch(e.url);if(!t.ok){console.warn("Failed to fetch image:",e.url);continue}const n=await t.arrayBuffer(),s=new Uint8Array(n),r=Ve.uint8tob64(s);this.data.encodedImageBlobs.push(r),console.info("fetch linked data fetched from ",e.url)}catch(t){console.warn(`Failed to fetch/encode image from ${e.url}:`,t)}}}getImageOptions(e){return this.imageOptionsMap.has(e.id)?this.data.imageOptionsArray[this.imageOptionsMap.get(e.id)]:null}json(e=!0,t=!0){const n={encodedImageBlobs:[],previewImageDataURL:this.data.previewImageDataURL,imageOptionsMap:new Map},s=[];n.sceneData={...this.scene.sceneData},delete n.sceneData.clipPlane,delete n.sceneData.clipPlaneDepthAziElev,delete n.sceneData.clipThick,delete n.sceneData.clipVolumeLow,delete n.sceneData.clipVolumeHigh,n.opts=HP(this.opts,Jn),this.opts.meshThicknessOn2D===1/0&&(n.opts.meshThicknessOn2D="infinity"),this.opts.meshThicknessOn2D===1/0&&(n.opts.meshThicknessOn2D="infinity"),n.labels=[...this.data.labels];for(const a of n.labels)delete a.onClick;if(n.customData=this.customData,n.completedMeasurements=[...this.completedMeasurements],n.completedAngles=[...this.completedAngles],this.volumes.length)for(let a=0;a<this.volumes.length;a++){const l=this.volumes[a];let c=this.getImageOptions(l);if(c===null?(X.warn("no options found for image, using options from the volume directly"),c={name:l?.name??"",colormap:l?._colormap??"gray",opacity:l?._opacity??1,pairedImgData:null,cal_min:l?.cal_min??NaN,cal_max:l?.cal_max??NaN,trustCalMinMax:l?.trustCalMinMax??!0,percentileFrac:l?.percentileFrac??.02,ignoreZeroVoxels:l?.ignoreZeroVoxels??!1,useQFormNotSForm:l?.useQFormNotSForm??!1,colormapNegative:l?.colormapNegative??"",colormapLabel:l?.colormapLabel??null,imageType:l?.imageType??Ye.NII,frame4D:l?.frame4D??0,limitFrames4D:l?.limitFrames4D??NaN,url:l?.url??"",urlImageData:l?.urlImgData??"",alphaThreshold:!1,cal_minNeg:l?.cal_minNeg??NaN,cal_maxNeg:l?.cal_maxNeg??NaN,colorbarVisible:l?.colorbarVisible??!0}):"imageType"in c||(c.imageType=Ye.NII),c.colormap=l.colormap,c.colormapLabel=l.colormapLabel,c.opacity=l.opacity,c.cal_max=l.cal_max??NaN,c.cal_min=l.cal_min??NaN,s.push(c),e){const h=Ve.uint8tob64(l.toUint8Array());n.encodedImageBlobs.push(h)}n.imageOptionsMap.set(l.id,a)}n.imageOptionsArray=[...s];const r=[];n.connectomes=[];for(const a of this.meshes){if(a.type==="connectome"){n.connectomes.push(JSON.stringify(a.json()));continue}const l={pts:a.pts,tris:a.tris,name:a.name,rgba255:Uint8Array.from(a.rgba255),opacity:a.opacity,connectome:a.connectome,dpg:a.dpg,dps:a.dps,dpv:a.dpv,meshShaderIndex:a.meshShaderIndex,layers:a.layers.map(c=>({values:c.values,nFrame4D:c.nFrame4D,frame4D:0,outlineBorder:c.outlineBorder,global_min:c.global_min,global_max:c.global_max,cal_min:c.cal_min,cal_max:c.cal_max,opacity:c.opacity,colormap:c.colormap,colormapNegative:c.colormapNegative,colormapLabel:c.colormapLabel,useNegativeCmap:c.useNegativeCmap})),hasConnectome:a.hasConnectome,edgeColormap:a.edgeColormap,edgeColormapNegative:a.edgeColormapNegative,edgeMax:a.edgeMax,edgeMin:a.edgeMin,edges:a.edges&&Array.isArray(a.edges)?[...a.edges]:[],extentsMax:a.extentsMax,extentsMin:a.extentsMin,furthestVertexFromOrigin:a.furthestVertexFromOrigin,nodeColormap:a.nodeColormap,nodeColormapNegative:a.nodeColormapNegative,nodeMaxColor:a.nodeMaxColor,nodeMinColor:a.nodeMinColor,nodeScale:a.nodeScale,legendLineThickness:a.legendLineThickness,offsetPt0:a.offsetPt0,nodes:a.nodes};a.offsetPt0&&a.offsetPt0.length>0&&(l.offsetPt0=a.offsetPt0,l.fiberGroupColormap=a.fiberGroupColormap,l.fiberColor=a.fiberColor,l.fiberDither=a.fiberDither,l.fiberRadius=a.fiberRadius,l.colormap=a.colormap),r.push(l)}return n.meshesString=JSON.stringify(tI(r)),t&&this.drawBitmap&&(n.encodedDrawingBlob=Ve.uint8tob64(this.drawBitmap)),n}async download(e,t,n={embedImages:!0}){const s=this.json(n.embedImages),r=JSON.stringify(s),a=t?"application/gzip":"application/json",l=t?await Ve.compressStringToArrayBuffer(r):r;Ve.download(l,e,a)}static deserializeMeshDataObjects(e){if(!e.data.meshesString||e.data.meshesString==="[]"){e.meshDataObjects=[];return}if(e.data.meshesString){e.meshDataObjects=ZN(JSON.parse(e.data.meshesString));for(const t of e.meshDataObjects)for(const n of t.layers)"colorMap"in n&&(n.colormap=n.colorMap,delete n.colorMap),"colorMapNegative"in n&&(n.colormapNegative=n.colorMapNegative,delete n.colorMapNegative)}}static async loadFromUrl(e){const n=await(await fetch(e)).arrayBuffer();let s;if(Ve.isArrayBufferCompressed(n)){const r=await Ve.decompressArrayBuffer(n);s=JSON.parse(r)}else{const r=new TextDecoder;s=JSON.parse(r.decode(n))}return Mr.loadFromJSON(s)}static async loadFromFile(e){const t=await Ve.readFileAsync(e);let n;const s=new Mr;return Ve.isArrayBufferCompressed(t)?n=await Ve.decompressArrayBuffer(t):n=new TextDecoder().decode(t),s.data=JSON.parse(n),s.data.opts.meshThicknessOn2D==="infinity"&&(s.data.opts.meshThicknessOn2D=1/0),s.scene.sceneData={...mc,...s.data.sceneData},Mr.deserializeMeshDataObjects(s),s}static loadFromJSON(e){const t=new Mr;Object.assign(t.data,{...e,imageOptionsArray:e.imageOptionsArray??[],encodedImageBlobs:e.encodedImageBlobs??[],labels:e.labels??[],meshOptionsArray:e.meshOptionsArray??[],connectomes:e.connectomes??[],encodedDrawingBlob:e.encodedDrawingBlob??"",previewImageDataURL:e.previewImageDataURL??"",customData:e.customData??"",title:e.title??"untitled"}),t.data.opts={...Jn,...e.opts||{}},t.data.opts.meshThicknessOn2D==="infinity"&&(t.data.opts.meshThicknessOn2D=1/0),t.scene.sceneData={...mc,...e.sceneData||{}};const n=e.sceneData||{};return n.clipPlane&&!n.clipPlanes&&(t.scene.sceneData.clipPlanes=[n.clipPlane]),n.clipPlaneDepthAziElev&&!n.clipPlaneDepthAziElevs&&(t.scene.sceneData.clipPlaneDepthAziElevs=[n.clipPlaneDepthAziElev]),e.completedMeasurements&&(t.completedMeasurements=e.completedMeasurements.map(s=>({...s,startMM:kn(s.startMM),endMM:kn(s.endMM)}))),e.completedAngles&&(t.completedAngles=e.completedAngles.map(s=>({...s,firstLineMM:{start:kn(s.firstLineMM.start),end:kn(s.firstLineMM.end)},secondLineMM:{start:kn(s.secondLineMM.start),end:kn(s.secondLineMM.end)}}))),t.data.meshesString&&Mr.deserializeMeshDataObjects(t),t}static oldloadFromJSON(e){const t=new Mr;return t.data=e,t.data.opts.meshThicknessOn2D==="infinity"&&(t.data.opts.meshThicknessOn2D=1/0),t.scene.sceneData={...mc,...e.sceneData},Mr.deserializeMeshDataObjects(t),t}setOptsChangeCallback(e){this._optsChangeCallback=e,this._optsProxy=null}removeOptsChangeCallback(){this._optsChangeCallback=null,this._optsProxy=null}_createOptsProxy(){const e=this.data.opts;this._optsProxy=new Proxy(e,{set:(t,n,s)=>{const r=t[n];return r!==s&&(t[n]=s,this._optsChangeCallback&&typeof n=="string"&&n in Jn&&this._optsChangeCallback(n,s,r)),!0},get:(t,n)=>t[n]})}},YP={colormap:"gray",opacity:0,nFrame4D:0,frame4D:0,outlineBorder:0,cal_min:0,cal_max:0,cal_minNeg:0,cal_maxNeg:0,colormapType:0,values:new Array,useNegativeCmap:!1,showLegend:!0},bo=class us{constructor(e,t,n="",s=new Uint8Array([255,255,255,255]),r=1,a=!0,l,c=null,h=null,d=null,f=null,p=null,g=!0,y=""){G(this,"id"),G(this,"name"),G(this,"anatomicalStructurePrimary"),G(this,"colorbarVisible"),G(this,"furthestVertexFromOrigin"),G(this,"extentsMin"),G(this,"extentsMax"),G(this,"opacity"),G(this,"visible"),G(this,"meshShaderIndex",0),G(this,"offsetPt0",null),G(this,"colormapInvert",!1),G(this,"fiberGroupColormap",null),G(this,"indexBuffer"),G(this,"vertexBuffer"),G(this,"vao"),G(this,"vaoFiber"),G(this,"pts"),G(this,"tris"),G(this,"layers"),G(this,"type","mesh"),G(this,"data_type"),G(this,"rgba255"),G(this,"fiberLength"),G(this,"fiberLengths"),G(this,"fiberDensity"),G(this,"fiberDither",.1),G(this,"fiberColor","Global"),G(this,"fiberDecimationStride",1),G(this,"fiberSides",5),G(this,"fiberRadius",0),G(this,"fiberOcclusion",0),G(this,"f32PerVertex",5),G(this,"dpsThreshold",NaN),G(this,"fiberMask"),G(this,"colormap"),G(this,"dpg"),G(this,"dps"),G(this,"dpv"),G(this,"groups"),G(this,"hasConnectome",!1),G(this,"connectome"),G(this,"indexCount"),G(this,"vertexCount",1),G(this,"nodeScale",4),G(this,"edgeScale",1),G(this,"legendLineThickness",0),G(this,"showLegend",!0),G(this,"nodeColormap","warm"),G(this,"edgeColormap","warm"),G(this,"nodeColormapNegative"),G(this,"edgeColormapNegative"),G(this,"nodeMinColor"),G(this,"nodeMaxColor"),G(this,"edgeMin"),G(this,"edgeMax"),G(this,"nodes"),G(this,"edges"),G(this,"points"),this.anatomicalStructurePrimary=y,this.name=n,this.colorbarVisible=g,this.id=ig();const x=la.getExtents(e);if(this.furthestVertexFromOrigin=x.mxDx,this.extentsMin=x.extentsMin,this.extentsMax=x.extentsMax,this.opacity=r>1?1:r,this.visible=a,this.meshShaderIndex=0,this.indexBuffer=l.createBuffer(),this.vertexBuffer=l.createBuffer(),this.vao=l.createVertexArray(),l.bindVertexArray(this.vao),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.indexBuffer),l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer),l.enableVertexAttribArray(0),l.enableVertexAttribArray(1),this.f32PerVertex!==7?(l.vertexAttribPointer(0,3,l.FLOAT,!1,20,0),l.vertexAttribPointer(1,4,l.BYTE,!0,20,12),l.enableVertexAttribArray(2),l.vertexAttribPointer(2,4,l.UNSIGNED_BYTE,!0,20,16)):(l.vertexAttribPointer(0,3,l.FLOAT,!1,28,0),l.vertexAttribPointer(1,3,l.FLOAT,!1,28,12),l.enableVertexAttribArray(2),l.vertexAttribPointer(2,4,l.UNSIGNED_BYTE,!0,28,24)),l.bindVertexArray(null),this.vaoFiber=l.createVertexArray(),this.offsetPt0=null,this.hasConnectome=!1,this.colormapInvert=!1,this.fiberGroupColormap=null,this.pts=e,this.layers=[],this.type="mesh",this.tris=t,s[3]<1){this.rgba255=s,this.fiberLength=2,this.fiberDither=.1,this.fiberColor="Global",this.fiberDecimationStride=1,this.fiberMask=[],this.colormap=c,this.dpg=h,this.dps=d,this.dpv=f,this.groups=p,h&&this.initValuesArray(h),d&&this.initValuesArray(d),f&&this.initValuesArray(f),p&&this.initValuesArray(p),this.offsetPt0=new Uint32Array(t),this.tris=new Uint32Array(0),this.updateFibers(l),l.bindVertexArray(this.vaoFiber),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.indexBuffer),l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer),l.enableVertexAttribArray(0),l.vertexAttribPointer(0,3,l.FLOAT,!1,16,0),l.enableVertexAttribArray(1),l.vertexAttribPointer(1,4,l.UNSIGNED_BYTE,!0,16,12),l.bindVertexArray(null);return}if(c){this.connectome=c,this.hasConnectome=!0;const w=Object.keys(c);for(let S=0,C=w.length;S<C;S++)this[w[S]]=c[w[S]]}this.rgba255=s,this.updateMesh(l)}initValuesArray(e){for(let t=0;t<e.length;t++){const n=e[t].vals.reduce((r,a)=>Math.min(r,a)),s=e[t].vals.reduce((r,a)=>Math.max(r,a));e[t].global_min=n,e[t].global_max=s,e[t].cal_min=n,e[t].cal_max=s}return e}linesToCylinders(e,t,n){function s(_){return Ae(_[0],_[1],_[2])}const r=Math.pow(2,32)-1,a=n.length;let l=0,c=0;for(let _=0;_<a;_++){if(n[_]===r){c++;continue}l++}const h=this.fiberSides,d=h*l,f=this.f32PerVertex;if(f!==5)throw Error("fiberSides > 1 requires f32PerVertex == 5");const p=new Float32Array(d*f),g=new Uint8Array(p.buffer);let y=0,x=qs(),b=qs(),w=qs();const S=bt();let C=bt(),E=0;const D=this.fiberRadius;for(let _=0;_<a;_++){const F=n[_]===r;if(F&&E<1)continue;let B=n[_]*4;if(E++,E<=1){x=Lt(t[B+0],t[B+1],t[B+2],t[B+3]),b=Gs(x),_+1<a&&n[_+1]!==r&&(B=n[_+1]*4,w=Lt(t[B+0],t[B+1],t[B+2],t[B+3]),It(S,s(x),s(w)),On(S,S),C=Sa.getFirstPerpVector(S));continue}F?w=Gs(b):w=Lt(t[B+0],t[B+1],t[B+2],t[B+3]),It(S,s(x),s(w)),On(S,S);const P=bt();ad(P,C,S);const O=bt();ad(O,S,P),C=kn(C);const k=bt();ad(k,S,O),On(k,k);const q=bt();for(let U=0;U<h;U++){const H=Math.cos(U/h*2*Math.PI),Y=Math.sin(U/h*2*Math.PI);q[0]=D*(H*O[0]+Y*k[0]),q[1]=D*(H*O[1]+Y*k[1]),q[2]=D*(H*O[2]+Y*k[2]),Aa(q,s(b),q);const Q=y*f;p[Q+0]=q[0],p[Q+1]=q[1],p[Q+2]=q[2];const te=bt();It(te,q,s(b)),On(te,te);const j=(Q+3)*4;g[j+0]=te[0]*127,g[j+1]=te[1]*127,g[j+2]=te[2]*127,p[Q+4]=b[3],y++}x=Gs(b),b=Gs(w),F&&(E=0)}const M=(l-c)*h*2*3,N=new Uint32Array(M);let I=0;y=0;for(let _=1;_<a;_++){if(n[_]===r){y+=h;continue}if(n[_-1]===r)continue;let F=y,B=y+h;const P=B,O=B+h;for(let k=0;k<h;k++)N[I++]=F,N[I++]=B++,B===O&&(B=O-h),N[I++]=B,N[I++]=F++,F===P&&(F=P-h),N[I++]=B,N[I++]=F;y+=h}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,Uint32Array.from(N),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,g,e.STATIC_DRAW),this.indexCount=M}createFiberDensityMap(){if(this.fiberDensity)return;const e=this.pts,t=e.length/3;let n=0;for(let S=0;S<3;S++){const C=this.extentsMax[S]-this.extentsMin[S];n=Math.max(n,C)}if(this.fiberDensity=new Float32Array(t),n===0)return;const s=64,a=n/(s-1)/2,l=(s-1)/n;let c=new Float32Array(s*s*s);const h=[this.extentsMin[0]-a,this.extentsMin[1]-a,this.extentsMin[2]-a],d=[0,0,0],f=-1,p=s*s;let g=0;for(let S=0;S<t;S++){d[0]=Math.round((e[g++]-h[0])*l),d[1]=Math.round((e[g++]-h[1])*l),d[2]=Math.round((e[g++]-h[2])*l);const C=d[0]+d[1]*s+d[2]*p;C!==f&&c[C]++}function y(S,C){let E=S.slice(),D=-1;const M=C-1;for(let I=0;I<C;I++)for(let _=0;_<C;_++)for(let F=0;F<C;F++)D++,!(F<1||F>=M)&&(S[D]=E[D-1]+E[D]+E[D]+E[D+1]);D=-1,E=S.slice();for(let I=0;I<C;I++)for(let _=0;_<C;_++)for(let F=0;F<C;F++)D++,!(_<1||_>=M)&&(S[D]=E[D-C]+E[D]+E[D]+E[D+C]);const N=C*C;D=-1,E=S.slice();for(let I=0;I<C;I++)for(let _=0;_<C;_++)for(let F=0;F<C;F++)D++,!(I<1||I>=M)&&(S[D]=E[D-N]+E[D]+E[D]+E[N]);return S}c=y(c,s),c=y(c,s);let x=0,b=1/0;const w=s*s*s;for(let S=0;S<w;S++)c[S]<=0||(x=Math.max(x,c[S]),b=Math.min(b,c[S]));if(!(x<=1||x<=b)){g=0;for(let S=0;S<w;S++)c[S]=Math.max(0,c[S]-b);x-=b;for(let S=0;S<t;S++){d[0]=Math.round((e[g++]-h[0])*l),d[1]=Math.round((e[g++]-h[1])*l),d[2]=Math.round((e[g++]-h[2])*l);const C=d[0]+d[1]*s+d[2]*p;this.fiberDensity[S]=c[C]/x}}}updateFibers(e){if(!this.offsetPt0||!this.fiberLength)return;const t=this.pts,n=this.offsetPt0,s=n.length-1,r=t.length/3;if(!this.fiberLengths){this.fiberLengths=new Uint32Array(s);for(let M=0;M<s;M++){const N=n[M]*3,I=(n[M+1]-1)*3;let _=0;for(let F=N;F<I;F+=3){const B=Ae(t[F+0]-t[F+3],t[F+1]-t[F+4],t[F+2]-t[F+5]);_+=Oc(B)}this.fiberLengths[M]=_}}const a=new Float32Array(r*4),l=new Uint32Array(a.buffer);let c=0,h=0;for(let M=0;M<r;M++)a[h+0]=t[c+0],a[h+1]=t[c+1],a[h+2]=t[c+2],c+=3,h+=4;const d=this.fiberDither,f=d*.5;function p(M,N,I){const F=255*(d*Math.random()-f);return M=Math.max(Math.min(M+F,255),0),N=Math.max(Math.min(N+F,255),0),I=Math.max(Math.min(I+F,255),0),M+(N<<8)+(I<<16)}function g(M,N,I,_,F,B,P){const O=Ae(Math.abs(M-_),Math.abs(N-F),Math.abs(I-B));On(O,O);const k=P-f;for(let q=0;q<3;q++)O[q]=255*Math.max(Math.min(Math.abs(O[q])+k,1),0);return O[0]+(O[1]<<8)+(O[2]<<16)}const y=this.fiberColor.toLowerCase();let x=null,b=null;if(y.startsWith("dps")&&this.dps&&this.dps.length>0){const M=parseInt(y.substring(3));M<this.dps.length&&this.dps[M].vals.length===s&&(x=this.dps[M].vals)}if(y.startsWith("dpv")&&this.dpv&&this.dpv.length>0){const M=parseInt(y.substring(3));M<this.dpv.length&&this.dpv[M].vals.length===r&&(b=this.dpv[M])}const w=new Int16Array(s);if(this.groups&&this.fiberGroupColormap!==null||y.startsWith("dpg")&&this.dpg.length>0){const M=new Uint8ClampedArray(this.groups.length*4),N=new Array(this.groups.length).fill(!1);if(this.fiberGroupColormap){const I=this.fiberGroupColormap;I.A===void 0&&(I.A=Array.from(new Uint8ClampedArray(I.I.length).fill(255)));for(let _=0;_<I.I.length;_++){let F=I.I[_];F<0||F>=this.groups.length||I.A[_]<1||(N[F]=!0,F*=4,M[F]=I.R[_],M[F+1]=I.G[_],M[F+2]=I.B[_],M[F+3]=255)}}else if(y.startsWith("dpg")&&this.dpg.length>0){const I=parseInt(y.substring(3)),_=I<this.dpg.length?this.dpg[I]:this.dpg[0],F=yt.colormap(this.colormap,this.colormapInvert),B=_.cal_min,P=_.cal_max,O=this.groups.length;for(let k=0;k<O;k++){const q=_.vals[k];if(q<B)continue;let U=Math.round(255*Math.min(Math.max((q-B)/(P-B),0),1));N[k]=!0;const H=k*4;U*=4,M[H]=F[U+0],M[H+1]=F[U+1],M[H+2]=F[U+2],M[H+3]=255}}w.fill(-1);for(let I=0;I<this.groups.length;I++)if(N[I])for(let _=0;_<this.groups[I].vals.length;_++)w[this.groups[I].vals[_]]=I;for(let I=0;I<s;I++){if(w[I]<0)continue;const _=w[I]%256*4,F=p(M[_],M[_+1],M[_+2]),B=n[I],P=n[I+1]-1,O=B*4+3,k=P*4+3;for(let q=O;q<=k;q+=4)l[q]=F}}else if(b){const M=yt.colormap(this.colormap,this.colormapInvert),N=b.cal_min,I=b.cal_max;let _=3;for(let F=0;F<r;F++){let B=Math.min(Math.max((b.vals[F]-N)/(I-N),0),1);B=Math.round(Math.max(Math.min(255,B*255)))*4;const P=M[B]+(M[B+1]<<8)+(M[B+2]<<16);l[_]=P,_+=4}}else if(x){const M=yt.colormap(this.colormap,this.colormapInvert);let N=x[0],I=x[0];for(let _=0;_<s;_++)N=Math.min(N,x[_]),I=Math.max(I,x[_]);I===N&&(N-=1);for(let _=0;_<s;_++){let F=(x[_]-N)/(I-N);F=Math.round(Math.max(Math.min(255,F*255)))*4;const B=M[F]+(M[F+1]<<8)+(M[F+2]<<16),P=n[_],O=n[_+1]-1,k=P*4+3,q=O*4+3;for(let U=k;U<=q;U+=4)l[U]=B}}else if(y.includes("fixed"))if(d===0){const M=this.rgba255[0]+(this.rgba255[1]<<8)+(this.rgba255[2]<<16);let N=3;for(let I=0;I<r;I++)l[N]=M,N+=4}else for(let M=0;M<s;M++){const N=p(this.rgba255[0],this.rgba255[1],this.rgba255[2]),I=n[M],_=n[M+1]-1,F=I*4+3,B=_*4+3;for(let P=F;P<=B;P+=4)l[P]=N}else if(y.includes("local"))for(let M=0;M<s;M++){const N=n[M],I=n[M+1]-1;let _=N*3;const F=I*3,B=d*Math.random();let P=g(t[_],t[_+1],t[_+2],t[_+4],t[_+5],t[_+6],B),O=N*4+3;for(;_<F;)l[O]=P,O+=4,_+=3,P=g(t[_-3],t[_-2],t[_-1],t[_+3],t[_+4],t[_+5],B);l[O]=l[O-4]}else for(let M=0;M<s;M++){const N=n[M],I=n[M+1]-1,_=N*3,F=I*3,B=g(t[_],t[_+1],t[_+2],t[F],t[F+1],t[F+2],d*Math.random()),P=N*4+3,O=I*4+3;for(let k=P;k<=O;k+=4)l[k]=B}if(this.fiberOcclusion>0){let M=function(N,I){const _=I*(N&255),F=I*(N>>8&255),B=I*(N>>16&255);return _+(F<<8)+(B<<16)};this.createFiberDensityMap();for(let N=0;N<s;N++){const I=n[N],_=n[N+1]-1,F=I*4+3,B=_*4+3;let P=I;const O=Math.min(this.fiberOcclusion,.99);for(let k=F;k<=B;k+=4){let q=this.fiberDensity[P++];if(q<=0)continue;q=q/((1/O-2)*(1-q)+1);const U=1-Math.min(q,.9);let H=l[k];H=M(H,U),l[k]=H}}}if(Number.isFinite(this.dpsThreshold)&&this.dps&&(x||this.dps[0].vals.length===s&&(x=this.dps[0].vals),x))for(let M=0;M<s;M++)x[M]<this.dpsThreshold&&(w[M]=-1);const S=this.fiberLength,C=Math.pow(2,32)-1,E=[];let D=-1;for(let M=0;M<s;M++)if(!(w[M]<0)&&!(this.fiberLengths[M]<S)&&(D++,D%this.fiberDecimationStride===0)){for(let N=n[M];N<n[M+1];N++)E.push(N);E.push(C)}this.fiberSides>2&&this.fiberRadius>0?this.linesToCylinders(e,a,E):(this.indexCount=E.length,e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,Uint32Array.from(l),e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,Uint32Array.from(E),e.STATIC_DRAW))}indexNearestXYZmm(e,t,n){const s=this.pts,r=this.pts.length/3;let a=0,l=1/0,c=0;for(let h=0;h<r;h++){const d=Math.pow(s[a]-e,2)+Math.pow(s[a+1]-t,2)+Math.pow(s[a+2]-n,2);d<l&&(l=d,c=h),a+=3}return l=Math.sqrt(l),[c,l]}unloadMesh(e){if(e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindVertexArray(null),e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.indexBuffer),e.deleteVertexArray(this.vao),e.deleteVertexArray(this.vaoFiber),this.offsetPt0=null,this.tris=null,this.pts=null,this.layers&&this.layers.length>0)for(let t=0;t<this.layers.length;t++)this.layers[t].values=null;if(this.dpg&&this.dpg.length>0)for(let t=0;t<this.dpg.length;t++)this.dpg[t].vals=null;if(this.dps&&this.dps.length>0)for(let t=0;t<this.dps.length;t++)this.dps[t].vals=null}scalars2RGBA(e,t,n,s=!1){const r=n.length;if(4*r<e.length)return X.error(`colormap2RGBA incorrectly specified ${r}*4 != ${e.length}`),e;const a=Math.round(t.opacity*255);let l=t.cal_min,c=t.cal_max,h=yt.colormap(t.colormap,this.colormapInvert),d=1;if(s){if(!t.useNegativeCmap)return e;d=-1,h=yt.colormap(t.colormapNegative,t.colormapInvert),l=t.cal_min,c=t.cal_max,isFinite(t.cal_minNeg)&&isFinite(t.cal_minNeg)&&(l=-t.cal_minNeg,c=-t.cal_maxNeg)}let f=l;t.isTransparentBelowCalMin||(f=Number.NEGATIVE_INFINITY);const p=t.colormapType===2;t.colormapType!==0&&(l=Math.min(l,0));const g=255/(c-l);for(let y=0;y<r;y++){let x=n[y]*d;if(isNaN(x))continue;let b=a;if(x<f)if(x>0&&p)b=Math.round(t.opacity*255*Math.pow(x/f,2));else continue;if(x=(x-l)*g,x<0&&t.isTransparentBelowCalMin)continue;x=Math.min(255,Math.max(0,Math.round(x)))*4;const w=y*4;e[w+0]=h[x+0],e[w+1]=h[x+1],e[w+2]=h[x+2],e[w+3]=b}return e}blendColormap(e,t,n,s,r,a,l=!1){const c=this.pts.length/3,h=Math.min(n.opacity,1);function d(C,E,D){return C*(1-D)+E*D}function f(C,E){return Math.min(C+E,255)}const p=l?-1:1,g=Math.min(Math.max(n.frame4D,0),n.nFrame4D-1),y=c*g;let x=s;n.isTransparentBelowCalMin||(x=Number.NEGATIVE_INFINITY),n.colormapType!==0&&(s=Math.min(s,0));const b=255/(r-s);let w=new Array(c).fill(!1);if(n.outlineBorder!==0){const C=new Uint8Array(c).fill(0);for(let E=0;E<c;E++)p*n.values[E+y]>=x&&(C[E]=1);w=la.getClusterBoundaryU8(C,this.tris);for(let E=0;E<c;E++)p*n.values[E+y]<x&&(w[E]=!1)}const S=new Float32Array(256).fill(h);if(x>s&&n.colormapType===2){let C=Math.round((x-s)*b);C=Math.max(C,1);for(let E=1;E<C;E++)S[E]=h*Math.pow(E/C,2);S[0]=0,x=s+Number.EPSILON}for(let C=0;C<c;C++){const E=p*n.values[C+y];if(E<x)continue;let D=Math.round((E-s)*b);if(D<0&&n.isTransparentBelowCalMin)continue;D=Math.max(0,D),D=Math.min(255,D);let M=S[D];D*=4;let N=C*28+24;if(this.f32PerVertex!==7&&(N=C*20+16),n.isAdditiveBlend){const I=C*4;t[I+0]=f(t[I+0],a[D+0]),t[I+1]=f(t[I+1],a[D+1]),t[I+2]=f(t[I+2],a[D+2]),t[I+3]=f(t[I+3],255)}else{if(w[C]&&(M=n.outlineBorder,n.outlineBorder<0)){e[N+0]=0,e[N+1]=0,e[N+2]=0;continue}e[N+0]=d(e[N+0],a[D+0],M),e[N+1]=d(e[N+1],a[D+1],M),e[N+2]=d(e[N+2],a[D+2],M)}}}updateMesh(e){if(this.offsetPt0){this.updateFibers(e);return}if(this.hasConnectome)return;if(!this.pts||!this.tris||!this.rgba255){X.warn("underspecified mesh");return}function t(h,d,f){return h*(1-f)+d*f}const n=this.generatePosNormClr(this.pts,this.tris,this.rgba255),s=this.pts.length/3,r=new Uint8Array(n.buffer);let a=0;const l=new Uint8Array(s*4);let c=this.tris;if(this.layers&&this.layers.length>0)for(let h=0;h<this.layers.length;h++){const d=this.layers[h],f=d.opacity;if(f<=0||d.cal_min>d.cal_max)continue;if(d.outlineBorder===void 0&&(d.outlineBorder=0),d.isAdditiveBlend===void 0&&(d.isAdditiveBlend=!1),d.colormapLabel&&d.colormapLabel.R&&!d.colormapLabel.lut&&(d.colormapLabel=yt.makeLabelLut(d.colormapLabel,255,d.global_max)),d.colormapLabel&&d.colormapLabel.lut){const g=d.colormapLabel;let y=0;d.colormapLabel.min&&(y=d.colormapLabel.min);let x=g.lut;const b=Math.floor(x.length/4);if(d.atlasValues&&b>0&&b===d.atlasValues.length&&d.colormap){const M=d.atlasValues;let N=!1,I=!0;for(let _=0;_<b;_++)isNaN(M[_])?N=!0:I=!1;if(I){X.debug("invisible mesh: all atlasValues are NaN.");return}if(N){X.debug("some vertices have NaN atlasValues (mesh will be decimated).");const _=new Array(s).fill(!1);for(let k=0;k<s;k++){const q=Math.round(d.values[k])-y;isNaN(M[q])&&(_[k]=!0)}const F=new Array(c.length).fill(!1);for(let k=0;k<c.length;k++)_[c[k]]&&(F[k]=!0);const B=this.tris;let P=0;for(let k=0;k<B.length;k+=3)!F[k]&&!F[k+1]&&!F[k+2]&&P++;P===0&&X.debug("invisible mesh: all triangles of a vertex with a NaN atlasValue."),c=new Uint32Array(P*3);let O=0;for(let k=0;k<B.length;k+=3)!F[k]&&!F[k+1]&&!F[k+2]&&(c[O++]=B[k],c[O++]=B[k+1],c[O++]=B[k+2])}x.fill(0),x=this.scalars2RGBA(x,d,M),d.useNegativeCmap&&(x=this.scalars2RGBA(x,d,M,!0))}else d.atlasValues&&X.warn(`Expected ${b} atlasValues but got ${d.atlasValues.length} for mesh layer`);if(d.showLegend&&b===d.colormapLabel.labels.length){d.labels=[];for(let M=0;M<b;M++){const N=Array.from(x.slice(M*4,M*4+4)).map(P=>P/255),I=d.colormapLabel.labels[M],_=[0,0,0];let F=0;for(let P=0;P<s;P++)if(d.values[P]===M){const O=P*3;_[0]+=this.pts[O],_[1]+=this.pts[O+1],_[2]+=this.pts[O+2],F++}if(F>0&&(_[0]/=F,_[1]/=F,_[2]/=F),N[3]===0||!I||I.startsWith("_"))continue;N[3]=1;const B=new x1(I,{textColor:N,bulletScale:1,bulletColor:N,lineWidth:0,lineColor:N,textScale:1,textAlignment:"left",lineTerminator:"none"},_);d.labels.push(B),X.debug("label for mesh layer:",B)}}else delete d.labels;const w=Math.min(Math.max(d.frame4D,0),d.nFrame4D-1),S=s*w,C=new Uint8Array(s*4);let E=0;for(let M=0;M<s;M++){const N=d.values[M+S]-y,I=4*Math.min(Math.max(N,0),b-1);C[E+0]=x[I+0],C[E+1]=x[I+1],C[E+2]=x[I+2],C[E+3]=Math.round(x[I+3]/255*d.opacity*255),E+=4}let D=new Array(s).fill(!1);d.outlineBorder!==0&&(D=la.getClusterBoundary(C,this.tris)),E=0;for(let M=0;M<s;M++){let N=M*28+24;this.f32PerVertex!==7&&(N=M*20+16);let I=C[E+3]/255;if(D[M]&&(I=d.outlineBorder,d.outlineBorder<0)){r[N+0]=0,r[N+1]=0,r[N+2]=0,E+=4;continue}r[N+0]=t(r[N+0],C[E+0],I),r[N+1]=t(r[N+1],C[E+1],I),r[N+2]=t(r[N+2],C[E+2],I),E+=4}continue}if(d.values instanceof Uint8Array){const g=new Uint8Array(d.values.buffer);let y=new Array(s).fill(!0);d.outlineBorder!==0&&(y=la.getClusterBoundary(g,this.tris));let x=0;for(let b=0;b<d.values.length;b++){let w=b*28+24;this.f32PerVertex!==7&&(w=b*20+16);let S=f;if(y[b]&&(S=d.outlineBorder,d.outlineBorder<0)){r[w+0]=0,r[w+1]=0,r[w+2]=0,x+=4;continue}r[w+0]=t(r[w+0],g[x+0],S),r[w+1]=t(r[w+1],g[x+1],S),r[w+2]=t(r[w+2],g[x+2],S),x+=4}continue}d.useNegativeCmap&&(d.cal_min=Math.max(Number.EPSILON,d.cal_min),d.cal_max=Math.max(d.cal_min+1e-6,d.cal_max)),d.isTransparentBelowCalMin===void 0&&(d.isTransparentBelowCalMin=!0);const p=yt.colormap(d.colormap,d.colormapInvert);if(d.isAdditiveBlend&&a++,this.blendColormap(r,l,d,d.cal_min,d.cal_max,p),d.useNegativeCmap){const g=yt.colormap(d.colormapNegative,d.colormapInvert);let y=d.cal_min,x=d.cal_max;isFinite(d.cal_minNeg)&&isFinite(d.cal_minNeg)&&(y=-d.cal_minNeg,x=-d.cal_maxNeg),this.blendColormap(r,l,d,y,x,g,!0)}}if(a>0)for(let h=0;h<s;h++){let d=function(y,x){return Math.min(y*x*.00392156862745098,255)},f=h*28+24;this.f32PerVertex!==7&&(f=h*20+16);const p=h*4,g=Math.min(a,l[p+3]/255);g<=0||(r[f+0]=d(r[f+0],l[p+0]),r[f+1]=d(r[f+1],l[p+1]),r[f+2]=d(r[f+2],l[p+2]),r[f+0]=t(r[f+0],l[p+0],g),r[f+1]=t(r[f+1],l[p+1],g),r[f+2]=t(r[f+2],l[p+2],g))}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,Uint32Array.from(c),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW),this.indexCount=c.length,this.vertexCount=this.pts.length}reverseFaces(e){if(this.offsetPt0||this.hasConnectome)return;const t=this.tris||[];for(let n=0;n<t.length;n+=3){const s=t[n];t[n]=t[n+1],t[n+1]=s}this.updateMesh(e)}hierarchicalOrder(){const n=this.tris.length/3,s=Math.log(n/20)/Math.log(4);if(n!==Math.pow(4,s)*20)return NaN;if(this.pts.length/3!==Math.pow(4,s)*10+2)return NaN;for(let a=0;a<15;a+=3)if(this.tris[a]!==0)return NaN;for(let a=15;a<24;a+=3)if(this.tris[a]!==3)return NaN;for(let a=24;a<30;a+=3)if(this.tris[a]!==4)return NaN;return s}decimateFaces(e,t){let n=this.tris;const s=12,r=20;for(let a=e-1;a>=t;a--){const l=Math.pow(4,a+1)*(s-2)+2,c=Math.pow(4,a)*(s-2)+2,h=n.length/3,d=Math.pow(4,a)*r;X.info(`order ${a+1} -> ${a} vertices ${l} -> ${c} faces ${h} -> ${d}`);const f=Array.from({length:l},(g,y)=>y+1);for(let g=0;g<h;g++){const y=n[3*g],x=n[3*g+1],b=n[3*g+2];f[y-1]=Math.min(f[y-1],x,b)}const p=new Uint32Array(d*3);for(let g=0;g<d;g++)p[3*g]=f[n[3*g]-1],p[3*g+1]=f[n[3*g+1]-1],p[3*g+2]=f[n[3*g+2]-1];n=p}this.tris=new Uint32Array(n)}decimateHierarchicalMesh(e,t=4){const n=this.hierarchicalOrder();if(isNaN(n))return X.warn("Unable to decimate mesh: it does not have a hierarchical structure"),!1;if(t>=n)return X.warn(`Unable to decimate mesh: input order (${n}) must be larger than downsampled order (${t})`),!1;const s=this.pts.length/3,a=Math.pow(4,t)*(12-2)+2;if(this.pts=new Float32Array(this.pts.slice(0,a*3)),this.decimateFaces(n,t),this.layers&&this.layers.length>0)for(let l=0;l<this.layers.length;l++){const c=this.layers[l];c.values instanceof Float32Array||c.values.length!==s?c.values=new Float32Array(c.values.slice(0,a)):X.warn("decimation logic needs to be updated")}return this.updateMesh(e),!0}async setLayerProperty(e,t,n,s){const r=this.layers[e];if(!r||!(t in r)){X.warn("mesh does not have property ",t," for layer ",r);return}if(t==="colormapLabel")if(typeof n=="object")r[t]=yt.makeLabelLut(n,255,r.global_max);else if(typeof n=="string"){const a=await yt.makeLabelLutFromUrl(n);r[t]=a,this.updateMesh(s);return}else X.error("colormapLabel requires a string or object");else r[t]=n;this.updateMesh(s)}setProperty(e,t,n){if(!(e in this)){console.warn("Mesh does not have property:",e,this);return}this[e]=t,this.updateMesh(n)}generatePosNormClr(e,t,n){(e.length<3||n.length<4)&&(X.error("Catastrophic failure generatePosNormClr()"),X.debug("this",this),X.debug("pts",e),X.debug("rgba",n));const s=la.generateNormals(e,t),r=e.length/3,a=r===n.length/4,l=this.f32PerVertex,c=new Float32Array(r*l),h=new Uint8Array(c.buffer);let d=0,f=0,p=0,g=(l-1)*4;for(let y=0;y<r;y++)c[p+0]=e[d+0],c[p+1]=e[d+1],c[p+2]=e[d+2],l!==7?(h[g-4]=s[d+0]*127,h[g-3]=s[d+1]*127,h[g-2]=s[d+2]*127):(c[p+3]=s[d+0],c[p+4]=s[d+1],c[p+5]=s[d+2]),h[g]=n[f+0],h[g+1]=n[f+1],h[g+2]=n[f+2],h[g+3]=n[f+3],a&&(f+=4),d+=3,p+=l,g+=l*4;return c}static async readMesh(e,t,n,s=1,r=new Uint8Array([255,255,255,255]),a=!0){let l=new Uint32Array([]),c=new Float32Array([]),h="",d;const f=/(?:\.([^.]+))?$/;let p=f.exec(t)[1];if(p=p.toUpperCase(),p==="GZ"&&(p=f.exec(t.slice(0,-3))[1],p=p.toUpperCase()),p==="JCON"&&X.error("you should never see this message: load using nvconnectome not nvmesh"),p==="JSON"&&X.error("you should never see this message: load using nvconnectome not nvmesh"),r[3]=Math.max(1,r[3]),p==="TCK"||p==="TRK"||p==="TT"||p==="TRX"||p==="TRACT"){if(p==="TCK"?d=Ut.readTCK(e):p==="TRACT"?d=Ut.readTRACT(e):p==="TT"?d=await Ut.readTT(e):p==="TRX"?d=await Ut.readTRX(e):d=await Ut.readTRK(e),typeof d>"u"){const b=new Float32Array([0,0,0,0,0,0]),w=new Uint32Array([0]);d={pts:b,offsetPt0:w},X.error("Creating empty tracts")}return r[3]=0,new us(d.pts,d.offsetPt0,t,r,s,a,n,"inferno",d.dpg||null,d.dps||null,d.dpv||null,d.groups)}if(p==="GII")d=await Ut.readGII(e);else if(p==="MZ3")d=await Ut.readMZ3(e),"positions"in d||X.warn("MZ3 does not have positions (statistical overlay?)");else if(p==="ASC")d=Ut.readASC(e);else if(p==="DFS")d=Ut.readDFS(e);else if(p==="BYU"||p==="G")d=Ut.readGEO(e);else if(p==="GEO")d=Ut.readGEO(e,!0);else if(p==="ICO"||p==="TRI")d=Ut.readICO(e);else if(p==="OFF")d=Ut.readOFF(e);else if(p==="NV")d=Ut.readNV(e);else if(p==="OBJ")d=await Ut.readOBJ(e);else if(p==="PLY")d=Ut.readPLY(e);else if(p==="WRL")d=Ut.readWRL(e);else if(p==="X3D")d=Ut.readX3D(e);else if(p==="FIB"||p==="VTK"){if(d=Ut.readVTK(e),"offsetPt0"in d)return r[3]=0,new us(d.pts,d.offsetPt0,t,r,s,a,n,"inferno")}else p==="SRF"?d=await Ut.readSRF(e):p==="STL"?d=Ut.readSTL(e):d=Ut.readFreeSurfer(e);if(d.anatomicalStructurePrimary&&(h=d.anatomicalStructurePrimary),d instanceof Float32Array)throw new Error("fatal: unknown mesh type loaded");if(!("positions"in d))throw new Error("positions not loaded");if(!d.indices)throw new Error("indices not loaded");if(c=d.positions,l=d.indices,"rgba255"in d&&d.rgba255.length>0&&(r=d.rgba255),"colors"in d&&d.colors&&d.colors.length===c.length){const b=c.length/3;r=new Uint8Array(b*4);let w=0,S=0;for(let C=0;C<b;C++)r[S++]=d.colors[w]*255,r[S++]=d.colors[w+1]*255,r[S++]=d.colors[w+2]*255,r[S++]=255,w+=3}const g=c.length/3;if(l.length/3<1||g<3)throw new Error("Mesh should have at least one triangle and three vertices");r[3]=Math.max(1,r[3]);const x=new us(c,l,t,r,s,a,n,null,null,null,null,null,!0,h);if("scalars"in d&&d.scalars.length>0){const b=await Ut.readLayer(t,e,x,s,"gray");typeof b>"u"?X.warn("readLayer() failed to convert scalars"):(x.layers.push(b),x.updateMesh(n))}return x}static async loadLayer(e,t){let n=new Uint8Array().buffer;function s(y){const x=window.atob(y),b=x.length,w=new Uint8Array(b);for(let S=0;S<b;S++)w[S]=x.charCodeAt(S);return w.buffer}if(e.base64!==void 0)n=s(e.base64);else{if(!e.url)throw new Error("layer: missing url");const y=await fetch(e.url,{headers:e.headers});if(!y.ok)throw Error(y.statusText);n=await y.arrayBuffer()}let r,a=[];if(e.name&&e.name!=="")r=e.name;else{if(!e.url)throw new Error("layer: missing url");try{a=new URL(e.url).pathname.split("/")}catch{a=e.url.split("/")}finally{r=a.slice(-1)[0]}}r.indexOf("?")>-1&&(r=r.slice(0,r.indexOf("?")));let l=.5;"opacity"in e&&(l=e.opacity);let c="warm";"colormap"in e&&(c=e.colormap);let h="winter";"colormapNegative"in e&&(h=e.colormapNegative);let d=!1;"useNegativeCmap"in e&&(d=e.useNegativeCmap);let f=null;"cal_min"in e&&(f=e.cal_min);let p=null;"cal_max"in e&&(p=e.cal_max);const g=await Ut.readLayer(r,n,t,l,c,h,d,f,p);g&&t.layers.push(g)}static async loadFromUrl({url:e="",headers:t={},gl:n,name:s="",opacity:r=1,rgba255:a=[255,255,255,255],visible:l=!0,layers:c=[],buffer:h=new ArrayBuffer(0),meshShaderIndex:d=0}={}){let f=e.split("/");if(s===""){try{f=new URL(e).pathname.split("/")}catch{f=e.split("/")}s=f.slice(-1)[0],s.indexOf("?")>-1&&(s=s.slice(0,s.indexOf("?")))}if(e==="")throw Error("url must not be empty");if(!n)throw Error("gl context is null");let p;if(h.byteLength>0)p=h;else{const y=await fetch(e,{headers:t});if(!y.ok)throw Error(y.statusText);p=await y.arrayBuffer()}const g=await this.readMesh(p,s,n,r,new Uint8Array(a),l);if(d!==void 0&&(g.meshShaderIndex=d),!c||c.length<1)return g;for(let y=0;y<c.length;y++)await us.loadLayer(c[y],g);return g.updateMesh(n),g}static async readFileAsync(e){return new Promise((t,n)=>{const s=new FileReader;s.onload=()=>{t(s.result)},s.onerror=n,s.readAsArrayBuffer(e)})}static async loadFromFile({file:e,gl:t,name:n="",opacity:s=1,rgba255:r=[255,255,255,255],visible:a=!0,layers:l=[]}={}){if(!e)throw new Error("file must be set");if(!t)throw new Error("rendering context must be set");const c=await us.readFileAsync(e),h=await us.readMesh(c,n,t,s,new Uint8Array(r),a);if(!l||l.length<1)return h;for(let d=0;d<l.length;d++)await us.loadLayer(l[d],h);return h.updateMesh(t),h}async loadFromBase64({base64:e,gl:t,name:n="",opacity:s=1,rgba255:r=[255,255,255,255],visible:a=!0,layers:l=[]}={}){if(!e)throw new Error("base64 must bet set");if(!t)throw new Error("rendering context must be set");function c(f){const p=window.atob(f),g=p.length,y=new Uint8Array(g);for(let x=0;x<g;x++)y[x]=p.charCodeAt(x);return y.buffer}const h=c(e),d=await us.readMesh(h,n,t,s,new Uint8Array(r),a);if(!l||l.length<1)return d;for(let f=0;f<l.length;f++)await us.loadLayer(l[f],d);return d.updateMesh(t),d}},qP="data:image/jpeg;base64,/9j/4QrFRXhpZgAATU0AKgAAAAgABwESAAMAAAABAAEAAAEaAAUAAAABAAAAYgEbAAUAAAABAAAAagEoAAMAAAABAAIAAAExAAIAAAAdAAAAcgEyAAIAAAAUAAAAj4dpAAQAAAABAAAApAAAANAACvyAAAAnEAAK/IAAACcQQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKQAyMDE4OjA3OjEzIDE3OjU0OjI3AAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAACAKADAAQAAAABAAACAAAAAAAAAAAGAQMAAwAAAAEABgAAARoABQAAAAEAAAEeARsABQAAAAEAAAEmASgAAwAAAAEAAgAAAgEABAAAAAEAAAEuAgIABAAAAAEAAAmPAAAAAAAAAEgAAAABAAAASAAAAAH/2P/tAAxBZG9iZV9DTQAB/+4ADkFkb2JlAGSAAAAAAf/bAIQADAgICAkIDAkJDBELCgsRFQ8MDA8VGBMTFRMTGBEMDAwMDAwRDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAENCwsNDg0QDg4QFA4ODhQUDg4ODhQRDAwMDAwREQwMDAwMDBEMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwM/8AAEQgAoACgAwEiAAIRAQMRAf/dAAQACv/EAT8AAAEFAQEBAQEBAAAAAAAAAAMAAQIEBQYHCAkKCwEAAQUBAQEBAQEAAAAAAAAAAQACAwQFBgcICQoLEAABBAEDAgQCBQcGCAUDDDMBAAIRAwQhEjEFQVFhEyJxgTIGFJGhsUIjJBVSwWIzNHKC0UMHJZJT8OHxY3M1FqKygyZEk1RkRcKjdDYX0lXiZfKzhMPTdePzRieUpIW0lcTU5PSltcXV5fVWZnaGlqa2xtbm9jdHV2d3h5ent8fX5/cRAAICAQIEBAMEBQYHBwYFNQEAAhEDITESBEFRYXEiEwUygZEUobFCI8FS0fAzJGLhcoKSQ1MVY3M08SUGFqKygwcmNcLSRJNUoxdkRVU2dGXi8rOEw9N14/NGlKSFtJXE1OT0pbXF1eX1VmZ2hpamtsbW5vYnN0dXZ3eHl6e3x//aAAwDAQACEQMRAD8A0FEqSiVItYFNCcpAJKXa1EDFZ6f0zKzn7aG+0fSedGj4ldFV0npfTKhbln1rO27gn+RV+d/bQKXncbpuXlGKKnPHiBp/nn2f9JalX1WeG78q5lLe/f7/AObb/wBJHyOu3v8AZjNFFY0B0Lo/6hqz7LH2u3WuNjvFxn8qCWy/p3QaGn9K/IsHZgEf523b/wBNVXVY8+ysNHgdf4BKU6IVTA0VHljfuCg7Dx3c1t+Qj8iPCeEUOfZ0yo/QJb+IVW3AvZwN48ufuW1CYslFDzxaQYOh8FGFt34ldg9w17Hus3IxH1aj3N8e4SQ1wnBTJJKZAqUocqQKSn//0NFRIUkoUi1GQtPovRbeov8AVfNeK0w5/dxHLa//ACaH0fpbup5DtxLcKg/p7OJPPosd/wBX+5/22rXVeui4fY+n/osKsbAWabwNPb+7T/58QJSA6eV1nEwWfZOnNadmhcPoA/8Aox6xbcm2+w2WuL3HuVTa5FaUF1JgVMKDUQJKXAUgEwUgipcBOAkFIIoWhKFKEkUMC1DfUCjwmISQ42XhRL6x8WqjC6J7JWXnYkTawf1h/FJTRThMnhJT/9HSUXNtttqxaBN+Q4MZ5T+cVKQBJMAak+SrYfVPsmRdmtE5GwsxgeGl3tNn9itPK0Ox1rOpwcZvQenu/R1CMu0cucfc6uf5f07/APtlY7HSqbXlxJcS5xMlx5JPLirNZTbXgNqtWGKtWrDCklO1EahNKI1FSQKQUQpBFDIKQUQpBFC6SJVU+1wawST2R7enZNTN7m6DmNYRQ1EykRCZJDAhBsZIRyoOCSnEyaPSs0+i7hC2rUyqg9p8eQqQYgVP/9Kzn2+nj7RzYY+Q1csg2SVa6tb+mDOzGj7z7lntOqUjqmIblRVyoqjSVbqKAXN1hR2FVayjsKcpstKK0quwozSkhMFMITSpgpwQUgThQBUgUUOt0XYX2En3gCB5d1rLlq7HMcHNJaRwRorB6jlFu02GEDG+qGXUm1NyniuI0kDifzlUSLp5TSnKUouTyolJCKwSFRe2HEK+9U7xDpQKn//To579+VZ/WI+72oO0tUnfpMsjxefxKs5VBrA0Uc5eqmWEfTaOoq3W5UWGCrVbuE4ILdY5HY5U2OVhjk5DbY5Ga5VWORWuRQ2WuUwUBrlMOTghOCnlCDk4cihLKfchbk+5JCSU0qEpSipnKYlRlIlJDFxVXJ+iT4Kw4qtkH2H4IKf/1M6qBnie1sH/ADl0PWsMNY17RpAC53LBq6hcB2eSPmd4XYXubmdPa4al7Nw+PKp8yTHJA9LILd5UCeOcetAh5Fw2uhFY9Ty6YO4d9VXaYKnhKwwSjRbtblYY5UWPVhj1IFjcY5Ga5VGPRmuTghtNciByrNciNcihsBycOQQ5SDk5CXcn3IW5PuSQllKUPcn3JKZykXKEpi5FCnOVa93tKK5yrWulwb4kIKf/1afW6/TzW2drWA/Nvsd/31afR88nFFTj/N6BC63R6uH6oHuoO7+yfa//AL6srByDW+J0d+VRczj4h+LNy2UwNjydjIY1wc0djp8DqFmWsLXK2cng/I/BBtcHKKFhmnUkLXQjseqp0Km16nBYCG8x6O16osejsenhYW416I16qteitenBDZDlIOQA9SDkUJw5PuQQ5S3IqS7k+5C3J9ySEm5MXIe9Rc9JS73oDTuu8mgn79E1lkBRxz7C88vOnwGgSQ//1tAhrgWuEtcCHDxB0K5fJodiZL6Ha7D7T4tP0Hf5q6WVQ6vifaKRbWJtpB0HLmcub/WZ9NifONhETRcxlxI15UxZ2VNro/gVMPVbhbAk2C6UwOqGCSpApwCCWwxyOx6ptcisenhYW416K16qNeitenha2g9ED1VD1MORQ2g5SDlXD1IPRUm3Jb0LeoufCSEpehvsQnWqvdkAAklJSSx5scK2nV3fwH5xVgEAADQDQBV8WtwabXj3v4Hg3sP7SMkgl//XtSlJ5HZMmUqxyOqYHpE5FQ/QuM2NH5jj+d/xT/8AwNUGyDqum8jqDoQdRCyc3phqm3HBdVy6saln9X96v/qEycOoXxl0LTBUwhN01GoUwUyl9swptKGHBSBCSkzXojbFXCkHJwQ22vRA9Uw9TFiKG4Hpw9VBan9VFDa9RQstVZ18KvdlAaJWhsWZAHdTw6HXuF9o/RDVjT+cf3v6jUPDwH3EXZIIr5bWdC7+t+6xaoH+wJUgrQlCmAnhFD//0LCSSZTLFKTdDIUVIIKauV0uq8myoim08/uO/rNH0f6zVl3Y9uO7bew1k8O5af6r10ITkBzS1wDmnlpEg/IppC4F5vb3TgLXt6VjOk1E0Hwbq3/Md/5JVX9Ly2/R2Wj+Sdp/zX/+STeFdxNQJ0R2Nks+lTYP7JI/6O5QLXDlrh8WkfwSpVqS3JBrzw0n4AqTcXJd9Gp/+aR/1UIqtiXqDrSrbOl5L/p7WDzMn7mqzV0rHZrZNp89B/mhGitsOVXXkZDttTS7xPYf1nLRxOm1UkPti20aj90HyH539pXtrWgNaAGjgDQJkQEEsgpBQCmEUMgnUZTykp//2f/tErpQaG90b3Nob3AgMy4wADhCSU0EJQAAAAAAEAAAAAAAAAAAAAAAAAAAAAA4QklNBDoAAAAAAO8AAAAQAAAAAQAAAAAAC3ByaW50T3V0cHV0AAAABQAAAABQc3RTYm9vbAEAAAAASW50ZWVudW0AAAAASW50ZQAAAABJbWcgAAAAD3ByaW50U2l4dGVlbkJpdGJvb2wAAAAAC3ByaW50ZXJOYW1lVEVYVAAAAAEAAAAAAA9wcmludFByb29mU2V0dXBPYmpjAAAAEQBBAGoAdQBzAHQAZQAgAGQAZQAgAHAAcgB1AGUAYgBhAAAAAAAKcHJvb2ZTZXR1cAAAAAEAAAAAQmx0bmVudW0AAAAMYnVpbHRpblByb29mAAAACXByb29mQ01ZSwA4QklNBDsAAAAAAi0AAAAQAAAAAQAAAAAAEnByaW50T3V0cHV0T3B0aW9ucwAAABcAAAAAQ3B0bmJvb2wAAAAAAENsYnJib29sAAAAAABSZ3NNYm9vbAAAAAAAQ3JuQ2Jvb2wAAAAAAENudENib29sAAAAAABMYmxzYm9vbAAAAAAATmd0dmJvb2wAAAAAAEVtbERib29sAAAAAABJbnRyYm9vbAAAAAAAQmNrZ09iamMAAAABAAAAAAAAUkdCQwAAAAMAAAAAUmQgIGRvdWJAb+AAAAAAAAAAAABHcm4gZG91YkBv4AAAAAAAAAAAAEJsICBkb3ViQG/gAAAAAAAAAAAAQnJkVFVudEYjUmx0AAAAAAAAAAAAAAAAQmxkIFVudEYjUmx0AAAAAAAAAAAAAAAAUnNsdFVudEYjUHhsQFIAAAAAAAAAAAAKdmVjdG9yRGF0YWJvb2wBAAAAAFBnUHNlbnVtAAAAAFBnUHMAAAAAUGdQQwAAAABMZWZ0VW50RiNSbHQAAAAAAAAAAAAAAABUb3AgVW50RiNSbHQAAAAAAAAAAAAAAABTY2wgVW50RiNQcmNAWQAAAAAAAAAAABBjcm9wV2hlblByaW50aW5nYm9vbAAAAAAOY3JvcFJlY3RCb3R0b21sb25nAAAAAAAAAAxjcm9wUmVjdExlZnRsb25nAAAAAAAAAA1jcm9wUmVjdFJpZ2h0bG9uZwAAAAAAAAALY3JvcFJlY3RUb3Bsb25nAAAAAAA4QklNA+0AAAAAABAASAAAAAEAAQBIAAAAAQABOEJJTQQmAAAAAAAOAAAAAAAAAAAAAD+AAAA4QklNBA0AAAAAAAQAAAAeOEJJTQQZAAAAAAAEAAAAHjhCSU0D8wAAAAAACQAAAAAAAAAAAQA4QklNJxAAAAAAAAoAAQAAAAAAAAABOEJJTQP1AAAAAABIAC9mZgABAGxmZgAGAAAAAAABAC9mZgABAKGZmgAGAAAAAAABADIAAAABAFoAAAAGAAAAAAABADUAAAABAC0AAAAGAAAAAAABOEJJTQP4AAAAAABwAAD/////////////////////////////A+gAAAAA/////////////////////////////wPoAAAAAP////////////////////////////8D6AAAAAD/////////////////////////////A+gAADhCSU0EAAAAAAAAAgAAOEJJTQQCAAAAAAACAAA4QklNBDAAAAAAAAEBADhCSU0ELQAAAAAABgABAAAAMjhCSU0ECAAAAAAAEAAAAAEAAAJAAAACQAAAAAA4QklNBB4AAAAAAAQAAAAAOEJJTQQaAAAAAAM9AAAABgAAAAAAAAAAAAACAAAAAgAAAAAEAG0AYwA2ADEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAABudWxsAAAAAgAAAAZib3VuZHNPYmpjAAAAAQAAAAAAAFJjdDEAAAAEAAAAAFRvcCBsb25nAAAAAAAAAABMZWZ0bG9uZwAAAAAAAAAAQnRvbWxvbmcAAAIAAAAAAFJnaHRsb25nAAACAAAAAAZzbGljZXNWbExzAAAAAU9iamMAAAABAAAAAAAFc2xpY2UAAAASAAAAB3NsaWNlSURsb25nAAAAAAAAAAdncm91cElEbG9uZwAAAAAAAAAGb3JpZ2luZW51bQAAAAxFU2xpY2VPcmlnaW4AAAANYXV0b0dlbmVyYXRlZAAAAABUeXBlZW51bQAAAApFU2xpY2VUeXBlAAAAAEltZyAAAAAGYm91bmRzT2JqYwAAAAEAAAAAAABSY3QxAAAABAAA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bnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTgtMDctMTJUMjA6MDc6NDcrMDE6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDE4LTA3LTEzVDE3OjU0OjI3KzAxOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDE4LTA3LTEzVDE3OjU0OjI3KzAxOjAwIiBkYzpmb3JtYXQ9ImltYWdlL2pwZWciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3MmVhYjVmZS02NDZkLWVhNDMtODQyNC0xNWQzZTgwOWExNDQiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo0OGNjMGI3YS1iYTJkLWZmNDAtYmNkNC1jNGQzMzIyZjBiNzQiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDphYzFjM2NhNS1hYTg4LWI5NGMtOGE4MS05YmU4MjA3ZGZiODciPiA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8cmRmOkJhZz4gPHJkZjpsaT5hZG9iZTpkb2NpZDpwaG90b3Nob3A6YThjMGNhZTYtODNjYy1hYzQ4LWI2YzAtN2FiODNlOWJkMGM3PC9yZGY6bGk+IDwvcmRmOkJhZz4gPC9waG90b3Nob3A6RG9jdW1lbnRBbmNlc3RvcnM+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6YWMxYzNjYTUtYWE4OC1iOTRjLThhODEtOWJlODIwN2RmYjg3IiBzdEV2dDp3aGVuPSIyMDE4LTA3LTEyVDIwOjA3OjQ3KzAxOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpjYmI3MzZlZC0zOTRhLTM2NDgtYThiOC02Mzk1MmY0NDcxMjIiIHN0RXZ0OndoZW49IjIwMTgtMDctMTNUMTY6MTM6NTgrMDE6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjQ2YjNkYTI3LWI4YjEtYmU0Yi1hYTQ4LTExZGM5NmZkNTIyZiIgc3RFdnQ6d2hlbj0iMjAxOC0wNy0xM1QxNzo1NDoyNyswMTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY29udmVydGVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJmcm9tIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AgdG8gaW1hZ2UvanBlZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9qcGVnIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo3MmVhYjVmZS02NDZkLWVhNDMtODQyNC0xNWQzZTgwOWExNDQiIHN0RXZ0OndoZW49IjIwMTgtMDctMTNUMTc6NTQ6MjcrMDE6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjQ2YjNkYTI3LWI4YjEtYmU0Yi1hYTQ4LTExZGM5NmZkNTIyZiIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjg3NjM1NDk5LWZiMTItYWU0MC04NWEzLThkMWFiN2NkZGVhOSIgc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmFjMWMzY2E1LWFhODgtYjk0Yy04YTgxLTliZTgyMDdkZmI4NyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8P3hwYWNrZXQgZW5kPSJ3Ij8+/+IMWElDQ19QUk9GSUxFAAEBAAAMSExpbm8CEAAAbW50clJHQiBYWVogB84AAgAJAAYAMQAAYWNzcE1TRlQAAAAASUVDIHNSR0IAAAAAAAAAAAAAAAEAAPbWAAEAAAAA0y1IUCAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARY3BydAAAAVAAAAAzZGVzYwAAAYQAAABsd3RwdAAAAfAAAAAUYmtwdAAAAgQAAAAUclhZWgAAAhgAAAAUZ1hZWgAAAiwAAAAUYlhZWgAAAkAAAAAUZG1uZAAAAlQAAABwZG1kZAAAAsQAAACIdnVlZAAAA0wAAACGdmlldwAAA9QAAAAkbHVtaQAAA/gAAAAUbWVhcwAABAwAAAAkdGVjaAAABDAAAAAMclRSQwAABDwAAAgMZ1RSQwAABDwAAAgMYlRSQwAABDwAAAgMdGV4dAAAAABDb3B5cmlnaHQgKGMpIDE5OTggSGV3bGV0dC1Q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",Ib="data:image/png;base64,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",_b={atlas:{type:"msdf",distanceRange:2,size:59.65625,width:512,height:256,yOrigin:"bottom"},metrics:{emSize:1,lineHeight:1.171875,ascender:.927734375,descender:-.244140625,underlineY:-.09765625,underlineThickness:.048828125},glyphs:[{unicode:32,advance:.24755859375},{unicode:33,advance:.25732421875,planeBounds:{left:.056159633438645884,bottom:-.02437761405677056,right:.20702396031135412,top:.7299440203067705},atlasBounds:{left:488.5,bottom:145.5,right:497.5,top:190.5}},{unicode:34,advance:.31982421875,planeBounds:{left:.049409125974004715,bottom:.48691155587022,right:.2840869677759953,top:.77187750662978},atlasBounds:{left:486.5,bottom:213.5,right:500.5,top:230.5}},{unicode:35,advance:.61572265625,planeBounds:{left:.037219103997511785,bottom:-.02169206718177056,right:.6239137085024882,top:.7326295671817705},atlasBounds:{left:66.5,bottom:51.5,right:101.5,top:96.5}},{unicode:36,advance:.5615234375,planeBounds:{left:.02956531458715296,bottom:-.12381369908983761,right:.5324464041628472,top:.8484230740898377},atlasBounds:{left:109.5,bottom:197.5,right:139.5,top:255.5}},{unicode:37,advance:.732421875,planeBounds:{left:.026481776289942378,bottom:-.030073418674698794,right:.7137525987100576,top:.7410109186746989},atlasBounds:{left:88.5,bottom:144.5,right:129.5,top:190.5}},{unicode:38,advance:.62158203125,planeBounds:{left:.03225572125458355,bottom:-.030073418674698794,right:.6357130287454166,top:.7410109186746989},atlasBounds:{left:130.5,bottom:144.5,right:166.5,top:190.5}},{unicode:39,advance:.17431640625,planeBounds:{left:.028244602049502358,bottom:.49895501673814824,right:.14558352295049765,top:.7671582645118518},atlasBounds:{left:498.5,bottom:62.5,right:505.5,top:78.5}},{unicode:40,advance:.341796875,planeBounds:{left:.042983329377291775,bottom:-.250029542422407,right:.34471198312270823,top:.8227834486724072},atlasBounds:{left:.5,bottom:191.5,right:18.5,top:255.5}},{unicode:41,advance:.34765625,planeBounds:{left:-.003159248747708225,bottom:-.250029542422407,right:.29856940499770823,top:.8227834486724072},atlasBounds:{left:19.5,bottom:191.5,right:37.5,top:255.5}},{unicode:42,advance:.4306640625,planeBounds:{left:-.011208599684062338,bottom:.27785390031593765,right:.44138438093406235,top:.7304468809340623},atlasBounds:{left:449.5,bottom:23.5,right:476.5,top:50.5}},{unicode:43,advance:.56689453125,planeBounds:{left:.01353503347629649,bottom:.053493525733368255,right:.5499415290237036,top:.6066627242666317},atlasBounds:{left:361.5,bottom:17.5,right:393.5,top:50.5}},{unicode:44,advance:.1962890625,planeBounds:{left:-.009919475797210583,bottom:-.15981695975478,right:.1744702570472106,top:.12514899100478},atlasBounds:{left:498.5,bottom:79.5,right:509.5,top:96.5}},{unicode:45,advance:.27587890625,planeBounds:{left:-.00527594412977999,bottom:.24333249267450235,right:.27969000662978,top:.36067141357549765},atlasBounds:{left:52.5,bottom:7.5,right:69.5,top:14.5}},{unicode:46,advance:.26318359375,planeBounds:{left:.051032680313645884,bottom:-.027092319686354116,right:.20189700718635412,top:.12377200718635412},atlasBounds:{left:501.5,bottom:221.5,right:510.5,top:230.5}},{unicode:47,advance:.412109375,planeBounds:{left:-.013733006073205867,bottom:-.08573505127848349,right:.4053345685732059,top:.7356373950284835},atlasBounds:{left:252.5,bottom:206.5,right:277.5,top:255.5}},{unicode:48,advance:.5615234375,planeBounds:{left:.037458384830081196,bottom:-.030073418674698794,right:.5235767714199189,top:.7410109186746989},atlasBounds:{left:167.5,bottom:144.5,right:196.5,top:190.5}},{unicode:49,advance:.5615234375,planeBounds:{left:.06023674350936354,bottom:-.01998308280677056,right:.37872810024063647,top:.7343385515567705},atlasBounds:{left:488.5,bottom:97.5,right:507.5,top:142.5}},{unicode:50,advance:.5615234375,planeBounds:{left:.025334353719224725,bottom:-.01680925468177056,right:.5449781462807752,top:.7375123796817705},atlasBounds:{left:278.5,bottom:51.5,right:309.5,top:96.5}},{unicode:51,advance:.5615234375,planeBounds:{left:.028181041080081196,bottom:-.030073418674698794,right:.5142994276699189,top:.7410109186746989},atlasBounds:{left:197.5,bottom:144.5,right:226.5,top:190.5}},{unicode:52,advance:.5615234375,planeBounds:{left:.005886103858368255,bottom:-.02169206718177056,right:.5590553023916317,top:.7326295671817705},atlasBounds:{left:310.5,bottom:51.5,right:343.5,top:96.5}},{unicode:53,advance:.5615234375,planeBounds:{left:.055524791080081196,bottom:-.02657487968177056,right:.5416431776699189,top:.7277467546817705},atlasBounds:{left:344.5,bottom:51.5,right:373.5,top:96.5}},{unicode:54,advance:.5615234375,planeBounds:{left:.046003306705081196,bottom:-.034712090549698794,right:.5321216932949189,top:.7363722467996989},atlasBounds:{left:227.5,bottom:144.5,right:256.5,top:190.5}},{unicode:55,advance:.5615234375,planeBounds:{left:.018010134969224725,bottom:-.02169206718177056,right:.5376539275307752,top:.7326295671817705},atlasBounds:{left:374.5,bottom:51.5,right:405.5,top:96.5}},{unicode:56,advance:.5615234375,planeBounds:{left:.037702525455081196,bottom:-.030073418674698794,right:.5238209120449189,top:.7410109186746989},atlasBounds:{left:257.5,bottom:144.5,right:286.5,top:190.5}},{unicode:57,advance:.5615234375,planeBounds:{left:.029401744205081196,bottom:-.025434746799698794,right:.5155201307949189,top:.7456495905496989},atlasBounds:{left:287.5,bottom:144.5,right:316.5,top:190.5}},{unicode:58,advance:.2421875,planeBounds:{left:.046394008438645884,bottom:-.029431286627488215,right:.19725833531135412,top:.5572633178774882},atlasBounds:{left:439.5,bottom:61.5,right:448.5,top:96.5}},{unicode:59,advance:.21142578125,planeBounds:{left:.001066852327789419,bottom:-.16459733294591408,right:.1854565851722106,top:.556198895445914},atlasBounds:{left:406.5,bottom:53.5,right:417.5,top:96.5}},{unicode:60,advance:.50830078125,planeBounds:{left:.016948142433865897,bottom:.0726146348300812,right:.4527784200661341,top:.5587330214199189},atlasBounds:{left:394.5,bottom:21.5,right:420.5,top:50.5}},{unicode:61,advance:.548828125,planeBounds:{left:.051535540940937666,bottom:.17620354038436353,right:.5041285215590624,top:.49469489711563647},atlasBounds:{left:477.5,bottom:31.5,right:504.5,top:50.5}},{unicode:62,advance:.5224609375,planeBounds:{left:.047629290940937666,bottom:.0731029160800812,right:.5002222715590624,top:.5592213026699189},atlasBounds:{left:421.5,bottom:21.5,right:448.5,top:50.5}},{unicode:63,advance:.47216796875,planeBounds:{left:.016704001808865897,bottom:-.027876153049698794,right:.4525342794411341,top:.7432081842996989},atlasBounds:{left:317.5,bottom:144.5,right:343.5,top:190.5}},{unicode:64,advance:.89794921875,planeBounds:{left:.034064457306783605,bottom:-.23896750384690937,right:.8721996065996072,top:.7165065663469093},atlasBounds:{left:155.5,bottom:198.5,right:205.5,top:255.5}},{unicode:65,advance:.65234375,planeBounds:{left:-.008838044092129387,bottom:-.02169206718177056,right:.6616700753421295,top:.7326295671817705},atlasBounds:{left:237.5,bottom:51.5,right:277.5,top:96.5}},{unicode:66,advance:.62255859375,planeBounds:{left:.06464099434422473,bottom:-.02169206718177056,right:.5842847869057752,top:.7326295671817705},atlasBounds:{left:205.5,bottom:51.5,right:236.5,top:96.5}},{unicode:67,advance:.65087890625,planeBounds:{left:.038439807122511785,bottom:-.030073418674698794,right:.6251344116274882,top:.7410109186746989},atlasBounds:{left:344.5,bottom:144.5,right:379.5,top:190.5}},{unicode:68,advance:.65576171875,planeBounds:{left:.06301501010836826,bottom:-.02169206718177056,right:.6161842086416317,top:.7326295671817705},atlasBounds:{left:162.5,bottom:51.5,right:195.5,top:96.5}},{unicode:69,advance:.568359375,planeBounds:{left:.0652904160800812,bottom:-.02169206718177056,right:.5514088026699189,top:.7326295671817705},atlasBounds:{left:132.5,bottom:51.5,right:161.5,top:96.5}},{unicode:70,advance:.552734375,planeBounds:{left:.059675181705081196,bottom:-.02169206718177056,right:.5457935682949189,top:.7326295671817705},atlasBounds:{left:102.5,bottom:51.5,right:131.5,top:96.5}},{unicode:71,advance:.68115234375,planeBounds:{left:.040148791497511785,bottom:-.030073418674698794,right:.6268433960024882,top:.7410109186746989},atlasBounds:{left:380.5,bottom:144.5,right:415.5,top:190.5}},{unicode:72,advance:.712890625,planeBounds:{left:.062365588372511785,bottom:-.02169206718177056,right:.6490601928774882,top:.7326295671817705},atlasBounds:{left:30.5,bottom:51.5,right:65.5,top:96.5}},{unicode:73,advance:.27197265625,planeBounds:{left:.06917965680657412,bottom:-.02169206718177056,right:.20328128069342588,top:.7326295671817705},atlasBounds:{left:196.5,bottom:51.5,right:204.5,top:96.5}},{unicode:74,advance:.5517578125,planeBounds:{left:.007184947330081194,bottom:-.02657487968177056,right:.4933033339199188,top:.7277467546817705},atlasBounds:{left:.5,bottom:51.5,right:29.5,top:96.5}},{unicode:75,advance:.626953125,planeBounds:{left:.061633166497511785,bottom:-.02169206718177056,right:.6483277710024882,top:.7326295671817705},atlasBounds:{left:452.5,bottom:97.5,right:487.5,top:142.5}},{unicode:76,advance:.5380859375,planeBounds:{left:.06341786132300943,bottom:-.02169206718177056,right:.5327735449269906,top:.7326295671817705},atlasBounds:{left:423.5,bottom:97.5,right:451.5,top:142.5}},{unicode:77,advance:.873046875,planeBounds:{left:.05911847969322944,bottom:-.02169206718177056,right:.8134401140567705,top:.7326295671817705},atlasBounds:{left:377.5,bottom:97.5,right:422.5,top:142.5}},{unicode:78,advance:.712890625,planeBounds:{left:.062365588372511785,bottom:-.02169206718177056,right:.6490601928774882,top:.7326295671817705},atlasBounds:{left:341.5,bottom:97.5,right:376.5,top:142.5}},{unicode:79,advance:.6875,planeBounds:{left:.033395854136655315,bottom:-.030073418674698794,right:.6536158646133446,top:.7410109186746989},atlasBounds:{left:416.5,bottom:144.5,right:453.5,top:190.5}},{unicode:80,advance:.630859375,planeBounds:{left:.061550166358368255,bottom:-.02169206718177056,right:.6147193648916317,top:.7326295671817705},atlasBounds:{left:273.5,bottom:97.5,right:306.5,top:142.5}},{unicode:81,advance:.6875,planeBounds:{left:.030466166636655315,bottom:-.14391866037519643,right:.6506861771133446,top:.7445045978751964},atlasBounds:{left:214.5,bottom:202.5,right:251.5,top:255.5}},{unicode:82,advance:.61572265625,planeBounds:{left:.06350329135836826,bottom:-.02169206718177056,right:.6166724898916317,top:.7326295671817705},atlasBounds:{left:186.5,bottom:97.5,right:219.5,top:142.5}},{unicode:83,advance:.59326171875,planeBounds:{left:.020778681983368255,bottom:-.030073418674698794,right:.5739478805166317,top:.7410109186746989},atlasBounds:{left:454.5,bottom:144.5,right:487.5,top:190.5}},{unicode:84,advance:.5966796875,planeBounds:{left:.005480822747511787,bottom:-.02169206718177056,right:.5921754272524882,top:.7326295671817705},atlasBounds:{left:112.5,bottom:97.5,right:147.5,top:142.5}},{unicode:85,advance:.6484375,planeBounds:{left:.049098994483368255,bottom:-.02657487968177056,right:.6022681930166317,top:.7277467546817705},atlasBounds:{left:78.5,bottom:97.5,right:111.5,top:142.5}},{unicode:86,advance:.63623046875,planeBounds:{left:-.008269192599201152,bottom:-.02169206718177056,right:.6454762238492011,top:.7326295671817705},atlasBounds:{left:38.5,bottom:97.5,right:77.5,top:142.5}},{unicode:87,advance:.88720703125,planeBounds:{left:.011923628617731797,bottom:-.02169206718177056,right:.8835841838822683,top:.7326295671817705},atlasBounds:{left:220.5,bottom:97.5,right:272.5,top:142.5}},{unicode:88,advance:.626953125,planeBounds:{left:.004098979136655316,bottom:-.02169206718177056,right:.6243189896133446,top:.7326295671817705},atlasBounds:{left:.5,bottom:97.5,right:37.5,top:142.5}},{unicode:89,advance:.6005859375,planeBounds:{left:-.010793598988344685,bottom:-.02169206718177056,right:.6094264114883446,top:.7326295671817705},atlasBounds:{left:148.5,bottom:97.5,right:185.5,top:142.5}},{unicode:90,advance:.5986328125,planeBounds:{left:.024196650733368255,bottom:-.02169206718177056,right:.5773658492666317,top:.7326295671817705},atlasBounds:{left:307.5,bottom:97.5,right:340.5,top:142.5}},{unicode:91,advance:.26513671875,planeBounds:{left:.05437250871693295,bottom:-.17280296457569408,right:.27228764753306706,top:.8329592145756942},atlasBounds:{left:59.5,bottom:195.5,right:72.5,top:255.5}},{unicode:92,advance:.41015625,planeBounds:{left:.0014037126767941326,bottom:-.08573505127848349,right:.4204712873232059,top:.7356373950284835},atlasBounds:{left:278.5,bottom:206.5,right:303.5,top:255.5}},{unicode:93,advance:.26513671875,planeBounds:{left:-.020659233400995285,bottom:-.17280296457569408,right:.2140186084009953,top:.8329592145756942},atlasBounds:{left:94.5,bottom:195.5,right:108.5,top:255.5}},{unicode:94,advance:.41796875,planeBounds:{left:.006855376669722368,bottom:.33229482979472236,right:.40916024833027764,top:.7345997014552776},atlasBounds:{left:486.5,bottom:231.5,right:510.5,top:255.5}},{unicode:95,advance:.451171875,planeBounds:{left:-.017473255794918804,bottom:-.09553469482549765,right:.4686451307949188,top:.021804226075497646},atlasBounds:{left:70.5,bottom:7.5,right:99.5,top:14.5}},{unicode:96,advance:.30908203125,planeBounds:{left:.00391839948107648,bottom:.5860277898277895,right:.2553589442689235,top:.7704175226722105},atlasBounds:{left:36.5,bottom:3.5,right:51.5,top:14.5}},{unicode:97,advance:.5439453125,planeBounds:{left:.028181041080081196,bottom:-.029187146002488215,right:.5142994276699189,top:.5575074585024882},atlasBounds:{left:30.5,bottom:15.5,right:59.5,top:50.5}},{unicode:98,advance:.56103515625,planeBounds:{left:.048932994205081196,bottom:-.032187684160555265,right:.5350513807949189,top:.7724220591605554},atlasBounds:{left:304.5,bottom:207.5,right:333.5,top:255.5}},{unicode:99,advance:.5234375,planeBounds:{left:.024518931705081196,bottom:-.029187146002488215,right:.5106373182949189,top:.5575074585024882},atlasBounds:{left:.5,bottom:15.5,right:29.5,top:50.5}},{unicode:100,advance:.56396484375,planeBounds:{left:.026227916080081196,bottom:-.032187684160555265,right:.5123463026699189,top:.7724220591605554},atlasBounds:{left:334.5,bottom:207.5,right:363.5,top:255.5}},{unicode:101,advance:.52978515625,planeBounds:{left:.026472056705081196,bottom:-.029187146002488215,right:.5125904432949189,top:.5575074585024882},atlasBounds:{left:468.5,bottom:61.5,right:497.5,top:96.5}},{unicode:102,advance:.34716796875,planeBounds:{left:.004575110905578838,bottom:-.022177918535555265,right:.3733545765944212,top:.7824318247855554},atlasBounds:{left:364.5,bottom:207.5,right:386.5,top:255.5}},{unicode:103,advance:.56103515625,planeBounds:{left:.026960337955081196,bottom:-.22888445766762702,right:.5130787245449189,top:.558962582667627},atlasBounds:{left:28.5,bottom:143.5,right:57.5,top:190.5}},{unicode:104,advance:.55078125,planeBounds:{left:.049826556565937666,bottom:-.01892352016762703,right:.5024195371840624,top:.768923520167627},atlasBounds:{left:.5,bottom:143.5,right:27.5,top:190.5}},{unicode:105,advance:.24267578125,planeBounds:{left:.046882289688645884,bottom:-.01680925468177056,right:.19774661656135412,top:.7375123796817705},atlasBounds:{left:498.5,bottom:145.5,right:507.5,top:190.5}},{unicode:106,advance:.23876953125,planeBounds:{left:-.048979545900995285,bottom:-.2324562772148376,right:.1856982959009953,top:.7397804959648377},atlasBounds:{left:140.5,bottom:197.5,right:154.5,top:255.5}},{unicode:107,advance:.5068359375,planeBounds:{left:.044294322330081196,bottom:-.01892352016762703,right:.5304127089199189,top:.768923520167627},atlasBounds:{left:58.5,bottom:143.5,right:87.5,top:190.5}},{unicode:108,advance:.24267578125,planeBounds:{left:.05428707868157412,bottom:-.01892352016762703,right:.18838870256842588,top:.768923520167627},atlasBounds:{left:477.5,bottom:208.5,right:485.5,top:255.5}},{unicode:109,advance:.87646484375,planeBounds:{left:.04430890170737297,bottom:-.024304333502488215,right:.832155942042627,top:.5623902710024882},atlasBounds:{left:116.5,bottom:15.5,right:163.5,top:50.5}},{unicode:110,advance:.5517578125,planeBounds:{left:.049826556565937666,bottom:-.024304333502488215,right:.5024195371840624,top:.5623902710024882},atlasBounds:{left:60.5,bottom:15.5,right:87.5,top:50.5}},{unicode:111,advance:.5703125,planeBounds:{left:.025090213094224725,bottom:-.029187146002488215,right:.5447340056557752,top:.5575074585024882},atlasBounds:{left:193.5,bottom:15.5,right:224.5,top:50.5}},{unicode:112,advance:.56103515625,planeBounds:{left:.048444712955081196,bottom:-.22644305141762702,right:.5345630995449189,top:.561403988917627},atlasBounds:{left:447.5,bottom:208.5,right:476.5,top:255.5}},{unicode:113,advance:.568359375,planeBounds:{left:.025983775455081196,bottom:-.22644305141762702,right:.5121021620449189,top:.561403988917627},atlasBounds:{left:417.5,bottom:208.5,right:446.5,top:255.5}},{unicode:114,advance:.33837890625,planeBounds:{left:.045180595002291775,bottom:-.024304333502488215,right:.34690924874770823,top:.5623902710024882},atlasBounds:{left:449.5,bottom:61.5,right:467.5,top:96.5}},{unicode:115,advance:.515625,planeBounds:{left:.021669814448009427,bottom:-.029187146002488215,right:.4910254980519906,top:.5575074585024882},atlasBounds:{left:164.5,bottom:15.5,right:192.5,top:50.5}},{unicode:116,advance:.32666015625,planeBounds:{left:-.019433670483564695,bottom:-.02877457520298586,right:.3158203892335647,top:.675258950202986},atlasBounds:{left:418.5,bottom:54.5,right:438.5,top:96.5}},{unicode:117,advance:.55126953125,planeBounds:{left:.048117572190937666,bottom:-.034069958502488215,right:.5007105528090624,top:.5526246460024882},atlasBounds:{left:88.5,bottom:15.5,right:115.5,top:50.5}},{unicode:118,advance:.484375,planeBounds:{left:-.002092396419918806,bottom:-.02080579450955998,right:.4840259901699188,top:.5491261070095601},atlasBounds:{left:331.5,bottom:16.5,right:360.5,top:50.5}},{unicode:119,advance:.75146484375,planeBounds:{left:-.002649098431770561,bottom:-.02080579450955998,right:.7516725359317705,top:.5491261070095601},atlasBounds:{left:225.5,bottom:16.5,right:270.5,top:50.5}},{unicode:120,advance:.49560546875,planeBounds:{left:-.0046143729128470395,bottom:-.02080579450955998,right:.4982667166628471,top:.5491261070095601},atlasBounds:{left:300.5,bottom:16.5,right:330.5,top:50.5}},{unicode:121,advance:.47314453125,planeBounds:{left:-.007219349544918806,bottom:-.23645281704262702,right:.4788990370449188,top:.551394223292627},atlasBounds:{left:387.5,bottom:208.5,right:416.5,top:255.5}},{unicode:122,advance:.49560546875,planeBounds:{left:.018007705073009427,bottom:-.02080579450955998,right:.4873633886769906,top:.5491261070095601},atlasBounds:{left:271.5,bottom:16.5,right:299.5,top:50.5}},{unicode:123,advance:.33837890625,planeBounds:{left:.011572188891435306,bottom:-.20234398020069408,right:.3468262486085647,top:.8034181989506942},atlasBounds:{left:73.5,bottom:195.5,right:93.5,top:255.5}},{unicode:124,advance:.24365234375,planeBounds:{left:.06315671142450235,bottom:-.15466084787519643,right:.18049563232549765,top:.7337624103751964},atlasBounds:{left:206.5,bottom:202.5,right:213.5,top:255.5}},{unicode:125,advance:.33837890625,planeBounds:{left:-.010156326733564695,bottom:-.20234398020069408,right:.3250977329835647,top:.8034181989506942},atlasBounds:{left:38.5,bottom:195.5,right:58.5,top:255.5}},{unicode:126,advance:.68017578125,planeBounds:{left:.046984728997511785,bottom:.1766063915990047,right:.6336793335024882,top:.4112842334009953},atlasBounds:{left:.5,bottom:.5,right:35.5,top:14.5}}],kerning:[]},XP=33987,WP=33988,KP=33989;function QP(i,e){const t=i.getContext("webgl2",{alpha:!0,antialias:e});if(!t)throw new Error("Unable to initialize WebGL2. Your browser may not support it.");return{gl:t,max2D:t.getParameter(t.MAX_TEXTURE_SIZE),max3D:t.getParameter(t.MAX_3D_TEXTURE_SIZE)}}function ZP(i,e,t,n,s=!1){if(e&&i.deleteTexture(e),e=i.createTexture(),i.activeTexture(t),i.bindTexture(i.TEXTURE_3D,e),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_R,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.pixelStorei(i.UNPACK_ALIGNMENT,1),i.texStorage3D(i.TEXTURE_3D,1,i.R8,n[1],n[2],n[3]),s){const r=new Uint8Array(n[1]*n[2]*n[3]);i.texSubImage3D(i.TEXTURE_3D,0,0,0,0,n[1],n[2],n[3],i.RED,i.UNSIGNED_BYTE,r)}return e}function JP(i,e,t,n,s){e&&i.deleteTexture(e),e=i.createTexture(),i.activeTexture(t),i.bindTexture(i.TEXTURE_3D,e),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_R,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.pixelStorei(i.UNPACK_ALIGNMENT,1),i.texStorage3D(i.TEXTURE_3D,1,i.R16I,n[1],n[2],n[3]);const r=n[1]*n[2]*n[3];return s.length!==r&&(s=new Int16Array(r)),i.texSubImage3D(i.TEXTURE_3D,0,0,0,0,n[1],n[2],n[3],i.RED_INTEGER,i.SHORT,s),e}function $P(i,e,t,n,s=null,r=!0){if(e&&i.deleteTexture(e),e=i.createTexture(),i.activeTexture(t),i.bindTexture(i.TEXTURE_2D,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.pixelStorei(i.UNPACK_ALIGNMENT,1),i.texStorage2D(i.TEXTURE_2D,1,i.RGBA8,n[1],n[2]),s){let a=s;const l=n[1],c=n[2];if(r){a=new Uint8Array(s.length);const h=l*4;for(let d=0;d<c;d++){const f=d*h,p=(c-1-d)*h;a.set(s.subarray(f,f+h),p)}}i.texSubImage2D(i.TEXTURE_2D,0,0,0,l,c,i.RGBA,i.UNSIGNED_BYTE,a)}return e}function eB(i,e,t,n,s=!1){if(e&&i.deleteTexture(e),e=i.createTexture(),i.activeTexture(t),i.bindTexture(i.TEXTURE_3D,e),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_R,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.pixelStorei(i.UNPACK_ALIGNMENT,1),i.texStorage3D(i.TEXTURE_3D,1,i.RGBA8,n[1],n[2],n[3]),s){const r=new Uint8Array(n[1]*n[2]*n[3]*4);i.texSubImage3D(i.TEXTURE_3D,0,0,0,0,n[1],n[2],n[3],i.RGBA,i.UNSIGNED_BYTE,r)}return e}function tB(i,e,t,n,s=!1){if(e&&i.deleteTexture(e),e=i.createTexture(),i.activeTexture(t),i.bindTexture(i.TEXTURE_3D,e),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_R,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.pixelStorei(i.UNPACK_ALIGNMENT,2),i.pixelStorei(i.PACK_ALIGNMENT,2),i.texStorage3D(i.TEXTURE_3D,1,i.RGBA16UI,n[1],n[2],n[3]),s){const r=new Uint16Array(n[1]*n[2]*n[3]*4);i.texSubImage3D(i.TEXTURE_3D,0,0,0,0,n[1],n[2],n[3],i.RGBA_INTEGER,i.UNSIGNED_SHORT,r)}return e}function H3(i,e){new URL(e,window.location.href).origin!==window.location.origin&&(i.crossOrigin="")}async function iB(i,e,t,n,s,r,a,l,c,h){return new Promise((d,f)=>{const p=new Image;p.onload=()=>{if(!s)return;let g;if(t===4){a!==null&&i.deleteTexture(a),g=i.createTexture();const y=p.width/p.height;i.activeTexture(WP),s.use(i),i.uniform1i(s.uniforms.bmpTexture,4),c&&c(y)}else if(t===5)l!==null&&i.deleteTexture(l),g=i.createTexture(),i.activeTexture(KP);else{if(!n){f(new Error("Font shader required for texture unit 3"));return}r!==null&&i.deleteTexture(r),g=i.createTexture(),n.use(i),i.activeTexture(XP),i.uniform1i(n.uniforms.fontTexture,3)}i.bindTexture(i.TEXTURE_2D,g),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,p),d(g),t!==4&&h&&h()},p.onerror=f,H3(p,e),p.src=e})}var Fb=(i,e)=>{const t=Math.floor(Math.log(i)/Math.log(10)),n=i/Math.pow(10,t);let s;return e?n<1.5?s=1:n<3?s=2:n<7?s=5:s=10:n<=1?s=1:n<=2?s=2:n<=5?s=5:s=10,s*Math.pow(10,t)};function nB(i){return new Promise((e,t)=>{let n;i instanceof File?n=Promise.resolve(i):n=new Promise((s,r)=>{i.file(s,r)}),n.then(s=>{const r=new FileReader;r.onload=()=>{typeof r.result=="string"?e(r.result):t(new Error("Expected a string from FileReader.result"))},r.onerror=()=>{t(r.error??new Error("Unknown FileReader error"))},r.readAsDataURL(s)}).catch(s=>t(s))})}function sB(i){const e=i.hdr.dims,t=i.permRAS,n=e[1]*e[2]*e[3],s=new Int16Array(n),r=[0,0,0];for(let g=0;g<3;g++)for(let y=0;y<3;y++)Math.abs(t[g])-1===y&&(r[y]=g*Math.sign(t[g]));let a=1;const l=[1,1,1],c=[!1,!1,!1];for(let g=0;g<r.length;g++)for(let y=0;y<r.length;y++)Math.abs(r[y])===g&&(l[y]=a,(r[y]<0||Object.is(r[y],-0))&&(c[y]=!0),a*=e[y+1]);let h=Ve.range(0,e[1]-1,1);c[0]&&(h=Ve.range(e[1]-1,0,-1));for(let g=0;g<e[1];g++)h[g]*=l[0];let d=Ve.range(0,e[2]-1,1);c[1]&&(d=Ve.range(e[2]-1,0,-1));for(let g=0;g<e[2];g++)d[g]*=l[1];let f=Ve.range(0,e[3]-1,1);c[2]&&(f=Ve.range(e[3]-1,0,-1));for(let g=0;g<e[3];g++)f[g]*=l[2];let p=0;for(let g=0;g<e[3];g++)for(let y=0;y<e[2];y++)for(let x=0;x<e[1];x++)s[h[x]+d[y]+f[g]]=i.img[p],p++;return s}function rB(i){const e=[5960464477539063e-23,152587890625e-16,.00390625,1];return(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3])/255}function Pb(i,e){return i.scl_slope===0&&(i.scl_slope=1),e*i.scl_slope+i.scl_inter}function ec(i,e,t=4){const n=Fb(e-i,!1),s=Fb(n/(t-1),!0),r=Math.floor(i/s)*s,a=Math.ceil(e/s)*s;return[s,r,a,r===i&&a===e]}function Bb(i,e){let t=ec(i,e,3);return t[3]||(t=ec(i,e,5)),t[3]||(t=ec(i,e,4)),t[3]||(t=ec(i,e,3)),t[3]||(t=ec(i,e,5)),[t[0],t[1],t[2]]}function _r(i){return i*(Math.PI/180)}function v0(i,e,t,n){let s=-i,r=-e;return isFinite(t)&&isFinite(n)&&(s=t,r=n),s>r&&([s,r]=[r,s]),[s,r]}function jt(i,e=[0,1,2]){const t=bt();return t[0]=i[e[0]],t[1]=i[e[1]],t[2]=i[e[2]],t}function aB(i){const e=Lt(1,0,0,0),t=qs();return Pi(t,e,i),t[0]}function oB(i,e,t,n){const s=Lt(i,e,t,1),r=Qt(n);rn(r,r),s[0]=s[0]*2-1,s[1]=s[1]*2-1,s[2]=s[2]*2-1;const a=qs();return Pi(a,s,r),a[3]===0||(a[0]/=a[3],a[1]/=a[3],a[2]/=a[3]),a}function S1(i,e=!0){const{volumes:t,meshes:n,volumeObject3D:s}=i;let r=Ae(0,0,0),a=Ae(0,0,0);if(t.length>0){if(!s)throw new Error("volumeObject3D undefined");r=Ae(s.extentsMin[0],s.extentsMin[1],s.extentsMin[2]),a=Ae(s.extentsMax[0],s.extentsMax[1],s.extentsMax[2]),e||(r=Ae(t[0].extentsMinOrtho[0],t[0].extentsMinOrtho[1],t[0].extentsMinOrtho[2]),a=Ae(t[0].extentsMaxOrtho[0],t[0].extentsMaxOrtho[1],t[0].extentsMaxOrtho[2]))}if(n.length>0){if(t.length<1){const c=n[0].extentsMin,h=n[0].extentsMax;r=Ae(c[0],c[1],c[2]),a=Ae(h[0],h[1],h[2])}for(let c=0;c<n.length;c++){const h=n[c].extentsMin,d=n[c].extentsMax,f=Ae(h[0],h[1],h[2]);t1(r,r,f);const p=Ae(d[0],d[1],d[2]);i1(a,a,p)}}const l=bt();return It(l,a,r),[r,a,l]}function Y3(i,e){const{volumes:t,meshes:n,volumeObject3D:s,volIdx:r=0,isSliceMM:a=!1}=e;if(t.length<1){const l=Ae(.1,.5,.5),[c,h,d]=S1({volumes:t,meshes:n,volumeObject3D:s},a);return l[0]=(i[0]-c[0])/d[0],l[1]=(i[1]-c[1])/d[1],l[2]=(i[2]-c[2])/d[2],isFinite(l[0])||(l[0]=.5),isFinite(l[1])||(l[1]=.5),isFinite(l[2])||(l[2]=.5),l}return t[r].convertMM2Frac(i,a)}function mf(i,e){const{volumes:t,meshes:n,volumeObject3D:s,volIdx:r=0,isSliceMM:a=!1}=e,l=Lt(i[0],i[1],i[2],1);if(t.length>0)return t[r].convertFrac2MM(i,a);{const[c,h]=S1({volumes:t,meshes:n,volumeObject3D:s},a),d=(f,p,g)=>f*(1-g)+p*g;l[0]=d(c[0],h[0],i[0]),l[1]=d(c[1],h[1],i[1]),l[2]=d(c[2],h[2],i[2])}return l}function lB(i,e,t=0){return e[t].convertVox2Frac(i)}function cB(i,e,t=0){return e.length<=t?Ae(0,0,0):e[t].convertFrac2Vox(i)}function uB(i,e){return Ve.vox2mm(i,e)}function hB(i,e){return e===1?jt(i,[0,2,1]):e===2?jt(i,[1,2,0]):i}function C1(i,e,t,n,s){const{volumes:r,meshes:a,volumeObject3D:l,isSliceMM:c=!1,restrict0to1:h=!0}=s,d=Ae(-1,-1,-1),f=t[n],p=f.axCorSag;if(p>2)return d;const g=f.leftTopWidthHeight.slice();let y=!1;g[2]<0&&(y=!0,g[0]+=g[2],g[2]=-g[2]);let x=(i-g[0])/g[2];y&&(x=1-x);const b=1-(e-g[1])/g[3];if(x<0||x>1||b<0||b>1||f.AxyzMxy.length<4)return d;let w=Ae(0,0,0);w[0]=f.leftTopMM[0]+x*f.fovMM[0],w[1]=f.leftTopMM[1]+b*f.fovMM[1];const S=f.AxyzMxy;w[2]=S[2]+S[4]*(w[1]-S[1])-S[3]*(w[0]-S[0]),p===1&&(w=jt(w,[0,2,1])),p===2&&(w=jt(w,[2,0,1]));const C=Y3(w,{volumes:r,meshes:a,volumeObject3D:l,isSliceMM:c});return h&&(C[0]<0||C[0]>1||C[1]<0||C[1]>1||C[2]<0||C[2]>1)?d:C}function dB(i,e,t,n){const{volumes:s,meshes:r,volumeObject3D:a,isSliceMM:l=!1,forceSlice:c=-1}=n;for(let h=0;h<t.length;h++){let d=h;c>=0&&(d=c);const f=t[d];if(f.axCorSag>2)continue;const g=f.leftTopWidthHeight;if(i<g[0]||e<g[1]||i>g[0]+g[2]||e>g[1]+g[3])continue;const y=C1(i,e,t,d,{volumes:s,meshes:r,volumeObject3D:a,isSliceMM:l,restrict0to1:!1});if(y[0]<0)continue;const x=mf(y,{volumes:s,meshes:r,volumeObject3D:a,isSliceMM:l});return Lt(x[0],x[1],x[2],d)}return Lt(NaN,NaN,NaN,NaN)}function fB(i,e,t){const{volumes:n,meshes:s,volumeObject3D:r,isSliceMM:a=!1}=t;for(let l=0;l<e.length;l++){const c=C1(i[0],i[1],e,l,{volumes:n,meshes:s,volumeObject3D:r,isSliceMM:a});if(c[0]>=0)return c}return Ae(-1,-1,-1)}function mB(i,e,t){const{volumes:n,meshes:s,volumeObject3D:r,isSliceMM:a=!1,sliceType:l}=t,c=mf(i,{volumes:n,meshes:s,volumeObject3D:r,isSliceMM:a});let h={index:-1,distance:1/0};for(let d=0;d<e.length;d++){const f=e[d],p=f.axCorSag;if(p>2||f.AxyzMxy.length<4)continue;let g=Ae(c[0],c[1],c[2]);p===1&&(g=jt(g,[0,2,1])),p===2&&(g=jt(g,[1,2,0]));const y=f.AxyzMxy,x=y[2]+y[4]*(g[1]-y[1])-y[3]*(g[0]-y[0]),b=Math.abs(g[2]-x),w=l===3?1:.1;if(b<h.distance&&(h={index:d,distance:b}),b<=w){const S=(g[0]-f.leftTopMM[0])/f.fovMM[0],C=(g[1]-f.leftTopMM[1])/f.fovMM[1];if(S>=0&&S<=1&&C>=0&&C<=1){const E=f.leftTopWidthHeight.slice();let D=!1;E[2]<0&&(D=!0,E[0]+=E[2],E[2]=-E[2]);let M=S;D&&(M=1-S);const N=1-C,I=E[0]+M*E[2],_=E[1]+N*E[3];return[I,_]}}}if(h.index>=0&&h.distance<2){const d=h.index,f=e[d],p=f.axCorSag;let g=Ae(c[0],c[1],c[2]);p===1&&(g=jt(g,[0,2,1])),p===2&&(g=jt(g,[1,2,0]));const y=f.AxyzMxy;g[2]=y[2]+y[4]*(g[1]-y[1])-y[3]*(g[0]-y[0]);const x=(g[0]-f.leftTopMM[0])/f.fovMM[0],b=(g[1]-f.leftTopMM[1])/f.fovMM[1];if(x>=-.1&&x<=1.1&&b>=-.1&&b<=1.1){const w=Math.max(0,Math.min(1,x)),S=Math.max(0,Math.min(1,b)),C=f.leftTopWidthHeight.slice();let E=!1;C[2]<0&&(E=!0,C[0]+=C[2],C[2]=-C[2]);let D=w;E&&(D=1-w);const M=1-S,N=C[0]+D*C[2],I=C[1]+M*C[3];return[N,I]}}return null}function pB(i,e,t){const{volumes:n,meshes:s,volumeObject3D:r,isSliceMM:a=!1,preferredSliceType:l}=t,c=mf(i,{volumes:n,meshes:s,volumeObject3D:r,isSliceMM:a});let h={index:-1,distance:1/0};for(let d=0;d<e.length;d++){const f=e[d],p=f.axCorSag;if(p>2||f.AxyzMxy.length<4||l!==void 0&&p!==l)continue;let g=Ae(c[0],c[1],c[2]);p===1&&(g=jt(g,[0,2,1])),p===2&&(g=jt(g,[1,2,0]));const y=f.AxyzMxy,x=y[2]+y[4]*(g[1]-y[1])-y[3]*(g[0]-y[0]),b=Math.abs(g[2]-x);if(b<h.distance&&(h={index:d,distance:b}),b<=.1){const S=(g[0]-f.leftTopMM[0])/f.fovMM[0],C=(g[1]-f.leftTopMM[1])/f.fovMM[1];if(S>=0&&S<=1&&C>=0&&C<=1){const E=f.leftTopWidthHeight.slice();let D=!1;E[2]<0&&(D=!0,E[0]+=E[2],E[2]=-E[2]);let M=S;D&&(M=1-S);const N=1-C,I=E[0]+M*E[2],_=E[1]+N*E[3];return{pos:[I,_],tileIndex:d}}}}if(h.index>=0&&h.distance<2){const d=h.index,f=e[d],p=f.axCorSag;let g=Ae(c[0],c[1],c[2]);p===1&&(g=jt(g,[0,2,1])),p===2&&(g=jt(g,[1,2,0]));const y=f.AxyzMxy;g[2]=y[2]+y[4]*(g[1]-y[1])-y[3]*(g[0]-y[0]);const x=(g[0]-f.leftTopMM[0])/f.fovMM[0],b=(g[1]-f.leftTopMM[1])/f.fovMM[1];if(x>=-.1&&x<=1.1&&b>=-.1&&b<=1.1){const w=Math.max(0,Math.min(1,x)),S=Math.max(0,Math.min(1,b)),C=f.leftTopWidthHeight.slice();let E=!1;C[2]<0&&(E=!0,C[0]+=C[2],C[2]=-C[2]);let D=w;E&&(D=1-w);const M=1-S,N=C[0]+D*C[2],I=C[1]+M*C[3];return{pos:[N,I],tileIndex:d}}}return null}var gB=function(i,e,t){const n=i.createShader(i.VERTEX_SHADER);i.shaderSource(n,e),i.compileShader(n);const s=i.createShader(i.FRAGMENT_SHADER);i.shaderSource(s,t),i.compileShader(s);const r=i.createProgram();if(i.attachShader(r,n),i.attachShader(r,s),i.linkProgram(r),!i.getProgramParameter(r,i.LINK_STATUS))throw console.log(i.getProgramInfoLog(r)),i.getShaderParameter(n,i.COMPILE_STATUS)||console.log("Vertex shader compilation error:",i.getShaderInfoLog(n)),i.getShaderParameter(s,i.COMPILE_STATUS)||console.log("Fragment shader compilation error:",i.getShaderInfoLog(s)),X.error(i.getProgramInfoLog(r)),new Error("Shader failed to link, see console for log");return r},nt=class{constructor(i,e,t){G(this,"program"),G(this,"uniforms",{}),G(this,"isMatcap"),G(this,"isCrosscut"),this.program=gB(i,e,t);const n=/uniform[^;]+[ ](\w+);/g,s=/uniform[^;]+[ ](\w+);/,r=e.match(n),a=t.match(n);r&&r.forEach(l=>{const c=l.match(s);this.uniforms[c[1]]=-1}),a&&a.forEach(l=>{const c=l.match(s);this.uniforms[c[1]]=-1});for(const l in this.uniforms)this.uniforms[l]=i.getUniformLocation(this.program,l)}use(i){i.useProgram(this.program)}},pc=`#version 300 es
#line 4
layout(location=0) in vec3 pos;
layout(location=1) in vec3 texCoords;
uniform mat4 mvpMtx;
out vec3 vColor;
void main(void) {
	gl_Position = mvpMtx * vec4(pos, 1.0);
	vColor = texCoords;
}`,E1=`
	vec4 drawColor(float scalar, float drawOpacity) {
		float nlayer = float(textureSize(colormap, 0).y);
		float layer = (nlayer - 0.5) / nlayer;
		vec4 dcolor = texture(colormap, vec2((scalar * 255.0)/256.0 + 0.5/256.0, layer)).rgba;
		dcolor.a *= drawOpacity;
		return dcolor;
}`,au=`vec3 GetBackPosition(vec3 startPositionTex) {
	vec3 startPosition = startPositionTex * volScale;
	vec3 invR = 1.0 / rayDir;
	vec3 tbot = invR * (vec3(0.0)-startPosition);
	vec3 ttop = invR * (volScale-startPosition);
	vec3 tmax = max(ttop, tbot);
	vec2 t = min(tmax.xx, tmax.yz);
	vec3 endPosition = startPosition + (rayDir * min(t.x, t.y));
	//convert world position back to texture position:
	endPosition = endPosition / volScale;
	return endPosition;
}

float distance2Plane(in vec4 samplePos, in vec4 clipPlane) {
	// treat clipPlane.a > 1 as "no clip" sentinel (keeps existing behavior)
	if (clipPlane.a > 1.0) {
			return 1000.0; // sentinel large distance
	}
	vec3 n = clipPlane.xyz;
	const float EPS = 1e-6;
	float nlen = length(n);
	if (nlen < EPS) {
			return 1000.0; // invalid plane normal
	}
	// signed plane value: dot(n, p-0.5) + a
	float signedDist = dot(n, samplePos.xyz - 0.5) + clipPlane.a;
	// perpendicular (Euclidean) distance is |signedDist| / |n|
	return abs(signedDist) / nlen;
}

// see if clip plane trims ray sampling range sampleStartEnd.x..y
void clipSampleRange(in vec3 dir, in vec4 rayStart, in vec4 clipPlane, inout vec2 sampleStartEnd, inout bool hasClip) {
	const float CSR_EPS = 1e-6;
	// quick exit: no clip plane
	if (clipPlane.a > 1.0)
			return;
	hasClip = true;
	// quick exit: empty range
	if ((sampleStartEnd.y - sampleStartEnd.x) <= CSR_EPS)
			return;
	// Which side does the ray start on? (plane eqn: dot(n, p-0.5) + a = 0)
	float sampleSide = dot(clipPlane.xyz, rayStart.xyz - 0.5) + clipPlane.a;
	bool startsFront = (sampleSide < 0.0);
	float dis = - 1.0;
	// plane normal dot ray direction
	float cdot = dot(dir, clipPlane.xyz);
	// avoid division by 0 for near-parallel plne
	if (abs(cdot) >= CSR_EPS)
		dis = (-clipPlane.a - dot(clipPlane.xyz, rayStart.xyz - 0.5)) / cdot;
	if (dis < 0.0 || dis > sampleStartEnd.y + CSR_EPS) {
			if (startsFront)
				sampleStartEnd = vec2(0.0, 0.0);
			return;
	}
	bool frontface = (cdot > 0.0);
	if (frontface)
		sampleStartEnd.x = max(sampleStartEnd.x, dis);
	else
		sampleStartEnd.y = min(sampleStartEnd.y, dis);
	// if nothing remains, mark empty
	if (sampleStartEnd.y - sampleStartEnd.x <= CSR_EPS)
		sampleStartEnd = vec2(0.0, 0.0);
}

bool skipSample (float pos, vec2 sampleRange) {
	return (pos < sampleRange.x || pos > sampleRange.y);
}

float frac2ndc(vec3 frac) {
//https://stackoverflow.com/questions/7777913/how-to-render-depth-linearly-in-modern-opengl-with-gl-fragcoord-z-in-fragment-sh
	vec4 pos = vec4(frac.xyz, 1.0); //fraction
	vec4 dim = vec4(vec3(textureSize(volume, 0)), 1.0);
	pos = pos * dim;
	vec4 shim = vec4(-0.5, -0.5, -0.5, 0.0);
	pos += shim;
	vec4 mm = transpose(matRAS) * pos;
	float z_ndc = (mvpMtx * vec4(mm.xyz, 1.0)).z;
	return (z_ndc + 1.0) / 2.0;
}`+E1,T1=`void main() {
	if (fColor.x > 2.0) {
		fColor = vec4(1.0, 0.0, 0.0, 0.5);
		return;
	}
	fColor = vec4(0.0,0.0,0.0,0.0);
	vec4 clipPlaneColorX = clipPlaneColor;
	//if (clipPlaneColor.a < 0.0)
	//	clipPlaneColorX.a = - 1.0;
	bool isColorPlaneInVolume = false;
	if (clipPlaneColorX.a < 0.0) {
		isColorPlaneInVolume = true;
		clipPlaneColorX.a = 0.0;
	}
	//fColor = vec4(vColor.rgb, 1.0); return;
	vec3 start = vColor;
	gl_FragDepth = 1.0;
	vec3 backPosition = GetBackPosition(start);
	// fColor = vec4(backPosition, 1.0); return;
	vec3 dir = normalize(backPosition - start);
	//clipVolumeStart(start, backPosition);
	dir = normalize(dir);
	float len = length(backPosition - start);
	float lenVox = length((texVox * start) - (texVox * backPosition));
	if ((lenVox < 0.5) || (len > 3.0)) { //length limit for parallel rays
		return;
	}
	float sliceSize = len / lenVox; //e.g. if ray length is 1.0 and traverses 50 voxels, each voxel is 0.02 in unit cube
	float stepSize = sliceSize; //quality: larger step is faster traversal, but fewer samples
	float opacityCorrection = stepSize/sliceSize;
	vec4 deltaDir = vec4(dir.xyz * stepSize, stepSize);
	vec4 samplePos = vec4(start.xyz, 0.0); //ray position

	vec2 sampleRange = vec2(0.0, len);
	bool hasClip = false;
	for (int i = 0; i < MAX_CLIP_PLANES; i++)
		clipSampleRange(dir, samplePos, clipPlanes[i], sampleRange, hasClip);
	bool isClip = (sampleRange.x > 0.0) || ((sampleRange.y < len) && (sampleRange.y > 0.0));
	float stepSizeFast = sliceSize * 1.9;
	vec4 deltaDirFast = vec4(dir.xyz * stepSizeFast, stepSizeFast);
	if ((isClipCutaway) && (sampleRange.x <= 0.0) && (sampleRange.y >= len)) {
		//completely clipped, but ray does not intersect plane
		if (hasClip)
			samplePos.a = len + 1.0;
		else
			sampleRange = vec2(0.0, 0.0);
	}
	if ((!isClipCutaway) && (sampleRange.x >= sampleRange.y))
		samplePos.a = len + 1.0;
	while (samplePos.a <= len) {
		if (skipSample(samplePos.a, sampleRange) ^^ isClipCutaway) {
			samplePos += deltaDirFast;
			continue;
		}
		float val = texture(volume, samplePos.xyz).a;
		if (val > 0.01)
			break;
		samplePos += deltaDirFast; //advance ray position
	}
	float drawOpacityA = renderDrawAmbientOcclusionXY.y;
	if ((samplePos.a >= len) && (((overlays < 1.0) && (drawOpacityA <= 0.0) ) || (backgroundMasksOverlays > 0)))  {
		if (isClip)
			fColor += clipPlaneColorX;
		return;
	}
	fColor = vec4(1.0, 1.0, 1.0, 1.0);
	//gl_FragDepth = frac2ndc(samplePos.xyz); //crude due to fast pass resolution
	if (samplePos.a > deltaDirFast.a )
		samplePos -= deltaDirFast;
	//end: fast pass
	vec4 colAcc = vec4(0.0,0.0,0.0,0.0);
	vec4 firstHit = vec4(0.0,0.0,0.0,2.0 * len);
	const float earlyTermination = 0.95;
	float backNearest = len; //assume no hit
	float ran = fract(sin(gl_FragCoord.x * 12.9898 + gl_FragCoord.y * 78.233) * 43758.5453);
	// clip planes create steep gradients: reduce aliasing with more jitter
	if (isClip)
		samplePos += deltaDir * ran * 1.41; //jitter ray
	else
		samplePos += deltaDir * ran; //jitter ray
`,pf=`
	if (firstHit.a < len) {
		gl_FragDepth = frac2ndc(firstHit.xyz);
		vec4 paqdSample = texture(paqd, samplePos.xyz);
		if (paqdSample.a > 0.0) {
			//colAcc.rgb = paqdSample.rgb;
			float a = max(abs(paqdUniforms[2]), abs(paqdUniforms[3]));
			colAcc.rgb = mix(colAcc.rgb, paqdSample.rgb, 0.5 * paqdSample.a * a);
		}
		if (isClip) {
			//shade voxels with clip color
			if (clipPlaneColor.a < 0.0) {
					float thresh = 4.0 * sliceSize;
					float firstHit1 = firstHit.a + deltaDir.a;
				if (isClipCutaway) {
					float min1 = abs(firstHit1 - sampleRange.y);
					float dx = samplePos.a - firstHit1;
					if (min1 < thresh)
						colAcc.rgb = mix(colAcc.rgb, clipPlaneColorX.rgb, abs(clipPlaneColor.a));
					else if (( colAcc.a > earlyTermination ) && (dx > thresh)) {
						min1 = abs(firstHit1 - sampleRange.x);
						if (min1 < (thresh * 0.5)) {
							colAcc.rgb = mix(colAcc.rgb , clipPlaneColorX.rgb, abs(clipPlaneColor.a)*0.5);
						}
							
					}
				} else {
					if (abs(firstHit1 - sampleRange.x) < thresh)
						colAcc.rgb = mix(colAcc.rgb, clipPlaneColorX.rgb, abs(clipPlaneColor.a));
				} // clipPlaneColor.a < 0.0
			}
			//ambient occlusion: make creases dark
			float min1 = 1000.0;
			float min2 = 1000.0;
			// find smallest and second-smallest distances
			vec4 firstHit1 = firstHit - deltaDir;
			for (int i = 0; i < MAX_CLIP_PLANES; i++) {
				float d = distance2Plane(firstHit1, clipPlanes[i]);
				if (d < min1) {
						min2 = min1;
						min1 = d;
				} else if (d < min2) {
						min2 = d;
				}
			}
			float thresh = 1.2 * sliceSize;
			if ((isClipCutaway) && (min2 < thresh) && (sampleRange.x > 0.0)) {
				if ((abs(sampleRange.x - firstHit.a) > ( 2.0 * thresh)) && ((abs(sampleRange.y - firstHit.a) > (2.0 * thresh))))
					min2 = thresh; 
			}
			// if second is 0 -> factor 0 (black), if second >= sliceSize -> factor 1 (unchanged)
			const float aoFrac = 0.5;
			float factor = (1.0 - aoFrac) + aoFrac * clamp(min2 / thresh, 0.0, 1.0);
			// linear darkening: multiply color by factor (or use mix(vec3(0), colAcc.rgb, factor))
			colAcc.rgb *= factor;
		}
	}
	colAcc.a = (colAcc.a / earlyTermination) * backOpacity;
	fColor = colAcc;
	float renderDrawAmbientOcclusionX = renderDrawAmbientOcclusionXY.x;
	float drawOpacity = renderDrawAmbientOcclusionXY.y;
	if ((overlays < 1.0) && (drawOpacity <= 0.0))
		return;
	//overlay pass
	samplePos = vec4(start.xyz, 0.0); //ray position
	//start: OPTIONAL fast pass: rapid traversal until first hit
	stepSizeFast = sliceSize * 1.0;
	deltaDirFast = vec4(dir.xyz * stepSizeFast, stepSizeFast);
	while (samplePos.a <= len) {
		float val = texture(overlay, samplePos.xyz).a;
		if (drawOpacity > 0.0)
			val = max(val, texture(drawing, samplePos.xyz).r);
		if (val > 0.001)
			break;
		samplePos += deltaDirFast; //advance ray position
	}
	if (samplePos.a >= len) {
		if (isClip && (fColor.a == 0.0))
				fColor += clipPlaneColorX;
			return;
	}
	samplePos -= deltaDirFast;
	if (samplePos.a < 0.0)
		vec4 samplePos = vec4(start.xyz, 0.0); //ray position
	//end: fast pass
	float overFarthest = len;
	colAcc = vec4(0.0, 0.0, 0.0, 0.0);

	samplePos += deltaDir * ran; //jitter ray
	vec4 overFirstHit = vec4(0.0,0.0,0.0,2.0 * len);
	if (backgroundMasksOverlays > 0)
		samplePos = firstHit;
	bool firstDraw = true;
	while (samplePos.a <= len) {
		vec4 colorSample = texture(overlay, samplePos.xyz);
		if ((colorSample.a < 0.01) && (drawOpacity > 0.0)) {
			float val = texture(drawing, samplePos.xyz).r;
			vec4 draw = drawColor(val, drawOpacity);
			if ((draw.a > 0.0) && (firstDraw)) {
				firstDraw = false;
				float sum = 0.0;
				const float mn = 1.0 / 256.0;
				const float sampleRadius = 1.1;
				float dx = sliceSize * sampleRadius;
				vec3 center = samplePos.xyz;
				//six neighbors that share a face
				sum += min(texture(drawing, center.xyz + cross(vec3(0.0,0.0,+dx), dir)).r, mn);
				sum += min(texture(drawing, center.xyz + cross(vec3(0.0,0.0,-dx), dir)).r, mn);
				sum += min(texture(drawing, center.xyz + cross(vec3(0.0,+dx,0.0), dir)).r, mn);
				sum += min(texture(drawing, center.xyz + cross(vec3(0.0,-dx,0.0), dir)).r, mn);
				sum += min(texture(drawing, center.xyz + cross(vec3(+dx,0.0,0.0), dir)).r, mn);
				sum += min(texture(drawing, center.xyz + cross(vec3(-dx,0.0,0.0), dir)).r, mn);
				//float proportion = (sum / mn) / 6.0;
				
				//12 neighbors that share an edge
				dx = sliceSize * sampleRadius * sqrt(2.0) * 0.5;
				sum += min(texture(drawing, center.xyz + cross(vec3(0.0,+dx,+dx), dir)).r, mn);
				sum += min(texture(drawing, center.xyz + cross(vec3(+dx,0.0,+dx), dir)).r, mn);
				sum += min(texture(drawing, center.xyz + cross(vec3(+dx,+dx,0.0), dir)).r, mn);
				sum += min(texture(drawing, center.xyz + cross(vec3(0.0,-dx,-dx), dir)).r, mn);
				sum += min(texture(drawing, center.xyz + cross(vec3(-dx,0.0,-dx), dir)).r, mn);
				sum += min(texture(drawing, center.xyz + cross(vec3(-dx,-dx,0.0), dir)).r, mn);

				sum += min(texture(drawing, center.xyz + cross(vec3(0.0,+dx,-dx), dir)).r, mn);
				sum += min(texture(drawing, center.xyz + cross(vec3(+dx,0.0,-dx), dir)).r, mn);
				sum += min(texture(drawing, center.xyz + cross(vec3(+dx,-dx,0.0), dir)).r, mn);
				
				sum += min(texture(drawing, center.xyz + cross(vec3(0.0,-dx,+dx), dir)).r, mn);
				sum += min(texture(drawing, center.xyz + cross(vec3(-dx,0.0,+dx), dir)).r, mn);
				sum += min(texture(drawing, center.xyz + cross(vec3(-dx,+dx,0.0), dir)).r, mn);
				float proportion = (sum / mn) / 18.0; //proportion of six neighbors is non-zero
				
				//a high proportion of hits means crevice
				//since the AO term adds shadows that darken most voxels, it will result in dark surfaces
				//the term brighten adds a little illumination to balance this
				// without brighten, only the most extreme ridges will not be darker
				const float brighten = 1.2;
				vec3 ao = draw.rgb * (1.0 - proportion) * brighten;
				draw.rgb = mix (draw.rgb, ao , renderDrawAmbientOcclusionX);
			}
			colorSample = draw;
		}
		samplePos += deltaDir; //advance ray position
		if (colorSample.a >= 0.01) {
			if (overFirstHit.a > len)
				overFirstHit = samplePos;
			colorSample.a *= renderOverlayBlend;
			colorSample.a = 1.0-pow((1.0 - colorSample.a), opacityCorrection);
			colorSample.rgb *= colorSample.a;
			colAcc= (1.0 - colAcc.a) * colorSample + colAcc;
			overFarthest = samplePos.a;
			if ( colAcc.a > earlyTermination )
				break;
		}
	}
	//if (samplePos.a >= len) {
	if (colAcc.a <= 0.0) {
		if (isClip && (fColor.a == 0.0))
			fColor += clipPlaneColorX;
		return;
	}
	if (overFirstHit.a < firstHit.a)
		gl_FragDepth = frac2ndc(overFirstHit.xyz);
	float overMix = colAcc.a;
	float overlayDepth = 0.3;
	if (fColor.a <= 0.0)
		overMix = 1.0;
	else if (((overFarthest) > backNearest)) {
		float dx = (overFarthest - backNearest)/1.73;
		dx = fColor.a * pow(dx, overlayDepth);
		overMix *= 1.0 - dx;
	}
	fColor.rgb = mix(fColor.rgb, colAcc.rgb, overMix);
	fColor.a = max(fColor.a, colAcc.a);
}`,AB=`#version 300 es
#line 215
#define MAX_CLIP_PLANES 6
precision highp int;
precision highp float;
uniform vec3 rayDir;
uniform vec3 texVox;
uniform int backgroundMasksOverlays;
uniform vec3 volScale;
uniform vec4 clipPlane;
uniform vec4 clipPlanes[MAX_CLIP_PLANES];
uniform highp sampler3D volume, overlay;
uniform highp sampler3D paqd;
uniform vec4 paqdUniforms;
uniform float overlays;
uniform float backOpacity;
uniform mat4 mvpMtx;
uniform mat4 matRAS;
uniform vec4 clipPlaneColor;
uniform float renderOverlayBlend;
uniform highp sampler3D drawing;
uniform highp sampler2D colormap;
uniform vec2 renderDrawAmbientOcclusionXY;
in vec3 vColor;
out vec4 fColor;
`+au+`
	void main() {
	vec3 start = vColor;
	gl_FragDepth = 1.0;
	vec3 backPosition = GetBackPosition(start);
	vec3 dir = normalize(backPosition - start);
	//clipVolumeStart(start, backPosition);
	float len = length(backPosition - start);
	float lenVox = length((texVox * start) - (texVox * backPosition));
	if ((lenVox < 0.5) || (len > 3.0)) { //length limit for parallel rays
		fColor = vec4(0.0,0.0,0.0,0.0);
		return;
	}
	float sliceSize = len / lenVox; //e.g. if ray length is 1.0 and traverses 50 voxels, each voxel is 0.02 in unit cube
	float stepSize = sliceSize; //quality: larger step is faster traversal, but fewer samples
	float opacityCorrection = stepSize/sliceSize;
	vec4 deltaDir = vec4(dir.xyz * stepSize, stepSize);
	vec4 samplePos = vec4(start.xyz, 0.0); //ray position
	vec4 colAcc = vec4(0.0,0.0,0.0,0.0);
	vec4 firstHit = vec4(0.0,0.0,0.0,2.0 * len);
	const float earlyTermination = 0.95;
	float backNearest = len; //assume no hit
	float dis = len;
	//check if axial plane is closest
	vec4 aClip = vec4(0.0, 0.0, 1.0, (1.0- clipPlane.z) - 0.5);
	float adis = (-aClip.a - dot(aClip.xyz, samplePos.xyz-0.5)) / dot(dir,aClip.xyz);
	if (adis > 0.0)
		dis = min(adis, dis);
	//check of coronal plane is closest
	vec4 cClip = vec4(0.0, 1.0, 0.0, (1.0- clipPlane.y) - 0.5);
	float cdis = (-cClip.a - dot(cClip.xyz, samplePos.xyz-0.5)) / dot(dir,cClip.xyz);
	if (cdis > 0.0)
		dis = min(cdis, dis);
	//check if coronal slice is closest
	vec4 sClip = vec4(1.0, 0.0, 0.0, (1.0- clipPlane.x) - 0.5);
	float sdis = (-sClip.a - dot(sClip.xyz, samplePos.xyz-0.5)) / dot(dir,sClip.xyz);
	if (sdis > 0.0)
		dis = min(sdis, dis);
	if ((dis > 0.0) && (dis < len)) {
		samplePos = vec4(samplePos.xyz+dir * dis, dis);
		colAcc = texture(volume, samplePos.xyz);
		colAcc.a = earlyTermination;
		firstHit = samplePos;
		backNearest = min(backNearest, samplePos.a);
	}
	//the following are only used by overlays
	vec4 clipPlaneColorX = clipPlaneColor;
	bool isColorPlaneInVolume = false;
	bool isClip = false;
	bool isClipCutaway = false;
	vec2 sampleRange;
	// vec4 clipPos = applyClip(dir, samplePos, len, isClip);
	float stepSizeFast = sliceSize * 1.9;
	vec4 deltaDirFast = vec4(dir.xyz * stepSizeFast, stepSizeFast);
	if (samplePos.a < 0.0)
		vec4 samplePos = vec4(start.xyz, 0.0); //ray position
	float ran = fract(sin(gl_FragCoord.x * 12.9898 + gl_FragCoord.y * 78.233) * 43758.5453);
	samplePos += deltaDir * ran; //jitter ray
`+pf,vB=`#version 300 es
#line 215
#define MAX_CLIP_PLANES 6
precision highp int;
precision highp float;
uniform vec3 rayDir;
uniform vec3 texVox;
uniform int backgroundMasksOverlays;
uniform vec3 volScale;
uniform vec4 clipPlane;
uniform vec4 clipPlanes[MAX_CLIP_PLANES];
uniform bool isClipCutaway;
uniform highp sampler3D volume, overlay;
uniform highp sampler3D paqd;
uniform vec4 paqdUniforms;
uniform float overlays;
uniform float backOpacity;
uniform mat4 mvpMtx;
uniform mat4 matRAS;
uniform vec4 clipPlaneColor;
uniform float renderOverlayBlend;
uniform highp sampler3D drawing;
uniform highp sampler2D colormap;
uniform vec2 renderDrawAmbientOcclusionXY;
in vec3 vColor;
out vec4 fColor;
`+au+T1+`while (samplePos.a <= len) {
		if (skipSample(samplePos.a, sampleRange) ^^ isClipCutaway) {
			samplePos += deltaDirFast;
			continue;
		}
		vec4 colorSample = texture(volume, samplePos.xyz);
		samplePos += deltaDir; //advance ray position
		if (colorSample.a >= 0.01) {
			if (firstHit.a > len)
				firstHit = samplePos;
			// backNearest = min(backNearest, samplePos.a);
			colorSample.a = 1.0-pow((1.0 - colorSample.a), opacityCorrection);
			colorSample.rgb *= colorSample.a;
			colAcc= (1.0 - colAcc.a) * colorSample + colAcc;
			if ( colAcc.a > earlyTermination )
				break;
		}
	}
	if (firstHit.a < len)
		backNearest = firstHit.a;
`+pf,Mc=192,q3=`#version 300 es
#line 215
#define MAX_CLIP_PLANES 6
precision highp int;
precision highp float;
uniform vec3 rayDir;
uniform vec3 texVox;
uniform int backgroundMasksOverlays;
uniform vec3 volScale;
uniform vec4 clipPlane;
uniform vec4 clipPlanes[MAX_CLIP_PLANES];
uniform bool isClipCutaway;
uniform highp sampler3D volume, overlay;
uniform highp sampler3D paqd;
uniform vec4 paqdUniforms;
uniform float overlays;
uniform float backOpacity;
uniform mat4 mvpMtx;
uniform mat4 normMtx;
uniform mat4 matRAS;
uniform vec4 clipPlaneColor;
uniform float renderOverlayBlend;
uniform highp sampler3D drawing, gradient;
uniform highp sampler2D colormap;
uniform highp sampler2D matCap;
uniform vec2 renderDrawAmbientOcclusionXY;
uniform float gradientAmount;
uniform float silhouettePower;
uniform float gradientOpacity[${Mc}];
in vec3 vColor;
out vec4 fColor;
`,yB=q3+au+T1+`
	float startPos = samplePos.a;
	float clipCloseThresh = 5.0 * deltaDir.a;
	float clipClose = sampleRange.x;
	if (isClipCutaway)
		clipClose = sampleRange.y;
	if (!isClip)
		clipClose = -1.0;
	float brighten = 2.0; //modulating makes average intensity darker 0.5 * 0.5 = 0.25
	//vec4 prevGrad = vec4(0.0);
	float silhouetteThreshold = 1.0 - silhouettePower;
	while (samplePos.a <= len) {
		if (skipSample(samplePos.a, sampleRange) ^^ isClipCutaway) {
			samplePos += deltaDirFast;
			continue;
		}
		vec4 colorSample = texture(volume, samplePos.xyz);
		if (colorSample.a >= 0.0) {
			vec4 grad = texture(gradient, samplePos.xyz);
			grad.rgb = normalize(grad.rgb*2.0 - 1.0);
			//if (grad.a < prevGrad.a)
			//	grad.rgb = prevGrad.rgb;
			//prevGrad = grad;
			vec3 n = mat3(normMtx) * grad.rgb;
			n.y = - n.y;
			vec4 mc = vec4(texture(matCap, n.xy * 0.5 + 0.5).rgb, 1.0) * brighten;
			mc = mix(vec4(1.0), mc, gradientAmount);
			if (abs(samplePos.a - clipClose) > clipCloseThresh)
				colorSample.rgb *= mc.rgb;
			if (firstHit.a > len)
				firstHit = samplePos;
			backNearest = min(backNearest, samplePos.a);
			colorSample.a = 1.0-pow((1.0 - colorSample.a), opacityCorrection);
			int gradIdx = int(grad.a * ${Mc}.0);
			colorSample.a *= gradientOpacity[gradIdx];
			float lightNormDot = dot(grad.rgb, rayDir);
			// n.b. "lightNormDor" is cosTheta, "silhouettePower" is Fresnel effect exponent
 			colorSample.a *= pow(1.0 - abs(lightNormDot), silhouettePower);
 			float viewAlign = abs(lightNormDot); // 0 = perpendicular, 1 = aligned
 			// linearly map silhouettePower (0..1) to a threshold range, e.g., [1.0, 0.0]
 			// Cull voxels that are too aligned with the view direction
 			if (viewAlign > silhouetteThreshold)
 				colorSample.a = 0.0;
			colorSample.rgb *= colorSample.a;
			colAcc= (1.0 - colAcc.a) * colorSample + colAcc;
			if ( colAcc.a > earlyTermination )
				break;
		}
		samplePos += deltaDir; //advance ray position
	}
`+pf,xB=q3+au+T1+`
	float startPos = samplePos.a;
	//float clipClose = clipPos.a + 3.0 * deltaDir.a; //do not apply gradients near clip plane
	float brighten = 2.0; //modulating makes average intensity darker 0.5 * 0.5 = 0.25
	//vec4 prevGrad = vec4(0.0);
	while (samplePos.a <= len) {
		vec4 colorSample = texture(volume, samplePos.xyz);
		if (colorSample.a >= 0.0) {
			vec4 grad = texture(gradient, samplePos.xyz);
			colorSample.rgb = abs(normalize(grad.rgb*2.0 - 1.0));
			if (firstHit.a > len)
				firstHit = samplePos;
			backNearest = min(backNearest, samplePos.a);
			colorSample.a = 1.0-pow((1.0 - colorSample.a), opacityCorrection);
			colorSample.rgb *= colorSample.a;
			colAcc= (1.0 - colAcc.a) * colorSample + colAcc;
			if ( colAcc.a > earlyTermination )
				break;
		}
		samplePos += deltaDir; //advance ray position
	}
`+pf,gd=`#version 300 es
#line 392
layout(location=0) in vec3 pos;
uniform int axCorSag;
uniform mat4 mvpMtx;
uniform mat4 frac2mm;
uniform float slice;
out vec3 texPos;
void main(void) {
	texPos = vec3(pos.x, pos.y, slice);
	if (axCorSag > 1)
		texPos = vec3(slice, pos.x, pos.y);
	else if (axCorSag > 0)
		texPos = vec3(pos.x, slice, pos.y);
	vec4 mm = frac2mm * vec4(texPos, 1.0);
	gl_Position = mvpMtx * mm;
}`,X3=`#version 300 es
#line 411
precision highp int;
precision highp float;
uniform highp sampler3D volume, overlay;
uniform highp sampler3D paqd;
uniform vec4 paqdUniforms;
uniform int backgroundMasksOverlays;
uniform float overlayOutlineWidth;
uniform float overlayAlphaShader;
uniform int axCorSag;
uniform float overlays;
uniform float opacity;
uniform float drawOpacity;
uniform float drawRimOpacity;
uniform bool isAlphaClipDark;
uniform highp sampler3D drawing;
uniform highp sampler2D colormap;
in vec3 texPos;
out vec4 color;
`+E1+`
vec4 blendRGBA(vec4 foreground, vec4 background) {
  float alphaOut = foreground.a + background.a * (1.0 - foreground.a);
  vec3 colorOut = (foreground.rgb * foreground.a + background.rgb * background.a * (1.0 - foreground.a)) / alphaOut;
  return vec4(colorOut, alphaOut);
}
float paqdEaseAlpha(float alpha) {
  // t are alpha transitions
  // <t0 -> y0
  // t0..t1  -> mix between y0..y1
  // t1..t2 -> mix between y1..y2
  // >t2 -> y2
  float t0 = paqdUniforms[0]; // 0.3;
  float t1 = 0.5 * (paqdUniforms[0] + paqdUniforms[1]); // 0.4;
  float t2 = paqdUniforms[1]; // 0.9;
  float y0 = 0.0;
  float y1 = abs(paqdUniforms[2]); // 1.0;
  float y2 = abs(paqdUniforms[3]); //0.25;
  if (alpha <= t0) {
    return y0;
  } else if (alpha <= t1) {
    return mix(y0, y1, (alpha - t0) / (t1 - t0)); // LERP 0.0  1.0
  } else if (alpha <= t2) {
    return mix(y1, y2, (alpha - t1) / (t2 - t1)); // LERP 1.0  0.2
  } else {
    return y2;
  }
}

void main() {
	//color = vec4(1.0, 0.0, 1.0, 1.0);return;
	vec4 background = texture(volume, texPos);
	color = vec4(background.rgb, opacity);
	if ((isAlphaClipDark) && (background.a == 0.0)) color.a = 0.0; //FSLeyes clipping range
	vec4 ocolor = vec4(0.0);
	float overlayAlpha = overlayAlphaShader;
	if (overlays > 0.0) {
		ocolor = texture(overlay, texPos);
		//dFdx for "boxing" issue 435 has aliasing on some implementations (coarse vs fine)
		//however, this only identifies 50% of the edges due to aliasing effects
		// http://www.aclockworkberry.com/shader-derivative-functions/
		// https://bgolus.medium.com/distinctive-derivative-differences-cce38d36797b
		//if ((ocolor.a >= 1.0) && ((dFdx(ocolor.a) != 0.0) || (dFdy(ocolor.a) != 0.0)  ))
		//	ocolor.rbg = vec3(0.0, 0.0, 0.0);
		bool isOutlineBelowNotAboveThreshold = true;
		if (isOutlineBelowNotAboveThreshold) {
			if ((overlayOutlineWidth > 0.0) && (ocolor.a < 1.0)) { //check voxel neighbors for edge
				vec3 vx = (overlayOutlineWidth ) / vec3(textureSize(overlay, 0));
				//6 voxel neighbors that share a face
				vec3 vxR = vec3(texPos.x+vx.x, texPos.y, texPos.z);
				vec3 vxL = vec3(texPos.x-vx.x, texPos.y, texPos.z);
				vec3 vxA = vec3(texPos.x, texPos.y+vx.y, texPos.z);
				vec3 vxP = vec3(texPos.x, texPos.y-vx.y, texPos.z);
				vec3 vxS = vec3(texPos.x, texPos.y, texPos.z+vx.z);
				vec3 vxI = vec3(texPos.x, texPos.y, texPos.z-vx.z);
				float a = 0.0;
				if (axCorSag != 2) {
					a = max(a, texture(overlay, vxR).a);
					a = max(a, texture(overlay, vxL).a);
				}
				if (axCorSag != 1) {
					a = max(a, texture(overlay, vxA).a);
					a = max(a, texture(overlay, vxP).a);
				}
				if (axCorSag != 0) {
					a = max(a, texture(overlay, vxS).a);
					a = max(a, texture(overlay, vxI).a);
				}
				bool isCheckCorners = true;
				if (isCheckCorners) {
					//12 voxel neighbors that share an edge
					vec3 vxRA = vec3(texPos.x+vx.x, texPos.y+vx.y, texPos.z);
					vec3 vxLA = vec3(texPos.x-vx.x, texPos.y+vx.y, texPos.z);
					vec3 vxRP = vec3(texPos.x+vx.x, texPos.y-vx.y, texPos.z);
					vec3 vxLP = vec3(texPos.x-vx.x, texPos.y-vx.y, texPos.z);
					vec3 vxRS = vec3(texPos.x+vx.x, texPos.y, texPos.z+vx.z);
					vec3 vxLS = vec3(texPos.x-vx.x, texPos.y, texPos.z+vx.z);
					vec3 vxRI = vec3(texPos.x+vx.x, texPos.y, texPos.z-vx.z);
					vec3 vxLI = vec3(texPos.x-vx.x, texPos.y, texPos.z-vx.z);
					vec3 vxAS = vec3(texPos.x, texPos.y+vx.y, texPos.z+vx.z);
					vec3 vxPS = vec3(texPos.x, texPos.y-vx.y, texPos.z+vx.z);
					vec3 vxAI = vec3(texPos.x, texPos.y+vx.y, texPos.z-vx.z);
					vec3 vxPI = vec3(texPos.x, texPos.y-vx.y, texPos.z-vx.z);

					if (axCorSag == 0) { //axial corners
						a = max(a, texture(overlay, vxRA).a);
						a = max(a, texture(overlay, vxLA).a);
						a = max(a, texture(overlay, vxRP).a);
						a = max(a, texture(overlay, vxLP).a);
					}
					if (axCorSag == 1) { //coronal corners
						a = max(a, texture(overlay, vxRS).a);
						a = max(a, texture(overlay, vxLS).a);
						a = max(a, texture(overlay, vxRI).a);
						a = max(a, texture(overlay, vxLI).a);
					}
					if (axCorSag == 2) { //sagittal corners
						a = max(a, texture(overlay, vxAS).a);
						a = max(a, texture(overlay, vxPS).a);
						a = max(a, texture(overlay, vxAI).a);
						a = max(a, texture(overlay, vxPI).a);
					}
				}
				if (a >= 1.0) {
					ocolor = vec4(0.0, 0.0, 0.0, 1.0);
					overlayAlpha = 1.0;
				}
			}

		} else {
			if ((overlayOutlineWidth > 0.0) && (ocolor.a >= 1.0)) { //check voxel neighbors for edge
				vec3 vx = (overlayOutlineWidth ) / vec3(textureSize(overlay, 0));
				vec3 vxR = vec3(texPos.x+vx.x, texPos.y, texPos.z);
				vec3 vxL = vec3(texPos.x-vx.x, texPos.y, texPos.z);
				vec3 vxA = vec3(texPos.x, texPos.y+vx.y, texPos.z);
				vec3 vxP = vec3(texPos.x, texPos.y-vx.y, texPos.z);
				vec3 vxS = vec3(texPos.x, texPos.y, texPos.z+vx.z);
				vec3 vxI = vec3(texPos.x, texPos.y, texPos.z-vx.z);
				float a = 1.0;
				if (axCorSag != 2) {
					a = min(a, texture(overlay, vxR).a);
					a = min(a, texture(overlay, vxL).a);
				}
				if (axCorSag != 1) {
					a = min(a, texture(overlay, vxA).a);
					a = min(a, texture(overlay, vxP).a);
				}
				if (axCorSag != 0) {
					a = min(a, texture(overlay, vxS).a);
					a = min(a, texture(overlay, vxI).a);
				}
				if (a < 1.0) {
					ocolor = vec4(0.0, 0.0, 0.0, 1.0);
					overlayAlpha = 1.0;
				}
			}
		} //outline above threshold
	}

`,bB=`#version 300 es
#line 411
precision highp int;
precision highp float;
uniform highp sampler2D volume, overlay;
uniform int backgroundMasksOverlays;
uniform float overlayOutlineWidth;
uniform float overlayAlphaShader;
uniform int axCorSag;
uniform float overlays;
uniform float opacity;
uniform float drawOpacity;
uniform bool isAlphaClipDark;
uniform highp sampler2D drawing;
uniform highp sampler2D colormap;
in vec3 texPos;
out vec4 color;`+E1+`void main() {
	//color = vec4(1.0, 0.0, 1.0, 1.0);return;
	vec4 background = texture(volume, texPos.xy);
	color = vec4(background.rgb, opacity);
	if ((isAlphaClipDark) && (background.a == 0.0)) color.a = 0.0; //FSLeyes clipping range
	vec4 dcolor = drawColor(texture(drawing, texPos.xy).r, drawOpacity);
	if (dcolor.a > 0.0) {
		color.rgb = mix(color.rgb, dcolor.rgb, dcolor.a);
		color.a = max(drawOpacity, color.a);
	}
}`,W3=`	ocolor.a *= overlayAlpha;
	float drawV = texture(drawing, texPos).r;
	vec4 dcolor = drawColor(drawV, drawOpacity);
	if (dcolor.a > 0.0) {
		if (drawRimOpacity >= 0.0) {
			vec3 vx = 1.0 / vec3(textureSize(drawing, 0));
			//6 voxel neighbors that share a face
			vec3 offsetX = dFdx(texPos); // left-right spacing
			vec3 offsetY = dFdy(texPos); // up-down spacing
			float L = texture(drawing, texPos - offsetX).r;
			float R = texture(drawing, texPos + offsetX).r;
			float T = texture(drawing, texPos - offsetY).r;
			float B = texture(drawing, texPos + offsetY).r;
			if (L != drawV || R != drawV || T != drawV || B != drawV)
				dcolor.a = drawRimOpacity;
		}
		color.rgb = mix(color.rgb, dcolor.rgb, dcolor.a);
		color.a = max(drawOpacity, color.a);
	}
	vec4 pcolor = texture(paqd, texPos);
	if (pcolor.a > 0.0) {
		pcolor.a = paqdEaseAlpha(pcolor.a);
		if (pcolor.a > 0.0) {
			if (paqdUniforms[3] < 0.0)
				ocolor = blendRGBA(pcolor, ocolor);
			else
				ocolor = blendRGBA(ocolor, pcolor);
		}
	}
	if ((backgroundMasksOverlays > 0) && (background.a == 0.0))
		return;
	float a = color.a + ocolor.a * (1.0 - color.a); // premultiplied alpha
	if (a == 0.0) return;
	color.rgb = mix(color.rgb, ocolor.rgb, ocolor.a / a);
	color.a = a;
}`,wB=X3+W3,SB=X3+`	if (ocolor.a > 0.0) {
		//https://gamedev.stackexchange.com/questions/102889/is-it-possible-to-convert-vec4-to-int-in-glsl-using-opengl-es
		uint alpha = uint(ocolor.a * 255.0);
		vec3 xyzFlip = vec3(float((uint(1) & alpha) > uint(0)), float((uint(2) & alpha) > uint(0)), float((uint(4) & alpha) > uint(0)));
		//convert from 0 and 1 to -1 and 1
		xyzFlip = (xyzFlip * 2.0) - 1.0;
		//https://math.stackexchange.com/questions/1905533/find-perpendicular-distance-from-point-to-line-in-3d
		//v1 principle direction of tensor for this voxel
		vec3 v1 = ocolor.rgb;
		//flips encode polarity to convert from 0..1 to -1..1 (27 bits vs 24 bit precision)
		v1 = normalize( v1 * xyzFlip);
		vec3 vxl = fract(texPos * vec3(textureSize(volume, 0))) - 0.5;
		//vxl coordinates now -0.5..+0.5 so 0,0,0 is origin
		vxl.x = -vxl.x;
		float t = dot(vxl,v1);
		vec3 P = t * v1;
		float dx = length(P-vxl);
		ocolor.a = 1.0 - smoothstep(0.2,0.25, dx);
		//if modulation was applied, use that to scale alpha not color:
		ocolor.a *= length(ocolor.rgb);
		ocolor.rgb = normalize(ocolor.rgb);
		//compute distance one half voxel closer to viewer:
		float pan = 0.5;
		if (axCorSag == 0)
			vxl.z -= pan;
		if (axCorSag == 1)
			vxl.y -= pan;
		if (axCorSag == 2)
			vxl.x += pan;
		t = dot(vxl,v1);
		P = t * v1;
		float dx2 = length(P-vxl);
		ocolor.rgb += (dx2-dx-(0.5 * pan)) * 1.0;
	}
`+W3,y0=`#version 300 es
#line 480
precision highp int;
precision highp float;
uniform vec4 lineColor;
out vec4 color;
void main() {
	color = lineColor;
}`,CB=`#version 300 es
#line 723
precision highp int;
precision highp float;

uniform vec4 lineColor;
uniform vec4 leftTopWidthHeight;
uniform float thickness; // line thickness in pixels
uniform vec2 canvasWidthHeight;

out vec4 color;

void main() {
    // fragment position in screen coordinates
    vec2 fragCoord = gl_FragCoord.xy;

    // canvas height
    float canvasHeight = canvasWidthHeight.y;

    // 'top' and 'bottom' to match gl_FragCoord.y coordinate system
    float top = canvasHeight - leftTopWidthHeight.y;
    float bottom = top - leftTopWidthHeight.w;

    // left and right edges
    float left = leftTopWidthHeight.x;
    float right = left + leftTopWidthHeight.z;

    bool withinLeft = fragCoord.x >= left && fragCoord.x <= left + thickness;
    bool withinRight = fragCoord.x <= right && fragCoord.x >= right - thickness;
    bool withinTop = fragCoord.y <= top && fragCoord.y >= top - thickness;
    bool withinBottom = fragCoord.y >= bottom && fragCoord.y <= bottom + thickness;

    bool isOutline = withinLeft || withinRight || withinTop || withinBottom;

    if (isOutline) {
        color = lineColor;
    } else {
        discard; 
    }
}`,EB=`#version 300 es
#line 490
layout(location=0) in vec3 pos;
uniform vec2 canvasWidthHeight;
uniform vec4 leftTopWidthHeight;
out vec2 vColor;
void main(void) {
	//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1
	vec2 frac;
	frac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1
	frac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0
	frac = (frac * 2.0) - 1.0;
	gl_Position = vec4(frac, 0.0, 1.0);
	vColor = pos.xy;
}`,TB=`#version 300 es
#line 506
precision highp int;
precision highp float;
uniform highp sampler2D colormap;
uniform float layer;
in vec2 vColor;
out vec4 color;
void main() {
	float nlayer = float(textureSize(colormap, 0).y);
	float fmap = (0.5 + layer) / nlayer;
	color = vec4(texture(colormap, vec2(vColor.x, fmap)).rgb, 1.0);
}`,Lb=`#version 300 es
#line 520
layout(location=0) in vec3 pos;
uniform vec2 canvasWidthHeight;
uniform vec4 leftTopWidthHeight;
void main(void) {
	//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1
	vec2 frac;
	frac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1
	frac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0
	frac = (frac * 2.0) - 1.0;
	gl_Position = vec4(frac, 0.0, 1.0);
}`,MB=`#version 300 es
#line 534
layout(location=0) in vec3 pos;
uniform vec2 canvasWidthHeight;
uniform float thickness;
uniform vec4 startXYendXY;
void main(void) {
	vec2 posXY = mix(startXYendXY.xy, startXYendXY.zw, pos.x);
	vec2 dir = normalize(startXYendXY.xy - startXYendXY.zw);
	posXY += vec2(-dir.y, dir.x) * thickness * (pos.y - 0.5);
	posXY.x = (posXY.x) / canvasWidthHeight.x; //0..1
	posXY.y = 1.0 - (posXY.y / canvasWidthHeight.y); //1..0
	gl_Position = vec4((posXY * 2.0) - 1.0, 0.0, 1.0);
}`,DB=`#version 300 es
#line 534
layout(location=0) in vec3 pos;
uniform vec2 canvasWidthHeight;
uniform float thickness;
uniform vec2 startXY;
uniform vec3 endXYZ; // transformed XYZ point
void main(void) {	
	vec2 posXY = mix(startXY.xy, endXYZ.xy, pos.x);
	vec2 startDiff = endXYZ.xy - startXY.xy;
	float startDistance = length(startDiff);
	vec2 diff = endXYZ.xy - posXY;
	float currentDistance = length(diff);
	vec2 dir = normalize(startXY.xy - endXYZ.xy);
	posXY += vec2(-dir.y, dir.x) * thickness * (pos.y - 0.5);
	posXY.x = (posXY.x) / canvasWidthHeight.x; //0..1
	posXY.y = 1.0 - (posXY.y / canvasWidthHeight.y); //1..0	
	float z = endXYZ.z * ( 1.0 - abs(currentDistance/startDistance)); 
	gl_Position = vec4((posXY * 2.0) - 1.0, z, 1.0);
}`,RB=`#version 300 es
#line 549
layout(location=0) in vec3 pos;
uniform vec2 canvasWidthHeight;
uniform vec4 leftTopWidthHeight;
out vec2 vUV;
void main(void) {
	//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1
	vec2 frac;
	frac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1
	frac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0
	frac = (frac * 2.0) - 1.0;
	gl_Position = vec4(frac, 0.0, 1.0);
	vUV = vec2(pos.x, 1.0 - pos.y);
}`,NB=`#version 300 es
#line 565
precision highp int;
precision highp float;
uniform highp sampler2D bmpTexture;
in vec2 vUV;
out vec4 color;
void main() {
	color = texture(bmpTexture, vUV);
}`,IB=`#version 300 es
#line 576
layout(location=0) in vec3 pos;
uniform vec2 canvasWidthHeight;
uniform vec4 leftTopWidthHeight;
uniform vec4 uvLeftTopWidthHeight;
out vec2 vUV;
void main(void) {
	//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1
	vec2 frac;
	frac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1
	frac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0
	frac = (frac * 2.0) - 1.0;
	gl_Position = vec4(frac, 0.0, 1.0);
	vUV = vec2(uvLeftTopWidthHeight.x + (pos.x * uvLeftTopWidthHeight.z), uvLeftTopWidthHeight.y  + ((1.0 - pos.y) * uvLeftTopWidthHeight.w) );
}`,_B=`#version 300 es
#line 593
precision highp int;
precision highp float;
uniform highp sampler2D fontTexture;
uniform vec4 fontColor;
uniform float screenPxRange;
in vec2 vUV;
out vec4 color;
float median(float r, float g, float b) {
	return max(min(r, g), min(max(r, g), b));
}
void main() {
	vec3 msd = texture(fontTexture, vUV).rgb;
	float sd = median(msd.r, msd.g, msd.b);
	float screenPxDistance = screenPxRange*(sd - 0.5);
	float opacity = clamp(screenPxDistance + 0.5, 0.0, 1.0);
	color = vec4(fontColor.rgb , fontColor.a * opacity);
}`,FB=`#version 300 es
layout(location=0) in vec3 pos;
uniform vec2 canvasWidthHeight;
uniform vec4 leftTopWidthHeight;
uniform vec4 uvLeftTopWidthHeight;
out vec2 vUV;
void main(void) {
	//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1
	vec2 frac;
	frac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1
	frac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0
	frac = (frac * 2.0) - 1.0;
	gl_Position = vec4(frac, 0.0, 1.0);
	vUV = pos.xy;
}`,PB=`#version 300 es
precision highp int;
precision highp float;
uniform vec4 circleColor;
uniform float fillPercent;
in vec2 vUV;
out vec4 color;
void main() {
	/* Check if the pixel is inside the circle
		 and color it with a gradient. Otherwise, color it 
		 transparent   */
	float distance = length(vUV-vec2(0.5,0.5));
	if ( distance < 0.5 && distance >= (1.0 - fillPercent) / 2.0){
			color = vec4(circleColor.r,circleColor.g,circleColor.b,circleColor.a) ;			
	}else{
			color = vec4(0.0,0.0,0.0,0.0);
	}
}
`,ra=`#version 300 es
#line 613
precision highp int;
precision highp float;
in vec3 vPos;
out vec2 TexCoord;
void main() {
	TexCoord = vPos.xy;
	gl_Position = vec4( (vPos.xy-vec2(0.5,0.5)) * 2.0, 0.0, 1.0);
}`,Vh=`#version 300 es
uniform highp usampler3D intensityVol;
`,kb=`#version 300 es
uniform highp isampler3D intensityVol;
`,BB=`#version 300 es
uniform highp sampler3D intensityVol;
`,Ob=`#line 1042
precision highp int;
precision highp float;
in vec2 TexCoord;
out vec4 FragColor;
uniform bool isAdditiveBlend;
uniform float coordZ;
uniform float layer;
uniform highp sampler2D colormap;
uniform lowp sampler3D blend3D;
uniform float opacity;
uniform uint activeIndex;
uniform vec4 xyzaFrac;
uniform mat4 mtx;
float textureWidth;
float nlayer;
float layerY;

vec4 scalar2color(uint idx) {
	float fx = (float(idx) + 0.5) / textureWidth;
	vec4 clr = texture(colormap, vec2(fx, layerY)).rgba;
	if (clr.a > 0.0)
		clr.a = 1.0;
	clr.a *= opacity;
	return clr;
}
void main(void) {
	vec4 vx = vec4(TexCoord.x, TexCoord.y, coordZ, 1.0) * mtx;
	uint idx = uint(texture(intensityVol, vx.xyz).r);
	if (idx == uint(0)) {
		if (layer < 1.0) {
			FragColor = vec4(0.0, 0.0, 0.0, 0.0);
			return;
		}
		FragColor = texture(blend3D, vec3(TexCoord.xy, coordZ));
		return;
	}
	textureWidth = float(textureSize(colormap, 0).x);
	nlayer = float(textureSize(colormap, 0).y);
	layerY = ((2.0 * layer) + 1.5) / nlayer;
	//idx = ((idx - uint(1)) % uint(100))+uint(1);
	FragColor = scalar2color(idx);
	bool isBorder = false;
	vx = vec4(TexCoord.x+xyzaFrac.x, TexCoord.y, coordZ, 1.0) * mtx;
	uint R = uint(texture(intensityVol, vx.xyz).r);
	vx = vec4(TexCoord.x-xyzaFrac.x, TexCoord.y, coordZ, 1.0) * mtx;
	uint L = uint(texture(intensityVol, vx.xyz).r);
	vx = vec4(TexCoord.x, TexCoord.y+xyzaFrac.y, coordZ, 1.0) * mtx;
	uint A = uint(texture(intensityVol, vx.xyz).r);
	vx = vec4(TexCoord.x, TexCoord.y-xyzaFrac.y, coordZ, 1.0) * mtx;
	uint P = uint(texture(intensityVol, vx.xyz).r);
	vx = vec4(TexCoord.x, TexCoord.y, coordZ+xyzaFrac.z, 1.0) * mtx;
	uint S = uint(texture(intensityVol, vx.xyz).r);
	vx = vec4(TexCoord.x, TexCoord.y, coordZ-xyzaFrac.z, 1.0) * mtx;
	uint I = uint(texture(intensityVol, vx.xyz).r);
	vec4 centerColor = FragColor;
	FragColor.a += scalar2color(R).a;
	FragColor.a += scalar2color(L).a;
	FragColor.a += scalar2color(A).a;
	FragColor.a += scalar2color(P).a;
	FragColor.a += scalar2color(S).a;
	FragColor.a += scalar2color(I).a;
	FragColor.a /= 7.0;
	if ((!isBorder) &&(idx == activeIndex)) {
		if (centerColor.a > 0.5)
			FragColor.a *= 0.4;
		else
			FragColor.a =0.8;
	}
	if (xyzaFrac.a != 0.0) { //outline
		if ((idx != R) || (idx != L) || (idx != A) || (idx != P) || (idx != S) || (idx != I)) {
			isBorder = true;
			if (xyzaFrac.a > 0.0)
				FragColor.a = xyzaFrac.a;
			else
				FragColor = vec4(0.0, 0.0, 0.0, 1.0);
		}
	}
	if (layer < 1.0) return;
		vec4 prevColor = texture(blend3D, vec3(TexCoord.xy, coordZ));
		// https://en.wikipedia.org/wiki/Alpha_compositing
		float aout = FragColor.a + (1.0 - FragColor.a) * prevColor.a;
		if (aout <= 0.0) return;
		if (isAdditiveBlend)
			FragColor.rgb = ((FragColor.rgb * FragColor.a) + (prevColor.rgb * prevColor.a)) / aout;
		else
			FragColor.rgb = ((FragColor.rgb * FragColor.a) + (prevColor.rgb * prevColor.a * (1.0 - FragColor.a))) / aout;
		FragColor.a = aout;
}`,x0=`#line 691
precision highp int;
precision highp float;
in vec2 TexCoord;
out vec4 FragColor;
uniform float coordZ;
uniform float layer;
uniform float scl_slope;
uniform float scl_inter;
uniform float cal_max;
uniform float cal_min;
uniform float cal_maxNeg;
uniform float cal_minNeg;
uniform bool isAlphaThreshold;
uniform bool isColorbarFromZero;
uniform bool isAdditiveBlend;
uniform highp sampler2D colormap;
uniform lowp sampler3D blend3D;
uniform int modulation;
uniform highp sampler3D modulationVol;
uniform float opacity;
uniform mat4 mtx;
void main(void) {
	vec4 vx = vec4(TexCoord.xy, coordZ, 1.0) * mtx;
	if ((vx.x < 0.0) || (vx.x > 1.0) || (vx.y < 0.0) || (vx.y > 1.0) || (vx.z < 0.0) || (vx.z > 1.0)) {
		//set transparent if out of range
		//https://webglfundamentals.org/webgl/webgl-3d-textures-repeat-clamp.html
		FragColor = texture(blend3D, vec3(TexCoord.xy, coordZ));
		return;
	}
	float f = (scl_slope * float(texture(intensityVol, vx.xyz).r)) + scl_inter;
	float mn = cal_min;
	float mx = cal_max;
	if ((isAlphaThreshold) || (isColorbarFromZero))
		mn = 0.0;
	float r = max(0.00001, abs(mx - mn));
	mn = min(mn, mx);
	float txl = mix(0.0, 1.0, (f - mn) / r);
	if (f > mn) { //issue1139: survives threshold, so round up to opaque voxel
		txl = max(txl, 2.0/256.0);
	}
	//https://stackoverflow.com/questions/5879403/opengl-texture-coordinates-in-pixel-space
	float nlayer = float(textureSize(colormap, 0).y);
	//each volume has two color maps:
	// (layer*2) = negative and (layer * 2) + 1 = positive
	float y = ((2.0 * layer) + 1.5)/nlayer;
	FragColor = texture(colormap, vec2(txl, y)).rgba;
	//negative colors
	mn = cal_minNeg;
	mx = cal_maxNeg;
	if ((isAlphaThreshold) || (isColorbarFromZero))
		mx = 0.0;
	//if ((!isnan(cal_minNeg)) && ( f < mx)) {
	if ((cal_minNeg < cal_maxNeg) && ( f < mx)) {
		r = max(0.00001, abs(mx - mn));
		mn = min(mn, mx);
		txl = 1.0 - mix(0.0, 1.0, (f - mn) / r);
		//issue1139: survives threshold, so round up to opaque voxel
		txl = max(txl, 2.0/256.0);
		y = ((2.0 * layer) + 0.5)/nlayer;
		FragColor = texture(colormap, vec2(txl, y));
	}
	if (layer > 0.7)
		FragColor.a = step(0.00001, FragColor.a);
	//if (modulation > 10)
	//	FragColor.a *= texture(modulationVol, vx.xyz).r;
	//	FragColor.rgb *= texture(modulationVol, vx.xyz).r;
	if (isAlphaThreshold) {
		if ((cal_minNeg != cal_maxNeg) && ( f < 0.0) && (f > cal_maxNeg))
			FragColor.a = pow(-f / -cal_maxNeg, 2.0);
		else if ((f > 0.0) && (cal_min > 0.0))
			FragColor.a *= pow(f / cal_min, 2.0); //issue435:  A = (V/X)**2
		//FragColor.g = 0.0;
	} else if (isColorbarFromZero) {
		if ((cal_minNeg != cal_maxNeg) && ( f < 0.0) && (f > cal_maxNeg))
			FragColor.a = 0.0;
		else if ((f > 0.0) && (cal_min > 0.0) && (f < cal_min))
			FragColor.a *= 0.0;

	}
	if (modulation == 1) {
		FragColor.rgb *= texture(modulationVol, vx.xyz).r;
	} else if (modulation == 2) {
		FragColor.a = texture(modulationVol, vx.xyz).r;
	}
	FragColor.a *= opacity;
	if (layer < 1.0) return;
	vec4 prevColor = texture(blend3D, vec3(TexCoord.xy, coordZ));
	// https://en.wikipedia.org/wiki/Alpha_compositing
	float aout = FragColor.a + (1.0 - FragColor.a) * prevColor.a;
	if (aout <= 0.0) return;
	if (isAdditiveBlend)
		FragColor.rgb = ((FragColor.rgb * FragColor.a) + (prevColor.rgb * prevColor.a)) / aout;
	else
		FragColor.rgb = ((FragColor.rgb * FragColor.a) + (prevColor.rgb * prevColor.a * (1.0 - FragColor.a))) / aout;
	FragColor.a = aout;
}`,LB=`#line 773
precision highp int;
precision highp float;
in vec2 TexCoord;
out vec4 FragColor;
uniform float coordZ;
uniform float layer;
uniform float scl_slope;
uniform float scl_inter;
uniform float cal_max;
uniform float cal_min;
uniform highp sampler2D colormap;
uniform lowp sampler3D blend3D;
uniform float opacity;
uniform mat4 mtx;
uniform bool hasAlpha;
uniform int modulation;
uniform highp sampler3D modulationVol;
float textureWidth;
float nlayer;
float layerY;

vec4 scalar2color(uint idx) {
	float fx = (float(idx) + 0.5) / textureWidth;
	vec4 clr = texture(colormap, vec2(fx, layerY)).rgba;
	if (clr.a > 0.0)
		clr.a = 1.0;
	clr.a *= opacity;
	return clr;
}

vec4 paqd2color(uvec4 rgba) {
  // paqd r: max prob index, g: 2nd index, b: max prob a: 2nd prob
  float prob1 = float(rgba.b)/255.0;
  float prob2 = float(rgba.a)/255.0;
  vec4 clr1 = scalar2color(rgba.r);
  vec4 clr2 = scalar2color(rgba.g);
  float total = prob1 + prob2;
  vec4 clr = vec4(clr1.rgb, total);
  // vec4 clr = vec4(clr1.rgb, prob1);
  if (total > 0.0) {
    clr.rgb = mix(clr2.rgb, clr1.rgb, prob1 / total);
  }
  return clr;
}
void main(void) {
	vec4 vx = vec4(TexCoord.xy, coordZ, 1.0) * mtx;
	ivec3 voxelCoord = ivec3(vx.xyz * vec3(textureSize(intensityVol, 0)));
	uvec4 rgba = texelFetch(intensityVol, voxelCoord, 0);
	FragColor = vec4(0.0, 0.0, 0.0, 0.0);
	if (rgba.r > uint(0)) {
		textureWidth = float(textureSize(colormap, 0).x);
		nlayer = float(textureSize(colormap, 0).y);
		layerY = ((2.0 * layer) + 1.5) / nlayer;
		FragColor = paqd2color(rgba);
		return;
	}
	// if (layer > 2.0) return;
	// FragColor = texture(blend3D, vec3(TexCoord.xy, coordZ));
}`,kB=`#line 773
precision highp int;
precision highp float;
in vec2 TexCoord;
out vec4 FragColor;
uniform float coordZ;
uniform float layer;
uniform float scl_slope;
uniform float scl_inter;
uniform float cal_max;
uniform float cal_min;
uniform highp sampler2D colormap;
uniform lowp sampler3D blend3D;
uniform float opacity;
uniform mat4 mtx;
uniform bool hasAlpha;
uniform int modulation;
uniform highp sampler3D modulationVol;
void main(void) {
	vec4 vx = vec4(TexCoord.xy, coordZ, 1.0) * mtx;
	uvec4 aColor = texture(intensityVol, vx.xyz);
	FragColor = vec4(float(aColor.r) / 255.0, float(aColor.g) / 255.0, float(aColor.b) / 255.0, float(aColor.a) / 255.0);
	if (modulation == 1)
		FragColor.rgb *= texture(modulationVol, vx.xyz).r;
	if (!hasAlpha) {
		FragColor.a = (FragColor.r * 0.21 + FragColor.g * 0.72 + FragColor.b * 0.07);
		//next line: we could binarize alpha, but see rendering of visible human
		//FragColor.a = step(0.01, FragColor.a);
	}
	if (modulation == 2)
		FragColor.a = texture(modulationVol, vx.xyz).r;
	FragColor.a *= opacity;
	if (layer < 1.0) return;
	vec4 prevColor = texture(blend3D, vec3(TexCoord.xy, coordZ));
	// https://en.wikipedia.org/wiki/Alpha_compositing
	float aout = FragColor.a + (1.0 - FragColor.a) * prevColor.a;
	if (aout <= 0.0) return;
	FragColor.rgb = ((FragColor.rgb * FragColor.a) + (prevColor.rgb * prevColor.a * (1.0 - FragColor.a))) / aout;
	FragColor.a = aout;
}`,OB=`#version 300 es
#line 808
precision highp int;
precision highp float;
in vec3 vPos;
out vec2 TexCoord;
void main() {
	TexCoord = vPos.xy;
	gl_Position = vec4((vPos.x - 0.5) * 2.0, (vPos.y - 0.5) * 2.0, 0.0, 1.0);
}`,UB=`#version 300 es
#line 829
	precision highp float;
	precision highp int;
	precision highp isampler3D;
	layout(location = 0) out int label;
	layout(location = 1) out int strength;
	in vec2 TexCoord;
	uniform int finalPass;
	uniform float coordZ;
	uniform lowp sampler3D in3D;
	uniform highp isampler3D backTex; // background
	uniform highp isampler3D labelTex; // label
	uniform highp isampler3D strengthTex; // strength
void main(void) {
	vec3 interpolatedTextureCoordinate = vec3(TexCoord.xy, coordZ);
	ivec3 size = textureSize(backTex, 0);
	ivec3 texelIndex = ivec3(floor(interpolatedTextureCoordinate * vec3(size)));
	int background = texelFetch(backTex, texelIndex, 0).r;
	label = texelFetch(labelTex, texelIndex, 0).r;
	strength = texelFetch(strengthTex, texelIndex, 0).r;
	for (int k = -1; k <= 1; k++) {
		for (int j = -1; j <= 1; j++) {
			for (int i = -1; i <= 1; i++) {
				if (i != 0 && j != 0 && k != 0) {
					ivec3 neighborIndex = texelIndex + ivec3(i,j,k);
					int neighborBackground = texelFetch(backTex, neighborIndex, 0).r;
					int neighborStrength = texelFetch(strengthTex, neighborIndex, 0).r;
					int strengthCost = abs(neighborBackground - background);
					int takeoverStrength = neighborStrength - strengthCost;
					if (takeoverStrength > strength) {
						strength = takeoverStrength;
						label = texelFetch(labelTex, neighborIndex, 0).r;
					}
				}
			}
		}
	}
	if (finalPass < 1)
		return;
	int ok = 1;
	ivec4 labelCount = ivec4(0,0,0,0);
	for (int k = -1; k <= 1; k++)
		for (int j = -1; j <= 1; j++)
			for (int i = -1; i <= 1; i++) {
				ivec3 neighborIndex = texelIndex + ivec3(i,j,k);
				int ilabel = texelFetch(labelTex, neighborIndex, 0).r;
				if ((ilabel < 0) || (ilabel > 3))
					ok = 0;
				else
					labelCount[ilabel]++;
			}
	if (ok != 1) {
		return;
	}
	int maxIdx = 0;
	for (int i = 1; i < 4; i++) {
		if (labelCount[i] > labelCount[maxIdx])
			maxIdx = i;
	}
	label = maxIdx;
}`,VB=`#version 300 es
layout(location=0) in vec3 pos;
uniform mat4 mvpMtx;
void main(void) {
	gl_Position = mvpMtx * vec4(pos, 1.0);
}`,jB=`#version 300 es
precision highp int;
precision highp float;
uniform vec4 surfaceColor;
out vec4 color;
void main() {
	color = surfaceColor;
}`,zB=`#version 300 es
layout(location=0) in vec3 pos;
layout(location=1) in vec4 clr;
out vec4 vClr;
uniform mat4 mvpMtx;
void main(void) {
	gl_Position = mvpMtx * vec4(pos, 1.0);
	vClr = clr;
}`,GB=`#version 300 es
precision highp int;
precision highp float;
in vec4 vClr;
out vec4 color;
uniform float opacity;
void main() {
	color = vec4(vClr.rgb, opacity);
}`,M1=`#version 300 es
layout(location=0) in vec3 pos;
layout(location=1) in vec4 norm;
layout(location=2) in vec4 clr;
uniform mat4 mvpMtx;
//uniform mat4 modelMtx;
uniform mat4 normMtx;
out vec4 vClr;
out vec3 vN;
out vec4 vP;
out vec4 vPc;
void main(void) {
	vec3 lightPosition = vec3(0.0, 0.0, -10.0);
	vP = vec4(pos, 1.0);
	vPc = mvpMtx * vec4(pos, 1.0);
	gl_Position = vPc;
	vN = normalize((normMtx * vec4(norm.xyz,1.0)).xyz);
	//vV = -vec3(modelMtx*vec4(pos,1.0));
	vClr = clr;
}`,HB=`#version 300 es
precision highp int;
precision highp float;
uniform float opacity;
out vec4 color;
vec4 packFloatToVec4i(const float value) {
	const vec4 bitSh = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);
	const vec4 bitMsk = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);
	vec4 res = fract(value * bitSh);
	res -= res.xxyz * bitMsk;
	return res;
}
void main() {
	color = packFloatToVec4i(gl_FragCoord.z);
}`,YB=`#version 300 es
precision highp int;
precision highp float;
uniform float opacity;
in vec4 vClr;
in vec3 vN;
out vec4 color;
float stepmix(float edge0, float edge1, float E, float x){
	float T = clamp(0.5 * (x - edge0 + E) / E, 0.0, 1.0);
	return mix(edge0, edge1, T);
}
void main() {
	vec3 r = vec3(0.0, 0.0, 1.0);
	float ambient = 0.3;
	float diffuse = 0.6;
	float specular = 0.5;
	float shininess = 50.0;
	vec3 n = normalize(vN);
	vec3 lightPosition = vec3(0.0, 10.0, -5.0);
	vec3 l = normalize(lightPosition);
	float df = max(0.0, dot(n, l));
	float sf = pow(max(dot(reflect(l, n), r), 0.0), shininess);
	const float A = 0.1;
	const float B = 0.3;
	const float C = 0.6;
	const float D = 1.0;
	float E = fwidth(df);
	if (df > A - E && df < A + E) df = stepmix(A, B, E, df);
	else if (df > B - E && df < B + E) df = stepmix(B, C, E, df);
	else if (df > C - E && df < C + E) df = stepmix(C, D, E, df);
	else if (df < A) df = 0.0;
	else if (df < B) df = B;
	else if (df < C) df = C;
	else df = D;
	E = fwidth(sf);
	if (sf > 0.5 - E && sf < 0.5 + E)
		sf = smoothstep(0.5 - E, 0.5 + E, sf);
	else
		sf = step(0.5, sf);
	vec3 a = vClr.rgb * ambient;
	vec3 d = max(df, 0.0) * vClr.rgb * diffuse;
	color.rgb = a + d + (specular * sf);
	color.a = opacity;
}`,qB=`#version 300 es
precision highp int;
precision highp float;
uniform float opacity;
in vec4 vClr;
in vec3 vN;
out vec4 color;
void main() {
	vec3 r = vec3(0.0, 0.0, 1.0); //rayDir: for orthographic projections moving in Z direction (no need for normal matrix)
	float ambient = 0.3;
	float diffuse = 0.6;
	float specular = 0.25;
	float shininess = 10.0;
	float PenWidth = 0.6;
	vec3 n = normalize(vN);
	vec3 lightPosition = vec3(0.0, 10.0, -5.0);
	vec3 l = normalize(lightPosition);
	float lightNormDot = dot(n, l);
	float view = abs(dot(n,r)); //with respect to viewer
	if (PenWidth < view) discard;
	vec3 a = vClr.rgb * ambient;
	vec3 d = max(lightNormDot, 0.0) * vClr.rgb * diffuse;
	float s = specular * pow(max(dot(reflect(l, n), r), 0.0), shininess);
	color.rgb = a + d + s;
	color.a = opacity;
}`,XB=`#version 300 es
precision highp int;
precision highp float;
uniform float opacity;
in vec4 vClr;
in vec3 vN;
out vec4 color;
void main() {
	const float thresh = 0.4;
	const vec3 viewDir = vec3(0.0, 0.0, -1.0);
	vec3 n = normalize(vN);
	// use abs() for two-sided lighting, max() for one sided
	float cosTheta = abs(dot(n, viewDir));
	// float cosTheta = max(dot(n, viewDir), 0.0);
	// optional fresnel equation - adjust exponent
	// cosTheta = 1.0 - pow(1.0 - cosTheta, 2.0);
	// use step for binary edges, smoothstep for feathered edges
	// vec3 d = step(thresh, cosTheta) * vClr.rgb;
	vec3 d = smoothstep(thresh - 0.05, thresh + 0.05, cosTheta) * vClr.rgb;
	color = vec4(d, opacity);
}`,WB=`#version 300 es
precision highp int;
precision highp float;
uniform float opacity;
in vec4 vClr;
in vec3 vN;
out vec4 color;
void main() {
  const float edge0 = 0.1;
  const float edge1 = 0.25;
  const vec3 viewDir = vec3(0.0, 0.0, -1.0);
  vec3 n = normalize(vN);
  float cosTheta = abs(dot(n, viewDir));
  float alpha = 1.0 - smoothstep(edge0, edge1, cosTheta);
  if (alpha <= 0.0) {
    discard;
  }
  color = vec4(0.0, 0.0, 0.0, opacity * alpha);
}`,KB=`#version 300 es
precision highp int;
precision highp float;
uniform float opacity;
in vec4 vClr;
in vec3 vN;
out vec4 color;
void main() {
	vec3 r = vec3(0.0, 0.0, 1.0); //rayDir: for orthographic projections moving in Z direction (no need for normal matrix)
	float diffuse = 1.0;
	float specular = 0.2;
	float shininess = 10.0;
	vec3 n = normalize(vN);
	vec3 lightPosition = vec3(0.0, 0.0, -5.0);
	vec3 l = normalize(lightPosition);
	float lightNormDot = max(dot(n, l), 0.0);
	vec3 d = lightNormDot * vClr.rgb * diffuse;
	float s = specular * pow(max(dot(reflect(l, n), r), 0.0), shininess);
	color = vec4(d + s, opacity);
}`,QB=`#version 300 es
precision highp int;
precision highp float;
uniform float opacity;
in vec4 vClr;
in vec3 vN;
out vec4 color;
void main() {
	float diffuse = 1.4;
	vec3 l = vec3(0.0, 0.0, -1.0);
	float lightNormDot = max(dot(normalize(vN), l), 0.0);
	color = vec4(lightNormDot * vClr.rgb * diffuse, opacity);
}`,ZB=`#version 300 es
precision highp int;
precision highp float;
uniform float opacity;
in vec4 vClr;
in vec3 vN;
out vec4 color;
void main() {
	float specularRGB = 0.7;
	float specularWhite = 0.3;
	float shininess = 10.0;
	float diffuse = 1.0;
	vec3 r = vec3(0.0, 0.0, 1.0); //rayDir: for orthographic projections moving in Z direction (no need for normal matrix)
	vec3 n = normalize(vN);
	vec3 l = vec3(0.0, 0.0, -1.0);
	float lightNormDot = max(dot(n, l), 0.0);
	vec3 d3 = lightNormDot * vClr.rgb * diffuse;
	float s = pow(max(dot(reflect(l, n), r), 0.0), shininess);
	vec3 s3 = specularRGB * s * vClr.rgb;
	s *= specularWhite;
	color = vec4(d3 + s3 + s, opacity);
}`,JB=`#version 300 es
precision highp int;
precision highp float;
uniform float opacity;
in vec4 vClr;
in vec3 vN;
in vec4 vPc;
out vec4 color;
void main() {
	vec3 n = normalize(vN);
	// Compute curvature
	vec3 dx = dFdx(n);
	vec3 dy = dFdy(n);
	vec3 xneg = n - dx;
	vec3 xpos = n + dx;
	vec3 yneg = n - dy;
	vec3 ypos = n + dy;
	float depth = length(vPc.xyz);
	float curv = (cross(xneg, xpos).y - cross(yneg, ypos).x) / depth;
	//at this stage 0.5 for flat, with valleys dark and ridges bright
	curv = 1.0 - (curv + 0.5);
	//clamp
	curv =  min(max(curv, 0.0), 1.0);
	// easing function
	curv = pow(curv, 0.5);
	//modulate ambient and diffuse with curvature
	vec3 r = vec3(0.0, 0.0, 1.0); //rayDir: for orthographic projections moving in Z direction (no need for normal matrix)
	float ambient = 0.6;
	float diffuse = 0.6;
	float specular = 0.2;
	float shininess = 10.0;
	vec3 lightPosition = vec3(0.0, 10.0, -2.0);
	vec3 l = normalize(lightPosition);
	float lightNormDot = dot(n, l);
	vec3 a = vClr.rgb * ambient * curv;
	vec3 d = max(lightNormDot, 0.0) * vClr.rgb * diffuse;
	float s = specular * pow(max(dot(reflect(l, n), r), 0.0), shininess);
	color = vec4(a + d + s, opacity);
}`,$B=`#version 300 es
precision highp int;
precision highp float;
uniform vec4 sliceMM;
uniform float thickMM ;
in vec4 vClr;
in vec4 vP;  // vertex position in mm
out vec4 color;
void main() {
    const float LINE_WIDTH_PX = 4.0;   // target thickness in pixels
    //const float LINE_THRESH_MM = 1.5;   // target thickness in pixels
    const float TILT_STRENGTH = 1.0;   // >0 shrinks ribbon for oblique triangles
    // --- signed distances to each orthogonal plane (object space) ---
    vec3 d = vP.xyz - sliceMM.xyz;
    vec3 ad = abs(d);
    // --- derivatives to get pixel-consistent widths (per-axis) ---
    vec3 fd = fwidth(vP.xyz);
    //minDist is in mm not pixels
    float minDist = min(ad.x, min(ad.y, ad.z));
    if (minDist >  sliceMM.w) discard;
    // --- per-plane obliqueness: use the two in-plane components' fwidth ---
    float tiltX = length(fd.yz); // for plane with normal X
    float tiltY = length(fd.xz); // for plane with normal Y
    float tiltZ = length(fd.xy); // for plane with normal Z
    float tfX = clamp(1.0 / (1.0 + TILT_STRENGTH * tiltX), 0.0, 1.0);
    float tfY = clamp(1.0 / (1.0 + TILT_STRENGTH * tiltY), 0.0, 1.0);
    float tfZ = clamp(1.0 / (1.0 + TILT_STRENGTH * tiltZ), 0.0, 1.0);
    // --- half-widths for each plane (apply per-axis tilt factor) ---
    vec3 halfWidth;
    halfWidth.x = (LINE_WIDTH_PX * 0.5) * fd.x * tfX;
    halfWidth.y = (LINE_WIDTH_PX * 0.5) * fd.y * tfY;
    halfWidth.z = (LINE_WIDTH_PX * 0.5) * fd.z * tfZ;
    // --- smooth alpha for each plane ---
    vec3 edgeA = 1.0 - smoothstep(vec3(0.0), halfWidth, ad);
    // combine planes (max of X,Y,Z ribbons)
    float edgeAlpha = max(edgeA.x, max(edgeA.y, edgeA.z));
    if (edgeAlpha <= 1e-4) discard; // outside ribbons
    color = vec4(vClr.rgb, vClr.a * edgeAlpha);
}`,eL=`#version 300 es
precision highp int;
precision highp float;
uniform float opacity;
in vec4 vClr;
in vec3 vN;
out vec4 color;
void main() {
	vec3 r = vec3(0.0, 0.0, 1.0); //rayDir: for orthographic projections moving in Z direction (no need for normal matrix)
	float ambient = 0.35;
	float diffuse = 0.5;
	float specular = 0.2;
	float shininess = 10.0;
	vec3 n = normalize(vN);
	vec3 lightPosition = vec3(0.0, 10.0, -5.0);
	vec3 l = normalize(lightPosition);
	float lightNormDot = dot(n, l);
	vec3 a = vClr.rgb * ambient;
	vec3 d = max(lightNormDot, 0.0) * vClr.rgb * diffuse;
	float s = specular * pow(max(dot(reflect(l, n), r), 0.0), shininess);
	color = vec4(a + d + s, opacity);
}`,tL=`#version 300 es
precision highp int;
precision highp float;
uniform float opacity;
in vec4 vClr;
in vec3 vN;
uniform sampler2D matCap;
out vec4 color;
void main() {
	vec3 n = normalize(vN);
	vec2 uv = n.xy * 0.5 + 0.5;
	uv.y = 1.0 - uv.y;
	vec3 clr = texture(matCap,uv.xy).rgb * vClr.rgb;
	color = vec4(clr, opacity);
}`,iL=`#version 300 es
precision highp int;
precision highp float;
uniform float opacity;
in vec4 vClr;
in vec3 vN;
out vec4 color;
void main() {
	float ambient = 0.35;
	float diffuse = 0.6;
	vec3 n = normalize(vN);
	vec3 lightPosition = vec3(0.0, 10.0, -5.0);
	vec3 l = normalize(lightPosition);
	float lightNormDot = dot(n, l);
	vec3 a = vClr.rgb * ambient;
	vec3 d = max(lightNormDot, 0.0) * vClr.rgb * diffuse;
	color = vec4(a + d, opacity);
}`,nL=`#version 300 es
precision highp int;
precision highp float;
uniform float opacity;
in vec4 vClr;
in vec3 vN;
out vec4 color;
void main() {
	vec3 r = vec3(0.0, 0.0, 1.0); //rayDir: for orthographic projections moving in Z direction (no need for normal matrix)
	float ambient = 0.35;
	float diffuse = 0.5;
	float specular = 0.2;
	float shininess = 10.0;
	vec3 n = normalize(vN);
	vec3 lightPosition = vec3(0.0, 10.0, -5.0);
	vec3 l = normalize(lightPosition);
	float lightNormDot = dot(n, l);
	vec3 up = vec3(0.0, 1.0, 0.0);
	float ax = dot(n, up) * 0.5 + 0.5;  //Shreiner et al. (2013) OpenGL Programming Guide, 8th Ed., p 388. ISBN-10: 0321773039
	vec3 upClr = vec3(1.0, 1.0, 0.95);
	vec3 downClr = vec3(0.4, 0.4, 0.6);
	vec3 a = vClr.rgb * ambient;
	a *= mix(downClr, upClr, ax);
	vec3 d = max(lightNormDot, 0.0) * vClr.rgb * diffuse;
	float s = specular * pow(max(dot(reflect(l, n), r), 0.0), shininess);
	color = vec4(a + d + s, opacity);
}`,sL=`#version 300 es
precision highp int;
precision highp float;
uniform float opacity;
in vec4 vClr;
in vec3 vN;
out vec4 color;
//Spherical harmonics constants
const float C1 = 0.429043;
const float C2 = 0.511664;
const float C3 = 0.743125;
const float C4 = 0.886227;
const float C5 = 0.247708;
//Spherical harmonics coefficients
// Ramamoorthi, R., and P. Hanrahan. 2001b. "An Efficient Representation for Irradiance Environment Maps." In Proceedings of SIGGRAPH 2001, pp. 497500.
// https://github.com/eskimoblood/processingSketches/blob/master/data/shader/shinyvert.glsl
// https://github.com/eskimoblood/processingSketches/blob/master/data/shader/shinyvert.glsl
// Constants for Eucalyptus Grove lighting
const vec3 L00  = vec3( 0.3783264,  0.4260425,  0.4504587);
const vec3 L1m1 = vec3( 0.2887813,  0.3586803,  0.4147053);
const vec3 L10  = vec3( 0.0379030,  0.0295216,  0.0098567);
const vec3 L11  = vec3(-0.1033028, -0.1031690, -0.0884924);
const vec3 L2m2 = vec3(-0.0621750, -0.0554432, -0.0396779);
const vec3 L2m1 = vec3( 0.0077820, -0.0148312, -0.0471301);
const vec3 L20  = vec3(-0.0935561, -0.1254260, -0.1525629);
const vec3 L21  = vec3(-0.0572703, -0.0502192, -0.0363410);
const vec3 L22  = vec3( 0.0203348, -0.0044201, -0.0452180);
vec3 SH(vec3 vNormal) {
	vNormal = vec3(vNormal.x,vNormal.z,vNormal.y);
	vec3 diffuseColor = C1 * L22 * (vNormal.x * vNormal.x - vNormal.y * vNormal.y) +
	C3 * L20 * vNormal.z * vNormal.z +
	C4 * L00 -
	C5 * L20 +
	2.0 * C1 * L2m2 * vNormal.x * vNormal.y +
	2.0 * C1 * L21  * vNormal.x * vNormal.z +
	2.0 * C1 * L2m1 * vNormal.y * vNormal.z +
	2.0 * C2 * L11  * vNormal.x +
	2.0 * C2 * L1m1 * vNormal.y +
	2.0 * C2 * L10  * vNormal.z;
	return diffuseColor;
}
void main() {
	vec3 r = vec3(0.0, 0.0, 1.0); //rayDir: for orthographic projections moving in Z direction (no need for normal matrix)
	float ambient = 0.3;
	float diffuse = 0.6;
	float specular = 0.1;
	float shininess = 10.0;
	vec3 n = normalize(vN);
	vec3 lightPosition = vec3(0.0, 10.0, -5.0);
	vec3 l = normalize(lightPosition);
	float s = specular * pow(max(dot(reflect(l, n), r), 0.0), shininess);
	vec3 a = vClr.rgb * ambient;
	vec3 d = vClr.rgb * diffuse * SH(-reflect(n, vec3(l.x, l.y, -l.z)) );
	color = vec4(a + d + s, opacity);
}`,rL=`#version 300 es
layout(location=0) in vec3 pos;
layout(location=1) in vec4 norm;
layout(location=2) in vec4 clr;
uniform mat4 mvpMtx;
//uniform mat4 modelMtx;
uniform mat4 normMtx;
out vec4 vClr;
flat out vec3 vN;
void main(void) {
	gl_Position = mvpMtx * vec4(pos, 1.0);
	vN = normalize((normMtx * vec4(norm.xyz,1.0)).xyz);
	//vV = -vec3(modelMtx*vec4(pos,1.0));
	vClr = clr;
}`,K3=`#version 300 es
precision highp int;
precision highp float;
uniform float opacity;
in vec4 vClr;
flat in vec3 vN;
out vec4 color;
void main() {
	vec3 r = vec3(0.0, 0.0, 1.0); //rayDir: for orthographic projections moving in Z direction (no need for normal matrix)
	float ambient = 0.35;
	float diffuse = 0.5;
	float specular = 0.2;
	float shininess = 10.0;
	vec3 n = normalize(vN);
	vec3 lightPosition = vec3(0.0, 10.0, -5.0);
	vec3 l = normalize(lightPosition);
	float lightNormDot = dot(n, l);
	vec3 a = vClr.rgb * ambient;
	vec3 d = max(lightNormDot, 0.0) * vClr.rgb * diffuse;
	float s = specular * pow(max(dot(reflect(l, n), r), 0.0), shininess);
	color = vec4(a + d + s, opacity);
}`,aL=`#version 300 es
#line 1260
#define MAX_CLIP_PLANES 6
//precision highp int;
precision highp float;
uniform vec3 rayDir;
uniform vec3 volScale;
uniform vec3 texVox;
uniform vec4 clipPlane;
uniform vec4 clipPlanes[MAX_CLIP_PLANES];
uniform bool isClipCutaway;
uniform highp sampler3D volume, overlay;
uniform highp sampler3D paqd;
uniform vec4 paqdUniforms;
uniform float overlays;
uniform mat4 matRAS;
uniform mat4 mvpMtx;
uniform float drawOpacity, renderOverlayBlend;
uniform highp sampler3D drawing;
uniform highp sampler2D colormap;
uniform int backgroundMasksOverlays;
in vec3 vColor;
out vec4 fColor;
`+au+`
void main() {
	int id = 254;
	vec3 start = vColor;
	gl_FragDepth = 1.0;
	fColor = vec4(0.0, 0.0, 0.0, 0.0); //assume no hit: ID = 0
	float fid = float(id & 255)/ 255.0;
	vec3 backPosition = GetBackPosition(start);
	vec3 dir = normalize(backPosition - start);
	//clipVolumeStart(start, backPosition);
	float len = length(backPosition - start);
	float lenVox = length((texVox * start) - (texVox * backPosition));
	if ((lenVox < 0.5) || (len > 3.0)) return;//discard; //length limit for parallel rays
	float sliceSize = len / lenVox; //e.g. if ray length is 1.0 and traverses 50 voxels, each voxel is 0.02 in unit cube
	float stepSize = sliceSize; //quality: larger step is faster traversal, but fewer samples
	float opacityCorrection = stepSize/sliceSize;
	dir = normalize(dir);
	vec4 samplePos = vec4(start.xyz, 0.0); //ray position
	bool hasClip = false;
	vec2 sampleRange = vec2(0.0, len);
	for (int i = 0; i < MAX_CLIP_PLANES; i++)
		clipSampleRange(dir, samplePos, clipPlanes[i], sampleRange, hasClip);
	bool isClip = (sampleRange.x > 0.0) || ((sampleRange.y < len) && (sampleRange.y > 0.0));
	//vec4 clipPos = applyClip(dir, samplePos, len, isClip);
	if (isClip) fColor = vec4(samplePos.xyz, 253.0 / 255.0); //assume no hit: ID = 0
	if ((isClipCutaway) && (sampleRange.x <= 0.0) && (sampleRange.y >= len)) {
		//completely clipped, but ray does not intersect plane
		if (hasClip)
			samplePos.a = len + 1.0;
		else
			sampleRange = vec2(0.0, 0.0);
	}
	//start: OPTIONAL fast pass: rapid traversal until first hit
	float stepSizeFast = sliceSize * 1.9;
	vec4 deltaDirFast = vec4(dir.xyz * stepSizeFast, stepSizeFast);
	while (samplePos.a <= len) {
		if (skipSample(samplePos.a, sampleRange) ^^ isClipCutaway) {
			samplePos += deltaDirFast;
			continue;
		}
		float val = texture(volume, samplePos.xyz).a;
		if (val > 0.01) {
			fColor = vec4(samplePos.rgb, fid);
			gl_FragDepth = frac2ndc(samplePos.xyz);
			break;
		}
		samplePos += deltaDirFast; //advance ray position
	}
	//end: fast pass
	if ((overlays < 1.0) || (backgroundMasksOverlays > 0)) {
		return; //background hit, no overlays
	}
	//overlay pass
	len = min(len, samplePos.a); //only find overlay closer than background
	samplePos = vec4(start.xyz, 0.0); //ray position
	while (samplePos.a <= len) {
		float val = texture(overlay, samplePos.xyz).a;
		if (val > 0.01) {
			fColor = vec4(samplePos.rgb, fid);
			gl_FragDepth = frac2ndc(samplePos.xyz);
			return;
		}
		samplePos += deltaDirFast; //advance ray position
	}
	//if (fColor.a == 0.0) discard; //no hit in either background or overlays
	//you only get here if there is a hit with the background that is closer than any overlay
}`,oL=`#version 300 es
// an attribute is an input (in) to a vertex shader.
// It will receive data from a buffer
layout(location=0)  in vec3 a_position;
layout(location=1)  in vec3 a_color;
// A matrix to transform the positions by
uniform mat4 u_matrix;
out vec3 vColor;
// all shaders have a main function
void main() {
	// Multiply the position by the matrix.
	vec4 pos = vec4(a_position, 1.0);
	gl_Position = u_matrix * vec4(pos);
	vColor = a_color;
}
`,lL=`#version 300 es
precision highp float;
uniform vec4 u_color;
in vec3 vColor;
out vec4 outColor;
void main() {
	outColor = vec4(vColor, 1.0);
}`,cL=`#version 300 es
#line 1359
precision highp int;
precision highp float;
in vec3 vPos;
out vec2 TexCoord;
void main() {
	TexCoord = vPos.xy;
	vec2 viewCoord = (vPos.xy - 0.5) * 2.0;
	gl_Position = vec4((vPos.xy - 0.5) * 2.0, 0.0, 1.0);
}`,uL=`#version 300 es
precision highp int;
precision highp float;
in vec2 TexCoord;
out vec4 FragColor;
uniform float coordZ;
uniform lowp sampler3D in3D;
void main(void) {
 FragColor = texture(in3D, vec3(TexCoord.xy, coordZ));
}`,jh=`#version 300 es
#line 286
precision highp int;
precision highp float;
in vec3 vPos;
out vec2 TexCoord;
void main() {
    TexCoord = vPos.xy;
    gl_Position = vec4( (vPos.xy-vec2(0.5,0.5))* 2.0, 0.0, 1.0);
}`,hL=`#version 300 es
#line 298
precision highp int;
precision highp float;
in vec2 TexCoord;
out vec4 FragColor;
uniform float coordZ;
uniform float dX;
uniform float dY;
uniform float dZ;
uniform highp sampler3D intensityVol;
void main(void) {
 vec3 vx = vec3(TexCoord.xy, coordZ);
 vec4 samp = texture(intensityVol,vx+vec3(+dX,+dY,+dZ));
 samp += texture(intensityVol,vx+vec3(+dX,+dY,-dZ));
 samp += texture(intensityVol,vx+vec3(+dX,-dY,+dZ));
 samp += texture(intensityVol,vx+vec3(+dX,-dY,-dZ));
 samp += texture(intensityVol,vx+vec3(-dX,+dY,+dZ));
 samp += texture(intensityVol,vx+vec3(-dX,+dY,-dZ));
 samp += texture(intensityVol,vx+vec3(-dX,-dY,+dZ));
 samp += texture(intensityVol,vx+vec3(-dX,-dY,-dZ));
 FragColor = samp*0.125;
}`,dL=`#version 300 es
#line 298
precision highp int;
precision highp float;
in vec2 TexCoord;
out vec4 FragColor;
uniform float coordZ;
uniform float dX;
uniform float dY;
uniform float dZ;
uniform highp sampler3D intensityVol;
void main(void) {
 vec3 vx = vec3(TexCoord.xy, coordZ);
 vec4 XYZ = texture(intensityVol,vx+vec3(+dX,+dY,+dZ));
 vec4 OYZ = texture(intensityVol,vx+vec3(0.0,+dY,+dZ));
 vec4 xYZ = texture(intensityVol,vx+vec3(-dX,+dY,+dZ));
 vec4 XOZ = texture(intensityVol,vx+vec3(+dX,0.0,+dZ));
 vec4 OOZ = texture(intensityVol,vx+vec3(0.0,0.0,+dZ));
 vec4 xOZ = texture(intensityVol,vx+vec3(-dX,0.0,+dZ));
 vec4 XyZ = texture(intensityVol,vx+vec3(+dX,-dY,+dZ));
 vec4 OyZ = texture(intensityVol,vx+vec3(0.0,-dY,+dZ));
 vec4 xyZ = texture(intensityVol,vx+vec3(-dX,-dY,+dZ));

 vec4 XYO = texture(intensityVol,vx+vec3(+dX,+dY,0.0));
 vec4 OYO = texture(intensityVol,vx+vec3(0.0,+dY,0.0));
 vec4 xYO = texture(intensityVol,vx+vec3(-dX,+dY,0.0));
 vec4 XOO = texture(intensityVol,vx+vec3(+dX,0.0,0.0));
 vec4 OOO = texture(intensityVol,vx+vec3(0.0,0.0,0.0));
 vec4 xOO = texture(intensityVol,vx+vec3(-dX,0.0,0.0));
 vec4 XyO = texture(intensityVol,vx+vec3(+dX,-dY,0.0));
 vec4 OyO = texture(intensityVol,vx+vec3(0.0,-dY,0.0));
 vec4 xyO = texture(intensityVol,vx+vec3(-dX,-dY,0.0));

 vec4 XYz = texture(intensityVol,vx+vec3(+dX,+dY,-dZ));
 vec4 OYz = texture(intensityVol,vx+vec3(0.0,+dY,-dZ));
 vec4 xYz = texture(intensityVol,vx+vec3(-dX,+dY,-dZ));
 vec4 XOz = texture(intensityVol,vx+vec3(+dX,0.0,-dZ));
 vec4 OOz = texture(intensityVol,vx+vec3(0.0,0.0,-dZ));
 vec4 xOz = texture(intensityVol,vx+vec3(-dX,0.0,-dZ));
 vec4 Xyz = texture(intensityVol,vx+vec3(+dX,-dY,-dZ));
 vec4 Oyz = texture(intensityVol,vx+vec3(0.0,-dY,-dZ));
 vec4 xyz = texture(intensityVol,vx+vec3(-dX,-dY,-dZ));

 vec4 blurred = vec4 (0.0, 0.0, 0.0, 0.0);
 blurred.r = 2.0*(xOz.r +xOZ.r +xyO.r +xYO.r +xOO.r +XOz.r +XOZ.r +XyO.r +XYO.r +XOO.r) +xyz.r +xyZ.r +xYz.r +xYZ.r +Xyz.r +XyZ.r +XYz.r +XYZ.r;
 blurred.g = 2.0*(Oyz.r +OyZ.r +xyO.r +XyO.r +OyO.r +OYz.r +OYZ.r +xYO.r +XYO.r +OYO.r) +xyz.r +Xyz.r +xyZ.r +XyZ.r +xYz.r +XYz.r +xYZ.r +XYZ.r;
 blurred.b = 2.0*(Oyz.r +OYz.r +xOz.r +XOz.r +OOz.r +OyZ.r +OYZ.r +xOZ.r +XOZ.r +OOZ.r) +xyz.r +Xyz.r +xYz.r +XYz.r +xyZ.r +XyZ.r +XyZ.r +XYZ.r;
 blurred.a = 0.32*(abs(blurred.r)+abs(blurred.g)+abs(blurred.b));
 // 0.0357 = 1/28 to account for weights, rescale to 2**16,
 FragColor = 0.0357*blurred;
}`,Q3=`
  gradientSample.a = log2(gradientSample.r*gradientSample.r + gradientSample.g*gradientSample.g + gradientSample.b*gradientSample.b + 1.922337562475971e-06) + 18.988706873717717;
`,fL=`#version 300 es
#line 323
precision highp int;
precision highp float;
in vec2 TexCoord;
out vec4 FragColor;
uniform float coordZ;
uniform float dX;
uniform float dY;
uniform float dZ;
uniform highp sampler3D intensityVol;
void main(void) {
  vec3 vx = vec3(TexCoord.xy, coordZ);
  //Neighboring voxels 'T'op/'B'ottom, 'A'nterior/'P'osterior, 'R'ight/'L'eft
  float TAR = texture(intensityVol,vx+vec3(+dX,+dY,+dZ)).r;
  float TAL = texture(intensityVol,vx+vec3(+dX,+dY,-dZ)).r;
  float TPR = texture(intensityVol,vx+vec3(+dX,-dY,+dZ)).r;
  float TPL = texture(intensityVol,vx+vec3(+dX,-dY,-dZ)).r;
  float BAR = texture(intensityVol,vx+vec3(-dX,+dY,+dZ)).r;
  float BAL = texture(intensityVol,vx+vec3(-dX,+dY,-dZ)).r;
  float BPR = texture(intensityVol,vx+vec3(-dX,-dY,+dZ)).r;
  float BPL = texture(intensityVol,vx+vec3(-dX,-dY,-dZ)).r;
  vec4 gradientSample = vec4 (0.0, 0.0, 0.0, 0.0);
  gradientSample.r = BAR+BAL+BPR+BPL -TAR-TAL-TPR-TPL;
  gradientSample.g = TPR+TPL+BPR+BPL -TAR-TAL-BAR-BAL;
  gradientSample.b = TAL+TPL+BAL+BPL -TAR-TPR-BAR-BPR;
${Q3}
	// 0.04242020977371934 = 1/(log2(3*8) - log2(1/(255**2*8))) // 3*8 -> max for 1st order gradient
	gradientSample.a *= 0.04242020977371934;
  gradientSample.rgb = normalize(gradientSample.rgb);
  gradientSample.rgb = (gradientSample.rgb * 0.5)+0.5;
  FragColor = gradientSample;
}`,mL=`#version 300 es
#line 323
precision highp int;
precision highp float;
in vec2 TexCoord;
out vec4 FragColor;
uniform float coordZ;
uniform float dX;
uniform float dY;
uniform float dZ;
uniform float dX2;
uniform float dY2;
uniform float dZ2;
uniform highp sampler3D intensityVol;
void main(void) {
  vec3 vx = vec3(TexCoord.xy, coordZ);
  //Neighboring voxels 'T'op/'B'ottom, 'A'nterior/'P'osterior, 'R'ight/'L'eft
  vec4 TAR = texture(intensityVol,vx+vec3(+dX,+dY,+dZ));
  vec4 TAL = texture(intensityVol,vx+vec3(+dX,+dY,-dZ));
  vec4 TPR = texture(intensityVol,vx+vec3(+dX,-dY,+dZ));
  vec4 TPL = texture(intensityVol,vx+vec3(+dX,-dY,-dZ));
  vec4 BAR = texture(intensityVol,vx+vec3(-dX,+dY,+dZ));
  vec4 BAL = texture(intensityVol,vx+vec3(-dX,+dY,-dZ));
  vec4 BPR = texture(intensityVol,vx+vec3(-dX,-dY,+dZ));
  vec4 BPL = texture(intensityVol,vx+vec3(-dX,-dY,-dZ));
  vec4 T = texture(intensityVol,vx+vec3(+dX2,0.0,0.0));
  vec4 A = texture(intensityVol,vx+vec3(0.0,+dY2,0.0));
  vec4 R = texture(intensityVol,vx+vec3(0.0,0.0,+dZ2));
  vec4 B = texture(intensityVol,vx+vec3(-dX2,0.0,0.0));
  vec4 P = texture(intensityVol,vx+vec3(0.0,-dY2,0.0));
  vec4 L = texture(intensityVol,vx+vec3(0.0,0.0,-dZ2));
  vec4 gradientSample = vec4 (0.0, 0.0, 0.0, 0.0);
  gradientSample.r = -4.0*B.r +8.0*(BAR.r+BAL.r+BPR.r+BPL.r) -8.0*(TAR.r+TAL.r+TPR.r+TPL.r) +4.0*T.r;
  gradientSample.g = -4.0*P.g +8.0*(TPR.g+TPL.g+BPR.g+BPL.g) -8.0*(TAR.g+TAL.g+BAR.g+BAL.g) +4.0*A.g;
  gradientSample.b = -4.0*L.b +8.0*(TAL.b+TPL.b+BAL.b+BPL.b) -8.0*(TAR.b+TPR.b+BAR.b+BPR.b) +4.0*R.b;
${Q3}
	gradientSample.a *= 0.0325;
  gradientSample.rgb = normalize(gradientSample.rgb);
  gradientSample.rgb =  (gradientSample.rgb * 0.5)+0.5;
  FragColor = gradientSample;
}`;function pL(){return[{Name:"Phong",Frag:eL},{Name:"Matte",Frag:iL},{Name:"Harmonic",Frag:sL},{Name:"Hemispheric",Frag:nL},{Name:"Crevice",Frag:JB},{Name:"Edge",Frag:KB},{Name:"Diffuse",Frag:QB},{Name:"Outline",Frag:qB},{Name:"Specular",Frag:ZB},{Name:"Toon",Frag:YB},{Name:"Flat",Frag:K3},{Name:"Matcap",Frag:tL},{Name:"Rim",Frag:XB},{Name:"Silhouette",Frag:WB},{Name:"Crosscut",Frag:$B}]}function gc(i){const{gl:e,shader:t,gradientAmount:n=0,renderDrawAmbientOcclusion:s,renderSilhouette:r,gradientOpacity:a}=i;t.use(e),e.uniform1i(t.uniforms.volume,0),e.uniform1i(t.uniforms.colormap,1),e.uniform1i(t.uniforms.overlay,2),e.uniform1i(t.uniforms.drawing,7),e.uniform1i(t.uniforms.paqd,8),e.uniform1fv(t.uniforms.renderDrawAmbientOcclusion,[s,1]),e.uniform1f(t.uniforms.gradientAmount,n),e.uniform1f(t.uniforms.silhouettePower,r);const l=new Float32Array(Mc);for(let c=0;c<Mc;c++)a===0?l[c]=1:l[c]=Math.pow(c/(Mc-1),a*8);e.uniform1fv(e.getUniformLocation(t.program,"gradientOpacity"),l),t.uniforms.clipPlanes=e.getUniformLocation(t.program,"clipPlanes[0]")}function gL(i){const{gl:e,fragmentShaderText:t,drawOpacity:n,customSliceShader:s}=i;if(s&&e.deleteProgram(s.program),!t)return null;const r=new nt(e,gd,t);return r.use(e),e.uniform1i(r.uniforms.volume,0),e.uniform1i(r.uniforms.colormap,1),e.uniform1i(r.uniforms.overlay,2),e.uniform1i(r.uniforms.drawing,7),e.uniform1i(r.uniforms.paqd,8),e.uniform1f(r.uniforms.drawOpacity,n),r}function Z3(i,e){const t=i.toLowerCase();for(let n=0;n<e.length;n++)if(e[n].Name.toLowerCase()===t)return n}function AL(i){const{gl:e,fragmentShaderText:t,name:n,meshShaders:s}=i;if(!t)throw new Error("Need fragment shader");const r=Z3(n,s);if(r!==void 0&&r>=0){const l=s[r].shader;l&&e.deleteProgram(l.program),s.splice(r,1)}const a=new nt(e,M1,t);return a.use(e),{Name:n,Frag:t,shader:a}}function vL(i,e=!0){const t=i.map(n=>n.Name);return e?t.sort():t}function yL(i,e){const t=new nt(i,gd,bB);t.use(i),i.uniform1i(t.uniforms.volume,0),i.uniform1i(t.uniforms.colormap,1),i.uniform1i(t.uniforms.overlay,2),i.uniform1i(t.uniforms.drawing,7),i.uniform1f(t.uniforms.drawOpacity,e);const n=new nt(i,gd,wB);n.use(i),i.uniform1i(n.uniforms.volume,0),i.uniform1i(n.uniforms.colormap,1),i.uniform1i(n.uniforms.overlay,2),i.uniform1i(n.uniforms.drawing,7),i.uniform1f(n.uniforms.drawOpacity,e);const s=new nt(i,gd,SB);return s.use(i),i.uniform1i(s.uniforms.volume,0),i.uniform1i(s.uniforms.colormap,1),i.uniform1i(s.uniforms.overlay,2),i.uniform1i(s.uniforms.drawing,7),i.uniform1f(s.uniforms.drawOpacity,e),{slice2DShader:t,sliceMMShader:n,sliceV1Shader:s}}function xL(i,e,t){const n=new nt(i,oL,lL),s=i.createVertexArray();i.bindVertexArray(s);const r=i.createBuffer();return i.enableVertexAttribArray(0),i.enableVertexAttribArray(1),i.bindBuffer(i.ARRAY_BUFFER,r),i.bufferData(i.ARRAY_BUFFER,e,i.STATIC_DRAW),i.vertexAttribPointer(0,3,i.FLOAT,!1,24,0),i.enableVertexAttribArray(1),i.vertexAttribPointer(1,3,i.FLOAT,!1,24,12),i.bindVertexArray(t),{shader:n,vao:s}}function bL(i){const e=new nt(i,Lb,y0);e.use(i);const t=new nt(i,Lb,CB);t.use(i);const n=new nt(i,MB,y0);n.use(i);const s=new nt(i,DB,y0);s.use(i);const r=new nt(i,FB,PB);return r.use(i),{rectShader:e,rectOutlineShader:t,lineShader:n,line3DShader:s,circleShader:r}}function wL(i){const{gl:e,renderDrawAmbientOcclusion:t,renderSilhouette:n,gradientOpacity:s}=i,r=new nt(e,pc,vB);gc({gl:e,shader:r,renderDrawAmbientOcclusion:t,renderSilhouette:n,gradientOpacity:s});const a=new nt(e,pc,AB);gc({gl:e,shader:a,renderDrawAmbientOcclusion:t,renderSilhouette:n,gradientOpacity:s});const l=new nt(e,pc,yB);gc({gl:e,shader:l,gradientAmount:.3,renderDrawAmbientOcclusion:t,renderSilhouette:n,gradientOpacity:s}),e.uniform1i(l.uniforms.matCap,5),e.uniform1i(l.uniforms.gradient,6);const c=new nt(e,pc,xB);return gc({gl:e,shader:c,renderDrawAmbientOcclusion:t,renderSilhouette:n,gradientOpacity:s}),e.uniform1i(c.uniforms.matCap,5),e.uniform1i(c.uniforms.gradient,6),{renderVolumeShader:r,renderSliceShader:a,renderGradientShader:l,renderGradientValuesShader:c,renderShader:r}}function SL(i){const e=new nt(i,EB,TB);return e.use(i),i.uniform1i(e.uniforms.colormap,1),e}function CL(i){const e=new nt(i,jh,hL),t=new nt(i,jh,dL),n=new nt(i,jh,fL),s=new nt(i,jh,mL),r=new nt(i,OB,UB),a=new nt(i,cL,uL);return{blurShader:e,sobelBlurShader:t,sobelFirstOrderShader:n,sobelSecondOrderShader:s,growCutShader:r,passThroughShader:a}}function EL(i){const e=new nt(i,ra,Vh.concat(Ob)),t=new nt(i,ra,kb.concat(Ob)),n=new nt(i,ra,Vh.concat(x0)),s=new nt(i,ra,kb.concat(x0)),r=new nt(i,ra,BB.concat(x0)),a=new nt(i,ra,Vh.concat(kB)),l=new nt(i,ra,Vh.concat(LB));return{orientShaderAtlasU:e,orientShaderAtlasI:t,orientShaderU:n,orientShaderI:s,orientShaderF:r,orientShaderRGBU:a,orientShaderPAQD:l}}function TL(i){const e=new nt(i,VB,jB);e.use(i);const t=new nt(i,zB,GB);return{surfaceShader:e,fiberShader:t}}function ML(i){const e=new nt(i,pc,aL);return e.use(i),e.uniforms.clipPlanes=i.getUniformLocation(e.program,"clipPlanes[0]"),i.uniform1i(e.uniforms.volume,0),i.uniform1i(e.uniforms.colormap,1),i.uniform1i(e.uniforms.overlay,2),i.uniform1i(e.uniforms.drawing,7),e}function DL(i,e){for(let t=0;t<e.length;t++){const n=e[t];n.Name==="Flat"?n.shader=new nt(i,rL,K3):n.shader=new nt(i,M1,n.Frag),n.shader.use(i),n.shader.isCrosscut=n.Name==="Crosscut",n.shader.isMatcap=n.Name==="Matcap",n.shader.isMatcap&&i.uniform1i(n.shader.uniforms.matCap,5)}}function RL(i,e){const t=[...i,e],n=t.length===1?0:t.length-1;return{volumes:t,index:n}}function Qo(i,e){for(let t=0;t<i.length;t++)if(i[t].id===e)return t;return-1}function NL(i,e){const t=i.slice(1);for(let n=0;n<t.length;n++)if(t[n].id===e)return n;return-1}function Zo(i,e,t=0){const n=i.length;if(t>n)return{volumes:i,back:i.length>0?i[0]:null,overlays:i.slice(1)};const s=Qo(i,e.id),r=[...i];return t===0?(r.splice(s,1),r.unshift(e)):t<0?r.splice(s,1):(r.splice(s,1),r.splice(t,0,e)),{volumes:r,back:r.length>0?r[0]:null,overlays:r.slice(1)}}function J3(i,e){return{volumes:Zo(i,e,-1).volumes,removed:e}}function IL(i,e){if(e>=i.length)throw new Error("Index of volume out of bounds");return J3(i,i[e])}function _L(i,e){return Zo(i,e,0)}function FL(i,e){const t=Qo(i,e.id);return Zo(i,e,t+1)}function PL(i,e){const t=Qo(i,e.id);return Zo(i,e,t-1)}function BL(i,e){return Zo(i,e,i.length-1)}function LL(i,e,t){return i[e].opacity=t,i}function kL(i,e){return i[e].clone()}function OL(i,e,t){const n=Qo(i,e);if(n<0)return i;const s=i[n];let r=t;return r>s.nFrame4D-1&&(r=s.nFrame4D-1),r<0&&(r=0),r===s.frame4D||(s.frame4D=r),i}function UL(i,e){const t=Qo(i,e);return t<0?0:i[t].frame4D}function VL(i){const e=i.hdr,t=e.dims[1]*e.dims[2]*e.dims[3],n=new Uint8ClampedArray(t*4),s=.2*Math.min(Math.min(e.dims[1],e.dims[2]),e.dims[3]),r=.5*e.dims[1],a=.5*e.dims[2],l=.5*e.dims[3];let c=0;for(let h=0;h<e.dims[3];h++)for(let d=0;d<e.dims[2];d++)for(let f=0;f<e.dims[1];f++){const p=Math.abs(f-r),g=Math.abs(d-a),y=Math.abs(h-l),x=Math.sqrt(p*p+g*g+y*y);let b=0;x<s&&(b=255),n[c++]=0,n[c++]=b,n[c++]=0,n[c++]=b*.5}return n}function jL(i){let e=i.img;return i.frame4D>0&&i.frame4D<i.nFrame4D&&(e=i.img.slice(i.frame4D*i.nVox3D,(i.frame4D+1)*i.nVox3D)),e}function zL(i){const{hdr:e,max2D:t,max3D:n}=i,s=e.dims[1]>t||e.dims[2]>t,r=e.dims[1]>n||e.dims[2]>n||e.dims[3]>n;return{isAboveMax2D:s,isAboveMax3D:r}}function GL(i){const{gl:e,overlayItem:t,orientShader:n,createColormapTexture:s}=i;if(t.colormapLabel===null||t.colormapLabel.lut.length<=7)return{colormapLabelTexture:null,shouldCleanup:!1};const r=t.colormapLabel.max-t.colormapLabel.min+1,a=s(null,1,r);return e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,1,e.RGBA,e.UNSIGNED_BYTE,t.colormapLabel.lut),e.uniform1f(n.uniforms.cal_min,t.colormapLabel.min-.5),e.uniform1f(n.uniforms.cal_max,t.colormapLabel.max+.5),e.bindTexture(e.TEXTURE_2D,a),{colormapLabelTexture:a,shouldCleanup:!0}}function HL(i){const{gl:e,overlayItem:t,hdr:n,volumes:s,orientShader:r,r8Tex:a,TEXTURE7:l}=i;if(t.modulationImage===null||t.modulationImage<0||t.modulationImage>=s.length)return e.uniform1i(r.uniforms.modulation,0),{modulateTexture:null};const c=s[t.modulationImage].hdr;if(c.dims[1]!==n.dims[1]||c.dims[2]!==n.dims[2]||c.dims[3]!==n.dims[3])return X.debug("Modulation image dimensions do not match target"),e.uniform1i(r.uniforms.modulation,0),{modulateTexture:null};X.debug("modulating",s),t.modulateAlpha?(e.uniform1i(r.uniforms.modulation,2),e.uniform1f(r.uniforms.opacity,1)):e.uniform1i(r.uniforms.modulation,1);const h=a(null,l,n.dims,!0);e.activeTexture(l),e.bindTexture(e.TEXTURE_3D,h);const d=n.dims[1]*n.dims[2]*n.dims[3],f=new Uint8Array(d),p=s[t.modulationImage].cal_min,g=1/(s[t.modulationImage].cal_max-p),y=s[t.modulationImage].img.buffer;let x=new Uint8Array(y);switch(c.datatypeCode){case 4:x=new Int16Array(y);break;case 16:x=new Float32Array(y);break;case 64:x=new Float64Array(y);break;case 128:x=new Uint8Array(y);break;case 512:x=new Uint16Array(y);break}X.debug(s[t.modulationImage]);const b=s[t.modulationImage].colormapNegative.length>0;let w=s[t.modulationImage].cal_min,S=s[t.modulationImage].cal_max;isFinite(s[t.modulationImage].cal_minNeg)&&isFinite(s[t.modulationImage].cal_maxNeg)&&(w=s[t.modulationImage].cal_minNeg,S=s[t.modulationImage].cal_maxNeg),w=Math.abs(w),S=Math.abs(S),w>S&&([w,S]=[S,w]);const C=1/(S-w);let E=Math.abs(t.modulateAlpha);E=Math.max(E,1);const D=s[t.modulationImage].frame4D*d;for(let M=0;M<d;M++){const N=x[M+D]*c.scl_slope+c.scl_inter;let I=(N-p)*g;b&&N<0&&(I=(Math.abs(N)-w)*C),I=Math.min(Math.max(I,0),1),I=Math.pow(I,E)*255,f[M]=I}return e.texSubImage3D(e.TEXTURE_3D,0,0,0,0,n.dims[1],n.dims[2],n.dims[3],e.RED,e.UNSIGNED_BYTE,f),{modulateTexture:h}}function YL(i,e,t){if(!i.dimsRAS||!i.matRAS||!i.pixDimsRAS||!i.vox2mm)throw new Error("Cannot create NiivueObject3D: Missing required RAS properties or vox2mm access on NVImage.");const n=i.dimsRAS,s=i.matRAS,r=i.pixDimsRAS,a=-.5,l=-.5,c=-.5,h=n[1]-1+.5,d=n[2]-1+.5,f=n[3]-1+.5,p=i.vox2mm,g=p.call(i,[a,l,c],s),y=p.call(i,[a,d,c],s),x=p.call(i,[a,l,f],s),b=p.call(i,[a,d,f],s),w=p.call(i,[h,l,c],s),S=p.call(i,[h,d,c],s),C=p.call(i,[h,l,f],s),E=p.call(i,[h,d,f],s),D=[...x,0,0,1,...C,1,0,1,...E,1,1,1,...b,0,1,1,...g,0,0,0,...y,0,1,0,...S,1,1,0,...w,1,0,0],M=t.createBuffer();if(!M)throw new Error("Failed to create GL index buffer");t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,M);const N=[0,3,2,2,1,0,4,7,6,6,5,4,5,6,2,2,3,5,4,0,1,1,7,4,7,1,2,2,6,7,4,5,3,3,0,4];t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(N),t.STATIC_DRAW);const I=t.createBuffer();if(!I)throw new Error("Failed to create GL vertex buffer");t.bindBuffer(t.ARRAY_BUFFER,I),t.bufferData(t.ARRAY_BUFFER,new Float32Array(D),t.STATIC_DRAW);const _=t.createVertexArray();if(!_)throw new Error("Failed to create GL VAO");t.bindVertexArray(_),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,M),t.bindBuffer(t.ARRAY_BUFFER,I);const F=24;t.enableVertexAttribArray(0),t.vertexAttribPointer(0,3,t.FLOAT,!1,F,0),t.enableVertexAttribArray(1),t.vertexAttribPointer(1,3,t.FLOAT,!1,F,12),t.bindVertexArray(null);const B=new Sa(e,I,t.TRIANGLES,N.length,M,_),P=[...x,...C,...E,...b,...g,...y,...S,...w],O=zF(P);return B.extentsMin=O.min.slice(),B.extentsMax=O.max.slice(),B.furthestVertexFromOrigin=O.furthestVertexFromOrigin,B.originNegate=kn(O.origin),UN(B.originNegate,B.originNegate),B.fieldOfViewDeObliqueMM=[n[1]*r[1],n[2]*r[2],n[3]*r[3]],B}var qL=33984,XL=33986,Ub=33994;function WL(i){const{overlayItem:e,VOLUME_ID:t,gl:n}=i;return YL(e,t,n)}function KL(i){const{overlayItem:e,mm2frac:t}=i,n=t(e.mm000,0,!0);let s=t(e.mm100,0,!0),r=t(e.mm010,0,!0),a=t(e.mm001,0,!0);s=It(s,s,n),r=It(r,r,n),a=It(a,a,n);const l=Vn(s[0],r[0],a[0],n[0],s[1],r[1],a[1],n[1],s[2],r[2],a[2],n[2],0,0,0,1);return rn(l,l),l}function QL(i){const{layer:e,backDims:t,rgbaTex:n}=i;if(e===0)return{volumeTexture:n(null,qL,t)};if(e===1){const s=n(null,XL,t);return{overlayTexture:s,overlayTextureID:s}}return{}}function ZL(i){const e=i.createFramebuffer();return i.bindFramebuffer(i.FRAMEBUFFER,e),i.disable(i.CULL_FACE),i.disable(i.BLEND),e}function JL(i){const{gl:e,layer:t,backDims:n,rgbaTex:s,passThroughShader:r}=i;if(t<=1)return s(null,Ub,[2,2,2,2]);const a=s(null,Ub,n);e.bindTexture(e.TEXTURE_3D,a),r.use(e),e.uniform1i(r.uniforms.in3D,2);for(let l=0;l<n[3];l++){const c=1/n[3]*(l+.5);e.uniform1f(r.uniforms.coordZ,c),e.framebufferTextureLayer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,a,0,l),e.drawArrays(e.TRIANGLE_STRIP,0,4)}return a}function $L(i){const{gl:e,overlayItem:t,orientShader:n,layer:s,isAdditiveBlend:r}=i,a=t.colormapType!==0?1:0,l=t.colormapType===1?1:0;e.uniform1i(n.uniforms.isAlphaThreshold,l),e.uniform1i(n.uniforms.isColorbarFromZero,a),e.uniform1i(n.uniforms.isAdditiveBlend,r?1:0);let c=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY;t.colormapNegative.length>0&&(c=Math.min(-t.cal_min,-t.cal_max),h=Math.max(-t.cal_min,-t.cal_max),isFinite(t.cal_minNeg)&&isFinite(t.cal_maxNeg)&&(c=Math.min(t.cal_minNeg,t.cal_maxNeg),h=Math.max(t.cal_minNeg,t.cal_maxNeg))),e.uniform1f(n.uniforms.layer??null,s),e.uniform1f(n.uniforms.cal_minNeg??null,c),e.uniform1f(n.uniforms.cal_maxNeg??null,h)}function ek(i){const{gl:e,orientShader:t,backDims:n,outTexture:s,mtx:r,hdr:a,intensityVolTextureUnit:l,blendTextureUnit:c,colormapTextureUnit:h,modulationTextureUnit:d,opacity:f,atlasOutline:p,atlasActiveIndex:g}=i;t.use(e),e.uniform1i(t.uniforms.intensityVol??null,l),e.uniform1i(t.uniforms.blend3D??null,c),e.uniform1i(t.uniforms.colormap??null,h),e.uniform1f(t.uniforms.scl_inter??null,a.scl_inter),e.uniform1f(t.uniforms.scl_slope??null,a.scl_slope),e.uniform1f(t.uniforms.opacity??null,f),e.uniform1i(t.uniforms.modulationVol??null,d),e.uniformMatrix4fv(t.uniforms.mtx,!1,r);let y=0;a.intent_code===1002&&(y=p,e.uniform1ui(t.uniforms.activeIndex,g|0)),e.uniform4fv(t.uniforms.xyzaFrac,[1/n[1],1/n[2],1/n[3],y]);for(let x=0;x<n[3];x++){const b=1/n[3]*(x+.5);e.uniform1f(t.uniforms.coordZ,b),e.framebufferTextureLayer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,s,0,x),e.drawArrays(e.TRIANGLE_STRIP,0,4)}}function tk(i){const{gl:e,renderShader:t,pickingImageShader:n,sliceShader:s,overlaysLength:r,clipPlaneColor:a,backOpacity:l,renderOverlayBlend:c,clipPlane:h,texVox:d,volScale:f,drawOpacity:p,paqdUniforms:g}=i;t.use(e),e.uniform1f(t.uniforms.overlays,r),e.uniform4fv(t.uniforms.clipPlaneColor,a),e.uniform1f(t.uniforms.backOpacity,l),e.uniform1f(t.uniforms.renderOverlayBlend,c),e.uniform4fv(t.uniforms.clipPlane,h),e.uniform3fv(t.uniforms.texVox,d),e.uniform3fv(t.uniforms.volScale,f),n.use(e),e.uniform1f(n.uniforms.overlays,r),e.uniform3fv(n.uniforms.texVox,d),s.use(e),e.uniform1f(s.uniforms.overlays,r),e.uniform1f(s.uniforms.drawOpacity,p),e.uniform4fv(s.uniforms.paqdUniforms,g)}function ik(i){const{is2DSliceShader:e,isV1SliceShader:t,sliceMMShader:n,slice2DShader:s,sliceV1Shader:r,customSliceShader:a}=i;let l=n;if(e&&(l=s),t&&(l=r),a&&(l=a),!l)throw new Error("slice shader undefined");return l}function nk(i){const{gl:e,shader:t,is2DSliceShader:n,drawTexture:s,paqdTexture:r,TEXTURE7_DRAW:a,TEXTURE8_PAQD:l}=i;e.uniform1i(t.uniforms.drawing,7),e.activeTexture(a),n?e.bindTexture(e.TEXTURE_2D,s):e.bindTexture(e.TEXTURE_3D,s),e.uniform1i(t.uniforms.paqd,8),e.activeTexture(l),e.bindTexture(e.TEXTURE_3D,r)}function sk(i){const{gl:e,TEXTURE9_ORIENT:t}=i,n=e.createTexture();return e.activeTexture(t),e.bindTexture(e.TEXTURE_3D,n),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.pixelStorei(e.UNPACK_ALIGNMENT,1),n}var rk=2,ak=4,ok=16,lk=64,ck=128,uk=512,hk=2304,b0=1002;function dk(i){const{gl:e,hdr:t,img:n,orientShaderU:s,orientShaderI:r,orientShaderF:a,orientShaderRGBU:l,orientShaderAtlasU:c,orientShaderAtlasI:h}=i;let d=s;if(t.datatypeCode===rk)t.intent_code===b0&&(d=c),e.texStorage3D(e.TEXTURE_3D,1,e.R8UI,t.dims[1],t.dims[2],t.dims[3]),e.texSubImage3D(e.TEXTURE_3D,0,0,0,0,t.dims[1],t.dims[2],t.dims[3],e.RED_INTEGER,e.UNSIGNED_BYTE,n);else if(t.datatypeCode===ak)d=r,t.intent_code===b0&&(d=h),e.texStorage3D(e.TEXTURE_3D,1,e.R16I,t.dims[1],t.dims[2],t.dims[3]),e.texSubImage3D(e.TEXTURE_3D,0,0,0,0,t.dims[1],t.dims[2],t.dims[3],e.RED_INTEGER,e.SHORT,n);else if(t.datatypeCode===ok)e.texStorage3D(e.TEXTURE_3D,1,e.R32F,t.dims[1],t.dims[2],t.dims[3]),e.texSubImage3D(e.TEXTURE_3D,0,0,0,0,t.dims[1],t.dims[2],t.dims[3],e.RED,e.FLOAT,n),d=a;else if(t.datatypeCode===lk){const f=Float32Array.from(n);e.texStorage3D(e.TEXTURE_3D,1,e.R32F,t.dims[1],t.dims[2],t.dims[3]),e.texSubImage3D(e.TEXTURE_3D,0,0,0,0,t.dims[1],t.dims[2],t.dims[3],e.RED,e.FLOAT,f),d=a}else t.datatypeCode===ck?(d=l,d.use(e),e.uniform1i(d.uniforms.hasAlpha,0),e.texStorage3D(e.TEXTURE_3D,1,e.RGB8UI,t.dims[1],t.dims[2],t.dims[3]),e.texSubImage3D(e.TEXTURE_3D,0,0,0,0,t.dims[1],t.dims[2],t.dims[3],e.RGB_INTEGER,e.UNSIGNED_BYTE,n)):t.datatypeCode===uk&&(t.intent_code===b0&&(d=c),e.texStorage3D(e.TEXTURE_3D,1,e.R16UI,t.dims[1],t.dims[2],t.dims[3]),e.texSubImage3D(e.TEXTURE_3D,0,0,0,0,t.dims[1],t.dims[2],t.dims[3],e.RED_INTEGER,e.UNSIGNED_SHORT,n));return{orientShader:d}}function fk(i){const{gl:e,hdr:t,img:n,overlayItem:s,layer:r,orientShaderRGBU:a,orientShaderPAQD:l,volumes:c,backDims:h,rgbaTex:d,paqdTexture:f,TEXTURE8_PAQD:p,TEXTURE9_ORIENT:g}=i;let y=a,x=null,b=f;if(s.colormapLabel){y=l;let w=!0;for(let S=0;S<r;S++){const C=c[S].hdr.datatypeCode===hk,E=!!c[S].colormapLabel;C&&E&&(w=!1)}w&&(b=d(f,p,h)),x=b,e.activeTexture(g)}return y.use(e),e.uniform1i(y.uniforms.hasAlpha,1),e.texStorage3D(e.TEXTURE_3D,1,e.RGBA8UI,t.dims[1],t.dims[2],t.dims[3]),e.texSubImage3D(e.TEXTURE_3D,0,0,0,0,t.dims[1],t.dims[2],t.dims[3],e.RGBA_INTEGER,e.UNSIGNED_BYTE,n),{orientShader:y,outTexture:x,paqdTexture:b}}function Ur(i,e){if(typeof e=="number")return e>=i.length?-1:e;for(let t=0;t<i.length;t++)if(i[t].id===e)return t;return-1}function mk(i,e){const t=[...i,e],n=t.length===1?0:t.length-1;return{meshes:t,index:n}}function pk(i,e,t=0){const n=i.length;if(t>n)return{meshes:i};const s=Ur(i,e.id);if(s<0)return{meshes:i};const r=[...i];return t===0?(r.splice(s,1),r.unshift(e)):t<0?r.splice(s,1):(r.splice(s,1),r.splice(t,0,e)),{meshes:r}}function gk(i){const{meshes:e,id:t,key:n,val:s,gl:r}=i,a=Ur(e,t);return a<0?(X.warn("setMeshProperty() id not loaded",t),-1):(e[a].setProperty(n,s,r),a)}function Ak(i){const{meshes:e,meshId:t,Xmm:n,Ymm:s,Zmm:r}=i,a=Ur(e,t);return a<0?(X.warn("indexNearestXYZmm() id not loaded",t),[NaN,NaN]):e[a].indexNearestXYZmm(n,s,r)}function vk(i){const{meshes:e,meshId:t,gl:n,order:s=3}=i,r=Ur(e,t);return r<0?(X.warn("decimateHierarchicalMesh() id not loaded",t),!1):e[r].decimateHierarchicalMesh(n,s)}function yk(i){const{meshes:e,meshId:t,gl:n}=i,s=Ur(e,t);return s<0?(X.warn("reverseFaces() id not loaded",t),!1):(e[s].reverseFaces(n),!0)}async function xk(i){const{meshes:e,meshId:t,layer:n,key:s,val:r,gl:a}=i,l=Ur(e,t);return l<0?(X.warn("setMeshLayerProperty() id not loaded",t),!1):(await e[l].setLayerProperty(n,s,r,a),!0)}function bk(i){const{meshes:e,meshShaders:t,id:n,meshShaderNameOrNumber:s,meshShaderNameToNumber:r}=i;let a=0;if(typeof s=="number"?a=s:a=r(s),a===void 0)throw new Error("shaderIndex undefined");a=Math.min(a,t.length-1),a=Math.max(a,0);const l=Ur(e,n);return l>=e.length||l<0?(X.debug("Unable to change shader until mesh is loaded (maybe you need async)"),null):(e[l].meshShaderIndex=a,{meshIndex:l,shaderIndex:a})}var zh={name:"untitled connectome",nodeColormap:"warm",nodeColormapNegative:"winter",nodeMinColor:0,nodeMaxColor:4,nodeScale:3,edgeColormap:"warm",edgeColormapNegative:"winter",edgeMin:2,edgeMax:6,edgeScale:1,legendLineThickness:0,showLegend:!0},Ad=class $3 extends bo{constructor(e,t){super(new Float32Array([]),new Uint32Array([]),t.name,new Uint8Array([]),1,!0,e,t),G(this,"gl"),G(this,"nodesChanged"),this.gl=e,this.type="connectome",this.nodes&&this.updateLabels(),this.nodesChanged=new EventTarget}static convertLegacyConnectome(e){const t={nodes:[],edges:[],...zh};for(const s in e)if(s in zh){const r=s;t[r]=e[r]}const n=e.nodes;for(let s=0;s<n.names.length;s++)t.nodes.push({name:n.names[s],x:n.X[s],y:n.Y[s],z:n.Z[s],colorValue:n.Color[s],sizeValue:n.Size[s]});for(let s=0;s<n.names.length-1;s++)for(let r=s+1;r<n.names.length;r++){const a=e.edges[s*n.names.length+r];t.edges.push({first:s,second:r,colorValue:a})}return t}static convertFreeSurferConnectome(e,t="warm"){let n=!0;if("data_type"in e?e.data_type!=="fs_pointset"&&(n=!1):n=!1,"points"in e||(n=!1),!n)throw Error("not a valid FreeSurfer json pointset");const s=e.points.map(a=>({name:Array.isArray(a.comments)&&a.comments.length>0&&"text"in a.comments[0]?a.comments[0].text:"",x:a.coordinates.x,y:a.coordinates.y,z:a.coordinates.z,colorValue:1,sizeValue:1,metadata:a.comments}));return{...zh,nodeColormap:t,edgeColormap:t,nodes:s,edges:[]}}updateLabels(){const e=this.nodes;if(e&&e.length>0){const t=e.reduce((h,d)=>h.sizeValue>d.sizeValue?h:d).sizeValue;let n,s;if(typeof this.nodeMinColor<"u"&&isFinite(this.nodeMinColor))n=this.nodeMinColor;else{n=e[0].colorValue;for(let h=1;h<e.length;h++)e[h].colorValue<n&&(n=e[h].colorValue)}if(typeof this.nodeMaxColor<"u"&&isFinite(this.nodeMaxColor))s=this.nodeMaxColor;else{s=e[0].colorValue;for(let h=1;h<e.length;h++)e[h].colorValue>s&&(s=e[h].colorValue)}const r=yt.colormap(this.nodeColormap,this.colormapInvert),a=yt.colormap(this.nodeColormapNegative,this.colormapInvert),l="nodeColormapNegative"in this;let c=this.legendLineThickness?this.legendLineThickness:0;this.showLegend===!1&&(c=0);for(let h=0;h<e.length;h++){let d=e[h].colorValue,f=!1;if(l&&d<0&&(f=!0,d=-d),n<s){if(d<n){X.warn("color value lower than min");continue}d=(d-n)/(s-n)}else d=1;d=Math.round(Math.max(Math.min(255,d*255)))*4;let p=[r[d],r[d+1],r[d+2],255];f&&(p=[a[d],a[d+1],a[d+2],255]),p=p.map(g=>g/255),X.debug("adding label for ",e[h]),e[h].label=new x1(e[h].name,{textColor:p,bulletScale:e[h].sizeValue/t,bulletColor:p,lineWidth:c,lineColor:p,textScale:1,textAlignment:"left",lineTerminator:"none"},[e[h].x,e[h].y,e[h].z]),X.debug("label for node:",e[h].label)}}}addConnectomeNode(e){if(X.debug("adding node",e),!this.nodes)throw new Error("nodes not defined");this.nodes.push(e),this.updateLabels(),this.nodesChanged.dispatchEvent(new CustomEvent("nodeAdded",{detail:{node:e}}))}deleteConnectomeNode(e){const t=this.nodes.indexOf(e),n=this.edges;n&&(this.edges=n.filter(s=>s.first!==t&&s.second!==t)),this.nodes=this.nodes.filter(s=>s!==e),this.updateLabels(),this.updateConnectome(this.gl),this.nodesChanged.dispatchEvent(new CustomEvent("nodeDeleted",{detail:{node:e}}))}updateConnectomeNodeByIndex(e,t){this.nodes[e]=t,this.updateLabels(),this.updateConnectome(this.gl),this.nodesChanged.dispatchEvent(new CustomEvent("nodeChanged",{detail:{node:t}}))}updateConnectomeNodeByPoint(e,t){const n=this.nodes;if(!n)throw new Error("Node to update does not exist");const s=n.find(a=>Ve.arraysAreEqual([a.x,a.y,a.z],e));if(!s)throw new Error(`Node with point ${e} to update does not exist`);const r=n.findIndex(a=>a===s);this.updateConnectomeNodeByIndex(r,t)}addConnectomeEdge(e,t,n){const s=this.edges;let r=s.find(a=>(a.first===e||a.second===e)&&a.first+a.second===e+t);return r||(r={first:e,second:t,colorValue:n},s.push(r),this.updateConnectome(this.gl),r)}deleteConnectomeEdge(e,t){const n=this.edges,s=n.find(r=>(r.first===e||r.first===t)&&r.first+r.second===e+t);if(s)this.edges=n.filter(r=>r!==s);else throw new Error(`edge between ${e} and ${t} not found`);return this.updateConnectome(this.gl),s}findClosestConnectomeNode(e,t){const n=this.nodes;if(!n||n.length===0)return null;const s=n.map((r,a)=>({node:r,distance:Math.sqrt(Math.pow(r.x-e[0],2)+Math.pow(r.y-e[1],2)+Math.pow(r.z-e[2],2)),index:a})).filter(r=>r.distance<t).sort((r,a)=>r.distance-a.distance);return s.length>0?s[0].node:null}updateConnectome(e){const t=[],n=[],s=[];let r=yt.colormap(this.nodeColormap,this.colormapInvert),a=yt.colormap(this.nodeColormapNegative,this.colormapInvert),l="nodeColormapNegative"in this;this.nodeMinColor===void 0&&(this.nodeMinColor=NaN),this.nodeMaxColor===void 0&&(this.nodeMaxColor=NaN),this.edgeMin===void 0&&(this.edgeMin=NaN),this.edgeMax===void 0&&(this.edgeMax=NaN);let c=this.nodeMinColor,h=this.nodeMaxColor;if(!isFinite(c)||!isFinite(c)){const w=this.nodes;c=w[0].colorValue,h=w[0].colorValue;for(let S=0;S<w.length;S++)c=Math.min(c,w[S].colorValue),h=Math.max(h,w[S].colorValue)}const d=this.nodes,f=d.length;for(let w=0;w<f;w++){const S=d[w].sizeValue*this.nodeScale;if(S<=0)continue;let C=d[w].colorValue,E=!1;if(l&&C<0&&(E=!0,C=-C),c<h){if(C<c)continue;C=(C-c)/(h-c)}else C=1;C=Math.round(Math.max(Math.min(255,C*255)))*4;let D=[r[C],r[C+1],r[C+2],255];E&&(D=[a[C],a[C+1],a[C+2],255]);const M=Ae(d[w].x,d[w].y,d[w].z);Sa.makeColoredSphere(n,t,s,S,M,D)}r=yt.colormap(this.edgeColormap,this.colormapInvert),a=yt.colormap(this.edgeColormapNegative,this.colormapInvert),l="edgeColormapNegative"in this;const p=this.edges;if(p!==void 0&&p.length>0){if(c=this.edgeMin,h=this.edgeMax,!isFinite(c)||!isFinite(c)){c=p[0].colorValue,h=p[0].colorValue;for(let w=0;w<p.length;w++)c=Math.min(c,p[w].colorValue),h=Math.max(h,p[w].colorValue)}for(const w of p){let S=w.colorValue;const C=l&&S<0;C&&(S=-S);const E=S*this.edgeScale;if(E<=0)continue;if(c<h){if(S<c)continue;S=(S-c)/(h-c)}else S=1;S=Math.round(Math.max(Math.min(255,S*255)))*4;let D=[r[S],r[S+1],r[S+2],255];C&&(D=[a[S],a[S+1],a[S+2],255]);const M=Ae(d[w.first].x,d[w.first].y,d[w.first].z),N=Ae(d[w.second].x,d[w.second].y,d[w.second].z);Sa.makeColoredCylinder(n,t,s,M,N,E,D)}}const g=new Float32Array(n),y=new Uint32Array(t),x=la.getExtents(g);this.furthestVertexFromOrigin=x.mxDx,this.extentsMin=x.extentsMin,this.extentsMax=x.extentsMax;const b=this.generatePosNormClr(g,y,new Uint8Array(s));e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,Uint32Array.from(y),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,Float32Array.from(b),e.STATIC_DRAW),this.indexCount=t.length}updateMesh(e){this.updateConnectome(e),this.updateLabels()}json(){const e={};for(const t in this)(t in zh||t==="nodes"||t==="edges")&&(e[t]=this[t]);return e}static async loadConnectomeFromUrl(e,t){const s=await(await fetch(t)).json();return new $3(e,s)}};function wk(i){const{gl:e,json:t}=i;let n=t;if("data_type"in t&&t.data_type==="fs_pointset")n=Ad.convertFreeSurferConnectome(t),X.warn("converted FreeSurfer connectome",n);else if("nodes"in t){const s=t.nodes;"names"in s&&"X"in s&&"Y"in s&&"Z"in s&&"Color"in s&&"Size"in s&&(n=Ad.convertLegacyConnectome(t))}else throw new Error("not a known connectome format");return new Ad(e,n)}function Sk(i,e="none"){const t=[1,1,1,1];return{text:i.name,style:{textColor:t,bulletScale:1,bulletColor:t,lineWidth:0,lineColor:t,lineTerminator:e,textScale:1},position:[i.x,i.y,i.z]}}function Ck(i){const{meshes:e,documentLabels:t}=i,a=e.filter(c=>c.type==="connectome").flatMap(c=>c.nodes).map(c=>c.label).filter(c=>c!==void 0);return[...t,...a]}function Ek(i){const{meshes:e,documentLabels:t}=i,a=e.filter(d=>d.type==="connectome"&&d.showLegend!==!1).flatMap(d=>d.nodes).map(d=>d.label).filter(d=>d!==void 0&&d.text!==""),l=t.filter(d=>d.anchor==null||d.anchor===0),c=new Set(a);for(const d of l)c.add(d);const h=e.filter(d=>d.type==="mesh");for(let d=0;d<h.length;d++)for(let f=0;f<h[d].layers.length;f++)if(h[d].layers[f].labels)for(let p=0;p<h[d].layers[f].labels.length;p++)c.add(h[d].layers[f].labels[p]);return Array.from(c)}var e4={};Hi(e4,{MESH_EXTENSIONS:()=>D1,getFileExt:()=>R1,getLoader:()=>Tk,getMediaByUrl:()=>i4,handleDragEnter:()=>r4,handleDragOver:()=>a4,isDicomExtension:()=>Mk,isMeshExt:()=>t4,readDirectory:()=>s4,readFileAsDataURL:()=>Dk,registerLoader:()=>n4,traverseFileTree:()=>N1});var D1=["ASC","BYU","DFS","FSM","PIAL","ORIG","INFLATED","SMOOTHWM","SPHERE","WHITE","G","GEO","GII","ICO","MZ3","NV","OBJ","OFF","PLY","SRF","STL","TCK","TRACT","TRI","TRK","TT","TRX","VTK","WRL","X3D","JCON","JSON"];function R1(i,e=!0){let t;typeof i=="object"?(t=i.fullname,e=i.upperCase??!0):t=i,X.debug("fullname: ",t);const n=/(?:\.([^.]+))?$/;let s=n.exec(t)[1];if(s=s.toUpperCase(),s==="GZ")s=n.exec(t.slice(0,-3))[1],s=s.toUpperCase();else if(s==="CBOR"){const r=s;s=n.exec(t.slice(0,-5))[1],s=s.toUpperCase(),s=`${s}.${r}`}return e?s:s.toLowerCase()}function t4(i){const e=R1(i);return X.debug("checking mesh ext:",e),D1.includes(e)}function i4(i,e){return[...e.entries()].filter(t=>t[1]===i).map(t=>t[0]).pop()}function n4(i){const{loaders:e,loader:t,fileExt:n,toExt:s}=i;return{...e,[n.toUpperCase()]:{loader:t,toExt:s}}}function Tk(i,e){return i[e.toUpperCase()]}function Mk(i){return i.toUpperCase()==="DCM"}async function N1(i,e="",t){return new Promise(n=>{if(i.isFile)i.file(s=>{s.fullPath=e+s.name,s._webkitRelativePath=e+s.name,t.push(s),n(t)});else if(i.isDirectory){const s=i.createReader(),r=()=>{s.readEntries(a=>{if(a.length>0){const l=a.map(c=>N1(c,e+i.name+"/",t));Promise.all(l).then(r).catch(c=>{throw c})}else n(t)})};r()}})}function s4(i){const e=i.createReader();let t=[];const n=async r=>{const a=[],l=async c=>new Promise((h,d)=>c.file(h,d));for(let c=0;c<r.length;c++)a.push(await l(r[c]));return a},s=()=>{e.readEntries(r=>{r.length?(t=t.concat(r),s()):n(t).then(async()=>{}).catch(a=>{throw a})})};return s(),t}function Dk(i){return new Promise((e,t)=>{i.file(n=>{const s=new FileReader;s.onload=()=>e(s.result),s.onerror=()=>t(new Error("Failed to read file as data URL")),s.readAsDataURL(n)},n=>t(n))})}function r4(i){i.stopPropagation(),i.preventDefault()}function a4(i){i.stopPropagation(),i.preventDefault()}var Rk=33984,Nk=33986;function Ik(i){const{gl:e,layer:t,isForceLinear:n=!1,isNearestInterpolation:s,is2DSliceShader:r}=i;let a=e.LINEAR;!n&&s&&(a=e.NEAREST),t===0?e.activeTexture(Rk):e.activeTexture(Nk),r?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a)):(e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MIN_FILTER,a),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MAG_FILTER,a))}function Vb(i,e,t,n){let s=t.slice(),r=n.slice();return i===1&&(s=e.slice()),i===2&&(s=e.slice(),r=t.slice()),{linesH:s,linesV:r}}function _k(i,e,t,n){let s,r;switch(i){case 0:s=e[0],r=e[1];break;case 1:s=e[0],r=e[2];break;case 2:s=e[1],r=e[2];break;default:return[t,n]}const a=s/r,l=t/n;let c,h;return a>l?(c=t,h=t/a):(h=n,c=n*a),[c,h]}var Fk=33984,I1=33990,jb=33992;function gf(i,e){const t=-e*(Math.PI/180),n=(i-90)%360*(Math.PI/180),s=[Math.cos(t)*Math.cos(n),Math.cos(t)*Math.sin(n),Math.sin(t)],r=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);return r<=0||(s[0]/=r,s[1]/=r,s[2]/=r),s}function _1(i){const{azimuth:e,elevation:t,obliqueRAS:n}=i,s=it();if(s[0]=-1,_d(s,s,_r(270-t)),Fd(s,s,_r(e-180)),n){const r=Qt(n);ga(s,s,r)}return s}function o4(i){const{azimuth:e,elevation:t,obliqueRAS:n}=i,s=Ae(0,0,-1),r=_1({azimuth:e,elevation:t,obliqueRAS:n}),a=Nr(1,0,0,0,-1,0,0,0,-1),l=bt();ab(l,s,a);const c=tg();IN(c,r);const h=tg();if(!_N(h,c))return Ae(0,0,1);const d=bt();ab(d,l,h),On(d,d);const f=5e-5;for(let p=0;p<3;p++)Math.abs(d[p])<f&&(d[p]=Math.sign(d[p])*f||f);return d}function zb(i){const{gl:e,hdr:t,genericVAO:n,unusedVAO:s,volumeTexture:r,paqdTexture:a,gradientOrder:l,blurShader:c,sobelBlurShader:h,sobelFirstOrderShader:d,sobelSecondOrderShader:f,rgbaTex:p}=i;let{gradientTexture:g}=i;e.bindVertexArray(n);const y=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,y),e.viewport(0,0,t.dims[1],t.dims[2]),e.disable(e.BLEND);const x=p(null,jb,t.dims,!0),b=l===2?h:c;b.use(e),e.activeTexture(Fk),e.bindTexture(e.TEXTURE_3D,r),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MAG_FILTER,e.LINEAR);const w=.7;e.uniform1i(b.uniforms.intensityVol,0),e.uniform1f(b.uniforms.dX,w/t.dims[1]),e.uniform1f(b.uniforms.dY,w/t.dims[2]),e.uniform1f(b.uniforms.dZ,w/t.dims[3]);for(let E=0;E<t.dims[3]-1;E++){const D=1/t.dims[3]*(E+.5);e.uniform1f(b.uniforms.coordZ,D),e.framebufferTextureLayer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,x,0,E);const M=e.checkFramebufferStatus(e.FRAMEBUFFER);M!==e.FRAMEBUFFER_COMPLETE&&X.error("blur shader: ",M),e.drawArrays(e.TRIANGLE_STRIP,0,4)}const S=l===2?f:d;S.use(e),e.activeTexture(jb),e.bindTexture(e.TEXTURE_3D,x),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.uniform1i(S.uniforms.intensityVol,8);const C=.7;e.uniform1f(S.uniforms.dX,C/t.dims[1]),e.uniform1f(S.uniforms.dY,C/t.dims[2]),e.uniform1f(S.uniforms.dZ,C/t.dims[3]),l===2&&(e.uniform1f(S.uniforms.dX2,2*C/t.dims[1]),e.uniform1f(S.uniforms.dY2,2*C/t.dims[2]),e.uniform1f(S.uniforms.dZ2,2*C/t.dims[3])),e.uniform1f(S.uniforms.coordZ,.5),g!==null&&e.deleteTexture(g),g=p(g,I1,t.dims);for(let E=0;E<t.dims[3]-1;E++){const D=1/t.dims[3]*(E+.5);e.uniform1f(S.uniforms.coordZ,D),e.framebufferTextureLayer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,g,0,E);const M=e.checkFramebufferStatus(e.FRAMEBUFFER);M!==e.FRAMEBUFFER_COMPLETE&&X.error("sobel shader: ",M),e.drawArrays(e.TRIANGLE_STRIP,0,4)}return e.deleteFramebuffer(y),e.deleteTexture(x),e.bindFramebuffer(e.FRAMEBUFFER,null),e.activeTexture(33992),e.bindTexture(e.TEXTURE_3D,a),e.bindVertexArray(s),g}function Pk(i){const{gl:e,gradientTexture:t,dims:n}=i;if(!t||!n)return null;const s=n[1],r=n[2],a=n[3],l=s*r*a,c=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,c);const h=new Float32Array(l*4);try{for(let d=0;d<a;d++){e.framebufferTextureLayer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,t,0,d);const f=e.checkFramebufferStatus(e.FRAMEBUFFER);if(f!==e.FRAMEBUFFER_COMPLETE){console.warn("Framebuffer not complete for gradient texture reading, slice",d,"status:",f.toString(16));continue}try{const p=new Uint8Array(s*r*4);e.readPixels(0,0,s,r,e.RGBA,e.UNSIGNED_BYTE,p);const g=new Float32Array(s*r*4);for(let x=0;x<p.length;x++)g[x]=p[x]/127.5-1;const y=d*s*r*4;h.set(g,y)}catch(p){console.warn("Failed to read pixels for slice",d,":",p);const g=d*s*r*4,y=new Float32Array(s*r*4);h.set(y,g)}}}catch(d){return console.error("Error reading gradient texture:",d),null}finally{e.deleteFramebuffer(c),e.bindFramebuffer(e.FRAMEBUFFER,null)}return h}function Bk(i){const{gl:e,data:t,dims:n,backDims:s,gradientTextureAmount:r,hdr:a,gradientGLFn:l}=i;let{gradientTexture:c}=i;if(t===null)return a&&r>0&&l&&l(a),{gradientTexture:c,useCustomGradientTexture:!1};if(!n&&!s)return console.warn("No dimensions provided and no background volume loaded"),{gradientTexture:c,useCustomGradientTexture:!1};const h=n||s,d=h[1],f=h[2],p=h[3],g=d*f*p*4;if(t.length!==g)return console.warn(`Custom gradient data size mismatch. Expected ${g}, got ${t.length}`),{gradientTexture:c,useCustomGradientTexture:!1};c!==null&&e.deleteTexture(c),c=e.createTexture(),e.activeTexture(I1),e.bindTexture(e.TEXTURE_3D,c),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.pixelStorei(e.UNPACK_ALIGNMENT,1);let y;if(t instanceof Float32Array){y=new Uint8Array(t.length);for(let x=0;x<t.length;x++){const b=Math.max(-1,Math.min(1,t[x]));y[x]=Math.round((b+1)*127.5)}}else y=t;return e.texStorage3D(e.TEXTURE_3D,1,e.RGBA8,d,f,p),e.texSubImage3D(e.TEXTURE_3D,0,0,0,0,d,f,p,e.RGBA,e.UNSIGNED_BYTE,y),{gradientTexture:c,useCustomGradientTexture:!0}}function Lk(i){const{gl:e,mvpMatrix:t,azimuth:n,elevation:s,volumesLength:r,volumeObject3D:a,unusedVAO:l,renderShader:c,pickingImageShader:h,mouseDepthPicker:d,backgroundMasksOverlays:f,gradientTextureAmount:p,gradientTexture:g,drawBitmap:y,renderDrawAmbientOcclusion:x,drawOpacity:b,paqdUniforms:w,matRAS:S,crosshairPos:C,clipPlaneDepthAziElevs:E,isClipPlanesCutaway:D,obliqueRAS:M}=i;if(r===0)return;const N=o4({azimuth:n,elevation:s,obliqueRAS:M}),I=a;if(I){e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enable(e.CULL_FACE),e.cullFace(e.FRONT);let _=c;if(d&&(_=h),_.use(e),e.uniform1i(_.uniforms.backgroundMasksOverlays,f),p>0&&_.uniforms.normMtx&&g){e.activeTexture(I1),e.bindTexture(e.TEXTURE_3D,g);const F=_1({azimuth:n,elevation:s,obliqueRAS:M}),B=it();rn(B,F);const P=it();sn(P,B),e.uniformMatrix4fv(_.uniforms.normMtx,!1,P)}if(y&&y.length>8?e.uniform2f(_.uniforms.renderDrawAmbientOcclusionXY,x,b):e.uniform2f(_.uniforms.renderDrawAmbientOcclusionXY,x,0),e.uniform4fv(_.uniforms.paqdUniforms,w),e.uniformMatrix4fv(_.uniforms.mvpMtx,!1,t),e.uniformMatrix4fv(_.uniforms.matRAS,!1,S),e.uniform3fv(_.uniforms.rayDir,N),p<0)e.uniform4fv(_.uniforms.clipPlane,[C[0],C[1],C[2],30]);else{const B=new Float32Array(24).fill(2);for(let P=0;P<E.length;P++){const O=E[P],k=gf(O[1]+180,O[2]),q=[k[0],k[1],k[2],O[0]];B.set(q,P*4)}e.uniform4fv(_.uniforms.clipPlanes,B)}e.uniform1f(_.uniforms.drawOpacity,1),e.uniform1i(_.uniforms.isClipCutaway,D?1:0),e.bindVertexArray(I.vao),e.drawElements(I.mode,I.indexCount,e.UNSIGNED_SHORT,0),e.bindVertexArray(l)}}var kk=33989;function Ok(i){const{visible:e,opacity:t,indexCount:n}=i;return e&&t>0&&n>=3}function Uk(i){const{meshShaderIndex:e,meshShaders:t,pickingMeshShader:n,mouseDepthPicker:s}=i;return s?n:t[e]?.shader??null}function Vk(i){const{meshOpacity:e,globalAlpha:t}=i;return e*t}function jk(i){const{offsetPt0:e,fiberSides:t,fiberRadius:n}=i;return!!e&&(t<3||n<=0)}function zk(i){const{modelMtx:e,crosshairMM:t,is2D:n}=i,s=1e9,r=[t[0],t[1],t[2]];return n&&(Math.abs(e[2])+Math.abs(e[4])+Math.abs(e[9])>=2.95&&(r[1]=s,r[2]=s),Math.abs(e[0])+Math.abs(e[6])+Math.abs(e[9])>=2.95&&(r[0]=s,r[2]=s),Math.abs(e[0])+Math.abs(e[5])+Math.abs(e[10])>=2.95&&(r[0]=s,r[1]=s)),r}function Gk(i){let e=Number(i);return Number.isFinite(e)||(e=1),e}function Hk(i){const{gl:e,shader:t,modelMtx:n,sliceMM:s,meshThickness:r}=i;e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.uniformMatrix4fv(t.uniforms.modelMtx,!1,n),e.uniform4fv(t.uniforms.sliceMM,[s[0],s[1],s[2],r])}function Gb(i){const{gl:e,shader:t,mvpMtx:n,normMtx:s,opacity:r}=i;e.uniformMatrix4fv(t.uniforms.mvpMtx,!1,n),e.uniformMatrix4fv(t.uniforms.normMtx,!1,s),e.uniform1f(t.uniforms.opacity,r)}function Yk(i){const{gl:e,matCapTexture:t}=i;e.activeTexture(kk),e.bindTexture(e.TEXTURE_2D,t)}function Hb(i){const{gl:e,mesh:t,unusedVAO:n}=i;e.bindVertexArray(t.vao),e.drawElements(e.TRIANGLES,t.indexCount,e.UNSIGNED_INT,0),e.bindVertexArray(n)}function qk(i){const{gl:e,mesh:t,unusedVAO:n}=i;e.bindVertexArray(t.vaoFiber),e.drawElements(e.LINE_STRIP,t.indexCount,e.UNSIGNED_INT,0),e.bindVertexArray(n)}function Xk(i){const{gl:e}=i;e.enable(e.BLEND),e.depthMask(!1),e.depthFunc(e.ALWAYS)}function Wk(i){i.depthMask(!0),i.depthFunc(i.LEQUAL),i.disable(i.BLEND)}function Kk(i){i.depthMask(!0),i.disable(i.BLEND)}function Qk(i){const{gl:e,meshes:t,isDepthTest:n,alpha:s,mvpMatrix:r,modelMatrix:a,normalMatrix:l,is2D:c,meshShaders:h,pickingMeshShader:d,fiberShader:f,mouseDepthPicker:p,matCapTexture:g,unusedVAO:y,meshXRay:x,meshThicknessOn2D:b,frac2mm:w,crosshairPos:S}=i;if(t.length<1)return;e.enable(e.DEPTH_TEST),n?e.depthFunc(e.LEQUAL):e.depthFunc(e.ALWAYS),e.cullFace(e.BACK),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);let C=!1;for(const E of t){if(!Ok({visible:E.visible,opacity:E.opacity,indexCount:E.indexCount}))continue;const D=Vk({meshOpacity:E.opacity,globalAlpha:s}),M=Uk({meshShaderIndex:E.meshShaderIndex,meshShaders:h,pickingMeshShader:d,mouseDepthPicker:p});if(M){if(M.use(e),M.isCrosscut){const N=w([S[0],S[1],S[2]]),I=zk({modelMtx:a,crosshairMM:N,is2D:c}),_=Gk(b);Hk({gl:e,shader:M,modelMtx:a,sliceMM:I,meshThickness:_})}else e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST);if(Gb({gl:e,shader:M,mvpMtx:r,normMtx:l,opacity:D}),D>=1?(e.disable(e.BLEND),e.depthMask(!0)):(e.enable(e.BLEND),e.depthMask(!1)),jk({offsetPt0:E.offsetPt0,fiberSides:E.fiberSides,fiberRadius:E.fiberRadius})){C=!0;continue}M.isMatcap&&Yk({gl:e,matCapTexture:g}),Hb({gl:e,mesh:E,unusedVAO:y})}}if(e.enable(e.CULL_FACE),x>0&&!C){Xk({gl:e});for(const E of t){if(!E.visible||E.indexCount<3)continue;const D=h[E.meshShaderIndex]?.shader;D&&(D.use(e),Gb({gl:e,shader:D,mvpMtx:r,normMtx:l,opacity:E.opacity*s*x}),Hb({gl:e,mesh:E,unusedVAO:y}))}Wk(e)}if(C&&f){f.use(e),e.uniformMatrix4fv(f.uniforms.mvpMtx,!1,r),e.uniform1f(f.uniforms.opacity,s);for(const E of t)E.offsetPt0&&(E.fiberSides>=3&&E.fiberRadius>0||qk({gl:e,mesh:E,unusedVAO:y}))}Kk(e)}function Zk(i){const{canvasWidth:e,canvasHeight:t,leftTopWidthHeight:n,azimuth:s,elevation:r,furthestFromPivot:a,pivot3D:l,volScaleMultiplier:c,position:h}=i;let d=n;(d[2]===0||d[3]===0)&&(d=[0,0,e,t]);const f=d[2]/d[3];let p=a;const g=l,y=it();p=.8*p/c,f<1?Pd(y,-p,p,-p/f,p/f,p*8,p*.01):Pd(y,-p*f,p*f,-p,p,p*8,p*.01);const x=it();x[0]=-1;const b=Ae(0,0,-p*1.8);No(x,x,b),h&&No(x,x,h),_d(x,x,_r(270-r)),Fd(x,x,_r(s-180)),No(x,x,[-g[0],-g[1],-g[2]]);const w=it();rn(w,x);const S=it();sn(S,w);const C=it();return ga(C,y,x),{mvpMatrix:C,modelMatrix:x,normalMatrix:S}}function Jk(i){const{sceneMin:e,sceneMax:t}=i,n=bt();Aa(n,e,t),kN(n,n,.5);const s=bt();return It(s,t,e),{pivot3D:[n[0],n[1],n[2]],furthestFromPivot:Fr(s)*.5,extentsMin:e,extentsMax:t}}function $k(i){const{volumes:e}=i;if(e.length<1)return 0;let t=0;for(let n=0;n<e.length;n++)t=Math.max(t,e[n].nFrame4D??0);return t}function e7(i){const{fontMets:e,scale:t,str:n}=i;if(!n)return 0;let s=0;const r=new TextEncoder().encode(n);for(let a=0;a<n.length;a++)s+=t*e.mets[r[a]].xadv;return s}function t7(i){const{fontMets:e,scale:t,str:n}=i;if(!n)return 0;const s=new Set(Array.from(n)),r=new TextEncoder().encode(Array.from(s).join("")),l=Object.values(e.mets).filter((c,h)=>r.includes(h)).reduce((c,h)=>c.lbwh[3]>h.lbwh[3]?c:h).lbwh[3];return t*l}function i7(i,e){const{xy:t,str:n,fontPx:s,canvasWidth:r}=i;let a=i.scale,l=s*a,c=e(l,n);c>r&&(a*=(r-2)/c,l=s*a,c=e(l,n));let h=t[0]-.5*e(l,n);return h=Math.max(h,1),h=Math.min(h,r-c-1),{x:h,y:t[1],scale:a}}function n7(i,e){const{xy:t,str:n,fontPx:s,canvasWidth:r}=i;let a=i.scale,l=s*a,c=e(l,n);c>r&&(a*=(r-2)/c,l=s*a,c=e(l,n));let h=t[0]-.5*e(l,n);h=Math.max(h,1),h=Math.min(h,r-c-1);const d=t[1]-l;return{x:h,y:d,scale:a}}function s7(i,e,t,n,s){const r=t*n,a=s(r,e),l=(i[0]+i[2])*.5-.5*a,c=(i[1]+i[3])*.5-.5*r;return{textX:l,textY:c,rectLTWH:[l-1,c-1,a+2,r+2]}}function r7(i,e){const t=i??e;return t&&t[0]+t[1]+t[2]>.8?[0,0,0,.5]:[1,1,1,.5]}function a7(i){const{fovMM:e,ltwh:t,rulerWidth:n,regionBounds:s}=i;if(t.length<4||e.length<1)return null;const a=100/e[0]*t[2],l=Math.max(Math.round(a*.1),2),c=Math.floor(t[0]+.5*t[2]-.5*a),h=Math.floor(t[1]+t[3]-l)+.5*n,d=Math.max(s.x,c),f=Math.min(s.x+s.w,c+a),p=Math.min(s.y+s.h,h);return f<=d?null:{startXYendXY:[d,p,f,p],pix1cm:l,clipped:d>c||f<c+a}}function o7(i){return i[0]+i[1]+i[2]<.8?[1,1,1,1]:[0,0,0,1]}function l7(i,e){const t=[],n=-.1*(i[0]-i[2]),s=i[1]-Math.floor(.5*e),r=Math.floor(s-.35*n),a=Math.floor(s-.7*n);for(let l=0;l<11;l++){let c=i[0]+l*n;c=Math.max(c,i[0]+.5*e),c=Math.min(c,i[2]-.5*e);const h=[c,s,c,l%5===0?a:r];t.push(h)}return t}function c7(i){const{startXYendXY:e,distance:t}=i,n=e[0],s=e[1],r=e[2],a=e[3],l=n-r,c=s-a;if(l===0&&c===0)return{origin:[r+t,a],terminus:[r+t,a]};const h=Math.sqrt(l*l+c*c),d=t*l/h,f=t*c/h;return{origin:[n+d,s+f],terminus:[r-d,a-f]}}function u7(i,e,t){const n=[],s=i[2]-i[0],r=i[3]-i[1],a=Math.sqrt(s*s+r*r);if(a===0)return n;const c=e*t/2,h=s/a,d=r/a,f=h*c,p=d*c;let g=Math.floor(a/c);a%c&&g++;let y=i[0],x=i[1];for(let b=0;b<g-1;b++)b%2===0&&n.push({startX:y,startY:x,endX:y+f,endY:x+p}),y+=f,x+=p;return n}function h7(i,e,t){let n=e,s=e*t;return s>i&&(n=i/t,s=i),{left:(i-s)/2,top:(e-n)/2,width:s,height:n}}function l4(i,e){const t=e||i.target;if(!t)return;const n=t;if(typeof n.getBoundingClientRect!="function")return;const s=n.getBoundingClientRect();return{x:i.clientX-s.left,y:i.clientY-s.top}}function d7(i,e){const t=e||i.target;return l4(i,t)}function f7(i){const{forceDevicePixelRatio:e}=i;return e===0?window.devicePixelRatio||1:e<0?1:e}function m7(i){const{canvas:e,isResizeCanvas:t,forceDevicePixelRatio:n}=i;if(!t)return{dpr:1,width:e.width,height:e.height,shouldDraw:!0};const s=f7({forceDevicePixelRatio:n});let r,a;const l=e.parentElement;return l&&"width"in l?(r=l.width*s,a=l.height*s):(r=e.offsetWidth*s,a=e.offsetHeight*s),{dpr:s,width:r,height:a,shouldDraw:!0}}function p7(i){return()=>{requestAnimationFrame(()=>{i()})}}function g7(i){return new ResizeObserver(()=>{requestAnimationFrame(()=>{i()})})}function A7(i){return new MutationObserver(i)}function Yb(i){i.style.width="100%",i.style.height="100%",i.style.display="block"}function v7(i,e){return i!==null&&e!==null}function y7(i,e,t){t&&window.removeEventListener("resize",t),i&&i.disconnect(),e&&e.disconnect()}function x7(i){i&&i.abort()}var c4={};Hi(c4,{CENTER_MOUSE_BUTTON:()=>F1,LEFT_MOUSE_BUTTON:()=>Od,RIGHT_MOUSE_BUTTON:()=>P1,calculateMouseDownPosition:()=>pg,calculateMouseMovePosition:()=>h4,calculateWindowingValues:()=>C7,createOffCanvasPosition:()=>f4,createResetButtonState:()=>d4,determineButtonState:()=>b7,getMouseButtonDragMode:()=>u4,getNextAngleState:()=>E7,hasDragMoved:()=>gg,initializeDragState:()=>w7,isAngleMeasurementInProgress:()=>T7,isFunction:()=>m4,isOffCanvas:()=>S7,shouldTrackDrag:()=>M7});var Od=0,F1=1,P1=2;function u4(i){const{button:e,shiftKey:t,ctrlKey:n,mouseConfig:s,dragMode:r,dragModePrimary:a}=i;return e===Od?s?.leftButton?t&&s.leftButton.withShift!==void 0?s.leftButton.withShift:n&&s.leftButton.withCtrl!==void 0?s.leftButton.withCtrl:s.leftButton.primary:n?8:a:e===P1?s?.rightButton!==void 0?s.rightButton:r:e===F1&&s?.centerButton!==void 0?s.centerButton:r}function b7(i){const{button:e,shiftKey:t}=i;return e===Od&&t?{mouseButtonCenterDown:!0}:e===Od?{mouseButtonLeftDown:!0}:e===P1?{mouseButtonRightDown:!0}:e===F1?{mouseButtonCenterDown:!0}:{}}function pg(i){const{x:e,y:t,dpr:n}=i,s=e*n,r=t*n;return{scaledX:s,scaledY:r,mousePos:[s,r]}}function h4(i){const{x:e,y:t,dpr:n,currentMousePos:s}=i,r=e*n,a=t*n,l=(r-s[0])/n,c=(a-s[1])/n;return{scaledX:r,scaledY:a,dx:l,dy:c,mousePos:[r,a]}}function w7(i){const{posX:e,posY:t,pan2Dxyzmm:n,clipPlaneDepthAziElev:s}=i;return{dragStart:[e,t],pan2DxyzmmAtMouseDown:Gs(n),isDragging:!0,dragClipPlaneStartDepthAziElev:[...s]}}function d4(){return{mousedown:!1,mouseButtonLeftDown:!1,mouseButtonCenterDown:!1,mouseButtonRightDown:!1}}function gg(i,e){return i[0]!==e[0]||i[1]!==e[1]}function S7(i){return i[0]<0||i[1]<0}function f4(){return[-1,-1]}function C7(i){const{currentX:e,currentY:t,windowX:n,windowY:s,calMin:r,calMax:a,robustMin:l,robustMax:c,windowRangeMultiplier:h}=i,f=(c-l)*h/100;let p=r,g=a;return t<s?(p=r-f,g=a-f):t>s&&(p=r+f,g=a+f),e>n?(p=p-f,g=g+f):e<n&&(p=p+f,g=g-f),{newCalMin:p,newCalMax:g,newWindowX:e,newWindowY:t}}function E7(i){const{currentState:e,dragMode:t}=i;if(t!==7)return e;switch(e){case"none":return"drawing_first_line";case"drawing_first_line":return"drawing_second_line";case"drawing_second_line":return"complete";case"complete":return"drawing_first_line";default:return"none"}}function T7(i){return i==="drawing_first_line"||i==="drawing_second_line"}function M7(i){return i!==8&&i!==9&&i!==0}function m4(i){return Object.prototype.toString.call(i).indexOf("Function")>-1}function D7(i){const{isDoubleTouch:e,touchConfig:t,dragMode:n,dragModePrimary:s}=i;return e?t?.doubleTouch??n:t?.singleTouch??s}function w0(i){const{touch:e,canvasRect:t}=i;return{x:e.clientX-t.left,y:e.clientY-t.top}}function R7(i){const{currentTime:e,lastTouchTime:t,doubleTouchTimeout:n}=i,s=e-t;return{isDoubleTap:s<n&&s>0,timeSinceTouch:s}}function N7(i){const{currentTime:e,touchCount:t,isTouchdown:n}=i;return{touchdown:!0,currentTouchTime:e,multiTouchGesture:n&&t>=2}}function I7(){return{touchdown:!1,lastTwoTouchDistance:0,multiTouchGesture:!1}}function _7(i){return{doubleTouch:!1,lastTouchTime:i}}function F7(i){return{doubleTouch:!0,lastTouchTime:i}}function P7(i){const{touch1:e,touch2:t,lastTwoTouchDistance:n}=i,s=Math.hypot(e.pageX-t.pageX,e.pageY-t.pageY);let r;n===0?r=0:s<n?r=-.01:r=.01;const a={x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2};return{distance:s,scrollDelta:r,centerPosition:a}}function B7(i,e){return i===2&&e===2}function L7(i){const{touch:e,canvasRect:t}=i;return{x:e.clientX-t.left,y:e.clientY-t.top,pageX:e.pageX,pageY:e.pageY}}function k7(i){const{touchdown:e,multiTouchGesture:t}=i;return e&&!t}function qb(i,e){return i&&e<2}function O7(i){const{touch:e,canvasRect:t}=i;return[e.clientX-t.left,e.clientY-t.top]}function U7(i){const{doubleTouch:e,isDragging:t}=i;return e&&t}function V7(i){return i===null}var j7=[[2,0,0],[0,270,0],[0,90,0],[0,0,0],[0,180,0],[0,0,-90],[0,0,90]];function z7(i){const{code:e,ctrlKey:t,shiftKey:n,sliceType:s}=i,r=s===4;return e==="KeyH"&&r?{action:"render_azimuth_decrease"}:e==="KeyL"&&r?{action:"render_azimuth_increase"}:e==="KeyJ"&&r?{action:"render_elevation_increase"}:e==="KeyK"&&r?{action:"render_elevation_decrease"}:e==="KeyH"&&!r?{action:"crosshair_left"}:e==="KeyL"&&!r?{action:"crosshair_right"}:e==="KeyU"&&!r&&t?{action:"crosshair_forward"}:e==="KeyD"&&!r&&t?{action:"crosshair_backward"}:e==="KeyJ"&&!r?{action:"crosshair_down"}:e==="KeyK"&&!r?{action:"crosshair_up"}:e==="KeyM"&&!r?{action:"cycle_drag_mode"}:e==="ArrowLeft"?{action:"frame_previous"}:e==="ArrowRight"?{action:"frame_next"}:e==="Slash"&&n?{action:"show_version"}:{action:"none"}}function G7(i){const e=i+1;return e>=4?0:e}function H7(i){const{currentTime:e,lastCalledTime:t,debounceTime:n}=i;return e-t>n}function Y7(i){const{currentIndex:e,clipPlanesLength:t}=i,n=t||6;let s;return e==null?s=0:s=(e+1)%n,{newIndex:s,defaultClipPlane:[0,0,0,2],defaultDepthAziElev:[2,0,0]}}function q7(i){const{currentClipPlaneIndex:e}=i,t=(e+1)%7,n=j7[t];return{newIndex:t,depthAziElev:n}}function X7(i){const{currentSliceType:e,totalSliceTypes:t}=i;return(e+1)%t}function S0(i,e){return i===e}function W7(i){const{deltaY:e,invertScrollDirection:t}=i;let n=e<0?-.01:.01;return t&&(n=-n),n}function K7(i){const{dragMode:e,dragStart:t,dragEnd:n}=i;if(e!==6)return!1;const s=t.reduce((a,l)=>a+l,0),r=n.reduce((a,l)=>a+l,0);return s>0&&r>0}function Q7(i){const{dragStart:e,dragEnd:t,delta:n}=i,s=[...e],r=[...t];return e[0]<t[0]?(s[0]=e[0]-n,r[0]=t[0]+n):(s[0]=e[0]+n,r[0]=t[0]-n),e[1]<t[1]?(s[1]=e[1]-n,r[1]=t[1]+n):(s[1]=e[1]+n,r[1]=t[1]-n),{newDragStart:s,newDragEnd:r}}function Z7(i){return i>0?1:-1}function J7(i){const{currentZoom:e,scrollAmount:t}=i,n=t<0?1:-1;let s=e*(1+10*(.01*n));s=Math.round(s*10)/10;const r=e-s;return{newZoom:s,zoomChange:r}}function $7(i){const{currentPan:e,zoomChange:t,crosshairMM:n}=i;return[e[0]+t*n[0],e[1]+t*n[1],e[2]+t*n[2]]}function eO(i){const{currentPercent:e,scrollAmount:t}=i;let n=e;return t<0?(n-=.01,n=Math.max(n,0)):(n+=.01,n=Math.min(n,1)),n}function tO(i){const{thumbnailVisible:e,mosaicStringLength:t,eventInBounds:n,hasBounds:s}=i;return e||t>0?{shouldProcess:!1,showBoundsBorder:!1}:n?{shouldProcess:!0,showBoundsBorder:s}:{shouldProcess:!1,showBoundsBorder:!1}}function iO(i){const{dragMode:e,isInRenderTile:t}=i;return e===3&&!t}function nO(i,e,t){return[i-t.left,e-t.top]}var sO={none:0,contrast:1,measurement:2,angle:7,pan:3,slicer3D:4,callbackOnly:5,roiSelection:6,crosshair:8,windowing:9};function rO(i){if(typeof i=="string"){const e=sO[i];return e!==void 0?e:null}return i}function aO(i){const{activeDragMode:e,fallbackDragMode:t}=i;return e!==null?e:t}function oO(){return{activeDragMode:null,activeDragButton:null}}function lO(i,e){return{activeDragMode:i,activeDragButton:e}}function cO(i){if(i.length>2)throw new Error("array must not contain more than two values");return[Math.floor(Math.min(i[0],i[1])),Math.floor(Math.max(i[0],i[1]))]}function uO(i,e){const t=i[2],n=i[3],s=i[0]-t,r=i[1]-n,a=e[2]-t,l=e[3]-n,c=s*a+r*l,h=Math.sqrt(s*s+r*r),d=Math.sqrt(a*a+l*l);if(h===0||d===0)return 0;const f=Math.max(-1,Math.min(1,c/(h*d)));return Math.acos(f)*(180/Math.PI)}function hO(){return{angleState:"none",angleFirstLine:[0,0,0,0]}}function Xb(i,e,t){return[i*t,e*t]}function dO(i){const{startMM:e,endMM:t,pan2DxyzmmAtMouseDown:n}=i,s=qs();HN(s,t,e);const r=n[3];return{pan2Dxyzmm:[n[0]+r*s[0],n[1]+r*s[1],n[2]+r*s[2],r]}}function fO(i){const{startY:e,endY:t,pan2DxyzmmAtMouseDown:n,currentPan2Dxyzmm:s,crosshairMM:r,yoke3Dto2DZoom:a}=i;let l=n[3];const c=t-e;l+=c*.01,l=Math.max(l,.1),l=Math.min(l,10);const d=s[3]-l,f={zoom:l,pan2Dxyzmm:[s[0]+d*r[0],s[1]+d*r[1],s[2]+d*r[2],l]};return a&&(f.volScaleMultiplier=l),f}function mO(i){const{x:e,y:t,windowX:n,windowY:s,currentCalMin:r,currentCalMax:a,globalMin:l,globalMax:c}=i;let h=r,d=a;return t<s?(h+=1,d+=1):t>s&&(h-=1,d-=1),e>n?(h-=1,d+=1):e<n&&(h+=1,d-=1),d-h<1&&(d=h+1),h<l&&(h=l),d>c&&(d=c),h>d&&(h=d-1),{calMin:h,calMax:d,windowX:e,windowY:t}}function pO(i){const{xrange:e,yrange:t,zrange:n,dims:s,img:r}=i;let a=-Number.MAX_VALUE,l=Number.MAX_VALUE;const c=s[1],h=s[2];for(let d=n[0];d<n[1];d++){const f=d*c*h;for(let p=t[0];p<t[1];p++){const g=p*c;for(let y=e[0];y<e[1];y++){const x=f+g+y;l>r[x]&&(l=r[x]),a<r[x]&&(a=r[x])}}}return{lo:l,hi:a,hasVariation:l<a}}function gO(i,e,t,n,s){const r=[...t],a=[...n],l=[...s];return i[0]-e[0]===0?r[1]=i[0]+1:i[1]-e[1]===0?a[1]=i[1]+1:i[2]-e[2]===0&&(l[1]=i[2]+1),{xrange:r,yrange:a,zrange:l}}function AO(i){return i===7}function Wb(i){return D1.includes(i)?"mesh":i==="NVD"?"document":"volume"}function vO(i){return i.lastIndexOf("BRIK")!==-1?"brik":i.toUpperCase().lastIndexOf("IMG")!==-1?"img":null}function yO(i,e){const t=i.name.lastIndexOf("HEAD");if(t===-1)return null;const n=i.name.substring(0,t);for(const s of Array.from(e)){const r=s.webkitGetAsEntry();if(!r)continue;const a=r.name.lastIndexOf("BRIK");if(a===-1)continue;const l=r.name.substring(0,a);if(n===l)return r}return null}function xO(i,e){const n=i.name.toUpperCase().lastIndexOf("HDR");if(n===-1)return null;const s=i.name.substring(0,n);for(const r of Array.from(e)){const a=r.webkitGetAsEntry();if(!a)continue;const c=a.name.toUpperCase().lastIndexOf("IMG");if(c===-1)continue;const h=a.name.substring(0,c);if(s.toUpperCase()===h.toUpperCase())return a}return null}function bO(i,e){const t=yO(i,e);return t||xO(i,e)}function Kb(i){return new Promise((e,t)=>{i.file(e,t)})}function wO(i){const e=[];for(const t of Array.from(i)){const n=t.webkitGetAsEntry();if(!n){X.warn("could not get entry from dropped item");continue}if(n.isFile){if(vO(n.name))continue;const s=bO(n,i);e.push({entry:n,pairedEntry:s})}}return e}function SO(i){const e=[];for(const t of Array.from(i)){const n=t.webkitGetAsEntry();n?.isDirectory&&e.push(n)}return e}function CO(i){return i.getData("text/uri-list")||null}function EO(i){return i.items.length>0}function B1(i){const{x:e,y:t,screenSlices:n}=i;for(let s=0;s<n.length;s++){const r=n[s].leftTopWidthHeight;if(e>r[0]&&t>r[1]&&e<r[0]+r[2]&&t<r[1]+r[3])return s}return-1}function TO(i){const{x:e,y:t,screenSlices:n}=i,s=B1({x:e,y:t,screenSlices:n});return s>=0&&n[s].axCorSag===4?s:-1}function MO(i){const{x:e,y:t,graph:n,volumesLength:s,firstVolumeFrameCount:r}=i;if(n.opacity<=0||s<1||r<1||!n.plotLTWH||n.plotLTWH[2]<1||n.plotLTWH[3]<1)return!1;const a=[(e-n.LTWH[0])/n.LTWH[2],(t-n.LTWH[1])/n.LTWH[3]];return a[0]>0&&a[1]>0&&a[0]<=1&&a[1]<=1}function DO(i){const{x:e,y:t,dpr:n,canvasHeight:s,boundsRegion:r}=i,[a,l,c,h]=r,d=e*n,f=s-t*n;return d>=a&&d<=a+c&&f>=l&&f<=l+h}function Ud(i){const{sliceType:e,crosshairPos:t}=i;return e===0?t[2]:e===1?t[1]:e===2?t[0]:0}function RO(i){const{dragStart:e,screenSlices:t,crosshairPos:n,currentSliceType:s,canvasPos2frac:r}=i,a=B1({x:e[0],y:e[1],screenSlices:t});if(a>=0&&a<t.length){const c=t[a].axCorSag,h=Ud({sliceType:c,crosshairPos:n});return{sliceIndex:a,sliceType:c,slicePosition:h}}let l=0;return s===0?l=n[2]:s===1?l=n[1]:s===2?l=n[0]:s===3&&r([e[0],e[1]])[0]>=0&&(l=n[2]),{sliceIndex:-1,sliceType:s,slicePosition:l}}function NO(i){const{sliceType:e,slicePosition:t,currentSliceTypeOpt:n,screenSlices:s,crosshairPos:r}=i;if(n===3){if(e>2)return!1;for(let h=0;h<s.length;h++)if(s[h].axCorSag===e){const d=Ud({sliceType:e,crosshairPos:r});if(Math.abs(d-t)<.001)return!0}return!1}if(e!==n)return!1;const a=Ud({sliceType:e,crosshairPos:r});return Math.abs(a-t)<.001}function IO(i){const{posChange:e,volumesLength:t,clipPlaneDepthAziElevs:n,activeClipPlaneIndex:s,volScaleMultiplier:r}=i;if(e===0)return{action:"none"};if(t>0&&n[s][0]<1.8){const l=n[s][0];let c=l;return e>0&&(c=Math.min(1.5,l+.025)),e<0&&(c=Math.max(-1.5,l-.025)),c!==l?{action:"clipPlane",newClipPlaneDepth:c}:{action:"none"}}let a=r;return e>0&&(a=Math.min(2,r*1.1)),e<0&&(a=Math.max(.5,r*.9)),{action:"zoom",newVolScaleMultiplier:a}}function _O(i){const{posChange:e,currentZoom:t,yoke3Dto2DZoom:n,crosshairMM:s}=i;let r=t*(1+10*e);r=Math.round(r*10)/10;const a=t-r;return{newZoom:r,zoomChange:a,panOffsetX:a*s[0],panOffsetY:a*s[1],panOffsetZ:a*s[2],newVolScaleMultiplier:n?r:void 0}}function FO(i){const{x:e,y:t,z:n,currentVox:s,dimsRAS:r}=i,a=kn(s),l=a[2];return a[0]+=e,a[1]+=t,a[2]+=n,a[0]=Math.max(0,Math.min(a[0],r[1]-1)),a[1]=Math.max(0,Math.min(a[1],r[2]-1)),a[2]=Math.max(0,Math.min(a[2],r[3]-1)),{newVox:a,zChanged:l!==a[2]}}function PO(i){const{scrollRequiresFocus:e,canvasHasFocus:t}=i;return!e||t}function BO(i){const{posChange:e,dragMode:t,isInRenderTile:n}=i;return e!==0&&t===3&&!n}function LO(i){const{layout:e}=i;for(let t=0;t<e.length;t++){const[n,s,r,a]=e[t].position,l=n+r,c=s+a;for(let h=t+1;h<e.length;h++){const[d,f,p,g]=e[h].position,y=d+p,x=f+g,b=n<y&&l>d,w=s<x&&c>f;if(b&&w)return{valid:!1,error:`Custom layout is invalid. Tile ${t} overlaps with tile ${h}.`,overlappingTiles:[t,h]}}}return{valid:!0}}function kO(i){const{bounds:e,canvasWidth:t,canvasHeight:n,cssWidth:s,cssHeight:r,dpr:a}=i;if(!e)return[0,0,t,n];const[[l,c],[h,d]]=e,f=Math.floor(l*s*a),p=Math.ceil((h-l)*s*a);let g=Math.floor((1-d)*r*a),y=Math.ceil((d-c)*r*a);return g<0&&(y+=g,g=0),g+y>n&&(y=n-g),[f,g,p,y]}function OO(i){const{bounds:e,rectWidth:t,rectHeight:n}=i;if(!e)return[0,0,t,n];const[[s,r],[a,l]]=e,c=Math.round(s*t),h=Math.round((a-s)*t),d=Math.round(r*n),f=Math.round(l*n),p=f-d,g=n-f;return[c,g,h,p]}function UO(i){const{canvasHeight:e,bounds:t,colorbarHeight:n}=i;let s=e;if(t){const[[,r],[,a]]=t,l=Math.round(r*e);s=Math.round(a*e)-l}return s-n}function VO(i){const{canvasWidth:e,bounds:t,legendPanelWidth:n}=i;let s=e;if(t){const[[r],[a]]=t;s=Math.round((a-r)*e)}return s-n}function jO(i){const{forceVox:e,getScreenFieldOfViewMM:t,getScreenFieldOfViewVox:n,backDims:s}=i;let r=t(0);e&&(r=n(0));const a=Math.max(r[0],Math.max(r[1],r[2])),l=[r[0]/a,r[1]/a,r[2]/a],c=[s[1],s[2],s[3]];return{volScale:l,vox:c,longestAxis:a,dimsMM:r}}function zO(i){const{axCorSag:e,sliceFrac:t,frac2mm:n,swizzleVec3MM:s}=i;let r=2;e===1&&(r=1),e===2&&(r=0);const a=[0,0,0],l=[1,1,0],c=[1,0,1];a[r]=t,l[r]=t,c[r]=t;const h=n(a),d=n(l),f=n(c),p=s(Ae(h[0],h[1],h[2]),e),g=s(Ae(d[0],d[1],d[2]),e),y=s(Ae(f[0],f[1],f[2]),e),x=(g[0]-p[0])*(y[1]-p[1])-(y[0]-p[0])*(g[1]-p[1]);let b=(g[0]-p[0])*(y[2]-p[2])-(y[0]-p[0])*(g[2]-p[2]);b/=x;let w=(g[1]-p[1])*(y[2]-p[2])-(y[1]-p[1])*(g[2]-p[2]);w/=x;const S=[0,0,0,0,0];return S[0]=p[0],S[1]=p[1],S[2]=p[2],S[3]=w,S[4]=b,S}function GO(i){const{labels:e,fontPx:t,textHeight:n}=i;if(e.length===0)return 0;const s=e.length===1?e[0].style.bulletScale??1:e.reduce((c,h)=>(c.style.bulletScale??1)>(h.style.bulletScale??1)?c:h).style.bulletScale??1,r=e.length===1?e[0]:e.reduce((c,h)=>{const d=t*c.style.textScale,f=t*h.style.textScale;return n(d,c.text)>n(f,h.text)?c:h}),a=t*r.style.textScale;let l=n(a,r.text)*s;return l+=a,l}function HO(i){const{labels:e,showLegend:t,fontPx:n,canvasWidth:s,textWidth:r,getBulletMarginWidth:a}=i;if(!t||e.length===0)return 0;const c=n*1;let h=0;const d=e.reduce((y,x)=>{const b=n*y.style.textScale,w=n*x.style.textScale;return r(b,y.text)>r(w,x.text)?y:x}),f=n*d.style.textScale,p=r(f,d.text),g=a();return p&&(h=g+p,h+=c*2),h>=s?0:h}function YO(i){const{labels:e,fontPx:t,panelScale:n,textHeight:s}=i;let r=0;const a=t;for(const l of e){const c=t*l.style.textScale*n,h=s(c,l.text);r+=h}return r&&(r+=a/2*(e.length+1)*n),r}function qO(i){const{fontPx:e,boundsRegion:t,colorbarWidth:n}=i,s=3*e;if(s<0)return{leftTopWidthHeight:[0,0,0,0],colorbarHeight:0};const[r,a,l,c]=t,d=(n>0&&n<=1?n:1)*l;return{leftTopWidthHeight:[r+(l-d)/2,a+c-s,d,s],colorbarHeight:s+1}}function XO(i){const{x:e,y:t,boundsRegion:n}=i,[s,r,a,l]=n;return e>=s&&e<=s+a&&t>=r&&t<=r+l}function WO(i){const{mouseX:e,mouseY:t,boundsRegion:n}=i;if(e<0||t<0)return!1;const[s,r,a,l]=n;return e>=s&&e<=s+a&&t>=r&&t<=r+l}function KO(i){let e=i%360;return e<0&&(e+=360),e}function QO(i){const{currentAzimuth:e,currentElevation:t,deltaX:n,deltaY:s}=i,r=KO(e+n),a=t+s;return{azimuth:r,elevation:a}}function ZO(i){const{dx:e,dy:t,threshold:n=1}=i;return Math.abs(e)>=n||Math.abs(t)>=n}var JO=[0,0,0,2],$O=[2,0,0],eU=1.8;function tU(i){const{depth:e,azimuth:t,elevation:n}=i,s=gf(t+180,n);return[s[0],s[1],s[2],e]}function iU(i){const{depth:e,azimuth:t,elevation:n}=i,s=gf(t,n);return[s[0],s[1],s[2],-e]}function nU(i){const{startDepthAziElev:e,dragDeltaX:t,dragDeltaY:n}=i,s=[e[0],(e[1]-t)%360,e[2]+n],r=s[1]!==e[1]||s[2]!==e[2];return{depthAziElev:s,changed:r}}function sU(i){const{index:e}=i,t=i.clipPlanes?[...i.clipPlanes]:[],n=i.clipPlaneDepthAziElevs?[...i.clipPlaneDepthAziElevs]:[];for(;t.length<=e;)t.push([...JO]);for(;n.length<=e;)n.push([...$O]);return{clipPlanes:t,clipPlaneDepthAziElevs:n}}function rU(i,e=eU){return i<e}function aU(i){const{depthAziElevs:e}=i,t=[],n=[];for(const s of e){const r=iU({depth:s[0],azimuth:s[1],elevation:s[2]});t.push(r),n.push([...s])}return{clipPlanes:t,clipPlaneDepthAziElevs:n}}function oU(i){const{isDragging:e,activeClipPlaneDepth:t,dragStartTileIndex:n}=i;return e&&rU(t)&&n>=0}function lU(i){const{index:e,depthAzimuthElevation:t}=i,{clipPlanes:n,clipPlaneDepthAziElevs:s}=sU({clipPlanes:i.clipPlanes,clipPlaneDepthAziElevs:i.clipPlaneDepthAziElevs,index:e}),r=tU({depth:t[0],azimuth:t[1],elevation:t[2]});return n[e]=r,s[e]=[...t],{clipPlanes:n,clipPlaneDepthAziElevs:s,clipPlane:r}}function cU(i){return!!i&&i.length>0}function uU(i){const e=i.length;let t=0;const n=new Uint8Array(e+Math.ceil(.01*e)),s=new Int8Array(n.buffer);let r=0;for(;t<e;){let a=i[t];t++;let l=1;for(;l<129&&t<e&&i[t]===a;)t++,l++;if(l>1){s[r]=-l+1,r++,n[r]=a,r++;continue}for(;t<e&&!(l>127||t+2<e&&a!==i[t]&&i[t+2]===i[t]&&i[t+1]===i[t]);)a=i[t],t++,l++;n[r]=l-1,r++;for(let c=0;c<l;c++)n[r]=i[t-l+c],r++}return X.debug("PackBits "+e+" -> "+r+" bytes (x"+e/r+")"),n.slice(0,r)}function L1(i,e){const t=new Uint8Array(i.buffer),n=new Int8Array(t.buffer);let s=0;const r=new Uint8Array(e);let a=0;for(;s<t.length;){const l=n[s];if(s++,l<0){const c=n[s];s++;for(let h=0;h<1-l;h++)r[a]=c,a++}else for(let c=0;c<l+1;c++)r[a]=n[s],s++,a++}return r}var hU=({drawUndoBitmaps:i,currentDrawUndoBitmap:e,drawBitmap:t})=>{const n=i.length;if(n<1){X.debug("undo bitmaps not loaded");return}if(e--,e<0&&(e=n-1),e>=n&&(e=0),i[e].length<2){X.debug("drawUndo is misbehaving");return}return t=L1(i[e],t.length),{drawBitmap:t,currentDrawUndoBitmap:e}};function dU(i,e,t){const{dimX:n,dimY:s,dimZ:r}=t;let a;if(i===0)a=r;else if(i===1)a=s;else if(i===2)a=n;else return null;let l=-1,c=-1;for(let h=0;h<a;h++){let d=!1;if(i===0){const f=h*n*s;for(let p=0;p<n*s;p++)if(e[f+p]>0){d=!0;break}}else if(i===1)for(let f=0;f<r;f++){for(let p=0;p<n;p++){const g=p+h*n+f*n*s;if(e[g]>0){d=!0;break}}if(d)break}else if(i===2)for(let f=0;f<r;f++){for(let p=0;p<s;p++){const g=h+p*n+f*n*s;if(e[g]>0){d=!0;break}}if(d)break}d&&(l===-1&&(l=h),c=h)}return l===-1||c===-1?null:{first:l,last:c}}function C0(i,e,t,n){const{dimX:s,dimY:r,dimZ:a}=n;let l;if(e===0){l=new Float32Array(s*r);const c=i*s*r;for(let h=0;h<s*r;h++)l[h]=t[c+h]}else if(e===1){l=new Float32Array(s*a);for(let c=0;c<a;c++)for(let h=0;h<s;h++){const d=h+i*s+c*s*r,f=h+c*s;l[f]=t[d]}}else if(e===2){l=new Float32Array(r*a);for(let c=0;c<a;c++)for(let h=0;h<r;h++){const d=i+h*s+c*s*r,f=h+c*r;l[f]=t[d]}}else throw new Error("Invalid slice type");return l}function E0(i,e,t,n,s){const{dimX:r,dimY:a,dimZ:l}=n;let c;if(e===0){c=new Float32Array(r*a);const h=i*r*a;for(let d=0;d<r*a;d++)c[d]=t[h+d]/s}else if(e===1){c=new Float32Array(r*l);for(let h=0;h<l;h++)for(let d=0;d<r;d++){const f=d+i*r+h*r*a,p=d+h*r;c[p]=t[f]/s}}else if(e===2){c=new Float32Array(a*l);for(let h=0;h<l;h++)for(let d=0;d<a;d++){const f=i+d*r+h*r*a,p=d+h*a;c[p]=t[f]/s}}else throw new Error("Invalid slice type");return c}function fU(i,e,t,n,s,r,a){const{dimX:l,dimY:c,dimZ:h}=s;if(t===0){const d=e*l*c;for(let f=0;f<i.length;f++)i[f]>=r&&(n[d+f]=a)}else if(t===1)for(let d=0;d<h;d++)for(let f=0;f<l;f++){const p=f+d*l,g=f+e*l+d*l*c;i[p]>=r&&(n[g]=a)}else if(t===2)for(let d=0;d<h;d++)for(let f=0;f<c;f++){const p=f+d*c,g=e+f*l+d*l*c;i[p]>=r&&(n[g]=a)}else throw new Error("Invalid slice type")}function Qb(i,e,t){if(e<3||t<3)return;const n=new Float32Array(i.length);for(let s=0;s<t;s++)for(let r=0;r<e;r++){const a=r+s*e;r===0||r===e-1?n[a]=i[a]:n[a]=(i[a-1]+2*i[a]+i[a+1])*.25}for(let s=0;s<t;s++)for(let r=0;r<e;r++){const a=r+s*e;s===0||s===t-1?i[a]=n[a]:i[a]=(n[a-e]+2*n[a]+n[a+e])*.25}}function mU(i,e,t,n){const s=Math.abs(t-i),r=Math.abs(t-e),a=Math.exp(-s*s/(2*n*n)),l=Math.exp(-r*r/(2*n*n)),c=a+l;return c<1e-6?.5:a/c}function pU(i,e,t,n,s,r){const a=(t-n)/(s-n),l=1-a;for(let c=0;c<i.length;c++)r[c]=i[c]*l+e[c]*a}function gU(i,e,t,n,s,r,a,l,c,h){const d=(t-n)/(s-n),f=1-d;for(let p=0;p<i.length;p++)if(i[p]>0||e[p]>0){const g=mU(l[p],c[p],h[p],a.intensitySigma),y=a.intensityWeight,x=y*g+(1-y)*f,b=1-x;r[p]=i[p]*x+e[p]*b}else r[p]=i[p]*f+e[p]*d}function AU(i,e,t,n,s,r,a,l){const{dimX:c,dimY:h,dimZ:d}=e,f=a.sliceType??0;let p,g,y;if(f===0)p=c,g=h,y=d-1;else if(f===1)p=c,g=d,y=h-1;else if(f===2)p=h,g=d,y=c-1;else throw new Error("Invalid slice type. Must be AXIAL, CORONAL, or SAGITTAL");const x={intensityWeight:a.intensityWeight??.7,binaryThreshold:a.binaryThreshold??.375,intensitySigma:a.intensitySigma??.1,applySmoothingToSlices:a.applySmoothingToSlices??!0,useIntensityGuided:a.useIntensityGuided??!0};if(s!==void 0&&r!==void 0){if(s>=r)throw new Error("Low slice index must be less than high slice index");if(s<0||r>y)throw new Error(`Slice indices out of bounds [0, ${y}]`)}const b=new Map;for(let w=0;w<=y;w++){const S=C0(w,f,i,e);for(let C=0;C<S.length;C++){const E=S[C];if(E>0)if(!b.has(E))b.set(E,{min:w,max:w});else{const D=b.get(E);D.min=Math.min(D.min,w),D.max=Math.max(D.max,w)}}}for(const[w,S]of b){const C=s!==void 0?Math.max(s,S.min):S.min,E=r!==void 0?Math.min(r,S.max):S.max;if(C>=E||E-C<2)continue;const D=C0(C,f,i,e),M=C0(E,f,i,e),N=new Float32Array(D.length),I=new Float32Array(M.length);for(let _=0;_<D.length;_++)N[_]=D[_]===w?1:0,I[_]=M[_]===w?1:0;x.applySmoothingToSlices&&(Qb(N,p,g),Qb(I,p,g));for(let _=C+1;_<E;_++){const F=new Float32Array(p*g);if(x.useIntensityGuided&&t){const B=E0(C,f,t,e,n),P=E0(E,f,t,e,n),O=E0(_,f,t,e,n);gU(N,I,_,C,E,F,x,B,P,O)}else pU(N,I,_,C,E,F);fU(F,_,f,i,e,x.binaryThreshold,w)}}l()}function vU(i,e){const t=[...i],n=e;if(!t||t.length<1)return{drawUndoBitmaps:t,currentDrawUndoBitmap:n};for(let s=t.length-1;s>=0;s--)t[s]=new Uint8Array;return{drawUndoBitmaps:t,currentDrawUndoBitmap:n}}function yU(i){const{drawBitmap:e,drawUndoBitmaps:t,currentDrawUndoBitmap:n,maxDrawUndoBitmaps:s,drawFillOverwrites:r}=i;if(!e||e.length<1)return X.debug("addUndoBitmap error: No drawing open"),{drawBitmap:e,drawUndoBitmaps:t,currentDrawUndoBitmap:n,needsRefresh:!1};const a=[...t];let l=e,c=!1;if(!r&&a.length>0){const d=e.length,f=L1(a[n],d);l=new Uint8Array(e);for(let p=0;p<d;p++)f[p]>0&&(l[p]=f[p]);c=!0}let h=n+1;return h>=s&&(h=0),a[h]=uU(l),{drawBitmap:l,drawUndoBitmaps:a,currentDrawUndoBitmap:h,needsRefresh:c}}function T0(i,e,t){const n=new Array(i);if(t)for(let s=0;s<i;s++)n[s]=(i-1-s)*e;else for(let s=0;s<i;s++)n[s]=s*e;return n}function xU(i){const{permRAS:e,dims:t}=i,n=[0,0,0];for(let d=0;d<3;d++)for(let f=0;f<3;f++)Math.abs(e[d])-1===f&&(n[f]=d*Math.sign(e[d]));let s=1;const r=[1,1,1],a=[!1,!1,!1];for(let d=0;d<n.length;d++)for(let f=0;f<n.length;f++)Math.abs(n[f])===d&&(r[f]=s,(n[f]<0||Object.is(n[f],-0))&&(a[f]=!0),s*=t[f+1]);const l=T0(t[1],r[0],a[0]),c=T0(t[2],r[1],a[1]),h=T0(t[3],r[2],a[2]);return{instride:r,inflip:a,xlut:l,ylut:c,zlut:h}}function bU(i){const{inputData:e,dims:t,xlut:n,ylut:s,zlut:r}=i,a=t[1]*t[2]*t[3],l=new Uint8Array(a);let c=0;for(let h=0;h<t[3];h++)for(let d=0;d<t[2];d++)for(let f=0;f<t[1];f++)l[n[f]+s[d]+r[h]]=e[c],c++;return l}function wU(i){const{drawingDims:e,backgroundDims:t}=i;return e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function M0(i){return!i||i.length<4?0:i[1]*i[2]*i[3]}function D0(i){return new Uint8Array(i)}function SU(i){let{useClickToSegmentBitmap:e,drawingEnabled:t,clickToSegment:n,drawBitmap:s,clickToSegmentGrowingBitmap:r}=i,a=null;e&&(!t||!n)&&(X.debug("determineBitmapDataSource: Conditions not met for clickToSegment bitmap, using drawBitmap."),e=!1);const l=e?r:s;return!l&&!e&&r?a="drawBitmap is null, but clickToSegmentGrowingBitmap exists. Check state.":!l&&e&&s?(a="clickToSegmentGrowingBitmap is null, falling back to drawBitmap.",e=!1):l||(a="Both bitmaps are null. Uploading empty data."),{bitmapDataSource:e?r:s,useClickToSegmentBitmap:e,warning:a}}function CU(i){const{clickToSegmentIsGrowing:e,drawShapePreviewBitmap:t,drawBitmap:n}=i;let s=n,r=!1;return e&&(r=!0),t&&(s=t),{clickToSegmentIsGrowing:!1,drawPenLocation:[NaN,NaN,NaN],drawPenAxCorSag:-1,drawPenFillPts:[],drawShapeStartLocation:[NaN,NaN,NaN],drawShapePreviewBitmap:null,drawBitmap:s,needsRefresh:r}}function EU(i,e){return i===8?[e[0],2,2,2,...e.slice(4)]:e}function TU(i,e){return i===8?!0:i===e}function Zb(i,e,t,n,s){return i+e*n+t*n*s}function Os(i,e){return Math.min(Math.max(i,0),e-1)}function Io(i){const{x:e,y:t,z:n,penValue:s,drawBitmap:r,dims:a,penSize:l,penAxCorSag:c}=i,h=a[1],d=a[2],f=a[3],p=Os(e,h),g=Os(t,d),y=Os(n,f);if(r[Zb(p,g,y,h,d)]=s,l>1){const x=Math.floor(l/2),b=c===0,w=c===1,S=c===2;for(let C=-x;C<=x;C++)for(let E=-x;E<=x;E++){let D,M,N;if(b)D=Os(p+C,h),M=Os(g+E,d),N=y;else if(w)D=Os(p+C,h),M=g,N=Os(y+E,f);else if(S)D=p,M=Os(g+E,d),N=Os(y+C,f);else continue;r[Zb(D,M,N,h,d)]=s}}}function MU(i){const{ptA:e,ptB:t,penValue:n,drawBitmap:s,dims:r,penSize:a,penAxCorSag:l}=i,c=Math.abs(e[0]-t[0]),h=Math.abs(e[1]-t[1]),d=Math.abs(e[2]-t[2]),f=t[0]>e[0]?1:-1,p=t[1]>e[1]?1:-1,g=t[2]>e[2]?1:-1;let y=e[0],x=e[1],b=e[2];const w=t[0],S=t[1],C=t[2],E={x:0,y:0,z:0,penValue:n,drawBitmap:s,dims:r,penSize:a,penAxCorSag:l};if(c>=h&&c>=d){let D=2*h-c,M=2*d-c;for(;y!==w;)y+=f,D>=0&&(x+=p,D-=2*c),M>=0&&(b+=g,M-=2*c),D+=2*h,M+=2*d,E.x=y,E.y=x,E.z=b,Io(E)}else if(h>=c&&h>=d){let D=2*c-h,M=2*d-h;for(;x!==S;)x+=p,D>=0&&(y+=f,D-=2*h),M>=0&&(b+=g,M-=2*h),D+=2*c,M+=2*d,E.x=y,E.y=x,E.z=b,Io(E)}else{let D=2*h-d,M=2*c-d;for(;b!==C;)b+=g,D>=0&&(x+=p,D-=2*d),M>=0&&(y+=f,M-=2*d),D+=2*h,M+=2*c,E.x=y,E.y=x,E.z=b,Io(E)}}function p4(i){const{img2D:e,dims2D:t,minPt:n,maxPt:s}=i,r=t[0],[a,l]=n,[c,h]=s,d=4*(c-a+h-l+2),f=new Int32Array(d*2);let p=0,g=0;function y(w,S){if(w<a||w>c||S<l||S>h)return;const C=w+S*r;e[C]===0&&(e[C]=2,f[g]=w,f[g+1]=S,g=(g+2)%f.length)}function x(){if(p===g)return null;const w=f[p],S=f[p+1];return p=(p+2)%f.length,[w,S]}for(let w=a;w<=c;w++)y(w,l),y(w,h);for(let w=l+1;w<=h-1;w++)y(a,w),y(c,w);let b;for(;(b=x())!==null;){const[w,S]=b;y(w-1,S),y(w+1,S),y(w,S-1),y(w,S+1)}}function Jb(i,e,t,n,s){const r=Math.abs(t[0]-n[0]),a=Math.abs(t[1]-n[1]);i[t[0]+t[1]*e[0]]=s,i[n[0]+n[1]*e[0]]=s;const l=n[0]>t[0]?1:-1,c=n[1]>t[1]?1:-1;let h=t[0],d=t[1];const f=n[0],p=n[1];if(r>=a){let g=2*a-r;for(;h!==f;)h+=l,g>=0&&(d+=c,g-=2*r),g+=2*a,i[h+d*e[0]]=s}else{let g=2*r-a;for(;d!==p;)d+=c,g>=0&&(h+=l,g-=2*a),g+=2*r,i[h+d*e[0]]=s}}function $b(i,e){const t=Math.min(Math.max(i[0],0),e[0]-1),n=Math.min(Math.max(i[1],0),e[1]-1);return[t,n]}function DU(i){let e=0,t=1;return i===1?t=2:i===2&&(e=1,t=2),[e,t]}function RU(i){const{penFillPts:e,penAxCorSag:t,drawBitmap:n,dims:s,penValue:r,fillOverwrites:a,currentUndoBitmap:l}=i,c=e.length;if(c<2)return{drawBitmap:n,success:!1};const[h,d]=DU(t),f=[s[h+1],s[d+1]],p=new Uint8Array(f[0]*f[1]),g=1,y=$b([e[0][h],e[0][d]],f);let x=[...y],b=[...y],w=y;for(let M=1;M<c;M++){let N=[e[M][h],e[M][d]];N=$b(N,f),x=[Math.min(N[0],x[0]),Math.min(N[1],x[1])],b=[Math.max(N[0],b[0]),Math.max(N[1],b[1])],Jb(p,f,w,N,g),w=N}Jb(p,f,y,w,g);const S=1;x[0]=Math.max(0,x[0]-S),x[1]=Math.max(0,x[1]-S),b[0]=Math.min(f[0]-1,b[0]+S),b[1]=Math.min(f[1]-1,b[1]+S);for(let M=0;M<f[1];M++)for(let N=0;N<f[0];N++){if(N>=x[0]&&N<b[0]&&M>=x[1]&&M<=b[1])continue;const I=N+M*f[0];p[I]===0&&(p[I]=2)}const C=Date.now();p4({img2D:p,dims2D:f,minPt:x,maxPt:b}),X.debug(`FloodFill ${Date.now()-C}`);const E=e[0][3-(h+d)],D=new Uint8Array(n);if(t===0){const M=E*f[0]*f[1];for(let N=0;N<f[0]*f[1];N++)p[N]!==2&&(D[N+M]=r)}else{let M=1;const N=s[1]*s[2];let I=E*s[1];t===2&&(M=s[1],I=E);let _=0;for(let F=0;F<f[1];F++)for(let B=0;B<f[0];B++)p[_]!==2&&(D[B*M+F*N+I]=r),_++}if(!a&&l&&l.length>0){const M=D.length,N=L1(l,M);for(let I=0;I<M;I++)N[I]!==0&&(D[I]=N[I])}return{drawBitmap:D,success:!0}}function g4(i){const{ptA:e,ptB:t,dims:n}=i,s=n[1],r=n[2],a=n[3],l=Math.min(Math.max(Math.min(e[0],t[0]),0),s-1),c=Math.min(Math.max(Math.min(e[1],t[1]),0),r-1),h=Math.min(Math.max(Math.min(e[2],t[2]),0),a-1),d=Math.min(Math.max(Math.max(e[0],t[0]),0),s-1),f=Math.min(Math.max(Math.max(e[1],t[1]),0),r-1),p=Math.min(Math.max(Math.max(e[2],t[2]),0),a-1);return{x1:l,y1:c,z1:h,x2:d,y2:f,z2:p}}function NU(i){const{x1:e,y1:t,z1:n,x2:s,y2:r,z2:a}=i,l=(e+s)/2,c=(t+r)/2,h=(n+a)/2,d=Math.abs(s-e)/2,f=Math.abs(r-t)/2,p=Math.abs(a-n)/2;return{centerX:l,centerY:c,centerZ:h,radiusX:d,radiusY:f,radiusZ:p}}function IU(i,e,t,n){const{centerX:s,centerY:r,centerZ:a,radiusX:l,radiusY:c,radiusZ:h}=n,d=(i-s)/(l+.5),f=(e-r)/(c+.5),p=(t-a)/(h+.5);return d*d+f*f+p*p<=1}function _U(i){const{ptA:e,ptB:t,penValue:n,drawBitmap:s,dims:r,penSize:a,penAxCorSag:l}=i,c=g4({ptA:e,ptB:t,dims:r}),{x1:h,y1:d,z1:f,x2:p,y2:g,z2:y}=c,x={x:0,y:0,z:0,penValue:n,drawBitmap:s,dims:r,penSize:a,penAxCorSag:l};for(let b=f;b<=y;b++)for(let w=d;w<=g;w++)for(let S=h;S<=p;S++)x.x=S,x.y=w,x.z=b,Io(x)}function FU(i){const{ptA:e,ptB:t,penValue:n,drawBitmap:s,dims:r,penSize:a,penAxCorSag:l}=i,c=g4({ptA:e,ptB:t,dims:r}),{x1:h,y1:d,z1:f,x2:p,y2:g,z2:y}=c,x=NU(c),b={x:0,y:0,z:0,penValue:n,drawBitmap:s,dims:r,penSize:a,penAxCorSag:l};for(let w=f;w<=y;w++)for(let S=d;S<=g;S++)for(let C=h;C<=p;C++)IU(C,S,w,x)&&(b.x=C,b.y=S,b.z=w,Io(b))}function PU(i,e,t){return i[0]+i[1]*e+i[2]*t}function BU(i,e,t){const n=Math.floor(i/t),s=Math.floor((i-n*t)/e);return[Math.floor(i%e),s,n]}function A4(i){const e=i[0],t=e*i[1],n=t*i[2];return{xyz2vx:s=>PU(s,e,t),vx2xyz:s=>BU(s,e,t),nx:e,nxy:t,nxyz:n}}function LU(i,e){return i?e===0?2:e===1?1:e===2?0:-1:-1}var R0={face:[[0,0,-1],[0,0,1],[0,-1,0],[0,1,0],[-1,0,0],[1,0,0]],edge:[[-1,-1,0],[1,-1,0],[-1,1,0],[1,1,0],[0,-1,-1],[0,1,-1],[-1,0,-1],[1,0,-1],[0,-1,1],[0,1,1],[-1,0,1],[1,0,1]],corner:[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]]};function kU(i){const{img:e,seedVx:t,dims:n,neighbors:s=6}=i,r=A4(n),a=[];a.push(t),e[t]=2;const l=[...R0.face];for(s>=18&&l.push(...R0.edge),s>=26&&l.push(...R0.corner);a.length>0;){const c=a.shift(),h=r.vx2xyz(c);for(const d of l){const f=[h[0]+d[0],h[1]+d[1],h[2]+d[2]];if(f[0]<0||f[1]<0||f[2]<0||f[0]>=n[0]||f[1]>=n[1]||f[2]>=n[2])continue;const p=r.xyz2vx(f);e[p]===1&&(e[p]=2,a.push(p))}}}function OU(i){const{voxelIntensity:e,thresholdPercent:t,calMin:n,calMax:s,autoIntensity:r,currentIntensityMin:a,currentIntensityMax:l,currentBright:c}=i;let h=a,d=l,f=c;if(r){if(t!==0){const p=e===0?.01:e;d=p*(1+t),h=p*(1-t)}f=e>(n+s)*.5}return{intensityMin:h,intensityMax:d,isBright:f}}function UU(i){return i?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY}function VU(i){const{sourceBitmap:e,targetBitmap:t}=i;if(!e||!t||e.length!==t.length)return!1;const n=t.length;for(let s=0;s<n;s++)t[s]=e[s];return!0}function jU(i){let e=0;for(let t=0;t<i.length;t++)e+=i[t];return e}function zU(i){const{clusterImg:e,backImg:t,nxyz:n,fallbackIntensity:s}=i;let r=0,a=0;for(let l=0;l<n;l++)e[l]===2&&(r+=t[l],a++);return a>0?r/a:s}function ew(i,e,t,n){return isFinite(t)&&isFinite(n)?[t,n]:i===Number.POSITIVE_INFINITY?[e,1/0]:i===Number.NEGATIVE_INFINITY?[-1/0,e]:[-1/0,1/0]}function GU(i,e){return!(i[0]<0||i[1]<0||i[2]<0||i[0]>=e[0]||i[1]>=e[1]||i[2]>=e[2])}function HU(i){return i!==0}function YU(i,e,t,n){return t&&n!==0?i!==0:i!==0||e===0}function qU(i){const{img:e,targetBitmap:t,originalBitmap:n,newColor:s,nxyz:r,isPreviewMode:a}=i;let l=0;for(let c=0;c<r;c++)e[c]===2?(t[c]=s,l++):a&&(t[c]=n[c]);return l}function XU(i){const{img:e,dims:t}=i,n=t[1]*t[2]*t[3],s=new Uint8Array(n);for(let r=0;r<n;r++)e[r]!==0&&(s[r]=1);return{img:s,datatypeCode:2,cal_min:0,cal_max:1}}function WU(i){const{img:e,cal_min:t,cal_max:n,scl_inter:s,scl_slope:r,mlevel:a=2}=i,l=e.length;if(l<1)return[];const c=256,h=c-1,d=new Array(c).fill(0),f=t,p=n;if(p<=f)return[];const g=(p-f)/c;function y(E){return E*g+f}const x=(c-1)/Math.abs(p-f);for(let E=0;E<l;E++){let D=e[E]*r+s;D=Math.min(Math.max(D,f),p),D=Math.round((D-f)*x),d[D]++}const b=Array(c).fill(0).map(()=>Array(c).fill(0)),w=Array(c).fill(0).map(()=>Array(c).fill(0));for(let E=1;E<c;++E)b[E][E]=d[E],w[E][E]=E*d[E];for(let E=1;E<c-1;++E)b[1][E+1]=b[1][E]+d[E+1],w[1][E+1]=w[1][E]+(E+1)*d[E+1];for(let E=2;E<c;E++)for(let D=E+1;D<c;D++)b[E][D]=b[1][D]-b[1][E-1],w[E][D]=w[1][D]-w[1][E-1];for(let E=1;E<c;++E)for(let D=E+1;D<c;D++)b[E][D]!==0&&(b[E][D]=w[E][D]*w[E][D]/b[E][D]);let S=0;const C=[1/0,1/0,1/0];if(a>3)for(let E=0;E<c-3;E++)for(let D=E+1;D<c-2;D++)for(let M=D+1;M<c-1;M++){const N=b[0][E]+b[E+1][D]+b[D+1][M]+b[M+1][h];N>S&&(C[0]=E,C[1]=D,C[2]=M,S=N)}else if(a===3)for(let E=0;E<c-2;E++)for(let D=E+1;D<c-1;D++){const M=b[0][E]+b[E+1][D]+b[D+1][h];M>S&&(C[0]=E,C[1]=D,S=M)}else for(let E=0;E<c-1;E++){const D=b[0][E]+b[E+1][h];D>S&&(C[0]=E,S=D)}return[y(C[0]),y(C[1]),y(C[2])]}function KU(i){const{img:e,drawBitmap:t,thresholds:n}=i,s=e.length,r=new Uint8Array(t);for(let a=0;a<s;a++){if(r[a]!==0)continue;const l=e[a];l>n[0]&&(r[a]=1),l>n[1]&&(r[a]=2),l>n[2]&&(r[a]=3)}return r}function QU(i){const{level:e}=i;return e===5||e===1?4:e===4||e===2?3:2}function ZU(i){const{level:e,thresholds:t}=i;return e===1?t[2]:e===2?t[1]:t[0]}function JU(i){const{img:e,scl_inter:t,scl_slope:n,global_min:s,threshold:r}=i,a=e.length;for(let l=0;l<a;l++)e[l]*n+t<r&&(e[l]=s)}function gi(i,e,t,n){return t*n[0]*n[1]+e*n[0]+i}function k1(i,e,t){let n=0;const s=new Uint32Array(t+5).fill(0);let a=2147483647;for(let l=0;l<t;l++){let c=e[l];for(n=0;i[c-1]!==c;)if(c=i[c-1],n++,n>100){X.info(`
Ooh no!!`);break}s[l]=c,a=Math.min(a,c)}for(let l=0;l<t;l++)i[s[l]-1]=a}function v4(i,e,t,n,s,r,a,l){const c=new Uint32Array(27);let h=0;if(!s)return 0;const d=i[gi(t,n,s,r)];if(a>=6){const f=gi(t,n,s-1,r);d===i[f]&&(c[h++]=e[f])}if(a>=18){if(t){const f=gi(t-1,n,s-1,r);d===i[f]&&(c[h++]=e[f])}if(n){const f=gi(t,n-1,s-1,r);d===i[f]&&(c[h++]=e[f])}if(t<r[0]-1){const f=gi(t+1,n,s-1,r);d===i[f]&&(c[h++]=e[f])}if(n<r[1]-1){const f=gi(t,n+1,s-1,r);d===i[f]&&(c[h++]=e[f])}}if(a===26){if(t&&n){const f=gi(t-1,n-1,s-1,r);d===i[f]&&(c[h++]=e[f])}if(t<r[0]-1&&n){const f=gi(t+1,n-1,s-1,r);d===i[f]&&(c[h++]=e[f])}if(t&&n<r[1]-1){const f=gi(t-1,n+1,s-1,r);d===i[f]&&(c[h++]=e[f])}if(t<r[0]-1&&n<r[1]-1){const f=gi(t+1,n+1,s-1,r);d===i[f]&&(c[h++]=e[f])}}return h?(k1(l,c,h),c[0]):0}function y4(i,e,t){let n=1;const s=8192;let r=s,a=new Uint32Array(r).fill(0);const l=new Uint32Array(e[0]*e[1]*e[2]).fill(0),c=new Uint32Array(27);for(let h=0;h<e[2];h++)for(let d=0;d<e[1];d++)for(let f=0;f<e[0];f++){let p=0;const g=i[gi(f,d,h,e)];if(g!==0){if(c[0]=v4(i,l,f,d,h,e,t,a),c[0]&&(p+=1),t>=6){if(f){const y=gi(f-1,d,h,e);g===i[y]&&(c[p++]=l[y])}if(d){const y=gi(f,d-1,h,e);g===i[y]&&(c[p++]=l[y])}}if(t>=18){if(d&&f){const y=gi(f-1,d-1,h,e);g===i[y]&&(c[p++]=l[y])}if(d&&f<e[0]-1){const y=gi(f+1,d-1,h,e);g===i[y]&&(c[p++]=l[y])}}if(p)l[gi(f,d,h,e)]=c[0],k1(a,c,p);else{if(l[gi(f,d,h,e)]=n,n>=r){r+=s;const y=new Uint32Array(r);y.set(a),a=y}a[n-1]=n,n++}}}for(let h=0;h<n-1;h++){let d=h;for(;a[d]!==d+1;)d=a[d]-1;a[h]=d+1}return{labelCount:n-1,translationTable:a,initialLabels:l}}function x4(i,e,t,n){const s=e[0]*e[1]*e[2];let r=0;const a=new Uint32Array(s).fill(0);for(let h=0;h<n;h++)r=Math.max(r,t[h]);const l=new Uint32Array(r).fill(0);let c=0;for(let h=0;h<s;h++)i[h]&&(l[t[i[h]-1]-1]||(c+=1,l[t[i[h]-1]-1]=c),a[h]=l[t[i[h]-1]-1]);return{clusterCount:c,labels:a}}function b4(i,e,t){const n=i.length,s=new Uint32Array(e+1).fill(0),r=new Uint32Array(e+1).fill(0);for(let c=0;c<n;c++){const h=i[c],d=t[c];s[d]=h,r[d]++}let a=0;for(let c=0;c<e+1;c++){const h=s[c];a=Math.max(a,h);for(let d=0;d<e+1;d++)d!==c&&h===s[d]&&(r[c]<r[d]||r[c]===r[d]&&c<d)&&(s[c]=0)}const l=new Uint32Array(n).fill(0);for(let c=0;c<n;c++)l[c]=s[t[c]];return{maxValue:a,voxels:l}}function $U(i){const{img:e,dim:t,conn:n=26,binarize:s=!1,onlyLargestClusterPerClass:r=!1}=i,a=Date.now(),l=t[0]*t[1]*t[2],c=new Uint32Array(l).fill(0);if(![6,18,26].includes(n))return X.info("bwlabel: conn must be 6, 18 or 26."),{clusterCount:0,labels:c};if(t[0]<2||t[1]<2||t[2]<1)return X.info("bwlabel: img must be 2 or 3-dimensional"),{clusterCount:0,labels:c};if(s)for(let y=0;y<l;y++)e[y]!==0&&(c[y]=1);else c.set(e);let{labelCount:h,translationTable:d,initialLabels:f}=y4(c,t,n);d===void 0&&(d=new Uint32Array);const{clusterCount:p,labels:g}=x4(f,t,d,h);if(X.info(n+" neighbor clustering into "+p+" regions in "+(Date.now()-a)+"ms"),r){const{maxValue:y,voxels:x}=b4(c,p,g);return{clusterCount:y,labels:x}}return{clusterCount:p,labels:g}}function eV(i,e=0,t=255,n,s){const r=i.length,a=new Uint8Array(r);for(let l=0;l<r;l++){let c=i[l];c=e+s*(c-n),c=Math.max(c,e),c=Math.min(c,t),a[l]=c}return a}function tV(i,e=0,t=1,n,s){const r=i.length,a=new Float32Array(r);for(let l=0;l<r;l++){let c=i[l];c=e+s*(c-n),c=Math.max(c,e),c=Math.min(c,t),a[l]=c}return a}function tw(i){const{img:e,dims:t,global_min:n,global_max:s,datatypeCode:r,scl_slope:a,scl_inter:l,cal_min:c,cal_max:h,dst_min:d=0,dst_max:f=255,f_low:p=0,f_high:g=.999}=i;let y=n,x=s;if(r===2)return[y,1];if((!isFinite(p)||!isFinite(g))&&isFinite(c)&&isFinite(h)&&h>c){y=c,x=h;const B=(f-d)/(x-y);return X.info(" Robust Rescale:  min: "+y+"  max: "+x+" scale: "+B),[y,B]}const b=t[1]*t[2]*t[3];let w=e;if(a!==1||l!==0){const B=new Float32Array(b);for(let P=0;P<b;P++)B[P]=e[P]*a+l;w=B}if(y<0&&X.warn("WARNING: Input image has value(s) below 0.0 !"),X.info(" Input:    min: "+y+"  max: "+x),p===0&&g===1)return[y,1];let S=0;for(let B=0;B<b;B++)Math.abs(w[B])>=1e-15&&S++;const C=1e3,E=(x-y)/C,D=new Array(C).fill(0);for(let B=0;B<b;B++){const P=w[B];let O=Math.floor((P-y)/E);O=Math.min(O,C-1),D[O]++}const M=new Array(C).fill(0);M[0]=D[0];for(let B=1;B<C;B++)M[B]=M[B-1]+D[B];let N=Math.floor(p*b),I=0;for(;I<C&&!(M[I]>=N);)I++;const _=y;for(y=I*E+_,N=b-Math.floor((1-g)*S),I=0;I<C-1&&!(M[I+1]>=N);)I++;x=I*E+_;let F=1;return y!==x&&(F=(f-d)/(x-y)),X.info(" Rescale:  min: "+y+"  max: "+x+" scale: "+F),[y,F]}function iV(i){const{inDims:e,inAffine:t,outDim:n=256,outMM:s=1,toRAS:r=!1}=i,a=t.flat(),l=Vn(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]),c=Lt(e[1]/2,e[2]/2,e[3]/2,1),h=qs(),d=it();sn(d,l),Pi(h,c,d);const f=Ae(h[0],h[1],h[2]),p=Ae(s,s,s);let g=Vn(-1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1);r&&(g=Vn(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),sn(g,g);const y=Lt(n,n,n,1),x=it();e3(x,g,p);const b=Lt(y[0],y[1],y[2],1);Pi(b,b,x),GN(b,b,.5);const w=bt();It(w,f,Ae(b[0],b[1],b[2]));const S=it();sn(S,x),S[3]=w[0],S[7]=w[1],S[11]=w[2];const C=it();rn(C,S);const E=it();t3(E,l,C);const D=it();return rn(D,E),{outAffine:S,vox2vox:E,invVox2vox:D}}function nV(i){const{inImg:e,inDims:t,outDim:n,invVox2vox:s,isLinear:r}=i,a=n*n*n,l=new Float32Array(a),c=t[1],h=t[2],d=t[3],f=c*h;function p(w,S,C){return w+S*c+C*f}const g=s[0],y=s[4],x=s[8];let b=-1;if(r)for(let w=0;w<n;w++)for(let S=0;S<n;S++){const C=S*s[1]+w*s[2]+s[3],E=S*s[5]+w*s[6]+s[7],D=S*s[9]+w*s[10]+s[11];for(let M=0;M<n;M++){const N=M*g+C,I=M*y+E,_=M*x+D,F=Math.floor(N),B=Math.floor(I),P=Math.floor(_);if(b++,F<0||B<0||P<0)continue;const O=Math.ceil(N),k=Math.ceil(I),q=Math.ceil(_);if(O>=c||k>=h||q>=d)continue;const U=N-F,H=I-B,Y=_-P,Q=1-U,te=1-H,j=1-Y,W=p(F,B,P);let K=0;K+=e[W]*Q*te*j,K+=e[W+f]*Q*te*Y,K+=e[W+c]*Q*H*j,K+=e[W+c+f]*Q*H*Y,K+=e[W+1]*U*te*j,K+=e[W+1+f]*U*te*Y,K+=e[W+1+c]*U*H*j,K+=e[W+1+c+f]*U*H*Y,l[b]=K}}else for(let w=0;w<n;w++)for(let S=0;S<n;S++){const C=S*s[1]+w*s[2]+s[3],E=S*s[5]+w*s[6]+s[7],D=S*s[9]+w*s[10]+s[11];for(let M=0;M<n;M++){const N=Math.round(M*g+C),I=Math.round(M*y+E),_=Math.round(M*x+D);b++,!(N<0||I<0||_<0)&&(N>=c||I>=h||_>=d||(l[b]=e[p(N,I,_)]))}}return l}function sV(i,e,t,n,s){const r=new Uint8Array(i);r.fill(0);let a=-1;if(e[0]===t[0])a=0;else if(e[1]===t[1])a=1;else if(e[2]===t[2])a=2;else return console.error("Error: No constant dimension found."),null;const c=[0,1,2].filter(M=>M!==a),h=[];h[a]=e[a],h[c[0]]=(e[c[0]]+t[c[0]])/2,h[c[1]]=(e[c[1]]+t[c[1]])/2;const d=Math.abs(t[c[0]]-e[c[0]])/2,f=Math.abs(t[c[1]]-e[c[1]])/2,p=n.dims[1],g=n.dims[2],y=Math.max(0,Math.floor(h[c[0]]-d)),x=Math.min(n.dims[c[0]+1]-1,Math.ceil(h[c[0]]+d)),b=Math.max(0,Math.floor(h[c[1]]-f)),w=Math.min(n.dims[c[1]+1]-1,Math.ceil(h[c[1]]+f)),S=h[a];if(S<0||S>=n.dims[a+1])return console.error("Error: Constant dimension value is out of bounds."),null;for(let M=y;M<=x;M++)for(let N=b;N<=w;N++){const I=[];I[a]=S,I[c[0]]=M,I[c[1]]=N;const _=(I[c[0]]-h[c[0]])/d,F=(I[c[1]]-h[c[1]])/f;if(_*_+F*F<=1){const P=I[0],O=I[1],q=I[2]*p*g+O*p+P;r[q]=1}}const C=d*s[c[0]+1],E=f*s[c[1]+1],D=Math.PI*C*E;return{mask:r,area:D}}function rV(i){const{nv:e,maskImages:t,drawBitmap:n,drawingIsMask:s,roiIsMask:r,startVox:a,endVox:l,hdr:c,pixDimsRAS:h}=i,d=new Uint8Array(e);d.fill(1);const f=null;if(t&&t.length>0){for(const p of t)if(p.length===e)for(let g=0;g<e;g++)(p[g]===0||isNaN(p[g]))&&(d[g]=0)}else if(s&&n)for(let p=0;p<e;p++)(n[p]===0||isNaN(n[p]))&&(d[p]=0);else if(r&&a&&l&&c&&h){const p=sV(e,a,l,c,h);return p?{mask:p.mask,area:p.area}:{mask:d,area:null}}return{mask:d,area:f}}function aV(i,e){const t=i.length;let n=0,s=0,r=0,a=Number.NEGATIVE_INFINITY,l=Number.POSITIVE_INFINITY,c=0,h=0,d=0;for(let x=0;x<t;x++){if(e[x]<1)continue;const b=i[x];n++;let w=s+(b-s)/n;r=r+(b-s)*(b-w),s=w,b!==0&&(c++,w=h+(b-h)/c,d=d+(b-h)*(b-w),h=w,l=Math.min(b,l),a=Math.max(b,a))}const f=Math.sqrt(r/(n-1)),p=Math.sqrt(d/(c-1)),g=l,y=a;return n!==c&&(l=Math.min(0,l),a=Math.max(0,a)),{mean:s,stdev:f,nvox:n,min:l,max:a,meanNot0:h,stdevNot0:p,nvoxNot0:c,minNot0:g,maxNot0:y}}function oV(i,e,t){const n=i.length,s=new Float32Array(n);for(let r=0;r<n;r++)s[r]=i[r]*e+t;return s}var{version:iw}=x_,{MESH_EXTENSIONS:Gh}=e4,{LEFT_MOUSE_BUTTON:Hh,CENTER_MOUSE_BUTTON:nw,RIGHT_MOUSE_BUTTON:sw}=c4,rw={filename:"",isSaveDrawing:!1,volumeByIndex:0},wo,Af=class{constructor(i=Jn){G(this,"loaders",{}),G(this,"dicomLoader",null),G(this,"canvas",null),G(this,"_gl",null),G(this,"isBusy",!1),G(this,"needsRefresh",!1),G(this,"colormapTexture",null),G(this,"colormapLists",[]),G(this,"volumeTexture",null),G(this,"gradientTexture",null),G(this,"gradientTextureAmount",0),G(this,"useCustomGradientTexture",!1),G(this,"renderGradientValues",!1),G(this,"drawTexture",null),G(this,"paqdTexture",null),G(this,"drawUndoBitmaps",[]),G(this,"drawLut",yt.makeDrawLut("$itksnap")),G(this,"drawOpacity",.8),G(this,"drawRimOpacity",-1),G(this,"clickToSegmentIsGrowing",!1),G(this,"clickToSegmentGrowingBitmap",null),G(this,"clickToSegmentXY",[0,0]),G(this,"renderDrawAmbientOcclusion",.4),G(this,"colorbarHeight",0),G(this,"drawPenLocation",[NaN,NaN,NaN]),G(this,"drawPenAxCorSag",-1),G(this,"drawFillOverwrites",!0),G(this,"drawPenFillPts",[]),G(this,"drawShapeStartLocation",[NaN,NaN,NaN]),G(this,"drawShapePreviewBitmap",null),G(this,"overlayTexture",null),G(this,"overlayTextureID",null),G(this,"sliceMMShader"),G(this,"slice2DShader"),G(this,"sliceV1Shader"),G(this,"orientCubeShader"),G(this,"orientCubeShaderVAO",null),G(this,"rectShader"),G(this,"rectOutlineShader"),G(this,"renderShader"),G(this,"lineShader"),G(this,"line3DShader"),G(this,"passThroughShader"),G(this,"renderGradientShader"),G(this,"renderGradientValuesShader"),G(this,"renderSliceShader"),G(this,"renderVolumeShader"),G(this,"pickingMeshShader"),G(this,"pickingImageShader"),G(this,"colorbarShader"),G(this,"customSliceShader",null),G(this,"fontShader",null),G(this,"fiberShader"),G(this,"fontTexture",null),G(this,"circleShader"),G(this,"matCapTexture",null),G(this,"bmpShader",null),G(this,"bmpTexture",null),G(this,"thumbnailVisible",!1),G(this,"bmpTextureWH",1),G(this,"growCutShader"),G(this,"orientShaderAtlasU",null),G(this,"orientShaderAtlasI",null),G(this,"orientShaderU",null),G(this,"orientShaderI",null),G(this,"orientShaderF",null),G(this,"orientShaderRGBU",null),G(this,"orientShaderPAQD",null),G(this,"surfaceShader",null),G(this,"blurShader",null),G(this,"sobelBlurShader",null),G(this,"sobelFirstOrderShader",null),G(this,"sobelSecondOrderShader",null),G(this,"genericVAO",null),G(this,"unusedVAO",null),G(this,"crosshairs3D",null),G(this,"DEFAULT_FONT_GLYPH_SHEET",Ib),G(this,"DEFAULT_FONT_METRICS",_b),G(this,"fontMetrics"),G(this,"fontMets",null),G(this,"fontPx",12),G(this,"legendFontScaling",1),G(this,"backgroundMasksOverlays",0),G(this,"overlayOutlineWidth",0),G(this,"overlayAlphaShader",1),G(this,"position"),G(this,"extentsMin"),G(this,"extentsMax"),G(this,"resizeObserver",null),G(this,"resizeEventListener",null),G(this,"canvasObserver",null),G(this,"syncOpts",{"3d":!1,"2d":!1,zoomPan:!1,cal_min:!1,cal_max:!1,clipPlane:!1,gamma:!1,sliceType:!1,crosshair:!1}),G(this,"readyForSync",!1),G(this,"uiData",{mousedown:!1,touchdown:!1,mouseButtonLeftDown:!1,mouseButtonCenterDown:!1,mouseButtonRightDown:!1,mouseDepthPicker:!1,clickedTile:-1,pan2DxyzmmAtMouseDown:[0,0,0,1],prevX:0,prevY:0,currX:0,currY:0,currentTouchTime:0,lastTouchTime:0,touchTimer:null,doubleTouch:!1,isDragging:!1,dragStart:[0,0],dragEnd:[0,0],dragClipPlaneStartDepthAziElev:[0,0,0],lastTwoTouchDistance:0,multiTouchGesture:!1,windowX:0,windowY:0,activeDragMode:null,activeDragButton:null,angleFirstLine:[0,0,0,0],angleState:"none",activeClipPlaneIndex:0}),yo(this,wo,null),G(this,"back",null),G(this,"overlays",[]),G(this,"deferredVolumes",[]),G(this,"deferredMeshes",[]),G(this,"furthestVertexFromOrigin",100),G(this,"volScale",[]),G(this,"vox",[]),G(this,"mousePos",[0,0]),G(this,"screenSlices",[]),G(this,"cuboidVertexBuffer"),G(this,"otherNV",null),G(this,"volumeObject3D",null),G(this,"pivot3D",[0,0,0]),G(this,"furthestFromPivot",10),G(this,"currentClipPlaneIndex",0),G(this,"lastCalled",new Date().getTime()),G(this,"selectedObjectId",-1),G(this,"CLIP_PLANE_ID",1),G(this,"VOLUME_ID",254),G(this,"DISTANCE_FROM_CAMERA",-.54),G(this,"graph",{LTWH:[0,0,640,480],opacity:0,vols:[0],autoSizeMultiplanar:!1,normalizeValues:!1,isRangeCalMinMax:!1}),G(this,"customLayout",[]),G(this,"meshShaders",pL()),G(this,"dragModes",{contrast:1,measurement:2,angle:7,none:0,pan:3,slicer3D:4,callbackOnly:5}),G(this,"sliceTypeAxial",0),G(this,"sliceTypeCoronal",1),G(this,"sliceTypeSagittal",2),G(this,"sliceTypeMultiplanar",3),G(this,"sliceTypeRender",4),G(this,"onDragRelease",()=>{}),G(this,"onMouseUp",()=>{}),G(this,"onLocationChange",()=>{}),G(this,"onIntensityChange",()=>{}),G(this,"onClickToSegment",()=>{}),G(this,"onImageLoaded",()=>{}),G(this,"onMeshLoaded",()=>{}),G(this,"onFrameChange",()=>{}),G(this,"onError",()=>{}),G(this,"onColormapChange",()=>{}),G(this,"onInfo",()=>{}),G(this,"onWarn",()=>{}),G(this,"onDebug",()=>{}),G(this,"onVolumeAddedFromUrl",()=>{}),G(this,"onVolumeWithUrlRemoved",()=>{}),G(this,"onVolumeUpdated",()=>{}),G(this,"onMeshAddedFromUrl",()=>{}),G(this,"onMeshAdded",()=>{}),G(this,"onMeshWithUrlRemoved",()=>{}),G(this,"onZoom3DChange",()=>{}),G(this,"onAzimuthElevationChange",()=>{}),G(this,"onClipPlaneChange",()=>{}),G(this,"onCustomMeshShaderAdded",()=>{}),G(this,"onMeshShaderChanged",()=>{}),G(this,"onMeshPropertyChanged",()=>{}),G(this,"onDicomLoaderFinishedWithImages",()=>{}),G(this,"onDocumentLoaded",()=>{}),G(this,"onOptsChange",()=>{}),G(this,"document",new A0),G(this,"mediaUrlMap",new Map),G(this,"initialized",!1),G(this,"currentDrawUndoBitmap");for(const e in i)typeof i[e]=="function"?this[e]=i[e]:this.opts[e]=Jn[e]===void 0?Jn[e]:i[e];this.opts.forceDevicePixelRatio===0?this.uiData.dpr=window.devicePixelRatio||1:this.opts.forceDevicePixelRatio<0?this.uiData.dpr=1:this.uiData.dpr=this.opts.forceDevicePixelRatio,this.currentDrawUndoBitmap=this.opts.maxDrawUndoBitmaps,this.opts.drawingEnabled&&this.createEmptyDrawing(),this.opts.thumbnail.length>0&&(this.thumbnailVisible=!0),X.setLogLevel(this.opts.logLevel),this.document.setOptsChangeCallback((e,t,n)=>{this.onOptsChange(e,t,n)})}get scene(){return this.document.scene}get opts(){return this.document.opts}get sliceMosaicString(){return this.document.opts.sliceMosaicString||""}set sliceMosaicString(i){this.document.opts.sliceMosaicString=i}get isAlphaClipDark(){return this.document.opts.isAlphaClipDark}set isAlphaClipDark(i){this.document.opts.isAlphaClipDark=i}cleanup(){y7(this.resizeObserver,this.canvasObserver,this.resizeEventListener),this.resizeEventListener=null,this.resizeObserver=null,this.canvasObserver=null,x7(Te(this,wo)),Dr(this,wo,null),this.document.removeOptsChangeCallback()}get volumes(){return this.document.volumes}set volumes(i){this.document.volumes=i}get meshes(){return this.document.meshes}set meshes(i){this.document.meshes=i}get drawBitmap(){return this.document.drawBitmap}set drawBitmap(i){this.document.drawBitmap=i}get volScaleMultiplier(){return this.scene.volScaleMultiplier}set volScaleMultiplier(i){this.setScale(i)}async saveScene(i="niivue.png"){function e(n,s){const r=document.createElement("a");document.body.appendChild(r),r.style.display="none";const a=window.URL.createObjectURL(n);r.href=a,r.download=s,r.click(),r.remove()}const t=this.canvas;if(!t)throw new Error("canvas not defined");this.drawScene(),t.toBlob(n=>{n&&(i===""&&(i=`niivue-screenshot-${new Date().toString()}.png`,i=i.replace(/\s/g,"_")),e(n,i))})}async attachTo(i,e=null){return await this.attachToCanvas(document.getElementById(i),e),X.debug("attached to element with id: ",i),this}async attachToCanvas(i,e=null){this.canvas=i,e===null&&(e=navigator.hardwareConcurrency>6,X.debug("AntiAlias ",e," Threads ",navigator.hardwareConcurrency));const{gl:t,max2D:n,max3D:s}=QP(this.canvas,e);return this.gl=t,this.uiData.max2D=n,this.uiData.max3D=s,X.info("NIIVUE VERSION ",iw),X.debug(`Max texture size 2D: ${this.uiData.max2D} 3D: ${this.uiData.max3D}`),this.canvas.parentElement.style.backgroundColor="black",this.opts.isResizeCanvas&&(Yb(this.canvas),this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight,this.resizeEventListener=p7(()=>this.resizeListener()),window.addEventListener("resize",this.resizeEventListener),this.resizeObserver=g7(()=>this.resizeListener()),this.resizeObserver.observe(this.canvas.parentElement),this.canvasObserver=A7(r=>{for(const a of r)if(a.type==="childList"&&a.removedNodes.length>0&&Array.from(a.removedNodes).includes(this.canvas)){this.cleanup();break}}),this.canvasObserver.observe(this.canvas.parentElement,{childList:!0})),this.opts.interactive&&this.registerInteractions(),await this.init(),this.drawScene(),this}syncWith(i,e={"2d":!0,"3d":!0}){i instanceof Array||(i=[i]),this.otherNV=i,this.syncOpts={...e}}broadcastTo(i,e={"2d":!0,"3d":!0}){i instanceof Array||(i=[i]),this.otherNV=i,this.syncOpts=e}doSync3d(i){i.scene.renderAzimuth=this.scene.renderAzimuth,i.scene.renderElevation=this.scene.renderElevation,i.scene.volScaleMultiplier=this.scene.volScaleMultiplier}doSync2d(i){const e=this.frac2mm(this.scene.crosshairPos);i.scene.crosshairPos=i.mm2frac(e),i.scene.pan2Dxyzmm=Gs(this.scene.pan2Dxyzmm)}doSyncGamma(i){const e=this.scene.gamma,t=i.scene.gamma;e!==t&&i.setGamma(e)}doSyncZoomPan(i){i.scene.pan2Dxyzmm=Gs(this.scene.pan2Dxyzmm)}doSyncCrosshair(i){const e=this.frac2mm(this.scene.crosshairPos);i.scene.crosshairPos=i.mm2frac(e)}doSyncCalMin(i){this.volumes[0].cal_min!==i.volumes[0].cal_min&&(i.volumes[0].cal_min=this.volumes[0].cal_min,i.updateGLVolume())}doSyncCalMax(i){this.volumes[0].cal_max!==i.volumes[0].cal_max&&(i.volumes[0].cal_max=this.volumes[0].cal_max,i.updateGLVolume())}doSyncSliceType(i){i.setSliceType(this.opts.sliceType)}doSyncClipPlane(i){i.setClipPlane(this.scene.clipPlaneDepthAziElevs[this.uiData.activeClipPlaneIndex])}sync(){if(!(!this.gl||!this.otherNV||typeof this.otherNV>"u")&&this.gl.canvas.matches(":focus"))for(let i=0;i<this.otherNV.length;i++)this.otherNV[i]!==this&&(this.syncOpts.gamma&&this.doSyncGamma(this.otherNV[i]),this.syncOpts.crosshair&&this.doSyncCrosshair(this.otherNV[i]),this.syncOpts.zoomPan&&this.doSyncZoomPan(this.otherNV[i]),this.syncOpts.sliceType&&this.doSyncSliceType(this.otherNV[i]),this.syncOpts.cal_min&&this.doSyncCalMin(this.otherNV[i]),this.syncOpts.cal_max&&this.doSyncCalMax(this.otherNV[i]),this.syncOpts.clipPlane&&this.doSyncClipPlane(this.otherNV[i]),this.syncOpts["2d"]&&this.doSync2d(this.otherNV[i]),this.syncOpts["3d"]&&this.doSync3d(this.otherNV[i]),this.otherNV[i].canvas!==this.canvas&&this.otherNV[i].drawScene(),this.otherNV[i].createOnLocationChange())}arrayEquals(i,e){return Array.isArray(i)&&Array.isArray(e)&&i.length===e.length&&i.every((t,n)=>t===e[n])}textSizePoints(){this.opts.textHeight>=0&&(X.warn("textHeight is deprecated (use fontMinPx and fontSizeScaling)"),this.opts.fontMinPx=this.opts.textHeight*217,this.opts.fontSizeScaling=.4,this.opts.textHeight=-1);const i=this.uiData.dpr||1,e=this.opts.fontMinPx,t=this.gl.canvas.width/i,n=this.gl.canvas.height/i,s=t*n,r=800*600,a=Math.max(s/r,1),l=Math.pow(a,this.opts.fontSizeScaling),c=e*l*i;this.fontPx=c,X.debug(`${t.toFixed(0)}x${n.toFixed(0)} pts (dpi=${i}) => areaScale=${a.toFixed(2)}, scale=${l.toFixed(2)}, minPx=${this.opts.fontMinPx} fontScale=${this.opts.fontSizeScaling} fontPx=${c.toFixed(2)}`)}resizeListener(){if(!v7(this.canvas,this._gl))return;if(!this.opts.isResizeCanvas){this.opts.forceDevicePixelRatio>=0&&X.warn("this.opts.forceDevicePixelRatio requires isResizeCanvas"),this.drawScene();return}Yb(this.canvas);const i=m7({canvas:this.canvas,gl:this.gl,isResizeCanvas:this.opts.isResizeCanvas,forceDevicePixelRatio:this.opts.forceDevicePixelRatio});this.uiData.dpr=i.dpr,X.debug("devicePixelRatio: "+this.uiData.dpr),this.canvas.width=i.width,this.canvas.height=i.height,this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.textSizePoints(),this.drawScene()}getRelativeMousePosition(i,e){return l4(i,e)}getNoPaddingNoBorderCanvasRelativeMousePosition(i,e){return d7(i,e)}mouseContextMenuListener(i){i.preventDefault()}mouseDownListener(i){if(this.uiData.mousedown=!0,this.eventInBounds(i))this.opts.bounds&&(this.opts.showBoundsBorder=!0);else{this.opts.showBoundsBorder=!1,this.drawScene();return}i.preventDefault(),this.drawPenLocation=[NaN,NaN,NaN],this.drawPenAxCorSag=-1,this.drawShapeStartLocation=[NaN,NaN,NaN];const e=this.getNoPaddingNoBorderCanvasRelativeMousePosition(i,this.gl.canvas);if(this.opts.dragMode===7&&this.uiData.angleState==="drawing_second_line"||(this.setDragStart(e.x,e.y),this.setDragEnd(e.x,e.y)),X.debug("mouse down"),X.debug(i),!e)return;const[t,n]=[e.x*this.uiData.dpr,e.y*this.uiData.dpr];this.opts.clickToSegment&&(this.clickToSegmentXY=[t,n]);const s=this.getLabelAtPoint([t,n]);if(s){if(s.onClick){s.onClick(s,i);return}for(const r of this.meshes){if(r.type!=="connectome"){if(Array.isArray(s.points)&&s.points.length===3&&s.points.every(Number.isFinite)){const[a,l,c]=s.points;this.scene.crosshairPos=this.mm2frac([a,l,c]),this.updateGLVolume()}continue}for(const a of r.nodes)a.label===s&&(this.scene.crosshairPos=this.mm2frac([a.x,a.y,a.z]),this.updateGLVolume())}}this.uiData.clickedTile=this.tileIndex(t,n),i.button===Hh&&i.shiftKey?(this.uiData.mouseButtonCenterDown=!0,this.setActiveDragMode(Hh,!0,i.ctrlKey),this.handleMouseAction(this.uiData.activeDragMode,i,e)):i.button===Hh?(this.uiData.mouseButtonLeftDown=!0,this.setActiveDragMode(Hh,!1,i.ctrlKey),this.handleMouseAction(this.uiData.activeDragMode,i,e)):i.button===sw?(this.uiData.mouseButtonRightDown=!0,this.setActiveDragMode(sw,i.shiftKey,i.ctrlKey),this.handleMouseAction(this.uiData.activeDragMode,i,e)):i.button===nw&&(this.uiData.mouseButtonCenterDown=!0,this.setActiveDragMode(nw,i.shiftKey,i.ctrlKey),this.handleMouseAction(this.uiData.activeDragMode,i,e)),this.drawScene()}getMouseButtonDragMode(i,e,t){return u4({button:i,shiftKey:e,ctrlKey:t,mouseConfig:this.opts.mouseEventConfig,dragMode:this.opts.dragMode,dragModePrimary:this.opts.dragModePrimary})}getTouchDragMode(i){return D7({isDoubleTouch:i,touchConfig:this.opts.touchEventConfig,dragMode:this.opts.dragMode,dragModePrimary:this.opts.dragModePrimary})}setActiveDragMode(i,e,t){const n=this.getMouseButtonDragMode(i,e,t),s=lO(n,i);this.uiData.activeDragMode=s.activeDragMode,this.uiData.activeDragButton=s.activeDragButton}getCurrentDragMode(){return aO({activeDragMode:this.uiData.activeDragMode,fallbackDragMode:this.opts.dragMode})}clearActiveDragMode(){const i=oO();this.uiData.activeDragMode=i.activeDragMode,this.uiData.activeDragButton=i.activeDragButton}handleMouseAction(i,e,t){if(i===8)this.mouseDown(t.x,t.y),this.mouseClick(t.x,t.y);else if(i===9)this.uiData.windowX=e.x,this.uiData.windowY=e.y;else{if(this.mousePos=[t.x*this.uiData.dpr,t.y*this.uiData.dpr],i===0)return;if(i===7)if(this.uiData.angleState==="none")this.uiData.angleState="drawing_first_line";else if(this.uiData.angleState==="drawing_second_line"){const n=[t.x*this.uiData.dpr,t.y*this.uiData.dpr],s=this.tileIndex(n[0],n[1]);let r={sliceIndex:-1,sliceType:0,slicePosition:0};if(s>=0&&s<this.screenSlices.length){const f=this.screenSlices[s].axCorSag;let p=0;f===0?p=this.scene.crosshairPos[2]:f===1?p=this.scene.crosshairPos[1]:f===2&&(p=this.scene.crosshairPos[0]),r={sliceIndex:s,sliceType:f,slicePosition:p}}const a=[this.uiData.angleFirstLine[2],this.uiData.angleFirstLine[3],n[0],n[1]],l=this.canvasPos2frac([this.uiData.angleFirstLine[0],this.uiData.angleFirstLine[1]]),c=this.canvasPos2frac([this.uiData.angleFirstLine[2],this.uiData.angleFirstLine[3]]),h=this.canvasPos2frac([a[0],a[1]]),d=this.canvasPos2frac([a[2],a[3]]);if(l[0]>=0&&c[0]>=0&&h[0]>=0&&d[0]>=0){const f=this.frac2mm(l),p=this.frac2mm(c),g=this.frac2mm(h),y=this.frac2mm(d),x={firstLineMM:{start:Ae(f[0],f[1],f[2]),end:Ae(p[0],p[1],p[2])},secondLineMM:{start:Ae(g[0],g[1],g[2]),end:Ae(y[0],y[1],y[2])},sliceIndex:r.sliceIndex,sliceType:r.sliceType,slicePosition:r.slicePosition,angle:this.calculateAngleBetweenLines(this.uiData.angleFirstLine,a)};this.document.completedAngles.push(x)}this.resetAngleMeasurement(),this.uiData.angleState="complete",this.drawScene();return}else this.uiData.angleState==="complete"&&(this.resetAngleMeasurement(),this.uiData.angleState="drawing_first_line");this.setDragStart(t.x,t.y),this.uiData.isDragging||(this.uiData.pan2DxyzmmAtMouseDown=Gs(this.scene.pan2Dxyzmm)),this.uiData.isDragging=!0,this.uiData.dragClipPlaneStartDepthAziElev=this.scene.clipPlaneDepthAziElevs[this.uiData.activeClipPlaneIndex]}}calculateMinMaxVoxIdx(i){return cO(i)}calculateNewRange({volIdx:i=0}={}){if(this.opts.sliceType===4&&this.sliceMosaicString.length<1||!gg(this.uiData.dragStart,this.uiData.dragEnd))return;let e=this.canvasPos2frac([this.uiData.dragStart[0],this.uiData.dragStart[1]]);if(e[0]<0)return;const t=this.frac2vox(e,i);if(e=this.canvasPos2frac([this.uiData.dragEnd[0],this.uiData.dragEnd[1]]),e[0]<0)return;const n=this.frac2vox(e,i),s=this.calculateMinMaxVoxIdx([t[0],n[0]]),r=this.calculateMinMaxVoxIdx([t[1],n[1]]),a=this.calculateMinMaxVoxIdx([t[2],n[2]]),l=gO(t,n,s,r,a),c=this.volumes[i].hdr,h=this.volumes[i].img;if(!c||!h)return;const d=pO({xrange:l.xrange,yrange:l.yrange,zrange:l.zrange,dims:c.dims,img:h});if(!d.hasVariation)return;const f=Pb(c,d.lo),p=Pb(c,d.hi);this.volumes[i].cal_min=f,this.volumes[i].cal_max=p,this.onIntensityChange(this.volumes[i])}generateMouseUpCallback(i,e){const t=this.tileIndex(this.uiData.dragStart[0],this.uiData.dragStart[1]),n=this.tileIndex(this.uiData.dragEnd[0],this.uiData.dragEnd[1]);let s=-1;t===n&&(s=n);let r=-1;s>=0&&(r=this.screenSlices[s].axCorSag);const a=this.frac2mm(i),l=this.frac2mm(e),c=bt();ob(c,Ae(a[0],a[1],a[2]),Ae(l[0],l[1],l[2]));const h=Oc(c),d=this.frac2vox(i),f=this.frac2vox(e);this.onDragRelease({fracStart:i,fracEnd:e,voxStart:d,voxEnd:f,mmStart:a,mmEnd:l,mmLength:h,tileIdx:s,axCorSag:r})}mouseUpListener(){this.uiData.mousedown=!1;const i={mouseButtonRightDown:this.uiData.mouseButtonRightDown,mouseButtonCenterDown:this.uiData.mouseButtonCenterDown,isDragging:this.uiData.isDragging,mousePos:this.mousePos,fracPos:this.canvasPos2frac(this.mousePos)};this.uiData.mouseButtonRightDown=!1;const e=this.uiData.mouseButtonCenterDown;this.uiData.mouseButtonCenterDown=!1,this.uiData.mouseButtonLeftDown=!1;const t=this.getCurrentDragMode();if(this.drawPenFillPts.length>0?this.drawPenFilled():this.opts.drawingEnabled&&!isNaN(this.drawPenLocation[0])?this.drawAddUndoBitmap():this.opts.drawingEnabled&&!isNaN(this.drawShapeStartLocation[0])&&(this.opts.penType===1||this.opts.penType===2)&&(this.opts.penValue===0?this.drawAddUndoBitmap():this.drawAddUndoBitmap(this.drawFillOverwrites),this.drawShapePreviewBitmap=null),this.drawPenLocation=[NaN,NaN,NaN],this.drawPenAxCorSag=-1,this.drawShapeStartLocation=[NaN,NaN,NaN],this.drawShapePreviewBitmap&&(this.drawBitmap=this.drawShapePreviewBitmap,this.drawShapePreviewBitmap=null,this.refreshDrawing(!0,!1)),m4(this.onMouseUp)&&this.onMouseUp(i),this.uiData.isDragging){if(this.uiData.isDragging=!1,t===7){if(this.uiData.angleState==="drawing_first_line"){this.uiData.angleFirstLine=[this.uiData.dragStart[0],this.uiData.dragStart[1],this.uiData.dragEnd[0],this.uiData.dragEnd[1]],this.uiData.angleState="drawing_second_line",this.uiData.isDragging=!0,this.drawScene();return}if(this.uiData.angleState==="drawing_second_line"){this.uiData.angleState="complete",this.clearActiveDragMode(),this.drawScene();return}}t===5&&this.drawScene();const n=this.canvasPos2frac([this.uiData.dragStart[0],this.uiData.dragStart[1]]),s=this.canvasPos2frac([this.uiData.dragEnd[0],this.uiData.dragEnd[1]]);if(this.generateMouseUpCallback(n,s),t===6){this.clearActiveDragMode();return}if(t===1){if(e){this.clearActiveDragMode();return}if(!gg(this.uiData.dragStart,this.uiData.dragEnd)){this.clearActiveDragMode();return}this.calculateNewRange({volIdx:0}),this.refreshLayers(this.volumes[0],0)}if(t===2){const r=this.getCurrentSliceInfo(),a=this.canvasPos2frac([this.uiData.dragStart[0],this.uiData.dragStart[1]]),l=this.canvasPos2frac([this.uiData.dragEnd[0],this.uiData.dragEnd[1]]);if(a[0]>=0&&l[0]>=0){const c=this.frac2mm(a),h=this.frac2mm(l);this.document.completedMeasurements.push({startMM:Ae(c[0],c[1],c[2]),endMM:Ae(h[0],h[1],h[2]),sliceIndex:r.sliceIndex,sliceType:r.sliceType,slicePosition:r.slicePosition,distance:ON(Ae(c[0],c[1],c[2]),Ae(h[0],h[1],h[2]))})}this.clearActiveDragMode(),this.drawScene();return}}this.clearActiveDragMode(),this.drawScene()}checkMultitouch(i){if(k7({touchdown:this.uiData.touchdown,multiTouchGesture:this.uiData.multiTouchGesture})){const e=this.canvas.getBoundingClientRect(),t=w0({touch:i.touches[0],canvasRect:e});this.mouseDown(t.x,t.y),this.mouseClick(t.x,t.y)}}touchStartListener(i){i.preventDefault(),V7(this.uiData.touchTimer)&&(this.uiData.touchTimer=setTimeout(()=>{this.resetBriCon(i)},this.opts.longTouchTimeout));const e=new Date().getTime(),t=N7({currentTime:e,touchCount:i.touches.length,isTouchdown:this.uiData.touchdown});if(this.uiData.touchdown=t.touchdown,this.uiData.currentTouchTime=t.currentTouchTime,R7({currentTime:e,lastTouchTime:this.uiData.lastTouchTime,doubleTouchTimeout:this.opts.doubleTouchTimeout}).isDoubleTap){const s=F7(e);this.uiData.doubleTouch=s.doubleTouch,this.uiData.lastTouchTime=s.lastTouchTime;const r=i.target.getBoundingClientRect(),a=w0({touch:i.targetTouches[0],canvasRect:r});this.setDragStart(a.x,a.y),this.resetBriCon(i);return}else{const s=_7(e);this.uiData.doubleTouch=s.doubleTouch,this.uiData.lastTouchTime=s.lastTouchTime,this.setDragStart(0,0),this.setDragEnd(0,0)}qb(this.uiData.touchdown,i.touches.length)?this.uiData.multiTouchGesture=!1:this.uiData.multiTouchGesture=!0,setTimeout(this.checkMultitouch.bind(this),1,i)}touchEndListener(i){i.preventDefault();const e=I7();if(this.uiData.touchdown=e.touchdown,this.uiData.lastTwoTouchDistance=e.lastTwoTouchDistance,this.uiData.multiTouchGesture=e.multiTouchGesture,this.uiData.touchTimer&&(clearTimeout(this.uiData.touchTimer),this.uiData.touchTimer=null),this.uiData.isDragging){this.uiData.isDragging=!1,this.getCurrentDragMode()===1&&(this.calculateNewRange(),this.refreshLayers(this.volumes[0],0));const t=this.canvasPos2frac([this.uiData.dragStart[0],this.uiData.dragStart[1]]),n=this.canvasPos2frac([this.uiData.dragEnd[0],this.uiData.dragEnd[1]]);this.generateMouseUpCallback(t,n)}this.mouseUpListener()}windowingHandler(i,e,t=0){const n=mO({x:i,y:e,windowX:this.uiData.windowX,windowY:this.uiData.windowY,currentCalMin:this.volumes[0].cal_min,currentCalMax:this.volumes[0].cal_max,globalMin:this.volumes[0].global_min,globalMax:this.volumes[0].global_max});this.volumes[t].cal_min=n.calMin,this.volumes[t].cal_max=n.calMax,this.refreshLayers(this.volumes[t],0),this.uiData.windowX=n.windowX,this.uiData.windowY=n.windowY}mouseLeaveListener(){if(this.clickToSegmentIsGrowing&&(X.debug("Mouse left canvas, stopping clickToSegment preview."),this.clickToSegmentIsGrowing=!1,this.refreshDrawing(!0,!1)),this.opts.drawingEnabled&&!isNaN(this.drawPenLocation[0])&&(X.debug("Mouse left canvas during drawing, resetting pen state."),this.drawPenLocation=[NaN,NaN,NaN],this.drawPenAxCorSag=-1,this.drawPenFillPts=[]),this.opts.drawingEnabled&&!isNaN(this.drawShapeStartLocation[0])&&(X.debug("Mouse left canvas during shape drawing, resetting shape state."),this.drawShapeStartLocation=[NaN,NaN,NaN],this.drawShapePreviewBitmap&&(this.drawBitmap=this.drawShapePreviewBitmap,this.drawShapePreviewBitmap=null,this.refreshDrawing(!0,!1))),this.uiData.isDragging||this.uiData.mousedown){X.debug("Mouse left canvas during drag, resetting drag state."),this.uiData.isDragging=!1;const i=d4();this.uiData.mouseButtonLeftDown=i.mouseButtonLeftDown,this.uiData.mouseButtonCenterDown=i.mouseButtonCenterDown,this.uiData.mouseButtonRightDown=i.mouseButtonRightDown,this.uiData.mousedown=i.mousedown,this.drawScene()}this.mousePos=f4()}mouseMoveListener(i){this.uiData.mousedown&&this.drawScene();const e=this.getNoPaddingNoBorderCanvasRelativeMousePosition(i,this.gl.canvas);if(e){if(!this.eventInBounds(i)){this.updateMousePos(e.x,e.y);return}if(this.uiData.mousedown){const t=e.x*this.uiData.dpr,n=e.y*this.uiData.dpr;if(this.tileIndex(t,n)!==this.uiData.clickedTile)return;const r=this.getCurrentDragMode();if(r===8){this.mouseMove(e.x,e.y),this.mouseClick(e.x,e.y),this.drawScene(),this.uiData.prevX=this.uiData.currX,this.uiData.prevY=this.uiData.currY;return}if(r===9){this.windowingHandler(e.x,e.y),this.drawScene(),this.uiData.prevX=this.uiData.currX,this.uiData.prevY=this.uiData.currY;return}this.setDragEnd(e.x,e.y),this.drawScene(),this.uiData.prevX=this.uiData.currX,this.uiData.prevY=this.uiData.currY}else if(this.getCurrentDragMode()===7&&this.uiData.angleState==="drawing_second_line"){const t=this.getNoPaddingNoBorderCanvasRelativeMousePosition(i,this.gl.canvas);if(!t)return;this.setDragEnd(t.x,t.y),this.drawScene()}else if(!this.uiData.mousedown&&this.opts.clickToSegment){const t=this.getNoPaddingNoBorderCanvasRelativeMousePosition(i,this.gl.canvas);if(!t)return;const n=t.x*this.uiData.dpr,s=t.y*this.uiData.dpr;this.mousePos=[n,s];const r=this.tileIndex(n,s);r>=0&&this.opts.drawingEnabled&&this.screenSlices[r].axCorSag<=2&&(this.clickToSegmentXY=[n,s],this.clickToSegmentIsGrowing=!0,this.doClickToSegment({x:n,y:s,tileIndex:r}))}}}resetBriCon(i=null){if(this.uiData.isDragging)return;if(!this.eventInBounds(i)){this.opts.showBoundsBorder=!1;return}let e=!1;this.opts.sliceType===4&&(e=!0);let t=0,n=0;if(i!==null&&("targetTouches"in i?(t=i.targetTouches[0].clientX-i.target.getBoundingClientRect().left,n=i.targetTouches[0].clientY-i.target.getBoundingClientRect().top):(t=i.offsetX,n=i.offsetY),t*=this.uiData.dpr,n*=this.uiData.dpr,this.inRenderTile(t,n)>=0&&(e=!0)),e){this.uiData.mouseDepthPicker=!0,this.drawScene(),this.drawScene();return}this.getCurrentDragMode()!==4&&(this.volumes.length<1||this.uiData.doubleTouch||(this.volumes[0].cal_min=this.volumes[0].robust_min,this.volumes[0].cal_max=this.volumes[0].robust_max,this.onIntensityChange(this.volumes[0]),this.refreshLayers(this.volumes[0],0),this.drawScene()))}setDragStart(i,e){const[t,n]=Xb(i,e,this.uiData.dpr);this.uiData.dragStart[0]=t,this.uiData.dragStart[1]=n}setDragEnd(i,e){const[t,n]=Xb(i,e,this.uiData.dpr);this.uiData.dragEnd[0]=t,this.uiData.dragEnd[1]=n}touchMoveListener(i){if(qb(this.uiData.touchdown,i.touches.length)){const e=this.canvas.getBoundingClientRect();if(this.uiData.isDragging||(this.uiData.pan2DxyzmmAtMouseDown=Gs(this.scene.pan2Dxyzmm)),this.uiData.isDragging=!0,U7({doubleTouch:this.uiData.doubleTouch,isDragging:this.uiData.isDragging})){const s=w0({touch:i.targetTouches[0],canvasRect:i.target.getBoundingClientRect()});this.setDragEnd(s.x,s.y),this.drawScene();return}const t=this.getTouchDragMode(!1),n=L7({touch:i.touches[0],canvasRect:e});t===8?(this.mouseClick(n.x,n.y),this.mouseMove(n.x,n.y)):t===9&&(this.windowingHandler(n.pageX,n.pageY),this.drawScene())}else this.handlePinchZoom(i)}handlePinchZoom(i){if(B7(i.targetTouches.length,i.changedTouches.length)){const e=this.canvas.getBoundingClientRect(),t=P7({touch1:i.touches[0],touch2:i.touches[1],lastTwoTouchDistance:this.uiData.lastTwoTouchDistance}),n=O7({touch:i.touches[0],canvasRect:e});this.mousePos=n,this.uiData.lastTwoTouchDistance>0&&this.sliceScroll2D(t.scrollDelta,n[0],n[1]),this.uiData.lastTwoTouchDistance=t.distance}}cycleActiveClipPlane(){const i=Y7({currentIndex:this.uiData.activeClipPlaneIndex,clipPlanesLength:this.scene.clipPlanes.length});this.uiData.activeClipPlaneIndex=i.newIndex;const e=i.newIndex;return this.scene.clipPlanes[e]||(this.scene.clipPlanes[e]=i.defaultClipPlane),this.scene.clipPlaneDepthAziElevs[e]||(this.scene.clipPlaneDepthAziElevs[e]=i.defaultDepthAziElev),e}keyUpListener(i){if(!this.cursorInBounds()){this.opts.showBoundsBorder=!1,this.drawScene();return}const e=new Date().getTime(),t=H7({currentTime:e,lastCalledTime:this.lastCalled,debounceTime:this.opts.keyDebounceTime});if(S0(i.code,this.opts.cycleClipPlaneHotKey)&&t){const n=this.cycleActiveClipPlane();console.log("Active clip plane cycled to:",n),console.log("clip planes",this.scene.clipPlanes),this.lastCalled=e}if(S0(i.code,this.opts.clipPlaneHotKey)){if(t){const n=q7({currentClipPlaneIndex:this.currentClipPlaneIndex});this.currentClipPlaneIndex=n.newIndex,this.scene.clipPlaneDepthAziElevs[this.uiData.activeClipPlaneIndex]=n.depthAziElev,this.setClipPlane(this.scene.clipPlaneDepthAziElevs[this.uiData.activeClipPlaneIndex])}this.lastCalled=e}else if(S0(i.code,this.opts.viewModeHotKey)&&t){const n=X7({currentSliceType:this.opts.sliceType,totalSliceTypes:5});this.setSliceType(n),this.lastCalled=e}this.drawScene()}keyDownListener(i){if(!this.cursorInBounds()){this.opts.showBoundsBorder=!1,this.drawScene();return}const{action:e}=z7({code:i.code,ctrlKey:i.ctrlKey,shiftKey:i.shiftKey,sliceType:this.opts.sliceType});switch(e){case"render_azimuth_decrease":this.setRenderAzimuthElevation(this.scene.renderAzimuth-1,this.scene.renderElevation);break;case"render_azimuth_increase":this.setRenderAzimuthElevation(this.scene.renderAzimuth+1,this.scene.renderElevation);break;case"render_elevation_increase":this.setRenderAzimuthElevation(this.scene.renderAzimuth,this.scene.renderElevation+1);break;case"render_elevation_decrease":this.setRenderAzimuthElevation(this.scene.renderAzimuth,this.scene.renderElevation-1);break;case"crosshair_left":this.moveCrosshairInVox(-1,0,0);break;case"crosshair_right":this.moveCrosshairInVox(1,0,0);break;case"crosshair_up":this.moveCrosshairInVox(0,1,0);break;case"crosshair_down":this.moveCrosshairInVox(0,-1,0);break;case"crosshair_forward":this.moveCrosshairInVox(0,0,1);break;case"crosshair_backward":this.moveCrosshairInVox(0,0,-1);break;case"cycle_drag_mode":this.opts.dragMode=G7(this.opts.dragMode),X.info("drag mode changed to ",G3[this.opts.dragMode]);break;case"frame_previous":this.setFrame4D(this.volumes[0].id,this.volumes[0].frame4D-1);break;case"frame_next":this.setFrame4D(this.volumes[0].id,this.volumes[0].frame4D+1);break;case"show_version":alert(`NIIVUE VERSION: ${iw}`);break}this.drawScene()}wheelListener(i){const e=tO({thumbnailVisible:this.thumbnailVisible,mosaicStringLength:this.opts.sliceMosaicString.length,eventInBounds:this.eventInBounds(i),hasBounds:this.opts.bounds!==null});if(!e.shouldProcess){this.eventInBounds(i)||(this.opts.showBoundsBorder=!1,this.drawScene());return}if(this.opts.showBoundsBorder=e.showBoundsBorder,i.preventDefault(),i.stopPropagation(),K7({dragMode:this.getCurrentDragMode(),dragStart:this.uiData.dragStart,dragEnd:this.uiData.dragEnd})){const l=Z7(i.deltaY),c=Q7({dragStart:this.uiData.dragStart,dragEnd:this.uiData.dragEnd,delta:l});this.uiData.dragStart[0]=c.newDragStart[0],this.uiData.dragStart[1]=c.newDragStart[1],this.uiData.dragEnd[0]=c.newDragEnd[0],this.uiData.dragEnd[1]=c.newDragEnd[1],this.uiData.isDragging=!0,this.drawScene(),this.uiData.isDragging=!1;const h=this.tileIndex(this.uiData.dragStart[0],this.uiData.dragStart[1]);h>=0?this.generateMouseUpCallback(this.screenXY2TextureFrac(this.uiData.dragStart[0],this.uiData.dragStart[1],h),this.screenXY2TextureFrac(this.uiData.dragEnd[0],this.uiData.dragEnd[1],h)):X.warn("Could not generate drag release callback for ROI selection: Invalid tile index.");return}const t=W7({deltaY:i.deltaY,invertScrollDirection:this.opts.invertScrollDirection});if(this.opts.clickToSegment){this.opts.clickToSegmentPercent=eO({currentPercent:this.opts.clickToSegmentPercent,scrollAmount:t});const l=this.clickToSegmentXY[0],c=this.clickToSegmentXY[1],h=this.tileIndex(l,c);h>=0&&this.screenSlices[h].axCorSag<=2&&(X.debug(`Adjusting clickToSegment threshold: ${this.opts.clickToSegmentPercent.toFixed(3)}`),this.clickToSegmentIsGrowing=!0,this.doClickToSegment({x:l,y:c,tileIndex:h}));return}const n=this.canvas.getBoundingClientRect(),[s,r]=nO(i.clientX,i.clientY,n),a=this.inRenderTile(this.uiData.dpr*s,this.uiData.dpr*r)!==-1;if(iO({dragMode:this.getCurrentDragMode(),isInRenderTile:a})){const l=J7({currentZoom:this.scene.pan2Dxyzmm[3],scrollAmount:t});this.opts.yoke3Dto2DZoom&&(this.scene.volScaleMultiplier=l.newZoom),this.scene.pan2Dxyzmm[3]=l.newZoom;const c=this.frac2mm(this.scene.crosshairPos),h=$7({currentPan:[this.scene.pan2Dxyzmm[0],this.scene.pan2Dxyzmm[1],this.scene.pan2Dxyzmm[2]],zoomChange:l.zoomChange,crosshairMM:[c[0],c[1],c[2]]});this.scene.pan2Dxyzmm[0]=h[0],this.scene.pan2Dxyzmm[1]=h[1],this.scene.pan2Dxyzmm[2]=h[2],this.drawScene(),this.canvas.focus(),this.sync();return}this.sliceScroll2D(t,s,r)}registerInteractions(){if(!this.canvas)throw new Error("canvas undefined");Dr(this,wo,new AbortController);const{signal:i}=Te(this,wo);this.canvas.addEventListener("mousedown",this.mouseDownListener.bind(this),{signal:i}),this.canvas.addEventListener("mouseup",this.mouseUpListener.bind(this),{signal:i}),this.canvas.addEventListener("mousemove",this.mouseMoveListener.bind(this),{signal:i}),this.canvas.addEventListener("mouseleave",this.mouseLeaveListener.bind(this),{signal:i}),this.canvas.addEventListener("touchstart",this.touchStartListener.bind(this),{signal:i}),this.canvas.addEventListener("touchend",this.touchEndListener.bind(this),{signal:i}),this.canvas.addEventListener("touchmove",this.touchMoveListener.bind(this),{signal:i}),this.canvas.addEventListener("wheel",this.wheelListener.bind(this),{signal:i}),this.canvas.addEventListener("contextmenu",this.mouseContextMenuListener.bind(this),{signal:i}),this.canvas.addEventListener("dblclick",this.resetBriCon.bind(this),{signal:i}),this.canvas.addEventListener("dragenter",this.dragEnterListener.bind(this),{signal:i}),this.canvas.addEventListener("dragover",this.dragOverListener.bind(this),{signal:i}),this.canvas.addEventListener("drop",e=>{this.dropListener(e).catch(console.error)},{signal:i}),this.canvas.setAttribute("tabindex","0"),this.canvas.addEventListener("keyup",this.keyUpListener.bind(this),{signal:i}),this.canvas.addEventListener("keydown",this.keyDownListener.bind(this),{signal:i})}dragEnterListener(i){r4(i)}dragOverListener(i){a4(i)}getFileExt(i,e=!0){return R1(i,e)}async addVolumeFromUrl(i){const e=await $i.loadFromUrl(i);return this.document.addImageOptions(e,i),e.onColormapChange=this.onColormapChange,this.mediaUrlMap.set(e,i.url),this.onVolumeAddedFromUrl&&this.onVolumeAddedFromUrl(i,e),this.addVolume(e),e}async addVolumesFromUrl(i){const e=i.map(async n=>{const s=this.getFileExt(n.name||n.url);if(s==="DCM")throw new Error("DICOM files must be loaded using useDicomLoader");if(this.loaders[s]){let l=n.url;const c=this.loaders[s].toExt;let h=n.name||n.url;if(h=h.split("/").pop(),typeof n.url=="string"){const f=n.url;try{const p=await fetch(f);if(!p.ok)throw new Error(`Failed to load file: ${p.statusText}`);l=await p.arrayBuffer()}catch(p){throw new Error(`Failed to load url ${f}: ${p}`)}}const d=await this.loaders[s].loader(l);n.url=d,n.name=`${h}.${c}`}const r={url:n.url,headers:n.headers,name:n.name,colormap:n.colormap?n.colormap:n.colorMap,colormapNegative:n.colormapNegative?n.colormapNegative:n.colorMapNegative,opacity:n.opacity,urlImgData:n.urlImgData,cal_min:n.cal_min,cal_max:n.cal_max,trustCalMinMax:this.opts.trustCalMinMax,isManifest:n.isManifest,frame4D:n.frame4D,limitFrames4D:n.limitFrames4D||this.opts.limitFrames4D,colorbarVisible:n.colorbarVisible},a=await $i.loadFromUrl(r);return this.document.addImageOptions(a,r),a.onColormapChange=this.onColormapChange,this.mediaUrlMap.set(a,r.url),this.onVolumeAddedFromUrl&&this.onVolumeAddedFromUrl(r,a),a}),t=await Promise.all(e);for(let n=0;n<t.length;n++)this.addVolume(t[n]);return t}getMediaByUrl(i){return i4(i,this.mediaUrlMap)}removeVolumeByUrl(i){const e=this.getMediaByUrl(i);if(e)this.removeVolume(e);else throw new Error("No volume with URL present")}async traverseFileTree(i,e="",t){return N1(i,e,t)}readDirectory(i){return s4(i)}isMeshExt(i){return t4(i)}async loadFromArrayBuffer(i,e){const t=this.getFileExt(e);if(Gh.includes(t)){await this.addMeshFromUrl({url:e,buffer:i});return}const n=dd(e);n.buffer=i,n.name=e,await this.addVolumeFromUrl(n)}async loadFromFile(i){const e=this.getFileExt(i.name);if(Gh.includes(e)){await bo.loadFromFile({file:i,gl:this.gl,name:i.name}).then(t=>{this.addMesh(t)});return}await $i.loadFromFile({file:i,name:i.name}).then(t=>{this.addVolume(t)})}useLoader(i,e,t){this.loaders=n4({loaders:this.loaders,loader:i,fileExt:e,toExt:t})}useDicomLoader(i){this.dicomLoader=i}getDicomLoader(){return this.dicomLoader}async dropListener(i){if(this.eventInBounds(i))this.opts.bounds&&(this.opts.showBoundsBorder=!0);else{this.opts.showBoundsBorder=!1;return}if(i.stopPropagation(),i.preventDefault(),!this.opts.dragAndDropEnabled)return;const e=i.dataTransfer;if(!e)return;const t=CO(e);t?await this.handleUrlDrop(t):EO(e)&&await this.handleFilesDrop(e.items,i.shiftKey,i.altKey),this.drawScene()}async handleUrlDrop(i){const e=this.getFileExt(i);switch(X.debug("dropped ext:",e),Wb(e)){case"mesh":await this.addMeshFromUrl({url:i});break;case"document":await this.loadDocumentFromUrl(i);break;default:await this.addVolumeFromUrl(dd(i))}}async handleFilesDrop(i,e,t){!e&&!t&&(this.volumes=[],this.overlays=[],this.meshes=[]),this.closeDrawing(),this.closePAQD();const n=wO(i);for(const{entry:r,pairedEntry:a}of n)await this.handleFileEntry(r,a,t);const s=SO(i);for(const r of s)await this.handleDirectoryDrop(r)}async handleFileEntry(i,e,t){const n=this.getFileExt(i.name);if(this.loaders[n]){const a=await nB(i);await this.loadImages([{url:a,name:i.name}]);return}const s=await Kb(i);switch(Wb(n)){case"mesh":await this.handleMeshFileDrop(s);break;case"document":await this.handleDocumentFileDrop(s);break;default:await this.handleVolumeFileDrop(s,e,t)}}async handleMeshFileDrop(i){try{const e=await bo.loadFromFile({file:i,gl:this.gl,name:i.name});this.addMesh(e)}catch(e){console.error("Error loading mesh:",e)}}async handleDocumentFileDrop(i){try{const e=await A0.loadFromFile(i);await this.loadDocument(e),X.debug("loaded document")}catch(e){console.error("Error loading document:",e)}}async handleVolumeFileDrop(i,e,t){try{let n;e&&(n=await Kb(e));const s=await $i.loadFromFile({file:i,urlImgData:n,limitFrames4D:this.opts.limitFrames4D});t?(X.debug("alt key detected: assuming this is a drawing overlay"),this.drawClearAllUndoBitmaps(),this.loadDrawing(s)):this.addVolume(s)}catch(n){console.error("Error loading volume:",n)}}async handleDirectoryDrop(i){try{const e=await this.traverseFileTree(i,"",[]),t=this.getDicomLoader().loader;if(!t)throw new Error("No loader for DICOM files");const s=(await t(e)).map(a=>$i.loadFromUrl({url:a.data,name:a.name,limitFrames4D:this.opts.limitFrames4D})),r=await Promise.all(s);await this.onDicomLoaderFinishedWithImages(r)}catch(e){console.error("Error loading DICOM files:",e)}}setMultiplanarPadPixels(i){this.opts.multiplanarPadPixels=i,this.drawScene()}setMultiplanarLayout(i){typeof i=="string"&&(i=parseInt(i)),this.opts.multiplanarLayout=i,this.drawScene()}setCornerOrientationText(i){this.opts.isCornerOrientationText=i,this.updateGLVolume()}setIsOrientationTextVisible(i){this.opts.isOrientationTextVisible=i,this.drawScene()}setShowAllOrientationMarkers(i){this.opts.showAllOrientationMarkers=i,this.drawScene()}setHeroImage(i){this.opts.heroImageFraction=i,this.drawScene()}setCustomLayout(i){const e=LO({layout:i});if(!e.valid&&e.error)throw new Error(e.error);this.customLayout=i,this.drawScene()}clearCustomLayout(){this.customLayout=null,this.drawScene()}getCustomLayout(){return this.customLayout}setRadiologicalConvention(i){this.opts.isRadiologicalConvention=i,this.updateGLVolume()}setDefaults(i={},e=!1){this.document.opts={...Jn},this.scene.sceneData={...mc};for(const t in i)typeof i[t]=="function"?this[t]=i[t]:this.opts[t]=Jn[t]===void 0?Jn[t]:i[t];if(this.scene.pan2Dxyzmm=[0,0,0,1],e&&this.volumes&&this.volumes.length>0)for(let t=0;t<this.volumes.length;t++)this.volumes[t].cal_min=this.volumes[t].robust_min,this.volumes[t].cal_max=this.volumes[t].robust_max;this.updateGLVolume()}setMeshThicknessOn2D(i){this.opts.meshThicknessOn2D=i,this.updateGLVolume()}setSliceMosaicString(i){this.sliceMosaicString=i,this.updateGLVolume()}setSliceMM(i){this.opts.isSliceMM=i,this.updateGLVolume()}setAdditiveBlend(i){this.opts.isAdditiveBlend=i,this.updateGLVolume()}getRadiologicalConvention(){return this.opts.isRadiologicalConvention}setHighResolutionCapable(i){typeof i=="boolean"&&(i=i?0:-1),this.opts.forceDevicePixelRatio=i,this.resizeListener(),this.drawScene()}watchOptsChanges(i){this.onOptsChange=i}unwatchOptsChanges(){this.onOptsChange=()=>{}}addVolume(i){const e=RL(this.volumes,i);this.volumes=e.volumes,this.setVolume(i,e.index),this.onImageLoaded(i),X.debug("loaded volume",i.name),X.debug(i)}addMesh(i){const e=mk(this.meshes,i);this.meshes=e.meshes,this.setMesh(i,e.index),this.onMeshLoaded(i)}getVolumeIndexByID(i){return Qo(this.volumes,i)}drawAddUndoBitmap(i=!0){const e=yU({drawBitmap:this.drawBitmap,drawUndoBitmaps:this.drawUndoBitmaps,currentDrawUndoBitmap:this.currentDrawUndoBitmap,maxDrawUndoBitmaps:this.opts.maxDrawUndoBitmaps,drawFillOverwrites:i});this.drawBitmap=e.drawBitmap,this.drawUndoBitmaps=e.drawUndoBitmaps,this.currentDrawUndoBitmap=e.currentDrawUndoBitmap,e.needsRefresh&&this.refreshDrawing(!1)}drawClearAllUndoBitmaps(){const i=vU(this.drawUndoBitmaps,this.opts.maxDrawUndoBitmaps);this.drawUndoBitmaps=i.drawUndoBitmaps,this.currentDrawUndoBitmap=i.currentDrawUndoBitmap}drawUndo(){const{drawBitmap:i,currentDrawUndoBitmap:e}=hU({drawUndoBitmaps:this.drawUndoBitmaps,currentDrawUndoBitmap:this.currentDrawUndoBitmap,drawBitmap:this.drawBitmap});this.drawBitmap=i,this.currentDrawUndoBitmap=e,this.refreshDrawing(!0)}loadDrawing(i){if(this.drawBitmap&&X.debug("Overwriting open drawing!"),!this.back)throw new Error("back undefined");this.drawClearAllUndoBitmaps();const e=i.hdr.dims;if(!wU({drawingDims:e,backgroundDims:this.back.hdr.dims}))return X.debug("drawing dimensions do not match background image"),!1;i.img.constructor!==Uint8Array&&X.debug("Drawings should be UINT8");const t=i.permRAS,n=M0(e);this.drawBitmap=D0(n),this.opts.is2DSliceShader?this.drawTexture=this.r8Tex2D(this.drawTexture,ct.TEXTURE7_DRAW,this.back.dims,!0):this.drawTexture=this.r8Tex(this.drawTexture,ct.TEXTURE7_DRAW,this.back.dims,!0);const s=xU({permRAS:t,dims:e});return this.drawBitmap=bU({inputData:i.img,dims:e,xlut:s.xlut,ylut:s.ylut,zlut:s.zlut}),this.drawAddUndoBitmap(),this.refreshDrawing(!1),this.drawScene(),!0}binarize(i){const e=XU({img:i.img,dims:i.hdr.dims});i.img=e.img,i.hdr.datatypeCode=e.datatypeCode,i.hdr.cal_min=e.cal_min,i.hdr.cal_max=e.cal_max}async loadDrawingFromUrl(i,e=!1){this.drawBitmap&&X.debug("Overwriting open drawing!"),this.drawClearAllUndoBitmaps();let t=!1;try{const n=await $i.loadFromUrl(dd(i));e&&await this.binarize(n),t=this.loadDrawing(n)}catch{X.error("loadDrawingFromUrl() failed to load "+i),this.drawClearAllUndoBitmaps()}return t}findOtsu(i=2){return this.volumes.length<1?[]:WU({img:this.volumes[0].img,cal_min:this.volumes[0].cal_min,cal_max:this.volumes[0].cal_max,scl_inter:this.volumes[0].hdr.scl_inter,scl_slope:this.volumes[0].hdr.scl_slope,mlevel:i})}drawOtsu(i=2){if(this.volumes.length===0)return;const e=this.findOtsu(i);if(e.length<3)return;this.drawBitmap||this.createEmptyDrawing();const t=KU({img:this.volumes[0].img,drawBitmap:this.drawBitmap,thresholds:e});this.drawBitmap.set(t),this.drawAddUndoBitmap(),this.refreshDrawing(!0)}removeHaze(i=5,e=0){const t=this.volumes[e].img,n=this.volumes[e].hdr,s=QU({level:i}),r=this.findOtsu(s);if(r.length<3)return;const a=ZU({level:i,thresholds:r});JU({img:t,scl_inter:n.scl_inter,scl_slope:n.scl_slope,global_min:this.volumes[e].global_min,threshold:a}),this.refreshLayers(this.volumes[e],0),this.drawScene()}async saveImage(i=rw){const e={...rw,...i},{filename:t,isSaveDrawing:n,volumeByIndex:s}=e;return X.debug("saveImage",t,n,s),this.back?.dims===void 0?(X.debug("No voxelwise image open"),!1):n?this.drawBitmap?await this.volumes[0].saveToDisk(t,this.drawBitmap):(X.debug("No drawing open"),!1):(X.debug("saving image"),this.volumes[s].saveToDisk(t))}getMeshIndexByID(i){return Ur(this.meshes,i)}setMeshProperty(i,e,t){const n=gk({meshes:this.meshes,id:i,key:e,val:t,gl:this.gl});n<0||(this.updateGLVolume(),this.onMeshPropertyChanged(n,e,t))}indexNearestXYZmm(i,e,t,n){return Ak({meshes:this.meshes,meshId:i,Xmm:e,Ymm:t,Zmm:n})}decimateHierarchicalMesh(i,e=3){const t=vk({meshes:this.meshes,meshId:i,gl:this.gl,order:e});return t&&this.updateGLVolume(),t}reverseFaces(i){yk({meshes:this.meshes,meshId:i,gl:this.gl})&&this.updateGLVolume()}async setMeshLayerProperty(i,e,t,n){await xk({meshes:this.meshes,meshId:i,layer:e,key:t,val:n,gl:this.gl})&&this.updateGLVolume()}setPan2Dxyzmm(i){this.scene.pan2Dxyzmm=i,this.opts.yoke3Dto2DZoom&&(this.scene.volScaleMultiplier=i[3]),this.drawScene()}setRenderAzimuthElevation(i,e){this.scene.renderAzimuth=i,this.scene.renderElevation=e,this.onAzimuthElevationChange(i,e),this.drawScene()}getOverlayIndexByID(i){return NL(this.volumes,i)}setVolume(i,e=0){const t=Zo(this.volumes,i,e);this.volumes=t.volumes,this.back=t.back,this.overlays=t.overlays,this.updateGLVolume()}setMesh(i,e=0){this.meshes.forEach(n=>{X.debug("MESH: ",n.name)});const t=pk(this.meshes,i,e);this.meshes=t.meshes,this.updateGLVolume(),this.meshes.forEach(n=>{X.debug(n.name)})}removeVolume(i){const e=J3(this.volumes,i);if(this.volumes=e.volumes,this.back=this.volumes.length>0?this.volumes[0]:null,this.overlays=this.volumes.slice(1),this.mediaUrlMap.has(i)){const t=this.mediaUrlMap.get(i);this.onVolumeWithUrlRemoved(t),this.mediaUrlMap.delete(i)}this.updateGLVolume(),this.drawScene()}removeVolumeByIndex(i){const e=IL(this.volumes,i);e.removed&&this.removeVolume(e.removed)}removeMesh(i){if(i.unloadMesh(this.gl),this.setMesh(i,-1),this.mediaUrlMap.has(i)){const e=this.mediaUrlMap.get(i);this.onMeshWithUrlRemoved(e),this.mediaUrlMap.delete(i)}}removeMeshByUrl(i){const e=this.getMediaByUrl(i);e&&(this.removeMesh(e),this.mediaUrlMap.delete(e),this.onMeshWithUrlRemoved(i))}moveVolumeToBottom(i){const e=_L(this.volumes,i);this.volumes=e.volumes,this.back=e.back,this.overlays=e.overlays,this.updateGLVolume()}moveVolumeUp(i){const e=FL(this.volumes,i);this.volumes=e.volumes,this.back=e.back,this.overlays=e.overlays,this.updateGLVolume()}moveVolumeDown(i){const e=PL(this.volumes,i);this.volumes=e.volumes,this.back=e.back,this.overlays=e.overlays,this.updateGLVolume()}moveVolumeToTop(i){const e=BL(this.volumes,i);this.volumes=e.volumes,this.back=e.back,this.overlays=e.overlays,this.updateGLVolume()}mouseDown(i,e){const t=pg({x:i,y:e,dpr:this.uiData.dpr});this.mousePos=t.mousePos}updateMousePos(i,e){const t=pg({x:i,y:e,dpr:this.uiData.dpr});return this.mousePos=t.mousePos,t.mousePos}mouseMove(i,e){const t=h4({x:i,y:e,dpr:this.uiData.dpr,currentMousePos:this.mousePos});if(this.mousePos=t.mousePos,this.inRenderTile(t.scaledX,t.scaledY)<0||!ZO({dx:t.dx,dy:t.dy}))return;const n=QO({currentAzimuth:this.scene.renderAzimuth,currentElevation:this.scene.renderElevation,deltaX:t.dx,deltaY:t.dy});this.scene.renderAzimuth=n.azimuth,this.scene.renderElevation=n.elevation,this.drawScene()}sph2cartDeg(i,e){return gf(i,e)}setClipPlanes(i){const e=aU({depthAziElevs:i});this.scene.clipPlanes=e.clipPlanes,this.scene.clipPlaneDepthAziElevs=e.clipPlaneDepthAziElevs,this.drawScene()}setClipPlane(i){if(!cU(i))return;const e=this.uiData.activeClipPlaneIndex??0,t=lU({clipPlanes:this.scene.clipPlanes,clipPlaneDepthAziElevs:this.scene.clipPlaneDepthAziElevs,index:e,depthAzimuthElevation:i});this.scene.clipPlanes=t.clipPlanes,this.scene.clipPlaneDepthAziElevs=t.clipPlaneDepthAziElevs,this.onClipPlaneChange(t.clipPlane),this.drawScene()}setCrosshairColor(i){this.opts.crosshairColor=i,this.drawScene()}setCrosshairWidth(i){this.opts.crosshairWidth=i,this.crosshairs3D&&(this.crosshairs3D.mm[0]=NaN),this.drawScene()}setDrawColormap(i){this.drawLut=yt.makeDrawLut(i),this.updateGLVolume()}setDrawingEnabled(i){if(this.opts.drawingEnabled=i,this.opts.drawingEnabled)this.drawBitmap||this.createEmptyDrawing();else{const e=CU({clickToSegmentIsGrowing:this.clickToSegmentIsGrowing,drawPenLocation:this.drawPenLocation,drawPenAxCorSag:this.drawPenAxCorSag,drawPenFillPts:this.drawPenFillPts,drawShapeStartLocation:this.drawShapeStartLocation,drawShapePreviewBitmap:this.drawShapePreviewBitmap,drawBitmap:this.drawBitmap});this.clickToSegmentIsGrowing=e.clickToSegmentIsGrowing,this.drawPenLocation=e.drawPenLocation,this.drawPenAxCorSag=e.drawPenAxCorSag,this.drawPenFillPts=e.drawPenFillPts,this.drawShapeStartLocation=e.drawShapeStartLocation,this.drawShapePreviewBitmap=e.drawShapePreviewBitmap,this.drawBitmap=e.drawBitmap,e.needsRefresh&&this.refreshDrawing(!0,!1)}this.drawScene()}setPenValue(i,e=!1){this.opts.penValue=i,this.opts.isFilledPen=e,this.drawScene()}setDrawOpacity(i){this.drawOpacity=i,this.drawScene()}setSelectionBoxColor(i){this.opts.selectionBoxColor=i}setBounds(i){if(!Array.isArray(i)||i.length!==4)throw new Error("setBounds: expected [x1,y1,x2,y2] array");this.opts.bounds=[[i[0],i[1]],[i[2],i[3]]],this.gl&&this.drawScene()}sliceScroll2D(i,e,t,n=!0){if(!PO({scrollRequiresFocus:this.opts.scrollRequiresFocus,canvasHasFocus:this.canvas===document.activeElement})){X.warn("Canvas element does not have focus. Scroll events will not be processed.");return}if(this.inGraphTile(e,t)){let r=this.volumes[0].frame4D;i>0&&r++,i<0&&r--,this.setFrame4D(this.volumes[0].id,r);return}const s=this.inRenderTile(this.uiData.dpr*e,this.uiData.dpr*t)!==-1;if(BO({posChange:i,dragMode:this.opts.dragMode,isInRenderTile:s})){const r=this.frac2mm(this.scene.crosshairPos),a=_O({posChange:i,currentZoom:this.scene.pan2Dxyzmm[3],yoke3Dto2DZoom:this.opts.yoke3Dto2DZoom,crosshairMM:r});a.newVolScaleMultiplier!==void 0&&(this.scene.volScaleMultiplier=a.newVolScaleMultiplier),this.scene.pan2Dxyzmm[3]=a.newZoom,this.scene.pan2Dxyzmm[0]+=a.panOffsetX,this.scene.pan2Dxyzmm[1]+=a.panOffsetY,this.scene.pan2Dxyzmm[2]+=a.panOffsetZ,this.drawScene(),this.canvas.focus(),this.sync();return}this.mouseClick(e,t,i,n)}setSliceType(i){return this.opts.sliceType=i,this.drawScene(),this}setOpacity(i,e){LL(this.volumes,i,e),this.updateGLVolume()}setScale(i){this.scene.volScaleMultiplier=i,this.drawScene()}setClipPlaneColor(i){this.opts.clipPlaneColor=i,this.renderShader.use(this.gl),this.gl.uniform4fv(this.renderShader.uniforms.clipPlaneColor,this.opts.clipPlaneColor),this.drawScene()}setClipPlaneThick(i){X.warn("setClipPlaneThick() has been removed. use setClipPlanes() instead.")}setClipVolume(i,e){X.warn("setClipVolume() has been removed. use setClipPlanes() instead.")}async setVolumeRenderIllumination(i=0){this.renderGradientValues=Number.isNaN(i),this.renderShader=this.renderVolumeShader,this.renderGradientValues?this.renderShader=this.renderGradientValuesShader:(this.opts.gradientAmount=i,i>0||this.opts.gradientOpacity>0?this.renderShader=this.renderGradientShader:i<0&&(this.renderShader=this.renderSliceShader)),this.initRenderShader(this.renderShader,i),this.renderShader.use(this.gl),this.setClipPlaneColor(this.opts.clipPlaneColor),Number.isNaN(i)?this.gradientTextureAmount=1:this.gradientTextureAmount=i,!(this.volumes.length<1)&&(await this.refreshLayers(this.volumes[0],0),this.drawScene())}async setGradientOpacity(i=0,e=0){this.opts.gradientOpacity=i,this.opts.renderSilhouette=e,this.renderGradientValues?this.renderShader=this.renderGradientValuesShader:this.gradientTextureAmount>0||i>0?this.renderShader=this.renderGradientShader:this.gradientTextureAmount<0&&(this.renderShader=this.renderSliceShader),this.initRenderShader(this.renderShader,this.gradientTextureAmount),this.renderShader.use(this.gl),this.gradientTextureAmount>0&&this.refreshLayers(this.volumes[0],0),this.drawScene()}overlayRGBA(i){return VL(i)}vox2mm(i,e){return uB(i,e)}cloneVolume(i){return kL(this.volumes,i)}async loadDocumentFromUrl(i){const e=await A0.loadFromUrl(i);await this.loadDocument(e)}async loadDocument(i){this.volumes=[],this.meshes=[],this.document=i,this.document.labels=this.document.labels?this.document.labels:[];const e={...Jn,...i.opts};this.scene.pan2Dxyzmm=i.scene.pan2Dxyzmm?i.scene.pan2Dxyzmm:[0,0,0,1],this.document.opts=e,this.scene.clipPlaneDepthAziElevs&&this.setClipPlane(this.scene.clipPlaneDepthAziElevs[this.uiData.activeClipPlaneIndex??0]),X.debug("load document",i),this.mediaUrlMap.clear(),this.createEmptyDrawing();const t=i.encodedImageBlobs;for(let s=0;s<i.imageOptionsArray.length;s++){const r=i.imageOptionsArray[s],a=t[s];if(a){"colorMap"in r&&(r.colormap=r.colorMap);const l=await $i.loadFromBase64({base64:a,...r});if(l){if(l.colormapLabel){const c=Object.keys(l.colormapLabel.lut).length,h=new Uint8ClampedArray(c);for(const d in l.colormapLabel.lut)h[d]=l.colormapLabel.lut[d];l.colormapLabel.lut=h}this.addVolume(l)}}}this.volumes.length>0&&(this.back=this.volumes[0]);for(const s of i.meshDataObjects??[]){const r={gl:this.gl,...s};s.offsetPt0&&(r.rgba255[3]=0,r.tris=new Uint32Array(s.offsetPt0)),X.debug(r);const a=new bo(r.pts,r.tris,r.name,r.rgba255,r.opacity,r.visible,this.gl,r.connectome,r.dpg,r.dps,r.dpv);s.offsetPt0&&(a.fiberGroupColormap=s.fiberGroupColormap,a.fiberColor=s.fiberColor,a.fiberDither=s.fiberDither,a.fiberRadius=s.fiberRadius,a.colormap=s.colormap),a.meshShaderIndex=r.meshShaderIndex,a.layers=r.layers,a.updateMesh(this.gl),X.debug(a),this.addMesh(a)}if(i.data.connectomes)for(const s of i.data.connectomes){const r=JSON.parse(s),a=this.loadConnectomeAsMesh(r);a.updateMesh(this.gl),this.addMesh(a)}this.createEmptyDrawing();const n=i.encodedDrawingBlob;if(n){const s=await Ve.b64toUint8(n);if(s){const r=this.back.dims;let a=r[1]*r[2]*r[3];if(s.length-352===a&&(a+=352),s.length!==a)throw new Error(`drawBitmap size does not match the texture dimensions (${r[1]}${r[2]}${r[3]}) ${a} != ${r[1]*r[2]*r[3]}.`);this.drawBitmap=s,this.refreshDrawing()}}return await this.setGradientOpacity(this.opts.gradientOpacity),await this.setVolumeRenderIllumination(this.opts.gradientAmount),this.updateGLVolume(),this.drawScene(),this.onDocumentLoaded(i),this}async generateLoadDocumentJavaScript(i,e){const t=this.json(),n=await Ve.compressToBase64String(JSON.stringify(t));return`
        ${e}

        async function saveNiivueAsHtml(pageName) {
          //get new docstring
          const docString = nv1.json();
          const html =
          document.getElementsByTagName("html")[0]
              .innerHTML.replace(base64, await NVUtilities.compressToBase64String(JSON.stringify(docString)));
          NVUtilities.download(html, pageName, "application/html");
        }

        var nv1 = new Niivue();
        await nv1.attachTo("${i}");
        var base64 = "${n}";
        NVUtilities.decompressBase64String(base64).then((jsonText) => {
          var json = JSON.parse(jsonText); // string -> JSON
          var doc = NVDocument.loadFromJSON(json);
          nv1.loadDocument(doc);
          nv1.updateGLVolume();
        });

      `}async generateHTML(i="gl1",e){return`<!DOCTYPE html>
        <html lang="en">
          <head>
            <meta charset="utf-8" />
            <meta http-equiv="X-UA-Compatible" content="IE=edge" />
            <meta name="viewport" content="width=device-width,initial-scale=1.0" />
            <title>Save as HTML</title>
            <style>
            html {
              height: auto;
              min-height: 100%;
              margin: 0;
            }
            body {
              display: flex;
              flex-direction: column;
              margin: 0;
              min-height: 100%;
              width: 100%;
              position: absolute;
              font-family: system-ui, Arial, Helvetica, sans-serif;
              background: #ffffff;
              color: black;
              user-select: none; /* Standard syntax */
            }
            header {
              margin: 10px;
            }
            main {
              flex: 1;
              background: #000000;
              position: relative;
            }
            footer {
              margin: 10px;
            }
            canvas {
              position: absolute;
              cursor: crosshair;
            }
            canvas:focus {
              outline: 0px;
            }
            div {
              display: table-row;
              background-color: blue;
            }
            </style>
          </head>
          <body>
            <noscript>niivue requires JavaScript.</noscript>
            <header>
            Save the current scene as HTML
            <button id="save">Save as HTML</button>
            </header>
            <main>
              <canvas id="gl1"></canvas>
            </main>
            <script type="module" async>
              ${await this.generateLoadDocumentJavaScript(i,e)}
              function saveAsHtml() {
                saveNiivueAsHtml("page.html");
              }
              // assign our event handler
              var button = document.getElementById("save");
              button.onclick = saveAsHtml;
            <\/script>
          </body>
        </html>`}async saveHTML(i="untitled.html",e="gl1",t){const n=await this.generateHTML(e,t);return Ve.download(n,i,"application/html")}json(){return this.document.opts=this.opts,this.document.scene=this.scene,this.document.volumes=this.volumes,this.document.meshes=this.meshes,this.drawScene(),this.document.previewImageDataURL=this.canvas.toDataURL(),this.document.json()}async saveDocument(i="untitled.nvd",e=!0,t={}){const{embedImages:n=!0,embedPreview:s=!0}=t;this.document.title=i,this.document.volumes=this.volumes,this.document.meshes=this.meshes,s?(this.drawScene(),this.document.previewImageDataURL=this.canvas.toDataURL()):this.document.previewImageDataURL="",await this.document.download(i,e,{embedImages:n})}async loadImages(i){const e=[],t=[];for(const n of i)if("url"in n){const s=this.getFileExt(n.name?n.name:n.url);if(this.loaders[s]){const r=this.loaders[s].toExt.toUpperCase();Gh.includes(r)?t.push(n):e.push(n);continue}Gh.includes(s.toUpperCase())?t.push(n):e.push(n)}return e.length>0&&await this.loadVolumes(e),t.length>0&&await this.loadMeshes(t),this}async loadDicoms(i){if(!this.getDicomLoader())throw new Error("No dicom loader set. Please set a dicom loader before loading dicoms");this.drawScene(),this.volumes=[];const e=i.map(async n=>{let s=null;if(n.isManifest)s=await $i.fetchDicomData(n.url);else{const d=await fetch(n.url);if(!d.ok)throw new Error(`Failed to load file: ${d.statusText}`);const f=await d.arrayBuffer();s=[{name:n.url.split("/").pop(),data:f}]}const r=this.getDicomLoader().loader,a=await r(s),l=a[0].name,c=a[0].data;return await $i.loadFromUrl({url:c,name:l})}),t=await Promise.all(e);return t.length===1?this.addVolume(t[0]):this.onDicomLoaderFinishedWithImages(t),this}async loadVolumes(i){return this.drawScene(),this.thumbnailVisible?(this.deferredVolumes=i,this):(this.volumes=[],this.closePAQD(),await this.addVolumesFromUrl(i),this)}async addMeshFromUrl(i){const e=this.getFileExt(i.url);if(e==="JCON"||e==="JSON"){let n;if(i.buffer){const r=ArrayBuffer.isView(i.buffer)?i.buffer:new Uint8Array(i.buffer),a=new TextDecoder("utf-8").decode(r);n=JSON.parse(a)}else n=await(await fetch(i.url)).json();const s=this.loadConnectomeAsMesh(n);return this.mediaUrlMap.set(s,i.url),this.onMeshAddedFromUrl(i,s),this.addMesh(s),s}const t=await bo.loadFromUrl({...i,gl:this.gl});return this.mediaUrlMap.set(t,i.url),this.onMeshAddedFromUrl(i,t),this.addMesh(t),t}async addMeshesFromUrl(i){const e=i.map(async n=>{const s=this.getFileExt(n.name||n.url);if(this.loaders[s]){let a=n.url;const l=this.loaders[s].toExt;let c=n.name||n.url;if(c=c.split("/").pop(),typeof n.url=="string"){const x=n.url;try{const b=await fetch(x);if(!b.ok)throw new Error(`Failed to load file: ${b.statusText}`);a=await b.arrayBuffer()}catch(b){throw new Error(`Failed to load url ${x}: ${b}`)}}const{positions:h,indices:d,colors:f=null,scalars:p=null,colormapLabel:g=null}=await this.loaders[s].loader(a);n.name=`${c}.${l}`;const y=await la.createMZ3Async(h,d,!1,f,p,g);n.buffer=y}if(s==="JCON"||s==="JSON"){const l=await(await fetch(n.url,{})).json(),c=this.loadConnectomeAsMesh(l);return this.mediaUrlMap.set(c,n.url),this.onMeshAddedFromUrl(n,c),c}const r=await bo.loadFromUrl({...n,gl:this.gl});return this.mediaUrlMap.set(r,n.url),this.onMeshAddedFromUrl(n,r),r}),t=await Promise.all(e);for(let n=0;n<t.length;n++)this.addMesh(t[n]);return t}async loadMeshes(i){return this.drawScene(),this.thumbnailVisible?(this.deferredMeshes=i,this):(this.initialized,this.meshes=[],await this.addMeshesFromUrl(i),this.updateGLVolume(),this.drawScene(),this)}async loadConnectomeFromUrl(i,e={}){const n=await(await fetch(i,{headers:e})).json();return this.loadConnectome(n)}async loadFreeSurferConnectomeFromUrl(i,e={}){const n=await(await fetch(i,{headers:e})).json();return this.loadFreeSurferConnectome(n)}async loadFreeSurferConnectome(i){const e=Ad.convertFreeSurferConnectome(i);return this.loadConnectome(e)}handleNodeAdded(i){const e=Sk(i.detail.node);this.addLabel(e.text,e.style,e.position),this.drawScene()}loadConnectomeAsMesh(i){return wk({gl:this.gl,json:i})}loadConnectome(i){this.drawScene(),this.meshes=[];const e=this.loadConnectomeAsMesh(i);return this.addMesh(e),this.drawScene(),this}createEmptyDrawing(){if(this.back===null||!this.back.dims||Math.min(Math.min(this.back.dims[1],this.back.dims[2]),this.back.dims[3])<1)return;const e=M0(this.back.dims);this.drawBitmap=D0(e),this.clickToSegmentGrowingBitmap=D0(e),this.drawClearAllUndoBitmaps(),this.drawAddUndoBitmap(),this.opts.is2DSliceShader?this.drawTexture=this.r8Tex2D(this.drawTexture,ct.TEXTURE7_DRAW,this.back.dims):this.drawTexture=this.r8Tex(this.drawTexture,ct.TEXTURE7_DRAW,this.back.dims,!0),this.refreshDrawing(!1)}drawGrowCut(){if(!this.back||!this.back.dims)throw new Error("back not defined");const i=this.back.hdr,e=this.gl,t=i.dims[1]*i.dims[2]*i.dims[3];if(!this.drawBitmap||this.drawBitmap.length!==t){X.debug("bitmap dims are wrong");return}const n=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,n),e.disable(e.CULL_FACE),e.viewport(0,0,this.back.dims[1],this.back.dims[2]),e.disable(e.BLEND);let s=sB(this.back);const r=this.r16Tex(null,ct.TEXTURE11_GC_BACK,this.back.dims,s);for(let E=1;E<t;E++)s[E]=this.drawBitmap[E];const a=this.r16Tex(null,ct.TEXTURE14_GC_LABEL0,this.back.dims,s),l=this.r16Tex(null,ct.TEXTURE15_GC_LABEL1,this.back.dims,s),c=1e4;for(let E=1;E<t;E++)s[E]>0&&(s[E]=c);const h=this.r16Tex(null,ct.TEXTURE12_GC_STRENGTH0,this.back.dims,s),d=this.r16Tex(null,ct.TEXTURE13_GC_STRENGTH1,this.back.dims,s);e.bindVertexArray(this.genericVAO);const f=this.growCutShader;f.use(e);const p=128;e.uniform1i(f.uniforms.finalPass,0),e.uniform1i(f.uniforms.backTex,11);for(let E=0;E<p;E++){e.uniform1i(f.uniforms.labelTex,14),e.uniform1i(f.uniforms.strengthTex,12);for(let D=0;D<this.back.dims[3];D++){const M=1/this.back.dims[3]*(D+.5);e.uniform1f(f.uniforms.coordZ,M),e.framebufferTextureLayer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,l,0,D),e.framebufferTextureLayer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT1,d,0,D),e.drawBuffers([e.COLOR_ATTACHMENT0,e.COLOR_ATTACHMENT1]),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE&&X.error("Incomplete framebuffer"),e.drawArrays(e.TRIANGLE_STRIP,0,4)}E===p-1&&e.uniform1i(f.uniforms.finalPass,1),e.uniform1i(f.uniforms.labelTex,15),e.uniform1i(f.uniforms.strengthTex,13);for(let D=0;D<this.back.dims[3];D++){const M=1/this.back.dims[3]*(D+.5);e.uniform1f(f.uniforms.coordZ,M),e.framebufferTextureLayer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,a,0,D),e.framebufferTextureLayer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT1,h,0,D),e.drawBuffers([e.COLOR_ATTACHMENT0,e.COLOR_ATTACHMENT1]),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE&&X.error("Incomplete framebuffer"),e.drawArrays(e.TRIANGLE_STRIP,0,4)}}e.drawBuffers([e.COLOR_ATTACHMENT0]);const g=e.COLOR_ATTACHMENT1,y=a;e.readBuffer(g);const x=e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT),b=e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE);(x!==e.RED_INTEGER||b!==e.SHORT)&&X.debug("readPixels will fail."),s=new Int16Array;const w=this.back.dims[1]*this.back.dims[2],S=new Int16Array(w);for(let E=0;E<this.back.dims[3];E++)e.framebufferTextureLayer(e.FRAMEBUFFER,g,y,0,E),e.readPixels(0,0,this.back.dims[1],this.back.dims[2],x,b,S),s=Int16Array.from([...s,...S]);let C=s[0];for(let E=0;E<s.length;E++)C=Math.max(C,s[E]);for(let E=1;E<t;E++)this.drawBitmap[E]=s[E];e.deleteTexture(r),e.deleteTexture(h),e.deleteTexture(d),e.deleteTexture(a),e.deleteTexture(l),e.bindVertexArray(this.unusedVAO),e.viewport(0,0,e.canvas.width,e.canvas.height),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteFramebuffer(n),this.drawAddUndoBitmap(),this.refreshDrawing(!0)}drawPt(i,e,t,n,s=null){const r=s??this.drawBitmap;if(!r)throw new Error("drawBitmap not set");if(!this.back?.dims)throw new Error("back.dims not set");Io({x:i,y:e,z:t,penValue:n,drawBitmap:r,dims:this.back.dims,penSize:this.opts.penSize,penAxCorSag:this.drawPenAxCorSag})}drawPenLine(i,e,t){if(!this.drawBitmap)throw new Error("drawBitmap not set");if(!this.back?.dims)throw new Error("back.dims not set");MU({ptA:i,ptB:e,penValue:t,drawBitmap:this.drawBitmap,dims:this.back.dims,penSize:this.opts.penSize,penAxCorSag:this.drawPenAxCorSag})}drawRectangleMask(i,e,t){if(!this.drawBitmap)throw new Error("drawBitmap not set");if(!this.back?.dims)throw new Error("back.dims not set");_U({ptA:i,ptB:e,penValue:t,drawBitmap:this.drawBitmap,dims:this.back.dims,penSize:this.opts.penSize,penAxCorSag:this.drawPenAxCorSag})}drawEllipseMask(i,e,t){if(!this.drawBitmap)throw new Error("drawBitmap not set");if(!this.back?.dims)throw new Error("back.dims not set");FU({ptA:i,ptB:e,penValue:t,drawBitmap:this.drawBitmap,dims:this.back.dims,penSize:this.opts.penSize,penAxCorSag:this.drawPenAxCorSag})}drawingBinaryDilationWithSeed(i,e=6){try{let t=function(b){return b[0]+b[1]*l+b[2]*c};const n=this.drawBitmap,s=this.back.dims[1],r=this.back.dims[2],a=this.back.dims[3],l=s,c=s*r,h=c*a,d=t(i);if(d<0||d>=h)throw new Error("Seed index is out of bounds.");const f=n[d];if(f===0)throw new Error("Seed voxel is not part of a filled cluster.");const p=n.slice();for(let b=0;b<h;b++)p[b]=p[b]===f?1:0;this.drawFloodFillCore(p,d,e);const g=n.slice(),y=[],x=[-c,c,-s,s,-1,1];y.push(...x),e>6&&y.push(-s-1,-s+1,s-1,s+1,-c-s,-c+s,-c-1,-c+1,c-s,c+s,c-1,c+1),e>18&&y.push(-c-s-1,-c-s+1,-c+s-1,-c+s+1,c-s-1,c-s+1,c+s-1,c+s+1);for(let b=0;b<h;b++)if(p[b]===2){const w=b%s,S=Math.floor(b%c/s),C=Math.floor(b/c);for(const E of y){const D=b+E;if(D<0||D>=h)continue;const M=D%s,N=Math.floor(D%c/s),I=Math.floor(D/c);Math.abs(M-w)>1||Math.abs(N-S)>1||Math.abs(I-C)>1||n[D]===0&&(g[D]=f)}}this.drawBitmap=g,this.drawAddUndoBitmap(),this.refreshDrawing(!0)}catch(t){X.error("Error in drawingBinaryDilationWithSeed:",t)}}drawFloodFillCore(i,e,t=6){if(!this.back?.dims)throw new Error("back.dims undefined");const n=[this.back.dims[1],this.back.dims[2],this.back.dims[3]];kU({img:i,seedVx:e,dims:n,neighbors:t})}drawFloodFill(i,e=0,t=0,n=NaN,s=NaN,r=6,a=Number.POSITIVE_INFINITY,l=!1,c=null,h=!1){if(!this.drawBitmap&&(X.warn("drawFloodFill called without an initialized drawBitmap."),this.createEmptyDrawing(),!this.drawBitmap)){X.error("Failed to create drawing bitmap.");return}if(this.clickToSegmentIsGrowing&&!this.clickToSegmentGrowingBitmap){if(X.warn("drawFloodFill called in preview mode without initialized clickToSegmentGrowingBitmap."),this.drawBitmap)this.clickToSegmentGrowingBitmap=this.drawBitmap.slice();else{X.error("Cannot initialize growing bitmap as drawBitmap is null.");return}if(!this.clickToSegmentGrowingBitmap){X.error("Failed to create growing bitmap.");return}}if(c===null&&(c=this.drawBitmap),!c){X.error("drawFloodFill targetBitmap is null.");return}if(!this.back?.dims)throw new Error("back.dims undefined");e=Math.abs(e);const d=[this.back.dims[1],this.back.dims[2],this.back.dims[3]];if(!GU(i,d))return;const f=A4(d),{nxyz:p}=f,g=this.clickToSegmentIsGrowing?this.drawBitmap:c;if(!g){X.error("Could not determine original bitmap state.");return}const y=new Uint8Array(p).fill(0),x=LU(l,this.drawPenAxCorSag),b=f.vx2xyz,w=f.xyz2vx,S=_=>this.vox2mm(_,this.back.matRAS),C=S(i),E=a**2;function D(_){const F=b(_);if(x>=0&&F[x]!==i[x])return!1;const B=S(F);return(B[0]-C[0])**2+(B[1]-C[1])**2+(B[2]-C[2])**2<=E}const M=w(i),N=g[M];if(h&&!HU(N)){X.debug("Grow/Erase Cluster tool requires starting on a masked voxel."),this.clickToSegmentIsGrowing&&this.clickToSegmentGrowingBitmap&&this.drawBitmap&&(this.clickToSegmentGrowingBitmap.set(this.drawBitmap),this.refreshDrawing(!0,!0));return}if(t===0&&N===e&&!h&&e!==0&&(X.debug("drawFloodFill selected voxel is already desired color"),!this.clickToSegmentIsGrowing))return;let I=NaN;if(h&&(t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)){const _=g.slice();for(let O=0;O<p;O++)_[O]=_[O]===N&&D(O)?1:0;if(_[M]!==1){X.error("Seed voxel could not be marked for cluster ID.");return}this.drawFloodFillCore(_,M,r);const F=this.volumes[0].img2RAS();I=zU({clusterImg:_,backImg:F,nxyz:p,fallbackIntensity:F[M]}),X.debug(`Grow Cluster using mean intensity: ${I.toFixed(2)} voxels.`);const[B,P]=ew(t,I,NaN,NaN);for(let O=0;O<p;O++)if(_[O]===2)y[O]=1;else if(g[O]===0){const k=F[O];k>=B&&k<=P&&D(O)&&(y[O]=1)}e=N}else if(t===0)if(h&&e===0){X.debug(`Erase Cluster: Identifying cluster with color ${N}`);for(let _=0;_<p;_++)y[_]=g[_]===N&&D(_)?1:0}else for(let _=0;_<p;_++)g[_]===N&&D(_)&&N!==0&&(y[_]=1);else{const _=this.volumes[0].img2RAS();I=_[M];const[F,B]=ew(t,I,n,s);for(let P=0;P<p;P++){const O=_[P];O>=F&&O<=B&&D(P)&&(y[P]=1)}e=g[M],e===0&&(e=this.opts.penValue,(e<1||!isFinite(e))&&(e=1))}if(y[M]!==1)if(YU(N,e,h,t)&&D(M))y[M]=1,X.debug("Forcing seed voxel to 1 in working buffer.");else{X.debug("Seed voxel not marked as candidate '1' and not valid originally."),this.clickToSegmentIsGrowing&&this.clickToSegmentGrowingBitmap&&this.drawBitmap&&this.clickToSegmentGrowingBitmap.set(this.drawBitmap);return}this.drawFloodFillCore(y,M,r),qU({img:y,targetBitmap:c,originalBitmap:g,newColor:e,nxyz:p,isPreviewMode:this.clickToSegmentIsGrowing&&c===this.clickToSegmentGrowingBitmap}),this.clickToSegmentIsGrowing?this.refreshDrawing(!0,!0):(this.drawAddUndoBitmap(),this.refreshDrawing(!0,!1))}floodFillSectionFIFO(i,e,t,n){p4({img2D:i,dims2D:e,minPt:t,maxPt:n})}drawPenFilled(){if(this.drawPenFillPts.length<2){this.drawPenFillPts=[];return}if(!this.drawBitmap)throw new Error("drawBitmap undefined");if(!this.back?.dims)throw new Error("back.dims undefined");const i=this.drawUndoBitmaps[this.currentDrawUndoBitmap]?.length>0?this.drawUndoBitmaps[this.currentDrawUndoBitmap]:null,e=RU({penFillPts:this.drawPenFillPts,penAxCorSag:this.drawPenAxCorSag,drawBitmap:this.drawBitmap,dims:this.back.dims,penValue:this.opts.penValue,fillOverwrites:this.drawFillOverwrites,currentUndoBitmap:i});e.success&&(this.drawBitmap=e.drawBitmap),this.drawPenFillPts=[],this.drawAddUndoBitmap(),this.refreshDrawing(!1)}closeDrawing(){this.drawClearAllUndoBitmaps(),this.drawTexture=this.rgbaTex(this.drawTexture,ct.TEXTURE7_DRAW,[2,2,2,2],!0),this.drawBitmap=null,this.clickToSegmentGrowingBitmap=null,this.drawScene()}refreshDrawing(i=!0,e=!1){const t=SU({useClickToSegmentBitmap:e,drawingEnabled:this.opts.drawingEnabled,clickToSegment:this.opts.clickToSegment,drawBitmap:this.drawBitmap,clickToSegmentGrowingBitmap:this.clickToSegmentGrowingBitmap});t.warning&&X.warn(`refreshDrawing: ${t.warning}`);const n=t.bitmapDataSource;if(!this.back?.dims){X.warn("refreshDrawing: back.dims undefined, cannot refresh drawing texture yet.");return}const s=M0(this.back.dims);if(!n){X.warn(`refreshDrawing: Bitmap data source (${t.useClickToSegmentBitmap?"growing":"main"}) is null. Cannot update texture.`),i&&this.drawScene();return}const r=EU(n.length,this.back.dims.slice());if(TU(n.length,s)||X.warn(`Drawing bitmap length (${n.length}) must match the background image (${s})`),this.gl.activeTexture(ct.TEXTURE7_DRAW),this.opts.is2DSliceShader){const a=this.frac2vox(this.scene.crosshairPos),l=Math.min(Math.max(a[2],0),r[3]-1),c=r[1]*r[2],h=l*c;X.debug(`refresh huge 2D drawing xyz ${r[1]}${r[2]}${r[3]} slice ${h}`);const d=n.subarray(h,h+c);this.gl.bindTexture(this.gl.TEXTURE_2D,this.drawTexture),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,r[1],r[2],this.gl.RED,this.gl.UNSIGNED_BYTE,d)}else this.gl.bindTexture(this.gl.TEXTURE_3D,this.drawTexture),this.gl.texSubImage3D(this.gl.TEXTURE_3D,0,0,0,0,r[1],r[2],r[3],this.gl.RED,this.gl.UNSIGNED_BYTE,n);if(!this.drawTexture){X.error("refreshDrawing: drawTexture (GPU texture) is null.");return}i&&this.drawScene()}closePAQD(){!this._gl||!this.paqdTexture||(this.paqdTexture=this.rgbaTex(this.paqdTexture,ct.TEXTURE8_PAQD,[2,2,2,2],!0))}r8Tex2D(i,e,t,n=!1){if(i&&this.gl.deleteTexture(i),i=this.gl.createTexture(),this.gl.activeTexture(e),this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_R,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1),this.gl.texStorage2D(this.gl.TEXTURE_2D,1,this.gl.R8,t[1],t[2]),n){const s=new Uint8Array(t[1]*t[2]);this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,t[1],t[2],this.gl.RED,this.gl.UNSIGNED_BYTE,s)}return i}initFontMets(){if(!this.fontMetrics)throw new Error("fontMetrics undefined");this.fontMets={distanceRange:this.fontMetrics.atlas.distanceRange,size:this.fontMetrics.atlas.size,mets:{}};for(let t=0;t<256;t++)this.fontMets.mets[t]={xadv:0,uv_lbwh:[0,0,0,0],lbwh:[0,0,0,0]};const i=this.fontMetrics.atlas.width,e=this.fontMetrics.atlas.height;for(let t=0;t<this.fontMetrics.glyphs.length;t++){const n=this.fontMetrics.glyphs[t],s=n.unicode;if(this.fontMets.mets[s].xadv=n.advance,n.planeBounds===void 0)continue;let r=n.atlasBounds.left/i,a=(e-n.atlasBounds.top)/e,l=(n.atlasBounds.right-n.atlasBounds.left)/i,c=(n.atlasBounds.top-n.atlasBounds.bottom)/e;this.fontMets.mets[s].uv_lbwh=[r,a,l,c],r=n.planeBounds.left,a=n.planeBounds.bottom,l=n.planeBounds.right-n.planeBounds.left,c=n.planeBounds.top-n.planeBounds.bottom,this.fontMets.mets[s].lbwh=[r,a,l,c]}}async loadFont(i=Ib,e=_b){await this.loadFontTexture(i);const t=await fetch(e);if(!t.ok)throw Error(t.statusText);const n=await t.text();this.fontMetrics=JSON.parse(n),this.initFontMets(),this.fontShader.use(this.gl),this.drawScene()}async loadDefaultMatCap(){return this.loadMatCapTexture(qP)}async loadDefaultFont(){await this.loadFontTexture(this.DEFAULT_FONT_GLYPH_SHEET),this.fontMetrics=this.DEFAULT_FONT_METRICS,this.initFontMets()}async initText(){this.fontShader=new nt(this.gl,IB,_B),this.fontShader.use(this.gl),await this.loadDefaultFont(),await this.loadDefaultMatCap(),this.drawLoadingText(this.opts.loadingText)}meshShaderNameToNumber(i="Phong"){return Z3(i,this.meshShaders)}setMeshShader(i,e=2){const t=bk({meshes:this.meshes,meshShaders:this.meshShaders,id:i,meshShaderNameOrNumber:e,meshShaderNameToNumber:this.meshShaderNameToNumber.bind(this)});t!==null&&(this.updateGLVolume(),this.onMeshShaderChanged(t.meshIndex,t.shaderIndex))}createCustomMeshShader(i,e="Custom"){return AL({gl:this.gl,fragmentShaderText:i,name:e,meshShaders:this.meshShaders})}setCustomSliceShader(i=""){this.customSliceShader=gL({gl:this.gl,fragmentShaderText:i,drawOpacity:this.drawOpacity,customSliceShader:this.customSliceShader}),this.updateGLVolume()}setCustomMeshShader(i="",e="Custom"){const t=this.createCustomMeshShader(i,e);return this.meshShaders.push(t),this.onCustomMeshShaderAdded(i,e),this.meshShaders.length-1}async setCustomMeshShaderFromUrl(i,e=""){try{const t=await fetch(i);if(!t.ok)throw new Error(`Failed to fetch shader from ${i}: ${t.status} ${t.statusText}`);const n=await t.text();return(!e||e.trim()==="")&&(e=(i.split("/").pop()??i).split("?")[0].split("#")[0].replace(/\.[^/.]+$/,"")),this.setCustomMeshShader(n,e)}catch(t){throw new Error(`setCustomMeshShaderFromUrl(${i}) failed: ${t.message}`)}}meshShaderNames(i=!0){return vL(this.meshShaders,i)}initRenderShader(i,e=0){gc({gl:this.gl,shader:i,gradientAmount:e,renderDrawAmbientOcclusion:this.renderDrawAmbientOcclusion,renderSilhouette:this.opts.renderSilhouette,gradientOpacity:this.opts.gradientOpacity})}async init(){const i=this.gl.getExtension("WEBGL_debug_renderer_info");if(i){const f=this.gl.getParameter(i.UNMASKED_VENDOR_WEBGL),p=this.gl.getParameter(i.UNMASKED_RENDERER_WEBGL);X.info("renderer vendor: ",f),X.info("renderer: ",p)}else X.info("debug_renderer_info unavailable");const e=this.gl.getParameter(this.gl.RENDERER);X.info("firefox renderer: ",e),this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.FRONT),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.volumeTexture=this.rgbaTex(this.volumeTexture,ct.TEXTURE0_BACK_VOL,[2,2,2,2],!0),this.overlayTexture=this.rgbaTex(this.overlayTexture,ct.TEXTURE2_OVERLAY_VOL,[2,2,2,2],!0),this.drawTexture=this.r8Tex(this.drawTexture,ct.TEXTURE7_DRAW,[2,2,2,2],!0),this.paqdTexture=this.rgbaTex(this.paqdTexture,ct.TEXTURE8_PAQD,[2,2,2,2],!0);const t=[1,1,0,1,0,0,0,1,0,0,0,0],n=this.gl;this.cuboidVertexBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.cuboidVertexBuffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(t),n.STATIC_DRAW),this.genericVAO=n.createVertexArray(),n.bindVertexArray(this.genericVAO),n.bindBuffer(n.ARRAY_BUFFER,this.cuboidVertexBuffer),n.enableVertexAttribArray(0),n.vertexAttribPointer(0,3,n.FLOAT,!1,0,0),n.bindVertexArray(this.unusedVAO),this.pickingMeshShader=new nt(n,M1,HB),this.pickingMeshShader.use(n),this.pickingImageShader=ML(n);const s=yL(n,this.drawOpacity);this.slice2DShader=s.slice2DShader,this.sliceMMShader=s.sliceMMShader,this.sliceV1Shader=s.sliceV1Shader;const r=xL(n,b_,this.unusedVAO);this.orientCubeShader=r.shader,this.orientCubeShaderVAO=r.vao;const a=bL(n);this.rectShader=a.rectShader,this.rectOutlineShader=a.rectOutlineShader,this.lineShader=a.lineShader,this.line3DShader=a.line3DShader,this.circleShader=a.circleShader;const l=wL({gl:n,renderDrawAmbientOcclusion:this.renderDrawAmbientOcclusion,renderSilhouette:this.opts.renderSilhouette,gradientOpacity:this.opts.gradientOpacity});this.renderVolumeShader=l.renderVolumeShader,this.renderSliceShader=l.renderSliceShader,this.renderGradientShader=l.renderGradientShader,this.renderGradientValuesShader=l.renderGradientValuesShader,this.renderShader=l.renderShader,this.colorbarShader=SL(n);const c=CL(n);this.blurShader=c.blurShader,this.sobelBlurShader=c.sobelBlurShader,this.sobelFirstOrderShader=c.sobelFirstOrderShader,this.sobelSecondOrderShader=c.sobelSecondOrderShader,this.growCutShader=c.growCutShader,this.passThroughShader=c.passThroughShader;const h=EL(n);this.orientShaderAtlasU=h.orientShaderAtlasU,this.orientShaderAtlasI=h.orientShaderAtlasI,this.orientShaderU=h.orientShaderU,this.orientShaderI=h.orientShaderI,this.orientShaderF=h.orientShaderF,this.orientShaderRGBU=h.orientShaderRGBU,this.orientShaderPAQD=h.orientShaderPAQD;const d=TL(n);return this.surfaceShader=d.surfaceShader,this.fiberShader=d.fiberShader,this.pickingImageShader.use(n),DL(n,this.meshShaders),this.bmpShader=new nt(n,RB,NB),await this.initText(),this.opts.thumbnail.length>0&&(await this.loadBmpTexture(this.opts.thumbnail),this.thumbnailVisible=!0),this.updateGLVolume(),this.initialized=!0,this.resizeListener(),this.drawScene(),this}gradientGL(i){this.gradientTexture=zb({gl:this.gl,hdr:i,genericVAO:this.genericVAO,unusedVAO:this.unusedVAO,volumeTexture:this.volumeTexture,paqdTexture:this.paqdTexture,gradientTexture:this.gradientTexture,gradientOrder:this.opts.gradientOrder,blurShader:this.blurShader,sobelBlurShader:this.sobelBlurShader,sobelFirstOrderShader:this.sobelFirstOrderShader,sobelSecondOrderShader:this.sobelSecondOrderShader,rgbaTex:this.rgbaTex.bind(this)})}getGradientTextureData(){return Pk({gl:this.gl,gradientTexture:this.gradientTexture,dims:this.back?.dims??null})}setCustomGradientTexture(i,e){const t=Bk({gl:this.gl,data:i,dims:e,backDims:this.back?.dims??null,gradientTexture:this.gradientTexture,gradientTextureAmount:this.gradientTextureAmount,hdr:this.back?.hdr??null,gradientGLFn:this.gradientGL.bind(this)});this.gradientTexture=t.gradientTexture,this.useCustomGradientTexture=t.useCustomGradientTexture,i!==null&&t.useCustomGradientTexture&&this.drawScene()}updateGLVolume(){let i=0;const e=this.volumes.length;this.refreshColormaps(),this.closePAQD();for(let t=0;t<e;t++)this.volumes[t].toRAS&&(this.refreshLayers(this.volumes[t],i),i++);if(this.furthestVertexFromOrigin=0,e>0&&(this.furthestVertexFromOrigin=this.volumeObject3D?.furthestVertexFromOrigin??0),this.meshes)for(let t=0;t<this.meshes.length;t++)this.furthestVertexFromOrigin=Math.max(this.furthestVertexFromOrigin,this.meshes[t].furthestVertexFromOrigin);this.onVolumeUpdated&&this.onVolumeUpdated(),this.drawScene()}getDescriptives(i){const{layer:e=0,masks:t=[],drawingIsMask:n=!1,roiIsMask:s=!1,startVox:r=[0,0,0],endVox:a=[0,0,0]}=i,l=this.volumes[e].hdr,c=this.volumes[e].pixDimsRAS,h=isNaN(l.scl_slope)?1:l.scl_slope,d=isNaN(l.scl_inter)?1:l.scl_inter,f=this.volumes[e].img,p=f.length,g=oV(f,h,d),y=t.filter(S=>{const C=this.volumes[S].img.length===p;return C||X.debug("Mask resolution does not match image. Skipping masking layer "+S),C}).map(S=>this.volumes[S].img),{mask:x,area:b}=rV({nv:p,maskImages:y.length>0?y:void 0,drawBitmap:this.drawBitmap,drawingIsMask:t.length<1&&n,roiIsMask:t.length<1&&s,startVox:r,endVox:a,hdr:l,pixDimsRAS:c}),w=aV(g,x);return{...w,volumeMM3:w.nvox*l.pixDims[1]*l.pixDims[2]*l.pixDims[3],volumeML:w.nvox*l.pixDims[1]*l.pixDims[2]*l.pixDims[3]*.001,cal_min:this.volumes[e].cal_min,cal_max:this.volumes[e].cal_max,robust_min:this.volumes[e].robust_min,robust_max:this.volumes[e].robust_max,area:b}}refreshLayers(i,e){if(this.volumes.length<1)return;this.refreshColormaps();const t=i.hdr,n=jL(i),s=i.opacity;if(e>1&&s===0)return;let r=null;if(!this.back)throw new Error("back undefined");this.gl.bindVertexArray(this.unusedVAO),this.crosshairs3D&&(this.crosshairs3D.mm[0]=NaN);let a=Qt(i.toRAS);if(e===0){this.volumeObject3D=WL({overlayItem:i,VOLUME_ID:this.VOLUME_ID,gl:this.gl}),rn(a,a),this.back.matRAS=i.matRAS,this.back.dims=i.dimsRAS,this.back.pixDims=i.pixDimsRAS;const{volScale:w,vox:S}=this.sliceScale(!0);this.volScale=w,this.vox=S,this.volumeObject3D.scale=Array.from(w);const{isAboveMax2D:C,isAboveMax3D:E}=zL({hdr:t,max2D:this.uiData.max2D,max3D:this.uiData.max3D});if(C&&X.error("Image dimensions exceed maximum texture size of hardware."),E&&t.datatypeCode===2304&&t.dims[3]<2){X.info(`Large RGBA image (>${this.uiData.max3D}) requires Texture2D`),this.opts.is2DSliceShader=!0,r=this.rgbaTex2D(this.volumeTexture,ct.TEXTURE0_BACK_VOL,i.dimsRAS,n);return}if(E){X.info(`Large scalar image (>${this.uiData.max3D}) requires Texture2D (${t.dims[1]}${t.dims[2]}${t.dims[3]})`);const M=t.dims[1]*t.dims[2],N=this.frac2vox(this.scene.crosshairPos),_=Math.min(Math.max(N[2],0),t.dims[3]-1)*M,F=new Uint8Array(M*4),B=new Uint32Array(F.buffer),P=Math.floor(i.opacity*255),O=255*t.scl_slope/(i.cal_max-i.cal_min),k=255*(t.scl_inter-i.cal_min)/(i.cal_max-i.cal_min),q=new Uint8Array(this.colormap(i.colormap)),U=new Uint32Array(q.buffer);let H=-1;for(let Y=0;Y<M;Y++){const Q=n[Y+_]*O+k,te=Math.round(Math.min(255,Math.max(0,Q)));B[Y]=U[te],F[H+=4]=P}this.opts.is2DSliceShader=!0,r=this.rgbaTex2D(this.volumeTexture,ct.TEXTURE0_BACK_VOL,i.dimsRAS,F,!1);return}if(E&&X.warn(`dimensions exceed 3D limits ${t.dims}`),this.opts.is2DSliceShader=!1,r=this.rgbaTex(this.volumeTexture,ct.TEXTURE0_BACK_VOL,i.dimsRAS),!this.renderShader)throw new Error("renderShader undefined");this.renderShader.use(this.gl),this.gl.uniform3fv(this.renderShader.uniforms.texVox,this.vox),this.gl.uniform3fv(this.renderShader.uniforms.volScale,this.volScale);const D=this.pickingImageShader;D.use(this.gl),this.gl.uniform1i(D.uniforms.volume,0),this.gl.uniform1i(D.uniforms.colormap,1),this.gl.uniform1i(D.uniforms.overlay,2),this.gl.uniform3fv(D.uniforms.volScale,this.volScale),X.debug(this.volumeObject3D)}else this.back?.dims===void 0&&X.error("Fatal error: Unable to render overlay: background dimensions not defined!"),a=KL({overlayItem:i,mm2frac:this.mm2frac.bind(this)}),e===1?(r=QL({gl:this.gl,layer:e,backDims:this.back.dims,rgbaTex:this.rgbaTex.bind(this)}).overlayTexture,this.overlayTexture=r,this.overlayTextureID=r):r=this.overlayTextureID;const l=ZL(this.gl);this.gl.viewport(0,0,this.back.dims[1],this.back.dims[2]);const c=sk({gl:this.gl,TEXTURE9_ORIENT:ct.TEXTURE9_ORIENT});if(!t)throw new Error("hdr undefined");if(!n)throw new Error("img undefined");let h=this.orientShaderU;if(t.datatypeCode===2304){const w=fk({gl:this.gl,hdr:t,img:n,overlayItem:i,layer:e,orientShaderRGBU:this.orientShaderRGBU,orientShaderPAQD:this.orientShaderPAQD,volumes:this.volumes,backDims:this.back.dims,rgbaTex:this.rgbaTex.bind(this),paqdTexture:this.paqdTexture,TEXTURE8_PAQD:ct.TEXTURE8_PAQD,TEXTURE9_ORIENT:ct.TEXTURE8_PAQD});h=w.orientShader,w.outTexture!==null&&(r=w.outTexture),w.paqdTexture!==null&&(this.paqdTexture=w.paqdTexture)}else h=dk({gl:this.gl,hdr:t,img:n,orientShaderU:this.orientShaderU,orientShaderI:this.orientShaderI,orientShaderF:this.orientShaderF,orientShaderRGBU:this.orientShaderRGBU,orientShaderAtlasU:this.orientShaderAtlasU,orientShaderAtlasI:this.orientShaderAtlasI}).orientShader;i.global_min===void 0&&i.calMinMax(),this.gl.bindVertexArray(this.genericVAO);const d=JL({gl:this.gl,layer:e,backDims:this.back.dims,rgbaTex:this.rgbaTex.bind(this),passThroughShader:this.passThroughShader});h.use(this.gl),this.gl.activeTexture(ct.TEXTURE1_COLORMAPS);const{colormapLabelTexture:f}=GL({gl:this.gl,overlayItem:i,orientShader:h,createColormapTexture:this.createColormapTexture.bind(this)});if(f===null&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.colormapTexture),this.gl.uniform1f(h.uniforms.cal_min,i.cal_min),this.gl.uniform1f(h.uniforms.cal_max,i.cal_max)),"alphaThreshold"in i&&(X.warn("alphaThreshold is deprecated: use colormapType"),i.alphaThreshold===!0&&(i.colormapType=2),i.alphaThreshold===!1&&(i.colormapType=1),delete i.alphaThreshold),!h)throw new Error("orientShader undefined");$L({gl:this.gl,overlayItem:i,orientShader:h,layer:e,isAdditiveBlend:this.opts.isAdditiveBlend});const{modulateTexture:p}=HL({gl:this.gl,overlayItem:i,hdr:t,volumes:this.volumes,orientShader:h,r8Tex:this.r8Tex.bind(this),TEXTURE7:this.gl.TEXTURE7});if(this.gl.bindTexture(this.gl.TEXTURE_3D,c),!this.back.dims)throw new Error("back.dims undefined");if(ek({gl:this.gl,orientShader:h,backDims:this.back.dims,outTexture:r,mtx:a,hdr:t,intensityVolTextureUnit:9,blendTextureUnit:10,colormapTextureUnit:1,modulationTextureUnit:7,opacity:s,atlasOutline:this.opts.atlasOutline,atlasActiveIndex:this.opts.atlasActiveIndex}),X.debug("back dims: ",this.back.dims),this.gl.bindVertexArray(this.unusedVAO),this.gl.deleteTexture(c),this.gl.deleteTexture(p),this.gl.deleteTexture(d),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.deleteFramebuffer(l),e===0&&(this.volumeTexture=r,this.gradientTexture=zb({gl:this.gl,hdr:t,genericVAO:this.genericVAO,unusedVAO:this.unusedVAO,volumeTexture:this.volumeTexture,paqdTexture:this.paqdTexture,gradientTexture:this.gradientTexture,gradientOrder:this.opts.gradientOrder,blurShader:this.blurShader,sobelBlurShader:this.sobelBlurShader,sobelFirstOrderShader:this.sobelFirstOrderShader,sobelSecondOrderShader:this.sobelSecondOrderShader,rgbaTex:this.rgbaTex.bind(this)})),!this.renderShader)throw new Error("renderShader undefined");if(!this.pickingImageShader)throw new Error("pickingImageShader undefined");const g=this.sliceScale(!0),y=g.vox,x=g.volScale,b=ik({is2DSliceShader:this.opts.is2DSliceShader,isV1SliceShader:this.opts.isV1SliceShader,sliceMMShader:this.sliceMMShader,slice2DShader:this.slice2DShader,sliceV1Shader:this.sliceV1Shader,customSliceShader:this.customSliceShader});tk({gl:this.gl,renderShader:this.renderShader,pickingImageShader:this.pickingImageShader,sliceShader:b,overlaysLength:this.overlays.length,clipPlaneColor:this.opts.clipPlaneColor,backOpacity:this.volumes[0].opacity,renderOverlayBlend:this.opts.renderOverlayBlend,clipPlane:this.scene.clipPlane,texVox:y,volScale:x,drawOpacity:this.drawOpacity,paqdUniforms:this.opts.paqdUniforms}),f!==null&&(this.gl.deleteTexture(f),this.gl.activeTexture(ct.TEXTURE1_COLORMAPS),this.gl.bindTexture(this.gl.TEXTURE_2D,this.colormapTexture)),nk({gl:this.gl,shader:b,is2DSliceShader:this.opts.is2DSliceShader,drawTexture:this.drawTexture,paqdTexture:this.paqdTexture,TEXTURE7_DRAW:ct.TEXTURE7_DRAW,TEXTURE8_PAQD:ct.TEXTURE8_PAQD}),this.updateInterpolation(e)}colormaps(){return yt.colormaps()}addColormap(i,e){yt.addColormap(i,e)}setColormap(i,e){const t=this.getVolumeIndexByID(i);this.volumes[t].colormap=e,this.updateGLVolume()}idx(i,e,t,n){return gi(i,e,t,n)}check_previous_slice(i,e,t,n,s,r,a,l){return v4(i,e,t,n,s,r,a,l)}do_initial_labelling(i,e,t){const n=y4(i,e,t);return[n.labelCount,n.translationTable,n.initialLabels]}fill_tratab(i,e,t){k1(i,e,t)}translate_labels(i,e,t,n){const s=x4(i,e,t,n);return[s.clusterCount,s.labels]}largest_original_cluster_labels(i,e,t){const n=b4(i,e,t);return[n.maxValue,n.voxels]}bwlabel(i,e,t=26,n=!1,s=!1){const r=$U({img:i,dim:e,conn:t,binarize:n,onlyLargestClusterPerClass:s});return[r.clusterCount,r.labels]}async createConnectedLabelImage(i,e=26,t=!1,n=!1){const s=this.getVolumeIndexByID(i),r=Uint32Array.from(this.volumes[s].dims?.slice(1,4)??[]),a=Uint32Array.from(this.volumes[s].img?.slice()??[]),[l,c]=this.bwlabel(a,r,e,t,n),h=this.volumes[s].clone();h.opacity=.5,h.colormap="random";for(let d=0;d<h.img.length;d++)h.img[d]=c[d];return h.cal_min=0,h.cal_max=l,h}async createNiftiArray(i=[256,256,256],e=[1,1,1],t=[1,0,0,-128,0,1,0,-128,0,0,1,-128,0,0,0,1],n=2,s=new Uint8Array){return await $i.createNiftiArray(i,e,t,n,s)}async niftiArray2NVImage(i=new Uint8Array){return await $i.loadFromUrl({url:i})}async loadFromUrl(i){return await $i.loadFromUrl({url:i})}async conform(i,e=!1,t=!0,n=!1,s=!1){const{outAffine:l,invVox2vox:c}=iV({inDims:i.hdr.dims,inAffine:i.hdr.affine.flat(),outDim:256,outMM:1,toRAS:e}),h=new Float32Array(i.img),d=i.hdr.dims[1]*i.hdr.dims[2]*i.hdr.dims[3];if(i.hdr.scl_slope!==1||i.hdr.scl_inter!==0)for(let x=0;x<d;x++)h[x]=h[x]*i.hdr.scl_slope+i.hdr.scl_inter;const f=nV({inImg:h,inDims:i.hdr.dims,outDim:256,invVox2vox:c,isLinear:t}),p=s?NaN:0,g={img:i.img,dims:i.hdr.dims,global_min:i.global_min,global_max:i.global_max,datatypeCode:i.hdr.datatypeCode,scl_slope:i.hdr.scl_slope,scl_inter:i.hdr.scl_inter,cal_min:i.cal_min,cal_max:i.cal_max,f_low:p};let y;if(n){g.dst_min=0,g.dst_max=1;const[x,b]=tw(g),w=tV(f,0,1,x,b);y=await this.createNiftiArray([256,256,256],[1,1,1],Array.from(l),16,new Uint8Array(w.buffer))}else{g.dst_min=0,g.dst_max=255;const[x,b]=tw(g),w=eV(f,0,255,x,b);y=await this.createNiftiArray([256,256,256],[1,1,1],Array.from(l),2,w)}return this.niftiArray2NVImage(y)}setRenderDrawAmbientOcclusion(i){if(!this.renderShader)throw new Error("renderShader undefined");this.renderDrawAmbientOcclusion=i,this.renderShader.use(this.gl),this.gl.uniform1fv(this.renderShader.uniforms.renderDrawAmbientOcclusion,[this.renderDrawAmbientOcclusion,1]),this.drawScene()}setColorMap(i,e){this.setColormap(i,e)}setColormapNegative(i,e){const t=this.getVolumeIndexByID(i);this.volumes[t].colormapNegative=e,this.updateGLVolume()}setModulationImage(i,e,t=0){const n=this.getVolumeIndexByID(i);let s=null;e.length>0&&(s=this.getVolumeIndexByID(e)),this.volumes[n].modulationImage=s,this.volumes[n].modulateAlpha=t,this.updateGLVolume()}setGamma(i=1){this.scene.gamma=i,yt.gamma=i,this.updateGLVolume()}async loadDeferred4DVolumes(i){const e=this.getVolumeIndexByID(i),t=this.volumes[e];if(t.nTotalFrame4D<=t.nFrame4D)return;t.nTotalFrame4D=t.nFrame4D;let n;t.fileObject?n=await $i.loadFromFile({file:t.fileObject}):n=await $i.loadFromUrl({url:t.url}),n&&(t.img=n.img.slice(),t.nTotalFrame4D=n.nTotalFrame4D,t.nFrame4D=n.nFrame4D,this.updateGLVolume())}setFrame4D(i,e){const t=this.getVolumeIndexByID(i);if(t<0)return;const n=this.volumes[t].frame4D;OL(this.volumes,i,e),this.volumes[t].frame4D!==n&&(this.updateGLVolume(),this.onFrameChange(this.volumes[t],this.volumes[t].frame4D),this.createOnLocationChange())}getFrame4D(i){return UL(this.volumes,i)}colormapFromKey(i){return yt.colormapFromKey(i)}colormap(i="",e=!1){return yt.colormap(i,e)}createColormapTexture(i=null,e=0,t=256){return i!==null&&this.gl.deleteTexture(i),e<1||t<1?null:(i=this.gl.createTexture(),this.gl.activeTexture(ct.TEXTURE1_COLORMAPS),this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.texStorage2D(this.gl.TEXTURE_2D,1,this.gl.RGBA8,t,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_R,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1),i)}addColormapList(i="",e=NaN,t=NaN,n=!1,s=!1,r=!0,a=!1){i.length<1&&(r=!1),this.colormapLists.push({name:i,min:e,max:t,isColorbarFromZero:n,negative:s,visible:r,invert:a})}refreshColormaps(){if(this.colormapLists=[],this.volumes.length<1&&this.meshes.length<1)return;const i=this.volumes.length;if(i>0)for(let r=0;r<i;r++){const a=this.volumes[r],l=v0(a.cal_min,a.cal_max,a.cal_minNeg,a.cal_maxNeg),c=a.colormapType!==0;this.addColormapList(a.colormapNegative,l[0],l[1],c,!0,a.colorbarVisible,a.colormapInvert),this.addColormapList(a.colormap,a.cal_min,a.cal_max,c,!1,a.colorbarVisible,a.colormapInvert)}const e=this.meshes.length;if(e>0)for(let r=0;r<e;r++){const a=this.meshes[r];if(!a.colorbarVisible)continue;const l=a.layers.length,c=a.fiberColor.toLowerCase();if(a.offsetPt0&&c.startsWith("dp")){let h=null;const d=parseInt(c.substring(3));c.startsWith("dpg")&&!a.fiberGroupColormap&&(h=d<a.dpg.length?a.dpg[d]:a.dpg[0]),c.startsWith("dps")&&(h=d<a.dps.length?a.dps[d]:a.dps[0]),c.startsWith("dpv")&&(h=d<a.dpv.length?a.dpv[d]:a.dpv[0]),h&&typeof a.colormap=="string"&&this.addColormapList(a.colormap,h.cal_min,h.cal_max,!1,!1,!0,a.colormapInvert)}if("edgeColormap"in a&&"edges"in a&&a.edges!==void 0){const h=v0(a.edgeMin,a.edgeMax,NaN,NaN);this.addColormapList(a.edgeColormapNegative,h[0],h[1],!1,!0,!0,a.colormapInvert),this.addColormapList(a.edgeColormap,a.edgeMin,a.edgeMax,!1,!1,!0,a.colormapInvert)}if(!(l<1))for(let h=0;h<l;h++){const d=this.meshes[r].layers[h];if(!d.colorbarVisible||d.colormap.length<1)continue;const f=d.colormapType!==0;if(d.useNegativeCmap){const p=v0(d.cal_min,d.cal_max,d.cal_minNeg,d.cal_maxNeg);this.addColormapList(d.colormapNegative,p[0],p[1],f,!0,!0,d.colormapInvert)}this.addColormapList(d.colormap,d.cal_min,d.cal_max,f,!1,!0,d.colormapInvert)}}const t=this.colormapLists.length;if(t<1)return;this.colormapTexture=this.createColormapTexture(this.colormapTexture,t+1);let n=new Uint8ClampedArray;function s(r){const a=new Uint8ClampedArray(n.length+r.length);a.set(n),a.set(r,n.length),n=a}for(let r=0;r<t;r++)s(Array.from(this.colormap(this.colormapLists[r].name,this.colormapLists[r].invert)));return s(Array.from(this.drawLut.lut)),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,256,t+1,this.gl.RGBA,this.gl.UNSIGNED_BYTE,n),this}sliceScale(i=!1){if(!this.back?.dims)throw new Error("back.dims undefined");return jO({forceVox:i,getScreenFieldOfViewMM:e=>this.screenFieldOfViewMM(e),getScreenFieldOfViewVox:e=>this.screenFieldOfViewVox(e),backDims:this.back.dims})}tileIndex(i,e){return B1({x:i,y:e,screenSlices:this.screenSlices})}inRenderTile(i,e){return TO({x:i,y:e,screenSlices:this.screenSlices})}sliceScroll3D(i=0){const e=IO({posChange:i,volumesLength:this.volumes.length,clipPlaneDepthAziElevs:this.scene.clipPlaneDepthAziElevs,activeClipPlaneIndex:this.uiData.activeClipPlaneIndex,volScaleMultiplier:this.scene.volScaleMultiplier});if(e.action!=="none"){if(e.action==="clipPlane"&&e.newClipPlaneDepth!==void 0){const t=this.scene.clipPlaneDepthAziElevs[this.uiData.activeClipPlaneIndex].slice();return t[0]=e.newClipPlaneDepth,this.scene.clipPlaneDepthAziElevs[this.uiData.activeClipPlaneIndex]=t,this.setClipPlane(this.scene.clipPlaneDepthAziElevs[this.uiData.activeClipPlaneIndex])}e.action==="zoom"&&e.newVolScaleMultiplier!==void 0&&(this.scene.volScaleMultiplier=e.newVolScaleMultiplier,this.drawScene())}}inGraphTile(i,e){return MO({x:i,y:e,graph:this.graph,volumesLength:this.volumes.length,firstVolumeFrameCount:this.volumes.length>0?this.volumes[0].nFrame4D??0:0})}updateBitmapFromClickToSegment(){this.clickToSegmentGrowingBitmap===null||this.drawBitmap===null||VU({sourceBitmap:this.clickToSegmentGrowingBitmap,targetBitmap:this.drawBitmap})}sumBitmap(i){return jU(i)}doClickToSegment(i){const{tileIndex:e}=i;if(e<0||e>=this.screenSlices.length){X.warn(`Invalid tileIndex ${e} received in doClickToSegment.`);return}const t=this.screenSlices[e].axCorSag;if(t>2){X.warn("ClickToSegment attempted on non-2D slice tile.");return}const n=this.screenXY2TextureFrac(this.clickToSegmentXY[0],this.clickToSegmentXY[1],e,!1);if(n[0]<0){X.debug("Click location outside valid texture fraction for the tile.");return}const s=this.frac2vox(n),r=this.back.getValue(s[0],s[1],s[2]),a=OU({voxelIntensity:r,thresholdPercent:this.opts.clickToSegmentPercent,calMin:this.back.cal_min,calMax:this.back.cal_max,autoIntensity:this.opts.clickToSegmentAutoIntensity,currentIntensityMin:this.opts.clickToSegmentIntensityMin,currentIntensityMax:this.opts.clickToSegmentIntensityMax,currentBright:this.opts.clickToSegmentBright});this.opts.clickToSegmentIntensityMin=a.intensityMin,this.opts.clickToSegmentIntensityMax=a.intensityMax,this.opts.clickToSegmentBright=a.isBright;const l=UU(a.isBright);this.drawPenAxCorSag=t;const c=this.clickToSegmentIsGrowing?this.clickToSegmentGrowingBitmap:this.drawBitmap;if(!c){if(X.error("Target bitmap for flood fill is null."),this.clickToSegmentIsGrowing){if(this.drawBitmap||this.createEmptyDrawing(),!this.drawBitmap)return;this.clickToSegmentGrowingBitmap=this.drawBitmap.slice()}else if(this.createEmptyDrawing(),!this.drawBitmap)return;X.warn("Initialized missing bitmap in doClickToSegment.")}if(this.drawFloodFill([s[0],s[1],s[2]],this.opts.penValue,l,this.opts.clickToSegmentIntensityMin,this.opts.clickToSegmentIntensityMax,this.opts.floodFillNeighbors,this.opts.clickToSegmentMaxDistanceMM,this.opts.clickToSegmentIs2D,c),!this.clickToSegmentIsGrowing&&(X.debug("Applying clickToSegment mask to drawBitmap."),this.drawBitmap?(this.refreshDrawing(!1,!1),this.drawScene()):X.error("Cannot refresh drawing after click-to-segment apply, drawBitmap is null."),this.drawBitmap)){const h=this.getDescriptives({layer:0,masks:[],drawingIsMask:!0});this.onClickToSegment({mL:h.volumeML,mm3:h.volumeMM3})}this.createOnLocationChange(t)}mouseClick(i,e,t=0,n=!0){if(i*=this.uiData.dpr,e*=this.uiData.dpr,this.canvas.focus(),this.thumbnailVisible){this.thumbnailVisible=!1,Promise.all([this.loadVolumes(this.deferredVolumes),this.loadMeshes(this.deferredMeshes)]).catch(s=>{throw s});return}if(this.inGraphTile(i,e)){if(!this.graph.plotLTWH)throw new Error("plotLTWH undefined");const s=[(i-this.graph.plotLTWH[0])/this.graph.plotLTWH[2],(e-this.graph.plotLTWH[1])/this.graph.plotLTWH[3]];if(s[0]>0&&s[1]>0&&s[0]<=1&&s[1]<=1){const r=Math.round(s[0]*(this.volumes[0].nFrame4D-1));this.setFrame4D(this.volumes[0].id,r);return}s[0]>.5&&s[1]>1&&this.loadDeferred4DVolumes(this.volumes[0].id).catch(r=>{throw r});return}if(this.inRenderTile(i,e)>=0){this.sliceScroll3D(t),this.drawScene();return}if(!(this.screenSlices.length<1||this.gl.canvas.height<1||this.gl.canvas.width<1))for(let s=0;s<this.screenSlices.length;s++){const r=this.screenSlices[s].axCorSag;if(this.drawPenAxCorSag>=0&&this.drawPenAxCorSag!==r||r>2&&!this.opts.clickToSegment&&t===0)continue;const a=this.screenXY2TextureFrac(i,e,s,!0);if(!(a[0]<0)){if(t!==0||!n){if(!n){r<=2&&(this.scene.crosshairPos[2-r]=t,this.drawScene(),this.createOnLocationChange(r));return}const l=t<0?-1:1,c=[0,0,0];r<=2&&(c[2-r]=l,this.moveCrosshairInVox(c[0],c[1],c[2]));return}if(this.opts.isForceMouseClickToVoxelCenters?this.scene.crosshairPos=kn(this.vox2frac(this.frac2vox(a))):this.scene.crosshairPos=kn(a),this.opts.drawingEnabled){const l=this.frac2vox(this.scene.crosshairPos);if(!isFinite(this.opts.penValue)||this.opts.penValue<0||Object.is(this.opts.penValue,-0)){let c=0,h=Math.abs(this.opts.penValue);const d=!0;Object.is(this.opts.penValue,-0)?(c=0,h=0,X.debug("Erase Cluster selected")):(c=this.opts.penValue,X.debug("Intensity Grow selected",c)),this.drawFloodFill(l,h,c,NaN,NaN,this.opts.floodFillNeighbors,Number.POSITIVE_INFINITY,!1,this.drawBitmap,d),this.drawScene(),this.createOnLocationChange(r);return}else if(this.opts.clickToSegment){r<=2&&(this.clickToSegmentIsGrowing=!1,this.doClickToSegment({x:this.clickToSegmentXY[0],y:this.clickToSegmentXY[1],tileIndex:s})),this.createOnLocationChange(r);return}else if(this.opts.penType===0){if(isNaN(this.drawPenLocation[0]))this.drawPenAxCorSag=r,this.drawPenFillPts=[],this.drawPt(...l,this.opts.penValue);else{if(l[0]===this.drawPenLocation[0]&&l[1]===this.drawPenLocation[1]&&l[2]===this.drawPenLocation[2]){this.drawScene(),this.createOnLocationChange(r);return}this.drawPenLine(l,this.drawPenLocation,this.opts.penValue)}this.drawPenLocation=l,this.opts.isFilledPen&&this.drawPenFillPts.push(l),this.refreshDrawing(!1,!1)}else(this.opts.penType===1||this.opts.penType===2)&&(isNaN(this.drawShapeStartLocation[0])?(this.drawPenAxCorSag=r,this.drawShapeStartLocation=[...l],this.drawBitmap&&(this.drawShapePreviewBitmap=this.drawBitmap.slice())):this.drawShapePreviewBitmap&&this.drawBitmap&&(this.drawBitmap.set(this.drawShapePreviewBitmap),this.opts.penType===1?this.drawRectangleMask(this.drawShapeStartLocation,l,this.opts.penValue):this.opts.penType===2&&this.drawEllipseMask(this.drawShapeStartLocation,l,this.opts.penValue),this.refreshDrawing(!1,!1)))}this.drawScene(),this.createOnLocationChange(r);return}}}drawRuler(){let i=[],e=[];for(let h=0;h<this.screenSlices.length;h++)if(this.screenSlices[h].axCorSag!==4&&this.screenSlices[h].fovMM.length>1){e=this.screenSlices[h].leftTopWidthHeight,i=this.screenSlices[h].fovMM;break}if(e.length<4)return;const[t,n,s,r]=this.getBoundsRegion(),a=Number(this.opts.rulerWidth),l=a7({fovMM:i,ltwh:e,rulerWidth:a,regionBounds:{x:t,y:n,w:s,h:r}});if(!l)return;const c=o7(this.opts.rulerColor);this.drawRuler10cm(l.startXYendXY,c,a+1),this.drawRuler10cm(l.startXYendXY,this.opts.rulerColor,a)}drawRuler10cm(i,e,t=1){if(!this.lineShader)throw new Error("lineShader undefined");this.gl.bindVertexArray(this.genericVAO),this.lineShader.use(this.gl),this.gl.uniform4fv(this.lineShader.uniforms.lineColor,e),this.gl.uniform2fv(this.lineShader.uniforms.canvasWidthHeight,[this.gl.canvas.width,this.gl.canvas.height]),this.gl.uniform1f(this.lineShader.uniforms.thickness,t),this.gl.uniform4fv(this.lineShader.uniforms.startXYendXY,i),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4);const n=l7(i,this.opts.rulerWidth);for(const s of n)this.gl.uniform4fv(this.lineShader.uniforms.startXYendXY,s),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4);this.gl.bindVertexArray(this.unusedVAO)}screenXY2mm(i,e,t=-1){return dB(i,e,this.screenSlices,{volumes:this.volumes,meshes:this.meshes,volumeObject3D:this.volumeObject3D,isSliceMM:this.opts.isSliceMM,forceSlice:t})}dragForPanZoom(i){const e=this.screenXY2mm(i[2],i[3]);if(isNaN(e[0]))return;const t=this.screenXY2mm(i[0],i[1],e[3]);if(isNaN(t[0])||isNaN(e[0])||isNaN(e[3]))return;const n=dO({startMM:t,endMM:e,pan2DxyzmmAtMouseDown:this.uiData.pan2DxyzmmAtMouseDown});this.scene.pan2Dxyzmm[0]=n.pan2Dxyzmm[0],this.scene.pan2Dxyzmm[1]=n.pan2Dxyzmm[1],this.scene.pan2Dxyzmm[2]=n.pan2Dxyzmm[2],this.canvas.focus()}dragForCenterButton(i){this.dragForPanZoom(i)}dragForSlicer3D(i){const e=this.frac2mm(this.scene.crosshairPos),t=fO({startY:i[1],endY:i[3],pan2DxyzmmAtMouseDown:this.uiData.pan2DxyzmmAtMouseDown,currentPan2Dxyzmm:this.scene.pan2Dxyzmm,crosshairMM:e,yoke3Dto2DZoom:this.opts.yoke3Dto2DZoom});t.volScaleMultiplier!==void 0&&(this.scene.volScaleMultiplier=t.volScaleMultiplier),this.scene.pan2Dxyzmm[0]=t.pan2Dxyzmm[0],this.scene.pan2Dxyzmm[1]=t.pan2Dxyzmm[1],this.scene.pan2Dxyzmm[2]=t.pan2Dxyzmm[2],this.scene.pan2Dxyzmm[3]=t.pan2Dxyzmm[3]}drawMeasurementTool(i,e=!0){const t=(h,d,f,p,g)=>c7({startXYendXY:[h,d,f,p],distance:g}),n=this.gl;if(n.viewport(0,0,n.canvas.width,n.canvas.height),n.bindVertexArray(this.genericVAO),n.depthFunc(n.ALWAYS),n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),!this.lineShader)throw new Error("lineShader undefined");this.lineShader.use(this.gl),n.uniform4fv(this.lineShader.uniforms.lineColor,this.opts.rulerColor),n.uniform2fv(this.lineShader.uniforms.canvasWidthHeight,[n.canvas.width,n.canvas.height]),n.uniform1f(this.lineShader.uniforms.thickness,this.opts.rulerWidth),n.uniform4fv(this.lineShader.uniforms.startXYendXY,i),n.drawArrays(n.TRIANGLE_STRIP,0,4);const s=this.opts.measureLineColor;s[3]=1,n.uniform4fv(this.lineShader.uniforms.lineColor,s);const r=this.opts.rulerWidth;n.uniform1f(this.lineShader.uniforms.thickness,r*2);let a=[i[0],i[1]-r,i[0],i[1]+r];n.uniform4fv(this.lineShader.uniforms.startXYendXY,a),n.drawArrays(n.TRIANGLE_STRIP,0,4),a=[i[2],i[3]-r,i[2],i[3]+r],n.uniform4fv(this.lineShader.uniforms.startXYendXY,a),n.drawArrays(n.TRIANGLE_STRIP,0,4);let l=this.canvasPos2frac([i[0],i[1]]),c=this.canvasPos2frac([i[2],i[3]]);if(l[0]>=0&&c[0]>=0){const h=this.frac2mm(l);l=Ae(h[0],h[1],h[2]);const d=this.frac2mm(c);c=Ae(d[0],d[1],d[2]);const f=bt();ob(f,l,c);const p=Oc(f);let g=2;p>9&&(g=1),p>99&&(g=0);let y=p.toFixed(g);this.opts.showMeasureUnits&&(y=`${y} mm`);let x=i;const[b,w,S,C]=i,{origin:E,terminus:D}=t(b,w,S,C,30);switch(this.opts.measureTextJustify){case"start":x=[...E,...E.map(M=>M+1)];break;case"end":x=x=[...D,...D.map(M=>M+1)];break;default:x=i;break}e&&this.drawTextBetween(x,y,this.opts.measureTextHeight/.06,this.opts.measureTextColor)}n.bindVertexArray(this.unusedVAO)}drawAngleMeasurementTool(){this.uiData.angleState==="drawing_first_line"?this.drawMeasurementTool([this.uiData.dragStart[0],this.uiData.dragStart[1],this.uiData.dragEnd[0],this.uiData.dragEnd[1]],!1):this.uiData.angleState==="drawing_second_line"&&(this.drawMeasurementTool(this.uiData.angleFirstLine,!1),this.drawMeasurementTool([this.uiData.angleFirstLine[2],this.uiData.angleFirstLine[3],this.uiData.dragEnd[0],this.uiData.dragEnd[1]],!1),this.drawAngleText())}drawAngleText(){const i=this.uiData.angleFirstLine,e=[this.uiData.angleFirstLine[2],this.uiData.angleFirstLine[3],this.uiData.dragEnd[0],this.uiData.dragEnd[1]],t=this.calculateAngleBetweenLines(i,e),n=this.uiData.angleFirstLine[2],s=this.uiData.angleFirstLine[3],r=`${t.toFixed(1)}`;this.drawTextBetween([n,s,n+1,s+1],r,this.opts.measureTextHeight/.06,this.opts.measureTextColor)}drawAngleTextForAngle(i){const e=this.calculateAngleBetweenLines(i.firstLine,i.secondLine),t=i.firstLine[2],n=i.firstLine[3],s=`${e.toFixed(1)}`;this.drawTextBetween([t,n,t+1,n+1],s,this.opts.measureTextHeight/.06,this.opts.measureTextColor)}calculateAngleBetweenLines(i,e){return uO(i,e)}resetAngleMeasurement(){const i=hO();this.uiData.angleState=i.angleState,this.uiData.angleFirstLine=i.angleFirstLine}getCurrentSliceInfo(){return RO({dragStart:this.uiData.dragStart,screenSlices:this.screenSlices,crosshairPos:this.scene.crosshairPos,currentSliceType:this.opts.sliceType,canvasPos2frac:i=>this.canvasPos2frac(i)})}getCurrentSlicePosition(i){return Ud({sliceType:i,crosshairPos:this.scene.crosshairPos})}shouldDrawOnCurrentSlice(i,e,t){return NO({sliceType:e,slicePosition:t,currentSliceTypeOpt:this.opts.sliceType,screenSlices:this.screenSlices,crosshairPos:this.scene.crosshairPos})}clearMeasurements(){this.document.completedMeasurements=[],this.drawScene()}clearAngles(){this.document.completedAngles=[],this.drawScene()}clearAllMeasurements(){this.document.completedMeasurements=[],this.document.completedAngles=[],this.drawScene()}setDragMode(i){const e=rO(i);if(e===null){console.warn(`Unknown drag mode: ${i}`);return}this.opts.dragMode=e,AO(this.opts.dragMode)||this.resetAngleMeasurement(),this.clearActiveDragMode()}setMouseEventConfig(i){this.opts.mouseEventConfig=i,this.clearActiveDragMode()}setTouchEventConfig(i){this.opts.touchEventConfig=i,this.clearActiveDragMode()}getMouseEventConfig(){return this.opts.mouseEventConfig}getTouchEventConfig(){return this.opts.touchEventConfig}drawRect(i,e=[1,0,0,-1]){if(e[3]<0&&(e=this.opts.crosshairColor),!this.rectShader)throw new Error("rectShader undefined");this.gl.disable(this.gl.CULL_FACE),this.opts.selectionBoxIsOutline?(this.drawCircle(i,e,.1),this.rectOutlineShader.use(this.gl),this.gl.enable(this.gl.BLEND),this.gl.uniform1f(this.rectOutlineShader.uniforms.thickness,this.opts.selectionBoxLineThickness),this.gl.uniform4fv(this.rectOutlineShader.uniforms.lineColor,e),this.gl.uniform2fv(this.rectOutlineShader.uniforms.canvasWidthHeight,[this.gl.canvas.width,this.gl.canvas.height]),this.gl.uniform4f(this.rectOutlineShader.uniforms.leftTopWidthHeight,i[0],i[1],i[2],i[3]),this.gl.bindVertexArray(this.genericVAO),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.gl.bindVertexArray(this.unusedVAO)):(this.rectShader.use(this.gl),this.gl.enable(this.gl.BLEND),this.gl.uniform4fv(this.rectShader.uniforms.lineColor,e),this.gl.uniform2fv(this.rectShader.uniforms.canvasWidthHeight,[this.gl.canvas.width,this.gl.canvas.height]),this.gl.uniform4f(this.rectShader.uniforms.leftTopWidthHeight,i[0],i[1],i[2],i[3]),this.gl.bindVertexArray(this.genericVAO),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.gl.bindVertexArray(this.unusedVAO))}drawBoundsBox(i,e,t=2){if(!this.rectOutlineShader)throw new Error("rectOutlineShader undefined");const n=this.gl,[s,r,a,l]=i;n.viewport(0,0,n.canvas.width,n.canvas.height),this.rectOutlineShader.use(n),n.enable(n.BLEND),n.uniform1f(this.rectOutlineShader.uniforms.thickness,t),n.uniform4fv(this.rectOutlineShader.uniforms.lineColor,e),n.uniform2fv(this.rectOutlineShader.uniforms.canvasWidthHeight,[n.canvas.width,n.canvas.height]),n.uniform4f(this.rectOutlineShader.uniforms.leftTopWidthHeight,s,r,a,l),n.bindVertexArray(this.genericVAO),n.drawArrays(n.TRIANGLE_STRIP,0,4),n.bindVertexArray(this.unusedVAO)}drawCircle(i,e=this.opts.fontColor,t=1){if(!this.circleShader)throw new Error("circleShader undefined");this.circleShader.use(this.gl),this.gl.enable(this.gl.BLEND),this.gl.uniform4fv(this.circleShader.uniforms.circleColor,e),this.gl.uniform2fv(this.circleShader.uniforms.canvasWidthHeight,[this.gl.canvas.width,this.gl.canvas.height]),this.gl.uniform4f(this.circleShader.uniforms.leftTopWidthHeight,i[0],i[1],i[2],i[3]),this.gl.uniform1f(this.circleShader.uniforms.fillPercent,t),this.gl.uniform4fv(this.circleShader.uniforms.circleColor,e),this.gl.bindVertexArray(this.genericVAO),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.gl.bindVertexArray(this.unusedVAO)}drawSelectionBox(i){if(this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.getCurrentDragMode()===6){this.drawCircle(i,this.opts.selectionBoxColor,.1);return}this.drawRect(i,this.opts.selectionBoxColor)}effectiveCanvasHeight(){return UO({canvasHeight:this.gl.canvas.height,bounds:this.opts.bounds,colorbarHeight:this.colorbarHeight})}effectiveCanvasWidth(){return VO({canvasWidth:this.gl.canvas.width,bounds:this.opts.bounds,legendPanelWidth:this.getLegendPanelWidth()})}getAllLabels(){return Ck({meshes:this.meshes,documentLabels:this.document.labels})}getConnectomeLabels(){return Ek({meshes:this.meshes,documentLabels:this.document.labels})}getBulletMarginWidth(){const i=this.getConnectomeLabels();return GO({labels:i,fontPx:this.fontPx,textHeight:(e,t)=>this.textHeight(e,t)})}getLegendPanelWidth(){const i=this.getConnectomeLabels();return HO({labels:i,showLegend:this.opts.showLegend,fontPx:this.fontPx,canvasWidth:this.gl.canvas.width,textWidth:(e,t)=>this.textWidth(e,t),getBulletMarginWidth:()=>this.getBulletMarginWidth()})}getLegendPanelHeight(i=1){const e=this.getConnectomeLabels();return YO({labels:e,fontPx:this.fontPx,panelScale:i,textHeight:(t,n)=>this.textHeight(t,n)})}reserveColorbarPanel(){const i=qO({fontPx:this.fontPx,boundsRegion:this.getBoundsRegion(),colorbarWidth:this.opts.colorbarWidth});return this.colorbarHeight=i.colorbarHeight,i.leftTopWidthHeight}drawColorbarCore(i=0,e=[0,0,0,0],t=!1,n=0,s=1,r){if(e[2]<=0||e[3]<=0)return;const a=this.fontPx;if(a<=0)return;this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);let l=a;const c=3*a;let h=a;if(e[3]<c){if(e[3]<3)return;l=1,h=e[3]-2}this.gl.disable(this.gl.DEPTH_TEST),this.colorbarHeight=e[3]+1;const d=[e[0]+l,e[1],e[2]-2*l,h],f=[d[0]-1,d[1]-1,d[2]+2,d[3]+2];if(this.opts.showColorbarBorder&&this.drawRect(f,this.opts.crosshairColor),!this.colorbarShader)throw new Error("colorbarShader undefined");this.colorbarShader.use(this.gl),this.gl.activeTexture(ct.TEXTURE1_COLORMAPS),this.gl.bindTexture(this.gl.TEXTURE_2D,this.colormapTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST);const p=i;if(this.gl.uniform1f(this.colorbarShader.uniforms.layer,p),this.gl.uniform2fv(this.colorbarShader.uniforms.canvasWidthHeight,[this.gl.canvas.width,this.gl.canvas.height]),this.gl.disable(this.gl.CULL_FACE),t){const M=[d[0]+d[2],d[1],-d[2],d[3]];this.gl.uniform4fv(this.colorbarShader.uniforms.leftTopWidthHeight,M)}else this.gl.uniform4fv(this.colorbarShader.uniforms.leftTopWidthHeight,d);this.gl.bindVertexArray(this.genericVAO),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.gl.bindVertexArray(this.unusedVAO),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);let g=0;if(r&&s<0&&t?(g=s,s=0):r&&n>0&&(g=n,n=0),n===s||a<1)return;const y=Math.abs(s-n);let[x,b]=Bb(n,s);b<n&&(b+=x);function w(M){return M.toFixed(6).replace(/\.?0*$/,"")}let S=b;const C=[0,d[1]+d[3]-a*.5,2,a*.75],E=C[1]+C[3],D=1;for(;S<=s;){C[0]=d[0]+(S-n)/y*d[2],this.drawRect(C);const M=w(D*S);this.drawTextBelow([C[0],E],M),S+=x}if(g!==0){const M=[d[0]+(g-n)/y*d[2],d[1]-d[3]*.25,2,d[3]*1.5];this.drawRect(M)}}drawColorbar(){const i=this.colormapLists,e=i.length;if(e<1)return;let t=0;for(let a=0;a<e;a++)i[a].visible&&t++;if(t<1)return;let n=this.reserveColorbarPanel();const s=3*this.fontPx;if(s<0)return;let r=n[2]/t;(n[2]<=0||n[3]<=0)&&(r=this.gl.canvas.width/t,n=[0,this.gl.canvas.height-s,r,s]),n[2]=r;for(let a=0;a<e;a++)i[a].visible&&(this.drawColorbarCore(a,n,i[a].negative,i[a].min,i[a].max,i[a].isColorbarFromZero),n[0]+=r)}textWidth(i,e){return e7({fontMets:this.fontMets,scale:i,str:e})}textHeight(i,e){return t7({fontMets:this.fontMets,scale:i,str:e})}drawChar(i,e,t){if(!this.fontShader)throw new Error("fontShader undefined");const n=this.fontMets.mets[t],s=i[0]+e*n.lbwh[0],r=-(e*n.lbwh[1]),a=e*n.lbwh[2],l=e*n.lbwh[3],c=i[1]+(r-l)+e;return this.gl.uniform4f(this.fontShader.uniforms.leftTopWidthHeight,s,c,a,l),this.gl.uniform4fv(this.fontShader.uniforms.uvLeftTopWidthHeight,n.uv_lbwh),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),e*n.xadv}drawLoadingText(i){if(!i)return;if(!this.canvas)throw new Error("canvas undefined");const[e,t,n,s]=this.getBoundsRegion();this.gl.viewport(e,t,n,s),this.gl.enable(this.gl.CULL_FACE),this.gl.enable(this.gl.BLEND);const r=e+n/2,a=t+s/2;this.drawTextBelow([r,a],i,3)}drawText(i,e,t=1,n=null){if(this.fontPx<=0)return;if(!this.fontShader)throw new Error("fontShader undefined");this.fontShader.use(this.gl);const s=this.fontPx*t;this.gl.enable(this.gl.BLEND),this.gl.uniform2f(this.fontShader.uniforms.canvasWidthHeight,this.gl.canvas.width,this.gl.canvas.height),n===null&&(n=this.opts.fontColor),this.gl.uniform4fv(this.fontShader.uniforms.fontColor,n);let r=s/this.fontMets.size*this.fontMets.distanceRange;r=Math.max(r,1),this.gl.uniform1f(this.fontShader.uniforms.screenPxRange,r);const a=new TextEncoder().encode(e);this.gl.bindVertexArray(this.genericVAO);for(let l=0;l<e.length;l++)i[0]+=this.drawChar(i,s,a[l]);this.gl.bindVertexArray(this.unusedVAO)}drawTextRight(i,e,t=1,n=null){this.fontPx<=0||(i[1]-=.5*this.fontPx,this.drawText(i,e,t,n))}drawTextLeft(i,e,t=1,n=null){if(this.fontPx<=0)return;const s=this.fontPx*t;i[0]-=this.textWidth(s,e),i[1]-=.5*s,this.drawText(i,e,t,n)}drawTextRightBelow(i,e,t=1,n=null){this.fontPx<=0||this.drawText(i,e,t,n)}drawTextBetween(i,e,t=1,n=null){if(this.fontPx<=0)return;const s=s7(i,e,this.fontPx,t,(a,l)=>this.textWidth(a,l)),r=r7(n,this.opts.crosshairColor);this.drawRect(s.rectLTWH,r),this.drawText([s.textX,s.textY],e,t,n)}drawTextBelow(i,e,t=1,n=null){if(this.fontPx<=0)return;if(!this.canvas)throw new Error("canvas undefined");const s=i7({xy:i,str:e,fontPx:this.fontPx,scale:t,canvasWidth:this.canvas.width},(r,a)=>this.textWidth(r,a));this.drawText([s.x,s.y],e,s.scale,n)}drawTextAbove(i,e,t=1,n=null){if(this.fontPx<=0)return;if(!this.canvas)throw new Error("canvas undefined");const s=n7({xy:i,str:e,fontPx:this.fontPx,scale:t,canvasWidth:this.canvas.width},(r,a)=>this.textWidth(r,a));this.drawText([s.x,s.y],e,s.scale,n)}updateInterpolation(i,e=!1){Ik({gl:this.gl,layer:i,isForceLinear:e,isNearestInterpolation:this.opts.isNearestInterpolation,is2DSliceShader:this.opts.is2DSliceShader})}setAtlasOutline(i){this.opts.atlasOutline=i,this.updateGLVolume(),this.drawScene()}setInterpolation(i){this.opts.isNearestInterpolation=i;const e=this.volumes.length;if(!(e<1)){for(let t=0;t<e;t++)this.updateInterpolation(t);this.drawScene()}}calculateMvpMatrix2D(i,e,t,n=1/0,s=0,r=0,a=0,l=!1){this.gl.viewport(i[0],this.gl.canvas.height-(i[1]+i[3]),i[2],i[3]);let h=e[0],d=t[0],f=[h,e[1]],p=[d-h,t[1]-e[1]];l&&(f=[t[0],e[1]],p=[e[0]-t[0],t[1]-e[1]],h=-t[0],d=-e[0]);const g=2*Math.max(Math.abs(e[2]),Math.abs(t[2])),y=it();let x=.01,b=g*8;if(n!==1/0){let M=l;a===0&&(r===0||r===180)&&(M=!M);let N=g*1.8-s;M||(N=g*1.8+s),b=N-n,x=N+n}Pd(y,h,d,e[1],t[1],b,x);const w=it();w[0]=-1;const S=Ae(0,0,-g*1.8);No(w,w,S),_d(w,w,_r(270-a)),Fd(w,w,_r(r-180));const C=it();rn(C,w);const E=it();sn(E,C);const D=it();return ga(D,y,w),{modelViewProjectionMatrix:D,modelMatrix:w,normalMatrix:E,leftTopMM:f,fovMM:p}}swizzleVec3MM(i,e){return hB(i,e)}screenFieldOfViewVox(i=0){const e=kn(this.volumeObject3D.fieldOfViewDeObliqueMM);return this.swizzleVec3MM(e,i)}screenFieldOfViewMM(i=0,e=!1){if(this.volumes.length<1){let l=Ae(this.extentsMin[0],this.extentsMin[1],this.extentsMin[2]),c=Ae(this.extentsMax[0],this.extentsMax[1],this.extentsMax[2]);l=this.swizzleVec3MM(l,i),c=this.swizzleVec3MM(c,i);const h=bt();return It(h,c,l),h}if(!e&&!this.opts.isSliceMM)return this.screenFieldOfViewVox(i);const t=this.volumeObject3D.extentsMin,n=this.volumeObject3D.extentsMax;let s=Ae(t[0],t[1],t[2]),r=Ae(n[0],n[1],n[2]);s=this.swizzleVec3MM(s,i),r=this.swizzleVec3MM(r,i);const a=bt();return It(a,r,s),a}screenFieldOfViewExtendedVox(i=0){const e=this.volumes[0].extentsMinOrtho,t=this.volumes[0].extentsMaxOrtho;let n=Ae(e[0],e[1],e[2]),s=Ae(t[0],t[1],t[2]);const r=it();n=this.swizzleVec3MM(n,i),s=this.swizzleVec3MM(s,i);const a=bt();return It(a,s,n),{mnMM:n,mxMM:s,rotation:r,fovMM:a}}screenFieldOfViewExtendedMM(i=0){if(this.volumes.length<1){let l=Ae(this.extentsMin[0],this.extentsMin[1],this.extentsMin[2]),c=Ae(this.extentsMax[0],this.extentsMax[1],this.extentsMax[2]);const h=it();l=this.swizzleVec3MM(l,i),c=this.swizzleVec3MM(c,i);const d=bt();return It(d,c,l),{mnMM:l,mxMM:c,rotation:h,fovMM:d}}if(!this.volumeObject3D)throw new Error("volumeObject3D undefined");const e=this.volumeObject3D.extentsMin,t=this.volumeObject3D.extentsMax;let n=Ae(e[0],e[1],e[2]),s=Ae(t[0],t[1],t[2]);const r=it();n=this.swizzleVec3MM(n,i),s=this.swizzleVec3MM(s,i);const a=bt();return It(a,s,n),{mnMM:n,mxMM:s,rotation:r,fovMM:a}}drawSliceOrientationText(i,e,t=[NaN,NaN]){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);let n="S";e===0&&(n="A");let s=this.opts.isRadiologicalConvention?"R":"L";e===2&&(s=this.opts.sagittalNoseLeft?"A":"P");let r="I";e===0&&(r="P");let a=this.opts.isRadiologicalConvention?"L":"R";if(e===2&&(a=this.opts.sagittalNoseLeft?"P":"A"),this.opts.isCornerOrientationText){this.drawTextRightBelow([i[0],i[1]],s+n);return}let l=!0,c=!0;const h=this.opts.showAllOrientationMarkers,d=this.opts.showAllOrientationMarkers;if(!isNaN(t[0])){const f=this.fontPx+2;t[1]>f&&(this.drawTextBelow([i[0]+i[2]*.5,i[1]+t[1]-f],n),l=!1);const p=this.textWidth(f,s)+2;t[0]>p&&(this.drawTextRight([i[0]+t[0]-p,i[1]+i[3]*.5],s),c=!1)}l&&this.drawTextBelow([i[0]+i[2]*.5,i[1]],n),c&&this.drawTextRight([i[0],i[1]+i[3]*.5],s),h&&this.drawTextAbove([i[0]+i[2]*.5,i[1]+i[3]],r),d&&this.drawTextLeft([i[0]+i[2],i[1]+i[3]*.5],a)}xyMM2xyzMM(i,e){return zO({axCorSag:i,sliceFrac:e,frac2mm:t=>this.frac2mm(t),swizzleVec3MM:(t,n)=>this.swizzleVec3MM(t,n)})}draw2DMain(i,e,t=NaN){let n=new Float32Array([0,0,0]);this.volumes.length>0&&(n=new Float32Array(this.volumes[0].frac2mm.slice()));let s=this.screenFieldOfViewExtendedMM(e),r=it();!this.opts.isSliceMM&&this.volumes.length>0&&(n=new Float32Array(this.volumes[0].frac2mmOrtho.slice()),r=Qt(this.volumes[0].mm2ortho),s=this.screenFieldOfViewExtendedVox(e));let a=this.opts.isRadiologicalConvention&&e<2;t===1/0||t===-1/0?(a=t!==1/0,e===1&&(a=!a)):this.opts.sagittalNoseLeft&&e===2&&(a=!a);let l=0,c=0;e===2?c=a?90:-90:e===1?c=a?180:0:(c=a?180:0,l=a?-90:90);const h=this.gl;let d=!1;if(i[2]===0||i[3]===0){d=!0;const S=h.canvas.width/s.fovMM[0],C=h.canvas.height/s.fovMM[1],E=Math.min(S,C),D=S/E,M=C/E;s.fovMM[0]*=D,s.fovMM[1]*=M;let N=(s.mnMM[0]+s.mxMM[0])*.5;s.mnMM[0]=N-s.fovMM[0]*.5,s.mxMM[0]=N+s.fovMM[0]*.5,N=(s.mnMM[1]+s.mxMM[1])*.5,s.mnMM[1]=N-s.fovMM[1]*.5,s.mxMM[1]=N+s.fovMM[1]*.5,i=[0,0,h.canvas.width,h.canvas.height]}if(isNaN(t)){const S=this.scene.pan2Dxyzmm,C=this.swizzleVec3MM(Ae(S[0],S[1],S[2]),e),E=this.scene.pan2Dxyzmm[3];s.mnMM[0]-=C[0],s.mxMM[0]-=C[0],s.mnMM[1]-=C[1],s.mxMM[1]-=C[1],s.mnMM[0]/=E,s.mxMM[0]/=E,s.mnMM[1]/=E,s.mxMM[1]/=E}let f=2;e===1&&(f=1),e===2&&(f=0);let p=this.scene.crosshairPos[f],g=this.frac2mm(this.scene.crosshairPos);!isNaN(t)&&t!==1/0&&t!==-1/0&&(g=this.frac2mm([.5,.5,.5]),g[f]=t,p=this.mm2frac(g)[f]);const y=g[f],x=h.canvas.height-i[1]-i[3],b=[i[0],x,i[2],i[3]];this.clearBounds(h.DEPTH_BUFFER_BIT,b),h.viewport(b[0],b[1],b[2],b[3]);let w=this.calculateMvpMatrix2D(i,s.mnMM,s.mxMM,1/0,0,c,l,a);if(t===1/0||t===-1/0){const S=i.slice();this.draw3D(i,w.modelViewProjectionMatrix,w.modelMatrix,w.normalMatrix,c,l);const C=this.screenSlices[this.screenSlices.length-1];C.leftTopWidthHeight=S,C.axCorSag=e,C.sliceFrac=1/0,C.AxyzMxy=this.xyMM2xyzMM(e,p),C.leftTopMM=w.leftTopMM,C.fovMM=w.fovMM;return}if(h.enable(h.DEPTH_TEST),h.blendFunc(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA),h.disable(h.BLEND),h.depthFunc(h.ALWAYS),h.disable(h.CULL_FACE),this.volumes.length>0){let S=this.sliceMMShader;if(this.opts.is2DSliceShader&&(S=this.slice2DShader),this.opts.isV1SliceShader&&(S=this.sliceV1Shader),this.customSliceShader&&(S=this.customSliceShader),!S)throw new Error("slice Shader undefined");S.use(this.gl),h.uniform1f(S.uniforms.overlayOutlineWidth,this.overlayOutlineWidth),h.uniform1f(S.uniforms.overlayAlphaShader,this.overlayAlphaShader),h.uniform1i(S.uniforms.isAlphaClipDark,this.isAlphaClipDark?1:0),h.uniform1i(S.uniforms.backgroundMasksOverlays,this.backgroundMasksOverlays),h.uniform1f(S.uniforms.drawOpacity,this.drawOpacity),h.uniform1f(S.uniforms.drawRimOpacity,this.drawRimOpacity),h.enable(h.BLEND),h.blendFunc(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA),h.uniform1f(S.uniforms.opacity,this.volumes[0].opacity),h.uniform1i(S.uniforms.axCorSag,e),h.uniform1f(S.uniforms.slice,p),h.uniformMatrix4fv(S.uniforms.frac2mm,!1,n),h.uniformMatrix4fv(S.uniforms.mvpMtx,!1,w.modelViewProjectionMatrix.slice()),h.bindVertexArray(this.genericVAO),h.drawArrays(h.TRIANGLE_STRIP,0,4),h.bindVertexArray(this.unusedVAO),this.screenSlices.push({leftTopWidthHeight:i,axCorSag:e,sliceFrac:p,AxyzMxy:this.xyMM2xyzMM(e,p),leftTopMM:w.leftTopMM,screen2frac:[],fovMM:w.fovMM})}if(h.depthMask(!0),h.depthFunc(h.LEQUAL),isNaN(t)&&this.drawCrosshairs3D(!0,1,w.modelViewProjectionMatrix,!0,this.opts.isSliceMM),this.opts.meshThicknessOn2D>0){this.opts.meshThicknessOn2D!==1/0&&(w=this.calculateMvpMatrix2D(i,s.mnMM,s.mxMM,this.opts.meshThicknessOn2D,y,c,l,a));const S=Qt(w.modelViewProjectionMatrix);ga(S,S,r),this.drawMesh3D(!0,1,S,w.modelMatrix,w.normalMatrix,!0)}isNaN(t)&&this.drawCrosshairs3D(!1,.15,w.modelViewProjectionMatrix,!0,this.opts.isSliceMM),d&&this.opts.isOrientationTextVisible&&this.drawSliceOrientationText(i,e),this.readyForSync=!0}draw2D(i,e,t=NaN,n=[NaN,NaN]){const[s,r,a,l]=this.getBoundsRegion();let c;i[2]===0&&i[3]===0?this.opts.bounds?c=[s,r,a,l]:c=[0,0,this.gl.canvas.width,this.gl.canvas.height]:c=i.slice();const h=[NaN,NaN];if(n[0]===1/0){const d=this.sliceScale().volScale;let f=this.scaleSlice(d[0],d[1],[0,0],[c[2],c[3]]);e===1&&(f=this.scaleSlice(d[0],d[2],[0,0],[c[2],c[3]])),e===2&&(f=this.scaleSlice(d[1],d[2],[0,0],[c[2],c[3]])),n[0]=f[2],n[1]=f[3]}isNaN(n[0])?this.draw2DMain(c,e,t):(h[0]=Math.floor(.5*(c[2]-n[0])),h[1]=Math.floor(.5*(c[3]-n[1])),c[0]+=h[0],c[1]+=h[1],c[2]=n[0],c[3]=n[1],this.draw2DMain(c,e,t)),!(t===1/0||t===-1/0||e===4)&&c[2]!==0&&c[3]!==0&&this.opts.isOrientationTextVisible&&this.drawSliceOrientationText(c,e,h)}calculateMvpMatrix(i,e=[0,0,0,0],t,n){const s=Zk({canvasWidth:this.gl.canvas.width,canvasHeight:this.gl.canvas.height,leftTopWidthHeight:e,azimuth:t,elevation:n,furthestFromPivot:this.furthestFromPivot,pivot3D:this.pivot3D,volScaleMultiplier:this.scene.volScaleMultiplier,position:this.position});return[s.mvpMatrix,s.modelMatrix,s.normalMatrix]}calculateModelMatrix(i,e){if(!this.back)throw new Error("back undefined");return _1({azimuth:i,elevation:e,obliqueRAS:this.back.obliqueRAS})}calculateRayDirection(i,e){return o4({azimuth:i,elevation:e,obliqueRAS:this.back?.obliqueRAS})}sceneExtentsMinMax(i=!0){return S1({volumes:this.volumes,meshes:this.meshes,volumeObject3D:this.volumeObject3D},i)}setPivot3D(){const[i,e]=this.sceneExtentsMinMax(),t=Jk({sceneMin:i,sceneMax:e});this.pivot3D=t.pivot3D,this.furthestFromPivot=t.furthestFromPivot,this.extentsMin=t.extentsMin,this.extentsMax=t.extentsMax}getMaxVols(){return $k({volumes:this.volumes})}detectPartialllyLoaded4D(){if(this.volumes.length<1)return!1;for(let i=0;i<this.volumes.length;i++)if(this.volumes[i].nFrame4D<this.volumes[i].hdr.dims[4])return!0;return!1}drawGraph(){if(this.getMaxVols()<2)return;const i=this.graph,[e,t,n,s]=this.getBoundsRegion();let r=0;if(i.autoSizeMultiplanar&&this.opts.sliceType===3)for(let W=0;W<this.screenSlices.length;W++){const K=this.screenSlices[W].axCorSag;if(K===0&&(r=this.screenSlices[W].leftTopWidthHeight[1]),K!==2)continue;const ee=this.screenSlices[W].leftTopWidthHeight.slice();ee[1]===r?(i.LTWH[0]=ee[0]+ee[2],i.LTWH[1]=ee[1]):(i.LTWH[0]=ee[0],i.LTWH[1]=ee[1]+ee[3]),i.LTWH[2]=ee[2],i.LTWH[3]=ee[2]}if(i.LTWH[0]=Math.max(e,i.LTWH[0]),i.LTWH[1]=Math.max(t,i.LTWH[1]),i.LTWH[2]=Math.min(n,i.LTWH[2]),i.LTWH[3]=Math.min(s,i.LTWH[3]),i.opacity<=0||i.LTWH[2]<=5||i.LTWH[3]<=5||Math.floor(i.LTWH[0]+i.LTWH[2])>e+n||Math.floor(i.LTWH[1]+i.LTWH[3])>t+s)return;i.backColor=[.15,.15,.15,i.opacity],i.lineColor=[1,1,1,1],this.opts.backColor[0]+this.opts.backColor[1]+this.opts.backColor[2]>1.5&&(i.backColor=[.95,.95,.95,i.opacity],i.lineColor=[0,0,0,1]);const a=.2,l=.3;i.lineColor[3]=a,i.textColor=i.lineColor.slice(),i.textColor[3]=1,i.lineThickness=3,i.gridLineThickness=1,i.lineAlpha=1,i.lines=[];const c=[];if(i.vols.length<1)this.volumes[0]!=null&&c.push(0);else for(let W=0;W<i.vols.length;W++){const K=i.vols[W];this.volumes[K]==null||this.volumes[K].nFrame4D<2||c.push(K)}if(c.length<1)return;const h=this.volumes[c[0]].nFrame4D;if(this.graph.selectedColumn=this.volumes[c[0]].frame4D,h<2){X.debug("Unable to generate a graph: Selected volume is 3D not 4D");return}for(let W=0;W<c.length;W++){i.lines[W]=[];const K=this.frac2vox(this.scene.crosshairPos),ee=this.volumes[c[W]];let le=ee.nFrame4D;le=Math.min(le,h);for(let he=0;he<le;he++){const ce=ee.getValue(K[0],K[1],K[2],he);i.lines[W].push(ce)}}i.lineRGB=[[.8,0,0],[0,.7,0],[0,0,.9],[.7,.7,0],[.8,0,.8],[0,.7,.7],[.6,.6,.6],[0,0,0]];let d=i.lines[0][0],f=i.lines[0][0];for(let W=0;W<i.lines.length;W++)for(let K=0;K<i.lines[W].length;K++){const ee=i.lines[W][K];d=Math.min(ee,d),f=Math.max(ee,f)}const p=this.volumes[c[0]].cal_min,g=this.volumes[c[0]].cal_max;if(i.isRangeCalMinMax&&p<g&&isFinite(p)&&isFinite(g)&&(d=p,f=g),i.normalizeValues&&f>d){const W=f-d;for(let K=0;K<i.lines.length;K++)for(let ee=0;ee<i.lines[K].length;ee++){const le=i.lines[K][ee];i.lines[K][ee]=(le-d)/W}d=0,f=1}d>=f&&(f=d+1),this.drawRect(i.LTWH,i.backColor);const[y,x,b]=Bb(d,f),w=Math.max(0,-1*Math.floor(Math.log(y)/Math.log(10)));d=Math.min(x,d),f=Math.max(b,f);function S(W){return W.toFixed(6).replace(/\.?0*$/,"")}let C=this.fontPx*.7;const E=n/this.uiData.dpr,D=s/this.uiData.dpr,M=E*D,N=800*600;M<N?C=0:C=Math.max(C,this.opts.fontMinPx);const I=C/this.fontPx;let _=0,F=x;if(C>0)for(;F<=f;){const W=F.toFixed(w),K=this.textWidth(C,W);_=Math.max(K,_),F+=y}const B=.05,P=Math.abs(i.LTWH[2]),O=Math.abs(i.LTWH[3]),k=[i.LTWH[0]+B*P+_,i.LTWH[1]+B*O,i.LTWH[2]-_-2*B*P,i.LTWH[3]-C-2.5*B*O];this.graph.LTWH=i.LTWH,this.graph.plotLTWH=k,this.drawRect(k,this.opts.backColor);const q=f-d,U=k[3]/q,H=k[2]/(i.lines[0].length-1),Y=k[1]+k[3];F=x+.5*y;const Q=i.lineColor.slice();for(Q[3]=.5*i.lineColor[3];F<=f;){const W=Y-(F-d)*U;this.drawLine([k[0],W,k[0]+k[2],W],i.gridLineThickness,Q),F+=y}F=x;const te=.5*i.gridLineThickness;for(;F<=f;){const W=Y-(F-d)*U;this.drawLine([k[0]-te,W,k[0]+k[2]+i.gridLineThickness,W],i.gridLineThickness,i.lineColor);const K=F.toFixed(w);C>0&&this.drawTextLeft([k[0]-6,W],K,I,i.textColor),F+=y}let j=1;for(;i.lines[0].length/j>20;)j*=5;for(let W=0;W<i.lines[0].length;W+=j){const K=W*H+k[0];let ee=i.gridLineThickness;if(W%2===1)ee*=.5,this.drawLine([K,k[1],K,k[1]+k[3]],ee,Q);else{const le=S(W);C>0&&this.drawTextBelow([K,2+k[1]+k[3]],le,I,i.textColor),this.drawLine([K,k[1],K,k[1]+k[3]],ee,i.lineColor)}}for(let W=0;W<i.lines.length;W++){let K=[1,0,0,i.lineAlpha];W<i.lineRGB.length&&(K=[i.lineRGB[W][0],i.lineRGB[W][1],i.lineRGB[W][2],i.lineAlpha]);for(let ee=1;ee<i.lines[W].length;ee++){const le=(ee-1)*H,he=ee*H,ce=(i.lines[W][ee-1]-d)*U,xe=(i.lines[W][ee]-d)*U,ge=[k[0]+le,k[1]+k[3]-ce,k[0]+he,k[1]+k[3]-xe];this.drawLine(ge,i.lineThickness,K)}}if(i.selectedColumn>=0&&i.selectedColumn<i.lines[0].length){const W=i.selectedColumn*H+k[0];this.drawLine([W,k[1],W,k[1]+k[3]],i.lineThickness,[i.lineRGB[0][0],i.lineRGB[0][1],i.lineRGB[0][2],l])}C>0&&i.LTWH[1]+i.LTWH[3]>k[1]+k[3]+C*2.4&&this.drawTextBelow([k[0]+.5*k[2],k[1]+k[3]+C*1.2],"Volume",I,i.textColor),this.detectPartialllyLoaded4D()&&this.drawTextBelow([k[0]+k[2],k[1]+k[3]+C*.5],"...",I,i.textColor)}depthPicker(i,e){if(!this.uiData.mouseDepthPicker)return;this.uiData.mouseDepthPicker=!1;const t=this.gl,n=this.mousePos[0]*i[2]/i[2],s=t.canvas.height-this.mousePos[1]*i[3]/i[3]-1,r=new Uint8Array(4);if(t.readPixels(n,s,1,1,t.RGBA,t.UNSIGNED_BYTE,r),this.selectedObjectId=r[3],this.selectedObjectId===this.VOLUME_ID){this.scene.crosshairPos=new Float32Array(r.slice(0,3)).map(f=>f/255);return}const a=rB(r);if(a>1)return;const l=(this.mousePos[0]-i[0])/i[2],c=(t.canvas.height-this.mousePos[1]-i[1])/i[3],h=oB(l,c,a,e),d=this.mm2frac(h,0,!0);d[0]<0||d[0]>1||d[1]<0||d[1]>1||d[2]<0||d[2]>1||(this.scene.crosshairPos=this.mm2frac(h,0,!0))}drawImage3D(i,e,t){Lk({gl:this.gl,mvpMatrix:i,azimuth:e,elevation:t,volumesLength:this.volumes.length,volumeObject3D:this.volumeObject3D,unusedVAO:this.unusedVAO,renderShader:this.renderShader,pickingImageShader:this.pickingImageShader,mouseDepthPicker:this.uiData.mouseDepthPicker,backgroundMasksOverlays:this.backgroundMasksOverlays,gradientTextureAmount:this.gradientTextureAmount,gradientTexture:this.gradientTexture,drawBitmap:this.drawBitmap,renderDrawAmbientOcclusion:this.renderDrawAmbientOcclusion,drawOpacity:this.drawOpacity,paqdUniforms:this.opts.paqdUniforms,matRAS:this.back.matRAS,crosshairPos:this.scene.crosshairPos,clipPlaneDepthAziElevs:this.scene.clipPlaneDepthAziElevs,isClipPlanesCutaway:this.opts.isClipPlanesCutaway,obliqueRAS:this.back?.obliqueRAS})}drawOrientationCube(i,e=0,t=0){if(!this.opts.isOrientCube)return;const n=.05*Math.min(i[2],i[3]);if(n<5)return;const s=this.gl;s.enable(s.CULL_FACE),s.cullFace(s.BACK),s.disable(s.DEPTH_TEST),this.orientCubeShader.use(this.gl),s.bindVertexArray(this.orientCubeShaderVAO);const r=it(),a=it();Pd(a,0,s.canvas.width,0,s.canvas.height,-10*n,10*n);let l=0;i[1]===0&&(l=s.canvas.height-this.effectiveCanvasHeight()),No(r,r,[1.8*n+i[0],l+1.8*n+i[1],0]),e3(r,r,[n,n,n]),_d(r,r,_r(270-t)),Fd(r,r,_r(-e));const c=it();ga(c,a,r),s.uniformMatrix4fv(this.orientCubeShader.uniforms.u_matrix,!1,c),s.drawArrays(s.TRIANGLE_STRIP,0,168),s.bindVertexArray(this.unusedVAO),this.gl.disable(this.gl.CULL_FACE)}createOnLocationChange(i=NaN){const[e,t,n]=this.sceneExtentsMinMax(!0),s=Math.max(Math.max(n[0],n[1]),n[2]);function r(f){return Math.max(0,-Math.ceil(Math.log10(Math.abs(f))))}let a=r(s*.001);const l=this.frac2mm(this.scene.crosshairPos,0,!0);function c(f,p=0){return parseFloat(Number(f).toFixed(p))}let h=c(l[0],a)+""+c(l[1],a)+""+c(l[2],a);if(this.volumes.length>0&&this.volumes[0].nFrame4D>0&&(h+=""+c(this.volumes[0].frame4D)),this.volumes.length>0){let f=" = ";for(let y=0;y<this.volumes.length;y++){const x=this.volumes[y].mm2vox(l);let b=this.volumes[y].getValue(x[0],x[1],x[2],this.volumes[y].frame4D);if(a=3,this.volumes[y].colormapLabel!==null){const w=Math.round(b);if(this.volumes[y].hdr.intent_code===1002&&this.volumes[y].hdr.datatypeCode===2304){const S=this.volumes[y].getValues(x[0],x[1],x[2],this.volumes[y].frame4D);if(S[2]>2){const C=Math.round(100*S[2]/255);if(f+=this.volumes[y].colormapLabel.labels[S[0]]+` (${C}%)`,S[3]>2){const E=Math.round(100*S[3]/255);f+=" "+this.volumes[y].colormapLabel.labels[S[1]]+` (${E}%)`}}}else w>=0&&this.volumes[y].colormapLabel.labels&&w<this.volumes[y].colormapLabel.labels.length?f+=this.volumes[y].colormapLabel.labels[w]:f+="undefined("+c(b,a)+")"}else f+=c(b,a);this.volumes[y].imaginary&&(b=this.volumes[y].getValue(x[0],x[1],x[2],this.volumes[y].frame4D,!0),b>=0&&(f+="+"),f+=c(b,a)),f+="   "}h+=f;const p=this.back.dimsRAS,g=p[1]*p[2]*p[3];if(this.drawBitmap&&this.drawBitmap.length===g){const y=this.frac2vox(this.scene.crosshairPos),x=y[0]+y[1]*p[1]+y[2]*p[1]*p[2];h+=" "+this.drawLut.labels[this.drawBitmap[x]]}}const d={mm:this.frac2mm(this.scene.crosshairPos,0,!0),axCorSag:i,vox:this.frac2vox(this.scene.crosshairPos),frac:this.scene.crosshairPos,xy:[this.mousePos[0],this.mousePos[1]],values:this.volumes.map(f=>{const p=this.frac2mm(this.scene.crosshairPos,0,!0),g=f.mm2vox(p),y=f.getValue(g[0],g[1],g[2],f.frame4D);return{name:f.name,value:y,id:f.id,mm:p,vox:g}}),string:h};this.onLocationChange(d)}addLabel(i,e,t,n,s){const r={textColor:this.opts.legendTextColor,textScale:1,textAlignment:"left",lineWidth:0,lineColor:this.opts.legendTextColor,lineTerminator:"none",bulletScale:0,bulletColor:this.opts.legendTextColor},a=e?{...r,...e}:{...r},l=new x1(i,{...a},t,n,s);return this.document.labels.push(l),l}calculateScreenPoint(i,e,t){const n=qs();return Pi(n,[...i,1],e),n[3]!==0&&(n[0]=(n[0]/n[3]+1)*.5*t[2],n[1]=(1-n[1]/n[3])*.5*t[3],n[2]/=n[3],n[0]+=t[0],n[1]+=t[1]),n}getLabelAtPoint(i){const e=this.legendFontScaling,t=this.fontPx*e,n=this.fontPx*e;for(const h of this.document.labels){if(h.anchor==null||h.anchor===0)continue;const d=this.fontPx*h.style.textScale*e,f=this.textHeight(d,h.text),p=this.textWidth(d,h.text);if(!(h.anchor&1&&i[0]>p)&&!(h.anchor&2&&(i[0]<(this.gl.canvas.width-p)/2||i[0]>(this.gl.canvas.width+p)/2))&&!(h.anchor&4&&i[0]<this.gl.canvas.width-p)&&!(h.anchor&8&&(i[1]<n/2||i[1]>f+n/2))&&!(h.anchor&16&&(i[1]<(this.gl.canvas.height-f-n)/2||i[1]>(this.gl.canvas.height+f-n/2)/2))&&!(h.anchor&32&&(i[1]<this.gl.canvas.height-f-n||i[1]>this.gl.canvas.height-n/2)))return h}X.debug("screenPoint",i);const s=this.getLegendPanelHeight(e),r=this.getLegendPanelWidth(),a=this.gl.canvas.width-r;let l=(this.canvas.height-s)/2;if(X.debug("panelrect",a,l,a+r,l+s),i[0]<a||i[1]<l||i[0]>a+r||i[1]>l+s)return null;const c=this.getConnectomeLabels();for(const h of c){const d=this.fontPx*h.style.textScale*e,f=this.textHeight(d,h.text);if(i[1]>=l&&i[1]<=l+f+t/2)return X.debug(`label clicked ${h.text}`),h;l+=f,l+=t/2}return null}drawLabelLine(i,e,t,n,s=!1){const r=Array.isArray(i.points)&&Array.isArray(i.points[0])?i.points:[i.points];for(const a of r){const l=this.calculateScreenPoint(a,t,n);s?this.drawDottedLine([...e,l[0],l[1]],i.style.lineWidth,i.style.lineColor):this.draw3DLine(e,[l[0],l[1],l[2]],i.style.lineWidth,i.style.lineColor)}}draw3DLabel(i,e,t,n,s,r,a,l=1){const c=i.text,h=e[0],d=e[1],f=this.fontPx*l,p=this.textHeight(i.style.textScale,c)*f;if(i.style.lineWidth>0&&Array.isArray(i.points)&&this.drawLabelLine(i,[h,d+p],t,n,a),i.style.bulletScale){const x=i.style.bulletScale*p,b=p-x,w=d+b/2+x/2,S=h+(s-x)/2;this.drawCircle([S,w,x,x],i.style.bulletColor)}let g=h;if(r)if(i.style.textAlignment!=="left"){const x=this.textWidth(i.style.textScale,i.text)*f;if(i.style.textAlignment==="right")g=h+r-f*1.5-x;else{const b=r-(s||f);g+=(b-x)/2}}else g+=s;const y=i.style.textScale;this.drawText([g,d],c,y,i.style.textColor)}draw3DLabels(i,e,t=!1){const n=this.getConnectomeLabels();if(!this.opts.showLegend||n.length===0)return;let s=this.getLegendPanelHeight(1);if(!this.canvas||s<1)return;const r=this.gl;if(r.disable(r.CULL_FACE),r.viewport(0,0,this.canvas.width,this.canvas.height),this.legendFontScaling=1,s>this.canvas.height){const g=10*this.uiData.dpr;this.legendFontScaling=Math.max(this.canvas.height-g,1)/s,X.debug(`Legend too large for screen, font reduction factor x${this.legendFontScaling}`),s=this.getLegendPanelHeight(this.legendFontScaling)}const a=this.fontPx*this.legendFontScaling,l=this.getBulletMarginWidth(),c=this.getLegendPanelWidth(),h=r.canvas.width-c;let d=(this.canvas.height-s)/2;this.drawRect([r.canvas.width-c,d,c-a,s],this.opts.legendBackgroundColor);const f=r.getParameter(r.BLEND),p=r.getParameter(r.DEPTH_FUNC);t||(r.disable(r.BLEND),r.depthFunc(r.LEQUAL));for(const g of n){this.draw3DLabel(g,[h,d],i,e,l,c,t,this.legendFontScaling);const y=this.fontPx*g.style.textScale,x=this.textHeight(y,g.text)*this.legendFontScaling;d+=x,d+=a/2}t||(r.depthFunc(p),f&&r.enable(r.BLEND))}drawAnchoredLabels(){const i=this.fontPx,e=this.document.labels.filter(t=>t.anchor!=null&&t.anchor!==0);for(const t of e){const n=t.text,s=this.textHeight(t.style.textScale,n)*i,r=this.textWidth(t.style.textScale,n)*i;let a,l;const h=this.fontPx*1,d=h;let f=h/4,p=0,g=0;t.anchor&1&&(a=0),t.anchor&4&&(a=this.canvas.width-r,p-=h/4),t.anchor&2&&(a=(this.canvas.width-r)/2,p-=h/4,f+=h/4),t.anchor&8&&(l=0),t.anchor&16&&(l=(this.canvas.height-s-h)/2,g-=h/4),t.anchor&32&&(l=this.canvas.height-s-h,g-=h/4),this.drawRect([a+p,l+g,r+f,s+d],t.style.backgroundColor),this.draw3DLabel(t,[a,l])}}draw3D(i=[0,0,0,0],e=null,t=null,n=null,s=null,r=0){const a=this.gl,[l,c,h,d]=this.getBoundsRegion();let f=[...i];(f[2]===0||f[3]===0)&&(f=this.opts.bounds?[l,c,h,d]:[0,0,a.canvas.width,a.canvas.height]);const p=s!==null;this.setPivot3D(),p||(s=this.scene.renderAzimuth,r=this.scene.renderElevation),e===null&&([e,t,n]=this.calculateMvpMatrix(null,f,s,r));const g=[...f];this.screenSlices.push({leftTopWidthHeight:f.slice(),axCorSag:4,sliceFrac:0,AxyzMxy:[],leftTopMM:[],fovMM:[aB(t),0]});const y=[f[0],a.canvas.height-f[3]-f[1],f[2],f[3]];if(f[1]=a.canvas.height-f[3]-f[1],a.clear(a.DEPTH_BUFFER_BIT),a.enable(a.DEPTH_TEST),a.depthFunc(a.ALWAYS),a.depthMask(!0),this.draw3DLabels(e,g,!1),this.gl.viewport(y[0],y[1],y[2],y[3]),this.volumes.length>0&&(this.updateInterpolation(0,!0),this.updateInterpolation(1,!0),this.drawImage3D(e,s,r)),this.updateInterpolation(0),this.updateInterpolation(1),p||this.drawCrosshairs3D(!0,1,e),this.drawMesh3D(!0,1,e,t,n),this.uiData.mouseDepthPicker){this.depthPicker(f,e),this.createOnLocationChange(),this.draw3D(g,e,t,n,s,r);return}this.opts.meshXRay>0&&this.drawMesh3D(!1,this.opts.meshXRay,e,t,n),this.gl.disable(this.gl.CULL_FACE),this.draw3DLabels(e,g,!1),a.viewport(f[0],f[1],f[2],f[3]),p||this.drawCrosshairs3D(!1,.15,e),a.viewport(l,c,h,d),this.drawOrientationCube(f,s,r);const x="azimuth: "+this.scene.renderAzimuth.toFixed(0)+" elevation: "+this.scene.renderElevation.toFixed(0);return this.readyForSync=!0,this.sync(),this.draw3DLabels(e,g,!0),x}drawMesh3D(i=!0,e=1,t,n,s,r=!1){this.meshes.length<1||(t||([t,n,s]=this.calculateMvpMatrix(this.volumeObject3D,void 0,this.scene.renderAzimuth,this.scene.renderElevation)),Qk({gl:this.gl,meshes:this.meshes,isDepthTest:i,alpha:e,mvpMatrix:t,modelMatrix:n,normalMatrix:s,is2D:r,meshShaders:this.meshShaders,pickingMeshShader:this.pickingMeshShader,fiberShader:this.fiberShader,mouseDepthPicker:this.uiData.mouseDepthPicker,matCapTexture:this.matCapTexture,unusedVAO:this.unusedVAO,meshXRay:this.opts.meshXRay,meshThicknessOn2D:this.opts.meshThicknessOn2D,frac2mm:a=>this.frac2mm(a,0,this.opts.isSliceMM),crosshairPos:this.scene.crosshairPos}),this.readyForSync=!0)}drawCrosshairs3D(i=!0,e=1,t=null,n=!1,s=!0){if(!this.opts.show3Dcrosshair&&!n||this.opts.crosshairWidth<=0&&n)return;const r=this.gl,a=this.frac2mm(this.scene.crosshairPos,0,s);let l=1;const[c,h,d]=this.sceneExtentsMinMax(s);if(this.volumes.length>0){if(!this.back)throw new Error("back undefined");l=.5*Math.min(Math.min(this.back.pixDims[1],this.back.pixDims[2]),this.back.pixDims[3])}else(d[0]<50||d[0]>1e3)&&(l=d[0]*.02);if(l*=this.opts.crosshairWidth,this.opts?.crosshairWidthUnit==="percent"&&(l=d[0]*this.opts.crosshairWidth*.5*.01),this.opts?.crosshairWidthUnit==="mm"&&(l=this.opts.crosshairWidth*.5),(this.crosshairs3D===null||this.crosshairs3D.mm[0]!==a[0]||this.crosshairs3D.mm[1]!==a[1]||this.crosshairs3D.mm[2]!==a[2])&&(this.crosshairs3D!==null&&(r.deleteBuffer(this.crosshairs3D.indexBuffer),r.deleteBuffer(this.crosshairs3D.vertexBuffer)),this.crosshairs3D=Sa.generateCrosshairs(this.gl,1,a,c,h,l,20,this.opts.crosshairGap),this.crosshairs3D.mm=a),!this.surfaceShader)throw new Error("surfaceShader undefined");const f=this.surfaceShader;f.use(this.gl),t==null&&([t]=this.calculateMvpMatrix(this.crosshairs3D,void 0,this.scene.renderAzimuth,this.scene.renderElevation)),r.uniformMatrix4fv(f.uniforms.mvpMtx,!1,t),r.disable(r.CULL_FACE),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.crosshairs3D.indexBuffer),r.enable(r.DEPTH_TEST);const p=[...this.opts.crosshairColor];i?(r.disable(r.BLEND),r.depthFunc(r.LEQUAL)):(r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.depthFunc(r.ALWAYS)),p[3]=e,r.uniform4fv(f.uniforms.surfaceColor,p),r.bindVertexArray(this.crosshairs3D.vao),r.drawElements(r.TRIANGLES,this.crosshairs3D.indexCount,r.UNSIGNED_INT,0),r.bindVertexArray(this.unusedVAO)}mm2frac(i,e=0,t=!1){return Y3(i,{volumes:this.volumes,meshes:this.meshes,volumeObject3D:this.volumeObject3D,volIdx:e,isSliceMM:t||this.opts.isSliceMM})}vox2frac(i,e=0){return lB(i,this.volumes,e)}frac2vox(i,e=0){return cB(i,this.volumes,e)}moveCrosshairInVox(i,e,t){const n=this.frac2vox(this.scene.crosshairPos),s=FO({x:i,y:e,z:t,currentVox:n,dimsRAS:this.volumes[0].dimsRAS});this.scene.crosshairPos=this.vox2frac(s.newVox),this.createOnLocationChange(),this.opts.is2DSliceShader&&s.zChanged&&(this.updateGLVolume(),this.refreshDrawing(!1)),this.drawScene()}frac2mm(i,e=0,t=!1){return mf(i,{volumes:this.volumes,meshes:this.meshes,volumeObject3D:this.volumeObject3D,volIdx:e,isSliceMM:t||this.opts.isSliceMM})}screenXY2TextureFrac(i,e,t,n=!0){return C1(i,e,this.screenSlices,t,{volumes:this.volumes,meshes:this.meshes,volumeObject3D:this.volumeObject3D,isSliceMM:this.opts.isSliceMM,restrict0to1:n})}canvasPos2frac(i){return fB(i,this.screenSlices,{volumes:this.volumes,meshes:this.meshes,volumeObject3D:this.volumeObject3D,isSliceMM:this.opts.isSliceMM})}frac2canvasPosWithTile(i,e){return pB(i,this.screenSlices,{volumes:this.volumes,meshes:this.meshes,volumeObject3D:this.volumeObject3D,isSliceMM:this.opts.isSliceMM,preferredSliceType:e})}frac2canvasPos(i){return mB(i,this.screenSlices,{volumes:this.volumes,meshes:this.meshes,volumeObject3D:this.volumeObject3D,isSliceMM:this.opts.isSliceMM,sliceType:this.opts.sliceType})}scaleSlice(i,e,t=[0,0],n=[0,0]){const s=n[0]===0?this.effectiveCanvasWidth()-t[0]:n[0]-t[0],r=n[1]===0?this.effectiveCanvasHeight()-t[1]:n[1]-t[1];let a=s/i;e*a>r&&(a=r/e);const l=i*a,c=e*a;return[(s-l)*.5,(r-c)*.5,l,c,a]}drawThumbnail(){if(!this.bmpShader)throw new Error("bmpShader undefined");this.bmpShader.use(this.gl);const[i,e,t,n]=this.getBoundsRegion();this.gl.uniform2f(this.bmpShader.uniforms.canvasWidthHeight,t,n);const s=h7(t,n,this.bmpTextureWH),r=i+s.left,a=e+s.top;this.gl.uniform4f(this.bmpShader.uniforms.leftTopWidthHeight,r,a,s.width,s.height),this.gl.bindVertexArray(this.genericVAO),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.gl.bindVertexArray(this.unusedVAO)}drawLine(i,e=1,t=[1,0,0,-1]){if(this.gl.bindVertexArray(this.genericVAO),!this.lineShader)throw new Error("lineShader undefined");this.lineShader.use(this.gl),t[3]<0&&(t=this.opts.crosshairColor),this.gl.uniform4fv(this.lineShader.uniforms.lineColor,t),this.gl.uniform2fv(this.lineShader.uniforms.canvasWidthHeight,[this.gl.canvas.width,this.gl.canvas.height]),this.gl.uniform1f(this.lineShader.uniforms.thickness,e),this.gl.uniform4fv(this.lineShader.uniforms.startXYendXY,i),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.gl.bindVertexArray(this.unusedVAO)}draw3DLine(i,e,t=1,n=[1,0,0,-1]){if(this.gl.bindVertexArray(this.genericVAO),!this.line3DShader)throw new Error("line3DShader undefined");this.line3DShader.use(this.gl),n[3]<0&&(n=this.opts.crosshairColor),this.gl.uniform4fv(this.line3DShader.uniforms.lineColor,n),this.gl.uniform2fv(this.line3DShader.uniforms.canvasWidthHeight,[this.gl.canvas.width,this.gl.canvas.height]),this.gl.uniform1f(this.line3DShader.uniforms.thickness,t),this.gl.uniform2fv(this.line3DShader.uniforms.startXY,i),this.gl.uniform3fv(this.line3DShader.uniforms.endXYZ,e),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.gl.bindVertexArray(this.unusedVAO)}drawDottedLine(i,e=1,t=[1,0,0,-1]){if(this.gl.bindVertexArray(this.genericVAO),!this.lineShader)throw new Error("lineShader undefined");this.lineShader.use(this.gl);const n=t[3]<0?[...this.opts.crosshairColor]:[...t];n[3]=.3,this.gl.uniform4fv(this.lineShader.uniforms.lineColor,n),this.gl.uniform2fv(this.lineShader.uniforms.canvasWidthHeight,[this.gl.canvas.width,this.gl.canvas.height]),this.gl.uniform1f(this.lineShader.uniforms.thickness,e);const s=u7(i,this.fontPx,1);for(const r of s)this.gl.uniform4fv(this.lineShader.uniforms.startXYendXY,[r.startX,r.startY,r.endX,r.endY]),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4);this.gl.bindVertexArray(this.unusedVAO)}drawGraphLine(i,e=[1,0,0,.5],t=2){this.drawLine(i,t,e)}drawCrossLinesMM(i,e,t,n,s){if(i<0||this.screenSlices.length<=i)return;const r=this.screenSlices[i];let a=r.sliceFrac;a===1/0&&X.debug("Rendering approximate cross lines in world view mode"),a===1/0&&(a=.5);const{linesH:c,linesV:h}=Vb(e,t,n,s),d=Math.max(1,this.opts.crosshairWidth),f=p=>{const g=qN(0,0);return g[0]=r.leftTopWidthHeight[0]+(p[0]-r.leftTopMM[0])/r.fovMM[0]*r.leftTopWidthHeight[2],g[1]=r.leftTopWidthHeight[1]+r.leftTopWidthHeight[3]-(p[1]-r.leftTopMM[1])/r.fovMM[1]*r.leftTopWidthHeight[3],g};if(c.length>0&&e===0){const p=a,g=1;for(let y=0;y<c.length;y++){const x=this.frac2mm([.5,.5,.5]);x[g]=c[y];let b=this.mm2frac(x);b=b[g];let w=this.frac2mm([0,b,p]);w=jt(w,[0,1,2]);let S=this.frac2mm([1,b,p]);S=jt(S,[0,1,2]),w=f(w),S=f(S),this.drawLine([w[0],w[1],S[0],S[1]],d)}}if(c.length>0&&e===1){const p=a,g=2;for(let y=0;y<c.length;y++){const x=this.frac2mm([.5,.5,.5]);x[g]=c[y];let b=this.mm2frac(x);b=b[g];let w=this.frac2mm([0,p,b]);w=jt(w,[0,2,1]);let S=this.frac2mm([1,p,b]);S=jt(S,[0,2,1]),w=f(w),S=f(S),this.drawLine([w[0],w[1],S[0],S[1]],d)}}if(c.length>0&&e===2){const p=a,g=2;for(let y=0;y<c.length;y++){const x=this.frac2mm([.5,.5,.5]);x[g]=c[y];let b=this.mm2frac(x);b=b[g];let w=this.frac2mm([p,0,b]);w=jt(w,[1,2,0]);let S=this.frac2mm([p,1,b]);S=jt(S,[1,2,0]),w=f(w),S=f(S),this.drawLine([w[0],w[1],S[0],S[1]],d)}}if(h.length>0&&e===0){const p=a,g=0;for(let y=0;y<h.length;y++){const x=this.frac2mm([.5,.5,.5]);x[g]=h[y];let b=this.mm2frac(x);b=b[g];let w=this.frac2mm([b,0,p]);w=jt(w,[0,1,2]);let S=this.frac2mm([b,1,p]);S=jt(S,[0,1,2]),w=f(w),S=f(S),this.drawLine([w[0],w[1],S[0],S[1]],d)}}if(h.length>0&&e===1){const p=a,g=0;for(let y=0;y<h.length;y++){const x=this.frac2mm([.5,.5,.5]);x[g]=h[y];let b=this.mm2frac(x);b=b[g];let w=this.frac2mm([b,p,0]);w=jt(w,[0,2,1]);let S=this.frac2mm([b,p,1]);S=jt(S,[0,2,1]),w=f(w),S=f(S),this.drawLine([w[0],w[1],S[0],S[1]],d)}}if(h.length>0&&e===2){const p=a,g=1;for(let y=0;y<h.length;y++){const x=this.frac2mm([.5,.5,.5]);x[g]=h[y];let b=this.mm2frac(x);b=b[g];let w=this.frac2mm([p,b,0]);w=jt(w,[1,2,0]);let S=this.frac2mm([p,b,1]);S=jt(S,[1,2,0]),w=f(w),S=f(S),this.drawLine([w[0],w[1],S[0],S[1]],d)}}}drawCrossLines(i,e,t,n,s){if(i<0||this.screenSlices.length<=i)return;if(this.opts.isSliceMM)return this.drawCrossLinesMM(i,e,t,n,s);if(this.screenSlices[i].sliceFrac===1/0)return this.drawCrossLinesMM(i,e,t,n,s);const r=this.screenSlices[i],{linesH:a,linesV:l}=Vb(e,t,n,s);if(a.length>0){const c=r.leftTopWidthHeight.slice();let h=2;e===0&&(h=1);const d=this.frac2mm([.5,.5,.5]);for(let f=0;f<a.length;f++){d[h]=a[f];const p=this.mm2frac(d);this.drawRect([c[0],c[1]+c[3]-p[h]*c[3],c[2],1])}}if(l.length>0){const c=r.leftTopWidthHeight.slice(),h=r.fovMM[0]<0;let d=0;e===2&&(d=1);const f=this.frac2mm([.5,.5,.5]);for(let p=0;p<l.length;p++){f[d]=l[p];const g=this.mm2frac(f);h?this.drawRect([c[0]+(c[2]-g[d]*c[2]),c[1],1,c[3]]):this.drawRect([c[0]+g[d]*c[2],c[1],1,c[3]])}}}drawMosaic(i){this.screenSlices=[];const[e,t,n,s]=this.getBoundsRegion(),r=this.screenFieldOfViewMM(0,!0),a=this.screenFieldOfViewMM(0);i=i.replaceAll(";"," ;").trim();const l=[],c=[],h=[],d=i.split(/\s+/);let f=1;const p=this.fontPx;let g=0,y=0,x=0;this.volumes[0]?.dims||(x=Math.ceil(this.opts.tileMargin*.3));for(let b=0;b<2;b++){let w=!1,S=!1,C=0,E=0,D=0,M=0,N=!1,I=0,_=0,F=0,B=0;for(let k=0;k<d.length;k++){const q=d[k];if(q.includes("X")){S=!0;continue}if(q.includes("L")){N=!q.includes("-");continue}if(q.includes("H")){k++,_=Math.abs(Math.max(0,Math.min(1,parseFloat(d[k]))));continue}if(q.includes("V")){k++;continue}if(q.includes("A")){I=0;continue}if(q.includes("C")){I=1;continue}if(q.includes("S")){I=2;continue}if(q.includes("R")){w=!0;continue}if(q.includes(";")){D+=C,M=Math.max(M,E+F),C=0,E=0,F=0;continue}B=F,_>0&&!w&&(B=Math.round(B*(1-_))),E+=B,B=0;const U=parseFloat(q);if(isNaN(U))continue;let H=0,Y=a;if(w&&(Y=r),I===2?B=Y[1]:B=Y[0],I===0?H=Y[1]:H=Y[2],b===0)w||(I===0&&l.push(U),I===1&&c.push(U),I===2&&h.push(U));else{const Q=[e+g+f*E,t+y+f*D,f*B,f*H];if(this.fontPx=N?p:0,w){let te=U<0?-1/0:1/0;Object.is(U,-0)&&(te=-1/0),this.draw2D(Q,I,te)}else this.draw2D(Q,I,U);S&&this.drawCrossLines(this.screenSlices.length-1,I,l,c,h),w=!1,S=!1}F=B,E+=x,C=Math.max(C,H)}if(D+=C,M=Math.max(M,E+F),M<=0||D<=0)break;const P=(n-2*this.opts.tileMargin-x)/M,O=(s-2*this.opts.tileMargin)/D;f=Math.min(P,O),this.opts.centerMosaic?(g=Math.floor(.5*(n-M*f)),y=Math.floor(.5*(s-D*f))):(g=this.opts.tileMargin,y=this.opts.tileMargin)}this.fontPx=p}calculateWidthHeight(i,e,t,n){return _k(i,e,t,n)}getBoundsRegionCSS(){const i=this.gl.canvas.getBoundingClientRect();return OO({bounds:this.opts.bounds,rectWidth:i.width,rectHeight:i.height})}eventInBounds(i){const e=this.gl.canvas.getBoundingClientRect();let t,n;if(i instanceof MouseEvent)t=i.clientX,n=i.clientY;else if(i instanceof TouchEvent){const a=i.touches[0]??i.changedTouches[0];if(!a)return!1;t=a.clientX,n=a.clientY}else t=i.clientX,n=i.clientY;const s=t-e.left,r=n-e.top;return XO({x:s,y:r,boundsRegion:this.getBoundsRegionCSS()})}cursorInBounds(){return WO({mouseX:this.mousePos[0],mouseY:this.mousePos[1],boundsRegion:this.getBoundsRegion()})}getBoundsRegion(){const i=this.gl,e=this.uiData?.dpr||window.devicePixelRatio||1,t=i.canvas;return kO({bounds:this.opts.bounds,canvasWidth:i.canvas.width,canvasHeight:i.canvas.height,cssWidth:t.clientWidth,cssHeight:t.clientHeight,dpr:e})}inBounds(i,e){return DO({x:i,y:e,dpr:this.uiData.dpr,canvasHeight:this.gl.canvas.height,boundsRegion:this.getBoundsRegion()})}bindTextures(){this.gl.activeTexture(ct.TEXTURE0_BACK_VOL),this.gl.bindTexture(this.gl.TEXTURE_3D,this.volumeTexture),this.gl.activeTexture(ct.TEXTURE2_OVERLAY_VOL),this.gl.bindTexture(this.gl.TEXTURE_3D,this.overlayTexture),this.gl.activeTexture(ct.TEXTURE8_PAQD),this.gl.bindTexture(this.gl.TEXTURE_3D,this.paqdTexture),this.gl.activeTexture(ct.TEXTURE3_FONT),this.gl.bindTexture(this.gl.TEXTURE_2D,this.fontTexture),this.gl.activeTexture(ct.TEXTURE1_COLORMAPS),this.gl.bindTexture(this.gl.TEXTURE_2D,this.colormapTexture),this.gl.activeTexture(ct.TEXTURE5_MATCAP),this.gl.bindTexture(this.gl.TEXTURE_2D,this.matCapTexture),this.gl.activeTexture(ct.TEXTURE6_GRADIENT),this.gl.bindTexture(this.gl.TEXTURE_3D,this.gradientTexture)}clearBounds(i=this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT,e){const t=this.gl,[n,s,r,a]=e??this.getBoundsRegion(),l=t.canvas.height-s-a;i&t.DEPTH_BUFFER_BIT&&t.clearDepth(1),t.enable(t.SCISSOR_TEST),t.scissor(n,l,r,a),i&t.COLOR_BUFFER_BIT&&t.clearColor(this.opts.backColor[0],this.opts.backColor[1],this.opts.backColor[2],this.opts.backColor[3]),t.clear(i),t.disable(t.SCISSOR_TEST)}drawBoundsBorder(){if(!this.opts.showBoundsBorder)return;const[i,e,t,n]=this.getBoundsRegion();this.drawBoundsBox([i,e,t,n],this.opts.boundsBorderColor,this.opts.selectionBoxLineThickness)}drawSceneCore(){if(!this.initialized)return;this.colorbarHeight=0;const[i,e,t,n]=this.getBoundsRegion();if(this.gl.viewport(i,e,t,n),this.clearBounds(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.bindTextures(),this.bmpTexture&&this.thumbnailVisible){this.drawThumbnail();return}let s="";if(this.volumes.length===0||typeof this.volumes[0].dims>"u"){if(this.meshes.length>0){if(this.sliceMosaicString.length>0){this.opts.isColorbar&&this.reserveColorbarPanel(),this.drawMosaic(this.sliceMosaicString),this.opts.isColorbar&&this.drawColorbar();return}this.screenSlices=[],this.draw3D([i,e,t,n]),this.opts.isColorbar&&this.drawColorbar();return}this.drawLoadingText(this.opts.loadingText);return}const r=this.scene.clipPlaneDepthAziElevs?.[this.uiData.activeClipPlaneIndex]?.[0]??2;if(oU({isDragging:this.uiData.isDragging,activeClipPlaneDepth:r,dragStartTileIndex:this.inRenderTile(this.uiData.dragStart[0],this.uiData.dragStart[1])})){const d=this.uiData.dragStart[0]-this.uiData.dragEnd[0],f=this.uiData.dragStart[1]-this.uiData.dragEnd[1],p=nU({startDepthAziElev:this.uiData.dragClipPlaneStartDepthAziElev,dragDeltaX:d,dragDeltaY:f});if(p.changed)return this.scene.clipPlaneDepthAziElevs[this.uiData.activeClipPlaneIndex]=p.depthAziElev,this.setClipPlane(this.scene.clipPlaneDepthAziElevs[this.uiData.activeClipPlaneIndex])}if(this.sliceMosaicString.length<1&&this.opts.sliceType===4){this.opts.isColorbar&&this.reserveColorbarPanel(),this.screenSlices=[],this.draw3D(),this.opts.isColorbar&&this.drawColorbar();return}this.opts.isColorbar&&this.reserveColorbarPanel();const l=this.getMaxVols(),c=this.opts.sliceType===3&&l>1&&this.graph.autoSizeMultiplanar&&this.graph.opacity>0;if(this.sliceMosaicString.length>0)this.drawMosaic(this.sliceMosaicString);else{const d=[0,0];let f=!1;if(this.screenSlices=[],this.customLayout&&this.customLayout.length>0){this.screenSlices=[];const{volScale:p}=this.sliceScale();for(const g of this.customLayout){const{sliceType:y,position:x,sliceMM:b}=g,w=[i+x[0]*t,e+x[1]*n,x[2]*t,x[3]*n];if(w[0]+w[2]>i+t&&(X.warn("adjusting slice width because it would have been clipped"),w[2]=i+t-w[0]),w[1]+w[3]>e+n&&(X.warn("adjusting slice height because it would have been clipped"),w[3]=e+n-w[1]),y===4)this.draw3D(w);else{const S=this.calculateWidthHeight(y,p,w[2],w[3]);this.draw2D(w,y,b??NaN,S)}}}else if(this.opts.sliceType===0||this.opts.sliceType===1||this.opts.sliceType===2){const{volScale:p}=this.sliceScale(),g=[i,e,t,n],y=this.calculateWidthHeight(this.opts.sliceType,p,g[2],g[3]);this.draw2D([0,0,0,0],this.opts.sliceType,NaN,y)}else{let p=function(le,he){return[(le-1)*w+le*S,(he-1)*w+he*S]},g=!1;this.opts.multiplanarForceRender?(g=!0,this.opts.multiplanarForceRender?this.opts.multiplanarShowRender=1:this.opts.multiplanarShowRender=2,delete this.opts.multiplanarForceRender):this.opts.multiplanarShowRender===1&&(g=!0);const y=isFinite(this.drawPenLocation[0])&&this.opts.drawingEnabled,{volScale:x}=this.sliceScale(),b=x.slice();this.opts.multiplanarEqualSize&&(x[0]=1,x[1]=1,x[2]=1),typeof this.opts.multiplanarPadPixels!="number"&&X.debug("multiplanarPadPixels must be numeric");const w=parseFloat(`${this.opts.multiplanarPadPixels}`)*this.uiData.dpr;let S=this.opts.tileMargin*this.uiData.dpr;S<0&&(S=2*(2+Math.ceil(this.fontPx)));const[C,E,D,M]=this.getBoundsRegion();let N=[this.effectiveCanvasWidth(),this.effectiveCanvasHeight()];this.opts.heroImageFraction>0&&this.opts.heroImageFraction<1&&(g=!1,f=!0,N[0]>N[1]&&this.opts.multiplanarLayout!==3?d[0]=N[0]*this.opts.heroImageFraction:d[1]=N[1]*this.opts.heroImageFraction,N=[N[0]-d[0],N[1]-d[1]]);const I=this.scaleSlice(x[0]+x[1],x[1]+x[2],p(2,2),N),_=Math.max(Math.max(x[1],x[2]),x[0]),F=this.scaleSlice(x[0]+x[0]+x[1],Math.max(x[1],x[2]),p(3,1),N),B=this.scaleSlice(x[0]+x[0]+x[1]+_,Math.max(x[1],x[2]),p(4,1),N),P=this.scaleSlice(_,x[1]+x[2]+x[2],p(1,3),N),O=this.scaleSlice(_,x[1]+x[2]+x[2]+_,p(1,4),N);let k=!y&&(l<2||!c),q=!1,U=!1,H=!1;this.opts.multiplanarLayout===1?q=!0:this.opts.multiplanarLayout===2?U=!0:this.opts.multiplanarLayout===3?H=!0:P[4]>F[4]&&P[4]>I[4]?q=!0:F[4]>I[4]?H=!0:U=!0;let Y=I;if(q?(Y=P,!f&&(g||this.opts.multiplanarShowRender===2&&O[4]>=P[4])?Y=O:k=!1):H&&(Y=F,!f&&(g||this.opts.multiplanarShowRender===2&&B[4]>=F[4])?Y=B:k=!1),f){const le=d[0]===0?D:d[0],he=d[1]===0?M:d[1];if(this.opts?.heroSliceType===0||this.opts?.heroSliceType===1||this.opts?.heroSliceType===2)this.draw2D([C,E,le,he],this.opts.heroSliceType,NaN,[1/0,1/0]);else{const ce=Y.slice();le===D&&(ce[0]=0),this.draw3D([C+ce[0],E,le,he])}Y[0]+=d[0],Y[1]+=d[1],k=!1}const Q=x[0]*Y[4]+S,te=x[1]*Y[4]+S,j=x[2]*Y[4]+S,W=b[0]*Y[4],K=b[1]*Y[4],ee=b[2]*Y[4];if(q){if(this.draw2D([C+Y[0],E+Y[1],Q,te],0,NaN,[W,K]),this.draw2D([C+Y[0],E+Y[1]+te+w,Q,j],1,NaN,[W,ee]),this.draw2D([C+Y[0],E+Y[1]+te+w+j+w,te,j],2,NaN,[K,ee]),k){const le=_*Y[4];this.draw3D([C+Y[0],E+Y[1]+te+j+j+w*3,le,le])}}else if(H){if(this.draw2D([C+Y[0],E+Y[1],Q,te],0,NaN,[W,K]),this.draw2D([C+Y[0]+Q+w,E+Y[1],Q,j],1,NaN,[W,ee]),this.draw2D([C+Y[0]+Q+Q+w*2,E+Y[1],te,j],2,NaN,[K,ee]),k){const le=_*Y[4];this.draw3D([C+Y[0]+Q+Q+te+w*3,E+Y[1],le,le])}}else U&&(g||(k=!1),this.opts.multiplanarShowRender===2&&(k=!0),f&&(k=!1),this.draw2D([C+Y[0],E+Y[1]+j+w,Q,te],0,NaN,[W,K]),this.draw2D([C+Y[0],E+Y[1],Q,j],1,NaN,[W,ee]),this.draw2D([C+Y[0]+Q+w,E+Y[1],te,j],2,NaN,[K,ee]),k&&this.draw3D([C+Y[0]+Q+w,E+Y[1]+j+w,te,te]))}}if(this.opts.isRuler&&this.drawRuler(),this.opts.isColorbar&&this.drawColorbar(),c&&this.drawGraph(),this.uiData.isDragging){if(this.uiData.mouseButtonCenterDown){this.dragForCenterButton([this.uiData.dragStart[0],this.uiData.dragStart[1],this.uiData.dragEnd[0],this.uiData.dragEnd[1]]);return}if(this.getCurrentDragMode()===4){this.dragForSlicer3D([this.uiData.dragStart[0],this.uiData.dragStart[1],this.uiData.dragEnd[0],this.uiData.dragEnd[1]]);return}if(this.getCurrentDragMode()===3){this.dragForPanZoom([this.uiData.dragStart[0],this.uiData.dragStart[1],this.uiData.dragEnd[0],this.uiData.dragEnd[1]]);return}if(this.inRenderTile(this.uiData.dragStart[0],this.uiData.dragStart[1])>=0)return;this.getCurrentDragMode()===2&&this.drawMeasurementTool([this.uiData.dragStart[0],this.uiData.dragStart[1],this.uiData.dragEnd[0],this.uiData.dragEnd[1]]),this.getCurrentDragMode()===7&&this.drawAngleMeasurementTool();const d=this.getCurrentDragMode();if(d===1||d===6){const f=Math.abs(this.uiData.dragStart[0]-this.uiData.dragEnd[0]),p=Math.abs(this.uiData.dragStart[1]-this.uiData.dragEnd[1]);this.drawSelectionBox([Math.min(this.uiData.dragStart[0],this.uiData.dragEnd[0]),Math.min(this.uiData.dragStart[1],this.uiData.dragEnd[1]),f,p])}}for(const d of this.document.completedMeasurements)if(this.shouldDrawOnCurrentSlice(d.sliceIndex,d.sliceType,d.slicePosition)){const f=this.mm2frac(d.startMM),p=this.mm2frac(d.endMM),g=this.frac2canvasPosWithTile(f,d.sliceType),y=this.frac2canvasPosWithTile(p,d.sliceType);g&&y&&g.tileIndex===y.tileIndex&&this.drawMeasurementTool([g.pos[0],g.pos[1],y.pos[0],y.pos[1]])}for(let d=0;d<this.document.completedAngles.length;d++){const f=this.document.completedAngles[d];if(this.shouldDrawOnCurrentSlice(f.sliceIndex,f.sliceType,f.slicePosition)){const g=this.mm2frac(f.firstLineMM.start),y=this.mm2frac(f.firstLineMM.end),x=this.mm2frac(f.secondLineMM.start),b=this.mm2frac(f.secondLineMM.end),w=this.frac2canvasPosWithTile(g,f.sliceType),S=this.frac2canvasPosWithTile(y,f.sliceType),C=this.frac2canvasPosWithTile(x,f.sliceType),E=this.frac2canvasPosWithTile(b,f.sliceType);if(w&&S&&C&&E&&w.tileIndex===S.tileIndex&&w.tileIndex===C.tileIndex&&w.tileIndex===E.tileIndex){this.drawMeasurementTool([w.pos[0],w.pos[1],S.pos[0],S.pos[1]],!1),this.drawMeasurementTool([C.pos[0],C.pos[1],E.pos[0],E.pos[1]],!1);const D={firstLine:[w.pos[0],w.pos[1],S.pos[0],S.pos[1]],secondLine:[C.pos[0],C.pos[1],E.pos[0],E.pos[1]],sliceIndex:f.sliceIndex,sliceType:f.sliceType,slicePosition:f.slicePosition};this.drawAngleTextForAngle(D)}}}const h=this.frac2mm([this.scene.crosshairPos[0],this.scene.crosshairPos[1],this.scene.crosshairPos[2]]);return s=h[0].toFixed(2)+""+h[1].toFixed(2)+""+h[2].toFixed(2),this.readyForSync=!0,this.sync(),this.drawAnchoredLabels(),this.drawBoundsBorder(),s}drawScene(){if(this.isBusy){this.needsRefresh=!0;return}this.isBusy=!1,this.needsRefresh=!1;let i=this.drawSceneCore();return this._gl!==null&&this.gl.finish(),this.needsRefresh&&(i=this.drawScene()),i}r8Tex(i,e,t,n=!1){return ZP(this.gl,i,e,t,n)}r16Tex(i,e,t,n){return JP(this.gl,i,e,t,n)}rgbaTex2D(i,e,t,n=null,s=!0){return $P(this.gl,i,e,t,n,s)}rgbaTex(i,e,t,n=!1){return eB(this.gl,i,e,t,n)}rgba16Tex(i,e,t,n=!1){return tB(this.gl,i,e,t,n)}requestCORSIfNotSameOrigin(i,e){H3(i,e)}async loadPngAsTexture(i,e){const t=await iB(this.gl,i,e,this.fontShader,this.bmpShader,this.fontTexture,this.bmpTexture,this.matCapTexture,n=>{this.bmpTextureWH=n},()=>{this.drawScene()});return e===3?this.fontTexture=t:e===4?this.bmpTexture=t:e===5&&(this.matCapTexture=t),t}async loadFontTexture(i){return this.loadPngAsTexture(i,3)}async loadBmpTexture(i){return this.loadPngAsTexture(i,4)}async loadMatCapTexture(i){return this.loadPngAsTexture(i,5)}get gl(){if(!this._gl)throw new Error("unable to get WebGL context. Maybe the browser doesn't support WebGL2.");return this._gl}set gl(i){this._gl=i}findDrawingBoundarySlices(i){if(!this.back||!this.back.dims||!this.drawBitmap)return null;const e={dimX:this.back.dims[1],dimY:this.back.dims[2],dimZ:this.back.dims[3]};return dU(i,this.drawBitmap,e)}interpolateMaskSlices(i,e,t={}){if(!this.back||!this.back.dims||!this.drawBitmap)throw new Error("Background image and drawing bitmap must be loaded");const n={dimX:this.back.dims[1],dimY:this.back.dims[2],dimZ:this.back.dims[3]},s=this.back.img,r=this.back.global_max;AU(this.drawBitmap,n,s,r,i,e,t,()=>this.refreshDrawing(!0))}};wo=new WeakMap;const lV="_container_1lcvk_1",cV="_canvasContainer_1lcvk_5",uV="_canvas_1lcvk_5",hV="_controls_1lcvk_18",dV="_controlButton_1lcvk_26",fV="_controlButtonActive_1lcvk_37",mV="_controlButtonInactive_1lcvk_42",pV="_controlIcon_1lcvk_51",gV="_calculateButton_1lcvk_56",AV="_overlay_1lcvk_72",vV="_overlayText_1lcvk_84",Kt={container:lV,canvasContainer:cV,canvas:uV,controls:hV,controlButton:dV,controlButtonActive:fV,controlButtonInactive:mV,controlIcon:pV,calculateButton:gV,overlay:AV,overlayText:vV},yV=({imageUrl:i,onRoiChange:e})=>{const t=V.useRef(null),n=V.useRef(null),[s,r]=V.useState(!1);V.useEffect(()=>{if(!t.current)return;const c=new Af({dragAndDropEnabled:!1,multiplanarForceRender:!0});return c.attachToCanvas(t.current),c.setSliceType(c.sliceTypeMultiplanar),n.current=c,(async()=>(await c.loadVolumes([{url:i}]),c.setColormap(c.volumes[0].id,"gray")))(),()=>{}},[i]);const a=()=>{if(!n.current)return;const c=!s;r(c),n.current.setDrawingEnabled(c),c?n.current.setPenValue(1,!0):n.current.setPenValue(0,!0)},l=()=>{if(!n.current||!e)return;const c=n.current.drawBitmap;if(!c)return;const h=[];for(let f=0;f<c.length;f++)c[f]>0&&h.push(f);if(h.length===0){alert("Please draw a region first.");return}const d=n.current.volumes[0]?.dims;if(!d){console.error("Volume dimensions not found");return}e({indices:h,shape:d})};return v.jsxs("div",{className:Kt.container,children:[v.jsx("div",{className:Kt.canvasContainer,children:v.jsx("canvas",{ref:t,className:Kt.canvas})}),v.jsxs("div",{className:Kt.controls,children:[v.jsx("button",{onClick:a,className:`${Kt.controlButton} ${s?Kt.controlButtonActive:Kt.controlButtonInactive}`,title:s?"Stop Drawing":"Start Drawing ROI",children:s?v.jsx(xR,{className:Kt.controlIcon}):v.jsx(vR,{className:Kt.controlIcon})}),e&&v.jsx("button",{onClick:l,className:Kt.calculateButton,children:"Calculate Stats"})]}),v.jsxs("div",{className:Kt.overlay,children:[v.jsxs("p",{className:Kt.overlayText,children:["Left Click: ",s?"Draw":"Rotate"]}),v.jsx("p",{className:Kt.overlayText,children:"Right Click: Pan"}),v.jsx("p",{className:Kt.overlayText,children:"Scroll: Zoom"})]})]})},xV="_container_1urof_1",bV="_header_1urof_7",wV="_headerContent_1urof_14",SV="_title_1urof_21",CV="_subtitle_1urof_29",EV="_statusContainer_1urof_36",TV="_statusBadge_1urof_42",MV="_statusCompleted_1urof_49",DV="_statusProcessing_1urof_54",RV="_statusFailed_1urof_59",NV="_statusPending_1urof_64",IV="_actionSection_1urof_69",_V="_pendingAlert_1urof_74",FV="_alertContent_1urof_83",PV="_alertIcon_1urof_88",BV="_alertText_1urof_95",LV="_processButton_1urof_100",kV="_failedAlert_1urof_122",OV="_reprocessButton_1urof_136",UV="_deleteButton_1urof_160",VV="_errorBanner_1urof_182",jV="_errorContent_1urof_193",zV="_contentGrid_1urof_201",GV="_viewerCard_1urof_207",HV="_cardHeader_1urof_214",YV="_cardTitle_1urof_222",qV="_cardTitleIcon_1urof_231",XV="_cardSubtitle_1urof_238",WV="_statsCard_1urof_243",KV="_statsContent_1urof_250",QV="_mainStat_1urof_256",ZV="_statLabel_1urof_262",JV="_statValueLarge_1urof_268",$V="_statsGrid_1urof_274",ej="_subStat_1urof_280",tj="_statLabelSmall_1urof_286",ij="_statValueSmall_1urof_291",nj="_emptyStats_1urof_297",sj="_emptyIcon_1urof_305",rj="_emptyText_1urof_312",aj="_loadingContainer_1urof_316",oj="_spinner_1urof_323",lj="_errorContainer_1urof_332",cj="_errorMessage_1urof_339",uj="_downloadButton_1urof_363",hj="_logsSection_1urof_384",dj="_sectionTitle_1urof_392",fj="_logsContainer_1urof_402",mj="_logItem_1urof_428",pj="_logInfo_1urof_438",gj="_logWarning_1urof_443",Aj="_logError_1urof_448",vj="_logTime_1urof_453",yj="_logMessage_1urof_458",J={container:xV,header:bV,headerContent:wV,title:SV,subtitle:CV,statusContainer:EV,statusBadge:TV,statusCompleted:MV,statusProcessing:DV,statusFailed:RV,statusPending:NV,actionSection:IV,pendingAlert:_V,alertContent:FV,alertIcon:PV,alertText:BV,processButton:LV,failedAlert:kV,reprocessButton:OV,deleteButton:UV,errorBanner:VV,errorContent:jV,contentGrid:zV,viewerCard:GV,cardHeader:HV,cardTitle:YV,cardTitleIcon:qV,cardSubtitle:XV,statsCard:WV,statsContent:KV,mainStat:QV,statLabel:ZV,statValueLarge:JV,statsGrid:$V,subStat:ej,statLabelSmall:tj,statValueSmall:ij,emptyStats:nj,emptyIcon:sj,emptyText:rj,loadingContainer:aj,spinner:oj,errorContainer:lj,errorMessage:cj,downloadButton:uj,logsSection:hj,sectionTitle:dj,logsContainer:fj,logItem:mj,logInfo:pj,logWarning:gj,logError:Aj,logTime:vj,logMessage:yj},xj=()=>{const{id:i}=Wd(),e=bn(),{data:t,isLoading:n,error:s,refetch:r}=lf(i||""),[a,{isLoading:l}]=Wo(),[c]=V6(),[h]=Ko(),[d,f]=V.useState(null),p=async()=>{if(i)try{await a(i).unwrap()}catch(w){console.error("Failed to start processing:",w)}},g=async()=>{if(i&&window.confirm("Are you sure you want to delete this study? This action cannot be undone."))try{await h(i).unwrap(),e("/mri/studies")}catch(w){console.error("Failed to delete study:",w)}};qd.useEffect(()=>{let w;return(t?.status==="PROCESSING"||t?.status==="VALIDATING")&&(w=setInterval(()=>{r()},2e3)),()=>clearInterval(w)},[t?.status,r]);const y=async w=>{if(i)try{const S=await c({id:i,roiData:w}).unwrap();f(S)}catch(S){console.error("Failed to calculate ROI stats:",S)}};if(n)return v.jsx("div",{className:J.loadingContainer,children:v.jsx("div",{className:J.spinner})});if(s||!t)return v.jsx("div",{className:J.errorContainer,children:v.jsx("div",{className:"flex",children:v.jsx("div",{className:"ml-3",children:v.jsx("p",{className:J.errorMessage,children:"Error loading study details."})})})});const x=t.processing_result?.mk_map||t.results?.mk_map?(()=>{const w=t.processing_result?.mk_map||t.results?.mk_map;return w?.startsWith("http")?w:`http://localhost:8000${w}`})():null,b=t.status==="COMPLETED"?J.statusCompleted:t.status==="PROCESSING"||t.status==="VALIDATING"?J.statusProcessing:t.status==="FAILED"?J.statusFailed:J.statusPending;return v.jsxs("div",{className:J.container,children:[v.jsxs("div",{className:J.header,children:[v.jsxs("div",{className:J.headerContent,children:[v.jsxs("div",{children:[v.jsx("h3",{className:J.title,children:"Study Details"}),v.jsxs("p",{className:J.subtitle,children:["Patient ID: ",t.patient_id]})]}),v.jsxs("div",{className:J.statusContainer,children:[v.jsx("span",{className:`${J.statusBadge} ${b}`,children:t.status}),v.jsx("button",{onClick:g,className:J.deleteButton,title:"Delete study",children:v.jsx(eu,{className:"h-4 w-4"})})]})]}),t.status==="UPLOADED"&&v.jsx("div",{className:J.actionSection,children:v.jsxs("div",{className:J.pendingAlert,children:[v.jsxs("div",{className:J.alertContent,children:[v.jsx(Qs,{className:J.alertIcon}),v.jsx("span",{className:J.alertText,children:"This study is ready for processing."})]}),v.jsx("button",{onClick:p,disabled:l,className:J.processButton,children:l?"Starting...":v.jsxs(v.Fragment,{children:[v.jsx(es,{className:"h-4 w-4 mr-2"}),"Start Processing"]})})]})}),t.status==="FAILED"&&v.jsx("div",{className:J.actionSection,children:v.jsxs("div",{className:J.failedAlert,children:[v.jsxs("div",{className:J.alertContent,children:[v.jsx(Qs,{className:J.alertIcon}),v.jsxs("span",{className:J.alertText,children:["Processing failed: ",t.error_message||"Unknown error"]})]}),v.jsx("button",{onClick:p,disabled:l,className:J.processButton,children:l?"Retrying...":v.jsxs(v.Fragment,{children:[v.jsx(es,{className:"h-4 w-4 mr-2"}),"Retry Processing"]})})]})})]}),t.status==="COMPLETED"&&v.jsx("div",{className:J.actionSection,children:v.jsx("button",{onClick:p,disabled:l,className:J.reprocessButton,children:l?"Reprocessing...":v.jsxs(v.Fragment,{children:[v.jsx(es,{className:"h-4 w-4 mr-2"}),"Reprocess Study"]})})}),t.status==="COMPLETED"&&x&&v.jsxs("div",{className:J.contentGrid,children:[v.jsxs("div",{className:J.viewerCard,children:[v.jsxs("div",{className:J.cardHeader,children:[v.jsx("h4",{className:J.cardTitle,children:"MK Map Visualization"}),v.jsx("span",{className:J.cardSubtitle,children:"Use mouse to rotate/pan/zoom"})]}),v.jsx(yV,{imageUrl:x,onRoiChange:y})]}),v.jsxs("div",{className:J.statsCard,children:[v.jsxs("h4",{className:J.cardTitle,style:{marginBottom:"1rem"},children:[v.jsx(ps,{className:J.cardTitleIcon}),"ROI Statistics"]}),d?v.jsxs("div",{className:J.statsContent,children:[v.jsxs("div",{className:J.mainStat,children:[v.jsx("p",{className:J.statLabel,children:"Mean Kurtosis (MK)"}),v.jsx("p",{className:J.statValueLarge,children:d.mean.toFixed(4)})]}),v.jsxs("div",{className:J.statsGrid,children:[v.jsxs("div",{className:J.subStat,children:[v.jsx("p",{className:J.statLabelSmall,children:"Std Dev"}),v.jsx("p",{className:J.statValueSmall,children:d.std_dev.toFixed(4)})]}),v.jsxs("div",{className:J.subStat,children:[v.jsx("p",{className:J.statLabelSmall,children:"Voxel Count"}),v.jsx("p",{className:J.statValueSmall,children:d.voxel_count})]}),v.jsxs("div",{className:J.subStat,children:[v.jsx("p",{className:J.statLabelSmall,children:"Min"}),v.jsx("p",{className:J.statValueSmall,children:d.min.toFixed(4)})]}),v.jsxs("div",{className:J.subStat,children:[v.jsx("p",{className:J.statLabelSmall,children:"Max"}),v.jsx("p",{className:J.statValueSmall,children:d.max.toFixed(4)})]})]})]}):v.jsxs("div",{className:J.emptyStats,children:[v.jsx($g,{className:J.emptyIcon}),v.jsx("p",{className:J.emptyText,children:"Select a region of interest on the viewer to calculate statistics."})]})]})]})]})},bj=({status:i})=>{const e={UPLOADED:pe.badgePending,VALIDATING:pe.badgeProcessing,PROCESSING:pe.badgeProcessing,COMPLETED:pe.badgeCompleted,FAILED:pe.badgeFailed},n={UPLOADED:pa,VALIDATING:pa,PROCESSING:pa,COMPLETED:Zg,FAILED:Jg}[i]||Z5,s=e[i]||pe.badgeDefault;return v.jsxs("span",{className:`${pe.badge} ${s}`,children:[v.jsx(n,{className:"w-3 h-3 mr-1"}),i]})},wj=()=>{const{data:i,isLoading:e,error:t}=of(),[n]=Wo(),[s]=Ko(),r=i?.filter(c=>c.modality==="CT_SMART"),a=async(c,h)=>{if(h.preventDefault(),h.stopPropagation(),window.confirm("Start Bio-Tensor SMART analysis for this study?"))try{await n(c).unwrap()}catch(d){console.error("Failed to start processing:",d)}},l=async(c,h)=>{if(h.preventDefault(),h.stopPropagation(),window.confirm("Are you sure you want to delete this CT study? This action cannot be undone."))try{await s(c).unwrap()}catch(d){console.error("Failed to delete study:",d)}};return e?v.jsx("div",{className:pe.loadingContainer,children:v.jsx("div",{className:pe.spinner})}):t?v.jsx("div",{className:pe.errorContainer,children:v.jsx("div",{className:"flex",children:v.jsx("div",{className:"ml-3",children:v.jsx("p",{className:pe.errorMessage,children:"Error loading CT studies. Please try again later."})})})}):v.jsxs("div",{className:pe.container,children:[v.jsxs("div",{className:pe.header,children:[v.jsxs("div",{children:[v.jsx("h3",{className:pe.title,children:"CT Bio-Tensor SMART Studies"}),v.jsx("p",{className:pe.subtitle,children:"Ischemic stroke analysis with penumbra detection and volumetric quantification."})]}),v.jsx(ci,{to:"/ct/upload",className:pe.uploadButton,children:"Upload New CT Study"})]}),v.jsx("div",{className:"border-t border-gray-200",children:v.jsx("ul",{className:pe.list,children:r&&r.length>0?r.map(c=>v.jsx("li",{className:pe.listItem,children:v.jsxs("div",{className:pe.listItemContent,children:[v.jsxs("div",{className:pe.itemInfo,children:[v.jsxs("p",{className:pe.patientId,children:["Patient ID: ",c.patient_id||"N/A"]}),v.jsxs("p",{className:pe.date,children:["Uploaded on ",new Date(c.created_at).toLocaleDateString()]})]}),v.jsxs("div",{className:pe.itemActions,children:[v.jsx(bj,{status:c.status}),(c.status==="UPLOADED"||c.status==="FAILED")&&v.jsx("button",{onClick:h=>a(c.id,h),className:pe.processButton,title:"Start Bio-Tensor SMART analysis",children:v.jsx(es,{className:"h-4 w-4"})}),v.jsxs(ci,{to:`/ct/studies/${c.id}`,className:pe.viewButton,children:[v.jsx(ba,{className:"h-4 w-4 mr-1"}),"View"]}),v.jsx("button",{onClick:h=>l(c.id,h),className:pe.deleteButton,title:"Delete study",children:v.jsx(eu,{className:"h-4 w-4"})}),"                  "]})]})},c.id)):v.jsxs("li",{className:pe.emptyState,children:[v.jsx("p",{children:"No CT studies found. Upload a CT series to begin analysis."}),v.jsx(ci,{to:"/ct/upload",className:pe.uploadLink,children:"Upload CT Study"})]})})})]})},Sj=()=>{const[i,e]=V.useState(null),[t,{isLoading:n,error:s}]=cf(),r=bn(),a=V.useRef(null),l=h=>{h.target.files&&h.target.files.length>0&&e(h.target.files)},c=async h=>{if(h.preventDefault(),!i||i.length===0)return;const d=new FormData;for(let f=0;f<i.length;f++)d.append("dicom_files",i[f]);d.append("modality","CT_SMART");try{await t(d).unwrap(),r("/ct/studies")}catch(f){console.error("Failed to upload CT study:",f)}};return v.jsx("div",{className:we.container,children:v.jsxs("div",{className:we.card,children:[v.jsxs("div",{className:we.header,children:[v.jsx("h2",{className:we.title,children:"Upload CT Study - Bio-Tensor SMART"}),v.jsx("p",{className:we.description,children:"Select a folder containing a complete CT DICOM series for ischemic stroke analysis."})]}),v.jsxs("div",{className:we.alert,children:[v.jsx(X5,{className:"h-5 w-5 text-blue-600"}),v.jsxs("div",{className:we.alertContent,children:[v.jsx("h4",{className:we.alertTitle,children:"Bio-Tensor SMART Requirements:"}),v.jsxs("ul",{className:we.requirementsList,children:[v.jsxs("li",{children:[v.jsx("strong",{children:"Slice Thickness:"})," Maximum 1.0mm (0.5mm recommended for optimal results)"]}),v.jsxs("li",{children:[v.jsx("strong",{children:"Smooth Kernel:"})," Reconstruction must use soft kernel (FC21, SOFT, or STANDARD)"]}),v.jsxs("li",{children:[v.jsx("strong",{children:"Intact Headers:"})," DICOM files must have unmodified headers with all tags"]}),v.jsxs("li",{children:[v.jsx("strong",{children:"Complete Series:"})," Brain CT typically requires >50 slices (more for thinner slices)"]}),v.jsxs("li",{children:[v.jsx("strong",{children:"No Averaged Data:"})," Do not upload averaged or post-processed reconstructions"]})]})]})]}),v.jsxs("form",{onSubmit:c,className:we.form,children:[v.jsxs("div",{className:we.dropzone,children:[v.jsx("input",{type:"file",ref:a,onChange:l,multiple:!0,className:we.fileInput,webkitdirectory:"",directory:""}),v.jsxs("div",{className:we.dropzoneContent,onClick:()=>a.current?.click(),children:[v.jsx(Ro,{className:we.uploadIcon}),v.jsx("h3",{className:we.dropzoneTitle,children:"Select CT DICOM Folder"}),v.jsx("p",{className:we.dropzoneText,children:"Click to browse and select the folder containing your CT series"}),i&&i.length>0&&v.jsxs("div",{className:we.fileInfo,children:[v.jsx(e1,{className:"h-5 w-5"}),v.jsxs("span",{children:[i.length," files selected"]})]})]})]}),s&&v.jsxs("div",{className:we.error,children:[v.jsx(Qs,{className:"h-5 w-5"}),v.jsx("span",{children:"Upload failed. Please check your files and try again."})]}),v.jsxs("div",{className:we.actions,children:[v.jsx("button",{type:"button",onClick:()=>r("/ct/studies"),className:we.cancelButton,children:"Cancel"}),v.jsx("button",{type:"submit",disabled:!i||i.length===0||n,className:we.submitButton,children:n?"Uploading...":"Upload and Analyze"})]})]})]})})},Cj=({heatmapUrl:i,entropyUrl:e,glcmUrl:t,title:n="CT 3D Visualization"})=>{const s=V.useRef(null),r=V.useRef(null),[a,l]=V.useState(!0),[c,h]=V.useState("multiplanar"),[d,f]=V.useState(!0),[p,g]=V.useState(!1),[y,x]=V.useState(.6),[b,w]=V.useState(.5),[S,C]=V.useState(null),E=V.useCallback(N=>{if(!r.current)return;const I=r.current;switch(N){case"multiplanar":I.setSliceType(zi.MULTIPLANAR);break;case"axial":I.setSliceType(zi.AXIAL);break;case"sagittal":I.setSliceType(zi.SAGITTAL);break;case"coronal":I.setSliceType(zi.CORONAL);break;case"render3d":I.setSliceType(zi.RENDER);break}},[]);V.useEffect(()=>!s.current||!i?void 0:((async()=>{l(!0),C(null);try{const I=new Af({dragAndDropEnabled:!1,multiplanarForceRender:!0,show3Dcrosshair:!0,backColor:[.05,.05,.1,1],crosshairColor:[0,1,0,.5]});I.attachToCanvas(s.current),I.setSliceType(zi.MULTIPLANAR),r.current=I;const _=[];_.push({url:i,colormap:"warm",opacity:1}),e&&_.push({url:e,colormap:"hot",opacity:y}),t&&_.push({url:t,colormap:"cool",opacity:b}),await I.loadVolumes(_),I.volumes.length>0&&I.setColormap(I.volumes[0].id,"warm"),I.volumes.length>1&&e&&(I.setColormap(I.volumes[1].id,"hot"),I.setOpacity(1,d?y:0)),I.volumes.length>2&&t&&(I.setColormap(I.volumes[2].id,"cool"),I.setOpacity(2,p?b:0)),l(!1)}catch(I){console.error("Error loading CT volumes:",I),C("Failed to load 3D volumes. The files may not be available yet."),l(!1)}})(),()=>{r.current=null}),[i,e,t]),V.useEffect(()=>{!r.current||r.current.volumes.length<2||e&&r.current.volumes.length>=2&&r.current.setOpacity(1,d?y:0)},[y,d,e]),V.useEffect(()=>{!r.current||r.current.volumes.length<3||t&&r.current.volumes.length>=3&&r.current.setOpacity(2,p?b:0)},[b,p,t]);const D=N=>{h(N),E(N)},M=()=>{r.current&&(r.current.setSliceType(zi.MULTIPLANAR),h("multiplanar"))};return i?v.jsxs("div",{className:Kt.container,children:[v.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:"#f9fafb"},children:[v.jsxs("h3",{style:{margin:0,fontSize:"1rem",fontWeight:600,color:"#374151",display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx(Y5,{className:"h-5 w-5",style:{color:"#2563eb"}}),n]}),v.jsxs("div",{style:{display:"flex",gap:"4px"},children:[v.jsx("button",{onClick:()=>D("multiplanar"),style:{padding:"6px 12px",borderRadius:"4px",border:"none",cursor:"pointer",fontSize:"0.75rem",fontWeight:500,backgroundColor:c==="multiplanar"?"#2563eb":"#e5e7eb",color:c==="multiplanar"?"white":"#374151",display:"flex",alignItems:"center"},title:"Multiplanar View",children:v.jsx(q5,{className:"h-4 w-4"})}),v.jsx("button",{onClick:()=>D("axial"),style:{padding:"6px 12px",borderRadius:"4px",border:"none",cursor:"pointer",fontSize:"0.75rem",fontWeight:500,backgroundColor:c==="axial"?"#2563eb":"#e5e7eb",color:c==="axial"?"white":"#374151"},title:"Axial View",children:"A"}),v.jsx("button",{onClick:()=>D("sagittal"),style:{padding:"6px 12px",borderRadius:"4px",border:"none",cursor:"pointer",fontSize:"0.75rem",fontWeight:500,backgroundColor:c==="sagittal"?"#2563eb":"#e5e7eb",color:c==="sagittal"?"white":"#374151"},title:"Sagittal View",children:"S"}),v.jsx("button",{onClick:()=>D("coronal"),style:{padding:"6px 12px",borderRadius:"4px",border:"none",cursor:"pointer",fontSize:"0.75rem",fontWeight:500,backgroundColor:c==="coronal"?"#2563eb":"#e5e7eb",color:c==="coronal"?"white":"#374151"},title:"Coronal View",children:"C"}),v.jsx("button",{onClick:()=>D("render3d"),style:{padding:"6px 12px",borderRadius:"4px",border:"none",cursor:"pointer",fontSize:"0.75rem",fontWeight:500,backgroundColor:c==="render3d"?"#2563eb":"#e5e7eb",color:c==="render3d"?"white":"#374151",display:"flex",alignItems:"center"},title:"3D Render",children:v.jsx(K5,{className:"h-4 w-4"})}),v.jsx("button",{onClick:M,style:{padding:"6px 12px",borderRadius:"4px",border:"none",cursor:"pointer",fontSize:"0.75rem",backgroundColor:"#f3f4f6",color:"#374151",display:"flex",alignItems:"center"},title:"Reset View",children:v.jsx(Q5,{className:"h-4 w-4"})})]})]}),v.jsxs("div",{className:Kt.canvasContainer,style:{position:"relative",minHeight:"500px"},children:[a&&v.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0,0,0,0.7)",zIndex:10},children:v.jsxs("div",{style:{textAlign:"center",color:"white"},children:[v.jsx("div",{style:{width:"40px",height:"40px",border:"3px solid #ffffff33",borderTop:"3px solid white",borderRadius:"50%",margin:"0 auto 12px",animation:"spin 1s linear infinite"}}),v.jsx("p",{children:"Loading 3D volumes..."})]})}),S&&v.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0,0,0,0.8)",zIndex:10},children:v.jsx("div",{style:{textAlign:"center",color:"#ef4444",padding:"20px"},children:v.jsx("p",{children:S})})}),v.jsx("canvas",{ref:s,className:Kt.canvas,style:{width:"100%",height:"500px",backgroundColor:"#0a0a14"}})]}),(e||t)&&v.jsxs("div",{style:{padding:"12px 16px",borderTop:"1px solid #e5e7eb",backgroundColor:"#f9fafb"},children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[v.jsx(W5,{className:"h-4 w-4",style:{color:"#6b7280"}}),v.jsx("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#374151"},children:"Overlay Controls"})]}),v.jsxs("div",{style:{display:"flex",gap:"24px",flexWrap:"wrap"},children:[e&&v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[v.jsxs("button",{onClick:()=>f(!d),style:{display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",borderRadius:"4px",border:"none",cursor:"pointer",backgroundColor:d?"#fef3c7":"#f3f4f6",color:d?"#b45309":"#6b7280"},children:[d?v.jsx(ba,{className:"h-4 w-4"}):v.jsx(Id,{className:"h-4 w-4"}),v.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500},children:"Entropy Map"}),v.jsx("span",{style:{width:"12px",height:"12px",backgroundColor:"#f59e0b",borderRadius:"2px"}})]}),d&&v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:y,onChange:N=>x(parseFloat(N.target.value)),style:{width:"80px"}}),v.jsxs("span",{style:{fontSize:"0.7rem",color:"#6b7280",minWidth:"35px"},children:[Math.round(y*100),"%"]})]})]}),t&&v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[v.jsxs("button",{onClick:()=>g(!p),style:{display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",borderRadius:"4px",border:"none",cursor:"pointer",backgroundColor:p?"#dbeafe":"#f3f4f6",color:p?"#1d4ed8":"#6b7280"},children:[p?v.jsx(ba,{className:"h-4 w-4"}):v.jsx(Id,{className:"h-4 w-4"}),v.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500},children:"GLCM Texture"}),v.jsx("span",{style:{width:"12px",height:"12px",backgroundColor:"#3b82f6",borderRadius:"2px"}})]}),p&&v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:b,onChange:N=>w(parseFloat(N.target.value)),style:{width:"80px"}}),v.jsxs("span",{style:{fontSize:"0.7rem",color:"#6b7280",minWidth:"35px"},children:[Math.round(b*100),"%"]})]})]})]})]}),v.jsx("div",{style:{padding:"8px 16px",backgroundColor:"#1f2937",color:"#9ca3af",fontSize:"0.75rem"},children:v.jsx("p",{style:{margin:"2px 0"},children:" Left Click + Drag: Rotate | Right Click: Pan | Scroll: Navigate Slices / Zoom"})}),v.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]}):v.jsx("div",{className:Kt.container,style:{minHeight:"400px",display:"flex",alignItems:"center",justifyContent:"center"},children:v.jsx("p",{style:{color:"#6b7280"},children:"No heatmap available for 3D visualization"})})},Ej=()=>{const{id:i}=Wd(),e=bn(),{data:t,isLoading:n,error:s,refetch:r}=lf(i||""),[a,{isLoading:l}]=Wo(),[c]=Ko(),h=async()=>{if(i)try{await a(i).unwrap()}catch(x){console.error("Failed to start processing:",x)}},d=async()=>{if(i&&window.confirm("Are you sure you want to delete this CT study? This action cannot be undone."))try{await c(i).unwrap(),e("/ct/studies")}catch(x){console.error("Failed to delete study:",x)}};if(qd.useEffect(()=>{let x;return(t?.status==="PROCESSING"||t?.status==="VALIDATING")&&(x=setInterval(()=>{r()},2e3)),()=>clearInterval(x)},[t?.status,r]),n)return v.jsx("div",{className:J.loadingContainer,children:v.jsx("div",{className:J.spinner})});if(s||!t)return v.jsx("div",{className:J.errorContainer,children:v.jsx("div",{className:"flex",children:v.jsx("div",{className:"ml-3",children:v.jsx("p",{className:J.errorMessage,children:"Error loading CT study details."})})})});const f=t.results?.heatmap?t.results.heatmap.startsWith("http")?t.results.heatmap:`http://localhost:8000${t.results.heatmap}`:null,p=t.results?.entropy_map?t.results.entropy_map.startsWith("http")?t.results.entropy_map:`http://localhost:8000${t.results.entropy_map}`:null,g=t.results?.glcm_map?t.results.glcm_map.startsWith("http")?t.results.glcm_map:`http://localhost:8000${t.results.glcm_map}`:null,y=t.status==="COMPLETED"?J.statusCompleted:t.status==="PROCESSING"||t.status==="VALIDATING"?J.statusProcessing:t.status==="FAILED"?J.statusFailed:J.statusPending;return v.jsxs("div",{className:J.container,children:[v.jsx("div",{className:J.header,children:v.jsxs("div",{className:J.headerContent,children:[v.jsxs("div",{children:[v.jsxs("h2",{className:J.title,children:["CT Study #",t.id]}),v.jsxs("p",{className:J.subtitle,children:["Patient ID: ",t.patient_id||"N/A","  Bio-Tensor SMART Analysis"]})]}),v.jsxs("span",{className:`${J.statusBadge} ${y}`,children:[v.jsx(ps,{className:"w-4 h-4"}),t.status]}),v.jsx("button",{onClick:d,className:J.deleteButton,title:"Delete study",children:v.jsx(eu,{className:"h-4 w-4"})})]})}),t.logs&&t.logs.length>0&&v.jsxs("div",{className:J.logsSection,children:[v.jsxs("h3",{className:J.sectionTitle,children:[v.jsx($g,{className:"w-5 h-5"}),"Processing Logs"]}),v.jsx("div",{className:J.logsContainer,children:t.logs.map(x=>v.jsxs("div",{className:`${J.logItem} ${x.level==="ERROR"?J.logError:x.level==="WARNING"?J.logWarning:J.logInfo}`,children:[v.jsx("span",{className:J.logTime,children:new Date(x.timestamp).toLocaleTimeString()}),v.jsx("span",{className:J.logMessage,children:x.message})]},x.id))})]}),t.status==="FAILED"&&t.error_message&&v.jsx("div",{className:J.actionSection,children:v.jsxs("div",{className:J.errorBanner,children:[v.jsxs("div",{className:J.errorContent,children:[v.jsx(Qs,{className:"w-5 h-5"}),v.jsxs("div",{children:[v.jsx("strong",{children:"Processing Failed:"})," ",t.error_message]})]}),v.jsxs("button",{onClick:h,disabled:l,className:J.processButton,children:[v.jsx(es,{className:"w-4 h-4"}),l?"Retrying...":"Retry Analysis"]})]})}),t.status==="UPLOADED"&&v.jsx("div",{className:J.actionSection,children:v.jsxs("button",{onClick:h,disabled:l,className:J.processButton,children:[v.jsx(es,{className:"w-4 h-4"}),l?"Starting Analysis...":"Start Bio-Tensor SMART Analysis"]})}),t.status==="COMPLETED"&&v.jsx("div",{className:J.actionSection,children:v.jsxs("button",{onClick:h,disabled:l,className:J.reprocessButton,children:[v.jsx(es,{className:"h-4 w-4"}),l?"Reprocessing...":"Reprocess Study"]})}),t.status==="COMPLETED"&&t.results&&v.jsxs("div",{className:J.resultsSection,children:[v.jsx("h3",{className:J.sectionTitle,children:"Analysis Results"}),v.jsxs("div",{className:J.metricsGrid,children:[v.jsxs("div",{className:J.metricCard,children:[v.jsx("div",{className:J.metricLabel,children:"Penumbra Volume"}),v.jsxs("div",{className:J.metricValue,children:[t.results.penumbra_volume?.toFixed(2)||"N/A",v.jsx("span",{className:J.metricUnit,children:"cm"})]}),v.jsx("div",{className:J.metricDescription,children:"At-risk but viable tissue"})]}),v.jsxs("div",{className:J.metricCard,children:[v.jsx("div",{className:J.metricLabel,children:"Core Volume"}),v.jsxs("div",{className:J.metricValue,children:[t.results.core_volume?.toFixed(2)||"N/A",v.jsx("span",{className:J.metricUnit,children:"cm"})]}),v.jsx("div",{className:J.metricDescription,children:"Irreversible damage"})]}),v.jsxs("div",{className:J.metricCard,children:[v.jsx("div",{className:J.metricLabel,children:"Measurement Uncertainty ()"}),v.jsxs("div",{className:J.metricValue,children:["",t.results.uncertainty_sigma?.toFixed(2)||"N/A",v.jsx("span",{className:J.metricUnit,children:"cm"})]}),v.jsx("div",{className:J.metricDescription,children:"Geometric + noise error"})]})]}),f&&v.jsxs("div",{className:J.visualizationSection,children:[v.jsx(Cj,{heatmapUrl:f,entropyUrl:p||void 0,glcmUrl:g||void 0,title:"Bio-Tensor SMART - 3D Heatmap"}),v.jsxs("div",{className:J.colorLegend,children:[v.jsxs("div",{className:J.legendItem,children:[v.jsx("div",{className:`${J.legendColor} ${J.legendRed}`}),v.jsx("span",{children:"Core (Irreversible)"})]}),v.jsxs("div",{className:J.legendItem,children:[v.jsx("div",{className:`${J.legendColor} ${J.legendBlue}`}),v.jsx("span",{children:"Penumbra (At-risk)"})]}),p&&v.jsxs("div",{className:J.legendItem,children:[v.jsx("div",{className:`${J.legendColor}`,style:{backgroundColor:"#f59e0b"}}),v.jsx("span",{children:"Entropy Map"})]}),g&&v.jsxs("div",{className:J.legendItem,children:[v.jsx("div",{className:`${J.legendColor}`,style:{backgroundColor:"#3b82f6"}}),v.jsx("span",{children:"GLCM Texture"})]})]}),v.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"12px",marginTop:"16px"},children:[v.jsxs("a",{href:f,download:!0,className:J.downloadButton,children:[v.jsx(Do,{className:"h-4 w-4"}),"Download Heatmap (.nii.gz)"]}),p&&v.jsxs("a",{href:p,download:!0,className:J.downloadButton,style:{backgroundColor:"#f59e0b"},children:[v.jsx(Do,{className:"h-4 w-4"}),"Entropy Map"]}),g&&v.jsxs("a",{href:g,download:!0,className:J.downloadButton,style:{backgroundColor:"#3b82f6"},children:[v.jsx(Do,{className:"h-4 w-4"}),"GLCM Map"]})]})]})]})]})},Tj=()=>{const{data:i,isLoading:e,error:t,refetch:n}=of(),s=i?.filter(l=>l.modality==="CT_TEP")||[],r=l=>{switch(l){case"COMPLETED":return v.jsxs("span",{className:`${pe.badge} ${pe.badgeSuccess}`,children:[v.jsx(Zg,{className:"h-4 w-4"}),"Completed"]});case"PROCESSING":return v.jsxs("span",{className:`${pe.badge} ${pe.badgeWarning}`,children:[v.jsx(o0,{className:"h-4 w-4 animate-spin"}),"Processing"]});case"FAILED":return v.jsxs("span",{className:`${pe.badge} ${pe.badgeError}`,children:[v.jsx(Jg,{className:"h-4 w-4"}),"Failed"]});default:return v.jsxs("span",{className:`${pe.badge} ${pe.badgePending}`,children:[v.jsx(pa,{className:"h-4 w-4"}),"Pending"]})}},a=l=>l==null?{label:"N/A",color:"#6b7280"}:l<10?{label:"Low",color:"#22c55e"}:l<20?{label:"Moderate",color:"#f59e0b"}:l<30?{label:"High",color:"#ef4444"}:{label:"Critical",color:"#7f1d1d"};return e?v.jsx("div",{className:pe.container,children:v.jsxs("div",{className:pe.loading,children:[v.jsx(o0,{className:"h-8 w-8 animate-spin"}),v.jsx("span",{children:"Loading TEP studies..."})]})}):t?v.jsx("div",{className:pe.container,children:v.jsxs("div",{className:pe.error,children:[v.jsx(Qs,{className:"h-8 w-8 text-red-500"}),v.jsx("span",{children:"Error loading studies"}),v.jsx("button",{onClick:n,className:pe.retryButton,children:"Retry"})]})}):v.jsxs("div",{className:pe.container,children:[v.jsxs("div",{className:pe.header,children:[v.jsxs("div",{children:[v.jsxs("h1",{className:pe.title,children:[v.jsx(ps,{className:"h-8 w-8 text-red-500"}),"Pulmonary Embolism (TEP) Studies"]}),v.jsx("p",{className:pe.subtitle,children:"CT Angiography analysis for thrombus detection in pulmonary arteries"})]}),v.jsxs(ci,{to:"/tep/upload",className:pe.uploadButton,style:{backgroundColor:"#dc2626"},children:[v.jsx(sb,{className:"h-5 w-5"}),"Upload AngioTC"]})]}),s.length===0?v.jsxs("div",{className:pe.empty,children:[v.jsx(ps,{className:"h-16 w-16 text-gray-300"}),v.jsx("h3",{children:"No TEP Studies Yet"}),v.jsx("p",{children:"Upload a CT Angiography to start analyzing for pulmonary embolism."}),v.jsxs(ci,{to:"/tep/upload",className:pe.emptyButton,style:{backgroundColor:"#dc2626"},children:[v.jsx(sb,{className:"h-5 w-5"}),"Upload First Study"]})]}):v.jsx("div",{className:pe.studyList,children:s.map(l=>{const c=l.results?.qanadli_score,h=a(c),d=l.results?.total_obstruction_pct,f=l.results?.clot_count;return v.jsxs("div",{className:pe.studyCard,style:{borderLeftColor:"#dc2626"},children:[v.jsxs("div",{className:pe.studyHeader,children:[v.jsxs("div",{className:pe.studyInfo,children:[v.jsxs("h3",{className:pe.studyTitle,children:[v.jsx(ps,{className:"h-5 w-5 text-red-500"}),"Study #",l.id]}),v.jsx("span",{className:pe.studyDate,children:new Date(l.created_at).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),r(l.status)]}),v.jsxs("div",{className:pe.studyMeta,children:[v.jsxs("span",{className:pe.metaItem,children:[v.jsx("strong",{children:"Files:"})," ",l.dicom_file_count||"N/A"]}),v.jsxs("span",{className:pe.metaItem,children:[v.jsx("strong",{children:"Modality:"})," CT Angiography (TEP)"]})]}),l.status==="COMPLETED"&&l.results&&v.jsxs("div",{className:pe.results,style:{backgroundColor:"#fef2f2",borderColor:"#fecaca"},children:[v.jsx("h4",{style:{color:"#b91c1c"},children:"TEP Analysis Results:"}),v.jsxs("div",{className:pe.resultGrid,children:[v.jsxs("div",{className:pe.resultItem,children:[v.jsx("span",{className:pe.resultLabel,children:"Qanadli Score"}),v.jsxs("span",{className:pe.resultValue,style:{color:h.color,fontWeight:"bold",fontSize:"1.25rem"},children:[c?.toFixed(1)??"N/A","/40"]}),v.jsxs("span",{style:{color:h.color,fontSize:"0.75rem",fontWeight:600},children:["(",h.label," Risk)"]})]}),v.jsxs("div",{className:pe.resultItem,children:[v.jsx("span",{className:pe.resultLabel,children:"Obstruction"}),v.jsxs("span",{className:pe.resultValue,style:{color:d&&d>50?"#dc2626":"#059669"},children:[d?.toFixed(1)??"N/A","%"]})]}),v.jsxs("div",{className:pe.resultItem,children:[v.jsx("span",{className:pe.resultLabel,children:"Clot Count"}),v.jsx("span",{className:pe.resultValue,children:f??"N/A"})]}),v.jsxs("div",{className:pe.resultItem,children:[v.jsx("span",{className:pe.resultLabel,children:"Clot Volume"}),v.jsxs("span",{className:pe.resultValue,children:[l.results.total_clot_volume?.toFixed(2)??"N/A"," cm"]})]}),v.jsxs("div",{className:pe.resultItem,children:[v.jsx("span",{className:pe.resultLabel,children:"Contrast Quality"}),v.jsx("span",{className:pe.resultValue,children:l.results.contrast_quality??"N/A"})]})]}),(l.results.main_pa_obstruction_pct!==null||l.results.left_pa_obstruction_pct!==null||l.results.right_pa_obstruction_pct!==null)&&v.jsxs("div",{style:{marginTop:"12px",padding:"8px",backgroundColor:"#fff",borderRadius:"6px"},children:[v.jsx("h5",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"6px"},children:"Per-Branch Obstruction:"}),v.jsxs("div",{style:{display:"flex",gap:"16px",fontSize:"0.875rem"},children:[v.jsxs("span",{children:[v.jsx("strong",{children:"Main PA:"})," ",l.results.main_pa_obstruction_pct?.toFixed(1)??"N/A","%"]}),v.jsxs("span",{children:[v.jsx("strong",{children:"Left PA:"})," ",l.results.left_pa_obstruction_pct?.toFixed(1)??"N/A","%"]}),v.jsxs("span",{children:[v.jsx("strong",{children:"Right PA:"})," ",l.results.right_pa_obstruction_pct?.toFixed(1)??"N/A","%"]})]})]})]}),l.status==="PROCESSING"&&v.jsxs("div",{className:pe.processingInfo,children:[v.jsx(o0,{className:"h-5 w-5 animate-spin"}),v.jsx("span",{children:l.processing_log?.split(`
`).pop()||"Analyzing pulmonary arteries..."})]}),l.status==="FAILED"&&l.processing_log&&v.jsxs("div",{className:pe.errorInfo,children:[v.jsx(Qs,{className:"h-5 w-5"}),v.jsx("span",{children:l.processing_log.split(`
`).pop()})]}),v.jsx("div",{className:pe.studyActions,children:v.jsxs(ci,{to:`/tep/studies/${l.id}`,className:pe.viewButton,style:{backgroundColor:"#dc2626"},children:[v.jsx(ba,{className:"h-4 w-4"}),"View Details"]})})]},l.id)})})]})},Mj=()=>{const[i,e]=V.useState(null),[t,{isLoading:n,error:s}]=cf(),r=bn(),a=V.useRef(null),l=h=>{h.target.files&&h.target.files.length>0&&e(h.target.files)},c=async h=>{if(h.preventDefault(),!i||i.length===0)return;const d=new FormData;for(let f=0;f<i.length;f++)d.append("dicom_files",i[f]);d.append("modality","CT_TEP");try{await t(d).unwrap(),r("/tep/studies")}catch(f){console.error("Failed to upload TEP study:",f)}};return v.jsx("div",{className:we.container,children:v.jsxs("div",{className:we.card,children:[v.jsxs("div",{className:we.header,children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[v.jsx(ps,{className:"h-8 w-8 text-red-500"}),v.jsx("h2",{className:we.title,children:"Upload CT Angiography - Pulmonary Embolism Analysis"})]}),v.jsx("p",{className:we.description,children:"Upload a complete CT Angiography (AngioTC) series for automated detection of pulmonary embolism (TEP)."})]}),v.jsxs("div",{className:we.alert,style:{borderColor:"#ef4444"},children:[v.jsx(X5,{className:"h-5 w-5 text-red-600"}),v.jsxs("div",{className:we.alertContent,children:[v.jsx("h4",{className:we.alertTitle,style:{color:"#dc2626"},children:"CT Angiography Requirements for TEP Analysis:"}),v.jsxs("ul",{className:we.requirementsList,children:[v.jsxs("li",{children:[v.jsx("strong",{children:"Contrast Enhancement:"})," Study MUST have IV contrast with adequate pulmonary artery opacification (>200 HU)"]}),v.jsxs("li",{children:[v.jsx("strong",{children:"Slice Thickness:"})," Maximum 1.5mm (1.0mm or thinner recommended)"]}),v.jsxs("li",{children:[v.jsx("strong",{children:"Coverage:"})," Complete thoracic coverage from aortic arch to diaphragm"]}),v.jsxs("li",{children:[v.jsx("strong",{children:"Timing:"})," Pulmonary arterial phase (triggered on PA or ascending aorta)"]}),v.jsxs("li",{children:[v.jsx("strong",{children:"Window:"})," Mediastinal/soft tissue window preferred for PA visualization"]}),v.jsxs("li",{children:[v.jsx("strong",{children:"Motion:"})," Breath-hold acquisition to minimize respiratory motion artifacts"]})]})]})]}),v.jsxs("div",{className:we.alert,style:{borderColor:"#3b82f6",backgroundColor:"#eff6ff"},children:[v.jsx(ps,{className:"h-5 w-5 text-blue-600"}),v.jsxs("div",{className:we.alertContent,children:[v.jsx("h4",{className:we.alertTitle,style:{color:"#1d4ed8"},children:"Analysis Output:"}),v.jsxs("ul",{className:we.requirementsList,children:[v.jsxs("li",{children:[v.jsx("strong",{children:"Thrombus Detection:"})," Automated identification of filling defects in pulmonary arteries"]}),v.jsxs("li",{children:[v.jsx("strong",{children:"Qanadli Score:"})," Standardized obstruction index (0-40 scale)"]}),v.jsxs("li",{children:[v.jsx("strong",{children:"Obstruction Percentage:"})," Per-branch analysis (main PA, left PA, right PA)"]}),v.jsxs("li",{children:[v.jsx("strong",{children:"Clot Volume:"})," Quantified total thrombus volume in cm"]}),v.jsxs("li",{children:[v.jsx("strong",{children:"Visual Heatmap:"})," Color-coded visualization (red=thrombi, green=patent vessels)"]})]})]})]}),v.jsxs("form",{onSubmit:c,className:we.form,children:[v.jsxs("div",{className:we.dropzone,children:[v.jsx("input",{type:"file",ref:a,onChange:l,multiple:!0,className:we.fileInput,webkitdirectory:"",directory:""}),v.jsxs("div",{className:we.dropzoneContent,onClick:()=>a.current?.click(),children:[v.jsx(Ro,{className:we.uploadIcon,style:{color:"#dc2626"}}),v.jsx("h3",{className:we.dropzoneTitle,children:"Select CT Angiography DICOM Folder"}),v.jsx("p",{className:we.dropzoneText,children:"Click to browse and select the folder containing your AngioTC series"}),i&&i.length>0&&v.jsxs("div",{className:we.fileInfo,children:[v.jsx(e1,{className:"h-5 w-5"}),v.jsxs("span",{children:[i.length," files selected"]})]})]})]}),s&&v.jsxs("div",{className:we.error,children:[v.jsx(Qs,{className:"h-5 w-5"}),v.jsx("span",{children:"Upload failed. Please check your files and try again."})]}),v.jsxs("div",{className:we.actions,children:[v.jsx("button",{type:"button",onClick:()=>r("/tep/studies"),className:we.cancelButton,children:"Cancel"}),v.jsx("button",{type:"submit",disabled:!i||i.length===0||n,className:we.submitButton,style:{backgroundColor:n?void 0:"#dc2626"},children:n?"Uploading...":"Upload and Analyze TEP"})]})]})]})})},Dj=({sourceUrl:i,heatmapUrl:e,thrombusUrl:t,paUrl:n,roiUrl:s,title:r="TEP 3D Visualization"})=>{const a=V.useRef(null),l=V.useRef(null),[c,h]=V.useState(!0),[d,f]=V.useState("multiplanar"),[p,g]=V.useState(!0),[y,x]=V.useState(!0),[b,w]=V.useState(!0),[S,C]=V.useState(!1),[E,D]=V.useState(.5),[M,N]=V.useState(.7),[I,_]=V.useState(.5),[F,B]=V.useState(.3),[P,O]=V.useState(null),k=V.useRef({source:-1,heatmap:-1,thrombus:-1,pa:-1,roi:-1}),q=V.useCallback(Q=>{if(!l.current)return;const te=l.current;switch(Q){case"multiplanar":te.setSliceType(zi.MULTIPLANAR);break;case"axial":te.setSliceType(zi.AXIAL);break;case"sagittal":te.setSliceType(zi.SAGITTAL);break;case"coronal":te.setSliceType(zi.CORONAL);break;case"render3d":te.setSliceType(zi.RENDER);break}},[]);V.useEffect(()=>!a.current||!i&&!e?void 0:((async()=>{h(!0),O(null);try{const te=new Af({dragAndDropEnabled:!1,multiplanarForceRender:!0,show3Dcrosshair:!0,backColor:[.1,.1,.1,1],crosshairColor:[1,0,0,.5]});te.attachToCanvas(a.current),te.setSliceType(zi.MULTIPLANAR),l.current=te;const j=[];let W=0;const K={source:-1,heatmap:-1,thrombus:-1,pa:-1,roi:-1};i&&(j.push({url:i,colormap:"gray",opacity:1}),K.source=W++),e&&(j.push({url:e,colormap:i?"hot":"gray",opacity:i?E:1}),K.heatmap=W++),t&&(j.push({url:t,colormap:"red",opacity:M}),K.thrombus=W++),n&&(j.push({url:n,colormap:"green",opacity:I}),K.pa=W++),s&&(j.push({url:s,colormap:"blue",opacity:S?F:0}),K.roi=W++),k.current=K,await te.loadVolumes(j),K.source>=0&&te.volumes.length>K.source&&te.setColormap(te.volumes[K.source].id,"gray"),K.heatmap>=0&&te.volumes.length>K.heatmap&&(te.setColormap(te.volumes[K.heatmap].id,i?"hot":"gray"),te.setOpacity(K.heatmap,i?p?E:0:1)),K.thrombus>=0&&te.volumes.length>K.thrombus&&(te.setColormap(te.volumes[K.thrombus].id,"red"),te.setOpacity(K.thrombus,y?M:0)),K.pa>=0&&te.volumes.length>K.pa&&(te.setColormap(te.volumes[K.pa].id,"green"),te.setOpacity(K.pa,b?I:0)),K.roi>=0&&te.volumes.length>K.roi&&(te.setColormap(te.volumes[K.roi].id,"blue"),te.setOpacity(K.roi,S?F:0)),h(!1)}catch(te){console.error("Error loading TEP volumes:",te),O("Failed to load 3D volumes. The files may not be available yet."),h(!1)}})(),()=>{l.current=null}),[i,e,t,n,s]),V.useEffect(()=>{if(!l.current||!e||!i)return;const Q=k.current.heatmap;Q>=0&&l.current.volumes.length>Q&&l.current.setOpacity(Q,p?E:0)},[E,p,e,i]),V.useEffect(()=>{if(!l.current||!t)return;const Q=k.current.thrombus;Q>=0&&l.current.volumes.length>Q&&l.current.setOpacity(Q,y?M:0)},[M,y,t]),V.useEffect(()=>{if(!l.current||!n)return;const Q=k.current.pa;Q>=0&&l.current.volumes.length>Q&&l.current.setOpacity(Q,b?I:0)},[I,b,n]),V.useEffect(()=>{if(!l.current||!s)return;const Q=k.current.roi;Q>=0&&l.current.volumes.length>Q&&l.current.setOpacity(Q,S?F:0)},[F,S,s]);const U=Q=>{f(Q),q(Q)},H=()=>{l.current&&(l.current.setSliceType(zi.MULTIPLANAR),f("multiplanar"))};if(!e&&!i)return v.jsx("div",{className:Kt.container,style:{minHeight:"400px",display:"flex",alignItems:"center",justifyContent:"center"},children:v.jsx("p",{style:{color:"#6b7280"},children:"No volumes available for 3D visualization"})});const Y=(Q,te,j,W,K,ee,le,he)=>v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[v.jsxs("button",{onClick:()=>W(!j),style:{display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",borderRadius:"4px",border:"none",cursor:"pointer",backgroundColor:j?he:"#f3f4f6",color:j?le:"#6b7280"},children:[j?v.jsx(ba,{className:"h-4 w-4"}):v.jsx(Id,{className:"h-4 w-4"}),v.jsx("span",{style:{fontSize:"0.75rem",fontWeight:500},children:Q}),v.jsx("span",{style:{width:"12px",height:"12px",backgroundColor:te,borderRadius:"2px"}})]}),j&&v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:K,onChange:ce=>ee(parseFloat(ce.target.value)),style:{width:"80px"}}),v.jsxs("span",{style:{fontSize:"0.7rem",color:"#6b7280",minWidth:"35px"},children:[Math.round(K*100),"%"]})]})]});return v.jsxs("div",{className:Kt.container,children:[v.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:"#f9fafb"},children:[v.jsxs("h3",{style:{margin:0,fontSize:"1rem",fontWeight:600,color:"#374151",display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx(W6,{className:"h-5 w-5",style:{color:"#dc2626"}}),r]}),v.jsxs("div",{style:{display:"flex",gap:"4px"},children:[["multiplanar","axial","sagittal","coronal","render3d"].map(Q=>v.jsx("button",{onClick:()=>U(Q),style:{padding:"6px 12px",borderRadius:"4px",border:"none",cursor:"pointer",fontSize:"0.75rem",fontWeight:500,backgroundColor:d===Q?"#dc2626":"#e5e7eb",color:d===Q?"white":"#374151",display:"flex",alignItems:"center"},title:Q==="multiplanar"?"Multiplanar View":Q==="render3d"?"3D Render":`${Q.charAt(0).toUpperCase()+Q.slice(1)} View`,children:Q==="multiplanar"?v.jsx(q5,{className:"h-4 w-4"}):Q==="render3d"?v.jsx(K5,{className:"h-4 w-4"}):Q.charAt(0).toUpperCase()},Q)),v.jsx("button",{onClick:H,style:{padding:"6px 12px",borderRadius:"4px",border:"none",cursor:"pointer",fontSize:"0.75rem",backgroundColor:"#f3f4f6",color:"#374151",display:"flex",alignItems:"center"},title:"Reset View",children:v.jsx(Q5,{className:"h-4 w-4"})})]})]}),v.jsxs("div",{className:Kt.canvasContainer,style:{position:"relative",minHeight:"500px"},children:[c&&v.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0,0,0,0.7)",zIndex:10},children:v.jsxs("div",{style:{textAlign:"center",color:"white"},children:[v.jsx("div",{style:{width:"40px",height:"40px",border:"3px solid #ffffff33",borderTop:"3px solid white",borderRadius:"50%",margin:"0 auto 12px",animation:"spin 1s linear infinite"}}),v.jsx("p",{children:"Loading 3D volumes..."})]})}),P&&v.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0,0,0,0.8)",zIndex:10},children:v.jsx("div",{style:{textAlign:"center",color:"#ef4444",padding:"20px"},children:v.jsx("p",{children:P})})}),v.jsx("canvas",{ref:a,className:Kt.canvas,style:{width:"100%",height:"500px",backgroundColor:"#1a1a1a"}})]}),v.jsxs("div",{style:{padding:"12px 16px",borderTop:"1px solid #e5e7eb",backgroundColor:"#f9fafb"},children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[v.jsx(W5,{className:"h-4 w-4",style:{color:"#6b7280"}}),v.jsx("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"#374151"},children:"Layer Controls"})]}),v.jsxs("div",{style:{display:"flex",gap:"24px",flexWrap:"wrap"},children:[e&&i&&Y("Heatmap","#f97316",p,g,E,D,"#ea580c","#fff7ed"),t&&Y("Thrombus","#dc2626",y,x,M,N,"#dc2626","#fee2e2"),n&&Y("Pulmonary Arteries","#22c55e",b,w,I,_,"#16a34a","#dcfce7"),s&&Y("ROI","#06b6d4",S,C,F,B,"#0891b2","#cffafe")]})]}),v.jsx("div",{style:{padding:"8px 16px",backgroundColor:"#1f2937",color:"#9ca3af",fontSize:"0.75rem"},children:v.jsx("p",{style:{margin:"2px 0"},children:" Left Click + Drag: Rotate | Right Click: Pan | Scroll: Navigate Slices / Zoom"})}),v.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]})},Rj="_station_sni5u_5",Nj="_header_sni5u_14",Ij="_headerTitle_sni5u_23",_j="_toolbar_sni5u_33",Fj="_toolBtn_sni5u_39",Pj="_toolBtnActive_sni5u_59",Bj="_body_sni5u_66",Lj="_canvasWrapper_sni5u_71",kj="_canvas_sni5u_71",Oj="_sliceHud_sni5u_88",Uj="_scrollbar_sni5u_104",Vj="_scrollTrack_sni5u_112",jj="_scrollTick_sni5u_122",zj="_scrollTickHeatmap_sni5u_131",Gj="_scrollTickFlow_sni5u_135",Hj="_scrollIndicator_sni5u_139",Yj="_pin_sni5u_151",qj="_pinIcon_sni5u_165",Xj="_tooltip_sni5u_171",Wj="_tooltipHeader_sni5u_186",Kj="_tooltipBadge_sni5u_195",Qj="_badgeDefinite_sni5u_203",Zj="_badgeSuspicious_sni5u_208",Jj="_tooltipRow_sni5u_213",$j="_tooltipLabel_sni5u_220",e9="_tooltipValue_sni5u_224",t9="_magnifier_sni5u_230",i9="_magnifierActive_sni5u_243",n9="_magnifierCanvas_sni5u_247",s9="_footer_sni5u_253",r9="_footerLegend_sni5u_264",a9="_legendDot_sni5u_269",o9="_dot_sni5u_275",l9="_dotRed_sni5u_281",c9="_dotPurple_sni5u_282",u9="_dotBlue_sni5u_283",h9="_loading_sni5u_292",d9="_spinner_sni5u_302",Re={station:Rj,header:Nj,headerTitle:Ij,toolbar:_j,toolBtn:Fj,toolBtnActive:Pj,body:Bj,canvasWrapper:Lj,canvas:kj,sliceHud:Oj,scrollbar:Uj,scrollTrack:Vj,scrollTick:jj,scrollTickHeatmap:zj,scrollTickFlow:Gj,scrollIndicator:Hj,pin:Yj,pinIcon:qj,tooltip:Xj,tooltipHeader:Wj,tooltipBadge:Kj,badgeDefinite:Qj,badgeSuspicious:Zj,tooltipRow:Jj,tooltipLabel:$j,tooltipValue:e9,magnifier:t9,magnifierActive:i9,magnifierCanvas:n9,footer:s9,footerLegend:r9,legendDot:a9,dot:o9,dotRed:l9,dotPurple:c9,dotBlue:u9,loading:h9,spinner:d9},aw="http://localhost:8000/api",f9=({studyId:i,slicesMeta:e,findingsPins:t})=>{const n=V.useRef(null),s=V.useRef(null),r=V.useRef(null),[a,l]=V.useState([]),[c,h]=V.useState([]),[d,f]=V.useState(0),[p,g]=V.useState(0),[y,x]=V.useState(!0),[b,w]=V.useState(.5),[S,C]=V.useState(!0),[E,D]=V.useState(!1),[M,N]=V.useState({x:0,y:0}),[I,_]=V.useState(null),[F,B]=V.useState({x:0,y:0}),[P,O]=V.useState({width:0,height:0,canvasWidth:0,canvasHeight:0,offsetX:0,offsetY:0,scale:1});V.useEffect(()=>{const j=async K=>{const le=await(await fetch(K)).json(),he=[];for(const ce of le.slices){if(!ce||ce==="undefined")continue;const xe=new Image;xe.src=ce,await new Promise(ge=>{xe.onload=()=>ge(),xe.onerror=()=>ge()}),he.push(xe)}return he};(async()=>{x(!0);try{const K=await j(`${aw}/studies/${i}/slices-bundle/?wc=40&ww=400&max_size=512`);l(K),g(K.length);try{const ee=await j(`${aw}/studies/${i}/result-bundle/tep_heatmap/?max_size=512`);h(ee)}catch{console.warn("Heatmap bundle not available")}e&&e.alerts_heatmap.length>0?f(e.alerts_heatmap[0]):K.length>0&&f(Math.floor(K.length/2))}catch(K){console.error("Failed to load slices:",K)}x(!1)})()},[i,e]);const k=V.useRef(P);V.useEffect(()=>{const j=n.current;if(!j||a.length===0)return;const W=j.getContext("2d");if(!W)return;const K=window.devicePixelRatio||1,ee=j.clientWidth,le=j.clientHeight;j.width=ee*K,j.height=le*K,W.scale(K,K),W.fillStyle="#000",W.fillRect(0,0,ee,le);const he=a[d];if(!he)return;const ce=he.width/he.height,xe=ee/le;let ge,Me,Ie,$e;ce>xe?(ge=ee,Me=ee/ce,Ie=0,$e=(le-Me)/2):(Me=le,ge=le*ce,Ie=(ee-ge)/2,$e=0);const We={width:he.width,height:he.height,canvasWidth:ge,canvasHeight:Me,offsetX:Ie,offsetY:$e,scale:ge/he.width};k.current=We,W.drawImage(he,Ie,$e,ge,Me),c[d]&&b>0&&(W.globalAlpha=b,W.drawImage(c[d],Ie,$e,ge,Me),W.globalAlpha=1);const Pe=requestAnimationFrame(()=>O(We));return()=>cancelAnimationFrame(Pe)},[a,c,d,b]),V.useEffect(()=>{if(!E||!s.current)return;const j=s.current,W=j.getContext("2d");if(!W)return;const K=a[d];if(!K)return;const ee=140,le=2;j.width=ee,j.height=ee;const he=(M.x-P.offsetX)/P.scale,ce=(M.y-P.offsetY)/P.scale,xe=ee/(le*P.scale),ge=he-xe/2,Me=ce-xe/2;W.clearRect(0,0,ee,ee),W.drawImage(K,ge,Me,xe,xe,0,0,ee,ee)},[E,M,a,d,P]);const q=V.useCallback(j=>{f(W=>{const K=W+j;return K<0?0:K>=p?p-1:K})},[p]);V.useEffect(()=>{const j=W=>{W.key==="ArrowRight"||W.key==="ArrowDown"?(W.preventDefault(),q(1)):W.key==="ArrowLeft"||W.key==="ArrowUp"?(W.preventDefault(),q(-1)):(W.key==="m"||W.key==="M")&&D(K=>!K)};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[q]);const U=V.useCallback(j=>{j.preventDefault(),q(j.deltaY>0?1:-1)},[q]),H=V.useCallback(j=>{const W=j.currentTarget.getBoundingClientRect(),K=j.clientX-W.left,ee=j.clientY-W.top;E&&N({x:K,y:ee})},[E]),Y=V.useCallback(j=>{if(!r.current||p===0)return;const W=r.current.getBoundingClientRect(),ee=(j.clientY-W.top)/W.height;f(Math.round(ee*(p-1)))},[p]),Q=V.useCallback(j=>{if(P.width===0)return{x:0,y:0};const W=P.offsetX+j.location.coord_x/P.width*P.canvasWidth,K=P.offsetY+j.location.coord_y/P.height*P.canvasHeight;return{x:W,y:K}},[P]),te=(t||[]).filter(j=>j.location.slice_z===d);return y?v.jsx("div",{className:Re.station,children:v.jsxs("div",{className:Re.loading,children:[v.jsx("div",{className:Re.spinner}),v.jsx("span",{children:"Loading Diagnostic Station..."})]})}):a.length===0?v.jsx("div",{className:Re.station,children:v.jsx("div",{className:Re.loading,children:v.jsx("span",{children:"No slices available"})})}):v.jsxs("div",{className:Re.station,children:[v.jsxs("div",{className:Re.header,children:[v.jsx("h3",{className:Re.headerTitle,children:" Diagnostic Station"}),v.jsxs("div",{className:Re.toolbar,children:[v.jsxs("button",{className:`${Re.toolBtn} ${E?Re.toolBtnActive:""}`,onClick:()=>D(!E),title:"X-Ray Magnifier (M)",children:[v.jsx(MR,{size:14}),"Magnifier"]}),v.jsxs("button",{className:`${Re.toolBtn} ${S?Re.toolBtnActive:""}`,onClick:()=>C(!S),title:"Toggle Findings Pins",children:[S?v.jsx(ba,{size:14}):v.jsx(Id,{size:14}),v.jsx(pR,{size:14}),"Pins"]}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[v.jsx("span",{style:{color:"#9ca3af",fontSize:"0.7rem"},children:"Heatmap"}),v.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:b,onChange:j=>w(parseFloat(j.target.value)),style:{width:70,accentColor:"#ef4444"}}),v.jsxs("span",{style:{color:"#6b7280",fontSize:"0.65rem",minWidth:28},children:[Math.round(b*100),"%"]})]}),v.jsxs("div",{style:{display:"flex",gap:2},children:[v.jsx("button",{className:Re.toolBtn,onClick:()=>q(-1),title:"Previous Slice ()",children:v.jsx(Z6,{size:14})}),v.jsx("button",{className:Re.toolBtn,onClick:()=>q(1),title:"Next Slice ()",children:v.jsx($6,{size:14})})]})]})]}),v.jsxs("div",{className:Re.body,children:[v.jsxs("div",{className:Re.canvasWrapper,children:[v.jsx("canvas",{ref:n,className:Re.canvas,onWheel:U,onMouseMove:H,onMouseLeave:()=>{_(null),E&&N({x:-200,y:-200})}}),v.jsxs("div",{className:Re.sliceHud,children:["Slice ",d+1," / ",p]}),S&&te.map(j=>{const W=Q(j);return v.jsx("div",{className:Re.pin,style:{left:W.x,top:W.y},onMouseEnter:K=>{_(j);const ee=K.currentTarget.closest(`.${Re.canvasWrapper}`)?.getBoundingClientRect();ee&&B({x:K.clientX-ee.left+16,y:K.clientY-ee.top-20})},onMouseLeave:()=>_(null),children:v.jsx("span",{className:Re.pinIcon,children:j.type==="TEP_DEFINITE"?"":""})},j.id)}),I&&v.jsxs("div",{className:Re.tooltip,style:{left:F.x,top:F.y},children:[v.jsxs("div",{className:Re.tooltipHeader,children:[v.jsxs("span",{children:[" Lesin #",I.id]}),v.jsx("span",{className:`${Re.tooltipBadge} ${I.type==="TEP_DEFINITE"?Re.badgeDefinite:Re.badgeSuspicious}`,children:I.type==="TEP_DEFINITE"?"Definida":"Sospechosa"})]}),v.jsxs("div",{className:Re.tooltipRow,children:[v.jsx("span",{className:Re.tooltipLabel,children:"Score Total"}),v.jsxs("span",{className:Re.tooltipValue,children:[I.tooltip_data.score_total," / 4.0"]})]}),v.jsxs("div",{className:Re.tooltipRow,children:[v.jsx("span",{className:Re.tooltipLabel,children:"Densidad"}),v.jsxs("span",{className:Re.tooltipValue,children:[I.tooltip_data.density_hu," HU"]})]}),v.jsxs("div",{className:Re.tooltipRow,children:[v.jsx("span",{className:Re.tooltipLabel,children:"Coherencia Flujo"}),v.jsx("span",{className:Re.tooltipValue,children:I.tooltip_data.flow_coherence})]}),v.jsxs("div",{className:Re.tooltipRow,style:{border:"none"},children:[v.jsx("span",{className:Re.tooltipLabel,children:"Volumen"}),v.jsxs("span",{className:Re.tooltipValue,children:[I.tooltip_data.volume_mm3," mm"]})]})]}),v.jsx("div",{className:`${Re.magnifier} ${E?Re.magnifierActive:""}`,style:{left:M.x-70,top:M.y-70},children:v.jsx("canvas",{ref:s,className:Re.magnifierCanvas})})]}),v.jsxs("div",{ref:r,className:Re.scrollbar,onClick:Y,children:[v.jsx("div",{className:Re.scrollTrack}),e?.alerts_heatmap.map(j=>v.jsx("div",{className:`${Re.scrollTick} ${Re.scrollTickHeatmap}`,style:{top:`${j/(p-1)*100}%`},onClick:W=>{W.stopPropagation(),f(j)}},`h-${j}`)),e?.alerts_flow.map(j=>v.jsx("div",{className:`${Re.scrollTick} ${Re.scrollTickFlow}`,style:{top:`${j/(p-1)*100}%`},onClick:W=>{W.stopPropagation(),f(j)}},`f-${j}`)),p>0&&v.jsx("div",{className:Re.scrollIndicator,style:{top:`${d/(p-1)*100}%`}})]})]}),v.jsxs("div",{className:Re.footer,children:[v.jsxs("div",{className:Re.footerLegend,children:[v.jsxs("div",{className:Re.legendDot,children:[v.jsx("div",{className:`${Re.dot} ${Re.dotRed}`}),v.jsxs("span",{children:["Trombo (",e?.alerts_heatmap.length||0," slices)"]})]}),v.jsxs("div",{className:Re.legendDot,children:[v.jsx("div",{className:`${Re.dot} ${Re.dotPurple}`}),v.jsxs("span",{children:["Flujo (",e?.alerts_flow.length||0," slices)"]})]}),v.jsxs("div",{className:Re.legendDot,children:[v.jsx("div",{className:`${Re.dot} ${Re.dotBlue}`}),v.jsx("span",{children:"Posicin actual"})]})]}),v.jsx("span",{children:" Scroll: Navegar |  : Slices | M: Magnifier"})]})]})},m9=()=>{const{id:i}=Wd(),e=bn(),{data:t,isLoading:n,error:s,refetch:r}=lf(i||""),[a,{isLoading:l}]=Wo(),[c]=Ko(),h=async()=>{if(i)try{await a(i).unwrap()}catch(E){console.error("Failed to start processing:",E)}},d=async()=>{if(i&&window.confirm("Are you sure you want to delete this TEP study? This action cannot be undone."))try{await c(i).unwrap(),e("/tep/studies")}catch(E){console.error("Failed to delete study:",E)}};if(qd.useEffect(()=>{let E;return(t?.status==="PROCESSING"||t?.status==="VALIDATING")&&(E=setInterval(()=>{r()},2e3)),()=>clearInterval(E)},[t?.status,r]),n)return v.jsx("div",{className:J.loadingContainer,children:v.jsx("div",{className:J.spinner})});if(s||!t)return v.jsx("div",{className:J.errorContainer,children:v.jsx("div",{className:"flex",children:v.jsx("div",{className:"ml-3",children:v.jsx("p",{className:J.errorMessage,children:"Error loading TEP study details."})})})});const f=t.results,p=f?.tep_heatmap?f.tep_heatmap.startsWith("http")?f.tep_heatmap:`http://localhost:8000${f.tep_heatmap}`:null,g=f?.tep_thrombus_mask?f.tep_thrombus_mask.startsWith("http")?f.tep_thrombus_mask:`http://localhost:8000${f.tep_thrombus_mask}`:null,y=f?.tep_pa_mask?f.tep_pa_mask.startsWith("http")?f.tep_pa_mask:`http://localhost:8000${f.tep_pa_mask}`:null,x=f?.tep_roi_heatmap?f.tep_roi_heatmap.startsWith("http")?f.tep_roi_heatmap:`http://localhost:8000${f.tep_roi_heatmap}`:null,b=f?.source_volume?f.source_volume.startsWith("http")?f.source_volume:`http://localhost:8000${f.source_volume}`:null,w=t.status==="COMPLETED"?J.statusCompleted:t.status==="PROCESSING"||t.status==="VALIDATING"?J.statusProcessing:t.status==="FAILED"?J.statusFailed:J.statusPending,C=(E=>E==null?{label:"N/A",color:"#6b7280"}:E<10?{label:"Low Risk",color:"#22c55e"}:E<20?{label:"Moderate Risk",color:"#f59e0b"}:E<30?{label:"High Risk",color:"#ef4444"}:{label:"Critical",color:"#7f1d1d"})(f?.qanadli_score);return v.jsxs("div",{className:J.container,children:[v.jsx("div",{className:J.header,children:v.jsxs("div",{className:J.headerContent,children:[v.jsxs("div",{children:[v.jsxs("h2",{className:J.title,children:["TEP Study #",t.id]}),v.jsxs("p",{className:J.subtitle,children:["Patient ID: ",t.patient_id||"N/A","  Pulmonary Embolism Analysis"]})]}),v.jsxs("span",{className:`${J.statusBadge} ${w}`,children:[v.jsx(ps,{className:"w-4 h-4"}),t.status]}),v.jsx("button",{onClick:d,className:J.deleteButton,title:"Delete study",children:v.jsx(eu,{className:"h-4 w-4"})})]})}),t.logs&&t.logs.length>0&&v.jsxs("div",{className:J.logsSection,children:[v.jsxs("h3",{className:J.sectionTitle,children:[v.jsx($g,{className:"w-5 h-5"}),"Processing Logs"]}),v.jsx("div",{className:J.logsContainer,children:t.logs.map(E=>v.jsxs("div",{className:`${J.logItem} ${E.level==="ERROR"?J.logError:E.level==="WARNING"?J.logWarning:J.logInfo}`,children:[v.jsx("span",{className:J.logTime,children:new Date(E.timestamp).toLocaleTimeString()}),v.jsx("span",{className:J.logMessage,children:E.message})]},E.id))})]}),t.status==="FAILED"&&t.error_message&&v.jsx("div",{className:J.actionSection,children:v.jsxs("div",{className:J.errorBanner,children:[v.jsxs("div",{className:J.errorContent,children:[v.jsx(Qs,{className:"w-5 h-5"}),v.jsxs("div",{children:[v.jsx("strong",{children:"Processing Failed:"})," ",t.error_message]})]}),v.jsxs("button",{onClick:h,disabled:l,className:J.processButton,style:{backgroundColor:"#dc2626"},children:[v.jsx(es,{className:"w-4 h-4"}),l?"Retrying...":"Retry Analysis"]})]})}),t.status==="UPLOADED"&&v.jsx("div",{className:J.actionSection,children:v.jsxs("button",{onClick:h,disabled:l,className:J.processButton,style:{backgroundColor:"#dc2626"},children:[v.jsx(es,{className:"w-4 h-4"}),l?"Starting Analysis...":"Start TEP Analysis"]})}),t.status==="COMPLETED"&&v.jsx("div",{className:J.actionSection,children:v.jsxs("button",{onClick:h,disabled:l,className:J.reprocessButton,style:{borderColor:"#dc2626",color:"#dc2626"},children:[v.jsx(es,{className:"h-4 w-4"}),l?"Reprocessing...":"Reprocess Study"]})}),t.status==="COMPLETED"&&f&&v.jsxs("div",{className:J.resultsSection,children:[v.jsx("h3",{className:J.sectionTitle,children:"TEP Analysis Results"}),v.jsxs("div",{className:J.metricCard,style:{marginBottom:"1.5rem",padding:"2rem",textAlign:"center",borderLeft:`4px solid ${C.color}`},children:[v.jsx("div",{className:J.metricLabel,children:"Qanadli Score"}),v.jsxs("div",{className:J.metricValue,style:{fontSize:"3rem",color:C.color},children:[f.qanadli_score?.toFixed(1)||"N/A",v.jsx("span",{className:J.metricUnit,children:"/40"})]}),v.jsx("div",{style:{display:"inline-block",padding:"0.25rem 1rem",borderRadius:"9999px",backgroundColor:C.color,color:"white",fontWeight:600,marginTop:"0.5rem"},children:C.label}),f.contrast_quality&&v.jsxs("div",{className:J.metricDescription,style:{marginTop:"1rem"},children:["Contrast Quality: ",v.jsx("strong",{children:f.contrast_quality})]})]}),v.jsxs("div",{className:J.metricsGrid,children:[v.jsxs("div",{className:J.metricCard,children:[v.jsx("div",{className:J.metricLabel,children:"Total Obstruction"}),v.jsxs("div",{className:J.metricValue,style:{color:f.total_obstruction_pct&&f.total_obstruction_pct>50?"#dc2626":"#059669"},children:[f.total_obstruction_pct?.toFixed(1)||"N/A",v.jsx("span",{className:J.metricUnit,children:"%"})]}),v.jsx("div",{className:J.metricDescription,children:"Percentage of PA tree affected"})]}),v.jsxs("div",{className:J.metricCard,children:[v.jsx("div",{className:J.metricLabel,children:"Detected Clots"}),v.jsx("div",{className:J.metricValue,children:f.clot_count??"N/A"}),v.jsx("div",{className:J.metricDescription,children:"Number of filling defects"})]}),v.jsxs("div",{className:J.metricCard,children:[v.jsx("div",{className:J.metricLabel,children:"Total Clot Volume"}),v.jsxs("div",{className:J.metricValue,children:[f.total_clot_volume?.toFixed(2)||"N/A",v.jsx("span",{className:J.metricUnit,children:"cm"})]}),v.jsx("div",{className:J.metricDescription,children:"Combined thrombus volume"})]}),v.jsxs("div",{className:J.metricCard,children:[v.jsx("div",{className:J.metricLabel,children:"PA Volume"}),v.jsxs("div",{className:J.metricValue,children:[f.pulmonary_artery_volume?.toFixed(2)||"N/A",v.jsx("span",{className:J.metricUnit,children:"cm"})]}),v.jsx("div",{className:J.metricDescription,children:"Segmented pulmonary artery"})]})]}),v.jsxs("div",{className:J.metricsGrid,style:{marginTop:"1.5rem"},children:[v.jsxs("div",{className:J.metricCard,children:[v.jsx("div",{className:J.metricLabel,children:"Main PA Obstruction"}),v.jsxs("div",{className:J.metricValue,style:{color:f.main_pa_obstruction_pct&&f.main_pa_obstruction_pct>50?"#dc2626":"#059669"},children:[f.main_pa_obstruction_pct?.toFixed(1)||"N/A",v.jsx("span",{className:J.metricUnit,children:"%"})]})]}),v.jsxs("div",{className:J.metricCard,children:[v.jsx("div",{className:J.metricLabel,children:"Left PA Obstruction"}),v.jsxs("div",{className:J.metricValue,style:{color:f.left_pa_obstruction_pct&&f.left_pa_obstruction_pct>50?"#dc2626":"#059669"},children:[f.left_pa_obstruction_pct?.toFixed(1)||"N/A",v.jsx("span",{className:J.metricUnit,children:"%"})]})]}),v.jsxs("div",{className:J.metricCard,children:[v.jsx("div",{className:J.metricLabel,children:"Right PA Obstruction"}),v.jsxs("div",{className:J.metricValue,style:{color:f.right_pa_obstruction_pct&&f.right_pa_obstruction_pct>50?"#dc2626":"#059669"},children:[f.right_pa_obstruction_pct?.toFixed(1)||"N/A",v.jsx("span",{className:J.metricUnit,children:"%"})]})]})]}),p&&v.jsxs("div",{className:J.visualizationSection,children:[v.jsx(Dj,{heatmapUrl:p,sourceUrl:b||void 0,thrombusUrl:g||void 0,paUrl:y||void 0,roiUrl:x||void 0,title:"TEP Analysis - 3D Visualization"}),v.jsxs("div",{className:J.colorLegend,children:[v.jsxs("div",{className:J.legendItem,children:[v.jsx("div",{className:J.legendColor,style:{backgroundColor:"#06b6d4"}}),v.jsx("span",{children:"ROI (Analysis Region)"})]}),v.jsxs("div",{className:J.legendItem,children:[v.jsx("div",{className:`${J.legendColor} ${J.legendRed}`}),v.jsx("span",{children:"Thrombus/Filling Defects"})]}),v.jsxs("div",{className:J.legendItem,children:[v.jsx("div",{className:J.legendColor,style:{backgroundColor:"#22c55e"}}),v.jsx("span",{children:"Patent Pulmonary Arteries"})]}),v.jsxs("div",{className:J.legendItem,children:[v.jsx("div",{className:J.legendColor,style:{backgroundColor:"#6b7280"}}),v.jsx("span",{children:"CT Volume (Base)"})]})]}),v.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"12px",marginTop:"16px"},children:[v.jsxs("a",{href:p,download:!0,className:J.downloadButton,style:{backgroundColor:"#dc2626"},children:[v.jsx(Do,{className:"h-4 w-4"}),"Download Heatmap (.nii.gz)"]}),g&&v.jsxs("a",{href:g,download:!0,className:J.downloadButton,style:{backgroundColor:"#7f1d1d"},children:[v.jsx(Do,{className:"h-4 w-4"}),"Thrombus Mask"]}),y&&v.jsxs("a",{href:y,download:!0,className:J.downloadButton,style:{backgroundColor:"#166534"},children:[v.jsx(Do,{className:"h-4 w-4"}),"PA Mask"]})]})]}),t.status==="COMPLETED"&&i&&v.jsx("div",{className:J.visualizationSection,style:{marginTop:"1.5rem"},children:v.jsx(f9,{studyId:i,slicesMeta:f?.slices_meta,findingsPins:f?.findings_pins})}),v.jsxs("div",{className:J.metricCard,style:{marginTop:"1.5rem",backgroundColor:"#fffbeb",borderLeft:"4px solid #f59e0b",textAlign:"left"},children:[v.jsx("h4",{style:{color:"#b45309",marginBottom:"0.5rem",fontSize:"1rem"},children:" Clinical Note"}),v.jsx("p",{style:{color:"#92400e",lineHeight:"1.6",margin:0,fontSize:"0.875rem"},children:"This automated analysis is intended as a decision support tool and should not replace clinical judgment. All findings should be correlated with patient symptoms, clinical history, and reviewed by a qualified radiologist. The Qanadli score provides a standardized assessment of clot burden but may not capture all clinically significant findings."})]})]})]})},p9=({study:i,patientInfo:e})=>{const t=r=>{try{return new Date(r).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return r}},n=r=>{if(!r)return null;try{const a=new Date(r),l=new Date;let c=l.getFullYear()-a.getFullYear();const h=l.getMonth()-a.getMonth();return(h<0||h===0&&l.getDate()<a.getDate())&&c--,c}catch{return null}},s=e?.age??n(e?.birthDate);return v.jsxs("div",{className:"clinical-card",children:[v.jsxs("div",{className:"clinical-card-header",children:[v.jsx("span",{children:" Informacin del Paciente"}),v.jsx("span",{className:"font-mono",children:t(i.study_date)})]}),v.jsx("div",{className:"clinical-card-body",children:v.jsxs("div",{className:"patient-info",children:[v.jsx("div",{className:"patient-id",children:i.patient_id||"Sin ID"}),e?.name&&v.jsxs("div",{className:"patient-field",children:[v.jsx("span",{className:"patient-field-label",children:"Nombre"}),v.jsx("span",{className:"patient-field-value",children:e.name})]}),v.jsxs("div",{className:"patient-field",children:[v.jsx("span",{className:"patient-field-label",children:"Edad / Sexo"}),v.jsxs("span",{className:"patient-field-value",children:[s?`${s} aos`:"--",e?.sex&&` / ${e.sex==="M"?"Masculino":e.sex==="F"?"Femenino":"Otro"}`]})]}),v.jsxs("div",{className:"patient-field",children:[v.jsx("span",{className:"patient-field-label",children:"Fecha de Estudio"}),v.jsx("span",{className:"patient-field-value",children:t(i.study_date)})]}),i.dicom_file_count&&v.jsxs("div",{className:"patient-field",children:[v.jsx("span",{className:"patient-field-label",children:"Archivos DICOM"}),v.jsxs("span",{className:"patient-field-value",children:[i.dicom_file_count," imgenes"]})]}),v.jsxs("div",{className:"patient-field",children:[v.jsx("span",{className:"patient-field-label",children:"ID Estudio"}),v.jsxs("span",{className:"patient-field-value font-mono truncate",title:String(i.id),children:[String(i.id).substring(0,8),"..."]})]}),e?.chiefComplaint&&v.jsxs("div",{className:"patient-field",style:{flexDirection:"column",gap:"4px"},children:[v.jsx("span",{className:"patient-field-label",children:"Motivo de Consulta"}),v.jsx("span",{className:"patient-field-value",style:{fontWeight:400},children:e.chiefComplaint})]}),e?.clinicalHistory&&v.jsxs("div",{className:"patient-field",style:{flexDirection:"column",gap:"4px"},children:[v.jsx("span",{className:"patient-field-label",children:"Historia Clnica"}),v.jsx("span",{className:"patient-field-value",style:{fontWeight:400,fontSize:"0.8rem"},children:e.clinicalHistory})]})]})})]})},ow={MRI_DKI:{badge:"MRI",label:"Resonancia Magntica",description:"Difusin / DKI - Anlisis Tensorial",cssClass:"mri"},CT_SMART:{badge:"CT",label:"Tomografa Computarizada",description:"Cerebro - Anlisis de Isquemia",cssClass:"ct"},CT_TEP:{badge:"TEP",label:"Angiotomografa Pulmonar",description:"Trax - Tromboembolismo Pulmonar",cssClass:"tep"},AUTO:{badge:"?",label:"Deteccin Automtica",description:"Analizando modalidad...",cssClass:"ct"},UNKNOWN:{badge:"?",label:"Modalidad Desconocida",description:"No se pudo determinar la modalidad",cssClass:"ct"}},g9=({modality:i,detectedModality:e,classificationConfidence:t,classificationDetails:n})=>{const r=ow[e||i]||ow.UNKNOWN,a=t??0,l=Math.round(a*100);let c=r.description;return n&&(n.body_part&&(c=`${n.body_part} - ${c}`),n.has_contrast&&(c+=" (con contraste)")),v.jsxs("div",{className:"clinical-card",children:[v.jsxs("div",{className:"clinical-card-header",children:[v.jsx("span",{children:" Modalidad Detectada"}),i==="AUTO"&&e&&v.jsx("span",{style:{color:"var(--ws-success)",fontSize:"0.7rem"},children:" Auto-detectada"})]}),v.jsxs("div",{className:"modality-indicator",children:[v.jsx("div",{className:`modality-badge ${r.cssClass}`,children:r.badge}),v.jsxs("div",{className:"modality-info",children:[v.jsx("div",{className:"modality-type",children:r.label}),v.jsx("div",{className:"modality-description",children:c}),t!==void 0&&v.jsxs("div",{className:"modality-confidence",children:[v.jsx("span",{children:"Confianza:"}),v.jsx("div",{className:"confidence-bar",children:v.jsx("div",{className:"confidence-fill",style:{width:`${l}%`,background:a>=.8?"var(--ws-success)":a>=.5?"var(--ws-warning)":"var(--ws-error)"}})}),v.jsxs("span",{style:{minWidth:"40px",textAlign:"right"},children:[l,"%"]})]})]})]}),n&&v.jsx("div",{style:{padding:"0 var(--ws-space-md) var(--ws-space-md)"},children:v.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--ws-text-muted)",display:"grid",gap:"4px"},children:[n.study_description&&v.jsxs("div",{children:[v.jsx("span",{style:{opacity:.7},children:"Descripcin: "}),v.jsx("span",{style:{color:"var(--ws-text-secondary)"},children:n.study_description})]}),n.series_description&&v.jsxs("div",{children:[v.jsx("span",{style:{opacity:.7},children:"Serie: "}),v.jsx("span",{style:{color:"var(--ws-text-secondary)"},children:n.series_description})]}),n.is_diffusion&&v.jsxs("div",{style:{color:"var(--ws-modality-mri)"},children:[" Secuencia de Difusin detectada",n.b_values_found&&n.b_values_found.length>0&&v.jsxs("span",{style:{marginLeft:"8px",opacity:.8},children:["(b-values:"," ",n.b_values_found.join(", "),")"]})]}),n.warning&&v.jsxs("div",{style:{color:"var(--ws-warning)"},children:[" ",n.warning]})]})})]})},A9=["Disnea sbita","Dolor torcico pleurtico","Hemoptisis","Sncope","Taquicardia","Taquipnea","Edema de MMII","Signos de TVP"],v9=({modality:i,bodyRegion:e,pathologyType:t,onContextChange:n})=>{const[s,r]=V.useState({}),a=d=>{const f={...s,...d};r(f),n?.(f)},l=i==="CT_TEP"||e==="THORAX"&&t==="TEP",c=i==="CT_SMART"||e==="BRAIN"&&t==="ISCHEMIA",h=i==="MRI_DKI"||t==="DIFFUSION";return!l&&!c&&!h?null:v.jsxs("div",{className:"clinical-card",children:[v.jsxs("div",{className:"clinical-card-header",children:[v.jsxs("span",{children:[l&&" Contexto TEP",c&&" Contexto Isquemia",h&&!c&&" Contexto Difusin"]}),v.jsx("span",{style:{fontSize:"0.65rem",padding:"2px 6px",background:"var(--ws-bg-primary)",borderRadius:"4px"},children:t})]}),v.jsxs("div",{className:"clinical-card-body",children:[l&&v.jsxs("div",{className:`pathology-context ${t.toLowerCase()}`,children:[v.jsxs("div",{className:"pathology-title",children:[v.jsx("span",{style:{color:"var(--ws-error)"},children:""}),"Tromboembolismo Pulmonar"]}),v.jsxs("div",{className:"pathology-fields",children:[v.jsxs("div",{className:"pathology-field",children:[v.jsx("label",{children:"Dmero-D (ng/mL)"}),v.jsx("input",{type:"number",placeholder:"< 500 = Normal",value:s.dDimer||"",onChange:d=>a({dDimer:parseFloat(d.target.value)||void 0}),style:{borderColor:s.dDimer&&s.dDimer>=500?"var(--ws-error)":void 0}})]}),v.jsxs("div",{className:"pathology-field",children:[v.jsx("label",{children:"Score de Wells"}),v.jsxs("select",{value:s.wellsScore??"",onChange:d=>a({wellsScore:parseInt(d.target.value)||void 0}),children:[v.jsx("option",{value:"",children:"Seleccionar..."}),v.jsx("option",{value:"0",children:"0-1 (Bajo)"}),v.jsx("option",{value:"2",children:"2-6 (Moderado)"}),v.jsx("option",{value:"7",children:"7 (Alto)"})]})]}),v.jsxs("div",{className:"pathology-field",children:[v.jsx("label",{children:"Saturacin O (%)"}),v.jsx("input",{type:"number",placeholder:"SpO2",min:"0",max:"100",value:s.oxygenSaturation||"",onChange:d=>a({oxygenSaturation:parseFloat(d.target.value)||void 0}),style:{borderColor:s.oxygenSaturation&&s.oxygenSaturation<92?"var(--ws-error)":void 0}})]}),v.jsxs("div",{className:"pathology-field",style:{gridColumn:"1 / -1"},children:[v.jsx("label",{children:"Sntomas Presentes"}),v.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"4px",marginTop:"4px"},children:A9.map(d=>v.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"0.75rem",color:"var(--ws-text-secondary)",cursor:"pointer"},children:[v.jsx("input",{type:"checkbox",checked:s.symptoms?.includes(d)||!1,onChange:f=>{const p=s.symptoms||[];f.target.checked?a({symptoms:[...p,d]}):a({symptoms:p.filter(g=>g!==d)})}}),d]},d))})]})]})]}),c&&v.jsxs("div",{className:"pathology-context ischemia",children:[v.jsxs("div",{className:"pathology-title",children:[v.jsx("span",{style:{color:"var(--ws-warning)"},children:""}),"Isquemia Cerebral Aguda"]}),v.jsxs("div",{className:"pathology-fields",children:[v.jsxs("div",{className:"pathology-field",children:[v.jsx("label",{children:"Score NIHSS"}),v.jsx("input",{type:"number",placeholder:"0-42",min:"0",max:"42",value:s.nihssScore??"",onChange:d=>a({nihssScore:parseInt(d.target.value)||void 0}),style:{borderColor:s.nihssScore&&s.nihssScore>=16?"var(--ws-error)":s.nihssScore&&s.nihssScore>=6?"var(--ws-warning)":void 0}})]}),v.jsxs("div",{className:"pathology-field",children:[v.jsx("label",{children:"Inicio de Sntomas"}),v.jsx("input",{type:"datetime-local",value:s.symptomOnset||"",onChange:d=>a({symptomOnset:d.target.value})})]}),v.jsxs("div",{className:"pathology-field",children:[v.jsx("label",{children:"ltima vez Normal"}),v.jsx("input",{type:"datetime-local",value:s.lastKnownWell||"",onChange:d=>a({lastKnownWell:d.target.value})})]}),v.jsxs("div",{className:"pathology-field",children:[v.jsx("label",{children:"Candidato a tPA"}),v.jsxs("select",{value:s.tpaCandidate===void 0?"":s.tpaCandidate.toString(),onChange:d=>a({tpaCandidate:d.target.value===""?void 0:d.target.value==="true"}),children:[v.jsx("option",{value:"",children:"Evaluar..."}),v.jsx("option",{value:"true",children:"S - Dentro de ventana"}),v.jsx("option",{value:"false",children:"No - Contraindicado"})]})]}),s.symptomOnset&&v.jsx(y9,{symptomOnset:s.symptomOnset})]})]}),h&&!c&&v.jsxs("div",{className:"pathology-context diffusion",children:[v.jsxs("div",{className:"pathology-title",children:[v.jsx("span",{style:{color:"var(--ws-modality-mri)"},children:""}),"Anlisis Tensorial de Difusin"]}),v.jsxs("div",{className:"pathology-fields",children:[v.jsxs("div",{className:"pathology-field",style:{gridColumn:"1 / -1"},children:[v.jsx("label",{children:"Indicacin Clnica"}),v.jsxs("select",{value:s.clinicalIndication||"",onChange:d=>a({clinicalIndication:d.target.value}),children:[v.jsx("option",{value:"",children:"Seleccionar..."}),v.jsx("option",{value:"tumor",children:"Caracterizacin tumoral"}),v.jsx("option",{value:"stroke",children:"ACV / Isquemia"}),v.jsx("option",{value:"dementia",children:"Demencia / Neurodegeneracin"}),v.jsx("option",{value:"ms",children:"Esclerosis Mltiple"}),v.jsx("option",{value:"tbi",children:"Trauma Craneoenceflico"}),v.jsx("option",{value:"other",children:"Otro"})]})]}),v.jsxs("div",{className:"pathology-field",style:{gridColumn:"1 / -1"},children:[v.jsx("label",{children:"Estudios Previos"}),v.jsx("input",{type:"text",placeholder:"Fechas o notas de estudios previos",value:s.previousStudies||"",onChange:d=>a({previousStudies:d.target.value})})]})]})]})]})]})},y9=({symptomOnset:i})=>{const e=new Date(i),n=(new Date().getTime()-e.getTime())/(1e3*60*60);let s,r;return n<=4.5?(s="safe",r=`${n.toFixed(1)}h - Ventana tPA abierta`):n<=6?(s="warning",r=`${n.toFixed(1)}h - Evaluar trombectoma`):n<=24?(s="warning",r=`${n.toFixed(1)}h - Ventana extendida posible`):(s="critical",r=`${n.toFixed(1)}h - Fuera de ventana teraputica`),v.jsxs("div",{style:{gridColumn:"1 / -1",padding:"8px",borderRadius:"4px",background:s==="safe"?"rgba(34, 197, 94, 0.15)":s==="warning"?"rgba(245, 158, 11, 0.15)":"rgba(239, 68, 68, 0.15)",borderLeft:`3px solid ${s==="safe"?"var(--ws-success)":s==="warning"?"var(--ws-warning)":"var(--ws-error)"}`,fontSize:"0.8rem",color:"var(--ws-text-primary)"},children:[" ",r]})},Vi=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Ag=[.001,0,0,.001,0,0],N0=1.35,fn={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},ms={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Uc="pdfjs_internal_editor_",qe={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},ot={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},w4={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Ri={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Dc={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},$t={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},So={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},ou={ERRORS:0,WARNINGS:1,INFOS:5},jo={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Yh={moveTo:0,lineTo:1,curveTo:2,closePath:3},S4={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let vf=ou.WARNINGS;function x9(i){Number.isInteger(i)&&(vf=i)}function b9(){return vf}function yf(i){vf>=ou.INFOS&&console.info(`Info: ${i}`)}function Xe(i){vf>=ou.WARNINGS&&console.warn(`Warning: ${i}`)}function Nt(i){throw new Error(i)}function ut(i,e){i||Nt(e)}function w9(i){switch(i?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function O1(i,e=null,t=null){if(!i)return null;if(t&&typeof i=="string"&&(t.addDefaultProtocol&&i.startsWith("www.")&&i.match(/\./g)?.length>=2&&(i=`http://${i}`),t.tryConvertEncoding))try{i=M9(i)}catch{}const n=e?URL.parse(i,e):URL.parse(i);return w9(n)?n:null}function U1(i,e,t=!1){const n=URL.parse(i);return n?(n.hash=e,n.href):t&&O1(i,"http://example.com")?i.split("#",1)[0]+`${e?`#${e}`:""}`:""}function Je(i,e,t,n=!1){return Object.defineProperty(i,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}const Da=(function(){function e(t,n){this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e})();class lw extends Da{constructor(e,t){super(e,"PasswordException"),this.code=t}}class I0 extends Da{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class Vd extends Da{constructor(e){super(e,"InvalidPDFException")}}class Vc extends Da{constructor(e,t,n){super(e,"ResponseException"),this.status=t,this.missing=n}}class S9 extends Da{constructor(e){super(e,"FormatError")}}class Zs extends Da{constructor(e){super(e,"AbortException")}}function C4(i){(typeof i!="object"||i?.length===void 0)&&Nt("Invalid argument for bytesToString");const e=i.length,t=8192;if(e<t)return String.fromCharCode.apply(null,i);const n=[];for(let s=0;s<e;s+=t){const r=Math.min(s+t,e),a=i.subarray(s,r);n.push(String.fromCharCode.apply(null,a))}return n.join("")}function lu(i){typeof i!="string"&&Nt("Invalid argument for stringToBytes");const e=i.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=i.charCodeAt(n)&255;return t}function C9(i){return String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,i&255)}function E9(){const i=new Uint8Array(4);return i[0]=1,new Uint32Array(i.buffer,0,1)[0]===1}function T9(){try{return new Function(""),!0}catch{return!1}}class vi{static get isLittleEndian(){return Je(this,"isLittleEndian",E9())}static get isEvalSupported(){return Je(this,"isEvalSupported",T9())}static get isOffscreenCanvasSupported(){return Je(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Je(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return Je(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){return Je(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const _0=Array.from(Array(256).keys(),i=>i.toString(16).padStart(2,"0"));class Ce{static makeHexColor(e,t,n){return`#${_0[e]}${_0[t]}${_0[n]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,n=0){const s=e[n],r=e[n+1];e[n]=s*t[0]+r*t[2]+t[4],e[n+1]=s*t[1]+r*t[3]+t[5]}static applyTransformToBezier(e,t,n=0){const s=t[0],r=t[1],a=t[2],l=t[3],c=t[4],h=t[5];for(let d=0;d<6;d+=2){const f=e[n+d],p=e[n+d+1];e[n+d]=f*s+p*a+c,e[n+d+1]=f*r+p*l+h}}static applyInverseTransform(e,t){const n=e[0],s=e[1],r=t[0]*t[3]-t[1]*t[2];e[0]=(n*t[3]-s*t[2]+t[2]*t[5]-t[4]*t[3])/r,e[1]=(-n*t[1]+s*t[0]+t[4]*t[1]-t[5]*t[0])/r}static axialAlignedBoundingBox(e,t,n){const s=t[0],r=t[1],a=t[2],l=t[3],c=t[4],h=t[5],d=e[0],f=e[1],p=e[2],g=e[3];let y=s*d+c,x=y,b=s*p+c,w=b,S=l*f+h,C=S,E=l*g+h,D=E;if(r!==0||a!==0){const M=r*d,N=r*p,I=a*f,_=a*g;y+=I,w+=I,b+=_,x+=_,S+=M,D+=M,E+=N,C+=N}n[0]=Math.min(n[0],y,b,x,w),n[1]=Math.min(n[1],S,E,C,D),n[2]=Math.max(n[2],y,b,x,w),n[3]=Math.max(n[3],S,E,C,D)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const n=e[0],s=e[1],r=e[2],a=e[3],l=n**2+s**2,c=n*r+s*a,h=r**2+a**2,d=(l+h)/2,f=Math.sqrt(d**2-(l*h-c**2));t[0]=Math.sqrt(d+f||1),t[1]=Math.sqrt(d-f||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),s=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>s)return null;const r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>a?null:[n,r,s,a]}static pointBoundingBox(e,t,n){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}static rectBoundingBox(e,t,n,s,r){r[0]=Math.min(r[0],e,n),r[1]=Math.min(r[1],t,s),r[2]=Math.max(r[2],e,n),r[3]=Math.max(r[3],t,s)}static#e(e,t,n,s,r,a,l,c,h,d){if(h<=0||h>=1)return;const f=1-h,p=h*h,g=p*h,y=f*(f*(f*e+3*h*t)+3*p*n)+g*s,x=f*(f*(f*r+3*h*a)+3*p*l)+g*c;d[0]=Math.min(d[0],y),d[1]=Math.min(d[1],x),d[2]=Math.max(d[2],y),d[3]=Math.max(d[3],x)}static#t(e,t,n,s,r,a,l,c,h,d,f,p){if(Math.abs(h)<1e-12){Math.abs(d)>=1e-12&&this.#e(e,t,n,s,r,a,l,c,-f/d,p);return}const g=d**2-4*f*h;if(g<0)return;const y=Math.sqrt(g),x=2*h;this.#e(e,t,n,s,r,a,l,c,(-d+y)/x,p),this.#e(e,t,n,s,r,a,l,c,(-d-y)/x,p)}static bezierBoundingBox(e,t,n,s,r,a,l,c,h){h[0]=Math.min(h[0],e,l),h[1]=Math.min(h[1],t,c),h[2]=Math.max(h[2],e,l),h[3]=Math.max(h[3],t,c),this.#t(e,n,r,l,t,s,a,c,3*(-e+3*(n-r)+l),6*(e-2*n+r),3*(n-e),h),this.#t(e,n,r,l,t,s,a,c,3*(-t+3*(s-a)+c),6*(t-2*s+a),3*(s-t),h)}}function M9(i){return decodeURIComponent(escape(i))}let F0=null,cw=null;function E4(i){return F0||(F0=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,cw=new Map([["","t"]])),i.replaceAll(F0,(e,t,n)=>t?t.normalize("NFKC"):cw.get(n))}function V1(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const i=new Uint8Array(32);return crypto.getRandomValues(i),C4(i)}const j1="pdfjs_internal_id_";function D9(i,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[n,s,...r]=t;if(!i(n)&&!Number.isInteger(n)||!e(s))return!1;const a=r.length;let l=!0;switch(s.name){case"XYZ":if(a<2||a>3)return!1;break;case"Fit":case"FitB":return a===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(a>1)return!1;break;case"FitR":if(a!==4)return!1;l=!1;break;default:return!1}for(const c of r)if(!(typeof c=="number"||l&&c===null))return!1;return!0}function ki(i,e,t){return Math.min(Math.max(i,e),t)}function T4(i){return Uint8Array.prototype.toBase64?i.toBase64():btoa(C4(i))}function R9(i){return Uint8Array.fromBase64?Uint8Array.fromBase64(i):lu(atob(i))}typeof Promise.try!="function"&&(Promise.try=function(i,...e){return new Promise(t=>{t(i(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(i){return i.reduce((e,t)=>e+t,0)});class jc{static textContent(e){const t=[],n={items:t,styles:Object.create(null)};function s(r){if(!r)return;let a=null;const l=r.name;if(l==="#text")a=r.value;else if(jc.shouldBuildText(l))r?.attributes?.textContent?a=r.attributes.textContent:r.value&&(a=r.value);else return;if(a!==null&&t.push({str:a}),!!r.children)for(const c of r.children)s(c)}return s(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}class z1{static setupStorage(e,t,n,s,r){const a=s.getValue(t,{value:null});switch(n.name){case"textarea":if(a.value!==null&&(e.textContent=a.value),r==="print")break;e.addEventListener("input",l=>{s.setValue(t,{value:l.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(a.value===n.attributes.xfaOn?e.setAttribute("checked",!0):a.value===n.attributes.xfaOff&&e.removeAttribute("checked"),r==="print")break;e.addEventListener("change",l=>{s.setValue(t,{value:l.target.checked?l.target.getAttribute("xfaOn"):l.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&e.setAttribute("value",a.value),r==="print")break;e.addEventListener("input",l=>{s.setValue(t,{value:l.target.value})})}break;case"select":if(a.value!==null){e.setAttribute("value",a.value);for(const l of n.children)l.attributes.value===a.value?l.attributes.selected=!0:l.attributes.hasOwnProperty("selected")&&delete l.attributes.selected}e.addEventListener("input",l=>{const c=l.target.options,h=c.selectedIndex===-1?"":c[c.selectedIndex].value;s.setValue(t,{value:h})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:s,linkService:r}){const{attributes:a}=t,l=e instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${s}`);for(const[c,h]of Object.entries(a))if(h!=null)switch(c){case"class":h.length&&e.setAttribute(c,h.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",h);break;case"style":Object.assign(e.style,h);break;case"textContent":e.textContent=h;break;default:(!l||c!=="href"&&c!=="newWindow")&&e.setAttribute(c,h)}l&&r.addLinkAttributes(e,a.href,a.newWindow),n&&a.dataId&&this.setupStorage(e,a.dataId,t,n)}static render(e){const t=e.annotationStorage,n=e.linkService,s=e.xfaHtml,r=e.intent||"display",a=document.createElement(s.name);s.attributes&&this.setAttributes({html:a,element:s,intent:r,linkService:n});const l=r!=="richText",c=e.div;if(c.append(a),e.viewport){const f=`matrix(${e.viewport.transform.join(",")})`;c.style.transform=f}l&&c.setAttribute("class","xfaLayer xfaFont");const h=[];if(s.children.length===0){if(s.value){const f=document.createTextNode(s.value);a.append(f),l&&jc.shouldBuildText(s.name)&&h.push(f)}return{textDivs:h}}const d=[[s,-1,a]];for(;d.length>0;){const[f,p,g]=d.at(-1);if(p+1===f.children.length){d.pop();continue}const y=f.children[++d.at(-1)[1]];if(y===null)continue;const{name:x}=y;if(x==="#text"){const w=document.createTextNode(y.value);h.push(w),g.append(w);continue}const b=y?.attributes?.xmlns?document.createElementNS(y.attributes.xmlns,x):document.createElement(x);if(g.append(b),y.attributes&&this.setAttributes({html:b,element:y,storage:t,intent:r,linkService:n}),y.children?.length>0)d.push([y,-1,b]);else if(y.value){const w=document.createTextNode(y.value);l&&jc.shouldBuildText(x)&&h.push(w),b.append(w)}}for(const f of c.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))f.setAttribute("readOnly",!0);return{textDivs:h}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Us="http://www.w3.org/2000/svg";class Ca{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function Jo(i,e="text"){if(Ac(i,document.baseURI)){const t=await fetch(i);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{const s=new XMLHttpRequest;s.open("GET",i,!0),s.responseType=e,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(s.response);return}t(s.responseText);return}n(new Error(s.statusText))}},s.send(null)})}class cu{constructor({viewBox:e,userUnit:t,scale:n,rotation:s,offsetX:r=0,offsetY:a=0,dontFlip:l=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=s,this.offsetX=r,this.offsetY=a,n*=t;const c=(e[2]+e[0])/2,h=(e[3]+e[1])/2;let d,f,p,g;switch(s%=360,s<0&&(s+=360),s){case 180:d=-1,f=0,p=0,g=1;break;case 90:d=0,f=1,p=1,g=0;break;case 270:d=0,f=-1,p=-1,g=0;break;case 0:d=1,f=0,p=0,g=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}l&&(p=-p,g=-g);let y,x,b,w;d===0?(y=Math.abs(h-e[1])*n+r,x=Math.abs(c-e[0])*n+a,b=(e[3]-e[1])*n,w=(e[2]-e[0])*n):(y=Math.abs(c-e[0])*n+r,x=Math.abs(h-e[1])*n+a,b=(e[2]-e[0])*n,w=(e[3]-e[1])*n),this.transform=[d*n,f*n,p*n,g*n,y-d*n*c-p*n*h,x-f*n*c-g*n*h],this.width=b,this.height=w}get rawDims(){const e=this.viewBox;return Je(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:s=this.offsetY,dontFlip:r=!1}={}){return new cu({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:s,dontFlip:r})}convertToViewportPoint(e,t){const n=[e,t];return Ce.applyTransform(n,this.transform),n}convertToViewportRectangle(e){const t=[e[0],e[1]];Ce.applyTransform(t,this.transform);const n=[e[2],e[3]];return Ce.applyTransform(n,this.transform),[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){const n=[e,t];return Ce.applyInverseTransform(n,this.transform),n}}class xf extends Da{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function uu(i){const e=i.length;let t=0;for(;t<e&&i[t].trim()==="";)t++;return i.substring(t,t+5).toLowerCase()==="data:"}function bf(i){return typeof i=="string"&&/\.pdf$/i.test(i)}function M4(i){return[i]=i.split(/[#?]/,1),i.substring(i.lastIndexOf("/")+1)}function D4(i,e="document.pdf"){if(typeof i!="string")return e;if(uu(i))return Xe('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const n=(l=>{try{return new URL(l)}catch{try{return new URL(decodeURIComponent(l))}catch{try{return new URL(l,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(l),"https://foo.bar")}catch{return null}}}}})(i);if(!n)return e;const s=l=>{try{let c=decodeURIComponent(l);return c.includes("/")?(c=c.split("/").at(-1),c.test(/^\.pdf$/i)?c:l):c}catch{return l}},r=/\.pdf$/i,a=n.pathname.split("/").at(-1);if(r.test(a))return s(a);if(n.searchParams.size>0){const l=Array.from(n.searchParams.values()).reverse();for(const h of l)if(r.test(h))return s(h);const c=Array.from(n.searchParams.keys()).reverse();for(const h of c)if(r.test(h))return s(h)}if(n.hash){const c=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(c)return s(c[0])}return e}class uw{started=Object.create(null);times=[];time(e){e in this.started&&Xe(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Xe(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:n}of this.times)t=Math.max(n.length,t);for(const{name:n,start:s,end:r}of this.times)e.push(`${n.padEnd(t)} ${r-s}ms
`);return e.join("")}}function Ac(i,e){const t=e?URL.parse(i,e):URL.parse(i);return t?.protocol==="http:"||t?.protocol==="https:"}function yn(i){i.preventDefault()}function Yt(i){i.preventDefault(),i.stopPropagation()}function N9(i){console.log("Deprecated API usage: "+i)}class jd{static#e;static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;this.#e||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const t=this.#e.exec(e);if(!t)return null;const n=parseInt(t[1],10);let s=parseInt(t[2],10);s=s>=1&&s<=12?s-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let l=parseInt(t[5],10);l=l>=0&&l<=59?l:0;let c=parseInt(t[6],10);c=c>=0&&c<=59?c:0;const h=t[7]||"Z";let d=parseInt(t[8],10);d=d>=0&&d<=23?d:0;let f=parseInt(t[9],10)||0;return f=f>=0&&f<=59?f:0,h==="-"?(a+=d,l+=f):h==="+"&&(a-=d,l-=f),new Date(Date.UTC(n,s,r,a,l,c))}}function R4(i,{scale:e=1,rotation:t=0}){const{width:n,height:s}=i.attributes.style,r=[0,0,parseInt(n),parseInt(s)];return new cu({viewBox:r,userUnit:1,scale:e,rotation:t})}function $o(i){if(i.startsWith("#")){const e=parseInt(i.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return i.startsWith("rgb(")?i.slice(4,-1).split(",").map(e=>parseInt(e)):i.startsWith("rgba(")?i.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Xe(`Not a valid color format: "${i}"`),[0,0,0])}function I9(i){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of i.keys()){e.style.color=t;const n=window.getComputedStyle(e).color;i.set(t,$o(n))}e.remove()}function Ht(i){const{a:e,b:t,c:n,d:s,e:r,f:a}=i.getTransform();return[e,t,n,s,r,a]}function ls(i){const{a:e,b:t,c:n,d:s,e:r,f:a}=i.getTransform().invertSelf();return[e,t,n,s,r,a]}function Or(i,e,t=!1,n=!0){if(e instanceof cu){const{pageWidth:s,pageHeight:r}=e.rawDims,{style:a}=i,l=vi.isCSSRoundSupported,c=`var(--total-scale-factor) * ${s}px`,h=`var(--total-scale-factor) * ${r}px`,d=l?`round(down, ${c}, var(--scale-round-x))`:`calc(${c})`,f=l?`round(down, ${h}, var(--scale-round-y))`:`calc(${h})`;!t||e.rotation%180===0?(a.width=d,a.height=f):(a.width=f,a.height=d)}n&&i.setAttribute("data-main-rotation",e.rotation)}class ts{constructor(){const{pixelRatio:e}=ts;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,n,s,r=-1){let a=1/0,l=1/0,c=1/0;n=ts.capPixels(n,r),n>0&&(a=Math.sqrt(n/(e*t))),s!==-1&&(l=s/e,c=s/t);const h=Math.min(a,l,c);return this.sx>h||this.sy>h?(this.sx=h,this.sy=h,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,n):n}return e}}const zd=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class _9{static get isDarkMode(){return Je(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class N4{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:n}=window.getComputedStyle(e);return e.remove(),Je(this,"commentForegroundColor",$o(n))}}function I4(i,e,t,n){n=Math.min(Math.max(n??1,0),1);const s=255*(1-n);return i=Math.round(i*n+s),e=Math.round(e*n+s),t=Math.round(t*n+s),[i,e,t]}function hw(i,e){const t=i[0]/255,n=i[1]/255,s=i[2]/255,r=Math.max(t,n,s),a=Math.min(t,n,s),l=(r+a)/2;if(r===a)e[0]=e[1]=0;else{const c=r-a;switch(e[1]=l<.5?c/(r+a):c/(2-r-a),r){case t:e[0]=((n-s)/c+(n<s?6:0))*60;break;case n:e[0]=((s-t)/c+2)*60;break;case s:e[0]=((t-n)/c+4)*60;break}}e[2]=l}function vg(i,e){const t=i[0],n=i[1],s=i[2],r=(1-Math.abs(2*s-1))*n,a=r*(1-Math.abs(t/60%2-1)),l=s-r/2;switch(Math.floor(t/60)){case 0:e[0]=r+l,e[1]=a+l,e[2]=l;break;case 1:e[0]=a+l,e[1]=r+l,e[2]=l;break;case 2:e[0]=l,e[1]=r+l,e[2]=a+l;break;case 3:e[0]=l,e[1]=a+l,e[2]=r+l;break;case 4:e[0]=a+l,e[1]=l,e[2]=r+l;break;case 5:case 6:e[0]=r+l,e[1]=l,e[2]=a+l;break}}function dw(i){return i<=.03928?i/12.92:((i+.055)/1.055)**2.4}function fw(i,e,t){vg(i,t),t.map(dw);const n=.2126*t[0]+.7152*t[1]+.0722*t[2];vg(e,t),t.map(dw);const s=.2126*t[0]+.7152*t[1]+.0722*t[2];return n>s?(n+.05)/(s+.05):(s+.05)/(n+.05)}const mw=new Map;function _4(i,e){const t=i[0]+i[1]*256+i[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let n=mw.get(t);if(n)return n;const s=new Float32Array(9),r=s.subarray(0,3),a=s.subarray(3,6);hw(i,a);const l=s.subarray(6,9);hw(e,l);const c=l[2]<.5,h=c?12:4.5;if(a[2]=c?Math.sqrt(a[2]):1-Math.sqrt(1-a[2]),fw(a,l,r)<h){let d,f;c?(d=a[2],f=1):(d=0,f=a[2]);const p=.005;for(;f-d>p;){const g=a[2]=(d+f)/2;c===fw(a,l,r)<h?d=g:f=g}a[2]=c?f:d}return vg(a,r),n=Ce.makeHexColor(Math.round(r[0]*255),Math.round(r[1]*255),Math.round(r[2]*255)),mw.set(t,n),n}function G1({html:i,dir:e,className:t},n){const s=document.createDocumentFragment();if(typeof i=="string"){const r=document.createElement("p");r.dir=e||"auto";const a=i.split(/(?:\r\n?|\n)/);for(let l=0,c=a.length;l<c;++l){const h=a[l];r.append(document.createTextNode(h)),l<c-1&&r.append(document.createElement("br"))}s.append(r)}else z1.render({xfaHtml:i,div:s,intent:"richText"});s.firstChild.classList.add("richText",t),n.append(s)}class Rc{#e=null;#t=null;#n;#i=null;#r=null;#s=null;#a=null;#o=null;static#c=null;constructor(e){this.#n=e,Rc.#c||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const e=this.#e=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=this.#n._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",yn,{signal:t}),e.addEventListener("pointerdown",Rc.#l,{signal:t}));const n=this.#i=document.createElement("div");n.className="buttons",e.append(n);const s=this.#n.toolbarPosition;if(s){const{style:r}=e,a=this.#n._uiManager.direction==="ltr"?1-s[0]:s[0];r.insetInlineEnd=`${100*a}%`,r.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return this.#e}static#l(e){e.stopPropagation()}#d(e){this.#n._focusEventsAllowed=!1,Yt(e)}#h(e){this.#n._focusEventsAllowed=!0,Yt(e)}#f(e){const t=this.#n._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",this.#d.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#h.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",yn,{signal:t}),!0)}hide(){this.#e.classList.add("hidden"),this.#t?.hideDropdown()}show(){this.#e.classList.remove("hidden"),this.#r?.shown(),this.#s?.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=this.#n,n=document.createElement("button");n.classList.add("basic","deleteButton"),n.tabIndex=0,n.setAttribute("data-l10n-id",Rc.#c[e]),this.#f(n)&&n.addEventListener("click",s=>{t.delete()},{signal:t._signal}),this.#i.append(n)}get#g(){const e=document.createElement("div");return e.className="divider",e}async addAltText(e){const t=await e.render();this.#f(t),this.#i.append(t,this.#g),this.#r=e}addComment(e,t=null){if(this.#s)return;const n=e.renderForToolbar();if(!n)return;this.#f(n);const s=this.#a=this.#g;t?(this.#i.insertBefore(n,t),this.#i.insertBefore(s,t)):this.#i.append(n,s),this.#s=e,e.toolbar=this}addColorPicker(e){if(this.#t)return;this.#t=e;const t=e.renderButton();this.#f(t),this.#i.append(t,this.#g)}async addEditSignatureButton(e){const t=this.#o=await e.renderEditButton(this.#n);this.#f(t),this.#i.append(t,this.#g)}removeButton(e){e==="comment"&&(this.#s?.removeToolbarCommentButton(),this.#s=null,this.#a?.remove(),this.#a=null)}async addButton(e,t){switch(e){case"colorPicker":this.addColorPicker(t);break;case"altText":await this.addAltText(t);break;case"editSignature":await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(t);break}}async addButtonBefore(e,t,n){const s=this.#i.querySelector(n);s&&e==="comment"&&this.addComment(t,s)}updateEditSignatureButton(e){this.#o&&(this.#o.title=e)}remove(){this.#e.remove(),this.#t?.destroy(),this.#t=null}}class F9{#e=null;#t=null;#n;constructor(e){this.#n=e}#i(){const e=this.#t=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar");const t=this.#n._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",yn,{signal:t});const n=this.#e=document.createElement("div");return n.className="buttons",e.append(n),this.#n.hasCommentManager()&&this.#s("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#n.commentSelection("floating_button")}),this.#s("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#n.highlightSelection("floating_button")}),e}#r(e,t){let n=0,s=0;for(const r of e){const a=r.y+r.height;if(a<n)continue;const l=r.x+(t?r.width:0);if(a>n){s=l,n=a;continue}t?l>s&&(s=l):l<s&&(s=l)}return[t?1-s:s,n]}show(e,t,n){const[s,r]=this.#r(t,n),{style:a}=this.#t||=this.#i();e.append(this.#t),a.insetInlineEnd=`${100*s}%`,a.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){this.#t.remove()}#s(e,t,n,s){const r=document.createElement("button");r.classList.add("basic",e),r.tabIndex=0,r.setAttribute("data-l10n-id",t);const a=document.createElement("span");r.append(a),a.className="visuallyHidden",a.setAttribute("data-l10n-id",n);const l=this.#n._signal;l instanceof AbortSignal&&!l.aborted&&(r.addEventListener("contextmenu",yn,{signal:l}),r.addEventListener("click",s,{signal:l})),this.#e.append(r)}}function F4(i,e,t){for(const n of t)e.addEventListener(n,i[n].bind(i))}class P9{#e=0;get id(){return`${Uc}${this.#e++}`}}class H1{#e=V1();#t=0;#n=null;static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=e;const r=s.decode().then(()=>(n.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return Je(this,"_isSVGFittingCanvas",r)}async#i(e,t){this.#n||=new Map;let n=this.#n.get(e);if(n===null)return null;if(n?.bitmap)return n.refCounter+=1,n;try{n||={bitmap:null,id:`image_${this.#e}_${this.#t++}`,refCounter:0,isSvg:!1};let s;if(typeof t=="string"?(n.url=t,s=await Jo(t,"blob")):t instanceof File?s=n.file=t:t instanceof Blob&&(s=t),s.type==="image/svg+xml"){const r=H1._isSVGFittingCanvas,a=new FileReader,l=new Image,c=new Promise((h,d)=>{l.onload=()=>{n.bitmap=l,n.isSvg=!0,h()},a.onload=async()=>{const f=n.svgUrl=a.result;l.src=await r?`${f}#svgView(preserveAspectRatio(none))`:f},l.onerror=a.onerror=d});a.readAsDataURL(s),await c}else n.bitmap=await createImageBitmap(s);n.refCounter=1}catch(s){Xe(s),n=null}return this.#n.set(e,n),n&&this.#n.set(n.id,n),n}async getFromFile(e){const{lastModified:t,name:n,size:s,type:r}=e;return this.#i(`${t}_${n}_${s}_${r}`,e)}async getFromUrl(e){return this.#i(e,e)}async getFromBlob(e,t){const n=await t;return this.#i(e,n)}async getFromId(e){this.#n||=new Map;const t=this.#n.get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:n}=t;return delete t.blobPromise,this.getFromBlob(t.id,n)}return this.getFromUrl(t.url)}getFromCanvas(e,t){this.#n||=new Map;let n=this.#n.get(e);if(n?.bitmap)return n.refCounter+=1,n;const s=new OffscreenCanvas(t.width,t.height);return s.getContext("2d").drawImage(t,0,0),n={bitmap:s.transferToImageBitmap(),id:`image_${this.#e}_${this.#t++}`,refCounter:1,isSvg:!1},this.#n.set(e,n),this.#n.set(n.id,n),n}getSvgUrl(e){const t=this.#n.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#n||=new Map;const t=this.#n.get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:n}=t;if(!t.url&&!t.file){const s=new OffscreenCanvas(n.width,n.height);s.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=s.convertToBlob()}n.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#e}_`)}}class B9{#e=[];#t=!1;#n;#i=-1;constructor(e=128){this.#n=e}add({cmd:e,undo:t,post:n,mustExec:s,type:r=NaN,overwriteIfSameType:a=!1,keepUndo:l=!1}){if(s&&e(),this.#t)return;const c={cmd:e,undo:t,post:n,type:r};if(this.#i===-1){this.#e.length>0&&(this.#e.length=0),this.#i=0,this.#e.push(c);return}if(a&&this.#e[this.#i].type===r){l&&(c.undo=this.#e[this.#i].undo),this.#e[this.#i]=c;return}const h=this.#i+1;h===this.#n?this.#e.splice(0,1):(this.#i=h,h<this.#e.length&&this.#e.splice(h)),this.#e.push(c)}undo(){if(this.#i===-1)return;this.#t=!0;const{undo:e,post:t}=this.#e[this.#i];e(),t?.(),this.#t=!1,this.#i-=1}redo(){if(this.#i<this.#e.length-1){this.#i+=1,this.#t=!0;const{cmd:e,post:t}=this.#e[this.#i];e(),t?.(),this.#t=!1}}hasSomethingToUndo(){return this.#i!==-1}hasSomethingToRedo(){return this.#i<this.#e.length-1}cleanType(e){if(this.#i!==-1){for(let t=this.#i;t>=0;t--)if(this.#e[t].type!==e){this.#e.splice(t+1,this.#i-t),this.#i=t;return}this.#e.length=0,this.#i=-1}}destroy(){this.#e=null}}class hu{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=vi.platform;for(const[n,s,r={}]of e)for(const a of n){const l=a.startsWith("mac+");t&&l?(this.callbacks.set(a.slice(4),{callback:s,options:r}),this.allKeys.add(a.split("+").at(-1))):!t&&!l&&(this.callbacks.set(a,{callback:s,options:r}),this.allKeys.add(a.split("+").at(-1)))}}#e(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;const n=this.callbacks.get(this.#e(t));if(!n)return;const{callback:s,options:{bubbles:r=!1,args:a=[],checker:l=null}}=n;l&&!l(e,t)||(s.bind(e,...a,t)(),r||Yt(t))}}class Y1{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return I9(e),Je(this,"_colors",e)}convert(e){const t=$o(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[n,s]of this._colors)if(s.every((r,a)=>r===t[a]))return Y1._colorsMapping.get(n);return t}getHexCode(e){const t=this._colors.get(e);return t?Ce.makeHexColor(...t):e}}class Js{#e=new AbortController;#t=null;#n=null;#i=new Map;#r=new Map;#s=null;#a=null;#o=null;#c=new B9;#l=null;#d=null;#h=null;#f=0;#g=new Set;#m=null;#u=null;#p=new Set;_editorUndoBar=null;#A=!1;#y=!1;#v=!1;#E=null;#S=null;#x=null;#M=null;#w=!1;#C=null;#N=new P9;#D=!1;#R=!1;#k=!1;#_=null;#P=null;#O=null;#B=null;#H=null;#T=qe.NONE;#b=new Set;#F=null;#U=null;#j=null;#X=null;#q=null;#W={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#z=[0,0];#L=null;#Y=null;#J=null;#$=null;#V=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=Js.prototype,t=a=>a.#Y.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),n=(a,{target:l})=>{if(l instanceof HTMLInputElement){const{type:c}=l;return c!=="text"&&c!=="number"}return!0},s=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return Je(this,"_keyboardManager",new hu([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(a,{target:l})=>!(l instanceof HTMLButtonElement)&&a.#Y.contains(l)&&!a.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(a,{target:l})=>!(l instanceof HTMLButtonElement)&&a.#Y.contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}]]))}constructor(e,t,n,s,r,a,l,c,h,d,f,p,g,y,x,b){const w=this._signal=this.#e.signal;this.#Y=e,this.#J=t,this.#$=n,this.#s=s,this.#l=r,this.#U=a,this.#q=c,this._eventBus=l,l._on("editingaction",this.onEditingAction.bind(this),{signal:w}),l._on("pagechanging",this.onPageChanging.bind(this),{signal:w}),l._on("scalechanging",this.onScaleChanging.bind(this),{signal:w}),l._on("rotationchanging",this.onRotationChanging.bind(this),{signal:w}),l._on("setpreference",this.onSetPreference.bind(this),{signal:w}),l._on("switchannotationeditorparams",S=>this.updateParams(S.type,S.value),{signal:w}),window.addEventListener("pointerdown",()=>{this.#R=!0},{capture:!0,signal:w}),window.addEventListener("pointerup",()=>{this.#R=!1},{capture:!0,signal:w}),this.#le(),this.#de(),this.#te(),this.#a=c.annotationStorage,this.#E=c.filterFactory,this.#j=h,this.#M=d||null,this.#A=f,this.#y=p,this.#v=g,this.#H=y||null,this.viewParameters={realScale:Ca.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=x||null,this._supportsPinchToZoom=b!==!1,r?.setSidebarUiManager(this)}destroy(){this.#V?.resolve(),this.#V=null,this.#e?.abort(),this.#e=null,this._signal=null;for(const e of this.#r.values())e.destroy();this.#r.clear(),this.#i.clear(),this.#p.clear(),this.#B?.clear(),this.#t=null,this.#b.clear(),this.#c.destroy(),this.#s?.destroy(),this.#l?.destroy(),this.#U?.destroy(),this.#C?.hide(),this.#C=null,this.#O?.destroy(),this.#O=null,this.#n=null,this.#S&&(clearTimeout(this.#S),this.#S=null),this.#L&&(clearTimeout(this.#L),this.#L=null),this._editorUndoBar?.destroy(),this.#q=null}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return this.#H}get useNewAltTextFlow(){return this.#y}get useNewAltTextWhenAddingImage(){return this.#v}get hcmFilter(){return Je(this,"hcmFilter",this.#j?this.#E.addHCMFilter(this.#j.foreground,this.#j.background):"none")}get direction(){return Je(this,"direction",getComputedStyle(this.#Y).direction)}get _highlightColors(){return Je(this,"_highlightColors",this.#M?new Map(this.#M.split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return Je(this,"highlightColors",null);const t=new Map,n=!!this.#j;for(const[s,r]of e){const a=s.endsWith("_HCM");if(n&&a){t.set(s.replace("_HCM",""),r);continue}!n&&!a&&t.set(s,r)}return Je(this,"highlightColors",t)}get highlightColorNames(){return Je(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#h=e}setMainHighlightColorPicker(e){this.#O=e}editAltText(e,t=!1){this.#s?.editAltText(this,e,t)}hasCommentManager(){return!!this.#l}editComment(e,t,n,s){this.#l?.showDialog(this,e,t,n,s)}selectComment(e,t){this.#r.get(e)?.getEditorByUID(t)?.toggleComment(!0,!0)}updateComment(e){this.#l?.updateComment(e.getData())}updatePopupColor(e){this.#l?.updatePopupColor(e)}removeComment(e){this.#l?.removeComments([e.uid])}toggleComment(e,t,n=void 0){this.#l?.toggleCommentPopup(e,t,n)}makeCommentColor(e,t){return e&&this.#l?.makeCommentColor(e,t)||null}getCommentDialogElement(){return this.#l?.dialogElement||null}async waitForEditorsRendered(e){if(this.#r.has(e-1))return;const{resolve:t,promise:n}=Promise.withResolvers(),s=r=>{r.pageNumber===e&&(this._eventBus._off("editorsrendered",s),t())};this._eventBus.on("editorsrendered",s),await n}getSignature(e){this.#U?.getSignature({uiManager:this,editor:e})}get signatureManager(){return this.#U}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){e==="enableNewAltTextWhenAddingImage"&&(this.#v=t)}onPageChanging({pageNumber:e}){this.#f=e-1}focusMainContainer(){this.#Y.focus()}findParent(e,t){for(const n of this.#r.values()){const{x:s,y:r,width:a,height:l}=n.div.getBoundingClientRect();if(e>=s&&e<=s+a&&t>=r&&t<=r+l)return n}return null}disableUserSelect(e=!1){this.#J.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#p.add(e)}removeShouldRescale(e){this.#p.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*Ca.PDF_TO_CSS_UNITS;for(const t of this.#p)t.onScaleChanging();this.#h?.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}#Z({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e}#ee(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const n of this.#r.values())if(n.hasTextLayer(e))return n;return null}highlightSelection(e="",t=!1){const n=document.getSelection();if(!n||n.isCollapsed)return;const{anchorNode:s,anchorOffset:r,focusNode:a,focusOffset:l}=n,c=n.toString(),d=this.#Z(n).closest(".textLayer"),f=this.getSelectionBoxes(d);if(!f)return;n.empty();const p=this.#ee(d),g=this.#T===qe.NONE,y=()=>{const x=p?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:f,anchorNode:s,anchorOffset:r,focusNode:a,focusOffset:l,text:c});g&&this.showAllEditors("highlight",!0,!0),t&&x?.editComment()};if(g){this.switchToMode(qe.HIGHLIGHT,y);return}y()}commentSelection(e=""){this.highlightSelection(e,!0)}#ae(){const e=document.getSelection();if(!e||e.isCollapsed)return;const n=this.#Z(e).closest(".textLayer"),s=this.getSelectionBoxes(n);s&&(this.#C||=new F9(this),this.#C.show(n,s,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(e){if(!this.#a)return null;const t=`${Uc}${e}`,n=this.#a.getRawValue(t);return n&&this.#a.remove(t),n}addToAnnotationStorage(e){!e.isEmpty()&&this.#a&&!this.#a.has(e.id)&&this.#a.setValue(e.id,e)}a11yAlert(e,t=null){const n=this.#$;n&&(n.setAttribute("data-l10n-id",e),t?n.setAttribute("data-l10n-args",JSON.stringify(t)):n.removeAttribute("data-l10n-args"))}#oe(){const e=document.getSelection();if(!e||e.isCollapsed){this.#F&&(this.#C?.hide(),this.#F=null,this.#I({hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===this.#F)return;const s=this.#Z(e).closest(".textLayer");if(!s){this.#F&&(this.#C?.hide(),this.#F=null,this.#I({hasSelectedText:!1}));return}if(this.#C?.hide(),this.#F=t,this.#I({hasSelectedText:!0}),!(this.#T!==qe.HIGHLIGHT&&this.#T!==qe.NONE)&&(this.#T===qe.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#w=this.isShiftKeyDown,!this.isShiftKeyDown)){const r=this.#T===qe.HIGHLIGHT?this.#ee(s):null;if(r?.toggleDrawing(),this.#R){const a=new AbortController,l=this.combinedSignal(a),c=h=>{h.type==="pointerup"&&h.button!==0||(a.abort(),r?.toggleDrawing(!0),h.type==="pointerup"&&this.#K("main_toolbar"))};window.addEventListener("pointerup",c,{signal:l}),window.addEventListener("blur",c,{signal:l})}else r?.toggleDrawing(!0),this.#K("main_toolbar")}}#K(e=""){this.#T===qe.HIGHLIGHT?this.highlightSelection(e):this.#A&&this.#ae()}#le(){document.addEventListener("selectionchange",this.#oe.bind(this),{signal:this._signal})}#ce(){if(this.#x)return;this.#x=new AbortController;const e=this.combinedSignal(this.#x);window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})}#ue(){this.#x?.abort(),this.#x=null}blur(){if(this.isShiftKeyDown=!1,this.#w&&(this.#w=!1,this.#K("main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of this.#b)if(t.div.contains(e)){this.#P=[t,e],t._focusEventsAllowed=!1;break}}focus(){if(!this.#P)return;const[e,t]=this.#P;this.#P=null,t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}#te(){if(this.#_)return;this.#_=new AbortController;const e=this.combinedSignal(this.#_);window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})}#he(){this.#_?.abort(),this.#_=null}#ie(){if(this.#d)return;this.#d=new AbortController;const e=this.combinedSignal(this.#d);document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})}#ne(){this.#d?.abort(),this.#d=null}#de(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}addEditListeners(){this.#te(),this.#ie()}removeEditListeners(){this.#he(),this.#ne()}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const n of this.#u)if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const n of this.#u)if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){if(e.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const t=[];for(const n of this.#b){const s=n.serialize(!0);s&&t.push(s)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const r of t.items)for(const a of this.#u)if(a.isHandlingMimeForPasting(r.type)){a.paste(r,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(r){Xe(`paste: "${r.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const s=this.currentLayer;try{const r=[];for(const c of n){const h=await s.deserialize(c);if(!h)return;r.push(h)}const a=()=>{for(const c of r)this.#se(c);this.#re(r)},l=()=>{for(const c of r)c.remove()};this.addCommands({cmd:a,undo:l,mustExec:!0})}catch(r){Xe(`paste: "${r.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),this.#T!==qe.NONE&&!this.isEditorHandlingKeyboard&&Js._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,this.#w&&(this.#w=!1,this.#K("main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#I(e){Object.entries(e).some(([n,s])=>this.#W[n]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#W,e)}),this.#T===qe.HIGHLIGHT&&e.hasSelectedEditor===!1&&this.#G([[ot.HIGHLIGHT_FREE,!0]]))}#G(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#ce(),this.#ie(),this.#I({isEditing:this.#T!==qe.NONE,isEmpty:this.#Q(),hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:this.#c.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#ue(),this.#ne(),this.#I({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#u){this.#u=e;for(const t of this.#u)this.#G(t.defaultPropertiesToUpdate)}}getId(){return this.#N.id}get currentLayer(){return this.#r.get(this.#f)}getLayer(e){return this.#r.get(e)}get currentPageIndex(){return this.#f}addLayer(e){this.#r.set(e.pageIndex,e),this.#D?e.enable():e.disable()}removeLayer(e){this.#r.delete(e.pageIndex)}async updateMode(e,t=null,n=!1,s=!1,r=!1){if(this.#T!==e&&!(this.#V&&(await this.#V.promise,!this.#V))){if(this.#V=Promise.withResolvers(),this.#h?.commitOrRemove(),this.#T===qe.POPUP&&this.#l?.hideSidebar(),this.#l?.destroyPopup(),this.#T=e,e===qe.NONE){this.setEditingState(!1),this.#me();for(const a of this.#i.values())a.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#V.resolve();return}for(const a of this.#i.values())a.addStandaloneCommentButton();e===qe.SIGNATURE&&await this.#U?.loadSignatures(),this.setEditingState(!0),await this.#fe(),this.unselectAll();for(const a of this.#r.values())a.updateMode(e);if(e===qe.POPUP){this.#n||=await this.#q.getAnnotationsByType(new Set(this.#u.map(c=>c._editorType)));const a=new Set,l=[];for(const c of this.#i.values()){const{annotationElementId:h,hasComment:d,deleted:f}=c;h&&a.add(h),d&&!f&&l.push(c.getData())}for(const c of this.#n){const{id:h,popupRef:d,contentsObj:f}=c;d&&f?.str&&!a.has(h)&&!this.#g.has(h)&&l.push(c)}this.#l?.showSidebar(l)}if(!t){n&&this.addNewEditorFromKeyboard(),this.#V.resolve();return}for(const a of this.#i.values())a.uid===t?(this.setSelected(a),r?a.editComment():s?a.enterInEditMode():a.focus()):a.unselect();this.#V.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==this.#T&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(this.#u){switch(e){case ot.CREATE:this.currentLayer.addNewEditor(t);return;case ot.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#X||=new Map).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const n of this.#b)n.updateParams(e,t);else for(const n of this.#u)n.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){for(const r of this.#i.values())r.editorType===e&&r.show(t);(this.#X?.get(ot.HIGHLIGHT_SHOW_ALL)??!0)!==t&&this.#G([[ot.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(this.#k!==e){this.#k=e;for(const t of this.#r.values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}async#fe(){if(!this.#D){this.#D=!0;const e=[];for(const t of this.#r.values())e.push(t.enable());await Promise.all(e);for(const t of this.#i.values())t.enable()}}#me(){if(this.unselectAll(),this.#D){this.#D=!1;for(const e of this.#r.values())e.disable();for(const e of this.#i.values())e.disable()}}*getEditors(e){for(const t of this.#i.values())t.pageIndex===e&&(yield t)}getEditor(e){return this.#i.get(e)}addEditor(e){this.#i.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#S&&clearTimeout(this.#S),this.#S=setTimeout(()=>{this.focusMainContainer(),this.#S=null},0)),this.#i.delete(e.id),e.annotationElementId&&this.#B?.delete(e.annotationElementId),this.unselect(e),(!e.annotationElementId||!this.#g.has(e.annotationElementId))&&this.#a?.remove(e.id)}addDeletedAnnotationElement(e){this.#g.add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return this.#g.has(e)}removeDeletedAnnotationElement(e){this.#g.delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}#se(e){const t=this.#r.get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}setActiveEditor(e){this.#t!==e&&(this.#t=e,e&&this.#G(e.propertiesToUpdate))}get#pe(){let e=null;for(e of this.#b);return e}updateUI(e){this.#pe===e&&this.#G(e.propertiesToUpdate)}updateUIForDefaultProperties(e){this.#G(e.defaultPropertiesToUpdate)}toggleSelected(e){if(this.#b.has(e)){this.#b.delete(e),e.unselect(),this.#I({hasSelectedEditor:this.hasSelection});return}this.#b.add(e),e.select(),this.#G(e.propertiesToUpdate),this.#I({hasSelectedEditor:!0})}setSelected(e){this.updateToolbar({mode:e.mode,editId:e.id}),this.#h?.commitOrRemove();for(const t of this.#b)t!==e&&t.unselect();this.#b.clear(),this.#b.add(e),e.select(),this.#G(e.propertiesToUpdate),this.#I({hasSelectedEditor:!0})}isSelected(e){return this.#b.has(e)}get firstSelectedEditor(){return this.#b.values().next().value}unselect(e){e.unselect(),this.#b.delete(e),this.#I({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#b.size!==0}get isEnterHandled(){return this.#b.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#c.undo(),this.#I({hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#Q()}),this._editorUndoBar?.hide()}redo(){this.#c.redo(),this.#I({hasSomethingToUndo:!0,hasSomethingToRedo:this.#c.hasSomethingToRedo(),isEmpty:this.#Q()})}addCommands(e){this.#c.add(e),this.#I({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#Q()})}cleanUndoStack(e){this.#c.cleanType(e)}#Q(){if(this.#i.size===0)return!0;if(this.#i.size===1)for(const e of this.#i.values())return e.isEmpty();return!1}delete(){this.commitOrRemove();const e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...this.#b],n=()=>{this._editorUndoBar?.show(s,t.length===1?t[0].editorType:t.length);for(const r of t)r.remove()},s=()=>{for(const r of t)this.#se(r)};this.addCommands({cmd:n,undo:s,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#re(e){for(const t of this.#b)t.unselect();this.#b.clear();for(const t of e)t.isEmpty()||(this.#b.add(t),t.select());this.#I({hasSelectedEditor:this.hasSelection})}selectAll(){for(const e of this.#b)e.commit();this.#re(this.#i.values())}unselectAll(){if(!(this.#t&&(this.#t.commitOrRemove(),this.#T!==qe.NONE))&&!this.#h?.commitOrRemove()&&this.hasSelection){for(const e of this.#b)e.unselect();this.#b.clear(),this.#I({hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;this.#z[0]+=e,this.#z[1]+=t;const[s,r]=this.#z,a=[...this.#b],l=1e3;this.#L&&clearTimeout(this.#L),this.#L=setTimeout(()=>{this.#L=null,this.#z[0]=this.#z[1]=0,this.addCommands({cmd:()=>{for(const c of a)this.#i.has(c.id)&&(c.translateInPage(s,r),c.translationDone())},undo:()=>{for(const c of a)this.#i.has(c.id)&&(c.translateInPage(-s,-r),c.translationDone())},mustExec:!1})},l);for(const c of a)c.translateInPage(e,t),c.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#m=new Map;for(const e of this.#b)this.#m.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#m)return!1;this.disableUserSelect(!1);const e=this.#m;this.#m=null;let t=!1;for(const[{x:s,y:r,pageIndex:a},l]of e)l.newX=s,l.newY=r,l.newPageIndex=a,t||=s!==l.savedX||r!==l.savedY||a!==l.savedPageIndex;if(!t)return!1;const n=(s,r,a,l)=>{if(this.#i.has(s.id)){const c=this.#r.get(l);c?s._setParentAndPosition(c,r,a):(s.pageIndex=l,s.x=r,s.y=a)}};return this.addCommands({cmd:()=>{for(const[s,{newX:r,newY:a,newPageIndex:l}]of e)n(s,r,a,l)},undo:()=>{for(const[s,{savedX:r,savedY:a,savedPageIndex:l}]of e)n(s,r,a,l)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(this.#m)for(const n of this.#m.keys())n.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#b.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#t===e}getActive(){return this.#t}getMode(){return this.#T}isEditingMode(){return this.#T!==qe.NONE}get imageManager(){return Je(this,"imageManager",new H1)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let h=0,d=t.rangeCount;h<d;h++)if(!e.contains(t.getRangeAt(h).commonAncestorContainer))return null;const{x:n,y:s,width:r,height:a}=e.getBoundingClientRect();let l;switch(e.getAttribute("data-main-rotation")){case"90":l=(h,d,f,p)=>({x:(d-s)/a,y:1-(h+f-n)/r,width:p/a,height:f/r});break;case"180":l=(h,d,f,p)=>({x:1-(h+f-n)/r,y:1-(d+p-s)/a,width:f/r,height:p/a});break;case"270":l=(h,d,f,p)=>({x:1-(d+p-s)/a,y:(h-n)/r,width:p/a,height:f/r});break;default:l=(h,d,f,p)=>({x:(h-n)/r,y:(d-s)/a,width:f/r,height:p/a});break}const c=[];for(let h=0,d=t.rangeCount;h<d;h++){const f=t.getRangeAt(h);if(!f.collapsed)for(const{x:p,y:g,width:y,height:x}of f.getClientRects())y===0||x===0||c.push(l(p,g,y,x))}return c.length===0?null:c}addChangedExistingAnnotation({annotationElementId:e,id:t}){(this.#o||=new Map).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){this.#o?.delete(e)}renderAnnotationElement(e){const t=this.#o?.get(e.data.id);if(!t)return;const n=this.#a.getRawValue(t);n&&(this.#T===qe.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}setMissingCanvas(e,t,n){const s=this.#B?.get(e);s&&(s.setCanvas(t,n),this.#B.delete(e))}addMissingCanvas(e,t){(this.#B||=new Map).set(e,t)}}class ds{#e=null;#t=!1;#n=null;#i=null;#r=null;#s=null;#a=!1;#o=null;#c=null;#l=null;#d=null;#h=!1;static#f=null;static _l10n=null;constructor(e){this.#c=e,this.#h=e._uiManager.useNewAltTextFlow,ds.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(e){ds._l10n??=e}async render(){const e=this.#n=document.createElement("button");e.className="altText",e.tabIndex="0";const t=this.#i=document.createElement("span");e.append(t),this.#h?(e.classList.add("new"),e.setAttribute("data-l10n-id",ds.#f.missing),t.setAttribute("data-l10n-id",ds.#f["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=this.#c._uiManager._signal;e.addEventListener("contextmenu",yn,{signal:n}),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:n});const s=r=>{r.preventDefault(),this.#c._uiManager.editAltText(this.#c),this.#h&&this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#g}})};return e.addEventListener("click",s,{capture:!0,signal:n}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(this.#a=!0,s(r))},{signal:n}),await this.#m(),e}get#g(){return this.#e&&"added"||this.#e===null&&this.guessedText&&"review"||"missing"}finish(){this.#n&&(this.#n.focus({focusVisible:this.#a}),this.#a=!1)}isEmpty(){return this.#h?this.#e===null:!this.#e&&!this.#t}hasData(){return this.#h?this.#e!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}async setGuessedText(e){this.#e===null&&(this.#l=e,this.#d=await ds._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e}),this.#m())}toggleAltTextBadge(e=!1){if(!this.#h||this.#e){this.#o?.remove(),this.#o=null;return}if(!this.#o){const t=this.#o=document.createElement("div");t.className="noAltTextBadge",this.#c.div.append(t)}this.#o.classList.toggle("hidden",!e)}serialize(e){let t=this.#e;return!e&&this.#l===t&&(t=this.#d),{altText:t,decorative:this.#t,guessedText:this.#l,textWithDisclaimer:this.#d}}get data(){return{altText:this.#e,decorative:this.#t}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:s,cancel:r=!1}){n&&(this.#l=n,this.#d=s),!(this.#e===e&&this.#t===t)&&(r||(this.#e=e,this.#t=t),this.#m())}toggle(e=!1){this.#n&&(!e&&this.#s&&(clearTimeout(this.#s),this.#s=null),this.#n.disabled=!e)}shown(){this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#g}})}destroy(){this.#n?.remove(),this.#n=null,this.#i=null,this.#r=null,this.#o?.remove(),this.#o=null}async#m(){const e=this.#n;if(!e)return;if(this.#h){if(e.classList.toggle("done",!!this.#e),e.setAttribute("data-l10n-id",ds.#f[this.#g]),this.#i?.setAttribute("data-l10n-id",ds.#f[`${this.#g}-label`]),!this.#e){this.#r?.remove();return}}else{if(!this.#e&&!this.#t){e.classList.remove("done"),this.#r?.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=this.#r;if(!t){this.#r=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${this.#c.id}`;const s=100,r=this.#c._uiManager._signal;r.addEventListener("abort",()=>{clearTimeout(this.#s),this.#s=null},{once:!0}),e.addEventListener("mouseenter",()=>{this.#s=setTimeout(()=>{this.#s=null,this.#r.classList.add("show"),this.#c._reportTelemetry({action:"alt_text_tooltip"})},s)},{signal:r}),e.addEventListener("mouseleave",()=>{this.#s&&(clearTimeout(this.#s),this.#s=null),this.#r?.classList.remove("show")},{signal:r})}this.#t?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=this.#e),t.parentNode||e.append(t),this.#c.getElementForAltText()?.setAttribute("aria-describedby",t.id)}}class qh{#e=null;#t=null;#n=!1;#i=null;#r=null;#s=null;#a=null;#o=null;#c=!1;#l=null;constructor(e){this.#i=e}renderForToolbar(){const e=this.#t=document.createElement("button");return e.className="comment",this.#d(e,!1)}renderForStandalone(){const e=this.#e=document.createElement("button");e.className="annotationCommentButton";const t=this.#i.commentButtonPosition;if(t){const{style:n}=e;n.insetInlineEnd=`calc(${100*(this.#i._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,n.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const s=this.#i.commentButtonColor;s&&(n.backgroundColor=s)}return this.#d(e,!0)}focusButton(){setTimeout(()=>{(this.#e??this.#t)?.focus()},0)}onUpdatedColor(){if(!this.#e)return;const e=this.#i.commentButtonColor;e&&(this.#e.style.backgroundColor=e),this.#i._uiManager.updatePopupColor(this.#i)}get commentButtonWidth(){return(this.#e?.getBoundingClientRect().width??0)/this.#i.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#l)return this.#l;if(!this.#e)return null;const{x:e,y:t,height:n}=this.#e.getBoundingClientRect(),{x:s,y:r,width:a,height:l}=this.#i.parent.boundingClientRect;return[(e-s)/a,(t+n-r)/l]}set commentPopupPositionInLayer(e){this.#l=e}hasDefaultPopupPosition(){return this.#l===null}removeStandaloneCommentButton(){this.#e?.remove(),this.#e=null}removeToolbarCommentButton(){this.#t?.remove(),this.#t=null}setCommentButtonStates({selected:e,hasPopup:t}){this.#e&&(this.#e.classList.toggle("selected",e),this.#e.ariaExpanded=t)}#d(e,t){if(!this.#i._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[this.#i._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button"));const n=this.#i._uiManager._signal;if(!(n instanceof AbortSignal)||n.aborted)return e;e.addEventListener("contextmenu",yn,{signal:n}),t&&(e.addEventListener("focusin",r=>{this.#i._focusEventsAllowed=!1,Yt(r)},{capture:!0,signal:n}),e.addEventListener("focusout",r=>{this.#i._focusEventsAllowed=!0,Yt(r)},{capture:!0,signal:n})),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:n});const s=r=>{r.preventDefault(),e===this.#t?this.edit():this.#i.toggleComment(!0)};return e.addEventListener("click",s,{capture:!0,signal:n}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(this.#n=!0,s(r))},{signal:n}),e.addEventListener("pointerenter",()=>{this.#i.toggleComment(!1,!0)},{signal:n}),e.addEventListener("pointerleave",()=>{this.#i.toggleComment(!1,!1)},{signal:n}),e}edit(e){const t=this.commentPopupPositionInLayer;let n,s;if(t)[n,s]=t;else{[n,s]=this.#i.commentButtonPosition;const{width:d,height:f,x:p,y:g}=this.#i;n=p+n*d,s=g+s*f}const r=this.#i.parent.boundingClientRect,{x:a,y:l,width:c,height:h}=r;this.#i._uiManager.editComment(this.#i,a+n*c,l+s*h,{...e,parentDimensions:r})}finish(){this.#t&&(this.#t.focus({focusVisible:this.#n}),this.#n=!1)}isDeleted(){return this.#c||this.#a===""}isEmpty(){return this.#a===null}hasBeenEdited(){return this.isDeleted()||this.#a!==this.#r}serialize(){return this.data}get data(){return{text:this.#a,richText:this.#s,date:this.#o,deleted:this.isDeleted()}}set data(e){if(e!==this.#a&&(this.#s=null),e===null){this.#a="",this.#c=!0;return}this.#a=e,this.#o=new Date,this.#c=!1}setInitialText(e,t=null){this.#r=e,this.data=e,this.#o=null,this.#s=t}shown(){}destroy(){this.#t?.remove(),this.#t=null,this.#e?.remove(),this.#e=null,this.#a="",this.#s=null,this.#o=null,this.#i=null,this.#n=!1,this.#c=!1}}class du{#e;#t=!1;#n=null;#i;#r;#s;#a;#o=null;#c;#l=null;#d;#h=null;constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:s=null,onPinching:r=null,onPinchEnd:a=null,signal:l}){this.#e=e,this.#n=n,this.#i=t,this.#r=s,this.#s=r,this.#a=a,this.#d=new AbortController,this.#c=AbortSignal.any([l,this.#d.signal]),e.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#c})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/ts.pixelRatio}#f(e){if(this.#i?.())return;if(e.touches.length===1){if(this.#o)return;const s=this.#o=new AbortController,r=AbortSignal.any([this.#c,s.signal]),a=this.#e,l={capture:!0,signal:r,passive:!1},c=h=>{h.pointerType==="touch"&&(this.#o?.abort(),this.#o=null)};a.addEventListener("pointerdown",h=>{h.pointerType==="touch"&&(Yt(h),c(h))},l),a.addEventListener("pointerup",c,l),a.addEventListener("pointercancel",c,l);return}if(!this.#h){this.#h=new AbortController;const s=AbortSignal.any([this.#c,this.#h.signal]),r=this.#e,a={signal:s,capture:!1,passive:!1};r.addEventListener("touchmove",this.#g.bind(this),a);const l=this.#m.bind(this);r.addEventListener("touchend",l,a),r.addEventListener("touchcancel",l,a),a.capture=!0,r.addEventListener("pointerdown",Yt,a),r.addEventListener("pointermove",Yt,a),r.addEventListener("pointercancel",Yt,a),r.addEventListener("pointerup",Yt,a),this.#r?.()}if(Yt(e),e.touches.length!==2||this.#n?.()){this.#l=null;return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),this.#l={touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY}}#g(e){if(!this.#l||e.touches.length!==2)return;Yt(e);let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);const{screenX:s,screenY:r}=t,{screenX:a,screenY:l}=n,c=this.#l,{touch0X:h,touch0Y:d,touch1X:f,touch1Y:p}=c,g=f-h,y=p-d,x=a-s,b=l-r,w=Math.hypot(x,b)||1,S=Math.hypot(g,y)||1;if(!this.#t&&Math.abs(S-w)<=du.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(c.touch0X=s,c.touch0Y=r,c.touch1X=a,c.touch1Y=l,!this.#t){this.#t=!0;return}const C=[(s+a)/2,(r+l)/2];this.#s?.(C,S,w)}#m(e){e.touches.length>=2||(this.#h&&(this.#h.abort(),this.#h=null,this.#a?.()),this.#l&&(Yt(e),this.#l=null,this.#t=!1))}destroy(){this.#d?.abort(),this.#d=null,this.#o?.abort(),this.#o=null}}class Fe{#e=null;#t=null;#n=null;#i=null;#r=null;#s=!1;#a=null;#o="";#c=null;#l=null;#d=null;#h=null;#f=null;#g="";#m=!1;#u=null;#p=!1;#A=!1;#y=!1;#v=null;#E=0;#S=0;#x=null;#M=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#w=!1;#C=Fe._zIndex++;static _borderLineWidth=-1;static _colorManager=new Y1;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const e=Fe.prototype._resizeWithKeyboard,t=Js.TRANSLATE_SMALL,n=Js.TRANSLATE_BIG;return Je(this,"_resizerKeyboardManager",new hu([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],Fe.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null;const{rotation:t,rawDims:{pageWidth:n,pageHeight:s,pageX:r,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,s],this.pageTranslation=[r,a];const[l,c]=this.parentDimensions;this.x=e.x/l,this.y=e.y/c,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return Je(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new L9({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(Fe._l10n??=e,Fe._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),Fe._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);Fe._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Nt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#w}set _isDraggable(e){this.#w=e,this.div?.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#C}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(this.#L(),this.#h?.remove(),this.#h=null),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#m?this.#m=!1:this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,s){const[r,a]=this.parentDimensions;[n,s]=this.screenToPageTranslation(n,s),this.x=(e+n)/r,this.y=(t+s)/a,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[n,s]=this.parentDimensions;this.setAt(e*n,t*s,this.width*n,this.height*s),this._onTranslated()}#N([e,t],n,s){[n,s]=this.screenToPageTranslation(n,s),this.x+=n/e,this.y+=s/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#N(this.parentDimensions,e,t)}translateInPage(e,t){this.#u||=[this.x,this.y,this.width,this.height],this.#N(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){this.#u||=[this.x,this.y,this.width,this.height];const{div:n,parentDimensions:[s,r]}=this;if(this.x+=e/s,this.y+=t/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:f,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,f,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:l}=this;const[c,h]=this.getBaseTranslation();a+=c,l+=h;const{style:d}=n;d.left=`${(100*a).toFixed(2)}%`,d.top=`${(100*l).toFixed(2)}%`,this._onTranslating(a,l),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#u&&(this.#u[0]!==this.x||this.#u[1]!==this.y)}get _hasBeenResized(){return!!this.#u&&(this.#u[2]!==this.width||this.#u[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:n}=Fe,s=n/e,r=n/t;switch(this.rotation){case 90:return[-s,r];case 180:return[s,r];case 270:return[s,-r];default:return[-s,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[n,s]}=this;let{x:r,y:a,width:l,height:c}=this;if(l*=n,c*=s,r*=n,a*=s,this._mustFixPosition)switch(e){case 0:r=ki(r,0,n-l),a=ki(a,0,s-c);break;case 90:r=ki(r,0,n-c),a=ki(a,l,s);break;case 180:r=ki(r,l,n),a=ki(a,c,s);break;case 270:r=ki(r,c,n),a=ki(a,0,s-l);break}this.x=r/=n,this.y=a/=s;const[h,d]=this.getBaseTranslation();r+=h,a+=d,t.left=`${(100*r).toFixed(2)}%`,t.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}static#D(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return Fe.#D(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return Fe.#D(e,t,360-this.parentRotation)}#R(e){switch(e){case 90:{const[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(){const{div:{style:e},width:t,height:n}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*n).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#k(){if(this.#c)return;this.#c=document.createElement("div"),this.#c.classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const n of e){const s=document.createElement("div");this.#c.append(s),s.classList.add("resizer",n),s.setAttribute("data-resizer-name",n),s.addEventListener("pointerdown",this.#_.bind(this,n),{signal:t}),s.addEventListener("contextmenu",yn,{signal:t}),s.tabIndex=-1}this.div.prepend(this.#c)}#_(e,t){t.preventDefault();const{isMac:n}=vi.platform;if(t.button!==0||t.ctrlKey&&n)return;this.#n?.toggle(!1);const s=this._isDraggable;this._isDraggable=!1,this.#l=[t.screenX,t.screenY];const r=new AbortController,a=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#B.bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",Yt,{passive:!1,signal:a}),window.addEventListener("contextmenu",yn,{signal:a}),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const l=this.parent.div.style.cursor,c=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const h=()=>{r.abort(),this.parent.togglePointerEvents(!0),this.#n?.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=l,this.div.style.cursor=c,this.#O()};window.addEventListener("pointerup",h,{signal:a}),window.addEventListener("blur",h,{signal:a})}#P(e,t,n,s){this.width=n,this.height=s,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#O(){if(!this.#d)return;const{savedX:e,savedY:t,savedWidth:n,savedHeight:s}=this.#d;this.#d=null;const r=this.x,a=this.y,l=this.width,c=this.height;r===e&&a===t&&l===n&&c===s||this.addCommands({cmd:this.#P.bind(this,r,a,l,c),undo:this.#P.bind(this,e,t,n,s),mustExec:!0})}static _round(e){return Math.round(e*1e4)/1e4}#B(e,t){const[n,s]=this.parentDimensions,r=this.x,a=this.y,l=this.width,c=this.height,h=Fe.MIN_SIZE/n,d=Fe.MIN_SIZE/s,f=this.#R(this.rotation),p=(U,H)=>[f[0]*U+f[2]*H,f[1]*U+f[3]*H],g=this.#R(360-this.rotation),y=(U,H)=>[g[0]*U+g[2]*H,g[1]*U+g[3]*H];let x,b,w=!1,S=!1;switch(e){case"topLeft":w=!0,x=(U,H)=>[0,0],b=(U,H)=>[U,H];break;case"topMiddle":x=(U,H)=>[U/2,0],b=(U,H)=>[U/2,H];break;case"topRight":w=!0,x=(U,H)=>[U,0],b=(U,H)=>[0,H];break;case"middleRight":S=!0,x=(U,H)=>[U,H/2],b=(U,H)=>[0,H/2];break;case"bottomRight":w=!0,x=(U,H)=>[U,H],b=(U,H)=>[0,0];break;case"bottomMiddle":x=(U,H)=>[U/2,H],b=(U,H)=>[U/2,0];break;case"bottomLeft":w=!0,x=(U,H)=>[0,H],b=(U,H)=>[U,0];break;case"middleLeft":S=!0,x=(U,H)=>[0,H/2],b=(U,H)=>[U,H/2];break}const C=x(l,c),E=b(l,c);let D=p(...E);const M=Fe._round(r+D[0]),N=Fe._round(a+D[1]);let I=1,_=1,F,B;if(t.fromKeyboard)({deltaX:F,deltaY:B}=t);else{const{screenX:U,screenY:H}=t,[Y,Q]=this.#l;[F,B]=this.screenToPageTranslation(U-Y,H-Q),this.#l[0]=U,this.#l[1]=H}if([F,B]=y(F/n,B/s),w){const U=Math.hypot(l,c);I=_=Math.max(Math.min(Math.hypot(E[0]-C[0]-F,E[1]-C[1]-B)/U,1/l,1/c),h/l,d/c)}else S?I=ki(Math.abs(E[0]-C[0]-F),h,1)/l:_=ki(Math.abs(E[1]-C[1]-B),d,1)/c;const P=Fe._round(l*I),O=Fe._round(c*_);D=p(...b(P,O));const k=M-D[0],q=N-D[1];this.#u||=[this.x,this.y,this.width,this.height],this.width=P,this.height=O,this.x=k,this.y=q,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#n?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#A)return this._editToolbar;this._editToolbar=new Rc(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,n]of e)await this._editToolbar.addButton(t,n);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#n?.destroy()}addContainer(e){const t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#n||(ds.initialize(Fe._l10n),this.#n=new ds(this),this.#e&&(this.#n.data=this.#e,this.#e=null)),this.#n}get altTextData(){return this.#n?.data}set altTextData(e){this.#n&&(this.#n.data=e)}get guessedAltText(){return this.#n?.guessedText}async setGuessedAltText(e){await this.#n?.setGuessedText(e)}serializeAltText(e){return this.#n?.serialize(e)}hasAltText(){return!!this.#n&&!this.#n.isEmpty()}hasAltTextData(){return this.#n?.hasData()??!1}focusCommentButton(){this.#i?.focusButton()}addCommentButton(){return this.#i||=new qh(this)}addStandaloneCommentButton(){if(this.#r){this._uiManager.isEditingMode()&&this.#r.classList.remove("hidden");return}this.hasComment&&(this.#r=this.#i.renderForStandalone(),this.div.append(this.#r))}removeStandaloneCommentButton(){this.#i.removeStandaloneCommentButton(),this.#r=null}hideStandaloneCommentButton(){this.#r?.classList.add("hidden")}get comment(){const{data:{richText:e,text:t,date:n,deleted:s}}=this.#i;return{text:t,richText:e,date:n,deleted:s,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){this.#i||=new qh(this),this.#i.data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:n}){if(!t||(this.#i||=new qh(this),this.#i.setInitialText(e,n),!this.annotationElementId))return;const s=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);s&&this.updateFromAnnotationLayer(s)}get hasEditedComment(){return this.#i?.hasBeenEdited()}get hasDeletedComment(){return this.#i?.isDeleted()}get hasComment(){return!!this.#i&&!this.#i.isEmpty()&&!this.#i.isDeleted()}async editComment(e){this.#i||=new qh(this),this.#i.edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){this.#i.setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,s]=e.rect,[r]=this.pageDimensions,[a]=this.pageTranslation,l=a+r+1,c=s-100,h=l+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[l,c,h,s]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){this.#i.data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=this.#s?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),this.#j();const[t,n]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*n/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/n).toFixed(2)}%`);const[s,r]=this.getInitialTranslation();return this.translate(s,r),F4(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#M||=new du({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#H.bind(this),onPinching:this.#T.bind(this),onPinchEnd:this.#b.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),e}#H(){this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#n?.toggle(!1),this.parent.togglePointerEvents(!1)}#T(e,t,n){let r=.7*(n/t)+1-.7;if(r===1)return;const a=this.#R(this.rotation),l=(M,N)=>[a[0]*M+a[2]*N,a[1]*M+a[3]*N],[c,h]=this.parentDimensions,d=this.x,f=this.y,p=this.width,g=this.height,y=Fe.MIN_SIZE/c,x=Fe.MIN_SIZE/h;r=Math.max(Math.min(r,1/p,1/g),y/p,x/g);const b=Fe._round(p*r),w=Fe._round(g*r);if(b===p&&w===g)return;this.#u||=[d,f,p,g];const S=l(p/2,g/2),C=Fe._round(d+S[0]),E=Fe._round(f+S[1]),D=l(b/2,w/2);this.x=C-D[0],this.y=E-D[1],this.width=b,this.height=w,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#b(){this.#n?.toggle(!0),this.parent.togglePointerEvents(!0),this.#O()}pointerdown(e){const{isMac:t}=vi.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(this.#m=!0,this._isDraggable){this.#U(e);return}this.#F(e)}#F(e){const{isMac:t}=vi.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#U(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1;const s=new AbortController,r=this._uiManager.combinedSignal(s),a={capture:!0,passive:!1,signal:r},l=h=>{s.abort(),this.#a=null,this.#m=!1,this._uiManager.endDragSession()||this.#F(h),n&&this._onStopDragging()};t&&(this.#E=e.clientX,this.#S=e.clientY,this.#a=e.pointerId,this.#o=e.pointerType,window.addEventListener("pointermove",h=>{n||(n=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:d,clientY:f,pointerId:p}=h;if(p!==this.#a){Yt(h);return}const[g,y]=this.screenToPageTranslation(d-this.#E,f-this.#S);this.#E=d,this.#S=f,this._uiManager.dragSelectedEditors(g,y)},a),window.addEventListener("touchmove",Yt,a),window.addEventListener("pointerdown",h=>{h.pointerType===this.#o&&(this.#M||h.isPrimary)&&l(h),Yt(h)},a));const c=h=>{if(!this.#a||this.#a===h.pointerId){l(h);return}Yt(h)};window.addEventListener("pointerup",c,{signal:r}),window.addEventListener("blur",c,{signal:r})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#v&&clearTimeout(this.#v),this.#v=setTimeout(()=>{this.#v=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){const s=this.parentScale,[r,a]=this.pageDimensions,[l,c]=this.pageTranslation,h=e/s,d=t/s,f=this.x*r,p=this.y*a,g=this.width*r,y=this.height*a;switch(n){case 0:return[f+h+l,a-p-d-y+c,f+h+g+l,a-p-d+c];case 90:return[f+d+l,a-p+h+c,f+d+y+l,a-p+h+g+c];case 180:return[f-h-g+l,a-p+d+c,f-h+l,a-p+d+y+c];case 270:return[f-d-y+l,a-p-h-g+c,f-d+l,a-p-h+c];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[n,s,r,a]=e,l=r-n,c=a-s;switch(this.rotation){case 0:return[n,t-a,l,c];case 90:return[n,t-s,c,l];case 180:return[r,t-s,l,c];case 270:return[r,t-a,c,l];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&Fe._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#i?.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:n,opacity:s,deleted:r,richText:a},uid:l,pageIndex:c,creationDate:h,modificationDate:d}=this;return{id:l,pageIndex:c,rect:this.getPDFRect(),richText:a,contentsObj:{str:e},creationDate:h,modificationDate:n||d,popupRef:!r,color:t,opacity:s}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#A=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#A=!1,!0):!1}isInEditMode(){return this.#A}shouldGetKeyboardEvents(){return this.#y}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:n,right:s}=this.getClientDimensions(),{innerHeight:r,innerWidth:a}=window;return t<a&&s>0&&e<r&&n>0}#j(){if(this.#f||!this.div)return;this.#f=new AbortController;const e=this._uiManager.combinedSignal(this.#f);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#j()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(e,t,n){const s=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});s.rotation=e.rotation,s.#e=e.accessibilityData,s._isCopy=e.isCopy||!1;const[r,a]=s.pageDimensions,[l,c,h,d]=s.getRectInCurrentCoords(e.rect,a);return s.x=l/r,s.y=c/a,s.width=h/r,s.height=d/a,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#f?.abort(),this.#f=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#v&&(clearTimeout(this.#v),this.#v=null),this.#L(),this.removeEditToolbar(),this.#x){for(const e of this.#x.values())clearTimeout(e);this.#x=null}this.parent=null,this.#M?.destroy(),this.#M=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#k(),this.#c.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[n,s,r,a]=this.getPDFRect();return[Fe._round(n+(r-n)*e),Fe._round(s+(a-s)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#i.commentPopupPositionInLayer}set commentPopupPosition(e){this.#i.commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return this.#i.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#i.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){this.#i.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const t=this.#c.children;if(!this.#t){this.#t=Array.from(t);const a=this.#X.bind(this),l=this.#q.bind(this),c=this._uiManager._signal;for(const h of this.#t){const d=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",a,{signal:c}),h.addEventListener("blur",l,{signal:c}),h.addEventListener("focus",this.#W.bind(this,d),{signal:c}),h.setAttribute("data-l10n-id",Fe._l10nResizer[d])}}const n=this.#t[0];let s=0;for(const a of t){if(a===n)break;s++}const r=(360-this.rotation+this.parentRotation)%360/90*(this.#t.length/4);if(r!==s){if(r<s)for(let l=0;l<s-r;l++)this.#c.append(this.#c.firstChild);else if(r>s)for(let l=0;l<r-s;l++)this.#c.firstChild.before(this.#c.lastChild);let a=0;for(const l of t){const h=this.#t[a++].getAttribute("data-resizer-name");l.setAttribute("data-l10n-id",Fe._l10nResizer[h])}}this.#z(0),this.#y=!0,this.#c.firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#X(e){Fe._resizerKeyboardManager.exec(this,e)}#q(e){this.#y&&e.relatedTarget?.parentNode!==this.#c&&this.#L()}#W(e){this.#g=this.#y?e:""}#z(e){if(this.#t)for(const t of this.#t)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#y&&this.#B(this.#g,{deltaX:e,deltaY:t,fromKeyboard:!0})}#L(){this.#y=!1,this.#z(-1),this.#O()}_stopResizingWithKeyboard(){this.#L(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#n?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#c?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#n?.toggleAltTextBadge(!0),this.hasComment&&this._uiManager.toggleComment(this,!1,!1))}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(e){this.#p=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){this.#x||=new Map;const{action:n}=e;let s=this.#x.get(n);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(e),this.#x.delete(n),this.#x.size===0&&(this.#x=null)},Fe._telemetryTimeout),this.#x.set(n,s);return}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#s=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#s=!0}updateFakeAnnotationElement(e){if(!this.#h&&!this.deleted){this.#h=e.addFakeAnnotation(this);return}if(this.deleted){this.#h.remove(),this.#h=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#h.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;t?.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}}class L9 extends Fe{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const pw=3285377520,Pn=4294901760,cs=65535;class P4{constructor(e){this.h1=e?e&4294967295:pw,this.h2=e?e&4294967295:pw}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let x=0,b=e.length;x<b;x++){const w=e.charCodeAt(x);w<=255?t[n++]=w:(t[n++]=w>>>8,t[n++]=w&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const s=n>>2,r=n-s*4,a=new Uint32Array(t.buffer,0,s);let l=0,c=0,h=this.h1,d=this.h2;const f=3432918353,p=461845907,g=f&cs,y=p&cs;for(let x=0;x<s;x++)x&1?(l=a[x],l=l*f&Pn|l*g&cs,l=l<<15|l>>>17,l=l*p&Pn|l*y&cs,h^=l,h=h<<13|h>>>19,h=h*5+3864292196):(c=a[x],c=c*f&Pn|c*g&cs,c=c<<15|c>>>17,c=c*p&Pn|c*y&cs,d^=c,d=d<<13|d>>>19,d=d*5+3864292196);switch(l=0,r){case 3:l^=t[s*4+2]<<16;case 2:l^=t[s*4+1]<<8;case 1:l^=t[s*4],l=l*f&Pn|l*g&cs,l=l<<15|l>>>17,l=l*p&Pn|l*y&cs,s&1?h^=l:d^=l}this.h1=h,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Pn|e*36045&cs,t=t*4283543511&Pn|((t<<16|e>>>16)*2950163797&Pn)>>>16,e^=t>>>1,e=e*444984403&Pn|e*60499&cs,t=t*3301882366&Pn|((t<<16|e>>>16)*3120437893&Pn)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const yg=Object.freeze({map:null,hash:"",transfer:void 0});class q1{#e=!1;#t=null;#n=null;#i=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const n=this.#i.get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return this.#i.get(e)}remove(e){const t=this.#i.get(e);if(t!==void 0&&(t instanceof Fe&&this.#n.delete(t.annotationElementId),this.#i.delete(e),this.#i.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const n of this.#i.values())if(n instanceof Fe)return;this.onAnnotationEditor(null)}}setValue(e,t){const n=this.#i.get(e);let s=!1;if(n!==void 0)for(const[r,a]of Object.entries(t))n[r]!==a&&(s=!0,n[r]=a);else s=!0,this.#i.set(e,t);s&&this.#r(),t instanceof Fe&&((this.#n||=new Map).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return this.#i.has(e)}get size(){return this.#i.size}#r(){this.#e||(this.#e=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#e&&(this.#e=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new B4(this)}get serializable(){if(this.#i.size===0)return yg;const e=new Map,t=new P4,n=[],s=Object.create(null);let r=!1;for(const[a,l]of this.#i){const c=l instanceof Fe?l.serialize(!1,s):l;c&&(e.set(a,c),t.update(`${a}:${JSON.stringify(c)}`),r||=!!c.bitmap)}if(r)for(const a of e.values())a.bitmap&&n.push(a.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:yg}get editorStats(){let e=null;const t=new Map;let n=0,s=0;for(const r of this.#i.values()){if(!(r instanceof Fe)){r.popup&&(r.popup.deleted?s+=1:n+=1);continue}r.isCommentDeleted?s+=1:r.hasEditedComment&&(n+=1);const a=r.telemetryFinalData;if(!a)continue;const{type:l}=a;t.has(l)||t.set(l,Object.getPrototypeOf(r).constructor),e||=Object.create(null);const c=e[l]||=new Map;for(const[h,d]of Object.entries(a)){if(h==="type")continue;let f=c.get(h);f||(f=new Map,c.set(h,f));const p=f.get(d)??0;f.set(d,p+1)}}if((s>0||n>0)&&(e||=Object.create(null),e.comments={deleted:s,edited:n}),!e)return null;for(const[r,a]of t)e[r]=a.computeTelemetryFinalData(e[r]);return e}resetModifiedIds(){this.#t=null}updateEditor(e,t){const n=this.#n?.get(e);return n?(n.updateFromAnnotationLayer(t),!0):!1}getEditor(e){return this.#n?.get(e)||null}get modifiedIds(){if(this.#t)return this.#t;const e=[];if(this.#n)for(const t of this.#n.values())t.serialize()&&e.push(t.annotationElementId);return this.#t={ids:new Set(e),hash:e.join(",")}}[Symbol.iterator](){return this.#i.entries()}}class B4 extends q1{#e;constructor(e){super();const{map:t,hash:n,transfer:s}=e.serializable,r=structuredClone(t,s?{transfer:s}:null);this.#e={map:r,hash:n,transfer:s}}get print(){Nt("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}get modifiedIds(){return Je(this,"modifiedIds",{ids:new Set,hash:""})}}class k9{#e=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#e.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:n}){if(!(!e||this.#e.has(e.loadedName))){if(ut(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:r,style:a}=e,l=new FontFace(s,r,a);this.addNativeFontFace(l);try{await l.load(),this.#e.add(s),n?.(e)}catch{Xe(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(l)}return}Nt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(s){throw Xe(`Failed to load font '${n.family}': '${s}'.`),e.disableFontFace=!0,s}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const s=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,s)})}}get isFontLoadingAPISupported(){const e=!!this._document?.fonts;return Je(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return Je(this,"isSyncFontLoadingSupported",Vi||vi.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(ut(!s.done,"completeRequest() cannot be called twice."),s.done=!0;n.length>0&&n[0].done;){const r=n.shift();setTimeout(r.callback,0)}}const{loadingRequests:n}=this,s={done:!1,complete:t,callback:e};return n.push(s),s}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Je(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(E,D){return E.charCodeAt(D)<<24|E.charCodeAt(D+1)<<16|E.charCodeAt(D+2)<<8|E.charCodeAt(D+3)&255}function s(E,D,M,N){const I=E.substring(0,D),_=E.substring(D+M);return I+N+_}let r,a;const l=this._document.createElement("canvas");l.width=1,l.height=1;const c=l.getContext("2d");let h=0;function d(E,D){if(++h>30){Xe("Load test font never loaded."),D();return}if(c.font="30px "+E,c.fillText(".",0,20),c.getImageData(0,0,1,1).data[3]>0){D();return}setTimeout(d.bind(null,E,D))}const f=`lt${Date.now()}${this.loadTestFontId++}`;let p=this._loadTestFont;p=s(p,976,f.length,f);const y=16,x=1482184792;let b=n(p,y);for(r=0,a=f.length-3;r<a;r+=4)b=b-x+n(f,r)|0;r<f.length&&(b=b-x+n(f+"XXX",r)|0),p=s(p,y,4,C9(b));const w=`url(data:font/opentype;base64,${btoa(p)});`,S=`@font-face {font-family:"${f}";src:${w}}`;this.insertRule(S);const C=this._document.createElement("div");C.style.visibility="hidden",C.style.width=C.style.height="10px",C.style.position="absolute",C.style.top=C.style.left="0px";for(const E of[e.loadedName,f]){const D=this._document.createElement("span");D.textContent="Hi",D.style.fontFamily=E,C.append(D)}this._document.body.append(C),d(f,()=>{C.remove(),t.complete()})}}class O9{#e;constructor(e,t=null,n,s){this.compiledGlyphs=Object.create(null),this.#e=e,this._inspectFont=t,n&&Object.assign(this,n),s&&(this.charProcOperatorList=s)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${T4(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const n=this.loadedName+"_path_"+t;let s;try{s=e.get(n)}catch(a){Xe(`getPathGenerator - ignoring character: "${a}".`)}const r=new Path2D(s||"");return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=r}get black(){return this.#e.black}get bold(){return this.#e.bold}get disableFontFace(){return this.#e.disableFontFace??!1}get fontExtraProperties(){return this.#e.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#e.isInvalidPDFjsFont}get isType3Font(){return this.#e.isType3Font}get italic(){return this.#e.italic}get missingFile(){return this.#e.missingFile}get remeasure(){return this.#e.remeasure}get vertical(){return this.#e.vertical}get ascent(){return this.#e.ascent}get defaultWidth(){return this.#e.defaultWidth}get descent(){return this.#e.descent}get bbox(){return this.#e.bbox}get fontMatrix(){return this.#e.fontMatrix}get fallbackName(){return this.#e.fallbackName}get loadedName(){return this.#e.loadedName}get mimetype(){return this.#e.mimetype}get name(){return this.#e.name}get data(){return this.#e.data}clearData(){this.#e.clearData()}get cssFontInfo(){return this.#e.cssFontInfo}get systemFontInfo(){return this.#e.systemFontInfo}get defaultVMetrics(){return this.#e.defaultVMetrics}}function U9(i){if(i instanceof URL)return i.href;if(typeof i=="string"){if(Vi)return i;const e=URL.parse(i,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function V9(i){if(Vi&&typeof Buffer<"u"&&i instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength)return i;if(typeof i=="string")return lu(i);if(i instanceof ArrayBuffer||ArrayBuffer.isView(i)||typeof i=="object"&&!isNaN(i?.length))return new Uint8Array(i);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Xh(i){if(typeof i!="string")return null;if(i.endsWith("/"))return i;throw new Error(`Invalid factory url: "${i}" must include trailing slash.`)}const xg=i=>typeof i=="object"&&Number.isInteger(i?.num)&&i.num>=0&&Number.isInteger(i?.gen)&&i.gen>=0,j9=i=>typeof i=="object"&&typeof i?.name=="string",L4=D9.bind(null,xg,j9);class z9{#e=new Map;#t=Promise.resolve();postMessage(e,t){const n={data:structuredClone(e,t?{transfer:t}:null)};this.#t.then(()=>{for(const[s]of this.#e)s.call(this,n)})}addEventListener(e,t,n=null){let s=null;if(n?.signal instanceof AbortSignal){const{signal:r}=n;if(r.aborted){Xe("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(e,t);s=()=>r.removeEventListener("abort",a),r.addEventListener("abort",a)}this.#e.set(t,s)}removeEventListener(e,t){this.#e.get(t)?.(),this.#e.delete(t)}terminate(){for(const[,e]of this.#e)e?.();this.#e.clear()}}const Wh={DATA:1,ERROR:2},ai={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function gw(){}function tn(i){if(i instanceof Zs||i instanceof Vd||i instanceof lw||i instanceof Vc||i instanceof I0)return i;switch(i instanceof Error||typeof i=="object"&&i!==null||Nt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),i.name){case"AbortException":return new Zs(i.message);case"InvalidPDFException":return new Vd(i.message);case"PasswordException":return new lw(i.message,i.code);case"ResponseException":return new Vc(i.message,i.status,i.missing);case"UnknownErrorException":return new I0(i.message,i.details)}return new I0(i.message,i.toString())}class vc{#e=new AbortController;constructor(e,t,n){this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",this.#t.bind(this),{signal:this.#e.signal})}#t({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){this.#i(e);return}if(e.callback){const n=e.callbackId,s=this.callbackCapabilities[n];if(!s)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],e.callback===Wh.DATA)s.resolve(e.data);else if(e.callback===Wh.ERROR)s.reject(tn(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const n=this.sourceName,s=e.sourceName,r=this.comObj;Promise.try(t,e.data).then(function(a){r.postMessage({sourceName:n,targetName:s,callback:Wh.DATA,callbackId:e.callbackId,data:a})},function(a){r.postMessage({sourceName:n,targetName:s,callback:Wh.ERROR,callbackId:e.callbackId,reason:tn(a)})});return}if(e.streamId){this.#n(e);return}t(e.data)}on(e,t){const n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){const s=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[s]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:s,data:t},n)}catch(a){r.reject(a)}return r.promise}sendWithStream(e,t,n,s){const r=this.streamId++,a=this.sourceName,l=this.targetName,c=this.comObj;return new ReadableStream({start:h=>{const d=Promise.withResolvers();return this.streamControllers[r]={controller:h,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:a,targetName:l,action:e,streamId:r,data:t,desiredSize:h.desiredSize},s),d.promise},pull:h=>{const d=Promise.withResolvers();return this.streamControllers[r].pullCall=d,c.postMessage({sourceName:a,targetName:l,stream:ai.PULL,streamId:r,desiredSize:h.desiredSize}),d.promise},cancel:h=>{ut(h instanceof Error,"cancel must have a valid reason");const d=Promise.withResolvers();return this.streamControllers[r].cancelCall=d,this.streamControllers[r].isClosed=!0,c.postMessage({sourceName:a,targetName:l,stream:ai.CANCEL,streamId:r,reason:tn(h)}),d.promise}},n)}#n(e){const t=e.streamId,n=this.sourceName,s=e.sourceName,r=this.comObj,a=this,l=this.actionHandler[e.action],c={enqueue(h,d=1,f){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=d,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:n,targetName:s,stream:ai.ENQUEUE,streamId:t,chunk:h},f)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:s,stream:ai.CLOSE,streamId:t}),delete a.streamSinks[t])},error(h){ut(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:s,stream:ai.ERROR,streamId:t,reason:tn(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};c.sinkCapability.resolve(),c.ready=c.sinkCapability.promise,this.streamSinks[t]=c,Promise.try(l,e.data,c).then(function(){r.postMessage({sourceName:n,targetName:s,stream:ai.START_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:n,targetName:s,stream:ai.START_COMPLETE,streamId:t,reason:tn(h)})})}#i(e){const t=e.streamId,n=this.sourceName,s=e.sourceName,r=this.comObj,a=this.streamControllers[t],l=this.streamSinks[t];switch(e.stream){case ai.START_COMPLETE:e.success?a.startCall.resolve():a.startCall.reject(tn(e.reason));break;case ai.PULL_COMPLETE:e.success?a.pullCall.resolve():a.pullCall.reject(tn(e.reason));break;case ai.PULL:if(!l){r.postMessage({sourceName:n,targetName:s,stream:ai.PULL_COMPLETE,streamId:t,success:!0});break}l.desiredSize<=0&&e.desiredSize>0&&l.sinkCapability.resolve(),l.desiredSize=e.desiredSize,Promise.try(l.onPull||gw).then(function(){r.postMessage({sourceName:n,targetName:s,stream:ai.PULL_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:n,targetName:s,stream:ai.PULL_COMPLETE,streamId:t,reason:tn(h)})});break;case ai.ENQUEUE:if(ut(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case ai.CLOSE:if(ut(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),this.#r(a,t);break;case ai.ERROR:ut(a,"error should have stream controller"),a.controller.error(tn(e.reason)),this.#r(a,t);break;case ai.CANCEL_COMPLETE:e.success?a.cancelCall.resolve():a.cancelCall.reject(tn(e.reason)),this.#r(a,t);break;case ai.CANCEL:if(!l)break;const c=tn(e.reason);Promise.try(l.onCancel||gw,c).then(function(){r.postMessage({sourceName:n,targetName:s,stream:ai.CANCEL_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:n,targetName:s,stream:ai.CANCEL_COMPLETE,streamId:t,reason:tn(h)})}),l.sinkCapability.reject(c),l.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#r(e,t){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.#e?.abort(),this.#e=null}}class k4{#e=!1;constructor({enableHWA:e=!1}){this.#e=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!this.#e})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Nt("Abstract method `_createCanvas` called.")}}class G9 extends k4{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const n=this._document.createElement("canvas");return n.width=e,n.height=t,n}}class O4{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Nt("Abstract method `_fetch` called.")}}class Aw extends O4{async _fetch(e){const t=await Jo(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):lu(t)}}class U4{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,s,r){return"none"}destroy(e=!1){}}class H9 extends U4{#e;#t;#n;#i;#r;#s;#a=0;constructor({docId:e,ownerDocument:t=globalThis.document}){super(),this.#i=e,this.#r=t}get#o(){return this.#t||=new Map}get#c(){return this.#s||=new Map}get#l(){if(!this.#n){const e=this.#r.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;const n=this.#r.createElementNS(Us,"svg");n.setAttribute("width",0),n.setAttribute("height",0),this.#n=this.#r.createElementNS(Us,"defs"),e.append(n),n.append(this.#n),this.#r.body.append(e)}return this.#n}#d(e){if(e.length===1){const c=e[0],h=new Array(256);for(let f=0;f<256;f++)h[f]=c[f]/255;const d=h.join(",");return[d,d,d]}const[t,n,s]=e,r=new Array(256),a=new Array(256),l=new Array(256);for(let c=0;c<256;c++)r[c]=t[c]/255,a[c]=n[c]/255,l[c]=s[c]/255;return[r.join(","),a.join(","),l.join(",")]}#h(e){if(this.#e===void 0){this.#e="";const t=this.#r.URL;t!==this.#r.baseURI&&(uu(t)?Xe('#createUrl: ignore "data:"-URL for performance reasons.'):this.#e=U1(t,""))}return`url(${this.#e}#${e})`}addFilter(e){if(!e)return"none";let t=this.#o.get(e);if(t)return t;const[n,s,r]=this.#d(e),a=e.length===1?n:`${n}${s}${r}`;if(t=this.#o.get(a),t)return this.#o.set(e,t),t;const l=`g_${this.#i}_transfer_map_${this.#a++}`,c=this.#h(l);this.#o.set(e,c),this.#o.set(a,c);const h=this.#m(l);return this.#p(n,s,r,h),c}addHCMFilter(e,t){const n=`${e}-${t}`,s="base";let r=this.#c.get(s);if(r?.key===n||(r?(r.filter?.remove(),r.key=n,r.url="none",r.filter=null):(r={key:n,url:"none",filter:null},this.#c.set(s,r)),!e||!t))return r.url;const a=this.#y(e);e=Ce.makeHexColor(...a);const l=this.#y(t);if(t=Ce.makeHexColor(...l),this.#l.style.color="",e==="#000000"&&t==="#ffffff"||e===t)return r.url;const c=new Array(256);for(let g=0;g<=255;g++){const y=g/255;c[g]=y<=.03928?y/12.92:((y+.055)/1.055)**2.4}const h=c.join(","),d=`g_${this.#i}_hcm_filter`,f=r.filter=this.#m(d);this.#p(h,h,h,f),this.#g(f);const p=(g,y)=>{const x=a[g]/255,b=l[g]/255,w=new Array(y+1);for(let S=0;S<=y;S++)w[S]=x+S/y*(b-x);return w.join(",")};return this.#p(p(0,5),p(1,5),p(2,5),f),r.url=this.#h(d),r.url}addAlphaFilter(e){let t=this.#o.get(e);if(t)return t;const[n]=this.#d([e]),s=`alpha_${n}`;if(t=this.#o.get(s),t)return this.#o.set(e,t),t;const r=`g_${this.#i}_alpha_map_${this.#a++}`,a=this.#h(r);this.#o.set(e,a),this.#o.set(s,a);const l=this.#m(r);return this.#A(n,l),a}addLuminosityFilter(e){let t=this.#o.get(e||"luminosity");if(t)return t;let n,s;if(e?([n]=this.#d([e]),s=`luminosity_${n}`):s="luminosity",t=this.#o.get(s),t)return this.#o.set(e,t),t;const r=`g_${this.#i}_luminosity_map_${this.#a++}`,a=this.#h(r);this.#o.set(e,a),this.#o.set(s,a);const l=this.#m(r);return this.#f(l),e&&this.#A(n,l),a}addHighlightHCMFilter(e,t,n,s,r){const a=`${t}-${n}-${s}-${r}`;let l=this.#c.get(e);if(l?.key===a||(l?(l.filter?.remove(),l.key=a,l.url="none",l.filter=null):(l={key:a,url:"none",filter:null},this.#c.set(e,l)),!t||!n))return l.url;const[c,h]=[t,n].map(this.#y.bind(this));let d=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),f=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[p,g]=[s,r].map(this.#y.bind(this));f<d&&([d,f,p,g]=[f,d,g,p]),this.#l.style.color="";const y=(w,S,C)=>{const E=new Array(256),D=(f-d)/C,M=w/255,N=(S-w)/(255*C);let I=0;for(let _=0;_<=C;_++){const F=Math.round(d+_*D),B=M+_*N;for(let P=I;P<=F;P++)E[P]=B;I=F+1}for(let _=I;_<256;_++)E[_]=E[I-1];return E.join(",")},x=`g_${this.#i}_hcm_${e}_filter`,b=l.filter=this.#m(x);return this.#g(b),this.#p(y(p[0],g[0],5),y(p[1],g[1],5),y(p[2],g[2],5),b),l.url=this.#h(x),l.url}destroy(e=!1){e&&this.#s?.size||(this.#n?.parentNode.parentNode.remove(),this.#n=null,this.#t?.clear(),this.#t=null,this.#s?.clear(),this.#s=null,this.#a=0)}#f(e){const t=this.#r.createElementNS(Us,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#g(e){const t=this.#r.createElementNS(Us,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#m(e){const t=this.#r.createElementNS(Us,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#l.append(t),t}#u(e,t,n){const s=this.#r.createElementNS(Us,t);s.setAttribute("type","discrete"),s.setAttribute("tableValues",n),e.append(s)}#p(e,t,n,s){const r=this.#r.createElementNS(Us,"feComponentTransfer");s.append(r),this.#u(r,"feFuncR",e),this.#u(r,"feFuncG",t),this.#u(r,"feFuncB",n)}#A(e,t){const n=this.#r.createElementNS(Us,"feComponentTransfer");t.append(n),this.#u(n,"feFuncA",e)}#y(e){return this.#l.style.color=e,$o(getComputedStyle(this.#l).getPropertyValue("color"))}}class V4{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Nt("Abstract method `_fetch` called.")}}class vw extends V4{async _fetch(e){const t=await Jo(e,"arraybuffer");return new Uint8Array(t)}}class j4{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){Nt("Abstract method `_fetch` called.")}}class yw extends j4{async _fetch(e){const t=await Jo(e,"arraybuffer");return new Uint8Array(t)}}Vi&&Xe("Please use the `legacy` build in Node.js environments.");async function X1(i){const t=await process.getBuiltinModule("fs").promises.readFile(i);return new Uint8Array(t)}class Y9 extends U4{}class q9 extends k4{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class X9 extends O4{async _fetch(e){return X1(e)}}class W9 extends V4{async _fetch(e){return X1(e)}}class K9 extends j4{async _fetch(e){return X1(e)}}const vo="__forcedDependency",{floor:xw,ceil:bw}=Math;function Kh(i,e,t,n,s,r){i[e*4+0]=Math.min(i[e*4+0],t),i[e*4+1]=Math.min(i[e*4+1],n),i[e*4+2]=Math.max(i[e*4+2],s),i[e*4+3]=Math.max(i[e*4+3],r)}const bg=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class Q9{#e;#t;constructor(e,t){this.#e=e,this.#t=t}get length(){return this.#e.length}isEmpty(e){return this.#e[e]===bg}minX(e){return this.#t[e*4+0]/256}minY(e){return this.#t[e*4+1]/256}maxX(e){return(this.#t[e*4+2]+1)/256}maxY(e){return(this.#t[e*4+3]+1)/256}}const Qh=(i,e)=>{if(!i)return;let t=i.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},i.set(e,t)),t};class Z9{#e={__proto__:null};#t={__proto__:null,transform:[],moveText:[],sameLineText:[],[vo]:[]};#n=new Map;#i=[];#r=[];#s=[[1,0,0,1,0,0]];#a=[-1/0,-1/0,1/0,1/0];#o=new Float64Array([1/0,1/0,-1/0,-1/0]);#c=-1;#l=new Set;#d=new Map;#h=new Map;#f;#g;#m;#u;#p;constructor(e,t,n=!1){this.#f=e.width,this.#g=e.height,this.#A(t),n&&(this.#p=new Map)}growOperationsCount(e){e>=this.#u.length&&this.#A(e,this.#u)}#A(e,t){const n=new ArrayBuffer(e*4);this.#m=new Uint8ClampedArray(n),this.#u=new Uint32Array(n),t&&t.length>0?(this.#u.set(t),this.#u.fill(bg,t.length)):this.#u.fill(bg)}save(e){return this.#e={__proto__:this.#e},this.#t={__proto__:this.#t,transform:{__proto__:this.#t.transform},moveText:{__proto__:this.#t.moveText},sameLineText:{__proto__:this.#t.sameLineText},[vo]:{__proto__:this.#t[vo]}},this.#a={__proto__:this.#a},this.#i.push(e),this}restore(e){const t=Object.getPrototypeOf(this.#e);if(t===null)return this;this.#e=t,this.#t=Object.getPrototypeOf(this.#t),this.#a=Object.getPrototypeOf(this.#a);const n=this.#i.pop();return n!==void 0&&(Qh(this.#p,e)?.dependencies.add(n),this.#u[e]=this.#u[n]),this}recordOpenMarker(e){return this.#i.push(e),this}getOpenMarker(){return this.#i.length===0?null:this.#i.at(-1)}recordCloseMarker(e){const t=this.#i.pop();return t!==void 0&&(Qh(this.#p,e)?.dependencies.add(t),this.#u[e]=this.#u[t]),this}beginMarkedContent(e){return this.#r.push(e),this}endMarkedContent(e){const t=this.#r.pop();return t!==void 0&&(Qh(this.#p,e)?.dependencies.add(t),this.#u[e]=this.#u[t]),this}pushBaseTransform(e){return this.#s.push(Ce.multiplyByDOMMatrix(this.#s.at(-1),e.getTransform())),this}popBaseTransform(){return this.#s.length>1&&this.#s.pop(),this}recordSimpleData(e,t){return this.#e[e]=t,this}recordIncrementalData(e,t){return this.#t[e].push(t),this}resetIncrementalData(e,t){return this.#t[e].length=0,this}recordNamedData(e,t){return this.#n.set(e,t),this}recordSimpleDataFromNamed(e,t,n){this.#e[e]=this.#n.get(t)??n}recordFutureForcedDependency(e,t){return this.recordIncrementalData(vo,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in this.#e&&this.recordFutureForcedDependency(t,this.#e[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of this.#l)this.recordFutureForcedDependency(vo,e);return this}resetBBox(e){return this.#c!==e&&(this.#c=e,this.#o[0]=1/0,this.#o[1]=1/0,this.#o[2]=-1/0,this.#o[3]=-1/0),this}recordClipBox(e,t,n,s,r,a){const l=Ce.multiplyByDOMMatrix(this.#s.at(-1),t.getTransform()),c=[1/0,1/0,-1/0,-1/0];Ce.axialAlignedBoundingBox([n,r,s,a],l,c);const h=Ce.intersect(this.#a,c);return h?(this.#a[0]=h[0],this.#a[1]=h[1],this.#a[2]=h[2],this.#a[3]=h[3]):(this.#a[0]=this.#a[1]=1/0,this.#a[2]=this.#a[3]=-1/0),this}recordBBox(e,t,n,s,r,a){const l=this.#a;if(l[0]===1/0)return this;const c=Ce.multiplyByDOMMatrix(this.#s.at(-1),t.getTransform());if(l[0]===-1/0)return Ce.axialAlignedBoundingBox([n,r,s,a],c,this.#o),this;const h=[1/0,1/0,-1/0,-1/0];return Ce.axialAlignedBoundingBox([n,r,s,a],c,h),this.#o[0]=Math.min(this.#o[0],Math.max(h[0],l[0])),this.#o[1]=Math.min(this.#o[1],Math.max(h[1],l[1])),this.#o[2]=Math.max(this.#o[2],Math.min(h[2],l[2])),this.#o[3]=Math.max(this.#o[3],Math.min(h[3],l[3])),this}recordCharacterBBox(e,t,n,s=1,r=0,a=0,l){const c=n.bbox;let h,d;if(c&&(h=c[2]!==c[0]&&c[3]!==c[1]&&this.#h.get(n),h!==!1&&(d=[0,0,0,0],Ce.axialAlignedBoundingBox(c,n.fontMatrix,d),(s!==1||r!==0||a!==0)&&Ce.scaleMinMax([s,0,0,-s,r,a],d),h)))return this.recordBBox(e,t,d[0],d[2],d[1],d[3]);if(!l)return this.recordFullPageBBox(e);const f=l();return c&&d&&h===void 0&&(h=d[0]<=r-f.actualBoundingBoxLeft&&d[2]>=r+f.actualBoundingBoxRight&&d[1]<=a-f.actualBoundingBoxAscent&&d[3]>=a+f.actualBoundingBoxDescent,this.#h.set(n,h),h)?this.recordBBox(e,t,d[0],d[2],d[1],d[3]):this.recordBBox(e,t,r-f.actualBoundingBoxLeft,r+f.actualBoundingBoxRight,a-f.actualBoundingBoxAscent,a+f.actualBoundingBoxDescent)}recordFullPageBBox(e){return this.#o[0]=Math.max(0,this.#a[0]),this.#o[1]=Math.max(0,this.#a[1]),this.#o[2]=Math.min(this.#f,this.#a[2]),this.#o[3]=Math.min(this.#g,this.#a[3]),this}getSimpleIndex(e){return this.#e[e]}recordDependencies(e,t){const n=this.#l,s=this.#e,r=this.#t;for(const a of t)a in this.#e?n.add(s[a]):a in r&&r[a].forEach(n.add,n);return this}recordNamedDependency(e,t){return this.#n.has(t)&&this.#l.add(this.#n.get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[vo]),this.#p){const n=Qh(this.#p,e),{dependencies:s}=n;this.#l.forEach(s.add,s),this.#i.forEach(s.add,s),this.#r.forEach(s.add,s),s.delete(e),n.isRenderingOperation=!0}if(this.#c===e){const n=xw(this.#o[0]*256/this.#f),s=xw(this.#o[1]*256/this.#g),r=bw(this.#o[2]*256/this.#f),a=bw(this.#o[3]*256/this.#g);Kh(this.#m,e,n,s,r,a);for(const l of this.#l)l!==e&&Kh(this.#m,l,n,s,r,a);for(const l of this.#i)l!==e&&Kh(this.#m,l,n,s,r,a);for(const l of this.#r)l!==e&&Kh(this.#m,l,n,s,r,a);t||(this.#l.clear(),this.#c=-1)}return this}recordShowTextOperation(e,t=!1){const n=Array.from(this.#l);this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const s of n)this.recordIncrementalData("sameLineText",s);return this}bboxToClipBoxDropOperation(e,t=!1){return this.#c===e&&(this.#c=-1,this.#a[0]=Math.max(this.#a[0],this.#o[0]),this.#a[1]=Math.max(this.#a[1],this.#o[1]),this.#a[2]=Math.min(this.#a[2],this.#o[2]),this.#a[3]=Math.min(this.#a[3],this.#o[3]),t||this.#l.clear()),this}_takePendingDependencies(){const e=this.#l;return this.#l=new Set,e}_extractOperation(e){const t=this.#d.get(e);return this.#d.delete(e),t}_pushPendingDependencies(e){for(const t of e)this.#l.add(t)}take(){return this.#h.clear(),new Q9(this.#u,this.#m)}takeDebugMetadata(){return this.#p}}class Gd{#e;#t;#n;#i=0;#r=0;constructor(e,t,n){if(e instanceof Gd&&e.#n===!!n)return e;this.#e=e,this.#t=t,this.#n=!!n}growOperationsCount(){throw new Error("Unreachable")}save(e){return this.#r++,this.#e.save(this.#t),this}restore(e){return this.#r>0&&(this.#e.restore(this.#t),this.#r--),this}recordOpenMarker(e){return this.#i++,this}getOpenMarker(){return this.#i>0?this.#t:this.#e.getOpenMarker()}recordCloseMarker(e){return this.#i--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return this.#e.pushBaseTransform(e),this}popBaseTransform(){return this.#e.popBaseTransform(),this}recordSimpleData(e,t){return this.#e.recordSimpleData(e,this.#t),this}recordIncrementalData(e,t){return this.#e.recordIncrementalData(e,this.#t),this}resetIncrementalData(e,t){return this.#e.resetIncrementalData(e,this.#t),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,n){return this.#e.recordSimpleDataFromNamed(e,t,this.#t),this}recordFutureForcedDependency(e,t){return this.#e.recordFutureForcedDependency(e,this.#t),this}inheritSimpleDataAsFutureForcedDependencies(e){return this.#e.inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#e.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return this.#n||this.#e.resetBBox(this.#t),this}recordClipBox(e,t,n,s,r,a){return this.#n||this.#e.recordClipBox(this.#t,t,n,s,r,a),this}recordBBox(e,t,n,s,r,a){return this.#n||this.#e.recordBBox(this.#t,t,n,s,r,a),this}recordCharacterBBox(e,t,n,s,r,a,l){return this.#n||this.#e.recordCharacterBBox(this.#t,t,n,s,r,a,l),this}recordFullPageBBox(e){return this.#n||this.#e.recordFullPageBBox(this.#t),this}getSimpleIndex(e){return this.#e.getSimpleIndex(e)}recordDependencies(e,t){return this.#e.recordDependencies(this.#t,t),this}recordNamedDependency(e,t){return this.#e.recordNamedDependency(this.#t,t),this}recordOperation(e){return this.#e.recordOperation(this.#t,!0),this}recordShowTextOperation(e){return this.#e.recordShowTextOperation(this.#t,!0),this}bboxToClipBoxDropOperation(e){return this.#n||this.#e.bboxToClipBoxDropOperation(this.#t,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const Bn={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},_i={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function wg(i,e){if(!e)return;const t=e[2]-e[0],n=e[3]-e[1],s=new Path2D;s.rect(e[0],e[1],t,n),i.clip(s)}class W1{isModifyingCurrentTransform(){return!1}getPattern(){Nt("Abstract method `getPattern` called.")}}class J9 extends W1{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,s){let r;if(s===_i.STROKE||s===_i.FILL){const a=t.current.getClippedPathBoundingBox(s,Ht(e))||[0,0,0,0],l=Math.ceil(a[2]-a[0])||1,c=Math.ceil(a[3]-a[1])||1,h=t.cachedCanvases.getCanvas("pattern",l,c),d=h.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-a[0],-a[1]),n=Ce.transform(n,[1,0,0,1,a[0],a[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),wg(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),r=e.createPattern(h.canvas,"no-repeat");const f=new DOMMatrix(n);r.setTransform(f)}else wg(e,this._bbox),r=this._createGradient(e);return r}}function P0(i,e,t,n,s,r,a,l){const c=e.coords,h=e.colors,d=i.data,f=i.width*4;let p;c[t+1]>c[n+1]&&(p=t,t=n,n=p,p=r,r=a,a=p),c[n+1]>c[s+1]&&(p=n,n=s,s=p,p=a,a=l,l=p),c[t+1]>c[n+1]&&(p=t,t=n,n=p,p=r,r=a,a=p);const g=(c[t]+e.offsetX)*e.scaleX,y=(c[t+1]+e.offsetY)*e.scaleY,x=(c[n]+e.offsetX)*e.scaleX,b=(c[n+1]+e.offsetY)*e.scaleY,w=(c[s]+e.offsetX)*e.scaleX,S=(c[s+1]+e.offsetY)*e.scaleY;if(y>=S)return;const C=h[r],E=h[r+1],D=h[r+2],M=h[a],N=h[a+1],I=h[a+2],_=h[l],F=h[l+1],B=h[l+2],P=Math.round(y),O=Math.round(S);let k,q,U,H,Y,Q,te,j;for(let W=P;W<=O;W++){if(W<b){const ce=W<y?0:(y-W)/(y-b);k=g-(g-x)*ce,q=C-(C-M)*ce,U=E-(E-N)*ce,H=D-(D-I)*ce}else{let ce;W>S?ce=1:b===S?ce=0:ce=(b-W)/(b-S),k=x-(x-w)*ce,q=M-(M-_)*ce,U=N-(N-F)*ce,H=I-(I-B)*ce}let K;W<y?K=0:W>S?K=1:K=(y-W)/(y-S),Y=g-(g-w)*K,Q=C-(C-_)*K,te=E-(E-F)*K,j=D-(D-B)*K;const ee=Math.round(Math.min(k,Y)),le=Math.round(Math.max(k,Y));let he=f*W+ee*4;for(let ce=ee;ce<=le;ce++)K=(k-ce)/(k-Y),K<0?K=0:K>1&&(K=1),d[he++]=q-(q-Q)*K|0,d[he++]=U-(U-te)*K|0,d[he++]=H-(H-j)*K|0,d[he++]=255}}function $9(i,e,t){const n=e.coords,s=e.colors;let r,a;switch(e.type){case"lattice":const l=e.verticesPerRow,c=Math.floor(n.length/l)-1,h=l-1;for(r=0;r<c;r++){let d=r*l;for(let f=0;f<h;f++,d++)P0(i,t,n[d],n[d+1],n[d+l],s[d],s[d+1],s[d+l]),P0(i,t,n[d+l+1],n[d+1],n[d+l],s[d+l+1],s[d+1],s[d+l])}break;case"triangles":for(r=0,a=n.length;r<a;r+=3)P0(i,t,n[r],n[r+1],n[r+2],s[r],s[r+1],s[r+2]);break;default:throw new Error("illegal figure")}}class ez extends W1{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,n){const l=Math.floor(this._bounds[0]),c=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-l,d=Math.ceil(this._bounds[3])-c,f=Math.min(Math.ceil(Math.abs(h*e[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(d*e[1]*1.1)),3e3),g=h/f,y=d/p,x={coords:this._coords,colors:this._colors,offsetX:-l,offsetY:-c,scaleX:1/g,scaleY:1/y},b=f+4,w=p+4,S=n.getCanvas("mesh",b,w),C=S.context,E=C.createImageData(f,p);if(t){const M=E.data;for(let N=0,I=M.length;N<I;N+=4)M[N]=t[0],M[N+1]=t[1],M[N+2]=t[2],M[N+3]=255}for(const M of this._figures)$9(E,M,x);return C.putImageData(E,2,2),{canvas:S.canvas,offsetX:l-2*g,offsetY:c-2*y,scaleX:g,scaleY:y}}isModifyingCurrentTransform(){return!0}getPattern(e,t,n,s){wg(e,this._bbox);const r=new Float32Array(2);if(s===_i.SHADING)Ce.singularValueDecompose2dScale(Ht(e),r);else if(this.matrix){Ce.singularValueDecompose2dScale(this.matrix,r);const[l,c]=r;Ce.singularValueDecompose2dScale(t.baseTransform,r),r[0]*=l,r[1]*=c}else Ce.singularValueDecompose2dScale(t.baseTransform,r);const a=this._createMeshCanvas(r,s===_i.SHADING?null:this._background,t.cachedCanvases);return s!==_i.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,"no-repeat")}}class tz extends W1{getPattern(){return"hotpink"}}function iz(i){switch(i[0]){case"RadialAxial":return new J9(i);case"Mesh":return new ez(i);case"Dummy":return new tz}throw new Error(`Unknown IR type: ${i[0]}`)}const ww={COLORED:1,UNCOLORED:2};class K1{static MAX_PATTERN_SIZE=3e3;constructor(e,t,n,s){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=n,this.baseTransform=s}createPatternCanvas(e,t){const{bbox:n,operatorList:s,paintType:r,tilingType:a,color:l,canvasGraphicsFactory:c}=this;let{xstep:h,ystep:d}=this;h=Math.abs(h),d=Math.abs(d),yf("TilingType: "+a);const f=n[0],p=n[1],g=n[2],y=n[3],x=g-f,b=y-p,w=new Float32Array(2);Ce.singularValueDecompose2dScale(this.matrix,w);const[S,C]=w;Ce.singularValueDecompose2dScale(this.baseTransform,w);const E=S*w[0],D=C*w[1];let M=x,N=b,I=!1,_=!1;const F=Math.ceil(h*E),B=Math.ceil(d*D),P=Math.ceil(x*E),O=Math.ceil(b*D);F>=P?M=h:I=!0,B>=O?N=d:_=!0;const k=this.getSizeAndScale(M,this.ctx.canvas.width,E),q=this.getSizeAndScale(N,this.ctx.canvas.height,D),U=e.cachedCanvases.getCanvas("pattern",k.size,q.size),H=U.context,Y=c.createCanvasGraphics(H,t);if(Y.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(Y,r,l),H.translate(-k.scale*f,-q.scale*p),Y.transform(0,k.scale,0,0,q.scale,0,0),H.save(),Y.dependencyTracker?.save(),this.clipBbox(Y,f,p,g,y),Y.baseTransform=Ht(Y.ctx),Y.executeOperatorList(s),Y.endDrawing(),Y.dependencyTracker?.restore(),H.restore(),I||_){const Q=U.canvas;I&&(M=h),_&&(N=d);const te=this.getSizeAndScale(M,this.ctx.canvas.width,E),j=this.getSizeAndScale(N,this.ctx.canvas.height,D),W=te.size,K=j.size,ee=e.cachedCanvases.getCanvas("pattern-workaround",W,K),le=ee.context,he=I?Math.floor(x/h):0,ce=_?Math.floor(b/d):0;for(let xe=0;xe<=he;xe++)for(let ge=0;ge<=ce;ge++)le.drawImage(Q,W*xe,K*ge,W,K,0,0,W,K);return{canvas:ee.canvas,scaleX:te.scale,scaleY:j.scale,offsetX:f,offsetY:p}}return{canvas:U.canvas,scaleX:k.scale,scaleY:q.scale,offsetX:f,offsetY:p}}getSizeAndScale(e,t,n){const s=Math.max(K1.MAX_PATTERN_SIZE,t);let r=Math.ceil(e*n);return r>=s?r=s:n=r/e,{scale:n,size:r}}clipBbox(e,t,n,s,r){const a=s-t,l=r-n;e.ctx.rect(t,n,a,l),Ce.axialAlignedBoundingBox([t,n,s,r],Ht(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){const s=e.ctx,r=e.current;switch(t){case ww.COLORED:const{fillStyle:a,strokeStyle:l}=this.ctx;s.fillStyle=r.fillColor=a,s.strokeStyle=r.strokeColor=l;break;case ww.UNCOLORED:s.fillStyle=s.strokeStyle=n,r.fillColor=r.strokeColor=n;break;default:throw new S9(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,n,s,r){let a=n;s!==_i.SHADING&&(a=Ce.transform(a,t.baseTransform),this.matrix&&(a=Ce.transform(a,this.matrix)));const l=this.createPatternCanvas(t,r);let c=new DOMMatrix(a);c=c.translate(l.offsetX,l.offsetY),c=c.scale(1/l.scaleX,1/l.scaleY);const h=e.createPattern(l.canvas,"repeat");return h.setTransform(c),h}}function nz({src:i,srcPos:e=0,dest:t,width:n,height:s,nonBlackColor:r=4294967295,inverseDecode:a=!1}){const l=vi.isLittleEndian?4278190080:255,[c,h]=a?[r,l]:[l,r],d=n>>3,f=n&7,p=i.length;t=new Uint32Array(t.buffer);let g=0;for(let y=0;y<s;y++){for(const b=e+d;e<b;e++){const w=e<p?i[e]:255;t[g++]=w&128?h:c,t[g++]=w&64?h:c,t[g++]=w&32?h:c,t[g++]=w&16?h:c,t[g++]=w&8?h:c,t[g++]=w&4?h:c,t[g++]=w&2?h:c,t[g++]=w&1?h:c}if(f===0)continue;const x=e<p?i[e++]:255;for(let b=0;b<f;b++)t[g++]=x&1<<7-b?h:c}return{srcPos:e,destPos:g}}const Sw=16,Cw=100,sz=15,Ew=10,nn=16,B0=new DOMMatrix,pn=new Float32Array(2),To=new Float32Array([1/0,1/0,-1/0,-1/0]);function rz(i,e){if(i._removeMirroring)throw new Error("Context is already forwarding operations.");i.__originalSave=i.save,i.__originalRestore=i.restore,i.__originalRotate=i.rotate,i.__originalScale=i.scale,i.__originalTranslate=i.translate,i.__originalTransform=i.transform,i.__originalSetTransform=i.setTransform,i.__originalResetTransform=i.resetTransform,i.__originalClip=i.clip,i.__originalMoveTo=i.moveTo,i.__originalLineTo=i.lineTo,i.__originalBezierCurveTo=i.bezierCurveTo,i.__originalRect=i.rect,i.__originalClosePath=i.closePath,i.__originalBeginPath=i.beginPath,i._removeMirroring=()=>{i.save=i.__originalSave,i.restore=i.__originalRestore,i.rotate=i.__originalRotate,i.scale=i.__originalScale,i.translate=i.__originalTranslate,i.transform=i.__originalTransform,i.setTransform=i.__originalSetTransform,i.resetTransform=i.__originalResetTransform,i.clip=i.__originalClip,i.moveTo=i.__originalMoveTo,i.lineTo=i.__originalLineTo,i.bezierCurveTo=i.__originalBezierCurveTo,i.rect=i.__originalRect,i.closePath=i.__originalClosePath,i.beginPath=i.__originalBeginPath,delete i._removeMirroring},i.save=function(){e.save(),this.__originalSave()},i.restore=function(){e.restore(),this.__originalRestore()},i.translate=function(t,n){e.translate(t,n),this.__originalTranslate(t,n)},i.scale=function(t,n){e.scale(t,n),this.__originalScale(t,n)},i.transform=function(t,n,s,r,a,l){e.transform(t,n,s,r,a,l),this.__originalTransform(t,n,s,r,a,l)},i.setTransform=function(t,n,s,r,a,l){e.setTransform(t,n,s,r,a,l),this.__originalSetTransform(t,n,s,r,a,l)},i.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},i.rotate=function(t){e.rotate(t),this.__originalRotate(t)},i.clip=function(t){e.clip(t),this.__originalClip(t)},i.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},i.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},i.bezierCurveTo=function(t,n,s,r,a,l){e.bezierCurveTo(t,n,s,r,a,l),this.__originalBezierCurveTo(t,n,s,r,a,l)},i.rect=function(t,n,s,r){e.rect(t,n,s,r),this.__originalRect(t,n,s,r)},i.closePath=function(){e.closePath(),this.__originalClosePath()},i.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class az{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let s;return this.cache[e]!==void 0?(s=this.cache[e],this.canvasFactory.reset(s,t,n)):(s=this.canvasFactory.create(t,n),this.cache[e]=s),s}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Zh(i,e,t,n,s,r,a,l,c,h){const[d,f,p,g,y,x]=Ht(i);if(f===0&&p===0){const S=a*d+y,C=Math.round(S),E=l*g+x,D=Math.round(E),M=(a+c)*d+y,N=Math.abs(Math.round(M)-C)||1,I=(l+h)*g+x,_=Math.abs(Math.round(I)-D)||1;return i.setTransform(Math.sign(d),0,0,Math.sign(g),C,D),i.drawImage(e,t,n,s,r,0,0,N,_),i.setTransform(d,f,p,g,y,x),[N,_]}if(d===0&&g===0){const S=l*p+y,C=Math.round(S),E=a*f+x,D=Math.round(E),M=(l+h)*p+y,N=Math.abs(Math.round(M)-C)||1,I=(a+c)*f+x,_=Math.abs(Math.round(I)-D)||1;return i.setTransform(0,Math.sign(f),Math.sign(p),0,C,D),i.drawImage(e,t,n,s,r,0,0,_,N),i.setTransform(d,f,p,g,y,x),[_,N]}i.drawImage(e,t,n,s,r,a,l,c,h);const b=Math.hypot(d,f),w=Math.hypot(p,g);return[b*c,w*h]}class Tw{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=Ag;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=Ri.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(e,t,n){n?.(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=To.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=_i.FILL,t=null){const n=this.minMax.slice();if(e===_i.STROKE){t||Nt("Stroke bounding box must include transform."),Ce.singularValueDecompose2dScale(t,pn);const s=pn[0]*this.lineWidth/2,r=pn[1]*this.lineWidth/2;n[0]-=s,n[1]-=r,n[2]+=s,n[3]+=r}return n}updateClipFromPath(){const e=Ce.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(To,0)}getClippedPathBoundingBox(e=_i.FILL,t=null){return Ce.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function Mw(i,e){if(e instanceof ImageData){i.putImageData(e,0,0);return}const t=e.height,n=e.width,s=t%nn,r=(t-s)/nn,a=s===0?r:r+1,l=i.createImageData(n,nn);let c=0,h;const d=e.data,f=l.data;let p,g,y,x;if(e.kind===Dc.GRAYSCALE_1BPP){const b=d.byteLength,w=new Uint32Array(f.buffer,0,f.byteLength>>2),S=w.length,C=n+7>>3,E=4294967295,D=vi.isLittleEndian?4278190080:255;for(p=0;p<a;p++){for(y=p<r?nn:s,h=0,g=0;g<y;g++){const M=b-c;let N=0;const I=M>C?n:M*8-7,_=I&-8;let F=0,B=0;for(;N<_;N+=8)B=d[c++],w[h++]=B&128?E:D,w[h++]=B&64?E:D,w[h++]=B&32?E:D,w[h++]=B&16?E:D,w[h++]=B&8?E:D,w[h++]=B&4?E:D,w[h++]=B&2?E:D,w[h++]=B&1?E:D;for(;N<I;N++)F===0&&(B=d[c++],F=128),w[h++]=B&F?E:D,F>>=1}for(;h<S;)w[h++]=0;i.putImageData(l,0,p*nn)}}else if(e.kind===Dc.RGBA_32BPP){for(g=0,x=n*nn*4,p=0;p<r;p++)f.set(d.subarray(c,c+x)),c+=x,i.putImageData(l,0,g),g+=nn;p<a&&(x=n*s*4,f.set(d.subarray(c,c+x)),i.putImageData(l,0,g))}else if(e.kind===Dc.RGB_24BPP)for(y=nn,x=n*y,p=0;p<a;p++){for(p>=r&&(y=s,x=n*y),h=0,g=x;g--;)f[h++]=d[c++],f[h++]=d[c++],f[h++]=d[c++],f[h++]=255;i.putImageData(l,0,p*nn)}else throw new Error(`bad image kind: ${e.kind}`)}function Dw(i,e){if(e.bitmap){i.drawImage(e.bitmap,0,0);return}const t=e.height,n=e.width,s=t%nn,r=(t-s)/nn,a=s===0?r:r+1,l=i.createImageData(n,nn);let c=0;const h=e.data,d=l.data;for(let f=0;f<a;f++){const p=f<r?nn:s;({srcPos:c}=nz({src:h,srcPos:c,dest:d,width:n,height:p,nonBlackColor:0})),i.putImageData(l,0,f*nn)}}function tc(i,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of t)i[n]!==void 0&&(e[n]=i[n]);i.setLineDash!==void 0&&(e.setLineDash(i.getLineDash()),e.lineDashOffset=i.lineDashOffset)}function Jh(i){i.strokeStyle=i.fillStyle="#000000",i.fillRule="nonzero",i.globalAlpha=1,i.lineWidth=1,i.lineCap="butt",i.lineJoin="miter",i.miterLimit=10,i.globalCompositeOperation="source-over",i.font="10px sans-serif",i.setLineDash!==void 0&&(i.setLineDash([]),i.lineDashOffset=0);const{filter:e}=i;e!=="none"&&e!==""&&(i.filter="none")}function Rw(i,e){if(e)return!0;Ce.singularValueDecompose2dScale(i,pn);const t=Math.fround(ts.pixelRatio*Ca.PDF_TO_CSS_UNITS);return pn[0]<=t&&pn[1]<=t}const oz=["butt","round","square"],lz=["miter","round","bevel"],cz={},Nw={};class _o{constructor(e,t,n,s,r,{optionalContentConfig:a,markedContentStack:l=null},c,h,d){this.ctx=e,this.current=new Tw(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=s,this.filterFactory=r,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=l||[],this.optionalContentConfig=a,this.cachedCanvases=new az(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=c,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=d??null}getObject(e,t,n=null){return typeof t=="string"?(this.dependencyTracker?.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):n}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:s=null}){const r=this.ctx.canvas.width,a=this.ctx.canvas.height,l=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,r,a),this.ctx.fillStyle=l,n){const c=this.cachedCanvases.getCanvas("transparent",r,a);this.compositeCtx=this.ctx,this.transparentCanvas=c.canvas,this.ctx=c.context,this.ctx.save(),this.ctx.transform(...Ht(this.compositeCtx))}this.ctx.save(),Jh(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Ht(this.ctx)}executeOperatorList(e,t,n,s,r){const a=e.argsArray,l=e.fnArray;let c=t||0;const h=a.length;if(h===c)return c;const d=h-c>Ew&&typeof n=="function",f=d?Date.now()+sz:0;let p=0;const g=this.commonObjs,y=this.objs;let x,b;for(;;){if(s!==void 0&&c===s.nextBreakPoint)return s.breakIt(c,n),c;if(!r||r(c))if(x=l[c],b=a[c]??null,x!==jo.dependency)b===null?this[x](c):this[x](c,...b);else for(const w of b){this.dependencyTracker?.recordNamedData(w,c);const S=w.startsWith("g_")?g:y;if(!S.has(w))return S.get(w,n),c}if(c++,c===h)return c;if(d&&++p>Ew){if(Date.now()>f)return n(),c;p=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#t()}#t(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){const n=e.width??e.displayWidth,s=e.height??e.displayHeight;let r=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),l=n,c=s,h="prescale1",d,f;for(;r>2&&l>1||a>2&&c>1;){let p=l,g=c;r>2&&l>1&&(p=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2),r/=l/p),a>2&&c>1&&(g=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,a/=c/g),d=this.cachedCanvases.getCanvas(h,p,g),f=d.context,f.clearRect(0,0,p,g),f.drawImage(e,0,0,l,c,0,0,p,g),e=d.canvas,l=p,c=g,h=h==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:l,paintHeight:c}}_createMaskCanvas(e,t){const n=this.ctx,{width:s,height:r}=t,a=this.current.fillColor,l=this.current.patternFill,c=Ht(n);let h,d,f,p;if((t.bitmap||t.data)&&t.count>1){const F=t.bitmap||t.data.buffer;d=JSON.stringify(l?c:[c.slice(0,4),a]),h=this._cachedBitmapsMap.get(F),h||(h=new Map,this._cachedBitmapsMap.set(F,h));const B=h.get(d);if(B&&!l){const P=Math.round(Math.min(c[0],c[2])+c[4]),O=Math.round(Math.min(c[1],c[3])+c[5]);return this.dependencyTracker?.recordDependencies(e,Bn.transformAndFill),{canvas:B,offsetX:P,offsetY:O}}f=B}f||(p=this.cachedCanvases.getCanvas("maskCanvas",s,r),Dw(p.context,t));let g=Ce.transform(c,[1/s,0,0,-1/r,0,0]);g=Ce.transform(g,[1,0,0,1,0,-r]);const y=To.slice();Ce.axialAlignedBoundingBox([0,0,s,r],g,y);const[x,b,w,S]=y,C=Math.round(w-x)||1,E=Math.round(S-b)||1,D=this.cachedCanvases.getCanvas("fillCanvas",C,E),M=D.context,N=x,I=b;M.translate(-N,-I),M.transform(...g),f||(f=this._scaleImage(p.canvas,ls(M)),f=f.img,h&&l&&h.set(d,f)),M.imageSmoothingEnabled=Rw(Ht(M),t.interpolate),Zh(M,f,0,0,f.width,f.height,0,0,s,r),M.globalCompositeOperation="source-in";const _=Ce.transform(ls(M),[1,0,0,1,-N,-I]);return M.fillStyle=l?a.getPattern(n,this,_,_i.FILL,e):a,M.fillRect(0,0,s,r),h&&!l&&(this.cachedCanvases.delete("fillCanvas"),h.set(d,D.canvas)),this.dependencyTracker?.recordDependencies(e,Bn.transformAndFill),{canvas:D.canvas,offsetX:Math.round(N),offsetY:Math.round(I)}}setLineWidth(e,t){this.dependencyTracker?.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){this.dependencyTracker?.recordSimpleData("lineCap",e),this.ctx.lineCap=oz[t]}setLineJoin(e,t){this.dependencyTracker?.recordSimpleData("lineJoin",e),this.ctx.lineJoin=lz[t]}setMiterLimit(e,t){this.dependencyTracker?.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,n){this.dependencyTracker?.recordSimpleData("dash",e);const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(t),s.lineDashOffset=n)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){for(const[n,s]of t)switch(n){case"LW":this.setLineWidth(e,s);break;case"LC":this.setLineCap(e,s);break;case"LJ":this.setLineJoin(e,s);break;case"ML":this.setMiterLimit(e,s);break;case"D":this.setDash(e,s[0],s[1]);break;case"RI":this.setRenderingIntent(e,s);break;case"FL":this.setFlatness(e,s);break;case"Font":this.setFont(e,s[0],s[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=s;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=s;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=s;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",e),this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,n=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(s,t,n);this.suspendedCtx=this.ctx;const a=this.ctx=r.context;a.setTransform(this.suspendedCtx.getTransform()),tc(this.suspendedCtx,a),rz(a,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),tc(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,s){const r=s[0],a=s[1],l=s[2]-r,c=s[3]-a;l===0||c===0||(this.genericComposeSMask(t.context,n,l,c,t.subtype,t.backdrop,t.transferMap,r,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,s,r,a,l,c,h,d,f){let p=e.canvas,g=c-d,y=h-f;if(a)if(g<0||y<0||g+n>p.width||y+s>p.height){const b=this.cachedCanvases.getCanvas("maskExtension",n,s),w=b.context;w.drawImage(p,-g,-y),w.globalCompositeOperation="destination-atop",w.fillStyle=a,w.fillRect(0,0,n,s),w.globalCompositeOperation="source-over",p=b.canvas,g=y=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const b=new Path2D;b.rect(g,y,n,s),e.clip(b),e.globalCompositeOperation="destination-atop",e.fillStyle=a,e.fillRect(g,y,n,s),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),r==="Alpha"&&l?t.filter=this.filterFactory.addAlphaFilter(l):r==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(l));const x=new Path2D;x.rect(c,h,n,s),t.clip(x),t.globalCompositeOperation="destination-in",t.drawImage(p,g,y,n,s,c,h,n,s),t.restore()}save(e){this.inSMaskMode&&tc(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),this.dependencyTracker?.save(e)}restore(e){if(this.dependencyTracker?.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&tc(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,n,s,r,a,l){this.dependencyTracker?.recordIncrementalData("transform",e),this.ctx.transform(t,n,s,r,a,l),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n,s){let[r]=n;if(!s){r||=n[0]=new Path2D,this[t](e,r);return}if(this.dependencyTracker!==null){const a=t===jo.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,s[0]-a,s[2]+a,s[1]-a,s[3]+a).recordDependencies(e,["transform"])}if(!(r instanceof Path2D)){const a=n[0]=new Path2D;for(let l=0,c=r.length;l<c;)switch(r[l++]){case Yh.moveTo:a.moveTo(r[l++],r[l++]);break;case Yh.lineTo:a.lineTo(r[l++],r[l++]);break;case Yh.curveTo:a.bezierCurveTo(r[l++],r[l++],r[l++],r[l++],r[l++],r[l++]);break;case Yh.closePath:a.closePath();break;default:Xe(`Unrecognized drawing path operator: ${r[l-1]}`);break}r=a}Ce.axialAlignedBoundingBox(s,Ht(this.ctx),this.current.minMax),this[t](e,r),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,n=!0){const s=this.ctx,r=this.current.strokeColor;if(s.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof r=="object"&&r?.getPattern){const a=r.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.strokeStyle=r.getPattern(s,this,ls(s),_i.STROKE,e),a){const l=new Path2D;l.addPath(t,s.getTransform().invertSelf().multiplySelf(a)),t=l}this.rescaleAndStroke(t,!1),s.restore()}else this.rescaleAndStroke(t,!0);this.dependencyTracker?.recordDependencies(e,Bn.stroke),n&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(_i.STROKE,Ht(this.ctx))),s.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,n=!0){const s=this.ctx,r=this.current.fillColor,a=this.current.patternFill;let l=!1;if(a){const h=r.isModifyingCurrentTransform()?s.getTransform():null;if(this.dependencyTracker?.save(e),s.save(),s.fillStyle=r.getPattern(s,this,ls(s),_i.FILL,e),h){const d=new Path2D;d.addPath(t,s.getTransform().invertSelf().multiplySelf(h)),t=d}l=!0}const c=this.current.getClippedPathBoundingBox();this.contentVisible&&c!==null&&(this.pendingEOFill?(s.fill(t,"evenodd"),this.pendingEOFill=!1):s.fill(t)),this.dependencyTracker?.recordDependencies(e,Bn.fill),l&&(s.restore(),this.dependencyTracker?.restore(e)),n&&this.consumePath(e,t,c)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){this.ctx.fill(t),this.dependencyTracker?.recordDependencies(e,Bn.rawFillPath).recordOperation(e)}clip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=cz}eoClip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=Nw}beginText(e){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,n=this.ctx;if(this.dependencyTracker){const{dependencyTracker:s}=this;t!==void 0&&s.recordFutureForcedDependency("textClip",s.getOpenMarker()).recordFutureForcedDependency("textClip",e),s.recordCloseMarker(e)}if(t!==void 0){const s=new Path2D,r=n.getTransform().invertSelf();for(const{transform:a,x:l,y:c,fontSize:h,path:d}of t)d&&s.addPath(d,new DOMMatrix(a).preMultiplySelf(r).translate(l,c).scale(h,-h));n.clip(s)}delete this.pendingTextPaths}setCharSpacing(e,t){this.dependencyTracker?.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){this.dependencyTracker?.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){this.dependencyTracker?.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){this.dependencyTracker?.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,n){this.dependencyTracker?.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const s=this.commonObjs.get(t),r=this.current;if(!s)throw new Error(`Can't find font for ${t}`);if(r.fontMatrix=s.fontMatrix||Ag,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&Xe("Invalid font matrix for font "+t),n<0?(n=-n,r.fontDirection=-1):r.fontDirection=1,this.current.font=s,this.current.fontSize=n,s.isType3Font)return;const a=s.loadedName||"sans-serif",l=s.systemFontInfo?.css||`"${a}", ${s.fallbackName}`;let c="normal";s.black?c="900":s.bold&&(c="bold");const h=s.italic?"italic":"normal";let d=n;n<Sw?d=Sw:n>Cw&&(d=Cw),this.current.fontSizeScale=n/d,this.ctx.font=`${h} ${c} ${d}px ${l}`}setTextRenderingMode(e,t){this.dependencyTracker?.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){this.dependencyTracker?.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,n){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=n}setLeadingMoveText(e,t,n){this.setLeading(e,-n),this.moveText(e,t,n)}setTextMatrix(e,t){this.dependencyTracker?.recordSimpleData("textMatrix",e);const{current:n}=this;n.textMatrix=t,n.textMatrixScale=Math.hypot(t[0],t[1]),n.x=n.lineX=0,n.y=n.lineY=0}nextLine(e){this.moveText(e,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}#n(e,t,n){const s=new Path2D;return s.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),s}paintChar(e,t,n,s,r,a){const l=this.ctx,c=this.current,h=c.font,d=c.textRenderingMode,f=c.fontSize/c.fontSizeScale,p=d&Ri.FILL_STROKE_MASK,g=!!(d&Ri.ADD_TO_PATH_FLAG),y=c.patternFill&&!h.missingFile,x=c.patternStroke&&!h.missingFile;let b;if((h.disableFontFace||g||y||x)&&!h.missingFile&&(b=h.getPathGenerator(this.commonObjs,t)),b&&(h.disableFontFace||y||x)){l.save(),l.translate(n,s),l.scale(f,-f),this.dependencyTracker?.recordCharacterBBox(e,l,h);let w;if(p===Ri.FILL||p===Ri.FILL_STROKE)if(r){w=l.getTransform(),l.setTransform(...r);const S=this.#n(b,w,r);l.fill(S)}else l.fill(b);if(p===Ri.STROKE||p===Ri.FILL_STROKE)if(a){w||=l.getTransform(),l.setTransform(...a);const{a:S,b:C,c:E,d:D}=w,M=Ce.inverseTransform(a),N=Ce.transform([S,C,E,D,0,0],M);Ce.singularValueDecompose2dScale(N,pn),l.lineWidth*=Math.max(pn[0],pn[1])/f,l.stroke(this.#n(b,w,a))}else l.lineWidth/=f,l.stroke(b);l.restore()}else(p===Ri.FILL||p===Ri.FILL_STROKE)&&(l.fillText(t,n,s),this.dependencyTracker?.recordCharacterBBox(e,l,h,f,n,s,()=>l.measureText(t))),(p===Ri.STROKE||p===Ri.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(e,l,h,f,n,s,()=>l.measureText(t)).recordDependencies(e,Bn.stroke),l.strokeText(t,n,s));g&&((this.pendingTextPaths||=[]).push({transform:Ht(l),x:n,y:s,fontSize:f,path:b}),this.dependencyTracker?.recordCharacterBBox(e,l,h,f,n,s))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let n=!1;for(let s=3;s<t.length;s+=4)if(t[s]>0&&t[s]<255){n=!0;break}return Je(this,"isFontSubpixelAAEnabled",n)}showText(e,t){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,Bn.showText).resetBBox(e),this.current.textRenderingMode&Ri.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const n=this.current,s=n.font;if(s.isType3Font){this.showType3Text(e,t),this.dependencyTracker?.recordShowTextOperation(e);return}const r=n.fontSize;if(r===0){this.dependencyTracker?.recordOperation(e);return}const a=this.ctx,l=n.fontSizeScale,c=n.charSpacing,h=n.wordSpacing,d=n.fontDirection,f=n.textHScale*d,p=t.length,g=s.vertical,y=g?1:-1,x=s.defaultVMetrics,b=r*n.fontMatrix[0],w=n.textRenderingMode===Ri.FILL&&!s.disableFontFace&&!n.patternFill;a.save(),n.textMatrix&&a.transform(...n.textMatrix),a.translate(n.x,n.y+n.textRise),d>0?a.scale(f,-1):a.scale(f,1);let S,C;if(n.patternFill){a.save();const I=n.fillColor.getPattern(a,this,ls(a),_i.FILL,e);S=Ht(a),a.restore(),a.fillStyle=I}if(n.patternStroke){a.save();const I=n.strokeColor.getPattern(a,this,ls(a),_i.STROKE,e);C=Ht(a),a.restore(),a.strokeStyle=I}let E=n.lineWidth;const D=n.textMatrixScale;if(D===0||E===0){const I=n.textRenderingMode&Ri.FILL_STROKE_MASK;(I===Ri.STROKE||I===Ri.FILL_STROKE)&&(E=this.getSinglePixelWidth())}else E/=D;if(l!==1&&(a.scale(l,l),E/=l),a.lineWidth=E,s.isInvalidPDFjsFont){const I=[];let _=0;for(const B of t)I.push(B.unicode),_+=B.width;const F=I.join("");if(a.fillText(F,0,0),this.dependencyTracker!==null){const B=a.measureText(F);this.dependencyTracker.recordBBox(e,this.ctx,-B.actualBoundingBoxLeft,B.actualBoundingBoxRight,-B.actualBoundingBoxAscent,B.actualBoundingBoxDescent).recordShowTextOperation(e)}n.x+=_*b*f,a.restore(),this.compose();return}let M=0,N;for(N=0;N<p;++N){const I=t[N];if(typeof I=="number"){M+=y*I*r/1e3;continue}let _=!1;const F=(I.isSpace?h:0)+c,B=I.fontChar,P=I.accent;let O,k,q=I.width;if(g){const Y=I.vmetric||x,Q=-(I.vmetric?Y[1]:q*.5)*b,te=Y[2]*b;q=Y?-Y[0]:q,O=Q/l,k=(M+te)/l}else O=M/l,k=0;let U;if(s.remeasure&&q>0){U=a.measureText(B);const Y=U.width*1e3/r*l;if(q<Y&&this.isFontSubpixelAAEnabled){const Q=q/Y;_=!0,a.save(),a.scale(Q,1),O/=Q}else q!==Y&&(O+=(q-Y)/2e3*r/l)}if(this.contentVisible&&(I.isInFont||s.missingFile)){if(w&&!P)a.fillText(B,O,k),this.dependencyTracker?.recordCharacterBBox(e,a,U?{bbox:null}:s,r/l,O,k,()=>U??a.measureText(B));else if(this.paintChar(e,B,O,k,S,C),P){const Y=O+r*P.offset.x/l,Q=k-r*P.offset.y/l;this.paintChar(e,P.fontChar,Y,Q,S,C)}}const H=g?q*b-F*d:q*b+F*d;M+=H,_&&a.restore()}g?n.y-=M:n.x+=M*f,a.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(e)}showType3Text(e,t){const n=this.ctx,s=this.current,r=s.font,a=s.fontSize,l=s.fontDirection,c=r.vertical?1:-1,h=s.charSpacing,d=s.wordSpacing,f=s.textHScale*l,p=s.fontMatrix||Ag,g=t.length,y=s.textRenderingMode===Ri.INVISIBLE;let x,b,w,S;if(y||a===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),s.textMatrix&&n.transform(...s.textMatrix),n.translate(s.x,s.y+s.textRise),n.scale(f,l);const C=this.dependencyTracker;for(this.dependencyTracker=C?new Gd(C,e):null,x=0;x<g;++x){if(b=t[x],typeof b=="number"){S=c*b*a/1e3,this.ctx.translate(S,0),s.x+=S*f;continue}const E=(b.isSpace?d:0)+h,D=r.charProcOperatorList[b.operatorListId];D?this.contentVisible&&(this.save(),n.scale(a,a),n.transform(...p),this.executeOperatorList(D),this.restore()):Xe(`Type3 character "${b.operatorListId}" is not available.`);const M=[b.width,0];Ce.applyTransform(M,p),w=M[0]*a+E,n.translate(w,0),s.x+=w*f}n.restore(),C&&(this.dependencyTracker=C)}setCharWidth(e,t,n){}setCharWidthAndBounds(e,t,n,s,r,a,l){const c=new Path2D;c.rect(s,r,a-s,l-r),this.ctx.clip(c),this.dependencyTracker?.recordBBox(e,this.ctx,s,a,r,l).recordClipBox(e,this.ctx,s,a,r,l),this.endPath(e)}getColorN_Pattern(e,t){let n;if(t[0]==="TilingPattern"){const s=this.baseTransform||Ht(this.ctx),r={createCanvasGraphics:(a,l)=>new _o(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new Gd(this.dependencyTracker,l,!0):null)};n=new K1(t,this.ctx,r,s)}else n=this._getPattern(e,t[1],t[2]);return n}setStrokeColorN(e,...t){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){this.dependencyTracker?.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,n=null){let s;return this.cachedPatterns.has(t)?s=this.cachedPatterns.get(t):(s=iz(this.getObject(e,t)),this.cachedPatterns.set(t,s)),n&&(s.matrix=n),s}shadingFill(e,t){if(!this.contentVisible)return;const n=this.ctx;this.save(e);const s=this._getPattern(e,t);n.fillStyle=s.getPattern(n,this,ls(n),_i.SHADING,e);const r=ls(n);if(r){const{width:a,height:l}=n.canvas,c=To.slice();Ce.axialAlignedBoundingBox([0,0,a,l],r,c);const[h,d,f,p]=c;this.ctx.fillRect(h,d,f-h,p-d)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,Bn.transform).recordDependencies(e,Bn.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){Nt("Should not call beginInlineImage")}beginImageData(){Nt("Should not call beginImageData")}paintFormXObjectBegin(e,t,n){if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=Ht(this.ctx),n)){Ce.axialAlignedBoundingBox(n,this.baseTransform,this.current.minMax);const[s,r,a,l]=n,c=new Path2D;c.rect(s,r,a-s,l-r),this.ctx.clip(c),this.dependencyTracker?.recordClipBox(e,this.ctx,s,a,r,l),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;t.isolated||yf("TODO: Support non-isolated groups."),t.knockout&&Xe("Knockout groups not supported.");const s=Ht(n);if(t.matrix&&n.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let r=To.slice();Ce.axialAlignedBoundingBox(t.bbox,Ht(n),r);const a=[0,0,n.canvas.width,n.canvas.height];r=Ce.intersect(r,a)||[0,0,0,0];const l=Math.floor(r[0]),c=Math.floor(r[1]),h=Math.max(Math.ceil(r[2])-l,1),d=Math.max(Math.ceil(r[3])-c,1);this.current.startNewPathAndClipBox([0,0,h,d]);let f="groupAt"+this.groupLevel;t.smask&&(f+="_smask_"+this.smaskCounter++%2);const p=this.cachedCanvases.getCanvas(f,h,d),g=p.context;g.translate(-l,-c),g.transform(...s);let y=new Path2D;const[x,b,w,S]=t.bbox;if(y.rect(x,b,w-x,S-b),t.matrix){const C=new Path2D;C.addPath(y,new DOMMatrix(t.matrix)),y=C}g.clip(y),t.smask&&this.smaskStack.push({canvas:p.canvas,context:g,offsetX:l,offsetY:c,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(n.setTransform(1,0,0,1,0,0),n.translate(l,c),n.save()),tc(n,g),this.ctx=g,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(n),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(e,t){if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const r=Ht(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...r);const a=To.slice();Ce.axialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],r,a),this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(a)}}beginAnnotation(e,t,n,s,r,a){if(this.#e(),Jh(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),n){const l=n[2]-n[0],c=n[3]-n[1];if(a&&this.annotationCanvasMap){s=s.slice(),s[4]-=n[0],s[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=l,n[3]=c,Ce.singularValueDecompose2dScale(Ht(this.ctx),pn);const{viewportScale:h}=this,d=Math.ceil(l*this.outputScaleX*h),f=Math.ceil(c*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(d,f);const{canvas:p,context:g}=this.annotationCanvas;this.annotationCanvasMap.set(t,p),this.annotationCanvas.savedCtx=this.ctx,this.ctx=g,this.ctx.save(),this.ctx.setTransform(pn[0],0,0,-pn[1],0,c*pn[1]),Jh(this.ctx)}else{Jh(this.ctx),this.endPath(e);const h=new Path2D;h.rect(n[0],n[1],l,c),this.ctx.clip(h)}}this.current=new Tw(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...s),this.transform(e,...r)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),this.#t(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){if(!this.contentVisible)return;const n=t.count;t=this.getObject(e,t.data,t),t.count=n;const s=this.ctx,r=this._createMaskCanvas(e,t),a=r.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(a,r.offsetX,r.offsetY),this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,r.offsetX,r.offsetX+a.width,r.offsetY,r.offsetY+a.height).recordOperation(e),s.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n,s=0,r=0,a,l){if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const c=this.ctx;c.save();const h=Ht(c);c.transform(n,s,r,a,0,0);const d=this._createMaskCanvas(e,t);c.setTransform(1,0,0,1,d.offsetX-h[4],d.offsetY-h[5]),this.dependencyTracker?.resetBBox(e);for(let f=0,p=l.length;f<p;f+=2){const g=Ce.transform(h,[n,s,r,a,l[f],l[f+1]]);c.drawImage(d.canvas,g[4],g[5]),this.dependencyTracker?.recordBBox(e,this.ctx,g[4],g[4]+d.canvas.width,g[5],g[5]+d.canvas.height)}c.restore(),this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageMaskXObjectGroup(e,t){if(!this.contentVisible)return;const n=this.ctx,s=this.current.fillColor,r=this.current.patternFill;this.dependencyTracker?.resetBBox(e).recordDependencies(e,Bn.transformAndFill);for(const a of t){const{data:l,width:c,height:h,transform:d}=a,f=this.cachedCanvases.getCanvas("maskCanvas",c,h),p=f.context;p.save();const g=this.getObject(e,l,a);Dw(p,g),p.globalCompositeOperation="source-in",p.fillStyle=r?s.getPattern(p,this,ls(n),_i.FILL,e):s,p.fillRect(0,0,c,h),p.restore(),n.save(),n.transform(...d),n.scale(1,-1),Zh(n,f.canvas,0,0,c,h,0,-1,1,1),this.dependencyTracker?.recordBBox(e,n,0,c,0,h),n.restore()}this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const n=this.getObject(e,t);if(!n){Xe("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,n)}paintImageXObjectRepeat(e,t,n,s,r){if(!this.contentVisible)return;const a=this.getObject(e,t);if(!a){Xe("Dependent image isn't ready yet");return}const l=a.width,c=a.height,h=[];for(let d=0,f=r.length;d<f;d+=2)h.push({transform:[n,0,0,s,r[d],r[d+1]],x:0,y:0,w:l,h:c});this.paintInlineImageXObjectGroup(e,a,h)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:n,height:s}=e,r=this.cachedCanvases.getCanvas("inlineImage",n,s),a=r.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",r.canvas}paintInlineImageXObject(e,t){if(!this.contentVisible)return;const n=t.width,s=t.height,r=this.ctx;this.save(e);const{filter:a}=r;a!=="none"&&a!==""&&(r.filter="none"),r.scale(1/n,-1/s);let l;if(t.bitmap)l=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)l=t;else{const d=this.cachedCanvases.getCanvas("inlineImage",n,s).context;Mw(d,t),l=this.applyTransferMapsToCanvas(d)}const c=this._scaleImage(l,ls(r));r.imageSmoothingEnabled=Rw(Ht(r),t.interpolate),this.dependencyTracker?.resetBBox(e).recordBBox(e,r,0,n,-s,0).recordDependencies(e,Bn.imageXObject).recordOperation(e),Zh(r,c.img,0,0,c.paintWidth,c.paintHeight,0,-s,n,s),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,n){if(!this.contentVisible)return;const s=this.ctx;let r;if(t.bitmap)r=t.bitmap;else{const a=t.width,l=t.height,h=this.cachedCanvases.getCanvas("inlineImage",a,l).context;Mw(h,t),r=this.applyTransferMapsToCanvas(h)}this.dependencyTracker?.resetBBox(e);for(const a of n)s.save(),s.transform(...a.transform),s.scale(1,-1),Zh(s,r,a.x,a.y,a.w,a.h,0,-1,1,1),this.dependencyTracker?.recordBBox(e,s,0,1,-1,0),s.restore();this.dependencyTracker?.recordOperation(e),this.compose()}paintSolidColorImageMask(e){this.contentVisible&&(this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,Bn.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,n){}beginMarkedContent(e,t){this.dependencyTracker?.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,n){this.dependencyTracker?.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){this.dependencyTracker?.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,n){const s=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(n);const r=this.ctx;this.pendingClip?(s||(this.pendingClip===Nw?r.clip(t,"evenodd"):r.clip(t)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):this.dependencyTracker?.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Ht(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),s=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,s)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:n,c:s,d:r}=this.ctx.getTransform();let a,l;if(n===0&&s===0){const c=Math.abs(t),h=Math.abs(r);if(c===h)if(e===0)a=l=1/c;else{const d=c*e;a=l=d<1?1/d:1}else if(e===0)a=1/c,l=1/h;else{const d=c*e,f=h*e;a=d<1?1/d:1,l=f<1?1/f:1}}else{const c=Math.abs(t*r-n*s),h=Math.hypot(t,n),d=Math.hypot(s,r);if(e===0)a=d/c,l=h/c;else{const f=e*c;a=d>f?d/f:1,l=h>f?h/f:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=l}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:n,current:{lineWidth:s}}=this,[r,a]=this.getScaleForStroking();if(r===a){n.lineWidth=(s||1)*r,n.stroke(e);return}const l=n.getLineDash();t&&n.save(),n.scale(r,a),B0.a=1/r,B0.d=1/a;const c=new Path2D;if(c.addPath(e,B0),l.length>0){const h=Math.max(r,a);n.setLineDash(l.map(d=>d/h)),n.lineDashOffset/=h}n.lineWidth=s||1,n.stroke(c),t&&n.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const i in jo)_o.prototype[i]!==void 0&&(_o.prototype[jo[i]]=_o.prototype[i]);class Fo{#e;#t;#n;static strings=["fontFamily","fontWeight","italicAngle"];static write(e){const t=new TextEncoder,n={};let s=0;for(const h of Fo.strings){const d=t.encode(e[h]);n[h]=d,s+=4+d.length}const r=new ArrayBuffer(s),a=new Uint8Array(r),l=new DataView(r);let c=0;for(const h of Fo.strings){const d=n[h],f=d.length;l.setUint32(c,f),a.set(d,c+4),c+=4+f}return ut(c===r.byteLength,"CssFontInfo.write: Buffer overflow"),r}constructor(e){this.#e=e,this.#t=new DataView(this.#e),this.#n=new TextDecoder}#i(e){ut(e<Fo.strings.length,"Invalid string index");let t=0;for(let s=0;s<e;s++)t+=this.#t.getUint32(t)+4;const n=this.#t.getUint32(t);return this.#n.decode(new Uint8Array(this.#e,t+4,n))}get fontFamily(){return this.#i(0)}get fontWeight(){return this.#i(1)}get italicAngle(){return this.#i(2)}}class Po{#e;#t;#n;static strings=["css","loadedName","baseFontName","src"];static write(e){const t=new TextEncoder,n={};let s=0;for(const p of Po.strings){const g=t.encode(e[p]);n[p]=g,s+=4+g.length}s+=4;let r,a,l=1+s;e.style&&(r=t.encode(e.style.style),a=t.encode(e.style.weight),l+=4+r.length+4+a.length);const c=new ArrayBuffer(l),h=new Uint8Array(c),d=new DataView(c);let f=0;d.setUint8(f++,e.guessFallback?1:0),d.setUint32(f,0),f+=4,s=0;for(const p of Po.strings){const g=n[p],y=g.length;s+=4+y,d.setUint32(f,y),h.set(g,f+4),f+=4+y}return d.setUint32(f-s-4,s),e.style&&(d.setUint32(f,r.length),h.set(r,f+4),f+=4+r.length,d.setUint32(f,a.length),h.set(a,f+4),f+=4+a.length),ut(f<=c.byteLength,"SubstitionInfo.write: Buffer overflow"),c.transferToFixedLength(f)}constructor(e){this.#e=e,this.#t=new DataView(this.#e),this.#n=new TextDecoder}get guessFallback(){return this.#t.getUint8(0)!==0}#i(e){ut(e<Po.strings.length,"Invalid string index");let t=5;for(let s=0;s<e;s++)t+=this.#t.getUint32(t)+4;const n=this.#t.getUint32(t);return this.#n.decode(new Uint8Array(this.#e,t+4,n))}get css(){return this.#i(0)}get loadedName(){return this.#i(1)}get baseFontName(){return this.#i(2)}get src(){return this.#i(3)}get style(){let e=1;e+=4+this.#t.getUint32(e);const t=this.#t.getUint32(e),n=this.#n.decode(new Uint8Array(this.#e,e+4,t));e+=4+t;const s=this.#t.getUint32(e),r=this.#n.decode(new Uint8Array(this.#e,e+4,s));return{style:n,weight:r}}}class Mt{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#e=Math.ceil(this.bools.length*2/8);static#t=this.#e+this.numbers.length*8;static#n=this.#t+1+8;static#i=this.#n+1+48;static#r=this.#i+1+6;#s;#a;#o;constructor({data:e,extra:t}){this.#s=e,this.#a=new TextDecoder,this.#o=new DataView(this.#s),t&&Object.assign(this,t)}#c(e){ut(e<Mt.bools.length,"Invalid boolean index");const t=Math.floor(e/4),n=e*2%8,s=this.#o.getUint8(t)>>n&3;return s===0?void 0:s===2}get black(){return this.#c(0)}get bold(){return this.#c(1)}get disableFontFace(){return this.#c(2)}get fontExtraProperties(){return this.#c(3)}get isInvalidPDFjsFont(){return this.#c(4)}get isType3Font(){return this.#c(5)}get italic(){return this.#c(6)}get missingFile(){return this.#c(7)}get remeasure(){return this.#c(8)}get vertical(){return this.#c(9)}#l(e){return ut(e<Mt.numbers.length,"Invalid number index"),this.#o.getFloat64(Mt.#e+e*8)}get ascent(){return this.#l(0)}get defaultWidth(){return this.#l(1)}get descent(){return this.#l(2)}get bbox(){let e=Mt.#t;if(this.#o.getUint8(e)===0)return;e+=1;const n=[];for(let s=0;s<4;s++)n.push(this.#o.getInt16(e,!0)),e+=2;return n}get fontMatrix(){let e=Mt.#n;if(this.#o.getUint8(e)===0)return;e+=1;const n=[];for(let s=0;s<6;s++)n.push(this.#o.getFloat64(e,!0)),e+=8;return n}get defaultVMetrics(){let e=Mt.#i;if(this.#o.getUint8(e)===0)return;e+=1;const n=[];for(let s=0;s<3;s++)n.push(this.#o.getInt16(e,!0)),e+=2;return n}#d(e){ut(e<Mt.strings.length,"Invalid string index");let t=Mt.#r+4;for(let r=0;r<e;r++)t+=this.#o.getUint32(t)+4;const n=this.#o.getUint32(t),s=new Uint8Array(n);return s.set(new Uint8Array(this.#s,t+4,n)),this.#a.decode(s)}get fallbackName(){return this.#d(0)}get loadedName(){return this.#d(1)}get mimetype(){return this.#d(2)}get name(){return this.#d(3)}get data(){let e=Mt.#r;const t=this.#o.getUint32(e);e+=4+t;const n=this.#o.getUint32(e);e+=4+n;const s=this.#o.getUint32(e);e+=4+s;const r=this.#o.getUint32(e);if(r!==0)return new Uint8Array(this.#s,e+4,r)}clearData(){let e=Mt.#r;const t=this.#o.getUint32(e);e+=4+t;const n=this.#o.getUint32(e);e+=4+n;const s=this.#o.getUint32(e);e+=4+s;const r=this.#o.getUint32(e);new Uint8Array(this.#s,e+4,r).fill(0),this.#o.setUint32(e,0)}get cssFontInfo(){let e=Mt.#r;const t=this.#o.getUint32(e);e+=4+t;const n=this.#o.getUint32(e);e+=4+n;const s=this.#o.getUint32(e);if(s===0)return null;const r=new Uint8Array(s);return r.set(new Uint8Array(this.#s,e+4,s)),new Fo(r.buffer)}get systemFontInfo(){let e=Mt.#r;const t=this.#o.getUint32(e);e+=4+t;const n=this.#o.getUint32(e);if(n===0)return null;const s=new Uint8Array(n);return s.set(new Uint8Array(this.#s,e+4,n)),new Po(s.buffer)}static write(e){const t=e.systemFontInfo?Po.write(e.systemFontInfo):null,n=e.cssFontInfo?Fo.write(e.cssFontInfo):null,s=new TextEncoder,r={};let a=0;for(const x of Mt.strings)r[x]=s.encode(e[x]),a+=4+r[x].length;const l=Mt.#r+4+a+4+(t?t.byteLength:0)+4+(n?n.byteLength:0)+4+(e.data?e.data.length:0),c=new ArrayBuffer(l),h=new Uint8Array(c),d=new DataView(c);let f=0;const p=Mt.bools.length;let g=0,y=0;for(let x=0;x<p;x++){const b=e[Mt.bools[x]];g|=(b===void 0?0:b?2:1)<<y,y+=2,(y===8||x===p-1)&&(d.setUint8(f++,g),g=0,y=0)}ut(f===Mt.#e,"FontInfo.write: Boolean properties offset mismatch");for(const x of Mt.numbers)d.setFloat64(f,e[x]),f+=8;if(ut(f===Mt.#t,"FontInfo.write: Number properties offset mismatch"),e.bbox){d.setUint8(f++,4);for(const x of e.bbox)d.setInt16(f,x,!0),f+=2}else d.setUint8(f++,0),f+=8;if(ut(f===Mt.#n,"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){d.setUint8(f++,6);for(const x of e.fontMatrix)d.setFloat64(f,x,!0),f+=8}else d.setUint8(f++,0),f+=48;if(ut(f===Mt.#i,"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){d.setUint8(f++,1);for(const x of e.defaultVMetrics)d.setInt16(f,x,!0),f+=2}else d.setUint8(f++,0),f+=6;ut(f===Mt.#r,"FontInfo.write: DefaultVMetrics properties offset mismatch"),d.setUint32(Mt.#r,0),f+=4;for(const x of Mt.strings){const b=r[x],w=b.length;d.setUint32(f,w),h.set(b,f+4),f+=4+w}if(d.setUint32(Mt.#r,f-Mt.#r-4),!t)d.setUint32(f,0),f+=4;else{const x=t.byteLength;d.setUint32(f,x),ut(f+4+x<=c.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),h.set(new Uint8Array(t),f+4),f+=4+x}if(!n)d.setUint32(f,0),f+=4;else{const x=n.byteLength;d.setUint32(f,x),ut(f+4+x<=c.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),h.set(new Uint8Array(n),f+4),f+=4+x}return e.data===void 0?(d.setUint32(f,0),f+=4):(d.setUint32(f,e.data.length),h.set(e.data,f+4),f+=4+e.data.length),ut(f<=c.byteLength,"FontInfo.write: Buffer overflow"),c.transferToFixedLength(f)}}class Pr{static#e=null;static#t="";static get workerPort(){return this.#e}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");this.#e=e}static get workerSrc(){return this.#t}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");this.#t=e}}class uz{#e;#t;constructor({parsedData:e,rawData:t}){this.#e=e,this.#t=t}getRaw(){return this.#t}get(e){return this.#e.get(e)??null}[Symbol.iterator](){return this.#e.entries()}}const Co=Symbol("INTERNAL");class hz{#e=!1;#t=!1;#n=!1;#i=!0;constructor(e,{name:t,intent:n,usage:s,rbGroups:r}){this.#e=!!(e&fn.DISPLAY),this.#t=!!(e&fn.PRINT),this.name=t,this.intent=n,this.usage=s,this.rbGroups=r}get visible(){if(this.#n)return this.#i;if(!this.#i)return!1;const{print:e,view:t}=this.usage;return this.#e?t?.viewState!=="OFF":this.#t?e?.printState!=="OFF":!0}_setVisible(e,t,n=!1){e!==Co&&Nt("Internal method `_setVisible` called."),this.#n=n,this.#i=t}}class dz{#e=null;#t=new Map;#n=null;#i=null;constructor(e,t=fn.DISPLAY){if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,this.#i=e.order;for(const n of e.groups)this.#t.set(n.id,new hz(t,n));if(e.baseState==="OFF")for(const n of this.#t.values())n._setVisible(Co,!1);for(const n of e.on)this.#t.get(n)._setVisible(Co,!0);for(const n of e.off)this.#t.get(n)._setVisible(Co,!1);this.#n=this.getHash()}}#r(e){const t=e.length;if(t<2)return!0;const n=e[0];for(let s=1;s<t;s++){const r=e[s];let a;if(Array.isArray(r))a=this.#r(r);else if(this.#t.has(r))a=this.#t.get(r).visible;else return Xe(`Optional content group not found: ${r}`),!0;switch(n){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return n==="And"}isVisible(e){if(this.#t.size===0)return!0;if(!e)return yf("Optional content group not defined."),!0;if(e.type==="OCG")return this.#t.has(e.id)?this.#t.get(e.id).visible:(Xe(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return this.#r(e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!this.#t.has(t))return Xe(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!this.#t.has(t))return Xe(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!this.#t.has(t))return Xe(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!this.#t.has(t))return Xe(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!1}return!0}return Xe(`Unknown optional content policy ${e.policy}.`),!0}return Xe(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){const s=this.#t.get(e);if(!s){Xe(`Optional content group not found: ${e}`);return}if(n&&t&&s.rbGroups.length)for(const r of s.rbGroups)for(const a of r)a!==e&&this.#t.get(a)?._setVisible(Co,!1,!0);s._setVisible(Co,!!t,!0),this.#e=null}setOCGState({state:e,preserveRB:t}){let n;for(const s of e){switch(s){case"ON":case"OFF":case"Toggle":n=s;continue}const r=this.#t.get(s);if(r)switch(n){case"ON":this.setVisibility(s,!0,t);break;case"OFF":this.setVisibility(s,!1,t);break;case"Toggle":this.setVisibility(s,!r.visible,t);break}}this.#e=null}get hasInitialVisibility(){return this.#n===null||this.getHash()===this.#n}getOrder(){return this.#t.size?this.#i?this.#i.slice():[...this.#t.keys()]:null}getGroup(e){return this.#t.get(e)||null}getHash(){if(this.#e!==null)return this.#e;const e=new P4;for(const[t,n]of this.#t)e.update(`${t}:${n.visible}`);return this.#e=e.hexdigest()}[Symbol.iterator](){return this.#t.entries()}}class fz{constructor(e,{disableRange:t=!1,disableStream:n=!1}){ut(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:r,progressiveDone:a,contentDispositionFilename:l}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=l,r?.length>0){const c=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(c)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((c,h)=>{this._onReceiveData({begin:c,chunk:h})}),e.addProgressListener((c,h)=>{this._onProgress({loaded:c,total:h})}),e.addProgressiveReadListener(c=>{this._onReceiveData({chunk:c})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const s=this._rangeReaders.some(function(r){return r._begin!==e?!1:(r._enqueue(n),!0)});ut(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){e.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){ut(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new mz(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new pz(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}}class mz{constructor(e,t,n=!1,s=null){this._stream=e,this._done=n||!1,this._filename=bf(s)?s:null,this._queuedChunks=t||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class pz{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function gz(i){let e=!0,t=n("filename\\*","i").exec(i);if(t){t=t[1];let d=l(t);return d=unescape(d),d=c(d),d=h(d),r(d)}if(t=a(i),t){const d=h(t);return r(d)}if(t=n("filename","i").exec(i),t){t=t[1];let d=l(t);return d=h(d),r(d)}function n(d,f){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',f)}function s(d,f){if(d){if(!/^[\x00-\xFF]+$/.test(f))return f;try{const p=new TextDecoder(d,{fatal:!0}),g=lu(f);f=p.decode(g),e=!1}catch{}}return f}function r(d){return e&&/[\x80-\xff]/.test(d)&&(d=s("utf-8",d),e&&(d=s("iso-8859-1",d))),d}function a(d){const f=[];let p;const g=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(p=g.exec(d))!==null;){let[,x,b,w]=p;if(x=parseInt(x,10),x in f){if(x===0)break;continue}f[x]=[b,w]}const y=[];for(let x=0;x<f.length&&x in f;++x){let[b,w]=f[x];w=l(w),b&&(w=unescape(w),x===0&&(w=c(w))),y.push(w)}return y.join("")}function l(d){if(d.startsWith('"')){const f=d.slice(1).split('\\"');for(let p=0;p<f.length;++p){const g=f[p].indexOf('"');g!==-1&&(f[p]=f[p].slice(0,g),f.length=p+1),f[p]=f[p].replaceAll(/\\(.)/g,"$1")}d=f.join('"')}return d}function c(d){const f=d.indexOf("'");if(f===-1)return d;const p=d.slice(0,f),y=d.slice(f+1).replace(/^[^']*'/,"");return s(p,y)}function h(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(f,p,g,y){if(g==="q"||g==="Q")return y=y.replaceAll("_"," "),y=y.replaceAll(/=([0-9a-fA-F]{2})/g,function(x,b){return String.fromCharCode(parseInt(b,16))}),s(p,y);try{y=atob(y)}catch{}return s(p,y)})}return""}function z4(i,e){const t=new Headers;if(!i||!e||typeof e!="object")return t;for(const n in e){const s=e[n];s!==void 0&&t.append(n,s)}return t}function wf(i){return URL.parse(i)?.origin??null}function G4({responseHeaders:i,isHttp:e,rangeChunkSize:t,disableRange:n}){const s={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(i.get("Content-Length"),10);return!Number.isInteger(r)||(s.suggestedLength=r,r<=2*t)||n||!e||i.get("Accept-Ranges")!=="bytes"||(i.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function H4(i){const e=i.get("Content-Disposition");if(e){let t=gz(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(bf(t))return t}return null}function fu(i,e){return new Vc(`Unexpected server response (${i}) while retrieving PDF "${e}".`,i,i===404||i===0&&e.startsWith("file:"))}function Y4(i){return i===200||i===206}function q4(i,e,t){return{method:"GET",headers:i,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function X4(i){return i instanceof Uint8Array?i.buffer:i instanceof ArrayBuffer?i:(Xe(`getArrayBuffer - unexpected data format: ${i}`),new Uint8Array(i).buffer)}class Az{_responseOrigin=null;constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=z4(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ut(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new vz(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new yz(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class vz{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const n=new Headers(e.headers),s=t.url;fetch(s,q4(n,this._withCredentials,this._abortController)).then(r=>{if(e._responseOrigin=wf(r.url),!Y4(r.status))throw fu(r.status,s);this._reader=r.body.getReader(),this._headersCapability.resolve();const a=r.headers,{allowRangeRequests:l,suggestedLength:c}=G4({responseHeaders:a,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=l,this._contentLength=c||this._contentLength,this._filename=H4(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Zs("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:X4(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class yz{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;const s=e.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;const r=new Headers(e.headers);r.append("Range",`bytes=${t}-${n-1}`);const a=s.url;fetch(a,q4(r,this._withCredentials,this._abortController)).then(l=>{const c=wf(l.url);if(c!==e._responseOrigin)throw new Error(`Expected range response-origin "${c}" to match "${e._responseOrigin}".`);if(!Y4(l.status))throw fu(l.status,a);this._readCapability.resolve(),this._reader=l.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:X4(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}const L0=200,k0=206;function xz(i){const e=i.response;return typeof e!="string"?e:lu(e).buffer}class bz{_responseOrigin=null;constructor({url:e,httpHeaders:t,withCredentials:n}){this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=z4(this.isHttp,t),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,n=this.currXhrId++,s=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[r,a]of this.headers)t.setRequestHeader(r,a);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),s.expectedStatus=k0):s.expectedStatus=L0,t.responseType="arraybuffer",ut(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),s.onHeadersReceived=e.onHeadersReceived,s.onDone=e.onDone,s.onError=e.onError,s.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){const n=this.pendingRequests[e];n&&n.onProgress?.(t)}onStateChange(e,t){const n=this.pendingRequests[e];if(!n)return;const s=n.xhr;if(s.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),s.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],s.status===0&&this.isHttp){n.onError(s.status);return}const r=s.status||L0;if(!(r===L0&&n.expectedStatus===k0)&&r!==n.expectedStatus){n.onError(s.status);return}const l=xz(s);if(r===k0){const c=s.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(c);h?n.onDone({begin:parseInt(h[1],10),chunk:l}):(Xe('Missing or invalid "Content-Range" header.'),n.onError(0))}else l?n.onDone({begin:0,chunk:l}):n.onError(s.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class wz{constructor(e){this._source=e,this._manager=new bz(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return ut(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Sz(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const n=new Cz(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class Sz{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=wf(t.responseURL);const n=t.getAllResponseHeaders(),s=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(l=>{const[c,...h]=l.split(": ");return[c,h.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:a}=G4({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=H4(s),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=fu(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Cz{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const e=wf(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??=fu(e,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const Ez=/^[a-z][a-z0-9\-+.]+:/i;function Tz(i){if(Ez.test(i))return new URL(i);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(i))}class Mz{constructor(e){this.source=e,this.url=Tz(e.url),ut(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ut(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Dz(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new Rz(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class Dz{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=fu(0,this._url.href)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Zs("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Rz{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const s=e.source;this._isStreamingSupported=!s.disableStream;const r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const ic=Symbol("INITIAL_DATA");class W4{#e=Object.create(null);#t(e){return this.#e[e]||={...Promise.withResolvers(),data:ic}}get(e,t=null){if(t){const s=this.#t(e);return s.promise.then(()=>t(s.data)),null}const n=this.#e[e];if(!n||n.data===ic)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){const t=this.#e[e];return!!t&&t.data!==ic}delete(e){const t=this.#e[e];return!t||t.data===ic?!1:(delete this.#e[e],!0)}resolve(e,t=null){const n=this.#t(e);n.data=t,n.resolve()}clear(){for(const e in this.#e){const{data:t}=this.#e[e];t?.bitmap?.close()}this.#e=Object.create(null)}*[Symbol.iterator](){for(const e in this.#e){const{data:t}=this.#e[e];t!==ic&&(yield[e,t])}}}const Nz=1e5,Iw=30;let zc=class Ln{#e=Promise.withResolvers();#t=null;#n=!1;#i=!!globalThis.FontInspector?.enabled;#r=null;#s=null;#a=0;#o=0;#c=null;#l=null;#d=0;#h=0;#f=Object.create(null);#g=[];#m=null;#u=[];#p=new WeakMap;#A=null;static#y=new Map;static#v=new Map;static#E=new WeakMap;static#S=null;static#x=new Set;constructor({textContentSource:e,container:t,viewport:n}){if(e instanceof ReadableStream)this.#m=e;else if(typeof e=="object")this.#m=new ReadableStream({start(c){c.enqueue(e),c.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#t=this.#l=t,this.#h=n.scale*ts.pixelRatio,this.#d=n.rotation,this.#s={div:null,properties:null,ctx:null};const{pageWidth:s,pageHeight:r,pageX:a,pageY:l}=n.rawDims;this.#A=[1,0,0,-1,-a,l+r],this.#o=s,this.#a=r,Ln.#R(),Or(t,n),this.#e.promise.finally(()=>{Ln.#x.delete(this),this.#s=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=vi.platform;return Je(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{this.#c.read().then(({value:t,done:n})=>{if(n){this.#e.resolve();return}this.#r??=t.lang,Object.assign(this.#f,t.styles),this.#M(t.items),e()},this.#e.reject)};return this.#c=this.#m.getReader(),Ln.#x.add(this),e(),this.#e.promise}update({viewport:e,onBefore:t=null}){const n=e.scale*ts.pixelRatio,s=e.rotation;if(s!==this.#d&&(t?.(),this.#d=s,Or(this.#l,{rotation:s})),n!==this.#h){t?.(),this.#h=n;const r={div:null,properties:null,ctx:Ln.#N(this.#r)};for(const a of this.#u)r.properties=this.#p.get(a),r.div=a,this.#C(r)}}cancel(){const e=new Zs("TextLayer task cancelled.");this.#c?.cancel(e).catch(()=>{}),this.#c=null,this.#e.reject(e)}get textDivs(){return this.#u}get textContentItemsStr(){return this.#g}#M(e){if(this.#n)return;this.#s.ctx??=Ln.#N(this.#r);const t=this.#u,n=this.#g;for(const s of e){if(t.length>Nz){Xe("Ignoring additional textDivs for performance reasons."),this.#n=!0;return}if(s.str===void 0){if(s.type==="beginMarkedContentProps"||s.type==="beginMarkedContent"){const r=this.#t;this.#t=document.createElement("span"),this.#t.classList.add("markedContent"),s.id&&this.#t.setAttribute("id",`${s.id}`),r.append(this.#t)}else s.type==="endMarkedContent"&&(this.#t=this.#t.parentNode);continue}n.push(s.str),this.#w(s)}}#w(e){const t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};this.#u.push(t);const s=Ce.transform(this.#A,e.transform);let r=Math.atan2(s[1],s[0]);const a=this.#f[e.fontName];a.vertical&&(r+=Math.PI/2);let l=this.#i&&a.fontSubstitution||a.fontFamily;l=Ln.fontFamilyMap.get(l)||l;const c=Math.hypot(s[2],s[3]),h=c*Ln.#k(l,a,this.#r);let d,f;r===0?(d=s[4],f=s[5]-h):(d=s[4]+h*Math.sin(r),f=s[5]-h*Math.cos(r));const p="calc(var(--total-scale-factor) *",g=t.style;this.#t===this.#l?(g.left=`${(100*d/this.#o).toFixed(2)}%`,g.top=`${(100*f/this.#a).toFixed(2)}%`):(g.left=`${p}${d.toFixed(2)}px)`,g.top=`${p}${f.toFixed(2)}px)`),g.fontSize=`${p}${(Ln.#S*c).toFixed(2)}px)`,g.fontFamily=l,n.fontSize=c,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#i&&(t.dataset.fontName=a.fontSubstitutionLoadedName||e.fontName),r!==0&&(n.angle=r*(180/Math.PI));let y=!1;if(e.str.length>1)y=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const x=Math.abs(e.transform[0]),b=Math.abs(e.transform[3]);x!==b&&Math.max(x,b)/Math.min(x,b)>1.5&&(y=!0)}if(y&&(n.canvasWidth=a.vertical?e.height:e.width),this.#p.set(t,n),this.#s.div=t,this.#s.properties=n,this.#C(this.#s),n.hasText&&this.#t.append(t),n.hasEOL){const x=document.createElement("br");x.setAttribute("role","presentation"),this.#t.append(x)}}#C(e){const{div:t,properties:n,ctx:s}=e,{style:r}=t;let a="";if(Ln.#S>1&&(a=`scale(${1/Ln.#S})`),n.canvasWidth!==0&&n.hasText){const{fontFamily:l}=r,{canvasWidth:c,fontSize:h}=n;Ln.#D(s,h*this.#h,l);const{width:d}=s.measureText(t.textContent);d>0&&(a=`scaleX(${c*this.#h/d}) ${a}`)}n.angle!==0&&(a=`rotate(${n.angle}deg) ${a}`),a.length>0&&(r.transform=a)}static cleanup(){if(!(this.#x.size>0)){this.#y.clear();for(const{canvas:e}of this.#v.values())e.remove();this.#v.clear()}}static#N(e=null){let t=this.#v.get(e||="");if(!t){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#v.set(e,t),this.#E.set(t,{size:0,family:""})}return t}static#D(e,t,n){const s=this.#E.get(e);t===s.size&&n===s.family||(e.font=`${t}px ${n}`,s.size=t,s.family=n)}static#R(){if(this.#S!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#S=e.getBoundingClientRect().height,e.remove()}static#k(e,t,n){const s=this.#y.get(e);if(s)return s;const r=this.#N(n);r.canvas.width=r.canvas.height=Iw,this.#D(r,Iw,e);const a=r.measureText(""),l=a.fontBoundingBoxAscent,c=Math.abs(a.fontBoundingBoxDescent);r.canvas.width=r.canvas.height=0;let h=.8;return l?h=l/(l+c):(vi.platform.isFirefox&&Xe("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?h=t.ascent:t.descent&&(h=1+t.descent)),this.#y.set(e,h),h}};const Iz=100;function Q1(i={}){typeof i=="string"||i instanceof URL?i={url:i}:(i instanceof ArrayBuffer||ArrayBuffer.isView(i))&&(i={data:i});const e=new Z1,{docId:t}=e,n=i.url?U9(i.url):null,s=i.data?V9(i.data):null,r=i.httpHeaders||null,a=i.withCredentials===!0,l=i.password??null,c=i.range instanceof J1?i.range:null,h=Number.isInteger(i.rangeChunkSize)&&i.rangeChunkSize>0?i.rangeChunkSize:2**16;let d=i.worker instanceof zo?i.worker:null;const f=i.verbosity,p=typeof i.docBaseUrl=="string"&&!uu(i.docBaseUrl)?i.docBaseUrl:null,g=Xh(i.cMapUrl),y=i.cMapPacked!==!1,x=i.CMapReaderFactory||(Vi?X9:Aw),b=Xh(i.iccUrl),w=Xh(i.standardFontDataUrl),S=i.StandardFontDataFactory||(Vi?W9:vw),C=Xh(i.wasmUrl),E=i.WasmFactory||(Vi?K9:yw),D=i.stopAtErrors!==!0,M=Number.isInteger(i.maxImageSize)&&i.maxImageSize>-1?i.maxImageSize:-1,N=i.isEvalSupported!==!1,I=typeof i.isOffscreenCanvasSupported=="boolean"?i.isOffscreenCanvasSupported:!Vi,_=typeof i.isImageDecoderSupported=="boolean"?i.isImageDecoderSupported:!Vi&&(vi.platform.isFirefox||!globalThis.chrome),F=Number.isInteger(i.canvasMaxAreaInBytes)?i.canvasMaxAreaInBytes:-1,B=typeof i.disableFontFace=="boolean"?i.disableFontFace:Vi,P=i.fontExtraProperties===!0,O=i.enableXfa===!0,k=i.ownerDocument||globalThis.document,q=i.disableRange===!0,U=i.disableStream===!0,H=i.disableAutoFetch===!0,Y=i.pdfBug===!0,Q=i.CanvasFactory||(Vi?q9:G9),te=i.FilterFactory||(Vi?Y9:H9),j=i.enableHWA===!0,W=i.useWasm!==!1,K=c?c.length:i.length??NaN,ee=typeof i.useSystemFonts=="boolean"?i.useSystemFonts:!Vi&&!B,le=typeof i.useWorkerFetch=="boolean"?i.useWorkerFetch:!!(x===Aw&&S===vw&&E===yw&&g&&w&&C&&Ac(g,document.baseURI)&&Ac(w,document.baseURI)&&Ac(C,document.baseURI)),he=null;x9(f);const ce={canvasFactory:new Q({ownerDocument:k,enableHWA:j}),filterFactory:new te({docId:t,ownerDocument:k}),cMapReaderFactory:le?null:new x({baseUrl:g,isCompressed:y}),standardFontDataFactory:le?null:new S({baseUrl:w}),wasmFactory:le?null:new E({baseUrl:C})};d||(d=zo.create({verbosity:f,port:Pr.workerPort}),e._worker=d);const xe={docId:t,apiVersion:"5.4.296",data:s,password:l,disableAutoFetch:H,rangeChunkSize:h,length:K,docBaseUrl:p,enableXfa:O,evaluatorOptions:{maxImageSize:M,disableFontFace:B,ignoreErrors:D,isEvalSupported:N,isOffscreenCanvasSupported:I,isImageDecoderSupported:_,canvasMaxAreaInBytes:F,fontExtraProperties:P,useSystemFonts:ee,useWasm:W,useWorkerFetch:le,cMapUrl:g,iccUrl:b,standardFontDataUrl:w,wasmUrl:C}},ge={ownerDocument:k,pdfBug:Y,styleElement:he,loadingParams:{disableAutoFetch:H,enableXfa:O}};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const Me=d.messageHandler.sendWithPromise("GetDocRequest",xe,s?[s.buffer]:null);let Ie;if(c)Ie=new fz(c,{disableRange:q,disableStream:U});else if(!s){if(!n)throw new Error("getDocument - no `url` parameter provided.");const $e=Ac(n)?Az:Vi?Mz:wz;Ie=new $e({url:n,length:K,httpHeaders:r,withCredentials:a,rangeChunkSize:h,disableRange:q,disableStream:U})}return Me.then($e=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const We=new vc(t,$e,d.port),Pe=new Pz(We,e,Ie,ge,ce,j);e._transport=Pe,We.send("Ready",null)})}).catch(e._capability.reject),e}class Z1{static#e=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${Z1.#e++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}let J1=class{#e=Promise.withResolvers();#t=[];#n=[];#i=[];#r=[];constructor(e,t,n=!1,s=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=s}addRangeListener(e){this.#r.push(e)}addProgressListener(e){this.#i.push(e)}addProgressiveReadListener(e){this.#n.push(e)}addProgressiveDoneListener(e){this.#t.push(e)}onDataRange(e,t){for(const n of this.#r)n(e,t)}onDataProgress(e,t){this.#e.promise.then(()=>{for(const n of this.#i)n(e,t)})}onDataProgressiveRead(e){this.#e.promise.then(()=>{for(const t of this.#n)t(e)})}onDataProgressiveDone(){this.#e.promise.then(()=>{for(const e of this.#t)e()})}transportReady(){this.#e.resolve()}requestDataRange(e,t){Nt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}};class _z{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Je(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class Fz{#e=!1;constructor(e,t,n,s=!1){this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=s?new uw:null,this._pdfBug=s,this.commonObjs=n.commonObjs,this.objs=new W4,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:s=0,dontFlip:r=!1}={}){return new cu({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:s,dontFlip:r})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Je(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,canvas:t=e.canvas,viewport:n,intent:s="display",annotationMode:r=ms.ENABLE,transform:a=null,background:l=null,optionalContentConfigPromise:c=null,annotationCanvasMap:h=null,pageColors:d=null,printAnnotationStorage:f=null,isEditing:p=!1,recordOperations:g=!1,operationsFilter:y=null}){this._stats?.time("Overall");const x=this._transport.getRenderingIntent(s,r,f,p),{renderingIntent:b,cacheKey:w}=x;this.#e=!1,c||=this._transport.getOptionalContentConfig(b);let S=this._intentStates.get(w);S||(S=Object.create(null),this._intentStates.set(w,S)),S.streamReaderCancelTimeout&&(clearTimeout(S.streamReaderCancelTimeout),S.streamReaderCancelTimeout=null);const C=!!(b&fn.PRINT);S.displayReadyCapability||(S.displayReadyCapability=Promise.withResolvers(),S.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(x));const E=!!(this._pdfBug&&globalThis.StepperManager?.enabled),D=!this.recordedBBoxes&&(g||E),M=_=>{if(S.renderTasks.delete(N),D){const F=N.gfx?.dependencyTracker.take();F&&(N.stepper&&N.stepper.setOperatorBBoxes(F,N.gfx.dependencyTracker.takeDebugMetadata()),g&&(this.recordedBBoxes=F))}C&&(this.#e=!0),this.#t(),_?(N.capability.reject(_),this._abortOperatorList({intentState:S,reason:_ instanceof Error?_:new Error(_)})):N.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},N=new Mo({callback:M,params:{canvas:t,canvasContext:e,dependencyTracker:D?new Z9(t,S.operatorList.length,E):null,viewport:n,transform:a,background:l},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:S.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!C,pdfBug:this._pdfBug,pageColors:d,enableHWA:this._transport.enableHWA,operationsFilter:y});(S.renderTasks||=new Set).add(N);const I=N.task;return Promise.all([S.displayReadyCapability.promise,c]).then(([_,F])=>{if(this.destroyed){M();return}if(this._stats?.time("Rendering"),!(F.renderingIntent&b))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");N.initializeGraphics({transparency:_,optionalContentConfig:F}),N.operatorListChanged()}).catch(M),I}getOperatorList({intent:e="display",annotationMode:t=ms.ENABLE,printAnnotationStorage:n=null,isEditing:s=!1}={}){function r(){l.operatorList.lastChunk&&(l.opListReadCapability.resolve(l.operatorList),l.renderTasks.delete(c))}const a=this._transport.getRenderingIntent(e,t,n,s,!0);let l=this._intentStates.get(a.cacheKey);l||(l=Object.create(null),this._intentStates.set(a.cacheKey,l));let c;return l.opListReadCapability||(c=Object.create(null),c.operatorListChanged=r,l.opListReadCapability=Promise.withResolvers(),(l.renderTasks||=new Set).add(c),l.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(a)),l.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>jc.textContent(n));const t=this.streamTextContent(e);return new Promise(function(n,s){function r(){a.read().then(function({value:c,done:h}){if(h){n(l);return}l.lang??=c.lang,Object.assign(l.styles,c.styles),l.items.push(...c.items),r()},s)}const a=t.getReader(),l={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),this.#e=!1,Promise.all(e)}cleanup(e=!1){this.#e=!0;const t=this.#t();return e&&t&&(this._stats&&=new uw),t}#t(){if(!this.#e||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}_startRenderPage(e,t){const n=this._intentStates.get(t);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let n=0,s=e.length;n<s;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const n of t.renderTasks)n.operatorListChanged();e.lastChunk&&this.#t()}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:s}){const{map:r,transfer:a}=n,c=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r,modifiedIds:s},a).getReader(),h=this._intentStates.get(t);h.streamReader=c;const d=()=>{c.read().then(({value:f,done:p})=>{if(p){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(f,h),d())},f=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const p of h.renderTasks)p.operatorListChanged();this.#t()}if(h.displayReadyCapability)h.displayReadyCapability.reject(f);else if(h.opListReadCapability)h.opListReadCapability.reject(f);else throw f}})};d()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof xf){let s=Iz;t.extraDelay>0&&t.extraDelay<1e3&&(s+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},s);return}}if(e.streamReader.cancel(new Zs(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[s,r]of this._intentStates)if(r===e){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}var Rr,Zn,zs,da,Hd,fa,ma,Gi,vd,K4,Q4,yc,ko,yd;const Vt=class Vt{constructor({name:e=null,port:t=null,verbosity:n=b9()}={}){as(this,Gi);as(this,Rr,Promise.withResolvers());as(this,Zn,null);as(this,zs,null);as(this,da,null);if(this.name=e,this.destroyed=!1,this.verbosity=n,t){if(Ot(Vt,ma).has(t))throw new Error("Cannot use more than one PDFWorker per port.");Ot(Vt,ma).set(t,this),os(this,Gi,K4).call(this,t)}else os(this,Gi,Q4).call(this)}get promise(){return Ot(this,Rr).promise}get port(){return Ot(this,zs)}get messageHandler(){return Ot(this,Zn)}destroy(){this.destroyed=!0,Ot(this,da)?.terminate(),Ji(this,da,null),Ot(Vt,ma).delete(Ot(this,zs)),Ji(this,zs,null),Ot(this,Zn)?.destroy(),Ji(this,Zn,null)}static create(e){const t=Ot(this,ma).get(e?.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new Vt(e)}static get workerSrc(){if(Pr.workerSrc)return Pr.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Je(this,"_setupFakeWorkerGlobal",(async()=>Ot(this,ko,yd)?Ot(this,ko,yd):(await import(this.workerSrc)).WorkerMessageHandler)())}};Rr=new WeakMap,Zn=new WeakMap,zs=new WeakMap,da=new WeakMap,Hd=new WeakMap,fa=new WeakMap,ma=new WeakMap,Gi=new WeakSet,vd=function(){Ot(this,Rr).resolve(),Ot(this,Zn).send("configure",{verbosity:this.verbosity})},K4=function(e){Ji(this,zs,e),Ji(this,Zn,new vc("main","worker",e)),Ot(this,Zn).on("ready",()=>{}),os(this,Gi,vd).call(this)},Q4=function(){if(Ot(Vt,fa)||Ot(Vt,ko,yd)){os(this,Gi,yc).call(this);return}let{workerSrc:e}=Vt;try{Vt._isSameOrigin(window.location,e)||(e=Vt._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),n=new vc("main","worker",t),s=()=>{r.abort(),n.destroy(),t.terminate(),this.destroyed?Ot(this,Rr).reject(new Error("Worker was destroyed")):os(this,Gi,yc).call(this)},r=new AbortController;t.addEventListener("error",()=>{Ot(this,da)||s()},{signal:r.signal}),n.on("test",l=>{if(r.abort(),this.destroyed||!l){s();return}Ji(this,Zn,n),Ji(this,zs,t),Ji(this,da,t),os(this,Gi,vd).call(this)}),n.on("ready",l=>{if(r.abort(),this.destroyed){s();return}try{a()}catch{os(this,Gi,yc).call(this)}});const a=()=>{const l=new Uint8Array;n.send("test",l,[l.buffer])};a();return}catch{yf("The worker has been disabled.")}os(this,Gi,yc).call(this)},yc=function(){Ot(Vt,fa)||(Xe("Setting up fake worker."),Ji(Vt,fa,!0)),Vt._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){Ot(this,Rr).reject(new Error("Worker was destroyed"));return}const t=new z9;Ji(this,zs,t);const n=`fake${sx(Vt,Hd)._++}`,s=new vc(n+"_worker",n,t);e.setup(s,t),Ji(this,Zn,new vc(n,n+"_worker",t)),os(this,Gi,vd).call(this)}).catch(e=>{Ot(this,Rr).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},ko=new WeakSet,yd=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},as(Vt,ko),as(Vt,Hd,0),as(Vt,fa,!1),as(Vt,ma,new WeakMap),Vi&&(Ji(Vt,fa,!0),Pr.workerSrc||="./pdf.worker.mjs"),Vt._isSameOrigin=(e,t)=>{const n=URL.parse(e);if(!n?.origin||n.origin==="null")return!1;const s=new URL(t,n);return n.origin===s.origin},Vt._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},Vt.fromPort=e=>{if(N9("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return Vt.create(e)};let zo=Vt;class Pz{#e=new Map;#t=new Map;#n=new Map;#i=new Map;#r=null;constructor(e,t,n,s,r,a){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new W4,this.fontLoader=new k9({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.wasmFactory=r.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=a,this.setupMessageHandler()}#s(e,t=null){const n=this.#e.get(e);if(n)return n;const s=this.messageHandler.sendWithPromise(e,t);return this.#e.set(e,s),s}get annotationStorage(){return Je(this,"annotationStorage",new q1)}getRenderingIntent(e,t=ms.ENABLE,n=null,s=!1,r=!1){let a=fn.DISPLAY,l=yg;switch(e){case"any":a=fn.ANY;break;case"display":break;case"print":a=fn.PRINT;break;default:Xe(`getRenderingIntent - invalid intent: ${e}`)}const c=a&fn.PRINT&&n instanceof B4?n:this.annotationStorage;switch(t){case ms.DISABLE:a+=fn.ANNOTATIONS_DISABLE;break;case ms.ENABLE:break;case ms.ENABLE_FORMS:a+=fn.ANNOTATIONS_FORMS;break;case ms.ENABLE_STORAGE:a+=fn.ANNOTATIONS_STORAGE,l=c.serializable;break;default:Xe(`getRenderingIntent - invalid annotationMode: ${t}`)}s&&(a+=fn.IS_EDITING),r&&(a+=fn.OPLIST);const{ids:h,hash:d}=c.modifiedIds,f=[a,l.hash,d];return{renderingIntent:a,cacheKey:f.join("_"),annotationStorageSerializable:l,modifiedIds:h}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const n of this.#t.values())e.push(n._destroy());this.#t.clear(),this.#n.clear(),this.#i.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(),zc.cleanup(),this._networkStream?.cancelAllRequests(new Zs("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,s)=>{ut(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},s.onPull=()=>{this._fullReader.read().then(function({value:r,done:a}){if(a){s.close();return}ut(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{s.error(r)})},s.onCancel=r=>{this._fullReader.cancel(r),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("ReaderHeadersReady",async n=>{await this._fullReader.headersReady;const{isStreamingSupported:s,isRangeSupported:r,contentLength:a}=this._fullReader;return(!s||!r)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),this._fullReader.onProgress=l=>{t.onProgress?.({loaded:l.loaded,total:l.total})}),{isStreamingSupported:s,isRangeSupported:r,contentLength:a}}),e.on("GetRangeReader",(n,s)=>{ut(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(n.begin,n.end);if(!r){s.close();return}s.onPull=()=>{r.read().then(function({value:a,done:l}){if(l){s.close();return}ut(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{s.error(a)})},s.onCancel=a=>{r.cancel(a),s.ready.catch(l=>{if(!this.destroyed)throw l})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new _z(n,this))}),e.on("DocException",n=>{t._capability.reject(tn(n))}),e.on("PasswordRequest",n=>{this.#r=Promise.withResolvers();try{if(!t.onPassword)throw tn(n);const s=r=>{r instanceof Error?this.#r.reject(r):this.#r.resolve({password:r})};t.onPassword(s,n.code)}catch(s){this.#r.reject(s)}return this.#r.promise}),e.on("DataLoaded",n=>{t.onProgress?.({loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;this.#t.get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,s,r])=>{if(this.destroyed||this.commonObjs.has(n))return null;switch(s){case"Font":if("error"in r){const d=r.error;Xe(`Error during font loading: ${d}`),this.commonObjs.resolve(n,d);break}const a=new Mt(r),l=this._params.pdfBug&&globalThis.FontInspector?.enabled?(d,f)=>globalThis.FontInspector.fontAdded(d,f):null,c=new O9(a,l,r.extra,r.charProcOperatorList);this.fontLoader.bind(c).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!c.fontExtraProperties&&c.data&&c.clearData(),this.commonObjs.resolve(n,c)});break;case"CopyLocalImage":const{imageRef:h}=r;ut(h,"The imageRef must be defined.");for(const d of this.#t.values())for(const[,f]of d.objs)if(f?.ref===h)return f.dataLen?(this.commonObjs.resolve(n,structuredClone(f)),f.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,r);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),e.on("obj",([n,s,r,a])=>{if(this.destroyed)return;const l=this.#t.get(s);if(!l.objs.has(n)){if(l._intentStates.size===0){a?.bitmap?.close();return}switch(r){case"Image":case"Pattern":l.objs.resolve(n,a);break;default:throw new Error(`Got unknown object type ${r}`)}}}),e.on("DocProgress",n=>{this.destroyed||t.onProgress?.({loaded:n.loaded,total:n.total})}),e.on("FetchBinaryData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");const s=this[n.type];if(!s)throw new Error(`${n.type} not initialized, see the \`useWorkerFetch\` parameter.`);return s.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&Xe("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=this.#n.get(t);if(n)return n;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&this.#i.set(r.refStr,e);const a=new Fz(t,r,this,this._params.pdfBug);return this.#t.set(t,a),a});return this.#n.set(t,s),s}getPageIndex(e){return xg(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#s("GetFieldObjects")}hasJSActions(){return this.#s("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return this.#s("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#s("GetOptionalContentConfig").then(t=>new dz(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=this.#e.get(e);if(t)return t;const n=this.messageHandler.sendWithPromise(e,null).then(s=>({info:s[0],metadata:s[1]?new uz(s[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#e.set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of this.#t.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(!0),zc.cleanup()}}cachedPageNumber(e){if(!xg(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return this.#i.get(t)??null}}class Bz{#e=null;onContinue=null;onError=null;constructor(e){this.#e=e}get promise(){return this.#e.capability.promise}cancel(e=0){this.#e.cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=this.#e.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this.#e;return e.form||e.canvas&&t?.size>0}}class Mo{#e=null;static#t=new WeakSet;constructor({callback:e,params:t,objs:n,commonObjs:s,annotationCanvasMap:r,operatorList:a,pageIndex:l,canvasFactory:c,filterFactory:h,useRequestAnimationFrame:d=!1,pdfBug:f=!1,pageColors:p=null,enableHWA:g=!1,operationsFilter:y=null}){this.callback=e,this.params=t,this.objs=n,this.commonObjs=s,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=l,this.canvasFactory=c,this.filterFactory=h,this._pdfBug=f,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Bz(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=g,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=y}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(Mo.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Mo.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:n,transform:s,background:r,dependencyTracker:a}=this.params,l=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new _o(l,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,a),this.gfx.beginDrawing({transform:s,viewport:n,transparency:e,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#e&&(window.cancelAnimationFrame(this.#e),this.#e=null),Mo.#t.delete(this._canvas),e||=new xf(`Rendering cancelled, page ${this._pageIndex+1}`,t),this.callback(e),this.task.onError?.(e)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#e=window.requestAnimationFrame(()=>{this.#e=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Mo.#t.delete(this._canvas),this.callback())))}}const $1="5.4.296",Z4="f56dc8601";class mn{#e=null;#t=null;#n;#i=null;#r=!1;#s=!1;#a=null;#o;#c=null;#l=null;static#d=null;static get _keyboardManager(){return Je(this,"_keyboardManager",new hu([[["Escape","mac+Escape"],mn.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],mn.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],mn.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],mn.prototype._moveToPrevious],[["Home","mac+Home"],mn.prototype._moveToBeginning],[["End","mac+End"],mn.prototype._moveToEnd]]))}constructor({editor:e=null,uiManager:t=null}){e?(this.#s=!1,this.#a=e):this.#s=!0,this.#l=e?._uiManager||t,this.#o=this.#l._eventBus,this.#n=e?.color?.toUpperCase()||this.#l?.highlightColors.values().next().value||"#FFFF98",mn.#d||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const e=this.#e=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",this.#a&&(e.ariaControls=`${this.#a.id}_colorpicker_dropdown`);const t=this.#l._signal;e.addEventListener("click",this.#m.bind(this),{signal:t}),e.addEventListener("keydown",this.#g.bind(this),{signal:t});const n=this.#t=document.createElement("span");return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=this.#n,e.append(n),e}renderMainDropdown(){const e=this.#i=this.#h();return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}#h(){const e=document.createElement("div"),t=this.#l._signal;e.addEventListener("contextmenu",yn,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#a&&(e.id=`${this.#a.id}_colorpicker_dropdown`);for(const[n,s]of this.#l.highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",s),r.title=n,r.setAttribute("data-l10n-id",mn.#d[n]);const a=document.createElement("span");r.append(a),a.className="swatch",a.style.backgroundColor=s,r.ariaSelected=s===this.#n,r.addEventListener("click",this.#f.bind(this,s),{signal:t}),e.append(r)}return e.addEventListener("keydown",this.#g.bind(this),{signal:t}),e}#f(e,t){t.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:ot.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)}_colorSelectFromKeyboard(e){if(e.target===this.#e){this.#m(e);return}const t=e.target.getAttribute("data-color");t&&this.#f(t,e)}_moveToNext(e){if(!this.#p){this.#m(e);return}if(e.target===this.#e){this.#i.firstChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===this.#i?.firstChild||e.target===this.#e){this.#p&&this._hideDropdownFromKeyboard();return}this.#p||this.#m(e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!this.#p){this.#m(e);return}this.#i.firstChild?.focus()}_moveToEnd(e){if(!this.#p){this.#m(e);return}this.#i.lastChild?.focus()}#g(e){mn._keyboardManager.exec(this,e)}#m(e){if(this.#p){this.hideDropdown();return}if(this.#r=e.detail===0,this.#c||(this.#c=new AbortController,window.addEventListener("pointerdown",this.#u.bind(this),{signal:this.#l.combinedSignal(this.#c)})),this.#e.ariaExpanded="true",this.#i){this.#i.classList.remove("hidden");return}const t=this.#i=this.#h();this.#e.append(t)}#u(e){this.#i?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#i?.classList.add("hidden"),this.#e.ariaExpanded="false",this.#c?.abort(),this.#c=null}get#p(){return this.#i&&!this.#i.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#s){if(!this.#p){this.#a?.unselect();return}this.hideDropdown(),this.#e.focus({preventScroll:!0,focusVisible:this.#r})}}updateColor(e){if(this.#t&&(this.#t.style.backgroundColor=e),!this.#i)return;const t=this.#l.highlightColors.values();for(const n of this.#i.children)n.ariaSelected=t.next().value===e.toUpperCase()}destroy(){this.#e?.remove(),this.#e=null,this.#t=null,this.#i?.remove(),this.#i=null}}class Gc{#e=null;#t=null;#n=null;static#i=null;constructor(e){this.#t=e,this.#n=e._uiManager,Gc.#i||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#e)return this.#e;const{editorType:e,colorType:t,colorValue:n}=this.#t,s=this.#e=document.createElement("input");return s.type="color",s.value=n||"#000000",s.className="basicColorPicker",s.tabIndex=0,s.setAttribute("data-l10n-id",Gc.#i[e]),s.addEventListener("input",()=>{this.#n.updateParams(t,s.value)},{signal:this.#n._signal}),s}update(e){this.#e&&(this.#e.value=e)}destroy(){this.#e?.remove(),this.#e=null}hideDropdown(){}}function _w(i){return Math.floor(Math.max(0,Math.min(1,i))*255).toString(16).padStart(2,"0")}function nc(i){return Math.max(0,Math.min(255,255*i))}class Fw{static CMYK_G([e,t,n,s]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+s)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=nc(e),[e,e,e]}static G_HTML([e]){const t=_w(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(nc)}static RGB_HTML(e){return`#${e.map(_w).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,s]){return["RGB",1-Math.min(1,e+s),1-Math.min(1,n+s),1-Math.min(1,t+s)]}static CMYK_rgb([e,t,n,s]){return[nc(1-Math.min(1,e+s)),nc(1-Math.min(1,n+s)),nc(1-Math.min(1,t+s))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){const s=1-e,r=1-t,a=1-n,l=Math.min(s,r,a);return["CMYK",s,r,a,l]}}class Lz{create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),n||(s.setAttribute("width",`${e}px`),s.setAttribute("height",`${t}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${e} ${t}`),s}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Nt("Abstract method `_createSVG` called.")}}class Hc extends Lz{_createSVG(e){return document.createElementNS(Us,e)}}const kz=9,Ea=new WeakSet,Oz=new Date().getTimezoneOffset()*60*1e3;class Pw{static create(e){switch(e.data.annotationType){case $t.LINK:return new e2(e);case $t.TEXT:return new Vz(e);case $t.WIDGET:switch(e.data.fieldType){case"Tx":return new jz(e);case"Btn":return e.data.radioButton?new J4(e):e.data.checkBox?new Gz(e):new Hz(e);case"Ch":return new Yz(e);case"Sig":return new zz(e)}return new Ra(e);case $t.POPUP:return new Sg(e);case $t.FREETEXT:return new $4(e);case $t.LINE:return new Xz(e);case $t.SQUARE:return new Wz(e);case $t.CIRCLE:return new Kz(e);case $t.POLYLINE:return new eS(e);case $t.CARET:return new Zz(e);case $t.INK:return new t2(e);case $t.POLYGON:return new Qz(e);case $t.HIGHLIGHT:return new tS(e);case $t.UNDERLINE:return new Jz(e);case $t.SQUIGGLY:return new $z(e);case $t.STRIKEOUT:return new eG(e);case $t.STAMP:return new iS(e);case $t.FILEATTACHMENT:return new tG(e);default:return new qt(e)}}}class qt{#e=null;#t=!1;#n=null;constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:s=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(n)),s&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e?.str||t?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return qt._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:e}=this,t=this.annotationStorage?.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const e=this.annotationStorage?.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:n,rect:s}=this.data;let r=-1/0,a=-1/0;if(t?.length>=8){for(let l=0;l<t.length;l+=8)t[l+1]>a?(a=t[l+1],r=t[l+2]):t[l+1]===a&&(r=Math.max(r,t[l+2]));return[r,a]}if(n?.length>=1){for(const l of n)for(let c=0,h=l.length;c<h;c+=2)l[c+1]>a?(a=l[c+1],r=l[c]):l[c+1]===a&&(r=Math.max(r,l[c]));if(r!==1/0)return[r,a]}return s?[s[2],s[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:n,pageHeight:s,pageX:r,pageY:a}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-r)/n,e[1]=100*(e[1]-a)/s,e}get commentText(){const{data:e}=this;return this.annotationStorage.getRawValue(`${Uc}${e.id}`)?.popup?.contents||e.contentsObj?.str||""}set commentText(e){const{data:t}=this,n={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:n})||this.annotationStorage.setValue(`${Uc}${t.id}`,{id:t.id,annotationType:t.annotationType,pageIndex:this.parent.page._pageIndex,popup:n,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){(this.#n?.popup||this.popup)?.remove(),this.#n=this.popup=null}updateEdited(e){if(!this.container)return;e.rect&&(this.#e||={rect:this.data.rect.slice(0)});const{rect:t,popup:n}=e;t&&this.#i(t);let s=this.#n?.popup||this.popup;!s&&n?.text&&(this._createPopup(n),s=this.#n.popup),s&&(s.updateEdited(e),n?.deleted&&(s.remove(),this.#n=null,this.popup=null))}resetEdited(){this.#e&&(this.#i(this.#e.rect),this.#n?.popup.resetEdited(),this.#e=null)}#i(e){const{container:{style:t},data:{rect:n,rotation:s},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:a,pageX:l,pageY:c}}}}=this;n?.splice(0,4,...e),t.left=`${100*(e[0]-l)/r}%`,t.top=`${100*(a-e[3]+c)/a}%`,s===0?(t.width=`${100*(e[2]-e[0])/r}%`,t.height=`${100*(e[3]-e[1])/a}%`):this.setRotation(s)}_createContainer(e){const{data:t,parent:{page:n,viewport:s}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",t.id),!(this instanceof Ra)&&!(this instanceof e2)&&(r.tabIndex=0);const{style:a}=r;if(a.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(r.title=t.alternativeText),t.noRotate&&r.classList.add("norotate"),!t.rect||this instanceof Sg){const{rotation:x}=t;return!t.hasOwnCanvas&&x!==0&&this.setRotation(x,r),r}const{width:l,height:c}=this;if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;const x=t.borderStyle.horizontalCornerRadius,b=t.borderStyle.verticalCornerRadius;if(x>0||b>0){const S=`calc(${x}px * var(--total-scale-factor)) / calc(${b}px * var(--total-scale-factor))`;a.borderRadius=S}else if(this instanceof J4){const S=`calc(${l}px * var(--total-scale-factor)) / calc(${c}px * var(--total-scale-factor))`;a.borderRadius=S}switch(t.borderStyle.style){case So.SOLID:a.borderStyle="solid";break;case So.DASHED:a.borderStyle="dashed";break;case So.BEVELED:Xe("Unimplemented border style: beveled");break;case So.INSET:Xe("Unimplemented border style: inset");break;case So.UNDERLINE:a.borderBottomStyle="solid";break}const w=t.borderColor||null;w?(this.#t=!0,a.borderColor=Ce.makeHexColor(w[0]|0,w[1]|0,w[2]|0)):a.borderWidth=0}const h=Ce.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:d,pageHeight:f,pageX:p,pageY:g}=s.rawDims;a.left=`${100*(h[0]-p)/d}%`,a.top=`${100*(h[1]-g)/f}%`;const{rotation:y}=t;return t.hasOwnCanvas||y===0?(a.width=`${100*l/d}%`,a.height=`${100*c/f}%`):this.setRotation(y,r),r}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:s}=this.parent.viewport.rawDims;let{width:r,height:a}=this;e%180!==0&&([r,a]=[a,r]),t.style.width=`${100*r/n}%`,t.style.height=`${100*a/s}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,n,s)=>{const r=s.detail[t],a=r[0],l=r.slice(1);s.target.style[n]=Fw[`${a}_HTML`](l),this.annotationStorage.setValue(this.data.id,{[n]:Fw[`${a}_rgb`](l)})};return Je(this,"_commonActions",{display:t=>{const{display:n}=t.detail,s=n%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){const n=this._commonActions;for(const s of Object.keys(t.detail))(e[s]||n[s])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const n=this._commonActions;for(const[s,r]of Object.entries(t)){const a=n[s];if(a){const l={detail:{[s]:r},target:e};a(l),delete t[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,n,s,r]=this.data.rect.map(x=>Math.fround(x));if(e.length===8){const[x,b,w,S]=e.subarray(2,6);if(s===x&&r===b&&t===w&&n===S)return}const{style:a}=this.container;let l;if(this.#t){const{borderColor:x,borderWidth:b}=a;a.borderWidth=0,l=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${x}" stroke-width="${b}">`],this.container.classList.add("hasBorder")}const c=s-t,h=r-n,{svgFactory:d}=this,f=d.createElement("svg");f.classList.add("quadrilateralsContainer"),f.setAttribute("width",0),f.setAttribute("height",0),f.role="none";const p=d.createElement("defs");f.append(p);const g=d.createElement("clipPath"),y=`clippath_${this.data.id}`;g.setAttribute("id",y),g.setAttribute("clipPathUnits","objectBoundingBox"),p.append(g);for(let x=2,b=e.length;x<b;x+=8){const w=e[x],S=e[x+1],C=e[x+2],E=e[x+3],D=d.createElement("rect"),M=(C-t)/c,N=(r-S)/h,I=(w-C)/c,_=(S-E)/h;D.setAttribute("x",M),D.setAttribute("y",N),D.setAttribute("width",I),D.setAttribute("height",_),g.append(D),l?.push(`<rect vector-effect="non-scaling-stroke" x="${M}" y="${N}" width="${I}" height="${_}"/>`)}this.#t&&(l.push("</g></svg>')"),a.backgroundImage=l.join("")),this.container.append(f),this.container.style.clipPath=`url(#${y})`}_createPopup(e=null){const{data:t}=this;let n,s;e?(n={str:e.text},s=e.date):(n=t.contentsObj,s=t.modificationDate);const r=this.#n=new Sg({data:{color:t.color,titleObj:t.titleObj,modificationDate:s,contentsObj:n,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent._commentManager||this.parent.div.append(r.render())}get hasPopupElement(){return!!(this.#n||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#n}render(){Nt("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const n=[];if(this._fieldObjects){const s=this._fieldObjects[e];if(s)for(const{page:r,id:a,exportValues:l}of s){if(r===-1||a===t)continue;const c=typeof l=="string"?l:null,h=document.querySelector(`[data-element-id="${a}"]`);if(h&&!Ea.has(h)){Xe(`_getElementsByName - element not allowed: ${a}`);continue}n.push({id:a,exportValue:c,domElement:h})}return n}for(const s of document.getElementsByName(e)){const{exportValue:r}=s,a=s.getAttribute("data-element-id");a!==t&&Ea.has(s)&&n.push({id:a,exportValue:r,domElement:s})}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class Uz extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&(this._createPopup(e.comment),this.extraPopupElement.popup.renderCommentButton())}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.container.remove(),this.container=null,this.removePopup()}}class e2 extends qt{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,n=document.createElement("a");n.setAttribute("data-element-id",e.id);let s=!1;return e.url?(t.addLinkAttributes(n,e.url,e.newWindow),s=!0):e.action?(this._bindNamedAction(n,e.action,e.overlaidText),s=!0):e.attachment?(this.#t(n,e.attachment,e.overlaidText,e.attachmentDest),s=!0):e.setOCGState?(this.#n(n,e.setOCGState,e.overlaidText),s=!0):e.dest?(this._bindLink(n,e.dest,e.overlaidText),s=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,e),s=!0),e.resetForm?(this._bindResetFormAction(n,e.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(n,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(n),this.container}#e(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t,n=""){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||t==="")&&this.#e(),n&&(e.title=n)}_bindNamedAction(e,t,n=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),n&&(e.title=n),this.#e()}#t(e,t,n="",s=null){e.href=this.linkService.getAnchorUrl(""),t.description?e.title=t.description:n&&(e.title=n),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,s),!1),this.#e()}#n(e,t,n=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),n&&(e.title=n),this.#e()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const s of Object.keys(t.actions)){const r=n.get(s);r&&(e[r]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:s}}),!1))}t.overlaidText&&(e.title=t.overlaidText),e.onclick||(e.onclick=()=>!1),this.#e()}_bindResetFormAction(e,t){const n=e.onclick;if(n||(e.href=this.linkService.getAnchorUrl("")),this.#e(),!this._fieldObjects){Xe('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),n||(e.onclick=()=>!1);return}e.onclick=()=>{n?.();const{fields:s,refs:r,include:a}=t,l=[];if(s.length!==0||r.length!==0){const d=new Set(r);for(const f of s){const p=this._fieldObjects[f]||[];for(const{id:g}of p)d.add(g)}for(const f of Object.values(this._fieldObjects))for(const p of f)d.has(p.id)===a&&l.push(p)}else for(const d of Object.values(this._fieldObjects))l.push(...d);const c=this.annotationStorage,h=[];for(const d of l){const{id:f}=d;switch(h.push(f),d.type){case"text":{const g=d.defaultValue||"";c.setValue(f,{value:g});break}case"checkbox":case"radiobutton":{const g=d.defaultValue===d.exportValues;c.setValue(f,{value:g});break}case"combobox":case"listbox":{const g=d.defaultValue||"";c.setValue(f,{value:g});break}default:continue}const p=document.querySelector(`[data-element-id="${f}"]`);if(p){if(!Ea.has(p)){Xe(`_bindResetFormAction - element not allowed: ${f}`);continue}}else continue;p.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}}),!1}}}class Vz extends qt{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class Ra extends qt{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return vi.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,s,r){n.includes("mouse")?e.addEventListener(n,a=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):e.addEventListener(n,a=>{if(n==="blur"){if(!t.focused||!a.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}r&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(a)}})})}_setEventListeners(e,t,n,s){for(const[r,a]of n)(a==="Action"||this.data.actions?.[a])&&((a==="Focus"||a==="Blur")&&(t||={focused:!1}),this._setEventListener(e,t,r,a,s),a==="Focus"&&!this.data.actions?.Blur?this._setEventListener(e,t,"blur","Blur",null):a==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":Ce.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||kz,r=e.style;let a;const l=2,c=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-l),d=Math.round(h/(N0*s))||1,f=h/d;a=Math.min(s,c(f/N0))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-l);a=Math.min(s,c(h/N0))}r.fontSize=`calc(${a}px * var(--total-scale-factor))`,r.color=Ce.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(r.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class jz extends Ra{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,s){const r=this.annotationStorage;for(const a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=n),r.setValue(a.id,{[s]:n})}render(){const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const s=e.getValue(t,{value:this.data.fieldValue});let r=s.value||"";const a=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;a&&r.length>a&&(r=r.slice(0,a));let l=s.formattedValue||this.data.textContent?.join(`
`)||null;l&&this.data.comb&&(l=l.replaceAll(/\s+/g,""));const c={userValue:r,formattedValue:l,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=l??r,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",l??r),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Ea.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:h,datetimeType:d,timeStep:f}=this.data,p=!!d&&this.enableScripting;h&&(n.title=h),this._setRequired(n,this.data.required),a&&(n.maxLength=a),n.addEventListener("input",y=>{e.setValue(t,{value:y.target.value}),this.setPropertyOnSiblings(n,"value",y.target.value,"value"),c.formattedValue=null}),n.addEventListener("resetform",y=>{const x=this.data.defaultFieldValue??"";n.value=c.userValue=x,c.formattedValue=null});let g=y=>{const{formattedValue:x}=c;x!=null&&(y.target.value=x),y.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",x=>{if(c.focused)return;const{target:b}=x;if(p&&(b.type=d,f&&(b.step=f)),c.userValue){const w=c.userValue;if(p)if(d==="time"){const S=new Date(w),C=[S.getHours(),S.getMinutes(),S.getSeconds()];b.value=C.map(E=>E.toString().padStart(2,"0")).join(":")}else b.value=new Date(w-Oz).toISOString().split(d==="date"?"T":".",1)[0];else b.value=w}c.lastCommittedValue=b.value,c.commitKey=1,this.data.actions?.Focus||(c.focused=!0)}),n.addEventListener("updatefromsandbox",x=>{this.showElementAndHideCanvas(x.target);const b={value(w){c.userValue=w.detail.value??"",p||e.setValue(t,{value:c.userValue.toString()}),w.target.value=c.userValue},formattedValue(w){const{formattedValue:S}=w.detail;c.formattedValue=S,S!=null&&w.target!==document.activeElement&&(w.target.value=S);const C={formattedValue:S};p&&(C.value=S),e.setValue(t,C)},selRange(w){w.target.setSelectionRange(...w.detail.selRange)},charLimit:w=>{const{charLimit:S}=w.detail,{target:C}=w;if(S===0){C.removeAttribute("maxLength");return}C.setAttribute("maxLength",S);let E=c.userValue;!E||E.length<=S||(E=E.slice(0,S),C.value=c.userValue=E,e.setValue(t,{value:E}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:E,willCommit:!0,commitKey:1,selStart:C.selectionStart,selEnd:C.selectionEnd}}))}};this._dispatchEventFromSandbox(b,x)}),n.addEventListener("keydown",x=>{c.commitKey=1;let b=-1;if(x.key==="Escape"?b=0:x.key==="Enter"&&!this.data.multiLine?b=2:x.key==="Tab"&&(c.commitKey=3),b===-1)return;const{value:w}=x.target;c.lastCommittedValue!==w&&(c.lastCommittedValue=w,c.userValue=w,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,willCommit:!0,commitKey:b,selStart:x.target.selectionStart,selEnd:x.target.selectionEnd}}))});const y=g;g=null,n.addEventListener("blur",x=>{if(!c.focused||!x.relatedTarget)return;this.data.actions?.Blur||(c.focused=!1);const{target:b}=x;let{value:w}=b;if(p){if(w&&d==="time"){const S=w.split(":").map(C=>parseInt(C,10));w=new Date(2e3,0,1,S[0],S[1],S[2]||0).valueOf(),b.step=""}else w.includes("T")||(w=`${w}T00:00`),w=new Date(w).valueOf();b.type="text"}c.userValue=w,c.lastCommittedValue!==w&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,willCommit:!0,commitKey:c.commitKey,selStart:x.target.selectionStart,selEnd:x.target.selectionEnd}}),y(x)}),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",x=>{c.lastCommittedValue=null;const{data:b,target:w}=x,{value:S,selectionStart:C,selectionEnd:E}=w;let D=C,M=E;switch(x.inputType){case"deleteWordBackward":{const N=S.substring(0,C).match(/\w*[^\w]*$/);N&&(D-=N[0].length);break}case"deleteWordForward":{const N=S.substring(C).match(/^[^\w]*\w*/);N&&(M+=N[0].length);break}case"deleteContentBackward":C===E&&(D-=1);break;case"deleteContentForward":C===E&&(M+=1);break}x.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:S,change:b||"",willCommit:!1,selStart:D,selEnd:M}})}),this._setEventListeners(n,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],x=>x.target.value)}if(g&&n.addEventListener("blur",g),this.data.comb){const x=(this.data.rect[2]-this.data.rect[0])/a;n.classList.add("comb"),n.style.letterSpacing=`calc(${x}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class zz extends Ra{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class Gz extends Ra{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id;let s=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",e.setValue(n,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return Ea.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,s&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=0,r.addEventListener("change",a=>{const{name:l,checked:c}=a.target;for(const h of this._getElementsByName(l,n)){const d=c&&h.exportValue===t.exportValue;h.domElement&&(h.domElement.checked=d),e.setValue(h.id,{value:d})}e.setValue(n,{value:c})}),r.addEventListener("resetform",a=>{const l=t.defaultFieldValue||"Off";a.target.checked=l===t.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",a=>{const l={value(c){c.target.checked=c.detail.value!=="Off",e.setValue(n,{value:c.target.checked})}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class J4 extends Ra{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,n=t.id;let s=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof s=="string"&&(s=s!==t.buttonValue,e.setValue(n,{value:s})),s)for(const a of this._getElementsByName(t.fieldName,n))e.setValue(a.id,{value:!1});const r=document.createElement("input");if(Ea.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,s&&r.setAttribute("checked",!0),r.tabIndex=0,r.addEventListener("change",a=>{const{name:l,checked:c}=a.target;for(const h of this._getElementsByName(l,n))e.setValue(h.id,{value:!1});e.setValue(n,{value:c})}),r.addEventListener("resetform",a=>{const l=t.defaultFieldValue;a.target.checked=l!=null&&l===t.buttonValue}),this.enableScripting&&this.hasJSActions){const a=t.buttonValue;r.addEventListener("updatefromsandbox",l=>{const c={value:h=>{const d=a===h.detail.value;for(const f of this._getElementsByName(h.target.name)){const p=d&&f.id===n;f.domElement&&(f.domElement.checked=p),e.setValue(f.id,{value:p})}}};this._dispatchEventFromSandbox(c,l)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],l=>l.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class Hz extends e2{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}}class Yz extends Ra{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),s=document.createElement("select");Ea.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=0;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",d=>{const f=this.data.defaultFieldValue;for(const p of s.options)p.selected=p.value===f});for(const d of this.data.options){const f=document.createElement("option");f.textContent=d.displayValue,f.value=d.exportValue,n.value.includes(d.exportValue)&&(f.setAttribute("selected",!0),r=!1),s.append(f)}let a=null;if(r){const d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),s.prepend(d),a=()=>{d.remove(),s.removeEventListener("input",a),a=null},s.addEventListener("input",a)}const l=d=>{const f=d?"value":"textContent",{options:p,multiple:g}=s;return g?Array.prototype.filter.call(p,y=>y.selected).map(y=>y[f]):p.selectedIndex===-1?null:p[p.selectedIndex][f]};let c=l(!1);const h=d=>{const f=d.target.options;return Array.prototype.map.call(f,p=>({displayValue:p.textContent,exportValue:p.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",d=>{const f={value(p){a?.();const g=p.detail.value,y=new Set(Array.isArray(g)?g:[g]);for(const x of s.options)x.selected=y.has(x.value);e.setValue(t,{value:l(!0)}),c=l(!1)},multipleSelection(p){s.multiple=!0},remove(p){const g=s.options,y=p.detail.remove;g[y].selected=!1,s.remove(y),g.length>0&&Array.prototype.findIndex.call(g,b=>b.selected)===-1&&(g[0].selected=!0),e.setValue(t,{value:l(!0),items:h(p)}),c=l(!1)},clear(p){for(;s.length!==0;)s.remove(0);e.setValue(t,{value:null,items:[]}),c=l(!1)},insert(p){const{index:g,displayValue:y,exportValue:x}=p.detail.insert,b=s.children[g],w=document.createElement("option");w.textContent=y,w.value=x,b?b.before(w):s.append(w),e.setValue(t,{value:l(!0),items:h(p)}),c=l(!1)},items(p){const{items:g}=p.detail;for(;s.length!==0;)s.remove(0);for(const y of g){const{displayValue:x,exportValue:b}=y,w=document.createElement("option");w.textContent=x,w.value=b,s.append(w)}s.options.length>0&&(s.options[0].selected=!0),e.setValue(t,{value:l(!0),items:h(p)}),c=l(!1)},indices(p){const g=new Set(p.detail.indices);for(const y of p.target.options)y.selected=g.has(y.index);e.setValue(t,{value:l(!0)}),c=l(!1)},editable(p){p.target.disabled=!p.detail.editable}};this._dispatchEventFromSandbox(f,d)}),s.addEventListener("input",d=>{const f=l(!0),p=l(!1);e.setValue(t,{value:f}),d.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:c,change:p,changeEx:f,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):s.addEventListener("input",function(d){e.setValue(t,{value:l(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Sg extends qt{constructor(e){const{data:t,elements:n,parent:s}=e,r=!!s._commentManager;if(super(e,{isRenderable:!r&&qt._hasPopupData(t)}),this.elements=n,r&&qt._hasPopupData(t)){const a=this.popup=this.#e();for(const l of n)l.popup=a}else this.popup=null}#e(){return new qz({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:e}=this;e.classList.add("popupAnnotation"),e.role="comment";const t=this.popup=this.#e(),n=[];for(const s of this.elements)s.popup=t,s.container.ariaHasPopup="dialog",n.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",n.map(s=>`${j1}${s}`).join(",")),this.container}}class qz{#e=null;#t=this.#H.bind(this);#n=this.#U.bind(this);#i=this.#F.bind(this);#r=this.#b.bind(this);#s=null;#a=null;#o=null;#c=null;#l=null;#d=null;#h=null;#f=!1;#g=null;#m=null;#u=null;#p=null;#A=null;#y=null;#v=null;#E=null;#S=null;#x=null;#M=!1;#w=null;#C=null;constructor({container:e,color:t,elements:n,titleObj:s,modificationDate:r,contentsObj:a,richText:l,parent:c,rect:h,parentRect:d,open:f,commentManager:p=null}){this.#a=e,this.#S=s,this.#o=a,this.#E=l,this.#d=c,this.#s=t,this.#v=h,this.#h=d,this.#l=n,this.#e=p,this.#w=n[0],this.#c=jd.toDateObject(r),this.trigger=n.flatMap(g=>g.getElementsToTriggerPopup()),p?this.renderCommentButton():(this.#N(),this.#a.hidden=!0,f&&this.#b())}#N(){if(this.#m)return;this.#m=new AbortController;const{signal:e}=this.#m;for(const t of this.trigger)t.addEventListener("click",this.#r,{signal:e}),t.addEventListener("pointerenter",this.#i,{signal:e}),t.addEventListener("pointerleave",this.#n,{signal:e}),t.classList.add("popupTriggerArea");for(const t of this.#l)t.container?.addEventListener("keydown",this.#t,{signal:e})}#D(){const e=this.#l.find(t=>t.hasCommentButton);e&&(this.#A=e._normalizePoint(e.commentButtonPosition))}renderCommentButton(){if(this.#p||(this.#A||this.#D(),!this.#A))return;const{signal:e}=this.#m=new AbortController,t=!!this.#w.extraPopupElement,n=()=>{this.#e.toggleCommentPopup(this,!0,void 0,!t)},s=()=>{this.#e.toggleCommentPopup(this,!1,!0,!t)},r=()=>{this.#e.toggleCommentPopup(this,!1,!1)};if(t){this.#p=this.#w.container;for(const a of this.trigger)a.ariaHasPopup="dialog",a.ariaControls="commentPopup",a.addEventListener("keydown",this.#t,{signal:e}),a.addEventListener("click",n,{signal:e}),a.addEventListener("pointerenter",s,{signal:e}),a.addEventListener("pointerleave",r,{signal:e}),a.classList.add("popupTriggerArea")}else{const a=this.#p=document.createElement("button");a.className="annotationCommentButton";const l=this.#w.container;a.style.zIndex=l.style.zIndex+1,a.tabIndex=0,a.ariaHasPopup="dialog",a.ariaControls="commentPopup",a.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#k(),this.#R(),a.addEventListener("keydown",this.#t,{signal:e}),a.addEventListener("click",n,{signal:e}),a.addEventListener("pointerenter",s,{signal:e}),a.addEventListener("pointerleave",r,{signal:e}),l.after(a)}}#R(){if(this.#w.extraPopupElement&&!this.#w.editor)return;this.renderCommentButton();const[e,t]=this.#A,{style:n}=this.#p;n.left=`calc(${e}%)`,n.top=`calc(${t}% - var(--comment-button-dim))`}#k(){this.#w.extraPopupElement||(this.renderCommentButton(),this.#p.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:e,opacity:t}=this.#w.commentData;return e?this.#d._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{this.#p?.focus()},0)}getData(){const{richText:e,color:t,opacity:n,creationDate:s,modificationDate:r}=this.#w.commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:n,creationDate:s,modificationDate:r}}get elementBeforePopup(){return this.#p}get comment(){return this.#C||=this.#w.commentText,this.#C}set comment(e){e!==this.comment&&(this.#w.commentText=this.#C=e)}get parentBoundingClientRect(){return this.#w.layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){this.#p&&(this.#p.classList.toggle("selected",e),this.#p.ariaExpanded=t)}setSelectedCommentButton(e){this.#p.classList.toggle("selected",e)}get commentPopupPosition(){if(this.#y)return this.#y;const{x:e,y:t,height:n}=this.#p.getBoundingClientRect(),{x:s,y:r,width:a,height:l}=this.#w.layer.getBoundingClientRect();return[(e-s)/a,(t+n-r)/l]}set commentPopupPosition(e){this.#y=e}hasDefaultPopupPosition(){return this.#y===null}get commentButtonPosition(){return this.#A}get commentButtonWidth(){return this.#p.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,n]=this.#y||this.commentButtonPosition.map(h=>h/100),s=this.parentBoundingClientRect,{x:r,y:a,width:l,height:c}=s;this.#e.showDialog(null,this,r+t*l,a+n*c,{...e,parentDimensions:s})}render(){if(this.#g)return;const e=this.#g=document.createElement("div");if(e.className="popup",this.#s){const n=e.style.outlineColor=Ce.makeHexColor(...this.#s);e.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`}const t=document.createElement("span");if(t.className="header",this.#S?.str){const n=document.createElement("span");n.className="title",t.append(n),{dir:n.dir,str:n.textContent}=this.#S}if(e.append(t),this.#c){const n=document.createElement("time");n.className="popupDate",n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#c.valueOf()})),n.dateTime=this.#c.toISOString(),t.append(n)}G1({html:this.#_||this.#o.str,dir:this.#o?.dir,className:"popupContent"},e),this.#a.append(e)}get#_(){const e=this.#E,t=this.#o;return e?.str&&(!t?.str||t.str===e.str)&&this.#E.html||null}get#P(){return this.#_?.attributes?.style?.fontSize||0}get#O(){return this.#_?.attributes?.style?.color||null}#B(e){const t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},s={style:{color:this.#O,fontSize:this.#P?`calc(${this.#P}px * var(--total-scale-factor))`:""}};for(const r of e.split(`
`))t.push({name:"span",value:r,attributes:s});return n}#H(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&this.#f)&&this.#b()}updateEdited({rect:e,popup:t,deleted:n}){if(this.#e){n?(this.remove(),this.#C=null):t&&(t.deleted?this.remove():(this.#k(),this.#C=t.text)),e&&(this.#A=null,this.#D(),this.#R());return}if(n||t?.deleted){this.remove();return}this.#N(),this.#x||={contentsObj:this.#o,richText:this.#E},e&&(this.#u=null),t&&t.text&&(this.#E=this.#B(t.text),this.#c=jd.toDateObject(t.date),this.#o=null),this.#g?.remove(),this.#g=null}resetEdited(){this.#x&&({contentsObj:this.#o,richText:this.#E}=this.#x,this.#x=null,this.#g?.remove(),this.#g=null,this.#u=null)}remove(){if(this.#m?.abort(),this.#m=null,this.#g?.remove(),this.#g=null,this.#M=!1,this.#f=!1,this.#p?.remove(),this.#p=null,this.trigger)for(const e of this.trigger)e.classList.remove("popupTriggerArea")}#T(){if(this.#u!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:s,pageY:r}}}=this.#d;let a=!!this.#h,l=a?this.#h:this.#v;for(const y of this.#l)if(!l||Ce.intersect(y.data.rect,l)!==null){l=y.data.rect,a=!0;break}const c=Ce.normalizeRect([l[0],e[3]-l[1]+e[1],l[2],e[3]-l[3]+e[1]]),d=a?l[2]-l[0]+5:0,f=c[0]+d,p=c[1];this.#u=[100*(f-s)/t,100*(p-r)/n];const{style:g}=this.#a;g.left=`${this.#u[0]}%`,g.top=`${this.#u[1]}%`}#b(){if(this.#e){this.#e.toggleCommentPopup(this,!1);return}this.#f=!this.#f,this.#f?(this.#F(),this.#a.addEventListener("click",this.#r),this.#a.addEventListener("keydown",this.#t)):(this.#U(),this.#a.removeEventListener("click",this.#r),this.#a.removeEventListener("keydown",this.#t))}#F(){this.#g||this.render(),this.isVisible?this.#f&&this.#a.classList.add("focused"):(this.#T(),this.#a.hidden=!1,this.#a.style.zIndex=parseInt(this.#a.style.zIndex)+1e3)}#U(){this.#a.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#a.hidden=!0,this.#a.style.zIndex=parseInt(this.#a.style.zIndex)-1e3)}forceHide(){this.#M=this.isVisible,this.#M&&(this.#a.hidden=!0)}maybeShow(){this.#e||(this.#N(),this.#M&&(this.#g||this.#F(),this.#M=!1,this.#a.hidden=!1))}get isVisible(){return this.#e?!1:this.#a.hidden===!1}}class $4 extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=qe.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class Xz extends qt{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:e,width:t,height:n}=this,s=this.svgFactory.create(t,n,!0),r=this.#e=this.svgFactory.createElement("svg:line");return r.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),r.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),r.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),r.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),r.setAttribute("stroke-width",e.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),s.append(r),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Wz extends qt{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:e,width:t,height:n}=this,s=this.svgFactory.create(t,n,!0),r=e.borderStyle.width,a=this.#e=this.svgFactory.createElement("svg:rect");return a.setAttribute("x",r/2),a.setAttribute("y",r/2),a.setAttribute("width",t-r),a.setAttribute("height",n-r),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Kz extends qt{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:e,width:t,height:n}=this,s=this.svgFactory.create(t,n,!0),r=e.borderStyle.width,a=this.#e=this.svgFactory.createElement("svg:ellipse");return a.setAttribute("cx",t/2),a.setAttribute("cy",n/2),a.setAttribute("rx",t/2-r/2),a.setAttribute("ry",n/2-r/2),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class eS extends qt{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:t,borderStyle:n,popupRef:s},width:r,height:a}=this;if(!t)return this.container;const l=this.svgFactory.create(r,a,!0);let c=[];for(let d=0,f=t.length;d<f;d+=2){const p=t[d]-e[0],g=e[3]-t[d+1];c.push(`${p},${g}`)}c=c.join(" ");const h=this.#e=this.svgFactory.createElement(this.svgElementName);return h.setAttribute("points",c),h.setAttribute("stroke-width",n.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),l.append(h),this.container.append(l),!s&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Qz extends eS{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Zz extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class t2 extends qt{#e=null;#t=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?qe.HIGHLIGHT:qe.INK}#n(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:t,inkLists:n,borderStyle:s,popupRef:r}}=this,{transform:a,width:l,height:c}=this.#n(t,e),h=this.svgFactory.create(l,c,!0),d=this.#e=this.svgFactory.createElement("svg:g");h.append(d),d.setAttribute("stroke-width",s.width||1),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-miterlimit",10),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),d.setAttribute("transform",a);for(let f=0,p=n.length;f<p;f++){const g=this.svgFactory.createElement(this.svgElementName);this.#t.push(g),g.setAttribute("points",n[f].join(",")),d.append(g)}return!r&&this.hasPopupData&&this._createPopup(),this.container.append(h),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:t,points:n,rect:s}=e,r=this.#e;if(t>=0&&r.setAttribute("stroke-width",t||1),n)for(let a=0,l=this.#t.length;a<l;a++)this.#t[a].setAttribute("points",n[a].join(","));if(s){const{transform:a,width:l,height:c}=this.#n(this.data.rotation,s);r.parentElement.setAttribute("viewBox",`0 0 ${l} ${c}`),r.setAttribute("transform",a)}}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class tS extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=qe.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const n=document.createElement("mark");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class Jz extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class $z extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class eG extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),e){const n=document.createElement("s");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class iS extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=qe.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class tG extends qt{#e=null;constructor(e){super(e,{isRenderable:!0});const{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...t})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:t}=this;let n;t.hasAppearance||t.fillAlpha===0?n=document.createElement("div"):(n=document.createElement("img"),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(n.style=`filter: opacity(${Math.round(t.fillAlpha*100)}%);`)),n.addEventListener("dblclick",this.#t.bind(this)),this.#e=n;const{isMac:s}=vi.platform;return e.addEventListener("keydown",r=>{r.key==="Enter"&&(s?r.metaKey:r.ctrlKey)&&this.#t()}),!t.popupRef&&this.hasPopupData?this._createPopup():n.classList.add("popupTriggerArea"),e.append(n),e}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}#t(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}let i2=class nS{#e=null;#t=null;#n=null;#i=new Map;#r=null;#s=null;constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:s,page:r,viewport:a,structTreeLayer:l,commentManager:c,linkService:h,annotationStorage:d}){this.div=e,this.#e=t,this.#t=n,this.#r=l||null,this.#s=h||null,this.#n=d||new q1,this.page=r,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=s,this._commentManager=c||null}hasEditableAnnotations(){return this.#i.size>0}async#a(e,t,n){const s=e.firstChild||e,r=s.id=`${j1}${t}`,a=await this.#r?.getAriaAttributes(r);if(a)for(const[l,c]of a)s.setAttribute(l,c);n?n.at(-1).container.after(e):(this.div.append(e),this.#e?.moveElementInDOM(this.div,e,s,!1))}async render(e){const{annotations:t}=e,n=this.div;Or(n,this.viewport);const s=new Map,r={data:null,layer:n,linkService:this.#s,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new Hc,annotationStorage:this.#n,enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const a of t){if(a.noHTML)continue;const l=a.annotationType===$t.POPUP;if(l){const d=s.get(a.id);if(!d)continue;r.elements=d}else if(a.rect[2]===a.rect[0]||a.rect[3]===a.rect[1])continue;r.data=a;const c=Pw.create(r);if(!c.isRenderable)continue;if(!l&&a.popupRef){const d=s.get(a.popupRef);d?d.push(c):s.set(a.popupRef,[c])}const h=c.render();a.hidden&&(h.style.visibility="hidden"),await this.#a(h,a.id,r.elements),c.extraPopupElement?.popup?.renderCommentButton(),c._isEditable&&(this.#i.set(c.data.id,c),this._annotationEditorUIManager?.renderAnnotationElement(c))}this.#o()}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:this.#s,svgFactory:new Hc,parent:this};for(const n of e){n.borderStyle||=nS._defaultBorderStyle,t.data=n;const s=Pw.create(t);if(!s.isRenderable)continue;const r=s.render();await this.#a(r,n.id,null)}}update({viewport:e}){const t=this.div;this.viewport=e,Or(t,{rotation:e.rotation}),this.#o(),t.hidden=!1}#o(){if(!this.#t)return;const e=this.div;for(const[t,n]of this.#t){const s=e.querySelector(`[data-annotation-id="${t}"]`);if(!s)continue;n.className="annotationContent";const{firstChild:r}=s;r?r.nodeName==="CANVAS"?r.replaceWith(n):r.classList.contains("annotationContent")?r.after(n):r.before(n):s.append(n);const a=this.#i.get(t);a&&(a._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(t,s.id,n),a._hasNoCanvas=!1):a.canvas=n)}this.#t.clear()}getEditableAnnotations(){return Array.from(this.#i.values())}getEditableAnnotation(e){return this.#i.get(e)}addFakeAnnotation(e){const{div:t}=this,{id:n,rotation:s}=e,r=new Uz({data:{id:n,rect:e.getPDFRect(),rotation:s},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:this.#s,annotationStorage:this.#n}),a=r.render();return t.append(a),this.#e?.moveElementInDOM(t,a,a,!1),r.createOrUpdatePopup(),r}static get _defaultBorderStyle(){return Je(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:So.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};const $h=/\r\n?|\n/g;class mi extends Fe{#e="";#t=`${this.id}-editor`;#n=null;#i;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const e=mi.prototype,t=r=>r.isEmpty(),n=Js.TRANSLATE_SMALL,s=Js.TRANSLATE_BIG;return Je(this,"_keyboardManager",new hu([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-s,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[n,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[s,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-s],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,n],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,s],checker:t}]]))}static _type="freetext";static _editorType=qe.FREETEXT;constructor(e){super({...e,name:"freeTextEditor"}),this.color=e.color||mi._defaultColor||Fe._defaultLineColor,this.#i=e.fontSize||mi._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(e,t){Fe.initialize(e,t);const n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case ot.FREETEXT_SIZE:mi._defaultFontSize=t;break;case ot.FREETEXT_COLOR:mi._defaultColor=t;break}}updateParams(e,t){switch(e){case ot.FREETEXT_SIZE:this.#r(t);break;case ot.FREETEXT_COLOR:this.#s(t);break}}static get defaultPropertiesToUpdate(){return[[ot.FREETEXT_SIZE,mi._defaultFontSize],[ot.FREETEXT_COLOR,mi._defaultColor||Fe._defaultLineColor]]}get propertiesToUpdate(){return[[ot.FREETEXT_SIZE,this.#i],[ot.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new Gc(this),[["colorPicker",this._colorPicker]]}get colorType(){return ot.FREETEXT_COLOR}#r(e){const t=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--total-scale-factor))`,this.translate(0,-(s-this.#i)*this.parentScale),this.#i=s,this.#o()},n=this.#i;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ot.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#s(e){const t=s=>{this.color=s,this.onUpdatedColor()},n=this.color;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ot.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){const e=this.parentScale;return[-mi._internalPadding*e,-(mi._internalPadding+this.#i)*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#n=new AbortController;const e=this._uiManager.combinedSignal(this.#n);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#t),this._isDraggable=!0,this.#n?.abort(),this.#n=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#a(){const e=[];this.editorDiv.normalize();let t=null;for(const n of this.editorDiv.childNodes)t?.nodeType===Node.TEXT_NODE&&n.nodeName==="BR"||(e.push(mi.#c(n)),t=n);return e.join(`
`)}#o(){const[e,t]=this.parentDimensions;let n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{const{currentLayer:s,div:r}=this,a=r.style.display,l=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",s.div.append(this.div),n=r.getBoundingClientRect(),r.remove(),r.style.display=a,r.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=n.width/e,this.height=n.height/t):(this.width=n.height/e,this.height=n.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=this.#e,t=this.#e=this.#a().trimEnd();if(e===t)return;const n=s=>{if(this.#e=s,!s){this.remove();return}this.#l(),this._uiManager.rebuild(this),this.#o()};this.addCommands({cmd:()=>{n(t)},undo:()=>{n(e)},mustExec:!1}),this.#o()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){mi._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let e,t;(this._isCopy||this.annotationElementId)&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#t),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize=`calc(${this.#i}px * var(--total-scale-factor))`,n.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[s,r]=this.parentDimensions;if(this.annotationElementId){const{position:a}=this._initialData;let[l,c]=this.getInitialTranslation();[l,c]=this.pageTranslationToScreen(l,c);const[h,d]=this.pageDimensions,[f,p]=this.pageTranslation;let g,y;switch(this.rotation){case 0:g=e+(a[0]-f)/h,y=t+this.height-(a[1]-p)/d;break;case 90:g=e+(a[0]-f)/h,y=t-(a[1]-p)/d,[l,c]=[c,-l];break;case 180:g=e-this.width+(a[0]-f)/h,y=t-(a[1]-p)/d,[l,c]=[-l,-c];break;case 270:g=e+(a[0]-f-this.height*d)/h,y=t+(a[1]-p-this.width*h)/d,[l,c]=[-c,l];break}this.setAt(g*s,y*r,l,c)}else this._moveAfterPaste(e,t);this.#l(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll($h,"")}editorDivPaste(e){const t=e.clipboardData||window.clipboardData,{types:n}=t;if(n.length===1&&n[0]==="text/plain")return;e.preventDefault();const s=mi.#h(t.getData("text")||"").replaceAll($h,`
`);if(!s)return;const r=window.getSelection();if(!r.rangeCount)return;this.editorDiv.normalize(),r.deleteFromDocument();const a=r.getRangeAt(0);if(!s.includes(`
`)){a.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),r.collapseToStart();return}const{startContainer:l,startOffset:c}=a,h=[],d=[];if(l.nodeType===Node.TEXT_NODE){const g=l.parentElement;if(d.push(l.nodeValue.slice(c).replaceAll($h,"")),g!==this.editorDiv){let y=h;for(const x of this.editorDiv.childNodes){if(x===g){y=d;continue}y.push(mi.#c(x))}}h.push(l.nodeValue.slice(0,c).replaceAll($h,""))}else if(l===this.editorDiv){let g=h,y=0;for(const x of this.editorDiv.childNodes)y++===c&&(g=d),g.push(mi.#c(x))}this.#e=`${h.join(`
`)}${s}${d.join(`
`)}`,this.#l();const f=new Range;let p=Math.sumPrecise(h.map(g=>g.length));for(const{firstChild:g}of this.editorDiv.childNodes)if(g.nodeType===Node.TEXT_NODE){const y=g.nodeValue.length;if(p<=y){f.setStart(g,p),f.setEnd(g,p);break}p-=y}r.removeAllRanges(),r.addRange(f)}#l(){if(this.editorDiv.replaceChildren(),!!this.#e)for(const e of this.#e.split(`
`)){const t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#d(){return this.#e.replaceAll(""," ")}static#h(e){return e.replaceAll(" ","")}get contentDiv(){return this.editorDiv}getPDFRect(){const e=mi._internalPadding*this.parentScale;return this.getRect(e,e)}static async deserialize(e,t,n){let s=null;if(e instanceof $4){const{data:{defaultAppearanceData:{fontSize:a,fontColor:l},rect:c,rotation:h,id:d,popupRef:f,richText:p,contentsObj:g,creationDate:y,modificationDate:x},textContent:b,textPosition:w,parent:{page:{pageNumber:S}}}=e;if(!b||b.length===0)return null;s=e={annotationType:qe.FREETEXT,color:Array.from(l),fontSize:a,value:b.join(`
`),position:w,pageIndex:S-1,rect:c.slice(0),rotation:h,annotationElementId:d,id:d,deleted:!1,popupRef:f,comment:g?.str||null,richText:p,creationDate:y,modificationDate:x}}const r=await super.deserialize(e,t,n);return r.#i=e.fontSize,r.color=Ce.makeHexColor(...e.color),r.#e=mi.#h(e.value),r._initialData=s,e.comment&&r.setCommentData(e),r}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const t=Fe._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),n=Object.assign(super.serialize(e),{color:t,fontSize:this.#i,value:this.#d()});return this.addComment(n),e?(n.isCopy=!0,n):this.annotationElementId&&!this.#f(n)?null:(n.id=this.annotationElementId,n)}#f(e){const{value:t,fontSize:n,color:s,pageIndex:r}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||e.value!==t||e.fontSize!==n||e.color.some((a,l)=>a!==s[l])||e.pageIndex!==r}renderAnnotationElement(e){const t=super.renderAnnotationElement(e);if(!t)return null;const{style:n}=t;n.fontSize=`calc(${this.#i}px * var(--total-scale-factor))`,n.color=this.color,t.replaceChildren();for(const s of this.#e.split(`
`)){const r=document.createElement("div");r.append(s?document.createTextNode(s):document.createElement("br")),t.append(r)}return e.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#e}}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}}class Se{static PRECISION=1e-4;toSVGPath(){Nt("Abstract method `toSVGPath` must be implemented.")}get box(){Nt("Abstract getter `box` must be implemented.")}serialize(e,t){Nt("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,s,r,a){a||=new Float32Array(e.length);for(let l=0,c=e.length;l<c;l+=2)a[l]=t+e[l]*s,a[l+1]=n+e[l+1]*r;return a}static _rescaleAndSwap(e,t,n,s,r,a){a||=new Float32Array(e.length);for(let l=0,c=e.length;l<c;l+=2)a[l]=t+e[l+1]*s,a[l+1]=n+e[l]*r;return a}static _translate(e,t,n,s){s||=new Float32Array(e.length);for(let r=0,a=e.length;r<a;r+=2)s[r]=t+e[r],s[r+1]=n+e[r+1];return s}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,s,r){switch(r){case 90:return[1-t/n,e/s];case 180:return[1-e/n,1-t/s];case 270:return[t/n,1-e/s];default:return[e/n,t/s]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,s,r,a){return[(e+5*n)/6,(t+5*s)/6,(5*n+r)/6,(5*s+a)/6,(n+r)/2,(s+a)/2]}}class ha{#e;#t=[];#n;#i;#r=[];#s=new Float32Array(18);#a;#o;#c;#l;#d;#h;#f=[];static#g=8;static#m=2;static#u=ha.#g+ha.#m;constructor({x:e,y:t},n,s,r,a,l=0){this.#e=n,this.#h=r*s,this.#i=a,this.#s.set([NaN,NaN,NaN,NaN,e,t],6),this.#n=l,this.#l=ha.#g*s,this.#c=ha.#u*s,this.#d=s,this.#f.push(e,t)}isEmpty(){return isNaN(this.#s[8])}#p(){const e=this.#s.subarray(4,6),t=this.#s.subarray(16,18),[n,s,r,a]=this.#e;return[(this.#a+(e[0]-t[0])/2-n)/r,(this.#o+(e[1]-t[1])/2-s)/a,(this.#a+(t[0]-e[0])/2-n)/r,(this.#o+(t[1]-e[1])/2-s)/a]}add({x:e,y:t}){this.#a=e,this.#o=t;const[n,s,r,a]=this.#e;let[l,c,h,d]=this.#s.subarray(8,12);const f=e-h,p=t-d,g=Math.hypot(f,p);if(g<this.#c)return!1;const y=g-this.#l,x=y/g,b=x*f,w=x*p;let S=l,C=c;l=h,c=d,h+=b,d+=w,this.#f?.push(e,t);const E=-w/y,D=b/y,M=E*this.#h,N=D*this.#h;return this.#s.set(this.#s.subarray(2,8),0),this.#s.set([h+M,d+N],4),this.#s.set(this.#s.subarray(14,18),12),this.#s.set([h-M,d-N],16),isNaN(this.#s[6])?(this.#r.length===0&&(this.#s.set([l+M,c+N],2),this.#r.push(NaN,NaN,NaN,NaN,(l+M-n)/r,(c+N-s)/a),this.#s.set([l-M,c-N],14),this.#t.push(NaN,NaN,NaN,NaN,(l-M-n)/r,(c-N-s)/a)),this.#s.set([S,C,l,c,h,d],6),!this.isEmpty()):(this.#s.set([S,C,l,c,h,d],6),Math.abs(Math.atan2(C-c,S-l)-Math.atan2(w,b))<Math.PI/2?([l,c,h,d]=this.#s.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((l+h)/2-n)/r,((c+d)/2-s)/a),[l,c,S,C]=this.#s.subarray(14,18),this.#t.push(NaN,NaN,NaN,NaN,((S+l)/2-n)/r,((C+c)/2-s)/a),!0):([S,C,l,c,h,d]=this.#s.subarray(0,6),this.#r.push(((S+5*l)/6-n)/r,((C+5*c)/6-s)/a,((5*l+h)/6-n)/r,((5*c+d)/6-s)/a,((l+h)/2-n)/r,((c+d)/2-s)/a),[h,d,l,c,S,C]=this.#s.subarray(12,18),this.#t.push(((S+5*l)/6-n)/r,((C+5*c)/6-s)/a,((5*l+h)/6-n)/r,((5*c+d)/6-s)/a,((l+h)/2-n)/r,((c+d)/2-s)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const e=this.#r,t=this.#t;if(isNaN(this.#s[6])&&!this.isEmpty())return this.#A();const n=[];n.push(`M${e[4]} ${e[5]}`);for(let s=6;s<e.length;s+=6)isNaN(e[s])?n.push(`L${e[s+4]} ${e[s+5]}`):n.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);this.#v(n);for(let s=t.length-6;s>=6;s-=6)isNaN(t[s])?n.push(`L${t[s+4]} ${t[s+5]}`):n.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);return this.#y(n),n.join(" ")}#A(){const[e,t,n,s]=this.#e,[r,a,l,c]=this.#p();return`M${(this.#s[2]-e)/n} ${(this.#s[3]-t)/s} L${(this.#s[4]-e)/n} ${(this.#s[5]-t)/s} L${r} ${a} L${l} ${c} L${(this.#s[16]-e)/n} ${(this.#s[17]-t)/s} L${(this.#s[14]-e)/n} ${(this.#s[15]-t)/s} Z`}#y(e){const t=this.#t;e.push(`L${t[4]} ${t[5]} Z`)}#v(e){const[t,n,s,r]=this.#e,a=this.#s.subarray(4,6),l=this.#s.subarray(16,18),[c,h,d,f]=this.#p();e.push(`L${(a[0]-t)/s} ${(a[1]-n)/r} L${c} ${h} L${d} ${f} L${(l[0]-t)/s} ${(l[1]-n)/r}`)}newFreeDrawOutline(e,t,n,s,r,a){return new sS(e,t,n,s,r,a)}getOutlines(){const e=this.#r,t=this.#t,n=this.#s,[s,r,a,l]=this.#e,c=new Float32Array((this.#f?.length??0)+2);for(let f=0,p=c.length-2;f<p;f+=2)c[f]=(this.#f[f]-s)/a,c[f+1]=(this.#f[f+1]-r)/l;if(c[c.length-2]=(this.#a-s)/a,c[c.length-1]=(this.#o-r)/l,isNaN(n[6])&&!this.isEmpty())return this.#E(c);const h=new Float32Array(this.#r.length+24+this.#t.length);let d=e.length;for(let f=0;f<d;f+=2){if(isNaN(e[f])){h[f]=h[f+1]=NaN;continue}h[f]=e[f],h[f+1]=e[f+1]}d=this.#x(h,d);for(let f=t.length-6;f>=6;f-=6)for(let p=0;p<6;p+=2){if(isNaN(t[f+p])){h[d]=h[d+1]=NaN,d+=2;continue}h[d]=t[f+p],h[d+1]=t[f+p+1],d+=2}return this.#S(h,d),this.newFreeDrawOutline(h,c,this.#e,this.#d,this.#n,this.#i)}#E(e){const t=this.#s,[n,s,r,a]=this.#e,[l,c,h,d]=this.#p(),f=new Float32Array(36);return f.set([NaN,NaN,NaN,NaN,(t[2]-n)/r,(t[3]-s)/a,NaN,NaN,NaN,NaN,(t[4]-n)/r,(t[5]-s)/a,NaN,NaN,NaN,NaN,l,c,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,(t[16]-n)/r,(t[17]-s)/a,NaN,NaN,NaN,NaN,(t[14]-n)/r,(t[15]-s)/a],0),this.newFreeDrawOutline(f,e,this.#e,this.#d,this.#n,this.#i)}#S(e,t){const n=this.#t;return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6}#x(e,t){const n=this.#s.subarray(4,6),s=this.#s.subarray(16,18),[r,a,l,c]=this.#e,[h,d,f,p]=this.#p();return e.set([NaN,NaN,NaN,NaN,(n[0]-r)/l,(n[1]-a)/c,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,f,p,NaN,NaN,NaN,NaN,(s[0]-r)/l,(s[1]-a)/c],t),t+=24}}class sS extends Se{#e;#t=new Float32Array(4);#n;#i;#r;#s;#a;constructor(e,t,n,s,r,a){super(),this.#a=e,this.#r=t,this.#e=n,this.#s=s,this.#n=r,this.#i=a,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#o(a);const[l,c,h,d]=this.#t;for(let f=0,p=e.length;f<p;f+=2)e[f]=(e[f]-l)/h,e[f+1]=(e[f+1]-c)/d;for(let f=0,p=t.length;f<p;f+=2)t[f]=(t[f]-l)/h,t[f+1]=(t[f+1]-c)/d}toSVGPath(){const e=[`M${this.#a[4]} ${this.#a[5]}`];for(let t=6,n=this.#a.length;t<n;t+=6){if(isNaN(this.#a[t])){e.push(`L${this.#a[t+4]} ${this.#a[t+5]}`);continue}e.push(`C${this.#a[t]} ${this.#a[t+1]} ${this.#a[t+2]} ${this.#a[t+3]} ${this.#a[t+4]} ${this.#a[t+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,t,n,s],r){const a=n-e,l=s-t;let c,h;switch(r){case 0:c=Se._rescale(this.#a,e,s,a,-l),h=Se._rescale(this.#r,e,s,a,-l);break;case 90:c=Se._rescaleAndSwap(this.#a,e,t,a,l),h=Se._rescaleAndSwap(this.#r,e,t,a,l);break;case 180:c=Se._rescale(this.#a,n,t,-a,l),h=Se._rescale(this.#r,n,t,-a,l);break;case 270:c=Se._rescaleAndSwap(this.#a,n,s,-a,-l),h=Se._rescaleAndSwap(this.#r,n,s,-a,-l);break}return{outline:Array.from(c),points:[Array.from(h)]}}#o(e){const t=this.#a;let n=t[4],s=t[5];const r=[n,s,n,s];let a=n,l=s,c=n,h=s;const d=e?Math.max:Math.min,f=new Float32Array(4);for(let g=6,y=t.length;g<y;g+=6){const x=t[g+4],b=t[g+5];isNaN(t[g])?(Ce.pointBoundingBox(x,b,r),l>b?(a=x,l=b):l===b&&(a=d(a,x)),h<b?(c=x,h=b):h===b&&(c=d(c,x))):(f[0]=f[1]=1/0,f[2]=f[3]=-1/0,Ce.bezierBoundingBox(n,s,...t.slice(g,g+6),f),Ce.rectBoundingBox(f[0],f[1],f[2],f[3],r),l>f[1]?(a=f[0],l=f[1]):l===f[1]&&(a=d(a,f[0])),h<f[3]?(c=f[2],h=f[3]):h===f[3]&&(c=d(c,f[2]))),n=x,s=b}const p=this.#t;p[0]=r[0]-this.#n,p[1]=r[1]-this.#n,p[2]=r[2]-r[0]+2*this.#n,p[3]=r[3]-r[1]+2*this.#n,this.firstPoint=[a,l],this.lastPoint=[c,h]}get box(){return this.#t}newOutliner(e,t,n,s,r,a=0){return new ha(e,t,n,s,r,a)}getNewOutline(e,t){const[n,s,r,a]=this.#t,[l,c,h,d]=this.#e,f=r*h,p=a*d,g=n*h+l,y=s*d+c,x=this.newOutliner({x:this.#r[0]*f+g,y:this.#r[1]*p+y},this.#e,this.#s,e,this.#i,t??this.#n);for(let b=2;b<this.#r.length;b+=2)x.add({x:this.#r[b]*f+g,y:this.#r[b+1]*p+y});return x.getOutlines()}}class Cg{#e;#t;#n;#i=[];#r=[];constructor(e,t=0,n=0,s=!0){const r=[1/0,1/0,-1/0,-1/0],a=10**-4;for(const{x,y:b,width:w,height:S}of e){const C=Math.floor((x-t)/a)*a,E=Math.ceil((x+w+t)/a)*a,D=Math.floor((b-t)/a)*a,M=Math.ceil((b+S+t)/a)*a,N=[C,D,M,!0],I=[E,D,M,!1];this.#i.push(N,I),Ce.rectBoundingBox(C,D,E,M,r)}const l=r[2]-r[0]+2*n,c=r[3]-r[1]+2*n,h=r[0]-n,d=r[1]-n;let f=s?-1/0:1/0,p=1/0;const g=this.#i.at(s?-1:-2),y=[g[0],g[2]];for(const x of this.#i){const[b,w,S,C]=x;!C&&s?w<p?(p=w,f=b):w===p&&(f=Math.max(f,b)):C&&!s&&(w<p?(p=w,f=b):w===p&&(f=Math.min(f,b))),x[0]=(b-h)/l,x[1]=(w-d)/c,x[2]=(S-d)/c}this.#e=new Float32Array([h,d,l,c]),this.#t=[f,p],this.#n=y}getOutlines(){this.#i.sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);const e=[];for(const t of this.#i)t[3]?(e.push(...this.#l(t)),this.#o(t)):(this.#c(t),e.push(...this.#l(t)));return this.#s(e)}#s(e){const t=[],n=new Set;for(const a of e){const[l,c,h]=a;t.push([l,c,a],[l,h,a])}t.sort((a,l)=>a[1]-l[1]||a[0]-l[0]);for(let a=0,l=t.length;a<l;a+=2){const c=t[a][2],h=t[a+1][2];c.push(h),h.push(c),n.add(c),n.add(h)}const s=[];let r;for(;n.size>0;){const a=n.values().next().value;let[l,c,h,d,f]=a;n.delete(a);let p=l,g=c;for(r=[l,h],s.push(r);;){let y;if(n.has(d))y=d;else if(n.has(f))y=f;else break;n.delete(y),[l,c,h,d,f]=y,p!==l&&(r.push(p,g,l,g===c?c:h),p=l),g=g===c?h:c}r.push(p,g)}return new iG(s,this.#e,this.#t,this.#n)}#a(e){const t=this.#r;let n=0,s=t.length-1;for(;n<=s;){const r=n+s>>1,a=t[r][0];if(a===e)return r;a<e?n=r+1:s=r-1}return s+1}#o([,e,t]){const n=this.#a(e);this.#r.splice(n,0,[e,t])}#c([,e,t]){const n=this.#a(e);for(let s=n;s<this.#r.length;s++){const[r,a]=this.#r[s];if(r!==e)break;if(r===e&&a===t){this.#r.splice(s,1);return}}for(let s=n-1;s>=0;s--){const[r,a]=this.#r[s];if(r!==e)break;if(r===e&&a===t){this.#r.splice(s,1);return}}}#l(e){const[t,n,s]=e,r=[[t,n,s]],a=this.#a(s);for(let l=0;l<a;l++){const[c,h]=this.#r[l];for(let d=0,f=r.length;d<f;d++){const[,p,g]=r[d];if(!(h<=p||g<=c)){if(p>=c){if(g>h)r[d][1]=h;else{if(f===1)return[];r.splice(d,1),d--,f--}continue}r[d][2]=c,g>h&&r.push([t,h,g])}}}return r}}class iG extends Se{#e;#t;constructor(e,t,n,s){super(),this.#t=e,this.#e=t,this.firstPoint=n,this.lastPoint=s}toSVGPath(){const e=[];for(const t of this.#t){let[n,s]=t;e.push(`M${n} ${s}`);for(let r=2;r<t.length;r+=2){const a=t[r],l=t[r+1];a===n?(e.push(`V${l}`),s=l):l===s&&(e.push(`H${a}`),n=a)}e.push("Z")}return e.join(" ")}serialize([e,t,n,s],r){const a=[],l=n-e,c=s-t;for(const h of this.#t){const d=new Array(h.length);for(let f=0;f<h.length;f+=2)d[f]=e+h[f]*l,d[f+1]=s-h[f+1]*c;a.push(d)}return a}get box(){return this.#e}get classNamesForOutlining(){return["highlightOutline"]}}class Eg extends ha{newFreeDrawOutline(e,t,n,s,r,a){return new nG(e,t,n,s,r,a)}}class nG extends sS{newOutliner(e,t,n,s,r,a=0){return new Eg(e,t,n,s,r,a)}}class ei extends Fe{#e=null;#t=0;#n;#i=null;#r=null;#s=null;#a=null;#o=0;#c=null;#l=null;#d=null;#h=!1;#f=null;#g=null;#m=null;#u="";#p;#A="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=qe.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const e=ei.prototype;return Je(this,"_keyboardManager",new hu([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super({...e,name:"highlightEditor"}),this.color=e.color||ei._defaultColor,this.#p=e.thickness||ei._defaultThickness,this.opacity=e.opacity||ei._defaultOpacity,this.#n=e.boxes||null,this.#A=e.methodOfCreation||"",this.#u=e.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(this.#h=!0,this.#v(e),this.#w()):this.#n&&(this.#e=e.anchorNode,this.#t=e.anchorOffset,this.#a=e.focusNode,this.#o=e.focusOffset,this.#y(),this.#w(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#h?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#p,methodOfCreation:this.#A}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#y(){const e=new Cg(this.#n,.001);this.#l=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;const t=new Cg(this.#n,.0025,.001,this._uiManager.direction==="ltr");this.#s=t.getOutlines();const{firstPoint:n}=this.#l;this.#f=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height];const{lastPoint:s}=this.#s;this.#g=[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height]}#v({highlightOutlines:e,highlightId:t,clipPathId:n}){this.#l=e;const s=1.5;if(this.#s=e.getNewOutline(this.#p/2+s,.0025),t>=0)this.#d=t,this.#i=n,this.parent.drawLayer.finalizeDraw(t,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#m=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},!0);else if(this.parent){const f=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#d,{bbox:ei.#C(this.#l.box,(f-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#m,{bbox:ei.#C(this.#s.box,f),path:{d:this.#s.toSVGPath()}})}const[r,a,l,c]=e.box;switch(this.rotation){case 0:this.x=r,this.y=a,this.width=l,this.height=c;break;case 90:{const[f,p]=this.parentDimensions;this.x=a,this.y=1-r,this.width=l*p/f,this.height=c*f/p;break}case 180:this.x=1-r,this.y=1-a,this.width=l,this.height=c;break;case 270:{const[f,p]=this.parentDimensions;this.x=1-a,this.y=r,this.width=l*p/f,this.height=c*f/p;break}}const{firstPoint:h}=e;this.#f=[(h[0]-r)/l,(h[1]-a)/c];const{lastPoint:d}=this.#s;this.#g=[(d[0]-r)/l,(d[1]-a)/c]}static initialize(e,t){Fe.initialize(e,t),ei._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case ot.HIGHLIGHT_COLOR:ei._defaultColor=t;break;case ot.HIGHLIGHT_THICKNESS:ei._defaultThickness=t;break}}translateInPage(e,t){}get toolbarPosition(){return this.#g}get commentButtonPosition(){return this.#f}updateParams(e,t){switch(e){case ot.HIGHLIGHT_COLOR:this.#E(t);break;case ot.HIGHLIGHT_THICKNESS:this.#S(t);break}}static get defaultPropertiesToUpdate(){return[[ot.HIGHLIGHT_COLOR,ei._defaultColor],[ot.HIGHLIGHT_THICKNESS,ei._defaultThickness]]}get propertiesToUpdate(){return[[ot.HIGHLIGHT_COLOR,this.color||ei._defaultColor],[ot.HIGHLIGHT_THICKNESS,this.#p||ei._defaultThickness],[ot.HIGHLIGHT_FREE,this.#h]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#d,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#r?.updateColor(this.color),super.onUpdatedColor()}#E(e){const t=(r,a)=>{this.color=r,this.opacity=a,this.onUpdatedColor()},n=this.color,s=this.opacity;this.addCommands({cmd:t.bind(this,e,ei._defaultOpacity),undo:t.bind(this,n,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ot.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(e)},!0)}#S(e){const t=this.#p,n=s=>{this.#p=s,this.#x(s)};this.addCommands({cmd:n.bind(this,e),undo:n.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ot.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#r=new mn({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#R())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#R())}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){this.#M(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#w(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#M():e&&(this.#w(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#x(e){this.#h&&(this.#v({highlightOutlines:this.#l.getNewOutline(e/2)}),this.fixAndSetPosition(),this.setDims(this.width,this.height))}#M(){this.#d===null||!this.parent||(this.parent.drawLayer.remove(this.#d),this.#d=null,this.parent.drawLayer.remove(this.#m),this.#m=null)}#w(e=this.parent){this.#d===null&&({id:this.#d,clipPathId:this.#i}=e.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#h},path:{d:this.#l.toSVGPath()}},!1,!0),this.#m=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#h},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},this.#h),this.#c&&(this.#c.style.clipPath=this.#i))}static#C([e,t,n,s],r){switch(r){case 90:return[1-t-s,e,s,n];case 180:return[1-e-n,1-t-s,n,s];case 270:return[t,1-e-n,s,n]}return[e,t,n,s]}rotate(e){const{drawLayer:t}=this.parent;let n;this.#h?(e=(e-this.rotation+360)%360,n=ei.#C(this.#l.box,e)):n=ei.#C([this.x,this.y,this.width,this.height],e),t.updateProperties(this.#d,{bbox:n,root:{"data-main-rotation":e}}),t.updateProperties(this.#m,{bbox:ei.#C(this.#s.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();this.#u&&(e.setAttribute("aria-label",this.#u),e.setAttribute("role","mark")),this.#h?e.classList.add("free"):this.div.addEventListener("keydown",this.#N.bind(this),{signal:this._uiManager._signal});const t=this.#c=document.createElement("div");return e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#i,this.setDims(this.width,this.height),F4(this,this.#c,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{hovered:!1}})}#N(e){ei._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#D(!0);break;case 1:case 3:this.#D(!1);break}}#D(e){if(!this.#e)return;const t=window.getSelection();e?t.setPosition(this.#e,this.#t):t.setPosition(this.#a,this.#o)}select(){super.select(),this.#m&&this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#m&&(this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{selected:!1}}),this.#h||this.#D(!1))}get _mustFixPosition(){return!this.#h}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#d,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#m,{rootClass:{hidden:!e}}))}#R(){return this.#h?this.rotation:0}#k(){if(this.#h)return null;const[e,t]=this.pageDimensions,[n,s]=this.pageTranslation,r=this.#n,a=new Float32Array(r.length*8);let l=0;for(const{x:c,y:h,width:d,height:f}of r){const p=c*e+n,g=(1-h)*t+s;a[l]=a[l+4]=p,a[l+1]=a[l+3]=g,a[l+2]=a[l+6]=p+d*e,a[l+5]=a[l+7]=g-f*t,l+=8}return a}#_(e){return this.#l.serialize(e,this.#R())}static startHighlighting(e,t,{target:n,x:s,y:r}){const{x:a,y:l,width:c,height:h}=n.getBoundingClientRect(),d=new AbortController,f=e.combinedSignal(d),p=g=>{d.abort(),this.#O(e,g)};window.addEventListener("blur",p,{signal:f}),window.addEventListener("pointerup",p,{signal:f}),window.addEventListener("pointerdown",Yt,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",yn,{signal:f}),n.addEventListener("pointermove",this.#P.bind(this,e),{signal:f}),this._freeHighlight=new Eg({x:s,y:r},[a,l,c,h],e.scale,this._defaultThickness/2,t,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#P(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#O(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(e,t,n){let s=null;if(e instanceof tS){const{data:{quadPoints:y,rect:x,rotation:b,id:w,color:S,opacity:C,popupRef:E,richText:D,contentsObj:M,creationDate:N,modificationDate:I},parent:{page:{pageNumber:_}}}=e;s=e={annotationType:qe.HIGHLIGHT,color:Array.from(S),opacity:C,quadPoints:y,boxes:null,pageIndex:_-1,rect:x.slice(0),rotation:b,annotationElementId:w,id:w,deleted:!1,popupRef:E,richText:D,comment:M?.str||null,creationDate:N,modificationDate:I}}else if(e instanceof t2){const{data:{inkLists:y,rect:x,rotation:b,id:w,color:S,borderStyle:{rawWidth:C},popupRef:E,richText:D,contentsObj:M,creationDate:N,modificationDate:I},parent:{page:{pageNumber:_}}}=e;s=e={annotationType:qe.HIGHLIGHT,color:Array.from(S),thickness:C,inkLists:y,boxes:null,pageIndex:_-1,rect:x.slice(0),rotation:b,annotationElementId:w,id:w,deleted:!1,popupRef:E,richText:D,comment:M?.str||null,creationDate:N,modificationDate:I}}const{color:r,quadPoints:a,inkLists:l,opacity:c}=e,h=await super.deserialize(e,t,n);h.color=Ce.makeHexColor(...r),h.opacity=c||1,l&&(h.#p=e.thickness),h._initialData=s,e.comment&&h.setCommentData(e);const[d,f]=h.pageDimensions,[p,g]=h.pageTranslation;if(a){const y=h.#n=[];for(let x=0;x<a.length;x+=8)y.push({x:(a[x]-p)/d,y:1-(a[x+1]-g)/f,width:(a[x+2]-a[x])/d,height:(a[x+1]-a[x+5])/f});h.#y(),h.#w(),h.rotate(h.rotation)}else if(l){h.#h=!0;const y=l[0],x={x:y[0]-p,y:f-(y[1]-g)},b=new Eg(x,[0,0,d,f],1,h.#p/2,!0,.001);for(let C=0,E=y.length;C<E;C+=2)x.x=y[C]-p,x.y=f-(y[C+1]-g),b.add(x);const{id:w,clipPathId:S}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:h.color,"fill-opacity":h._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:b.toSVGPath()}},!0,!0);h.#v({highlightOutlines:b.getOutlines(),highlightId:w,clipPathId:S}),h.#w(),h.rotate(h.parentRotation)}return h}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const t=Fe._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),n=super.serialize(e);return Object.assign(n,{color:t,opacity:this.opacity,thickness:this.#p,quadPoints:this.#k(),outlines:this.#_(n.rect)}),this.addComment(n),this.annotationElementId&&!this.#B(n)?null:(n.id=this.annotationElementId,n)}#B(e){const{color:t}=this._initialData;return this.hasEditedComment||e.color.some((n,s)=>n!==t[s])}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class rS{#e=Object.create(null);updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,n]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,n)}updateSVGProperty(e,t){this.#e[e]=t}toSVGProperties(){const e=this.#e;return this.#e=Object.create(null),{root:e}}reset(){this.#e=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){Nt("Not implemented")}}class ze extends Fe{#e=null;#t;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#n=null;static#i=null;static#r=null;static#s=NaN;static#a=null;static#o=null;static#c=NaN;static _INNER_MARGIN=3;constructor(e){super(e),this.#t=e.mustBeCommitted||!1,this._addOutlines(e)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(e){e.drawOutlines&&(this.#l(e),this.#f())}#l({drawOutlines:e,drawId:t,drawingOptions:n}){this.#e=e,this._drawingOptions||=n,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),t>=0?(this._drawId=t,this.parent.drawLayer.finalizeDraw(t,e.defaultProperties)):this._drawId=this.#d(e,this.parent),this.#u(e.box)}#d(e,t){const{id:n}=t.drawLayer.draw(ze._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return n}static _mergeSVGProperties(e,t){const n=new Set(Object.keys(e));for(const[s,r]of Object.entries(t))n.has(s)?Object.assign(e[s],r):e[s]=r;return e}static getDefaultDrawingOptions(e){Nt("Not implemented")}static get typesMap(){Nt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,t){const n=this.typesMap.get(e);n&&this._defaultDrawingOptions.updateProperty(n,t),this._currentParent&&(ze.#n.updateProperty(n,t),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,t){const n=this.constructor.typesMap.get(e);n&&this._updateProperty(e,n,t)}static get defaultPropertiesToUpdate(){const e=[],t=this._defaultDrawingOptions;for(const[n,s]of this.typesMap)e.push([n,t[s]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:t}=this;for(const[n,s]of this.constructor.typesMap)e.push([n,t[s]]);return e}_updateProperty(e,t,n){const s=this._drawingOptions,r=s[t],a=l=>{s.updateProperty(t,l);const c=this.#e.updateProperty(t,l);c&&this.#u(c),this.parent?.drawLayer.updateProperties(this._drawId,s.toSVGProperties()),e===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:a.bind(this,n),undo:a.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,ze._mergeSVGProperties(this.#e.getPathResizingSVGProperties(this.#m()),{bbox:this.#p()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,ze._mergeSVGProperties(this.#e.getPathResizedSVGProperties(this.#m()),{bbox:this.#p()}))}_onTranslating(e,t){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#p()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,ze._mergeSVGProperties(this.#e.getPathTranslatedSVGProperties(this.#m(),this.parentDimensions),{bbox:this.#p()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#t&&(this.#t=!1,this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){this.#h(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#f(),this.#u(this.#e.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),this.#h()):e&&(this._uiManager.addShouldRescale(this),this.#f(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),t&&this.select()}#h(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#f(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#d(this.#e,e)}}#g([e,t,n,s]){const{parentDimensions:[r,a],rotation:l}=this;switch(l){case 90:return[t,1-e,n*(a/r),s*(r/a)];case 180:return[1-e,1-t,n,s];case 270:return[1-t,e,n*(a/r),s*(r/a)];default:return[e,t,n,s]}}#m(){const{x:e,y:t,width:n,height:s,parentDimensions:[r,a],rotation:l}=this;switch(l){case 90:return[1-t,e,n*(r/a),s*(a/r)];case 180:return[1-e,1-t,n,s];case 270:return[t,1-e,n*(r/a),s*(a/r)];default:return[e,t,n,s]}}#u(e){[this.x,this.y,this.width,this.height]=this.#g(e),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#p(){const{x:e,y:t,width:n,height:s,rotation:r,parentRotation:a,parentDimensions:[l,c]}=this;switch((r*4+a)/90){case 1:return[1-t-s,e,s,n];case 2:return[1-e-n,1-t-s,n,s];case 3:return[t,1-e-n,s,n];case 4:return[e,t-n*(l/c),s*(c/l),n*(l/c)];case 5:return[1-t,e,n*(l/c),s*(c/l)];case 6:return[1-e-s*(c/l),1-t,s*(c/l),n*(l/c)];case 7:return[t-n*(l/c),1-e-s*(c/l),n*(l/c),s*(c/l)];case 8:return[e-n,t-s,n,s];case 9:return[1-t,e-n,s,n];case 10:return[1-e,1-t,n,s];case 11:return[t-s,1-e,s,n];case 12:return[e-s*(c/l),t,s*(c/l),n*(l/c)];case 13:return[1-t-n*(l/c),e-s*(c/l),n*(l/c),s*(c/l)];case 14:return[1-e,1-t-n*(l/c),s*(c/l),n*(l/c)];case 15:return[t,1-e,n*(l/c),s*(c/l)];default:return[e,t,n,s]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,ze._mergeSVGProperties({bbox:this.#p()},this.#e.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#u(this.#e.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e,t;this._isCopy&&(e=this.x,t=this.y);const n=super.render();n.classList.add("draw");const s=document.createElement("div");return n.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,t),n}static createDrawerInstance(e,t,n,s,r){Nt("Not implemented")}static startDrawing(e,t,n,s){const{target:r,offsetX:a,offsetY:l,pointerId:c,pointerType:h}=s;if(ze.#a&&ze.#a!==h)return;const{viewport:{rotation:d}}=e,{width:f,height:p}=r.getBoundingClientRect(),g=ze.#i=new AbortController,y=e.combinedSignal(g);if(ze.#s||=c,ze.#a??=h,window.addEventListener("pointerup",x=>{ze.#s===x.pointerId?this._endDraw(x):ze.#o?.delete(x.pointerId)},{signal:y}),window.addEventListener("pointercancel",x=>{ze.#s===x.pointerId?this._currentParent.endDrawingSession():ze.#o?.delete(x.pointerId)},{signal:y}),window.addEventListener("pointerdown",x=>{ze.#a===x.pointerType&&((ze.#o||=new Set).add(x.pointerId),ze.#n.isCancellable()&&(ze.#n.removeLastElement(),ze.#n.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:y}),window.addEventListener("contextmenu",yn,{signal:y}),r.addEventListener("pointermove",this._drawMove.bind(this),{signal:y}),r.addEventListener("touchmove",x=>{x.timeStamp===ze.#c&&Yt(x)},{signal:y}),e.toggleDrawing(),t._editorUndoBar?.hide(),ze.#n){e.drawLayer.updateProperties(this._currentDrawId,ze.#n.startNew(a,l,f,p,d));return}t.updateUIForDefaultProperties(this),ze.#n=this.createDrawerInstance(a,l,f,p,d),ze.#r=this.getDefaultDrawingOptions(),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(ze.#r.toSVGProperties(),ze.#n.defaultSVGProperties),!0,!1)}static _drawMove(e){if(ze.#c=-1,!ze.#n)return;const{offsetX:t,offsetY:n,pointerId:s}=e;if(ze.#s===s){if(ze.#o?.size>=1){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,ze.#n.add(t,n)),ze.#c=e.timeStamp,Yt(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,ze.#n=null,ze.#r=null,ze.#a=null,ze.#c=NaN),ze.#i&&(ze.#i.abort(),ze.#i=null,ze.#s=NaN,ze.#o=null)}static _endDraw(e){const t=this._currentParent;if(t){if(t.toggleDrawing(!0),this._cleanup(!1),e?.target===t.div&&t.drawLayer.updateProperties(this._currentDrawId,ze.#n.end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const n=ze.#n,s=this._currentDrawId,r=n.getLastElement();t.addCommands({cmd:()=>{t.drawLayer.updateProperties(s,n.setLastElement(r))},undo:()=>{t.drawLayer.updateProperties(s,n.removeLastElement())},mustExec:!1,type:ot.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const t=this._currentParent;if(!t)return null;if(t.toggleDrawing(!0),t.cleanUndoStack(ot.DRAW_STEP),!ze.#n.isEmpty()){const{pageDimensions:[n,s],scale:r}=t,a=t.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:ze.#n.getOutlines(n*r,s*r,r,this._INNER_MARGIN),drawingOptions:ze.#r,mustBeCommitted:!e});return this._cleanup(!0),a}return t.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,t,n,s,r,a){Nt("Not implemented")}static async deserialize(e,t,n){const{rawDims:{pageWidth:s,pageHeight:r,pageX:a,pageY:l}}=t.viewport,c=this.deserializeDraw(a,l,s,r,this._INNER_MARGIN,e),h=await super.deserialize(e,t,n);return h.createDrawingOptions(e),h.#l({drawOutlines:c}),h.#f(),h.onScaleChanging(),h.rotate(),h}serializeDraw(e){const[t,n]=this.pageTranslation,[s,r]=this.pageDimensions;return this.#e.serialize([t,n,s,r],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class sG{#e=new Float64Array(6);#t;#n;#i;#r;#s;#a="";#o=0;#c=new mu;#l;#d;constructor(e,t,n,s,r,a){this.#l=n,this.#d=s,this.#i=r,this.#r=a,[e,t]=this.#h(e,t);const l=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#s=[e,t],this.#n=[{line:l,points:this.#s}],this.#e.set(l,0)}updateProperty(e,t){e==="stroke-width"&&(this.#r=t)}#h(e,t){return Se._normalizePoint(e,t,this.#l,this.#d,this.#i)}isEmpty(){return!this.#n||this.#n.length===0}isCancellable(){return this.#s.length<=10}add(e,t){[e,t]=this.#h(e,t);const[n,s,r,a]=this.#e.subarray(2,6),l=e-r,c=t-a;return Math.hypot(this.#l*l,this.#d*c)<=2?null:(this.#s.push(e,t),isNaN(n)?(this.#e.set([r,a,e,t],2),this.#t.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#e[0])&&this.#t.splice(6,6),this.#e.set([n,s,r,a,e,t],0),this.#t.push(...Se.createBezierPoints(n,s,r,a,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const n=this.add(e,t);return n||(this.#s.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,s,r){this.#l=n,this.#d=s,this.#i=r,[e,t]=this.#h(e,t);const a=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#s=[e,t];const l=this.#n.at(-1);return l&&(l.line=new Float32Array(l.line),l.points=new Float32Array(l.points)),this.#n.push({line:a,points:this.#s}),this.#e.set(a,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#n.at(-1)}setLastElement(e){return this.#n?(this.#n.push(e),this.#t=e.line,this.#s=e.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#c.setLastElement(e)}removeLastElement(){if(!this.#n)return this.#c.removeLastElement();this.#n.pop(),this.#a="";for(let e=0,t=this.#n.length;e<t;e++){const{line:n,points:s}=this.#n[e];this.#t=n,this.#s=s,this.#o=0,this.toSVGPath()}return{path:{d:this.#a}}}toSVGPath(){const e=Se.svgRound(this.#t[4]),t=Se.svgRound(this.#t[5]);if(this.#s.length===2)return this.#a=`${this.#a} M ${e} ${t} Z`,this.#a;if(this.#s.length<=6){const s=this.#a.lastIndexOf("M");this.#a=`${this.#a.slice(0,s)} M ${e} ${t}`,this.#o=6}if(this.#s.length===4){const s=Se.svgRound(this.#t[10]),r=Se.svgRound(this.#t[11]);return this.#a=`${this.#a} L ${s} ${r}`,this.#o=12,this.#a}const n=[];this.#o===0&&(n.push(`M ${e} ${t}`),this.#o=6);for(let s=this.#o,r=this.#t.length;s<r;s+=6){const[a,l,c,h,d,f]=this.#t.slice(s,s+6).map(Se.svgRound);n.push(`C${a} ${l} ${c} ${h} ${d} ${f}`)}return this.#a+=n.join(" "),this.#o=this.#t.length,this.#a}getOutlines(e,t,n,s){const r=this.#n.at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),this.#c.build(this.#n,e,t,n,this.#i,this.#r,s),this.#e=null,this.#t=null,this.#n=null,this.#a=null,this.#c}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class mu extends Se{#e;#t=0;#n;#i;#r;#s;#a;#o;#c;build(e,t,n,s,r,a,l){this.#r=t,this.#s=n,this.#a=s,this.#o=r,this.#c=a,this.#n=l??0,this.#i=e,this.#h()}get thickness(){return this.#c}setLastElement(e){return this.#i.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#i.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:t}of this.#i){if(e.push(`M${Se.svgRound(t[4])} ${Se.svgRound(t[5])}`),t.length===6){e.push("Z");continue}if(t.length===12&&isNaN(t[6])){e.push(`L${Se.svgRound(t[10])} ${Se.svgRound(t[11])}`);continue}for(let n=6,s=t.length;n<s;n+=6){const[r,a,l,c,h,d]=t.subarray(n,n+6).map(Se.svgRound);e.push(`C${r} ${a} ${l} ${c} ${h} ${d}`)}}return e.join("")}serialize([e,t,n,s],r){const a=[],l=[],[c,h,d,f]=this.#d();let p,g,y,x,b,w,S,C,E;switch(this.#o){case 0:E=Se._rescale,p=e,g=t+s,y=n,x=-s,b=e+c*n,w=t+(1-h-f)*s,S=e+(c+d)*n,C=t+(1-h)*s;break;case 90:E=Se._rescaleAndSwap,p=e,g=t,y=n,x=s,b=e+h*n,w=t+c*s,S=e+(h+f)*n,C=t+(c+d)*s;break;case 180:E=Se._rescale,p=e+n,g=t,y=-n,x=s,b=e+(1-c-d)*n,w=t+h*s,S=e+(1-c)*n,C=t+(h+f)*s;break;case 270:E=Se._rescaleAndSwap,p=e+n,g=t+s,y=-n,x=-s,b=e+(1-h-f)*n,w=t+(1-c-d)*s,S=e+(1-h)*n,C=t+(1-c)*s;break}for(const{line:D,points:M}of this.#i)a.push(E(D,p,g,y,x,r?new Array(D.length):null)),l.push(E(M,p,g,y,x,r?new Array(M.length):null));return{lines:a,points:l,rect:[b,w,S,C]}}static deserialize(e,t,n,s,r,{paths:{lines:a,points:l},rotation:c,thickness:h}){const d=[];let f,p,g,y,x;switch(c){case 0:x=Se._rescale,f=-e/n,p=t/s+1,g=1/n,y=-1/s;break;case 90:x=Se._rescaleAndSwap,f=-t/s,p=-e/n,g=1/s,y=1/n;break;case 180:x=Se._rescale,f=e/n+1,p=-t/s,g=-1/n,y=1/s;break;case 270:x=Se._rescaleAndSwap,f=t/s+1,p=e/n+1,g=-1/s,y=-1/n;break}if(!a){a=[];for(const w of l){const S=w.length;if(S===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1]]));continue}if(S===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1],NaN,NaN,NaN,NaN,w[2],w[3]]));continue}const C=new Float32Array(3*(S-2));a.push(C);let[E,D,M,N]=w.subarray(0,4);C.set([NaN,NaN,NaN,NaN,E,D],0);for(let I=4;I<S;I+=2){const _=w[I],F=w[I+1];C.set(Se.createBezierPoints(E,D,M,N,_,F),(I-2)*3),[E,D,M,N]=[M,N,_,F]}}}for(let w=0,S=a.length;w<S;w++)d.push({line:x(a[w].map(C=>C??NaN),f,p,g,y),points:x(l[w].map(C=>C??NaN),f,p,g,y)});const b=new this.prototype.constructor;return b.build(d,n,s,1,c,h,r),b}#l(e=this.#c){const t=this.#n+e/2*this.#a;return this.#o%180===0?[t/this.#r,t/this.#s]:[t/this.#s,t/this.#r]}#d(){const[e,t,n,s]=this.#e,[r,a]=this.#l(0);return[e+r,t+a,n-2*r,s-2*a]}#h(){const e=this.#e=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:s}of this.#i){if(s.length<=12){for(let l=4,c=s.length;l<c;l+=6)Ce.pointBoundingBox(s[l],s[l+1],e);continue}let r=s[4],a=s[5];for(let l=6,c=s.length;l<c;l+=6){const[h,d,f,p,g,y]=s.subarray(l,l+6);Ce.bezierBoundingBox(r,a,h,d,f,p,g,y,e),r=g,a=y}}const[t,n]=this.#l();e[0]=ki(e[0]-t,0,1),e[1]=ki(e[1]-n,0,1),e[2]=ki(e[2]+t,0,1),e[3]=ki(e[3]+n,0,1),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#e}updateProperty(e,t){return e==="stroke-width"?this.#f(t):null}#f(e){const[t,n]=this.#l();this.#c=e;const[s,r]=this.#l(),[a,l]=[s-t,r-n],c=this.#e;return c[0]-=a,c[1]-=l,c[2]+=2*a,c[3]+=2*l,c}updateParentDimensions([e,t],n){const[s,r]=this.#l();this.#r=e,this.#s=t,this.#a=n;const[a,l]=this.#l(),c=a-s,h=l-r,d=this.#e;return d[0]-=c,d[1]-=h,d[2]+=2*c,d[3]+=2*h,d}updateRotation(e){return this.#t=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#e.map(Se.svgRound).join(" ")}get defaultProperties(){const[e,t]=this.#e;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Se.svgRound(e)} ${Se.svgRound(t)}`}}}get rotationTransform(){const[,,e,t]=this.#e;let n=0,s=0,r=0,a=0,l=0,c=0;switch(this.#t){case 90:s=t/e,r=-e/t,l=e;break;case 180:n=-1,a=-1,l=e,c=t;break;case 270:s=-t/e,r=e/t,c=t;break;default:return""}return`matrix(${n} ${s} ${r} ${a} ${Se.svgRound(l)} ${Se.svgRound(c)})`}getPathResizingSVGProperties([e,t,n,s]){const[r,a]=this.#l(),[l,c,h,d]=this.#e;if(Math.abs(h-r)<=Se.PRECISION||Math.abs(d-a)<=Se.PRECISION){const x=e+n/2-(l+h/2),b=t+s/2-(c+d/2);return{path:{"transform-origin":`${Se.svgRound(e)} ${Se.svgRound(t)}`,transform:`${this.rotationTransform} translate(${x} ${b})`}}}const f=(n-2*r)/(h-2*r),p=(s-2*a)/(d-2*a),g=h/n,y=d/s;return{path:{"transform-origin":`${Se.svgRound(l)} ${Se.svgRound(c)}`,transform:`${this.rotationTransform} scale(${g} ${y}) translate(${Se.svgRound(r)} ${Se.svgRound(a)}) scale(${f} ${p}) translate(${Se.svgRound(-r)} ${Se.svgRound(-a)})`}}}getPathResizedSVGProperties([e,t,n,s]){const[r,a]=this.#l(),l=this.#e,[c,h,d,f]=l;if(l[0]=e,l[1]=t,l[2]=n,l[3]=s,Math.abs(d-r)<=Se.PRECISION||Math.abs(f-a)<=Se.PRECISION){const b=e+n/2-(c+d/2),w=t+s/2-(h+f/2);for(const{line:S,points:C}of this.#i)Se._translate(S,b,w,S),Se._translate(C,b,w,C);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Se.svgRound(e)} ${Se.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(n-2*r)/(d-2*r),g=(s-2*a)/(f-2*a),y=-p*(c+r)+e+r,x=-g*(h+a)+t+a;if(p!==1||g!==1||y!==0||x!==0)for(const{line:b,points:w}of this.#i)Se._rescale(b,y,x,p,g,b),Se._rescale(w,y,x,p,g,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Se.svgRound(e)} ${Se.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,t],n){const[s,r]=n,a=this.#e,l=e-a[0],c=t-a[1];if(this.#r===s&&this.#s===r)for(const{line:h,points:d}of this.#i)Se._translate(h,l,c,h),Se._translate(d,l,c,d);else{const h=this.#r/s,d=this.#s/r;this.#r=s,this.#s=r;for(const{line:f,points:p}of this.#i)Se._rescale(f,l,c,h,d,f),Se._rescale(p,l,c,h,d,p);a[2]*=h,a[3]*=d}return a[0]=e,a[1]=t,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${Se.svgRound(e)} ${Se.svgRound(t)}`}}}get defaultSVGProperties(){const e=this.#e;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${Se.svgRound(e[0])} ${Se.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}class Sf extends rS{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:Fe._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??=this["stroke-width"],t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new Sf(this._viewParameters);return e.updateAll(this),e}}class n2 extends ze{static _type="ink";static _editorType=qe.INK;static _defaultDrawingOptions=null;constructor(e){super({...e,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,t){Fe.initialize(e,t),this._defaultDrawingOptions=new Sf(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return Je(this,"typesMap",new Map([[ot.INK_THICKNESS,"stroke-width"],[ot.INK_COLOR,"stroke"],[ot.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,t,n,s,r){return new sG(e,t,n,s,r,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,t,n,s,r,a){return mu.deserialize(e,t,n,s,r,a)}static async deserialize(e,t,n){let s=null;if(e instanceof t2){const{data:{inkLists:a,rect:l,rotation:c,id:h,color:d,opacity:f,borderStyle:{rawWidth:p},popupRef:g,richText:y,contentsObj:x,creationDate:b,modificationDate:w},parent:{page:{pageNumber:S}}}=e;s=e={annotationType:qe.INK,color:Array.from(d),thickness:p,opacity:f,paths:{points:a},boxes:null,pageIndex:S-1,rect:l.slice(0),rotation:c,annotationElementId:h,id:h,deleted:!1,popupRef:g,richText:y,comment:x?.str||null,creationDate:b,modificationDate:w}}const r=await super.deserialize(e,t,n);return r._initialData=s,e.comment&&r.setCommentData(e),r}get toolbarButtons(){return this._colorPicker||=new Gc(this),[["colorPicker",this._colorPicker]]}get colorType(){return ot.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:t,parent:n}=this;t.updateSVGProperty("stroke-width"),n.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:t,opacity:n}){this._drawingOptions=n2.getDefaultDrawingOptions({stroke:Ce.makeHexColor(...e),"stroke-width":t,"stroke-opacity":n})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:t,points:n}=this.serializeDraw(e),{_drawingOptions:{stroke:s,"stroke-opacity":r,"stroke-width":a}}=this,l=Object.assign(super.serialize(e),{color:Fe._colorManager.convert(s),opacity:r,thickness:a,paths:{lines:t,points:n}});return this.addComment(l),e?(l.isCopy=!0,l):this.annotationElementId&&!this.#e(l)?null:(l.id=this.annotationElementId,l)}#e(e){const{color:t,thickness:n,opacity:s,pageIndex:r}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||e.color.some((a,l)=>a!==t[l])||e.thickness!==n||e.opacity!==s||e.pageIndex!==r}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;const{points:t,rect:n}=this.serializeDraw(!1);return e.updateEdited({rect:n,thickness:this._drawingOptions["stroke-width"],points:t,popup:this.comment}),null}}class Tg extends mu{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const ed=8,sc=3;class ca{static#e={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#t(e,t,n,s){return n-=e,s-=t,n===0?s>0?0:4:n===1?s+6:2-s}static#n=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#i(e,t,n,s,r,a,l){const c=this.#t(n,s,r,a);for(let h=0;h<8;h++){const d=(-h+c-l+16)%8,f=this.#n[2*d],p=this.#n[2*d+1];if(e[(n+f)*t+(s+p)]!==0)return d}return-1}static#r(e,t,n,s,r,a,l){const c=this.#t(n,s,r,a);for(let h=0;h<8;h++){const d=(h+c+l+16)%8,f=this.#n[2*d],p=this.#n[2*d+1];if(e[(n+f)*t+(s+p)]!==0)return d}return-1}static#s(e,t,n,s){const r=e.length,a=new Int32Array(r);for(let d=0;d<r;d++)a[d]=e[d]<=s?1:0;for(let d=1;d<n-1;d++)a[d*t]=a[d*t+t-1]=0;for(let d=0;d<t;d++)a[d]=a[t*n-1-d]=0;let l=1,c;const h=[];for(let d=1;d<n-1;d++){c=1;for(let f=1;f<t-1;f++){const p=d*t+f,g=a[p];if(g===0)continue;let y=d,x=f;if(g===1&&a[p-1]===0)l+=1,x-=1;else if(g>=1&&a[p+1]===0)l+=1,x+=1,g>1&&(c=g);else{g!==1&&(c=Math.abs(g));continue}const b=[f,d],w=x===f+1,S={isHole:w,points:b,id:l,parent:0};h.push(S);let C;for(const B of h)if(B.id===c){C=B;break}C?C.isHole?S.parent=w?C.parent:c:S.parent=w?c:C.parent:S.parent=w?c:0;const E=this.#i(a,t,d,f,y,x,0);if(E===-1){a[p]=-l,a[p]!==1&&(c=Math.abs(a[p]));continue}let D=this.#n[2*E],M=this.#n[2*E+1];const N=d+D,I=f+M;y=N,x=I;let _=d,F=f;for(;;){const B=this.#r(a,t,_,F,y,x,1);D=this.#n[2*B],M=this.#n[2*B+1];const P=_+D,O=F+M;b.push(O,P);const k=_*t+F;if(a[k+1]===0?a[k]=-l:a[k]===1&&(a[k]=l),P===d&&O===f&&_===N&&F===I){a[p]!==1&&(c=Math.abs(a[p]));break}else y=_,x=F,_=P,F=O}}}return h}static#a(e,t,n,s){if(n-t<=4){for(let N=t;N<n-2;N+=2)s.push(e[N],e[N+1]);return}const r=e[t],a=e[t+1],l=e[n-4]-r,c=e[n-3]-a,h=Math.hypot(l,c),d=l/h,f=c/h,p=d*a-f*r,g=c/l,y=1/h,x=Math.atan(g),b=Math.cos(x),w=Math.sin(x),S=y*(Math.abs(b)+Math.abs(w)),C=y*(1-S+S**2),E=Math.max(Math.atan(Math.abs(w+b)*C),Math.atan(Math.abs(w-b)*C));let D=0,M=t;for(let N=t+2;N<n-2;N+=2){const I=Math.abs(p-d*e[N+1]+f*e[N]);I>D&&(M=N,D=I)}D>(h*E)**2?(this.#a(e,t,M+2,s),this.#a(e,M,n,s)):s.push(r,a)}static#o(e){const t=[],n=e.length;return this.#a(e,0,n,t),t.push(e[n-2],e[n-1]),t.length<=4?null:t}static#c(e,t,n,s,r,a){const l=new Float32Array(a**2),c=-2*s**2,h=a>>1;for(let x=0;x<a;x++){const b=(x-h)**2;for(let w=0;w<a;w++)l[x*a+w]=Math.exp((b+(w-h)**2)/c)}const d=new Float32Array(256),f=-2*r**2;for(let x=0;x<256;x++)d[x]=Math.exp(x**2/f);const p=e.length,g=new Uint8Array(p),y=new Uint32Array(256);for(let x=0;x<n;x++)for(let b=0;b<t;b++){const w=x*t+b,S=e[w];let C=0,E=0;for(let M=0;M<a;M++){const N=x+M-h;if(!(N<0||N>=n))for(let I=0;I<a;I++){const _=b+I-h;if(_<0||_>=t)continue;const F=e[N*t+_],B=l[M*a+I]*d[Math.abs(F-S)];C+=F*B,E+=B}}const D=g[w]=Math.round(C/E);y[D]++}return[g,y]}static#l(e){const t=new Uint32Array(256);for(const n of e)t[n]++;return t}static#d(e){const t=e.length,n=new Uint8ClampedArray(t>>2);let s=-1/0,r=1/0;for(let l=0,c=n.length;l<c;l++){const h=n[l]=e[l<<2];s=Math.max(s,h),r=Math.min(r,h)}const a=255/(s-r);for(let l=0,c=n.length;l<c;l++)n[l]=(n[l]-r)*a;return n}static#h(e){let t,n=-1/0,s=-1/0;const r=e.findIndex(c=>c!==0);let a=r,l=r;for(t=r;t<256;t++){const c=e[t];c>n&&(t-a>s&&(s=t-a,l=t-1),n=c,a=t)}for(t=l-1;t>=0&&!(e[t]>e[t+1]);t--);return t}static#f(e){const t=e,{width:n,height:s}=e,{maxDim:r}=this.#e;let a=n,l=s;if(n>r||s>r){let p=n,g=s,y=Math.log2(Math.max(n,s)/r);const x=Math.floor(y);y=y===x?x-1:x;for(let w=0;w<y;w++){a=Math.ceil(p/2),l=Math.ceil(g/2);const S=new OffscreenCanvas(a,l);S.getContext("2d").drawImage(e,0,0,p,g,0,0,a,l),p=a,g=l,e!==t&&e.close(),e=S.transferToImageBitmap()}const b=Math.min(r/a,r/l);a=Math.round(a*b),l=Math.round(l*b)}const h=new OffscreenCanvas(a,l).getContext("2d",{willReadFrequently:!0});h.fillStyle="white",h.fillRect(0,0,a,l),h.filter="grayscale(1)",h.drawImage(e,0,0,e.width,e.height,0,0,a,l);const d=h.getImageData(0,0,a,l).data;return[this.#d(d),a,l]}static extractContoursFromText(e,{fontFamily:t,fontStyle:n,fontWeight:s},r,a,l,c){let h=new OffscreenCanvas(1,1),d=h.getContext("2d",{alpha:!1});const f=200,p=d.font=`${n} ${s} ${f}px ${t}`,{actualBoundingBoxLeft:g,actualBoundingBoxRight:y,actualBoundingBoxAscent:x,actualBoundingBoxDescent:b,fontBoundingBoxAscent:w,fontBoundingBoxDescent:S,width:C}=d.measureText(e),E=1.5,D=Math.ceil(Math.max(Math.abs(g)+Math.abs(y)||0,C)*E),M=Math.ceil(Math.max(Math.abs(x)+Math.abs(b)||f,Math.abs(w)+Math.abs(S)||f)*E);h=new OffscreenCanvas(D,M),d=h.getContext("2d",{alpha:!0,willReadFrequently:!0}),d.font=p,d.filter="grayscale(1)",d.fillStyle="white",d.fillRect(0,0,D,M),d.fillStyle="black",d.fillText(e,D*(E-1)/2,M*(3-E)/2);const N=this.#d(d.getImageData(0,0,D,M).data),I=this.#l(N),_=this.#h(I),F=this.#s(N,D,M,_);return this.processDrawnLines({lines:{curves:F,width:D,height:M},pageWidth:r,pageHeight:a,rotation:l,innerMargin:c,mustSmooth:!0,areContours:!0})}static process(e,t,n,s,r){const[a,l,c]=this.#f(e),[h,d]=this.#c(a,l,c,Math.hypot(l,c)*this.#e.sigmaSFactor,this.#e.sigmaR,this.#e.kernelSize),f=this.#h(d),p=this.#s(h,l,c,f);return this.processDrawnLines({lines:{curves:p,width:l,height:c},pageWidth:t,pageHeight:n,rotation:s,innerMargin:r,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:n,rotation:s,innerMargin:r,mustSmooth:a,areContours:l}){s%180!==0&&([t,n]=[n,t]);const{curves:c,width:h,height:d}=e,f=e.thickness??0,p=[],g=Math.min(t/h,n/d),y=g/t,x=g/n,b=[];for(const{points:S}of c){const C=a?this.#o(S):S;if(!C)continue;b.push(C);const E=C.length,D=new Float32Array(E),M=new Float32Array(3*(E===2?2:E-2));if(p.push({line:M,points:D}),E===2){D[0]=C[0]*y,D[1]=C[1]*x,M.set([NaN,NaN,NaN,NaN,D[0],D[1]],0);continue}let[N,I,_,F]=C;N*=y,I*=x,_*=y,F*=x,D.set([N,I,_,F],0),M.set([NaN,NaN,NaN,NaN,N,I],0);for(let B=4;B<E;B+=2){const P=D[B]=C[B]*y,O=D[B+1]=C[B+1]*x;M.set(Se.createBezierPoints(N,I,_,F,P,O),(B-2)*3),[N,I,_,F]=[_,F,P,O]}}if(p.length===0)return null;const w=l?new Tg:new mu;return w.build(p,t,n,1,s,l?0:f,r),{outline:w,newCurves:b,areContours:l,thickness:f,width:h,height:d}}static async compressSignature({outlines:e,areContours:t,thickness:n,width:s,height:r}){let a=1/0,l=-1/0,c=0;for(const C of e){c+=C.length;for(let E=2,D=C.length;E<D;E++){const M=C[E]-C[E-2];a=Math.min(a,M),l=Math.max(l,M)}}let h;a>=-128&&l<=127?h=Int8Array:a>=-32768&&l<=32767?h=Int16Array:h=Int32Array;const d=e.length,f=ed+sc*d,p=new Uint32Array(f);let g=0;p[g++]=f*Uint32Array.BYTES_PER_ELEMENT+(c-2*d)*h.BYTES_PER_ELEMENT,p[g++]=0,p[g++]=s,p[g++]=r,p[g++]=t?0:1,p[g++]=Math.max(0,Math.floor(n??0)),p[g++]=d,p[g++]=h.BYTES_PER_ELEMENT;for(const C of e)p[g++]=C.length-2,p[g++]=C[0],p[g++]=C[1];const y=new CompressionStream("deflate-raw"),x=y.writable.getWriter();await x.ready,x.write(p);const b=h.prototype.constructor;for(const C of e){const E=new b(C.length-2);for(let D=2,M=C.length;D<M;D++)E[D-2]=C[D]-C[D-2];x.write(E)}x.close();const w=await new Response(y.readable).arrayBuffer(),S=new Uint8Array(w);return T4(S)}static async decompressSignature(e){try{const t=R9(e),{readable:n,writable:s}=new DecompressionStream("deflate-raw"),r=s.getWriter();await r.ready,r.write(t).then(async()=>{await r.ready,await r.close()}).catch(()=>{});let a=null,l=0;for await(const C of n)a||=new Uint8Array(new Uint32Array(C.buffer,0,4)[0]),a.set(C,l),l+=C.length;const c=new Uint32Array(a.buffer,0,a.length>>2),h=c[1];if(h!==0)throw new Error(`Invalid version: ${h}`);const d=c[2],f=c[3],p=c[4]===0,g=c[5],y=c[6],x=c[7],b=[],w=(ed+sc*y)*Uint32Array.BYTES_PER_ELEMENT;let S;switch(x){case Int8Array.BYTES_PER_ELEMENT:S=new Int8Array(a.buffer,w);break;case Int16Array.BYTES_PER_ELEMENT:S=new Int16Array(a.buffer,w);break;case Int32Array.BYTES_PER_ELEMENT:S=new Int32Array(a.buffer,w);break}l=0;for(let C=0;C<y;C++){const E=c[sc*C+ed],D=new Float32Array(E+2);b.push(D);for(let M=0;M<sc-1;M++)D[M]=c[sc*C+ed+M+1];for(let M=0;M<E;M++)D[M+2]=D[M]+S[l++]}return{areContours:p,thickness:g,outlines:b,width:d,height:f}}catch(t){return Xe(`decompressSignature: ${t}`),null}}}class s2 extends rS{constructor(){super(),super.updateProperties({fill:Fe._defaultLineColor,"stroke-width":0})}clone(){const e=new s2;return e.updateAll(this),e}}class r2 extends Sf{constructor(e){super(e),super.updateProperties({stroke:Fe._defaultLineColor,"stroke-width":1})}clone(){const e=new r2(this._viewParameters);return e.updateAll(this),e}}class hs extends ze{#e=!1;#t=null;#n=null;#i=null;static _type="signature";static _editorType=qe.SIGNATURE;static _defaultDrawingOptions=null;constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#n=e.signatureData||null,this.#t=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,t){Fe.initialize(e,t),this._defaultDrawingOptions=new s2,this._defaultDrawnSignatureOptions=new r2(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!1}static get typesMap(){return Je(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#t}}static computeTelemetryFinalData(e){const t=e.get("hasDescription");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let e,t;const{_isCopy:n}=this;if(n&&(this._isCopy=!1,e=this.x,t=this.y),super.render(),this._drawId===null)if(this.#n){const{lines:s,mustSmooth:r,areContours:a,description:l,uuid:c,heightInPage:h}=this.#n,{rawDims:{pageWidth:d,pageHeight:f},rotation:p}=this.parent.viewport,g=ca.processDrawnLines({lines:s,pageWidth:d,pageHeight:f,rotation:p,innerMargin:hs._INNER_MARGIN,mustSmooth:r,areContours:a});this.addSignature(g,h,l,c)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#t||""}));return n&&(this._isCopy=!0,this._moveAfterPaste(e,t)),this.div}setUuid(e){this.#i=e,this.addEditToolbar()}getUuid(){return this.#i}get description(){return this.#t}set description(e){this.#t=e,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:e})),super.addEditToolbar().then(t=>{t?.updateEditSignatureButton(e)}))}getSignaturePreview(){const{newCurves:e,areContours:t,thickness:n,width:s,height:r}=this.#n,a=Math.max(s,r),l=ca.processDrawnLines({lines:{curves:e.map(c=>({points:c})),thickness:n,width:s,height:r},pageWidth:a,pageHeight:a,rotation:0,innerMargin:0,mustSmooth:!1,areContours:t});return{areContours:t,outline:l.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(e,t,n,s){const{x:r,y:a}=this,{outline:l}=this.#n=e;this.#e=l instanceof Tg,this.description=n;let c;this.#e?c=hs.getDefaultDrawingOptions():(c=hs._defaultDrawnSignatureOptions.clone(),c.updateProperties({"stroke-width":l.thickness})),this._addOutlines({drawOutlines:l,drawingOptions:c});const[,h]=this.pageDimensions;let d=t/h;d=d>=1?.5:d,this.width*=d/this.height,this.width>=1&&(d*=.9/this.width,this.width=.9),this.height=d,this.setDims(),this.x=r,this.y=a,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(s),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!s,hasDescription:!!n}}),this.div.hidden=!1}getFromImage(e){const{rawDims:{pageWidth:t,pageHeight:n},rotation:s}=this.parent.viewport;return ca.process(e,t,n,s,hs._INNER_MARGIN)}getFromText(e,t){const{rawDims:{pageWidth:n,pageHeight:s},rotation:r}=this.parent.viewport;return ca.extractContoursFromText(e,t,n,s,r,hs._INNER_MARGIN)}getDrawnSignature(e){const{rawDims:{pageWidth:t,pageHeight:n},rotation:s}=this.parent.viewport;return ca.processDrawnLines({lines:e,pageWidth:t,pageHeight:n,rotation:s,innerMargin:hs._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:e,thickness:t}){e?this._drawingOptions=hs.getDefaultDrawingOptions():(this._drawingOptions=hs._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":t}))}serialize(e=!1){if(this.isEmpty())return null;const{lines:t,points:n}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":s}}=this,r=Object.assign(super.serialize(e),{isSignature:!0,areContours:this.#e,color:[0,0,0],thickness:this.#e?0:s});return this.addComment(r),e?(r.paths={lines:t,points:n},r.uuid=this.#i,r.isCopy=!0):r.lines=t,this.#t&&(r.accessibilityData={type:"Figure",alt:this.#t}),r}static deserializeDraw(e,t,n,s,r,a){return a.areContours?Tg.deserialize(e,t,n,s,r,a):mu.deserialize(e,t,n,s,r,a)}static async deserialize(e,t,n){const s=await super.deserialize(e,t,n);return s.#e=e.areContours,s.description=e.accessibilityData?.alt||"",s.#i=e.uuid,s}}class rG extends Fe{#e=null;#t=null;#n=null;#i=null;#r=null;#s="";#a=null;#o=!1;#c=null;#l=!1;#d=!1;static _type="stamp";static _editorType=qe.STAMP;constructor(e){super({...e,name:"stampEditor"}),this.#i=e.bitmapUrl,this.#r=e.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,t){Fe.initialize(e,t)}static isHandlingMimeForPasting(e){return zd.includes(e)}static paste(e,t){t.pasteEditor({mode:qe.STAMP},{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){const t=e.get("hasAltText");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#h(e,t=!1){if(!e){this.remove();return}this.#e=e.bitmap,t||(this.#t=e.id,this.#l=e.isSvg),e.file&&(this.#s=e.file.name),this.#m()}#f(){if(this.#n=null,this._uiManager.enableWaiting(!1),!!this.#a){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(e=null,t=!0){if(this.hasAltTextData())return null;const{mlManager:n}=this._uiManager;if(!n)throw new Error("No ML.");if(!await n.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:s,width:r,height:a}=e||this.copyCanvas(null,null,!0).imageData,l=await n.guess({name:"altText",request:{data:s,width:r,height:a,channels:s.length/(r*a)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const c=l.output;return await this.setGuessedAltText(c),t&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c}#g(){if(this.#t){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#t).then(n=>this.#h(n,!0)).finally(()=>this.#f());return}if(this.#i){const n=this.#i;this.#i=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromUrl(n).then(s=>this.#h(s)).finally(()=>this.#f());return}if(this.#r){const n=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromFile(n).then(s=>this.#h(s)).finally(()=>this.#f());return}const e=document.createElement("input");e.type="file",e.accept=zd.join(",");const t=this._uiManager._signal;this.#n=new Promise(n=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#h(s)}n()},{signal:t}),e.addEventListener("cancel",()=>{this.remove(),n()},{signal:t})}).finally(()=>this.#f()),e.click()}remove(){this.#t&&(this.#e=null,this._uiManager.imageManager.deleteId(this.#t),this.#a?.remove(),this.#a=null,this.#c&&(clearTimeout(this.#c),this.#c=null)),super.remove()}rebuild(){if(!this.parent){this.#t&&this.#g();return}super.rebuild(),this.div!==null&&(this.#t&&this.#a===null&&this.#g(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(this.#n||this.#e||this.#i||this.#r||this.#t||this.#o)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;return this._isCopy&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#o||(this.#e?this.#m():this.#g()),this._isCopy&&this._moveAfterPaste(e,t),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,t){const{id:n,bitmap:s}=this._uiManager.imageManager.getFromCanvas(e,t);t.remove(),n&&this._uiManager.imageManager.isValidId(n)&&(this.#t=n,s&&(this.#e=s),this.#o=!1,this.#m())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#c!==null&&clearTimeout(this.#c);const e=200;this.#c=setTimeout(()=>{this.#c=null,this.#p()},e)}#m(){const{div:e}=this;let{width:t,height:n}=this.#e;const[s,r]=this.pageDimensions,a=.75;if(this.width)t=this.width*s,n=this.height*r;else if(t>a*s||n>a*r){const c=Math.min(a*s/t,a*r/n);t*=c,n*=c}this._uiManager.enableWaiting(!1);const l=this.#a=document.createElement("canvas");l.setAttribute("role","img"),this.addContainer(l),this.width=t/s,this.height=n/r,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),this.#p(),this.#d||(this.parent.addUndoableEditor(this),this.#d=!0),this._reportTelemetry({action:"inserted_image"}),this.#s&&this.div.setAttribute("aria-description",this.#s),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(e,t,n=!1){e||(e=224);const{width:s,height:r}=this.#e,a=new ts;let l=this.#e,c=s,h=r,d=null;if(t){if(s>t||r>t){const M=Math.min(t/s,t/r);c=Math.floor(s*M),h=Math.floor(r*M)}d=document.createElement("canvas");const p=d.width=Math.ceil(c*a.sx),g=d.height=Math.ceil(h*a.sy);this.#l||(l=this.#u(p,g));const y=d.getContext("2d");y.filter=this._uiManager.hcmFilter;let x="white",b="#cfcfd8";this._uiManager.hcmFilter!=="none"?b="black":_9.isDarkMode&&(x="#8f8f9d",b="#42414d");const w=15,S=w*a.sx,C=w*a.sy,E=new OffscreenCanvas(S*2,C*2),D=E.getContext("2d");D.fillStyle=x,D.fillRect(0,0,S*2,C*2),D.fillStyle=b,D.fillRect(0,0,S,C),D.fillRect(S,C,S,C),y.fillStyle=y.createPattern(E,"repeat"),y.fillRect(0,0,p,g),y.drawImage(l,0,0,l.width,l.height,0,0,p,g)}let f=null;if(n){let p,g;if(a.symmetric&&l.width<e&&l.height<e)p=l.width,g=l.height;else if(l=this.#e,s>e||r>e){const b=Math.min(e/s,e/r);p=Math.floor(s*b),g=Math.floor(r*b),this.#l||(l=this.#u(p,g))}const x=new OffscreenCanvas(p,g).getContext("2d",{willReadFrequently:!0});x.drawImage(l,0,0,l.width,l.height,0,0,p,g),f={width:p,height:g,data:x.getImageData(0,0,p,g).data}}return{canvas:d,width:c,height:h,imageData:f}}#u(e,t){const{width:n,height:s}=this.#e;let r=n,a=s,l=this.#e;for(;r>2*e||a>2*t;){const c=r,h=a;r>2*e&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2)),a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));const d=new OffscreenCanvas(r,a);d.getContext("2d").drawImage(l,0,0,c,h,0,0,r,a),l=d.transferToImageBitmap()}return l}#p(){const[e,t]=this.parentDimensions,{width:n,height:s}=this,r=new ts,a=Math.ceil(n*e*r.sx),l=Math.ceil(s*t*r.sy),c=this.#a;if(!c||c.width===a&&c.height===l)return;c.width=a,c.height=l;const h=this.#l?this.#e:this.#u(a,l),d=c.getContext("2d");d.filter=this._uiManager.hcmFilter,d.drawImage(h,0,0,h.width,h.height,0,0,a,l)}#A(e){if(e){if(this.#l){const s=this._uiManager.imageManager.getSvgUrl(this.#t);if(s)return s}const t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#e,t.getContext("2d").drawImage(this.#e,0,0),t.toDataURL()}if(this.#l){const[t,n]=this.pageDimensions,s=Math.round(this.width*t*Ca.PDF_TO_CSS_UNITS),r=Math.round(this.height*n*Ca.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(s,r);return a.getContext("2d").drawImage(this.#e,0,0,this.#e.width,this.#e.height,0,0,s,r),a.transferToImageBitmap()}return structuredClone(this.#e)}static async deserialize(e,t,n){let s=null,r=!1;if(e instanceof iS){const{data:{rect:x,rotation:b,id:w,structParent:S,popupRef:C,richText:E,contentsObj:D,creationDate:M,modificationDate:N},container:I,parent:{page:{pageNumber:_}},canvas:F}=e;let B,P;F?(delete e.canvas,{id:B,bitmap:P}=n.imageManager.getFromCanvas(I.id,F),F.remove()):(r=!0,e._hasNoCanvas=!0);const O=(await t._structTree.getAriaAttributes(`${j1}${w}`))?.get("aria-label")||"";s=e={annotationType:qe.STAMP,bitmapId:B,bitmap:P,pageIndex:_-1,rect:x.slice(0),rotation:b,annotationElementId:w,id:w,deleted:!1,accessibilityData:{decorative:!1,altText:O},isSvg:!1,structParent:S,popupRef:C,richText:E,comment:D?.str||null,creationDate:M,modificationDate:N}}const a=await super.deserialize(e,t,n),{rect:l,bitmap:c,bitmapUrl:h,bitmapId:d,isSvg:f,accessibilityData:p}=e;r?(n.addMissingCanvas(e.id,a),a.#o=!0):d&&n.imageManager.isValidId(d)?(a.#t=d,c&&(a.#e=c)):a.#i=h,a.#l=f;const[g,y]=a.pageDimensions;return a.width=(l[2]-l[0])/g,a.height=(l[3]-l[1])/y,p&&(a.altTextData=p),a._initialData=s,e.comment&&a.setCommentData(e),a.#d=!!s,a}serialize(e=!1,t=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n=Object.assign(super.serialize(e),{bitmapId:this.#t,isSvg:this.#l});if(this.addComment(n),e)return n.bitmapUrl=this.#A(!0),n.accessibilityData=this.serializeAltText(!0),n.isCopy=!0,n;const{decorative:s,altText:r}=this.serializeAltText(!1);if(!s&&r&&(n.accessibilityData={type:"Figure",alt:r}),this.annotationElementId){const l=this.#y(n);return l.isSame?null:(l.isSameAltText?delete n.accessibilityData:n.accessibilityData.structParent=this._initialData.structParent??-1,n.id=this.annotationElementId,delete n.bitmapId,n)}if(t===null)return n;t.stamps||=new Map;const a=this.#l?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(!t.stamps.has(this.#t))t.stamps.set(this.#t,{area:a,serialized:n}),n.bitmap=this.#A(!1);else if(this.#l){const l=t.stamps.get(this.#t);a>l.area&&(l.area=a,l.serialized.bitmap.close(),l.serialized.bitmap=this.#A(!1))}return n}#y(e){const{pageIndex:t,accessibilityData:{altText:n}}=this._initialData,s=e.pageIndex===t,r=(e.accessibilityData?.alt||"")===n;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&s&&r,isSameAltText:r}}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class fs{#e;#t=!1;#n=null;#i=null;#r=null;#s=new Map;#a=!1;#o=!1;#c=!1;#l=null;#d=null;#h=null;#f=null;#g=null;#m=-1;#u;static _initialized=!1;static#p=new Map([mi,n2,rG,ei,hs].map(e=>[e._editorType,e]));constructor({uiManager:e,pageIndex:t,div:n,structTreeLayer:s,accessibilityManager:r,annotationLayer:a,drawLayer:l,textLayer:c,viewport:h,l10n:d}){const f=[...fs.#p.values()];if(!fs._initialized){fs._initialized=!0;for(const p of f)p.initialize(d,e)}e.registerEditorTypes(f),this.#u=e,this.pageIndex=t,this.div=n,this.#e=r,this.#n=a,this.viewport=h,this.#h=c,this.drawLayer=l,this._structTree=s,this.#u.addLayer(this)}get isEmpty(){return this.#s.size===0}get isInvisible(){return this.isEmpty&&this.#u.getMode()===qe.NONE}updateToolbar(e){this.#u.updateToolbar(e)}updateMode(e=this.#u.getMode()){switch(this.#x(),e){case qe.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case qe.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case qe.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===qe.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const n of fs.#p.values())t.toggle(`${n._type}Editing`,e===n._editorType)}this.div.hidden=!1}hasTextLayer(e){return e===this.#h?.div}setEditingState(e){this.#u.setEditingState(e)}addCommands(e){this.#u.addCommands(e)}cleanUndoStack(e){this.#u.cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){this.#n?.div.classList.toggle("disabled",!e)}get#A(){return this.#s.size!==0?this.#s.values():this.#u.getEditors(this.pageIndex)}async enable(){this.#c=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#g?.abort(),this.#g=null;const e=new Set;for(const n of this.#A)n.enableEditing(),n.show(!0),n.annotationElementId&&(this.#u.removeChangedExistingAnnotation(n),e.add(n.annotationElementId));const t=this.#n;if(t)for(const n of t.getEditableAnnotations()){if(n.hide(),this.#u.isDeletedAnnotationElement(n.data.id)||e.has(n.data.id))continue;const s=await this.deserialize(n);s&&(this.addOrRebuild(s),s.enableEditing())}this.#c=!1,this.#u._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#h&&!this.#g){this.#g=new AbortController;const n=this.#u.combinedSignal(this.#g);this.#h.div.addEventListener("pointerdown",s=>{const{clientX:a,clientY:l,timeStamp:c}=s,h=this.#m;if(c-h>500){this.#m=c;return}this.#m=-1;const{classList:d}=this.div;d.toggle("getElements",!0);const f=document.elementsFromPoint(a,l);if(d.toggle("getElements",!1),!this.div.contains(f[0]))return;let p;const g=new RegExp(`^${Uc}[0-9]+$`);for(const x of f)if(g.test(x.id)){p=x.id;break}if(!p)return;const y=this.#s.get(p);y?.annotationElementId===null&&(s.stopPropagation(),s.preventDefault(),y.dblclick(s))},{signal:n,capture:!0})}const e=this.#n;if(e){const n=new Map,s=new Map;for(const a of this.#A){if(a.disableEditing(),!a.annotationElementId){a.updateFakeAnnotationElement(e);continue}if(a.serialize()!==null){n.set(a.annotationElementId,a);continue}else s.set(a.annotationElementId,a);this.getEditableAnnotation(a.annotationElementId)?.show(),a.remove()}const r=e.getEditableAnnotations();for(const a of r){const{id:l}=a.data;if(this.#u.isDeletedAnnotationElement(l)){a.updateEdited({deleted:!0});continue}let c=s.get(l);if(c){c.resetAnnotationElement(a),c.show(!1),a.show();continue}c=n.get(l),c&&(this.#u.addChangedExistingAnnotation(c),c.renderAnnotationElement(a)&&c.show(!1)),a.show()}}this.#x(),this.isEmpty&&(this.div.hidden=!0);const{classList:t}=this.div;for(const n of fs.#p.values())t.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#o=!1}getEditableAnnotation(e){return this.#n?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#u.getActive()!==e&&this.#u.setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,this.#h?.div&&!this.#f){this.#f=new AbortController;const e=this.#u.combinedSignal(this.#f);this.#h.div.addEventListener("pointerdown",this.#y.bind(this),{signal:e}),this.#h.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#h?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#h.div.classList.remove("highlighting"))}#y(e){this.#u.unselectAll();const{target:t}=e;if(t===this.#h.div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&this.#h.div.contains(t)){const{isMac:n}=vi.platform;if(e.button!==0||e.ctrlKey&&n)return;this.#u.showAllEditors("highlight",!0,!0),this.#h.div.classList.add("free"),this.toggleDrawing(),ei.startHighlighting(this,this.#u.direction==="ltr",{target:this.#h.div,x:e.x,y:e.y}),this.#h.div.addEventListener("pointerup",()=>{this.#h.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#u._signal}),e.preventDefault()}}enableClick(){if(this.#i)return;this.#i=new AbortController;const e=this.#u.combinedSignal(this.#i);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){this.#i?.abort(),this.#i=null}attach(e){this.#s.set(e.id,e);const{annotationElementId:t}=e;t&&this.#u.isDeletedAnnotationElement(t)&&this.#u.removeDeletedAnnotationElement(e)}detach(e){this.#s.delete(e.id),this.#e?.removePointerInTextLayer(e.contentDiv),!this.#o&&e.annotationElementId&&this.#u.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#u.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(this.#u.addDeletedAnnotationElement(e.annotationElementId),Fe.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),this.#u.addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!this.#c),this.#u.addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!this.#r&&(e._focusEventsAllowed=!1,this.#r=setTimeout(()=>{this.#r=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this.#u._signal}),t.focus())},0)),e._structTreeParentId=this.#e?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getEditorByUID(e){for(const t of this.#s.values())if(t.uid===e)return t;return null}getNextId(){return this.#u.getId()}get#v(){return fs.#p.get(this.#u.getMode())}combinedSignal(e){return this.#u.combinedSignal(e)}#E(e){const t=this.#v;return t?new t.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#v?.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await this.#u.updateMode(e.mode);const{offsetX:n,offsetY:s}=this.#S(),r=this.getNextId(),a=this.#E({parent:this,id:r,x:n,y:s,uiManager:this.#u,isCentered:!0,...t});a&&this.add(a)}async deserialize(e){return await fs.#p.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#u)||null}createAndAddNewEditor(e,t,n={}){const s=this.getNextId(),r=this.#E({parent:this,id:s,x:e.offsetX,y:e.offsetY,uiManager:this.#u,isCentered:t,...n});return r&&this.add(r),r}get boundingClientRect(){return this.div.getBoundingClientRect()}#S(){const{x:e,y:t,width:n,height:s}=this.boundingClientRect,r=Math.max(0,e),a=Math.max(0,t),l=Math.min(window.innerWidth,e+n),c=Math.min(window.innerHeight,t+s),h=(r+l)/2-e,d=(a+c)/2-t,[f,p]=this.viewport.rotation%180===0?[h,d]:[d,h];return{offsetX:f,offsetY:p}}addNewEditor(e={}){this.createAndAddNewEditor(this.#S(),!0,e)}setSelected(e){this.#u.setSelected(e)}toggleSelected(e){this.#u.toggleSelected(e)}unselect(e){this.#u.unselect(e)}pointerup(e){const{isMac:t}=vi.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!this.#a||(this.#a=!1,this.#v?.isDrawer&&this.#v.supportMultipleDrawings))return;if(!this.#t){this.#t=!0;return}const n=this.#u.getMode();if(n===qe.STAMP||n===qe.SIGNATURE){this.#u.unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){if(this.#u.getMode()===qe.HIGHLIGHT&&this.enableTextSelection(),this.#a){this.#a=!1;return}const{isMac:t}=vi.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(this.#a=!0,this.#v?.isDrawer){this.startDrawingSession(e);return}const n=this.#u.getActive();this.#t=!n||n.isEmpty()}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),this.#l){this.#v.startDrawing(this,this.#u,!1,e);return}this.#u.setCurrentDrawingSession(this),this.#l=new AbortController;const t=this.#u.combinedSignal(this.#l);this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(this.#d=null,this.commitOrRemove())},{signal:t}),this.#v.startDrawing(this,this.#u,!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&(this.#d=t);return}this.#d&&setTimeout(()=>{this.#d?.focus(),this.#d=null},0)}endDrawingSession(e=!1){return this.#l?(this.#u.setCurrentDrawingSession(null),this.#l.abort(),this.#l=null,this.#d=null,this.#v.endDrawing(e)):null}findNewParent(e,t,n){const s=this.#u.findParent(t,n);return s===null||s===this?!1:(s.changeParent(e),!0)}commitOrRemove(){return this.#l?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#l&&this.#v.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#u.getActive()?.parent===this&&(this.#u.commitOrRemove(),this.#u.setActiveEditor(null)),this.#r&&(clearTimeout(this.#r),this.#r=null);for(const e of this.#s.values())this.#e?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#s.clear(),this.#u.removeLayer(this)}#x(){for(const e of this.#s.values())e.isEmpty()&&e.remove()}render({viewport:e}){this.viewport=e,Or(this.div,e);for(const t of this.#u.getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){this.#u.commitOrRemove(),this.#x();const t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,Or(this.div,{rotation:n}),t!==n)for(const s of this.#s.values())s.rotate(n)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return this.#u.viewParameters.realScale}}class pi{#e=null;#t=new Map;#n=new Map;static#i=0;constructor({pageIndex:e}){this.pageIndex=e}setParent(e){if(!this.#e){this.#e=e;return}if(this.#e!==e){if(this.#t.size>0)for(const t of this.#t.values())t.remove(),e.append(t);this.#e=e}}static get _svgFactory(){return Je(this,"_svgFactory",new Hc)}static#r(e,[t,n,s,r]){const{style:a}=e;a.top=`${100*n}%`,a.left=`${100*t}%`,a.width=`${100*s}%`,a.height=`${100*r}%`}#s(){const e=pi._svgFactory.create(1,1,!0);return this.#e.append(e),e.setAttribute("aria-hidden",!0),e}#a(e,t){const n=pi._svgFactory.createElement("clipPath");e.append(n);const s=`clip_${t}`;n.setAttribute("id",s),n.setAttribute("clipPathUnits","objectBoundingBox");const r=pi._svgFactory.createElement("use");return n.append(r),r.setAttribute("href",`#${t}`),r.classList.add("clip"),s}#o(e,t){for(const[n,s]of Object.entries(t))s===null?e.removeAttribute(n):e.setAttribute(n,s)}draw(e,t=!1,n=!1){const s=pi.#i++,r=this.#s(),a=pi._svgFactory.createElement("defs");r.append(a);const l=pi._svgFactory.createElement("path");a.append(l);const c=`path_p${this.pageIndex}_${s}`;l.setAttribute("id",c),l.setAttribute("vector-effect","non-scaling-stroke"),t&&this.#n.set(s,l);const h=n?this.#a(a,c):null,d=pi._svgFactory.createElement("use");return r.append(d),d.setAttribute("href",`#${c}`),this.updateProperties(r,e),this.#t.set(s,r),{id:s,clipPathId:`url(#${h})`}}drawOutline(e,t){const n=pi.#i++,s=this.#s(),r=pi._svgFactory.createElement("defs");s.append(r);const a=pi._svgFactory.createElement("path");r.append(a);const l=`path_p${this.pageIndex}_${n}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke");let c;if(t){const f=pi._svgFactory.createElement("mask");r.append(f),c=`mask_p${this.pageIndex}_${n}`,f.setAttribute("id",c),f.setAttribute("maskUnits","objectBoundingBox");const p=pi._svgFactory.createElement("rect");f.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");const g=pi._svgFactory.createElement("use");f.append(g),g.setAttribute("href",`#${l}`),g.setAttribute("stroke","none"),g.setAttribute("fill","black"),g.setAttribute("fill-rule","nonzero"),g.classList.add("mask")}const h=pi._svgFactory.createElement("use");s.append(h),h.setAttribute("href",`#${l}`),c&&h.setAttribute("mask",`url(#${c})`);const d=h.cloneNode();return s.append(d),h.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(s,e),this.#t.set(n,s),n}finalizeDraw(e,t){this.#n.delete(e),this.updateProperties(e,t)}updateProperties(e,t){if(!t)return;const{root:n,bbox:s,rootClass:r,path:a}=t,l=typeof e=="number"?this.#t.get(e):e;if(l){if(n&&this.#o(l,n),s&&pi.#r(l,s),r){const{classList:c}=l;for(const[h,d]of Object.entries(r))c.toggle(h,d)}if(a){const h=l.firstChild.firstChild;this.#o(h,a)}}}updateParent(e,t){if(t===this)return;const n=this.#t.get(e);n&&(t.#e.append(n),this.#t.delete(e),t.#t.set(e,n))}remove(e){this.#n.delete(e),this.#e!==null&&(this.#t.get(e).remove(),this.#t.delete(e))}destroy(){this.#e=null;for(const e of this.#t.values())e.remove();this.#t.clear(),this.#n.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:Cg};globalThis.pdfjsLib={AbortException:Zs,AnnotationEditorLayer:fs,AnnotationEditorParamsType:ot,AnnotationEditorType:qe,AnnotationEditorUIManager:Js,AnnotationLayer:i2,AnnotationMode:ms,AnnotationType:$t,applyOpacity:I4,build:Z4,ColorPicker:mn,createValidAbsoluteUrl:O1,CSSConstants:N4,DOMSVGFactory:Hc,DrawLayer:pi,FeatureTest:vi,fetchData:Jo,findContrastColor:_4,getDocument:Q1,getFilenameFromUrl:M4,getPdfFilenameFromUrl:D4,getRGB:$o,getUuid:V1,getXfaPageViewport:R4,GlobalWorkerOptions:Pr,ImageKind:Dc,InvalidPDFException:Vd,isDataScheme:uu,isPdfFile:bf,isValidExplicitDest:L4,MathClamp:ki,noContextMenu:yn,normalizeUnicode:E4,OPS:jo,OutputScale:ts,PasswordResponses:S4,PDFDataRangeTransport:J1,PDFDateString:jd,PDFWorker:zo,PermissionFlag:w4,PixelsPerInch:Ca,RenderingCancelledException:xf,renderRichText:G1,ResponseException:Vc,setLayerDimensions:Or,shadow:Je,SignatureExtractor:ca,stopEvent:Yt,SupportedImageMimeTypes:zd,TextLayer:zc,TouchManager:du,updateUrlHash:U1,Util:Ce,VerbosityLevel:ou,version:$1,XfaLayer:z1};const aG=Object.freeze(Object.defineProperty({__proto__:null,AbortException:Zs,AnnotationEditorLayer:fs,AnnotationEditorParamsType:ot,AnnotationEditorType:qe,AnnotationEditorUIManager:Js,AnnotationLayer:i2,AnnotationMode:ms,AnnotationType:$t,CSSConstants:N4,ColorPicker:mn,DOMSVGFactory:Hc,DrawLayer:pi,FeatureTest:vi,GlobalWorkerOptions:Pr,ImageKind:Dc,InvalidPDFException:Vd,MathClamp:ki,OPS:jo,OutputScale:ts,PDFDataRangeTransport:J1,PDFDateString:jd,PDFWorker:zo,PasswordResponses:S4,PermissionFlag:w4,PixelsPerInch:Ca,RenderingCancelledException:xf,ResponseException:Vc,SignatureExtractor:ca,SupportedImageMimeTypes:zd,TextLayer:zc,TouchManager:du,Util:Ce,VerbosityLevel:ou,XfaLayer:z1,applyOpacity:I4,build:Z4,createValidAbsoluteUrl:O1,fetchData:Jo,findContrastColor:_4,getDocument:Q1,getFilenameFromUrl:M4,getPdfFilenameFromUrl:D4,getRGB:$o,getUuid:V1,getXfaPageViewport:R4,isDataScheme:uu,isPdfFile:bf,isValidExplicitDest:L4,noContextMenu:yn,normalizeUnicode:E4,renderRichText:G1,setLayerDimensions:Or,shadow:Je,stopEvent:Yt,updateUrlHash:U1,version:$1},Symbol.toStringTag,{value:"Module"}));function aS(i){var e,t,n="";if(typeof i=="string"||typeof i=="number")n+=i;else if(typeof i=="object")if(Array.isArray(i)){var s=i.length;for(e=0;e<s;e++)i[e]&&(t=aS(i[e]))&&(n&&(n+=" "),n+=t)}else for(t in i)i[t]&&(n&&(n+=" "),n+=t);return n}function Cf(){for(var i,e,t=0,n="",s=arguments.length;t<s;t++)(i=arguments[t])&&(e=aS(i))&&(n&&(n+=" "),n+=e);return n}var Bw=Object.prototype.hasOwnProperty;function Lw(i,e,t){for(t of i.keys())if(Bo(t,e))return t}function Bo(i,e){var t,n,s;if(i===e)return!0;if(i&&e&&(t=i.constructor)===e.constructor){if(t===Date)return i.getTime()===e.getTime();if(t===RegExp)return i.toString()===e.toString();if(t===Array){if((n=i.length)===e.length)for(;n--&&Bo(i[n],e[n]););return n===-1}if(t===Set){if(i.size!==e.size)return!1;for(n of i)if(s=n,s&&typeof s=="object"&&(s=Lw(e,s),!s)||!e.has(s))return!1;return!0}if(t===Map){if(i.size!==e.size)return!1;for(n of i)if(s=n[0],s&&typeof s=="object"&&(s=Lw(e,s),!s)||!Bo(n[1],e.get(s)))return!1;return!0}if(t===ArrayBuffer)i=new Uint8Array(i),e=new Uint8Array(e);else if(t===DataView){if((n=i.byteLength)===e.byteLength)for(;n--&&i.getInt8(n)===e.getInt8(n););return n===-1}if(ArrayBuffer.isView(i)){if((n=i.byteLength)===e.byteLength)for(;n--&&i[n]===e[n];);return n===-1}if(!t||typeof i=="object"){n=0;for(t in i)if(Bw.call(i,t)&&++n&&!Bw.call(e,t)||!(t in e)||!Bo(i[t],e[t]))return!1;return Object.keys(e).length===n}}return i!==i&&e!==e}function pu(i){let e=!1;return{promise:new Promise((n,s)=>{i.then(r=>!e&&n(r)).catch(r=>!e&&s(r))}),cancel(){e=!0}}}const oG=["onCopy","onCut","onPaste"],lG=["onCompositionEnd","onCompositionStart","onCompositionUpdate"],cG=["onFocus","onBlur"],uG=["onInput","onInvalid","onReset","onSubmit"],hG=["onLoad","onError"],dG=["onKeyDown","onKeyPress","onKeyUp"],fG=["onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting"],mG=["onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp"],pG=["onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop"],gG=["onSelect"],AG=["onTouchCancel","onTouchEnd","onTouchMove","onTouchStart"],vG=["onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut"],yG=["onScroll"],xG=["onWheel"],bG=["onAnimationStart","onAnimationEnd","onAnimationIteration"],wG=["onTransitionEnd"],SG=["onToggle"],CG=["onChange"],EG=[...oG,...lG,...cG,...uG,...hG,...dG,...fG,...mG,...pG,...gG,...AG,...vG,...yG,...xG,...bG,...wG,...CG,...SG];function oS(i,e){const t={};for(const n of EG){const s=i[n];s&&(e?t[n]=(r=>s(r,e(n))):t[n]=s)}return t}var TG="Invariant failed";function Rt(i,e){if(!i)throw new Error(TG)}var O0,kw;function MG(){if(kw)return O0;kw=1;var i=function(){};return O0=i,O0}var DG=MG();const Oi=Rg(DG),lS=V.createContext(null),RG="noopener noreferrer nofollow";class NG{constructor(){this.externalLinkEnabled=!0,this.externalLinkRel=void 0,this.externalLinkTarget=void 0,this.isInPresentationMode=!1,this.pdfDocument=void 0,this.pdfViewer=void 0}setDocument(e){this.pdfDocument=e}setViewer(e){this.pdfViewer=e}setExternalLinkRel(e){this.externalLinkRel=e}setExternalLinkTarget(e){this.externalLinkTarget=e}setHash(){}setHistory(){}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return Rt(this.pdfViewer),this.pdfViewer.currentPageNumber||0}set page(e){Rt(this.pdfViewer),this.pdfViewer.currentPageNumber=e}get rotation(){return 0}set rotation(e){}addLinkAttributes(e,t,n){e.href=t,e.rel=this.externalLinkRel||RG,e.target=n?"_blank":this.externalLinkTarget||""}goToDestination(e){return new Promise(t=>{Rt(this.pdfDocument),Rt(e),typeof e=="string"?this.pdfDocument.getDestination(e).then(t):Array.isArray(e)?t(e):e.then(t)}).then(t=>{Rt(Array.isArray(t));const n=t[0];new Promise(s=>{Rt(this.pdfDocument),n instanceof Object?this.pdfDocument.getPageIndex(n).then(r=>{s(r)}).catch(()=>{Rt(!1)}):typeof n=="number"?s(n):Rt(!1)}).then(s=>{const r=s+1;Rt(this.pdfViewer),Rt(r>=1&&r<=this.pagesCount),this.pdfViewer.scrollPageIntoView({dest:t,pageIndex:s,pageNumber:r})})})}goToPage(e){const t=e-1;Rt(this.pdfViewer),Rt(e>=1&&e<=this.pagesCount),this.pdfViewer.scrollPageIntoView({pageIndex:t,pageNumber:e})}goToXY(){}cachePageRef(){}getDestinationHash(){return"#"}getAnchorUrl(){return"#"}executeNamedAction(){}executeSetOCGState(){}isPageVisible(){return!0}isPageCached(){return!0}navigateTo(e){this.goToDestination(e)}}function Lo({children:i,type:e}){return v.jsx("div",{className:`react-pdf__message react-pdf__message--${e}`,children:i})}const Ow={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};function IG(i,e){switch(e.type){case"RESOLVE":return{value:e.value,error:void 0};case"REJECT":return{value:!1,error:e.error};case"RESET":return{value:void 0,error:void 0};default:return i}}function Go(){return V.useReducer(IG,{value:void 0,error:void 0})}const Ef=typeof window<"u",cS=Ef&&window.location.protocol==="file:";function _G(i){return typeof i<"u"}function aa(i){return _G(i)&&i!==null}function FG(i){return typeof i=="string"}function PG(i){return i instanceof ArrayBuffer}function BG(i){return Rt(Ef),i instanceof Blob}function Mg(i){return FG(i)&&/^data:/.test(i)}function Uw(i){Rt(Mg(i));const[e="",t=""]=i.split(",");return e.split(";").indexOf("base64")!==-1?atob(t):unescape(t)}function LG(){return Ef&&window.devicePixelRatio||1}const uS="On Chromium based browsers, you can use --allow-file-access-from-files flag for debugging purposes.";function Vw(){Oi(!cS,`Loading PDF as base64 strings/URLs may not work on protocols other than HTTP/HTTPS. ${uS}`)}function kG(){Oi(!cS,`Loading PDF.js worker may not work on protocols other than HTTP/HTTPS. ${uS}`)}function Ta(i){i?.cancel&&i.cancel()}function Dg(i,e){return Object.defineProperty(i,"width",{get(){return this.getViewport({scale:e}).width},configurable:!0}),Object.defineProperty(i,"height",{get(){return this.getViewport({scale:e}).height},configurable:!0}),Object.defineProperty(i,"originalWidth",{get(){return this.getViewport({scale:1}).width},configurable:!0}),Object.defineProperty(i,"originalHeight",{get(){return this.getViewport({scale:1}).height},configurable:!0}),i}function hS(i){return i.name==="AbortException"||i.name==="RenderingCancelledException"}function OG(i){return new Promise((e,t)=>{const n=new FileReader;n.onload=()=>{if(!n.result)return t(new Error("Error while reading a file."));e(n.result)},n.onerror=s=>{if(!s.target)return t(new Error("Error while reading a file."));const{error:r}=s.target;if(!r)return t(new Error("Error while reading a file."));switch(r.code){case r.NOT_FOUND_ERR:return t(new Error("Error while reading a file: File not found."));case r.SECURITY_ERR:return t(new Error("Error while reading a file: Security error."));case r.ABORT_ERR:return t(new Error("Error while reading a file: Aborted."));default:return t(new Error("Error while reading a file."))}},n.readAsArrayBuffer(i)})}const{PDFDataRangeTransport:UG}=aG,VG=(i,e)=>{switch(e){case Ow.NEED_PASSWORD:{const t=prompt("Enter the password to open this PDF file.");i(t);break}case Ow.INCORRECT_PASSWORD:{const t=prompt("Invalid password. Please try again.");i(t);break}}};function jw(i){return typeof i=="object"&&i!==null&&("data"in i||"range"in i||"url"in i)}const jG=V.forwardRef(function({children:e,className:t,error:n="Failed to load PDF file.",externalLinkRel:s,externalLinkTarget:r,file:a,inputRef:l,imageResourcesPath:c,loading:h="Loading PDF",noData:d="No PDF file specified.",onItemClick:f,onLoadError:p,onLoadProgress:g,onLoadSuccess:y,onPassword:x=VG,onSourceError:b,onSourceSuccess:w,options:S,renderMode:C,rotate:E,scale:D,...M},N){const[I,_]=Go(),{value:F,error:B}=I,[P,O]=Go(),{value:k,error:q}=P,U=V.useRef(new NG),H=V.useRef([]),Y=V.useRef(void 0),Q=V.useRef(void 0);a&&a!==Y.current&&jw(a)&&(Oi(!Bo(a,Y.current),`File prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "file" prop.`),Y.current=a),S&&S!==Q.current&&(Oi(!Bo(S,Q.current),`Options prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "options" prop.`),Q.current=S);const te=V.useRef({scrollPageIntoView:We=>{const{dest:Pe,pageNumber:ht,pageIndex:Qe=ht-1}=We;if(f){f({dest:Pe,pageIndex:Qe,pageNumber:ht});return}const ft=H.current[Qe];if(ft){ft.scrollIntoView();return}Oi(!1,`An internal link leading to page ${ht} was clicked, but neither <Document> was provided with onItemClick nor it was able to find the page within itself. Either provide onItemClick to <Document> and handle navigating by yourself or ensure that all pages are rendered within <Document>.`)}});V.useImperativeHandle(N,()=>({linkService:U,pages:H,viewer:te}),[]);function j(){w&&w()}function W(){B&&(Oi(!1,B.toString()),b&&b(B))}function K(){_({type:"RESET"})}V.useEffect(K,[a,_]);const ee=V.useCallback(async()=>{if(!a)return null;if(typeof a=="string")return Mg(a)?{data:Uw(a)}:(Vw(),{url:a});if(a instanceof UG)return{range:a};if(PG(a))return{data:a};if(Ef&&BG(a))return{data:await OG(a)};if(Rt(typeof a=="object"),Rt(jw(a)),"url"in a&&typeof a.url=="string"){if(Mg(a.url)){const{url:We,...Pe}=a;return{data:Uw(We),...Pe}}Vw()}return a},[a]);V.useEffect(()=>{const We=pu(ee());return We.promise.then(Pe=>{_({type:"RESOLVE",value:Pe})}).catch(Pe=>{_({type:"REJECT",error:Pe})}),()=>{Ta(We)}},[ee,_]),V.useEffect(()=>{if(!(typeof F>"u")){if(F===!1){W();return}j()}},[F]);function le(){k&&(y&&y(k),H.current=new Array(k.numPages),U.current.setDocument(k))}function he(){q&&(Oi(!1,q.toString()),p&&p(q))}V.useEffect(function(){O({type:"RESET"})},[O,F]),V.useEffect(function(){if(!F)return;const Pe=S?{...F,...S}:F,ht=Q1(Pe);g&&(ht.onProgress=g),x&&(ht.onPassword=x);const Qe=ht;return Qe.promise.then(ft=>{Qe.destroyed||O({type:"RESOLVE",value:ft})}).catch(ft=>{Qe.destroyed||O({type:"REJECT",error:ft})}),()=>{Qe.destroy()}},[S,O,F]),V.useEffect(()=>{if(!(typeof k>"u")){if(k===!1){he();return}le()}},[k]),V.useEffect(function(){U.current.setViewer(te.current),U.current.setExternalLinkRel(s),U.current.setExternalLinkTarget(r)},[s,r]);const ce=V.useCallback((We,Pe)=>{H.current[We]=Pe},[]),xe=V.useCallback(We=>{delete H.current[We]},[]),ge=V.useMemo(()=>({imageResourcesPath:c,linkService:U.current,onItemClick:f,pdf:k,registerPage:ce,renderMode:C,rotate:E,scale:D,unregisterPage:xe}),[c,f,k,ce,C,E,D,xe]),Me=V.useMemo(()=>oS(M,()=>k),[M,k]);function Ie(){function We(ht){return!!ht?.pdf}if(!We(ge))throw new Error("pdf is undefined");const Pe=typeof e=="function"?e(ge):e;return v.jsx(lS.Provider,{value:ge,children:Pe})}function $e(){return a?k==null?v.jsx(Lo,{type:"loading",children:typeof h=="function"?h():h}):k===!1?v.jsx(Lo,{type:"error",children:typeof n=="function"?n():n}):Ie():v.jsx(Lo,{type:"no-data",children:typeof d=="function"?d():d})}return v.jsx("div",{className:Cf("react-pdf__Document",t),ref:l,...Me,children:$e()})});function dS(){return V.useContext(lS)}function fS(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];var t=i.filter(Boolean);if(t.length<=1){var n=t[0];return n||null}return function(r){for(var a=0,l=t;a<l.length;a++){var c=l[a];typeof c=="function"?c(r):c&&(c.current=r)}}}const mS=V.createContext(null);function Tf(){return V.useContext(mS)}function zG(){const i=dS(),e=Tf();Rt(e);const t={...i,...e},{filterAnnotations:n,imageResourcesPath:s,linkService:r,onGetAnnotationsError:a,onGetAnnotationsSuccess:l,onRenderAnnotationLayerError:c,onRenderAnnotationLayerSuccess:h,page:d,pdf:f,renderForms:p,rotate:g,scale:y=1}=t;Rt(f),Rt(d),Rt(r);const[x,b]=Go(),{value:w,error:S}=x,C=V.useRef(null);Oi(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-annotation-layer"),10)===1,"AnnotationLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-annotations");function E(){w&&l&&l(w)}function D(){S&&(Oi(!1,S.toString()),a&&a(S))}V.useEffect(function(){b({type:"RESET"})},[b,d]),V.useEffect(function(){if(!d)return;const F=pu(d.getAnnotations()),B=F;return F.promise.then(P=>{b({type:"RESOLVE",value:P})}).catch(P=>{b({type:"REJECT",error:P})}),()=>{Ta(B)}},[b,d]),V.useEffect(()=>{if(w!==void 0){if(w===!1){D();return}E()}},[w]);function M(){h&&h()}function N(_){Oi(!1,`${_}`),c&&c(_)}const I=V.useMemo(()=>d.getViewport({scale:y,rotation:g}),[d,g,y]);return V.useEffect(function(){if(!f||!d||!r||!w)return;const{current:F}=C;if(!F)return;const B=I.clone({dontFlip:!0}),P={accessibilityManager:null,annotationCanvasMap:null,annotationEditorUIManager:null,annotationStorage:f.annotationStorage,commentManager:null,div:F,l10n:null,linkService:r,page:d,structTreeLayer:null,viewport:B},O={annotations:n?n({annotations:w}):w,annotationStorage:f.annotationStorage,div:F,imageResourcesPath:s,linkService:r,page:d,renderForms:p,viewport:B};F.innerHTML="";try{new i2(P).render(O),M()}catch(k){N(k)}return()=>{}},[w,n,s,r,d,f,p,I]),v.jsx("div",{className:Cf("react-pdf__Page__annotations","annotationLayer"),ref:C})}const pS={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},GG=/^H(\d+)$/;function HG(i){return i in pS}function Mf(i){return"children"in i}function gS(i){return Mf(i)?i.children.length===1&&0 in i.children&&"id"in i.children[0]:!1}function YG(i){const e={};if(Mf(i)){const{role:t}=i,n=t.match(GG);if(n)e.role="heading",e["aria-level"]=Number(n[1]);else if(HG(t)){const s=pS[t];s&&(e.role=s)}}return e}function AS(i){const e={};if(Mf(i)){if(i.alt!==void 0&&(e["aria-label"]=i.alt),i.lang!==void 0&&(e.lang=i.lang),gS(i)){const[t]=i.children;if(t){const n=AS(t);return{...e,...n}}}}else"id"in i&&(e["aria-owns"]=i.id);return e}function qG(i){return i?{...YG(i),...AS(i)}:null}function vS({className:i,node:e}){const t=V.useMemo(()=>qG(e),[e]),n=V.useMemo(()=>!Mf(e)||gS(e)?null:e.children.map((s,r)=>v.jsx(vS,{node:s},r)),[e]);return v.jsx("span",{className:i,...t,children:n})}function XG(){const i=Tf();Rt(i);const{onGetStructTreeError:e,onGetStructTreeSuccess:t}=i,[n,s]=Go(),{value:r,error:a}=n,{customTextRenderer:l,page:c}=i;function h(){r&&t&&t(r)}function d(){a&&(Oi(!1,a.toString()),e&&e(a))}return V.useEffect(function(){s({type:"RESET"})},[s,c]),V.useEffect(function(){if(l||!c)return;const p=pu(c.getStructTree()),g=p;return p.promise.then(y=>{s({type:"RESOLVE",value:y})}).catch(y=>{s({type:"REJECT",error:y})}),()=>Ta(g)},[l,c,s]),V.useEffect(()=>{if(r!==void 0){if(r===!1){d();return}h()}},[r]),r?v.jsx(vS,{className:"react-pdf__Page__structTree structTree",node:r}):null}const zw=ms;function WG(i){const e=Tf();Rt(e);const t={...e,...i},{_className:n,canvasBackground:s,devicePixelRatio:r=LG(),onRenderError:a,onRenderSuccess:l,page:c,renderForms:h,renderTextLayer:d,rotate:f,scale:p}=t,{canvasRef:g}=i;Rt(c);const y=V.useRef(null);function x(){c&&l&&l(Dg(c,p))}function b(E){hS(E)||(Oi(!1,E.toString()),a&&a(E))}const w=V.useMemo(()=>c.getViewport({scale:p*r,rotation:f}),[r,c,f,p]),S=V.useMemo(()=>c.getViewport({scale:p,rotation:f}),[c,f,p]);V.useEffect(function(){if(!c)return;c.cleanup();const{current:D}=y;if(!D)return;D.width=w.width,D.height=w.height,D.style.width=`${Math.floor(S.width)}px`,D.style.height=`${Math.floor(S.height)}px`,D.style.visibility="hidden";const M={annotationMode:h?zw.ENABLE_FORMS:zw.ENABLE,canvas:D,canvasContext:D.getContext("2d",{alpha:!1}),viewport:w};s&&(M.background=s);const N=c.render(M),I=N;return N.promise.then(()=>{D.style.visibility="",x()}).catch(b),()=>Ta(I)},[s,c,h,w,S]);const C=V.useCallback(()=>{const{current:E}=y;E&&(E.width=0,E.height=0)},[]);return V.useEffect(()=>C,[C]),v.jsx("canvas",{className:`${n}__canvas`,dir:"ltr",ref:fS(g,y),style:{display:"block",userSelect:"none"},children:d?v.jsx(XG,{}):null})}function KG(i){return"str"in i}function QG(){const i=Tf();Rt(i);const{customTextRenderer:e,onGetTextError:t,onGetTextSuccess:n,onRenderTextLayerError:s,onRenderTextLayerSuccess:r,page:a,pageIndex:l,pageNumber:c,rotate:h,scale:d}=i;Rt(a);const[f,p]=Go(),{value:g,error:y}=f,x=V.useRef(null);Oi(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-text-layer"),10)===1,"TextLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-text-layer");function b(){g&&n&&n(g)}function w(){y&&(Oi(!1,y.toString()),t&&t(y))}V.useEffect(function(){p({type:"RESET"})},[a,p]),V.useEffect(function(){if(!a)return;const I=pu(a.getTextContent()),_=I;return I.promise.then(F=>{p({type:"RESOLVE",value:F})}).catch(F=>{p({type:"REJECT",error:F})}),()=>Ta(_)},[a,p]),V.useEffect(()=>{if(g!==void 0){if(g===!1){w();return}b()}},[g]);const S=V.useCallback(()=>{r&&r()},[r]),C=V.useCallback(N=>{hS(N)||(Oi(!1,N.toString()),s&&s(N))},[s]);function E(){const N=x.current;N&&N.classList.add("selecting")}function D(){const N=x.current;N&&N.classList.remove("selecting")}const M=V.useMemo(()=>a.getViewport({scale:d,rotation:h}),[a,h,d]);return V.useLayoutEffect(function(){if(!a||!g)return;const{current:I}=x;if(!I)return;I.innerHTML="";const _=a.streamTextContent({includeMarkedContent:!0}),F={container:I,textContentSource:_,viewport:M},B=new zc(F),P=B;return B.render().then(()=>{const O=document.createElement("div");O.className="endOfContent",I.append(O);const k=I.querySelectorAll('[role="presentation"]');if(e){let q=0;g.items.forEach((U,H)=>{if(!KG(U))return;const Y=k[q];if(!Y)return;const Q=e({pageIndex:l,pageNumber:c,itemIndex:H,...U});Y.innerHTML=Q,q+=U.str&&U.hasEOL?2:1})}S()}).catch(C),()=>Ta(P)},[e,C,S,a,l,c,g,M]),v.jsx("div",{className:Cf("react-pdf__Page__textContent","textLayer"),onMouseUp:D,onMouseDown:E,ref:x})}const Gw=1;function ZG(i){const t={...dS(),...i},{_className:n="react-pdf__Page",_enableRegisterUnregisterPage:s=!0,canvasBackground:r,canvasRef:a,children:l,className:c,customRenderer:h,customTextRenderer:d,devicePixelRatio:f,error:p="Failed to load the page.",filterAnnotations:g,height:y,inputRef:x,loading:b="Loading page",noData:w="No page specified.",onGetAnnotationsError:S,onGetAnnotationsSuccess:C,onGetStructTreeError:E,onGetStructTreeSuccess:D,onGetTextError:M,onGetTextSuccess:N,onLoadError:I,onLoadSuccess:_,onRenderAnnotationLayerError:F,onRenderAnnotationLayerSuccess:B,onRenderError:P,onRenderSuccess:O,onRenderTextLayerError:k,onRenderTextLayerSuccess:q,pageIndex:U,pageNumber:H,pdf:Y,registerPage:Q,renderAnnotationLayer:te=!0,renderForms:j=!1,renderMode:W="canvas",renderTextLayer:K=!0,rotate:ee,scale:le=Gw,unregisterPage:he,width:ce,...xe}=t,[ge,Me]=Go(),{value:Ie,error:$e}=ge,We=V.useRef(null);Rt(Y);const Pe=aa(H)?H-1:U??null,ht=H??(aa(U)?U+1:null),Qe=ee??(Ie?Ie.rotate:null),ft=V.useMemo(()=>{if(!Ie)return null;let ne=1;const ye=le??Gw;if(ce||y){const me=Ie.getViewport({scale:1,rotation:Qe});ce?ne=ce/me.width:y&&(ne=y/me.height)}return ye*ne},[y,Ie,Qe,le,ce]);V.useEffect(function(){return()=>{aa(Pe)&&s&&he&&he(Pe)}},[s,Y,Pe,he]);function gs(){if(_){if(!Ie||!ft)return;_(Dg(Ie,ft))}if(s&&Q){if(!aa(Pe)||!We.current)return;Q(Pe,We.current)}}function Gn(){$e&&(Oi(!1,$e.toString()),I&&I($e))}V.useEffect(function(){Me({type:"RESET"})},[Me,Y,Pe]),V.useEffect(function(){if(!Y||!ht)return;const ye=pu(Y.getPage(ht)),me=ye;return ye.promise.then(Be=>{Me({type:"RESOLVE",value:Be})}).catch(Be=>{Me({type:"REJECT",error:Be})}),()=>Ta(me)},[Me,Y,ht]),V.useEffect(()=>{if(Ie!==void 0){if(Ie===!1){Gn();return}gs()}},[Ie,ft]);const wn=V.useMemo(()=>aa(Pe)&&ht&&aa(Qe)&&aa(ft)?{_className:n,canvasBackground:r,customTextRenderer:d,devicePixelRatio:f,filterAnnotations:g,onGetAnnotationsError:S,onGetAnnotationsSuccess:C,onGetStructTreeError:E,onGetStructTreeSuccess:D,onGetTextError:M,onGetTextSuccess:N,onRenderAnnotationLayerError:F,onRenderAnnotationLayerSuccess:B,onRenderError:P,onRenderSuccess:O,onRenderTextLayerError:k,onRenderTextLayerSuccess:q,page:Ie,pageIndex:Pe,pageNumber:ht,renderForms:j,renderTextLayer:K,rotate:Qe,scale:ft}:null,[n,r,d,f,g,S,C,E,D,M,N,F,B,P,O,k,q,Ie,Pe,ht,j,K,Qe,ft]),bi=V.useMemo(()=>oS(xe,()=>Ie&&(ft?Dg(Ie,ft):void 0)),[xe,Ie,ft]),Sn=`${Pe}@${ft}/${Qe}`;function el(){switch(W){case"custom":return Rt(h),v.jsx(h,{},`${Sn}_custom`);case"none":return null;default:return v.jsx(WG,{canvasRef:a},`${Sn}_canvas`)}}function wi(){return K?v.jsx(QG,{},`${Sn}_text`):null}function tl(){return te?v.jsx(zG,{},`${Sn}_annotations`):null}function As(){function ne(me){return!!me?.page}if(!ne(wn))throw new Error("page is undefined");const ye=typeof l=="function"?l(wn):l;return v.jsxs(mS.Provider,{value:wn,children:[el(),wi(),tl(),ye]})}function er(){return ht?Y===null||Ie===void 0||Ie===null?v.jsx(Lo,{type:"loading",children:typeof b=="function"?b():b}):Y===!1||Ie===!1?v.jsx(Lo,{type:"error",children:typeof p=="function"?p():p}):As():v.jsx(Lo,{type:"no-data",children:typeof w=="function"?w():w})}return v.jsx("div",{className:Cf(n,c),"data-page-number":ht,ref:fS(x,We),style:{"--scale-round-x":"1px","--scale-round-y":"1px","--scale-factor":"1","--user-unit":`${ft}`,"--total-scale-factor":"calc(var(--scale-factor) * var(--user-unit))",backgroundColor:r||"white",position:"relative",minWidth:"min-content",minHeight:"min-content"},...bi,children:er()})}kG();Pr.workerSrc="pdf.worker.mjs";const JG={1:"rgba(0, 0, 0, 0)",2:"#2ecc71",3:"#e67e22",4:"#3498db",5:"#f1c40f"};Pr.workerSrc=`//unpkg.com/pdfjs-dist@${$1}/build/pdf.worker.min.mjs`;const $G="http://localhost:8000",eH=({studyId:i,modality:e,results:t,baseUrl:n=$G,slicesMeta:s,findingsPins:r})=>{const[a,l]=V.useState({currentSlice:0,totalSlices:1,blendOpacity:0,activeMap:"source",showOverlay:!1,windowLevel:40,windowWidth:400,zoom:1,sliceOpacity:100}),[c,h]=V.useState(null),[d,f]=V.useState(null),p=V.useRef(null),g=V.useRef(null),y=V.useRef(null),x=V.useRef(null),[b,w]=V.useState(0),[S,C]=V.useState(1),[E,D]=V.useState(1),[M,N]=V.useState(null),[I,_]=V.useState({slices:[],total_slices:0,loaded:!1,loading:!1}),[F,B]=V.useState({slices:[],total_slices:0,loaded:!1,loading:!1}),[P,O]=V.useState({slices:[],total_slices:0,loaded:!1,loading:!1}),[k,q]=V.useState({slices:[],total_slices:0,loaded:!1,loading:!1}),[U,H]=V.useState({slices:[],total_slices:0,loaded:!1,loading:!1}),[Y,Q]=V.useState(!1),[te,j]=V.useState(!0),[W,K]=V.useState(!1),[ee,le]=V.useState(0),[he,ce]=V.useState(null),xe=V.useRef(null),[ge,Me]=V.useState(null),[Ie,$e]=V.useState(null),We=V.useRef(null),[Pe,ht]=V.useState(!1),[Qe,ft]=V.useState({x:0,y:0,visible:!1,showText:!1,hu:0,ci:0,flowState:""});V.useEffect(()=>{if(!i||I.loading||I.loaded)return;(async()=>{_(ye=>({...ye,loading:!0})),le(0);try{const ye=`${n}/api/studies/${i}/slices-bundle/?wc=${a.windowLevel}&ww=${a.windowWidth}&max_size=512`,me=await fetch(ye);if(!me.ok)throw new Error(`Error loading slices: ${me.status}`);const Be=await me.json();_({slices:Be.slices,total_slices:Be.total_slices,loaded:!0,loading:!1}),l(st=>({...st,totalSlices:Be.total_slices,currentSlice:Math.min(st.currentSlice,Be.total_slices-1)})),le(100)}catch(ye){console.error("Error loading source bundle:",ye),_(me=>({...me,loading:!1,error:ye instanceof Error?ye.message:"Error loading slices"})),ce("Error cargando slices DICOM")}})()},[i,n,a.windowLevel,a.windowWidth,I.loading,I.loaded]),V.useEffect(()=>{i&&fetch(`${n}/api/studies/${i}/`).then(ne=>ne.json()).then(ne=>$e(ne)).catch(ne=>console.error("Error fetching study details:",ne))},[i,n]),V.useEffect(()=>{if(!i||!t||F.loading||F.loaded||!(t.heatmap||t.tep_heatmap))return;(async()=>{B(me=>({...me,loading:!0}));try{const me=t.tep_heatmap?"tep_heatmap":"heatmap",Be=`${n}/api/studies/${i}/result-bundle/${me}/?max_size=512`,st=await fetch(Be);if(!st.ok)throw new Error(`Error loading heatmap: ${st.status}`);const Le=await st.json();B({slices:Le.slices,total_slices:Le.total_slices,loaded:!0,loading:!1})}catch(me){console.error("Error loading heatmap bundle:",me),B(Be=>({...Be,loading:!1,error:me instanceof Error?me.message:"Error loading heatmap"}))}})()},[i,t,n,F.loading,F.loaded]),V.useEffect(()=>{if(!i||!t||P.loading||P.loaded||!t.tep_roi_heatmap)return;(async()=>{O(me=>({...me,loading:!0}));try{const me=`${n}/api/studies/${i}/result-bundle/tep_roi_heatmap/?max_size=512`,Be=await fetch(me);if(!Be.ok)throw new Error(`Error loading ROI: ${Be.status}`);const st=await Be.json();O({slices:st.slices,total_slices:st.total_slices,loaded:!0,loading:!1})}catch(me){console.error("Error loading ROI bundle:",me),O(Be=>({...Be,loading:!1,error:me instanceof Error?me.message:"Error loading ROI"}))}})()},[i,t,n,P.loading,P.loaded]),V.useEffect(()=>{if(!i||!t||k.loading||k.loaded||!t.pseudocolor_map)return;(async()=>{q(me=>({...me,loading:!0}));try{const me=`${n}/api/studies/${i}/result-bundle/pseudocolor_map/?max_size=512`,Be=await fetch(me);if(!Be.ok)throw new Error(`Error loading pseudocolor: ${Be.status}`);const st=await Be.json();q({slices:st.slices,total_slices:st.total_slices,loaded:!0,loading:!1})}catch(me){console.error("Error loading pseudocolor bundle:",me),q(Be=>({...Be,loading:!1,error:me instanceof Error?me.message:"Error loading pseudocolor"}))}})()},[i,t,n,k.loading,k.loaded]),V.useEffect(()=>{if(!i||!t||U.loading||U.loaded||!t.tep_coherence_map)return;(async()=>{H(me=>({...me,loading:!0}));try{const me=`${n}/api/studies/${i}/result-bundle/tep_coherence_map/?max_size=512`,Be=await fetch(me);if(!Be.ok)throw new Error(`Error loading coherence: ${Be.status}`);const st=await Be.json();H({slices:st.slices,total_slices:st.total_slices,loaded:!0,loading:!1})}catch(me){console.error("Error loading coherence bundle:",me),H(Be=>({...Be,loading:!1,error:me instanceof Error?me.message:"Error loading coherence"}))}})()},[i,t,n,U.loading,U.loaded]);const Gn=V.useCallback(()=>{const ne=[{id:"source",label:"Heatmap",shortLabel:"HEAT",available:I.loaded,color:"#ffffff"}];return(e==="CT_TEP"||e==="CT_SMART")&&t?.pseudocolor_map&&ne.push({id:"pseudocolor",label:"Anlisis de Densidad",shortLabel:"DENSITY",available:k.loaded,color:"#84cc16"}),(e==="CT_TEP"||e==="CT_SMART")&&t?.tep_coherence_map&&ne.push({id:"coherence",label:"Coherencia Vascular",shortLabel:"FLOW",available:U.loaded,color:"#a855f7"}),e==="MRI_DKI"&&t&&(t.mk_map&&ne.push({id:"mk",label:"Kurtosis Media (MK)",shortLabel:"MK",available:!1,color:"#8b5cf6"}),t.fa_map&&ne.push({id:"fa",label:"Anisotropa Fraccional (FA)",shortLabel:"FA",available:!1,color:"#06b6d4"}),t.md_map&&ne.push({id:"md",label:"Difusividad Media (MD)",shortLabel:"MD",available:!1,color:"#22c55e"})),(e==="CT_TEP"||e==="CT_SMART")&&t&&t.entropy_map&&ne.push({id:"entropy",label:"Entropa",shortLabel:"ENT",available:!1,color:"#f59e0b"}),t?.audit_report&&ne.push({id:"pdf",label:"Audit Report PDF",shortLabel:"PDF",available:!0,color:"#3b82f6"}),t?.tep_heatmap&&Ie?.dicom_archive&&ne.push({id:"render3d",label:"3D Render",shortLabel:"3D",available:!0,color:"#ec4899"}),ne},[e,t,I.loaded,F.loaded,Ie,k.loaded,U.loaded])(),wn=V.useCallback(()=>{if(a.activeMap==="source")return!I.loaded||!I.slices.length?null:I.slices[a.currentSlice]||null;if(a.activeMap==="heatmap"){if(!F.loaded||!F.slices.length)return null;if(I.loaded&&I.slices.length)return I.slices[a.currentSlice]||null;const ne=Math.min(a.currentSlice,F.total_slices-1);return F.slices[ne]||null}if(a.activeMap==="pseudocolor"){if(!k.loaded||!k.slices.length)return null;const ne=Math.min(a.currentSlice,k.total_slices-1);return k.slices[ne]||null}if(a.activeMap==="coherence"){if(!U.loaded||!U.slices.length)return null;if(I.loaded&&I.slices.length)return I.slices[a.currentSlice]||null;const ne=Math.min(a.currentSlice,U.total_slices-1);return U.slices[ne]||null}return null},[a.activeMap,a.currentSlice,I,F,k,U]);V.useEffect(()=>{const ne=g.current,ye=p.current;if(!ne||!ye||a.activeMap!=="coherence"||!U.loaded)return;const me=ne.getContext("2d");if(!me)return;ne.width=ye.width,ne.height=ye.height,me.clearRect(0,0,ne.width,ne.height);const Be=Math.min(a.currentSlice,U.total_slices-1),st=U.slices[Be];if(st){const Le=new Image;Le.crossOrigin="Anonymous",Le.onload=()=>{const ke=document.createElement("canvas");ke.width=Le.width,ke.height=Le.height;const Ne=ke.getContext("2d");if(!Ne)return;Ne.drawImage(Le,0,0);const dt=Ne.getImageData(0,0,Le.width,Le.height),je=dt.data;We.current={width:Le.width,height:Le.height,data:je};for(let Ge=0;Ge<je.length;Ge+=4){const mt=je[Ge]/255;if(mt<.1){je[Ge+3]=0;continue}Math.abs(mt-.55)<.02?(je[Ge]=120,je[Ge+1]=120,je[Ge+2]=120,je[Ge+3]=Math.floor(150*(a.blendOpacity/100))):mt>.65?(je[Ge]=16,je[Ge+1]=230,je[Ge+2]=120,je[Ge+3]=Math.floor(200*(a.blendOpacity/100))):mt>=.4?(je[Ge]=60,je[Ge+1]=100,je[Ge+2]=80,je[Ge+3]=Math.floor(120*(a.blendOpacity/100))):(je[Ge]=138,je[Ge+1]=43,je[Ge+2]=226,je[Ge+3]=Math.floor(230*(a.blendOpacity/100)))}Ne.putImageData(dt,0,0),me.drawImage(ke,0,0,ye.width,ye.height)},Le.src=st}},[a.currentSlice,a.activeMap,a.blendOpacity,U.loaded,U.slices,U.total_slices]),V.useEffect(()=>{const ne=g.current,ye=p.current;if(!ne||!ye||a.activeMap!=="pseudocolor"||!k.loaded)return;const me=ne.getContext("2d");if(!me)return;ne.width=ye.width,ne.height=ye.height,me.clearRect(0,0,ne.width,ne.height);const Be=Math.min(a.currentSlice,k.total_slices-1),st=k.slices[Be];if(st){const Le=new Image;Le.crossOrigin="Anonymous",Le.onload=()=>{const ke=document.createElement("canvas");ke.width=Le.width,ke.height=Le.height;const Ne=ke.getContext("2d");if(!Ne)return;Ne.drawImage(Le,0,0);const dt=Ne.getImageData(0,0,Le.width,Le.height),je=dt.data;for(let Ge=0;Ge<je.length;Ge+=4){const ti=je[Ge];if(ti===0){je[Ge+3]=0;continue}const mt=JG[ti];if(mt)if(mt.startsWith("rgba"))je[Ge]=0,je[Ge+1]=0,je[Ge+2]=0,je[Ge+3]=0;else{const _t=mt.replace("#","");je[Ge]=parseInt(_t.substring(0,2),16),je[Ge+1]=parseInt(_t.substring(2,4),16),je[Ge+2]=parseInt(_t.substring(4,6),16),je[Ge+3]=Math.floor(255*(a.blendOpacity/100))}}Ne.putImageData(dt,0,0),me.drawImage(ke,0,0,ye.width,ye.height)},Le.src=st}},[a.currentSlice,a.activeMap,a.blendOpacity,k.loaded,k.slices,k.total_slices]);const bi=V.useCallback(ne=>{l(ye=>({...ye,...ne}))},[]),Sn=V.useCallback(ne=>{const ye=a.activeMap==="source"?I.total_slices-1:a.activeMap==="pseudocolor"?k.total_slices-1:a.activeMap==="coherence"?U.total_slices-1:F.total_slices-1;bi({currentSlice:Math.max(0,Math.min(ne,Math.max(0,ye)))})},[bi,a.activeMap,I.total_slices,F.total_slices,k.total_slices,U.total_slices]),el=V.useCallback(ne=>{ne.preventDefault();const ye=ne.deltaY>0?1:-1;Sn(a.currentSlice+ye)},[Sn,a.currentSlice]);V.useEffect(()=>{const ne=p.current;if(!ne)return;const ye=ne.getContext("2d");if(!ye)return;const me=wn();if(!me){ye.fillStyle="#1a1a2e",ye.fillRect(0,0,ne.width,ne.height);return}const Be=new Image;Be.onload=()=>{ne.width=Be.width,ne.height=Be.height,ye.globalAlpha=1,ye.drawImage(Be,0,0)},Be.src=me},[wn]),V.useEffect(()=>{const ne=g.current,ye=p.current;if(!ne||!ye||a.activeMap!=="source"&&a.activeMap!=="pseudocolor"||!F.loaded||!a.showOverlay)return;const me=ne.getContext("2d");if(me&&a.activeMap==="source"&&F.loaded){const Be=Math.min(a.currentSlice,F.total_slices-1),st=F.slices[Be];if(st){const Le=new Image;Le.onload=()=>{ne.width=ye.width,ne.height=ye.height,me.globalAlpha=a.blendOpacity/100,me.drawImage(Le,0,0,ye.width,ye.height)},Le.src=st}}},[a.currentSlice,a.showOverlay,a.blendOpacity,a.activeMap,F]),V.useEffect(()=>{const ne=y.current,ye=p.current;if(!ne||!ye||!Y||!P.loaded)return;const me=ne.getContext("2d");if(!me)return;const Be=Math.min(a.currentSlice,P.total_slices-1),st=P.slices[Be];if(st){const Le=new Image;Le.onload=()=>{ne.width=ye.width,ne.height=ye.height,me.globalAlpha=.5,me.drawImage(Le,0,0,ye.width,ye.height)},Le.src=st}},[a.currentSlice,Y,P]),V.useEffect(()=>{if(a.activeMap==="render3d"&&xe.current&&!ge&&Ie){if(xe.current.width===0||xe.current.height===0)return;try{const ne=new Af({show3Dcrosshair:!0,backColor:[0,0,0,1],isResizeCanvas:!0});setTimeout(()=>{if(xe.current)try{ne.attachToCanvas(xe.current),ne.setSliceType(ne.sliceTypeRender),Me(ne);const ye=[];t?.source_volume?ye.push({url:t.source_volume,opacity:.1,colormap:"gray",visible:!0}):t?.tep_pa_mask&&ye.push({url:t.tep_pa_mask,opacity:.1,colormap:"gray",visible:!0}),t?.tep_heatmap&&ye.push({url:t.tep_heatmap,opacity:1,colormap:"red",cal_min:2,cal_max:5,visible:!0}),t?.tep_roi_heatmap&&ye.push({url:t.tep_roi_heatmap,opacity:.3,colormap:"cyan",visible:!0}),ne.loadVolumes(ye)}catch(ye){console.error("Niivue attach failed:",ye)}},100)}catch(ne){console.error("Niivue initialization failed:",ne)}}a.activeMap!=="render3d"&&ge&&Me(null)},[a.activeMap,Ie,t,ge]),V.useEffect(()=>{ge&&a.activeMap==="render3d"&&F.total_slices>0},[a.currentSlice,ge,a.activeMap,F.total_slices]);const wi=V.useCallback(ne=>{const ye=p.current;if(!ye)return;const me=ye.getBoundingClientRect(),Be=ne.clientX-me.left,st=ne.clientY-me.top,Le=We.current;if(a.activeMap==="coherence"&&U.loaded&&Le){const ke=Le.width/me.width,Ne=Le.height/me.height,dt=Math.floor(Be*ke),je=Math.floor(st*Ne);if(dt<0||dt>=Le.width||je<0||je>=Le.height){ft(hi=>({...hi,visible:!1}));return}const Ge=(je*Le.width+dt)*4,mt=Le.data[Ge]/255;let _t="Unknown";mt<.1?_t=" Fuera de Dominio Vascular":Math.abs(mt-.55)<.02?_t=" Va Area (Excluido por Morfometra)":mt>.65?_t=" Laminar (Healthy Flow)":mt>=.4?_t=" Stable / Non-Vascular Tissue":_t=" Stasis / Filling Defect",ft({x:ne.clientX+15,y:ne.clientY+15,visible:!0,showText:!0,hu:0,ci:Number(mt.toFixed(2)),flowState:_t})}else ft({x:ne.clientX+15,y:ne.clientY+15,visible:!0,showText:!1,hu:0,ci:0,flowState:""});if(Pe){const ke=document.getElementById("magnifier-lens");if(ke&&p.current){const Ne=ke.getContext("2d");if(Ne){const dt=p.current.width/me.width,je=p.current.height/me.height,Ge=150,ti=3,mt=Ge/ti*dt,_t=Ge/ti*je,hi=Be*dt,Hn=st*je,tr=Math.max(0,hi-mt/2),vs=Math.max(0,Hn-_t/2);Ne.clearRect(0,0,ke.width,ke.height),Ne.drawImage(p.current,tr,vs,mt,_t,0,0,ke.width,ke.height),a.showOverlay&&g.current&&Ne.drawImage(g.current,tr,vs,mt,_t,0,0,ke.width,ke.height),Y&&y.current&&P.loaded&&Ne.drawImage(y.current,tr,vs,mt,_t,0,0,ke.width,ke.height),Ne.strokeStyle="rgba(168, 85, 247, 0.8)",Ne.lineWidth=2,Ne.strokeRect(0,0,ke.width,ke.height),Ne.beginPath(),Ne.moveTo(ke.width/2,ke.height/2-5),Ne.lineTo(ke.width/2,ke.height/2+5),Ne.moveTo(ke.width/2-5,ke.height/2),Ne.lineTo(ke.width/2+5,ke.height/2),Ne.stroke()}}}},[a.activeMap,U,Qe.visible,Pe,a.showOverlay,Y,P]);V.useEffect(()=>{if(!c||!x.current||!p.current)return;const ne=p.current,ye=x.current,me=ye.getContext("2d");if(!me)return;const Be=c.location.coord_x,st=c.location.coord_y,Le=c.location.slice_z,ke=3,Ne=ye.width,dt=Ne/ke,je=Ne/ke,Ge=Math.max(0,Be-dt/2),ti=Math.max(0,st-je/2);me.fillStyle="black",me.fillRect(0,0,Ne,Ne),me.drawImage(ne,Ge,ti,dt,je,0,0,Ne,Ne);const mt=()=>{me.strokeStyle=c.type==="TEP_DEFINITE"?"#ef4444":"#f59e0b",me.lineWidth=4,me.strokeRect(0,0,Ne,Ne),me.strokeStyle="rgba(0, 255, 0, 0.5)",me.lineWidth=1,me.beginPath(),me.moveTo(Ne/2-10,Ne/2),me.lineTo(Ne/2+10,Ne/2),me.moveTo(Ne/2,Ne/2-10),me.lineTo(Ne/2,Ne/2+10),me.stroke()};if(F.loaded&&F.slices[Le]){const _t=F.slices[Le];if(_t){const hi=new Image;hi.crossOrigin="Anonymous",hi.onload=()=>{c.location.slice_z===Le&&(me.globalAlpha=.85,me.drawImage(hi,Ge,ti,dt,je,0,0,Ne,Ne),me.globalAlpha=1,mt())},hi.onerror=Hn=>{console.error("Failed to load heatmap for pin magnifier",Hn),mt()},hi.src=_t}else console.warn("Pin active but no heatmap URL for slice",Le),mt()}else mt();Y&&y.current&&P.loaded&&(me.globalAlpha=.3,me.drawImage(y.current,Ge,ti,dt,je,0,0,Ne,Ne),me.globalAlpha=1),mt()},[c,F,Y,P.loaded]);const tl=V.useCallback(ne=>{if(a.activeMap!=="coherence"||!t?.voi_findings)return;const ye=p.current;if(!ye)return;const me=ye.getBoundingClientRect(),Be=ye.width/me.width,st=ye.height/me.height,Le=(ne.clientX-me.left)*Be,ke=(ne.clientY-me.top)*st,Ne=a.currentSlice,dt=t.voi_findings.filter(ti=>Ne>=ti.slice_range[0]&&Ne<=ti.slice_range[1]);if(dt.length===0){N(null);return}let je=null,Ge=1e4;dt.forEach(ti=>{const mt=ti.centroid[1],_t=ti.centroid[2],hi=Math.sqrt(Math.pow(Le-_t,2)+Math.pow(ke-mt,2));hi<40&&hi<Ge&&(Ge=hi,je=ti)}),N(je?je.id:null)},[a.activeMap,t,a.currentSlice]);if(I.loading)return v.jsxs(v.Fragment,{children:[v.jsx("div",{className:"viewer-tabs",children:v.jsxs("button",{className:"viewer-tab active",disabled:!0,children:[v.jsx("span",{className:"viewer-tab-indicator",style:{background:"#64748b"}}),"SRC"]})}),v.jsx("div",{className:"viewer-container",children:v.jsxs("div",{style:{position:"absolute",color:"var(--ws-text-muted)",display:"flex",flexDirection:"column",alignItems:"center",gap:"12px"},children:[v.jsx("div",{className:"pipeline-stage-icon processing",style:{width:48,height:48,fontSize:"1.5rem"},children:""}),v.jsx("div",{children:"Cargando volumen DICOM..."}),v.jsx("div",{style:{width:"200px",height:"4px",background:"var(--ws-border)",borderRadius:"2px",overflow:"hidden"},children:v.jsx("div",{style:{width:`${ee}%`,height:"100%",background:"var(--ws-primary)",transition:"width 0.3s ease"}})}),v.jsx("div",{style:{fontSize:"0.8rem",opacity:.7},children:"Preparando slices para navegacin instantnea"})]})})]});if(he||I.error)return v.jsxs(v.Fragment,{children:[v.jsx("div",{className:"viewer-tabs",children:v.jsxs("button",{className:"viewer-tab active",disabled:!0,children:[v.jsx("span",{className:"viewer-tab-indicator",style:{background:"#ef4444"}}),"SRC"]})}),v.jsx("div",{className:"viewer-container",children:v.jsxs("div",{style:{position:"absolute",color:"var(--ws-error)",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[v.jsx("span",{style:{fontSize:"2rem"},children:""}),he||I.error]})})]});const As=a.activeMap==="source"?I.total_slices:a.activeMap==="pseudocolor"?k.total_slices:F.total_slices,er=t?.audit_report?`${n}/api/studies/${i}/audit-report/`:null;return v.jsxs(v.Fragment,{children:[v.jsxs("div",{className:"viewer-tabs",children:[Gn.map(ne=>v.jsxs("button",{className:`viewer-tab ${a.activeMap===ne.id?"active":""}`,onClick:()=>bi({activeMap:ne.id}),disabled:!ne.available,title:ne.available?ne.label:`${ne.label} (cargando...)`,children:[v.jsx("span",{className:"viewer-tab-indicator",style:{background:ne.available?ne.color:void 0}}),ne.shortLabel,!ne.available&&ne.id!=="source"&&v.jsx("span",{style:{marginLeft:"4px",fontSize:"0.6rem",opacity:.6},children:""})]},ne.id)),(e==="CT_TEP"||e==="CT_SMART")&&r&&r.length>0&&v.jsxs("div",{style:{display:"flex",gap:"8px",borderLeft:"1px solid #334155",paddingLeft:"8px",marginLeft:"8px"},children:[v.jsxs("button",{className:`viewer-tab ${te?"active":""}`,onClick:()=>j(!te),style:{padding:"4px 8px",fontSize:"0.75rem",gap:"4px"},title:"Mostrar/Ocultar Pines de Hallazgos",children:[v.jsx("span",{style:{fontSize:"0.8rem"},children:""}),te?"Ocultar Pines":"Mostrar Pines"]}),v.jsxs("button",{className:`viewer-tab ${W?"active":""}`,onClick:()=>K(!W),style:{padding:"4px 8px",fontSize:"0.75rem",gap:"4px"},title:"Mostrar/Ocultar ndice de Hallazgos",children:[v.jsx("span",{style:{fontSize:"0.8rem"},children:""}),"Hallazgos"]})]}),v.jsxs("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:"8px"},children:[(F.loaded||k.loaded)&&v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginRight:"10px"},children:[v.jsx("span",{style:{fontSize:"0.7rem"},children:"Opacidad:"}),v.jsx("input",{type:"range",min:"0",max:"100",value:a.blendOpacity,onChange:ne=>bi({blendOpacity:Number(ne.target.value)}),style:{width:"80px"}})]}),v.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"0.75rem",color:"var(--ws-text-secondary)",cursor:F.loaded?"pointer":"not-allowed",opacity:F.loaded?1:.5},children:[v.jsx("input",{type:"checkbox",checked:a.showOverlay,onChange:ne=>bi({showOverlay:ne.target.checked}),disabled:!F.loaded}),"Overlay"]}),v.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"0.75rem",color:P.loaded?"#00FFFF":"var(--ws-text-secondary)",cursor:P.loaded?"pointer":"not-allowed",opacity:P.loaded?1:.5},children:[v.jsx("input",{type:"checkbox",checked:Y,onChange:ne=>Q(ne.target.checked),disabled:!P.loaded}),"ROI"]})]}),a.activeMap==="pseudocolor"&&v.jsxs("div",{style:{position:"absolute",top:"50px",right:"10px",background:"rgba(15, 23, 42, 0.9)",padding:"10px",borderRadius:"8px",border:"1px solid var(--ws-border)",fontSize:"0.75rem",zIndex:20},children:[v.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"var(--ws-text-primary)"},children:"Leyenda Densidad"}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"2px"},children:[v.jsx("span",{style:{width:12,height:12,background:"#2ecc71",borderRadius:2}}),v.jsx("span",{children:"Tejido Blando (-100-30)"})]}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"2px"},children:[v.jsx("span",{style:{width:12,height:12,background:"#e67e22",borderRadius:2}}),v.jsx("span",{children:"Trombo (30-100)"})]}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"2px"},children:[v.jsx("span",{style:{width:12,height:12,background:"#3498db",borderRadius:2}}),v.jsx("span",{children:"Vasos (150-500)"})]}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[v.jsx("span",{style:{width:12,height:12,background:"#f1c40f",borderRadius:2}}),v.jsx("span",{children:"Hueso (>500)"})]})]})]}),a.activeMap==="render3d"?v.jsxs("div",{className:"viewer-container",style:{padding:0},children:[v.jsx("canvas",{ref:xe,style:{width:"100%",height:"100%"}}),v.jsxs("div",{style:{position:"absolute",bottom:20,left:20,background:"rgba(0,0,0,0.7)",padding:10,borderRadius:8,color:"white",fontSize:"0.8rem",display:"flex",flexDirection:"column",gap:8},children:[v.jsx("div",{children:v.jsx("strong",{children:"Controles 3D"})}),v.jsxs("div",{style:{display:"flex",gap:10},children:[v.jsx("span",{children:"Mouse Izq:"})," ",v.jsx("span",{children:"Rotar"})]}),v.jsxs("div",{style:{display:"flex",gap:10},children:[v.jsx("span",{children:"Mouse Der:"})," ",v.jsx("span",{children:"Pan"})]}),v.jsxs("div",{style:{display:"flex",gap:10},children:[v.jsx("span",{children:"Rueda:"})," ",v.jsx("span",{children:"Zoom"})]}),ge&&v.jsxs("div",{style:{marginTop:8},children:[v.jsx("label",{children:"Umbral Ruido (HU)"}),v.jsx("input",{type:"range",min:"0",max:"6",step:"1",defaultValue:"2",onChange:ne=>{ge.volumes.length>1&&(ge.volumes[1].cal_min=parseFloat(ne.target.value),ge.updateGLVolume())}})]})]})]}):a.activeMap==="pdf"&&er?v.jsxs("div",{className:"viewer-container",style:{padding:0,overflow:"auto"},children:[v.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minHeight:"100%",padding:"20px",background:"#2a2a3e"},children:v.jsx(jG,{file:er,onLoadSuccess:({numPages:ne})=>w(ne),loading:v.jsx("div",{style:{color:"white",padding:"40px"},children:" Cargando PDF..."}),error:v.jsx("div",{style:{color:"#ff6b6b",padding:"40px"},children:" Error al cargar el PDF"}),children:v.jsx(ZG,{pageNumber:S,scale:E,renderTextLayer:!0,renderAnnotationLayer:!0})})}),v.jsxs("div",{style:{position:"absolute",bottom:"12px",left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.9)",padding:"10px 20px",borderRadius:"8px",display:"flex",gap:"16px",alignItems:"center"},children:[v.jsx("button",{onClick:()=>C(ne=>Math.max(1,ne-1)),disabled:S<=1,style:{padding:"6px 12px",background:S<=1?"#444":"var(--ws-primary)",border:"none",borderRadius:"4px",color:"white",cursor:S<=1?"not-allowed":"pointer"},children:" Prev"}),v.jsxs("span",{style:{color:"white",fontSize:"0.85rem"},children:["Pgina ",S," / ",b]}),v.jsx("button",{onClick:()=>C(ne=>Math.min(b,ne+1)),disabled:S>=b,style:{padding:"6px 12px",background:S>=b?"#444":"var(--ws-primary)",border:"none",borderRadius:"4px",color:"white",cursor:S>=b?"not-allowed":"pointer"},children:"Next "}),v.jsxs("div",{style:{borderLeft:"1px solid #555",paddingLeft:"16px",display:"flex",gap:"8px",alignItems:"center"},children:[v.jsx("button",{onClick:()=>D(ne=>Math.max(.5,ne-.25)),style:{padding:"4px 8px",background:"#555",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:""}),v.jsxs("span",{style:{color:"white",fontSize:"0.8rem",minWidth:"45px",textAlign:"center"},children:[Math.round(E*100),"%"]}),v.jsx("button",{onClick:()=>D(ne=>Math.min(2,ne+.25)),style:{padding:"4px 8px",background:"#555",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"+"})]}),v.jsx("a",{href:`${er}?download=true`,download:`audit_report_${i}.pdf`,style:{padding:"6px 14px",background:"#4CAF50",borderRadius:"4px",color:"white",textDecoration:"none",fontSize:"0.8rem",marginLeft:"8px"},children:" Descargar"})]})]}):v.jsxs("div",{className:"viewer-container",onWheel:el,children:[v.jsxs("div",{style:{position:"relative",width:"fit-content",height:"fit-content",transform:`scale(${a.zoom})`,transformOrigin:"center center",transition:"transform 0.1s ease-out"},children:[v.jsx("canvas",{ref:p,className:"viewer-canvas",onMouseMove:wi,onClick:tl,onMouseLeave:()=>ft(ne=>({...ne,visible:!1})),style:{display:"block"}}),a.showOverlay&&v.jsx("canvas",{ref:g,className:"viewer-canvas",style:{position:"absolute",inset:0,width:"100%",height:"100%",pointerEvents:"none",opacity:a.blendOpacity/100}}),Y&&P.loaded&&v.jsx("canvas",{ref:y,className:"viewer-canvas",style:{position:"absolute",inset:0,width:"100%",height:"100%",pointerEvents:"none",opacity:.5}}),te&&r&&a.activeMap!=="render3d"&&v.jsx("div",{style:{position:"absolute",inset:0,pointerEvents:"none",overflow:"visible"},children:r.filter(ne=>{const ye=ne.location.slice_z;return ye===a.currentSlice&&ye<a.totalSlices}).map(ne=>v.jsx("div",{onMouseEnter:ye=>{h(ne);const me=ye.currentTarget.getBoundingClientRect();f({x:me.right+10,y:me.top})},onMouseLeave:()=>{h(null),f(null)},style:{position:"absolute",left:`${ne.location.coord_x/512*100}%`,top:`${ne.location.coord_y/512*100}%`,transform:"translate(-50%, -100%)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",pointerEvents:"auto",zIndex:40},children:v.jsx("span",{style:{fontSize:"1.5rem",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:""})},ne.id))})]}),c&&d&&v.jsxs("div",{style:{position:"fixed",left:d.x,top:d.y-75,background:"rgba(15, 23, 42, 0.95)",border:"1px solid #475569",borderRadius:"8px",padding:"8px",zIndex:200,pointerEvents:"none",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.5)",display:"flex",flexDirection:"column",gap:"4px"},children:[v.jsxs("div",{style:{fontWeight:"bold",color:"#e2e8f0",fontSize:"0.85rem",borderBottom:"1px solid #334155",paddingBottom:"4px"},children:["Hallazgo #",c.id]}),v.jsx("canvas",{ref:x,width:"250",height:"250",style:{borderRadius:"4px",background:"black"}}),v.jsx("div",{style:{fontSize:"0.75rem",color:c.type==="TEP_DEFINITE"?"#ef4444":"#f59e0b"},children:c.type==="TEP_DEFINITE"?"Trombo Definido":"Sospecha"}),v.jsxs("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:["Score: ",c.tooltip_data.score_total.toFixed(2)]})]}),Pe&&Qe.visible&&v.jsx("div",{style:{position:"fixed",left:Qe.x+20,top:Qe.y-75,width:"150px",height:"150px",pointerEvents:"none",zIndex:101,borderRadius:"50%",border:"2px solid #a855f7",overflow:"hidden",boxShadow:"0 0 10px rgba(0,0,0,0.5)",backgroundColor:"black"},children:v.jsx("canvas",{id:"magnifier-lens",width:"150",height:"150",style:{width:"100%",height:"100%"}})}),Qe.visible&&Qe.showText&&v.jsxs("div",{style:{position:"fixed",left:Pe?Qe.x+180:Qe.x,top:Qe.y,background:"rgba(15, 23, 42, 0.95)",border:"1px solid rgba(168, 85, 247, 0.5)",borderRadius:"8px",padding:"12px",color:"white",pointerEvents:"none",boxShadow:"0 4px 6px rgba(0,0,0,0.3)",zIndex:100,width:"200px",backdropFilter:"blur(4px)"},children:[v.jsxs("div",{style:{borderBottom:"1px solid #334155",paddingBottom:"4px",marginBottom:"4px",fontWeight:"bold",fontSize:"0.85rem",color:"#a855f7",display:"flex",alignItems:"center",gap:"6px"},children:[v.jsx("span",{children:""})," Rheology Magnifier"]}),v.jsxs("div",{style:{fontSize:"0.8rem",display:"grid",gridTemplateColumns:"1fr auto",gap:"6px"},children:[v.jsx("span",{style:{color:"#94a3b8"},children:"Coherence (CI):"}),v.jsx("span",{style:{fontWeight:"bold"},children:Qe.ci}),v.jsx("span",{style:{color:"#94a3b8"},children:"Flow State:"}),v.jsx("span",{style:{fontWeight:"bold",color:Qe.flowState.includes("Laminar")?"#22c55e":Qe.flowState.includes("Turbulent")?"#a855f7":"#eab308"},children:Qe.flowState})]})]}),W&&r&&v.jsxs("div",{onWheel:ne=>ne.stopPropagation(),style:{position:"absolute",top:"50px",left:"10px",width:"250px",maxHeight:"80%",background:"rgba(15, 23, 42, 0.95)",border:"1px solid #334155",borderRadius:"8px",display:"flex",flexDirection:"column",zIndex:60,boxShadow:"0 4px 12px rgba(0,0,0,0.5)",backdropFilter:"blur(4px)"},children:[v.jsxs("div",{style:{padding:"10px",borderBottom:"1px solid #334155",display:"flex",justifyContent:"space-between",alignItems:"center",fontWeight:"bold",color:"#e2e8f0"},children:[v.jsxs("span",{children:[" Hallazgos (",r.length,")"]}),v.jsx("button",{onClick:()=>K(!1),style:{background:"transparent",border:"none",color:"#94a3b8",cursor:"pointer"},children:""})]}),v.jsx("div",{style:{overflowY:"auto",padding:"8px",display:"flex",flexDirection:"column",gap:"6px"},children:r.map(ne=>v.jsxs("div",{onClick:()=>{bi({currentSlice:ne.location.slice_z})},style:{padding:"8px",background:a.currentSlice===ne.location.slice_z?"rgba(59, 130, 246, 0.2)":"rgba(255,255,255,0.05)",border:a.currentSlice===ne.location.slice_z?"1px solid #3b82f6":"1px solid transparent",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx("span",{children:ne.type==="TEP_DEFINITE"?"":""}),v.jsxs("div",{style:{flex:1},children:[v.jsx("div",{style:{fontSize:"0.85rem",fontWeight:"bold",color:ne.type==="TEP_DEFINITE"?"#ef4444":"#f59e0b"},children:ne.type==="TEP_DEFINITE"?"Trombo Definido":"Sospecha"}),v.jsxs("div",{style:{fontSize:"0.75rem",color:"#94a3b8"},children:["Slice ",ne.location.slice_z+1,"  Score ",ne.tooltip_data.score_total.toFixed(1)]})]})]},ne.id))})]}),v.jsxs("div",{className:"slice-navigator",children:[s?.alerts_heatmap?.map(ne=>v.jsx("div",{style:{position:"absolute",left:`${ne/(As-1)*100}%`,top:"-6px",width:"2px",height:"6px",background:"#ef4444",zIndex:10,pointerEvents:"none"}},`hm-${ne}`)),s?.alerts_flow?.map(ne=>v.jsx("div",{style:{position:"absolute",left:`${ne/(As-1)*100}%`,bottom:"-6px",width:"2px",height:"6px",background:"#a855f7",zIndex:10,pointerEvents:"none"}},`flow-${ne}`)),v.jsx("div",{className:"slice-info",children:"Corte"}),v.jsx("input",{type:"range",min:0,max:Math.max(0,As-1),value:a.currentSlice,onChange:ne=>Sn(parseInt(ne.target.value)),style:{zIndex:20,position:"relative"}}),v.jsxs("div",{className:"slice-info",children:[a.currentSlice+1," / ",As]})]}),v.jsxs("div",{className:"viewer-controls",children:[a.showOverlay&&v.jsxs("div",{className:"viewer-control-group",children:[v.jsx("span",{className:"viewer-control-label",children:"Mezcla / Color"}),v.jsx("input",{type:"range",className:"viewer-slider",min:0,max:100,value:a.blendOpacity,onChange:ne=>bi({blendOpacity:parseInt(ne.target.value)})}),v.jsxs("span",{className:"viewer-control-value",children:[a.blendOpacity,"%"]})]}),v.jsx("button",{onClick:()=>ht(!Pe),title:Pe?"Desactivar Lupa":"Activar Lupa",style:{background:Pe?"#a855f7":"transparent",border:"1px solid #475569",borderRadius:"4px",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white",marginLeft:"8px",transition:"all 0.2s ease"},children:v.jsx("span",{style:{fontSize:"1.2rem"},children:""})}),(e==="CT_TEP"||e==="CT_SMART")&&v.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--ws-text-muted)",padding:"4px 8px",background:"rgba(0,0,0,0.3)",borderRadius:"4px"},children:["WL: ",a.windowLevel," | WW: ",a.windowWidth]}),v.jsxs("div",{className:"viewer-control-group",children:[v.jsx("span",{className:"viewer-control-label",children:"Zoom"}),v.jsx("input",{type:"range",className:"viewer-slider",min:50,max:300,value:a.zoom*100,onChange:ne=>bi({zoom:parseInt(ne.target.value)/100})}),v.jsxs("span",{className:"viewer-control-value",children:[Math.round(a.zoom*100),"%"]})]})]}),F.loading&&v.jsxs("div",{style:{position:"absolute",bottom:"60px",left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.8)",padding:"8px 16px",borderRadius:"8px",fontSize:"0.75rem",color:"var(--ws-text-secondary)",display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx("div",{className:"pipeline-stage-icon processing",style:{width:16,height:16,fontSize:"0.8rem"},children:""}),"Cargando mapa de calor..."]})]}),a.activeMap==="coherence"&&t?.estimated_mpap&&v.jsxs("div",{style:{position:"absolute",top:"20px",right:"20px",width:"300px",background:"rgba(15, 23, 42, 0.95)",border:"1px solid #3b82f6",borderRadius:"12px",padding:"16px",color:"white",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.6)",zIndex:50,fontSize:"0.85rem",backdropFilter:"blur(8px)",fontFamily:"'Inter', sans-serif"},children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px",borderBottom:"1px solid #334155",paddingBottom:"8px"},children:[v.jsx("div",{style:{fontWeight:"bold",fontSize:"0.95rem",color:"#60a5fa"},children:" Hemodinmica (Estimada)"}),v.jsx("div",{style:{fontSize:"0.7rem",padding:"2px 6px",borderRadius:"10px",background:"rgba(96, 165, 250, 0.2)",color:"#60a5fa"},children:"MART v3"})]}),v.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginBottom:"16px"},children:[v.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"10px",borderRadius:"8px"},children:[v.jsx("div",{style:{color:"#94a3b8",fontSize:"0.75rem",marginBottom:"4px"},children:"mPAP"}),v.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:t.estimated_mpap>25?"#ef4444":"#22c55e"},children:[t.estimated_mpap.toFixed(1)," ",v.jsx("span",{style:{fontSize:"0.8rem"},children:"mmHg"})]})]}),v.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"10px",borderRadius:"8px"},children:[v.jsx("div",{style:{color:"#94a3b8",fontSize:"0.75rem",marginBottom:"4px"},children:"PVR"}),v.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:(t.pvr_wood_units||0)>3?"#ef4444":"#22c55e"},children:[t.pvr_wood_units?.toFixed(2)," ",v.jsx("span",{style:{fontSize:"0.8rem"},children:"WU"})]})]})]}),v.jsxs("div",{style:{marginBottom:"16px"},children:[v.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px",fontSize:"0.8rem"},children:[v.jsx("span",{style:{color:"#94a3b8"},children:"Impacto VD (Sobrecarga)"}),v.jsxs("span",{style:{fontWeight:"bold",color:(t.rv_impact_index||0)>.5?"#f59e0b":"#94a3b8"},children:[Math.round((t.rv_impact_index||0)*100),"%"]})]}),v.jsx("div",{style:{height:"6px",width:"100%",background:"#334155",borderRadius:"3px",overflow:"hidden"},children:v.jsx("div",{style:{height:"100%",width:`${Math.min(100,(t.rv_impact_index||0)*100)}%`,background:"linear-gradient(90deg, #22c55e, #eab308, #ef4444)",borderRadius:"3px"}})})]}),v.jsxs("div",{style:{borderTop:"1px solid #334155",paddingTop:"12px"},children:[v.jsxs("div",{style:{fontSize:"0.8rem",color:"#94a3b8",marginBottom:"8px",display:"flex",justifyContent:"space-between"},children:[v.jsx("span",{children:" Objetivo Intervencin"}),M&&v.jsxs("span",{style:{color:"#a855f7",fontWeight:"bold"},children:["VOI #",M]})]}),M?t.voi_findings?.find(ne=>ne.id===M)?(()=>{const ne=t.voi_findings?.find(ye=>ye.id===M);return v.jsxs("div",{style:{background:"rgba(168, 85, 247, 0.1)",border:"1px solid rgba(168, 85, 247, 0.3)",borderRadius:"8px",padding:"10px"},children:[v.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[v.jsx("span",{style:{fontSize:"0.75rem",color:"#d8b4fe"},children:"Recuperacin Flujo (FAC):"}),v.jsxs("span",{style:{fontWeight:"bold",color:"#a855f7"},children:["+",ne?.predicted_recovery_fac?.toFixed(2)]})]}),v.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[v.jsx("span",{style:{fontSize:"0.75rem",color:"#d8b4fe"},children:"Volumen Trombo:"}),v.jsxs("span",{style:{fontWeight:"bold",color:"white"},children:[ne?.volume.toFixed(1)," ml"]})]}),v.jsx("div",{style:{marginTop:"8px",fontSize:"0.7rem",color:"#94a3b8",fontStyle:"italic"},children:"*Simulacin de Virtual Lysis aplicada."})]})})():null:v.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b",textAlign:"center",padding:"10px",border:"1px dashed #475569",borderRadius:"8px",cursor:"pointer"},onClick:()=>{if(t.primary_intervention_target){const ne=parseInt(t.primary_intervention_target);isNaN(ne)||N(ne)}},children:["Clic en una lesin para simular lisis",t.primary_intervention_target&&v.jsxs("div",{style:{marginTop:"4px",color:"#eab308",fontWeight:"bold"},children:["Sugerido: VOI #",t.primary_intervention_target]})]})]})]})]})},tH=({stats:i,modality:e,isLoading:t=!1})=>{const s=(()=>{switch(e){case"CT_TEP":case"CT_SMART":return"HU";case"MRI_DKI":return"";default:return""}})(),r=(a,l=2)=>a==null?"--":a.toFixed(l);return t?v.jsxs("div",{className:"clinical-card",children:[v.jsx("div",{className:"clinical-card-header",children:v.jsx("span",{children:" Estadsticas ROI"})}),v.jsx("div",{className:"clinical-card-body",children:v.jsxs("div",{style:{textAlign:"center",padding:"24px",color:"var(--ws-text-muted)"},children:[v.jsx("div",{className:"pipeline-stage-icon processing",style:{width:32,height:32,margin:"0 auto 8px",fontSize:"1rem"},children:""}),"Calculando estadsticas..."]})})]}):i?v.jsxs("div",{className:"clinical-card",children:[v.jsxs("div",{className:"clinical-card-header",children:[v.jsx("span",{children:" Estadsticas ROI"}),v.jsxs("span",{style:{fontSize:"0.65rem",color:"var(--ws-text-muted)",fontFamily:"var(--ws-font-mono)"},children:[i.voxel_count.toLocaleString()," voxels"]})]}),v.jsxs("div",{className:"clinical-card-body",children:[v.jsxs("div",{className:"stats-widget",children:[v.jsxs("div",{className:"stat-item",children:[v.jsxs("div",{className:"stat-value",children:[r(i.mean),s&&v.jsxs("span",{className:"stat-unit",children:[" ",s]})]}),v.jsx("div",{className:"stat-label",children:"Media"})]}),v.jsxs("div",{className:"stat-item",children:[v.jsxs("div",{className:"stat-value",children:["",r(i.std_dev),s&&v.jsxs("span",{className:"stat-unit",children:[" ",s]})]}),v.jsx("div",{className:"stat-label",children:"Desv. Est."})]}),v.jsxs("div",{className:"stat-item",children:[v.jsxs("div",{className:"stat-value",children:[r(i.min),s&&v.jsxs("span",{className:"stat-unit",children:[" ",s]})]}),v.jsx("div",{className:"stat-label",children:"Mnimo"})]}),v.jsxs("div",{className:"stat-item",children:[v.jsxs("div",{className:"stat-value",children:[r(i.max),s&&v.jsxs("span",{className:"stat-unit",children:[" ",s]})]}),v.jsx("div",{className:"stat-label",children:"Mximo"})]}),i.median!==void 0&&v.jsxs("div",{className:"stat-item",children:[v.jsxs("div",{className:"stat-value",children:[r(i.median),s&&v.jsxs("span",{className:"stat-unit",children:[" ",s]})]}),v.jsx("div",{className:"stat-label",children:"Mediana"})]}),i.volume_cm3!==void 0&&v.jsxs("div",{className:"stat-item",children:[v.jsxs("div",{className:"stat-value",children:[r(i.volume_cm3),v.jsx("span",{className:"stat-unit",children:" cm"})]}),v.jsx("div",{className:"stat-label",children:"Volumen"})]})]}),v.jsxs("div",{style:{marginTop:"var(--ws-space-md)"},children:[v.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.7rem",color:"var(--ws-text-muted)",marginBottom:"4px"},children:[v.jsxs("span",{children:[r(i.min)," ",s]}),v.jsx("span",{children:"Rango de valores"}),v.jsxs("span",{children:[r(i.max)," ",s]})]}),v.jsx("div",{style:{height:"8px",background:"linear-gradient(90deg, var(--ws-info), var(--ws-warning), var(--ws-error))",borderRadius:"4px",position:"relative"},children:v.jsx("div",{style:{position:"absolute",left:`${(i.mean-i.min)/(i.max-i.min)*100}%`,top:"-4px",width:"4px",height:"16px",background:"white",borderRadius:"2px",transform:"translateX(-50%)",boxShadow:"0 0 4px rgba(0,0,0,0.5)"}})})]})]})]}):v.jsxs("div",{className:"clinical-card",children:[v.jsx("div",{className:"clinical-card-header",children:v.jsx("span",{children:" Estadsticas ROI"})}),v.jsx("div",{className:"clinical-card-body",children:v.jsxs("div",{style:{textAlign:"center",padding:"24px",color:"var(--ws-text-muted)",fontSize:"0.875rem"},children:[v.jsx("span",{style:{fontSize:"2rem",display:"block",marginBottom:"8px"},children:""}),"Seleccione una regin de inters",v.jsx("br",{}),"para ver las estadsticas"]})})]})},U0=[{id:"INGESTION",label:"Ingesta",description:"Carga y extraccin de archivos DICOM",icon:""},{id:"CLASSIFICATION",label:"Clasificacin",description:"Deteccin automtica de modalidad y regin anatmica",icon:""},{id:"VALIDATION",label:"Validacin",description:"Verificacin de calidad y entropa de Shannon",icon:""},{id:"PREPROCESSING",label:"Preprocesamiento",description:"Denoising y correccin de movimiento",icon:""},{id:"CROPPING",label:"Recorte ROI",description:"Eliminacin de slices irrelevantes (20cm ROI)",icon:""},{id:"FILTERING",label:"Filtrado",description:"Aplicacin de filtro Laplaciano para realce de bordes",icon:""},{id:"TENSORIAL_CALCULATION",label:"Clculo Tensorial",description:"Ajuste DKI/DTI y clculo de Kurtosis",icon:""},{id:"SEGMENTATION",label:"Segmentacin",description:"Deteccin de estructuras y lesiones",icon:""},{id:"QUANTIFICATION",label:"Cuantificacin",description:"Clculo de volmenes y mtricas",icon:""},{id:"OUTPUT",label:"Salida",description:"Generacin de mapas NIfTI y reportes",icon:""},{id:"COMPLETED",label:"Completado",description:"Anlisis finalizado",icon:""},{id:"FAILED",label:"Error",description:"Procesamiento fallido",icon:""}],iH=[{parameter:"Densidad (HU)",unit:"HU",normalMin:250,normalMax:500,pathologicalMin:30,pathologicalMax:90,normalLabel:"Vaso con contraste",pathologicalLabel:"Defecto de llenado (Trombo)"},{parameter:"Kurtosis (MK)",unit:"",normalMin:.5,normalMax:1.5,pathologicalMin:3,pathologicalMax:10,normalLabel:"Fluido homogneo",pathologicalLabel:"Alta (Solidez del trombo)"}],nH=[{parameter:"Densidad (HU)",unit:"HU",normalMin:25,normalMax:40,pathologicalMin:0,pathologicalMax:20,normalLabel:"Corteza sana",pathologicalLabel:"Prdida de diferenciacin"}],sH=[{parameter:"Kurtosis (MK)",unit:"",normalMin:.8,normalMax:1.2,pathologicalMin:1.5,pathologicalMax:3,normalLabel:"Valores basales de tejido",pathologicalLabel:"Aumento significativo (Zona de infarto)"}],rH=({modality:i,results:e,currentValues:t={}})=>{const n=()=>{switch(i){case"CT_TEP":return iH;case"CT_SMART":return nH;case"MRI_DKI":return sH;default:return[]}},s=()=>{const h={...t};return e&&(e.mean_thrombus_kurtosis!==void 0&&(h["Kurtosis (MK)"]=e.mean_thrombus_kurtosis),e.total_obstruction_pct!==void 0&&(h["Obstruccin Total (%)"]=e.total_obstruction_pct),e.penumbra_volume!==void 0&&(h["Vol. Penumbra (cm)"]=e.penumbra_volume),e.core_volume!==void 0&&(h["Vol. Core (cm)"]=e.core_volume)),h},r=(h,d)=>h==null?"unknown":h>=d.normalMin&&h<=d.normalMax?"normal":h>=d.pathologicalMin&&h<=d.pathologicalMax?"pathological":"warning",a=n(),l=s(),c=a.map(h=>{const d=l[h.parameter]??null;return{parameter:h.parameter,unit:h.unit,current:d,reference:h,status:r(d,h)}});return a.length===0?v.jsxs("div",{className:"clinical-card",children:[v.jsx("div",{className:"clinical-card-header",children:v.jsx("span",{children:" Valores de Referencia"})}),v.jsx("div",{className:"clinical-card-body",children:v.jsx("div",{style:{textAlign:"center",padding:"16px",color:"var(--ws-text-muted)",fontSize:"0.875rem"},children:"No hay valores de referencia disponibles para esta modalidad"})})]}):v.jsxs("div",{className:"clinical-card",children:[v.jsxs("div",{className:"clinical-card-header",children:[v.jsx("span",{children:" Comparacin con Referencias"}),v.jsx("span",{style:{fontSize:"0.65rem",padding:"2px 6px",background:"var(--ws-bg-primary)",borderRadius:"4px"},children:"Hoja de Trucos"})]}),v.jsxs("div",{className:"clinical-card-body",style:{padding:0},children:[v.jsxs("table",{className:"reference-table",children:[v.jsx("thead",{children:v.jsxs("tr",{children:[v.jsx("th",{children:"Parmetro"}),v.jsx("th",{children:"Actual"}),v.jsx("th",{children:"Normal"}),v.jsx("th",{children:"Patolgico"})]})}),v.jsx("tbody",{children:c.map((h,d)=>v.jsxs("tr",{children:[v.jsx("td",{style:{fontWeight:500},children:h.parameter}),v.jsx("td",{children:v.jsxs("div",{className:"reference-value",children:[v.jsx("span",{className:`reference-indicator ${h.status}`}),v.jsx("span",{className:`current-value ${h.status==="normal"?"in-range":h.status==="pathological"?"out-of-range":""}`,children:h.current!==null?`${h.current.toFixed(2)} ${h.unit}`:"--"})]})}),v.jsxs("td",{style:{color:"var(--ws-success)",fontSize:"0.7rem"},children:[h.reference.normalMin,"-",h.reference.normalMax," ",h.unit,v.jsx("div",{style:{color:"var(--ws-text-muted)",marginTop:"2px"},children:h.reference.normalLabel})]}),v.jsxs("td",{style:{color:"var(--ws-error)",fontSize:"0.7rem"},children:[h.reference.pathologicalMin,"-",h.reference.pathologicalMax," ",h.unit,v.jsx("div",{style:{color:"var(--ws-text-muted)",marginTop:"2px"},children:h.reference.pathologicalLabel})]})]},d))})]}),v.jsxs("div",{style:{display:"flex",gap:"16px",padding:"8px 12px",borderTop:"1px solid var(--ws-border)",fontSize:"0.7rem",color:"var(--ws-text-muted)"},children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[v.jsx("span",{className:"reference-indicator normal"}),"Normal"]}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[v.jsx("span",{className:"reference-indicator warning"}),"Lmite"]}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[v.jsx("span",{className:"reference-indicator pathological"}),"Patolgico"]})]})]})]})},aH=({modality:i,results:e,onExport:t})=>{const n=V.useMemo(()=>{if(!e)return null;switch(i){case"CT_TEP":return oH(e);case"CT_SMART":return lH(e);case"MRI_DKI":return cH(e);default:return null}},[i,e]);return n?v.jsxs("div",{className:"clinical-card",children:[v.jsxs("div",{className:"clinical-card-header",children:[v.jsx("span",{children:" Conclusin Automtica"}),v.jsxs("span",{style:{fontSize:"0.65rem",color:"var(--ws-text-muted)"},children:["Confianza: ",Math.round(n.confidence*100),"%"]})]}),v.jsxs("div",{className:"clinical-card-body",style:{padding:0},children:[v.jsxs("div",{className:`auto-conclusion ${n.severity}`,children:[v.jsxs("div",{className:"conclusion-header",children:[v.jsx("span",{style:{fontSize:"0.75rem",color:"var(--ws-text-muted)"},children:"Severidad:"}),v.jsxs("span",{className:`conclusion-severity ${n.severity}`,children:[uH(n.severity)," ",a2(n.severity)]})]}),v.jsx("p",{className:"conclusion-summary",children:n.summary}),n.findings.length>0&&v.jsxs(v.Fragment,{children:[v.jsx("div",{style:{fontSize:"0.7rem",color:"var(--ws-text-muted)",marginBottom:"4px",textTransform:"uppercase"},children:"Hallazgos:"}),v.jsx("ul",{className:"conclusion-findings",children:n.findings.map((s,r)=>v.jsx("li",{children:s},r))})]}),n.recommendations.length>0&&v.jsxs("div",{style:{marginTop:"12px"},children:[v.jsx("div",{style:{fontSize:"0.7rem",color:"var(--ws-text-muted)",marginBottom:"4px",textTransform:"uppercase"},children:"Recomendaciones:"}),v.jsx("ul",{className:"conclusion-findings",style:{background:"rgba(59, 130, 246, 0.1)",padding:"8px 8px 8px 24px",borderRadius:"4px",margin:0},children:n.recommendations.map((s,r)=>v.jsx("li",{style:{color:"var(--ws-info)"},children:s},r))})]})]}),v.jsx("div",{style:{padding:"8px 12px",borderTop:"1px solid var(--ws-border)"},children:v.jsx("button",{onClick:()=>t?.(n),style:{width:"100%",padding:"8px",background:"var(--ws-bg-tertiary)",border:"1px solid var(--ws-border)",borderRadius:"4px",color:"var(--ws-text-primary)",fontSize:"0.8rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:" Copiar al Portapapeles"})})]})]}):v.jsxs("div",{className:"clinical-card",children:[v.jsx("div",{className:"clinical-card-header",children:v.jsx("span",{children:" Conclusin Automtica"})}),v.jsx("div",{className:"clinical-card-body",children:v.jsxs("div",{style:{textAlign:"center",padding:"16px",color:"var(--ws-text-muted)",fontSize:"0.875rem"},children:[v.jsx("span",{style:{fontSize:"1.5rem",display:"block",marginBottom:"8px"},children:""}),"Esperando resultados del anlisis",v.jsx("br",{}),"para generar conclusin automtica"]})})]})};function oH(i){const e=[],t=[];let n="normal";const r=i.total_obstruction_pct??0,a=i.total_clot_volume??0,l=i.clot_count??0,c=i.qanadli_score??0;r>=50?(n="critical",e.push(`Obstruccin severa del rbol arterial pulmonar (${r.toFixed(1)}%)`),t.push("Considerar trombolisis o trombectoma urgente"),t.push("Monitorizacin en UCI")):r>=30?(n="severe",e.push(`Obstruccin moderada-severa (${r.toFixed(1)}%)`),t.push("Anticoagulacin inmediata"),t.push("Evaluar necesidad de trombolisis")):r>=10?(n="moderate",e.push(`Obstruccin moderada (${r.toFixed(1)}%)`),t.push("Iniciar anticoagulacin")):r>0?(n="mild",e.push(`Obstruccin leve (${r.toFixed(1)}%)`),t.push("Tratamiento anticoagulante ambulatorio")):(e.push("No se evidencia defecto de llenado sugestivo de TEP"),t.push("Considerar diagnsticos alternativos")),l>0&&(e.push(`${l} defecto(s) de llenado identificado(s)`),e.push(`Volumen total de trombo: ${a.toFixed(2)} cm`)),c>0&&e.push(`ndice de Qanadli: ${c.toFixed(1)}%`),i.main_pa_obstruction_pct&&i.main_pa_obstruction_pct>0&&e.push(`Afectacin de arteria pulmonar principal: ${i.main_pa_obstruction_pct.toFixed(1)}%`);const h=n==="normal"?"Estudio de angiotomografa pulmonar sin evidencia de tromboembolismo pulmonar.":`Hallazgos compatibles con tromboembolismo pulmonar ${a2(n).toLowerCase()}.`;return{severity:n,summary:h,findings:e,recommendations:t,confidence:.8}}function lH(i){const e=[],t=[];let n="normal";const r=i.penumbra_volume??0,a=i.core_volume??0,l=a>0?r/a:0;a>70?(n="critical",e.push(`Core isqumico extenso (${a.toFixed(1)} cm)`),t.push("Pronstico reservado"),t.push("Evaluar cuidados paliativos")):a>30?(n="severe",e.push(`Core isqumico significativo (${a.toFixed(1)} cm)`),r>15&&l>1.8&&(e.push(`Penumbra rescatable (${r.toFixed(1)} cm, ratio ${l.toFixed(1)})`),t.push("Candidato potencial a trombectoma mecnica"))):a>10?(n="moderate",e.push(`Core isqumico moderado (${a.toFixed(1)} cm)`),r>10&&(e.push(`Tejido en penumbra: ${r.toFixed(1)} cm`),t.push("Evaluar reperfusin urgente"))):a>0||r>0?(n="mild",e.push("Isquemia de pequeo volumen detectada"),a>0&&e.push(`Core: ${a.toFixed(1)} cm`),r>0&&e.push(`Penumbra: ${r.toFixed(1)} cm`),t.push("Tratamiento mdico conservador")):(e.push("No se detectan reas de isquemia significativa"),t.push("Correlacionar con clnica"));const c=n==="normal"?"TC de crneo sin evidencia de lesin isqumica aguda significativa.":`Hallazgos compatibles con isquemia cerebral ${a2(n).toLowerCase()}.`;return{severity:n,summary:c,findings:e,recommendations:t,confidence:.75}}function cH(i){const e=[],t=[],n="normal";return e.push("Anlisis de difusin kurtosis completado"),e.push("Mapas MK, FA y MD generados"),i.mk_map&&e.push("Mapa de Kurtosis Media disponible para revisin"),i.fa_map&&e.push("Mapa de Anisotropa Fraccional disponible"),t.push("Revisar mapas paramtricos"),t.push("Correlacionar con imgenes estructurales"),{severity:n,summary:"Anlisis tensorial de difusin completado. Se recomienda revisin de los mapas paramtricos generados.",findings:e,recommendations:t,confidence:.7}}function a2(i){return{normal:"Normal",mild:"Leve",moderate:"Moderado",severe:"Severo",critical:"Crtico"}[i]||i}function uH(i){return{normal:"",mild:"",moderate:"",severe:"",critical:""}[i]||""}const hH=({currentStage:i,status:e,progress:t,logs:n=[],onStageClick:s})=>{const[r,a]=V.useState(new Set),[l,c]=V.useState(!1),h=S=>{a(C=>{const E=new Set(C);return E.has(S)?E.delete(S):E.add(S),E})},d=()=>{const S=new Set(U0.map(C=>C.id));a(S)},f=()=>{a(new Set)},p=V.useMemo(()=>{const S=U0.findIndex(D=>D.id===i),C=e==="FAILED",E=e==="COMPLETED"||i==="COMPLETED";return U0.filter(D=>D.id!=="FAILED").map((D,M)=>{let N;C&&D.id===i?N="failed":E||M<S?N="completed":D.id===i?N="processing":N="pending";const I=n.filter(F=>{const B=F.stage.toUpperCase().replace(/\s+/g,"_"),P=D.id.toUpperCase(),O=D.label.toUpperCase().replace(/\s+/g,"_");return B===P||B===O||B.includes(P)||P.includes(B)||F.stage.toLowerCase()==="pipeline"});let _;if(I.length>=2){const F=new Date(I[0].timestamp),P=new Date(I[I.length-1].timestamp).getTime()-F.getTime();P>0&&(_=fH(P))}return{...D,status:N,logs:I,duration:_}})},[i,e,n]),g=p.filter(S=>S.status==="completed").length,y=p.filter(S=>S.id!=="COMPLETED").length,x=n.length,b=(S=!1)=>v.jsxs(v.Fragment,{children:[v.jsx("div",{className:"pipeline-progress",children:v.jsx("div",{className:"pipeline-progress-fill",style:{width:`${t}%`,background:e==="FAILED"?"var(--ws-error)":e==="COMPLETED"?"var(--ws-success)":"var(--ws-processing)"}})}),v.jsxs("div",{className:"clinical-card-body",style:{padding:"var(--ws-space-sm)",overflowY:S?"auto":void 0,maxHeight:S?"calc(80vh - 120px)":void 0},children:[v.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"var(--ws-space-sm)",fontSize:"0.7rem"},children:[v.jsx("button",{onClick:d,className:"pipeline-btn",children:" Expandir"}),v.jsx("button",{onClick:f,className:"pipeline-btn",children:" Colapsar"}),v.jsxs("span",{style:{marginLeft:"auto",color:"var(--ws-text-muted)",alignSelf:"center"},children:[x," logs"]})]}),v.jsx("div",{className:"pipeline-inspector",children:p.map(C=>{const E=r.has(C.id),D=C.logs.length>0;return v.jsxs("div",{className:`pipeline-stage ${E?"expanded":""}`,children:[v.jsxs("div",{className:"pipeline-stage-header",onClick:()=>{D&&h(C.id),s?.(C.id)},style:{cursor:D?"pointer":"default"},children:[v.jsx("div",{className:`pipeline-stage-icon ${C.status}`,children:C.status==="processing"?"":C.status==="completed"?"":C.status==="failed"?"":C.icon}),v.jsxs("div",{className:"pipeline-stage-info",children:[v.jsx("div",{className:"pipeline-stage-name",children:C.label}),v.jsxs("div",{className:"pipeline-stage-status",children:[C.status==="processing"&&"En progreso...",C.status==="completed"&&(C.duration||"Completado"),C.status==="failed"&&"Error",C.status==="pending"&&"Pendiente",D&&` (${C.logs.length} logs)`]})]}),D&&v.jsx("div",{className:"pipeline-stage-chevron",style:{transform:E?"rotate(90deg)":"none",transition:"transform 0.2s"},children:v.jsx(dH,{})})]}),E&&D&&v.jsx("div",{className:"pipeline-stage-content",style:{maxHeight:S?"none":"200px",overflowY:S?"visible":"auto"},children:C.logs.map((M,N)=>v.jsxs("div",{className:`pipeline-log ${M.level.toLowerCase()}`,children:[v.jsx("span",{className:"pipeline-log-time",children:Hw(M.timestamp)}),v.jsx("span",{className:`pipeline-log-level level-${M.level.toLowerCase()}`,children:M.level}),v.jsx("span",{className:"pipeline-log-message",children:M.message}),M.metadata&&v.jsxs("details",{style:{marginTop:"4px",fontSize:"0.7rem",color:"var(--ws-text-muted)"},children:[v.jsx("summary",{style:{cursor:"pointer"},children:"Metadata"}),v.jsx("pre",{style:{margin:"4px 0",padding:"8px",background:"var(--ws-bg-primary)",borderRadius:"4px",overflow:"auto",maxHeight:S?"300px":"150px"},children:JSON.stringify(M.metadata,null,2)})]})]},N))})]},C.id)})}),S&&v.jsxs("div",{style:{marginTop:"var(--ws-space-md)"},children:[v.jsxs("h4",{style:{fontSize:"0.8rem",color:"var(--ws-text-secondary)",marginBottom:"8px",borderBottom:"1px solid var(--ws-border)",paddingBottom:"8px"},children:[" Todos los logs (",x,")"]}),v.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",background:"var(--ws-bg-primary)",borderRadius:"8px",padding:"8px"},children:n.map((C,E)=>v.jsxs("div",{className:`pipeline-log ${C.level.toLowerCase()}`,style:{borderBottom:"1px solid var(--ws-border)"},children:[v.jsx("span",{className:"pipeline-log-time",children:Hw(C.timestamp)}),v.jsxs("span",{className:`pipeline-log-level level-${C.level.toLowerCase()}`,children:["[",C.stage,"]"]}),v.jsx("span",{className:"pipeline-log-message",children:C.message}),C.metadata&&v.jsxs("details",{style:{marginTop:"4px",fontSize:"0.7rem",color:"var(--ws-text-muted)"},children:[v.jsx("summary",{style:{cursor:"pointer"},children:"Metadata"}),v.jsx("pre",{style:{margin:"4px 0",padding:"8px",background:"var(--ws-bg-secondary)",borderRadius:"4px",overflow:"auto"},children:JSON.stringify(C.metadata,null,2)})]})]},E))})]}),v.jsxs("div",{style:{marginTop:"var(--ws-space-sm)",padding:"var(--ws-space-sm)",borderRadius:"var(--ws-radius-sm)",background:e==="FAILED"?"rgba(239, 68, 68, 0.1)":e==="COMPLETED"?"rgba(34, 197, 94, 0.1)":"var(--ws-bg-tertiary)",fontSize:"0.75rem",color:"var(--ws-text-secondary)",display:"flex",alignItems:"center",gap:"8px"},children:[v.jsx("span",{style:{color:e==="FAILED"?"var(--ws-error)":e==="COMPLETED"?"var(--ws-success)":"var(--ws-processing)"},children:e==="FAILED"?"":e==="COMPLETED"?"":""}),v.jsxs("span",{children:[e==="FAILED"&&"Procesamiento fallido",e==="COMPLETED"&&"Anlisis completado exitosamente",e==="PROCESSING"&&`Procesando: ${t.toFixed(0)}%`,e==="UPLOADED"&&"Esperando inicio de procesamiento",e==="CLASSIFYING"&&"Clasificando modalidad...",e==="VALIDATING"&&"Validando datos de entrada...",e==="PREPROCESSING"&&"Preprocesando imgenes..."]})]})]})]}),w=async()=>{const S=n.map(E=>{let D=`[${E.timestamp}] [${E.level}] [${E.stage}] ${E.message}`;return E.metadata&&(D+=`
  METADATA: ${JSON.stringify(E.metadata,null,2).split(`
`).join(`
  `)}`),D}).join(`

`),C=`

PIPELINE LOGS REPORT
Generated: ${new Date().toISOString()}
Status: ${e}
Current Stage: ${i}
Progress: ${t}%
Total Logs: ${n.length}


${S}


END OF REPORT

`.trim();try{await navigator.clipboard.writeText(C),alert(" Logs copiados al portapapeles")}catch(E){console.error("Error copying logs:",E);const D=document.createElement("textarea");D.value=C,document.body.appendChild(D),D.select(),document.execCommand("copy"),document.body.removeChild(D),alert(" Logs copiados al portapapeles")}};return v.jsxs(v.Fragment,{children:[v.jsxs("div",{className:"clinical-card pipeline-card",children:[v.jsxs("div",{className:"clinical-card-header",children:[v.jsx("span",{children:" Inspector de Pipeline"}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[v.jsxs("span",{style:{fontSize:"0.7rem",color:"var(--ws-text-muted)",fontFamily:"var(--ws-font-mono)"},children:[g,"/",y]}),v.jsx("button",{onClick:w,className:"pipeline-btn",title:"Copiar todos los logs",children:""}),v.jsx("button",{onClick:()=>c(!0),className:"pipeline-btn",title:"Ver en pantalla completa",children:""})]})]}),b(!1)]}),l&&v.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.85)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"40px"},onClick:S=>{S.target===S.currentTarget&&c(!1)},children:v.jsxs("div",{style:{background:"var(--ws-bg-secondary)",borderRadius:"12px",width:"90vw",maxWidth:"1200px",maxHeight:"90vh",overflow:"hidden",display:"flex",flexDirection:"column",border:"1px solid var(--ws-border)"},children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",background:"var(--ws-bg-tertiary)",borderBottom:"1px solid var(--ws-border)"},children:[v.jsx("h2",{style:{margin:0,fontSize:"1.1rem",color:"var(--ws-text-primary)",display:"flex",alignItems:"center",gap:"8px"},children:" Inspector de Pipeline - Vista Completa"}),v.jsx("button",{onClick:()=>c(!1),style:{padding:"8px 16px",background:"var(--ws-bg-primary)",border:"1px solid var(--ws-border)",borderRadius:"6px",color:"var(--ws-text-primary)",cursor:"pointer",fontSize:"0.875rem"},children:" Cerrar"})]}),v.jsx("div",{style:{flex:1,overflow:"auto",padding:"16px"},children:b(!0)})]})})]})},dH=()=>v.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:v.jsx("polyline",{points:"6 4 10 8 6 12"})});function Hw(i){try{return new Date(i).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return"--:--:--"}}function fH(i){if(i<1e3)return`${i}ms`;if(i<6e4)return`${(i/1e3).toFixed(1)}s`;const e=Math.floor(i/6e4),t=Math.floor(i%6e4/1e3);return`${e}m ${t}s`}const mH=()=>{const{studyId:i}=Wd(),e=bn(),[t,n]=V.useState(!0),{data:s,isLoading:r,error:a,refetch:l}=lf(i,{skip:!i,pollingInterval:t?2e3:0});qd.useEffect(()=>{if(s){const b=s.status,w=b==="PROCESSING"||b==="CLASSIFYING"||b==="PREPROCESSING"||b==="VALIDATING"||b==="UPLOADED";n(w),console.log(w?`[Polling] Study ${i} status: ${b} - polling active`:`[Polling] Study ${i} status: ${b} - polling stopped`)}},[s,i]);const[c]=V.useState(),h=V.useCallback(b=>{},[]),d=s?{id:s.patient_id}:void 0,f=()=>{if(!s)return{region:"UNKNOWN",pathology:"UNKNOWN"};switch(s.detected_modality||s.modality){case"CT_TEP":return{region:"THORAX",pathology:"TEP"};case"CT_SMART":return{region:"BRAIN",pathology:"ISCHEMIA"};case"MRI_DKI":return{region:"BRAIN",pathology:"DIFFUSION"};default:{const w=s.classification_details?.body_part?.toUpperCase();return w?.includes("THORAX")||w?.includes("CHEST")?{region:"THORAX",pathology:"TEP"}:w?.includes("HEAD")||w?.includes("BRAIN")?{region:"BRAIN",pathology:"ISCHEMIA"}:{region:"UNKNOWN",pathology:"UNKNOWN"}}}},{region:p,pathology:g}=f(),y=V.useCallback(async b=>{const w=`
CONCLUSIN RADIOLGICA

Severidad: ${b.severity.toUpperCase()}
Confianza: ${Math.round(b.confidence*100)}%

${b.summary}

HALLAZGOS:
${b.findings.map(S=>` ${S}`).join(`
`)}

RECOMENDACIONES:
${b.recommendations.map(S=>` ${S}`).join(`
`)}

---
Generado automticamente por Radiomic Tensorial Workstation
    `.trim();try{await navigator.clipboard.writeText(w),alert("Conclusin copiada al portapapeles")}catch(S){console.error("Error al copiar:",S)}},[]);if(r)return v.jsx("div",{className:"workstation",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:v.jsxs("div",{style:{textAlign:"center",color:"var(--ws-text-secondary)"},children:[v.jsx("div",{className:"pipeline-stage-icon processing",style:{width:64,height:64,fontSize:"2rem",margin:"0 auto 16px"},children:""}),v.jsx("div",{children:"Cargando estudio..."})]})});if(a||!s)return v.jsx("div",{className:"workstation",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:v.jsxs("div",{style:{textAlign:"center",color:"var(--ws-error)"},children:[v.jsx("div",{style:{fontSize:"3rem",marginBottom:"16px"},children:""}),v.jsx("div",{style:{marginBottom:"16px"},children:"Error al cargar el estudio"}),v.jsx("button",{onClick:()=>e("/studies"),style:{padding:"8px 16px",background:"var(--ws-bg-tertiary)",border:"1px solid var(--ws-border)",borderRadius:"6px",color:"var(--ws-text-primary)",cursor:"pointer"},children:"Volver a la lista"})]})});const x=s.detected_modality||s.modality;return v.jsxs("div",{className:"workstation",children:[v.jsxs("header",{className:"workstation-header",children:[v.jsxs("div",{className:"workstation-logo",children:[v.jsx(pH,{}),v.jsx("span",{children:"Radiomic Tensorial Workstation"})]}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[v.jsxs("span",{className:"workstation-title",children:["Estudio: ",String(s.id).substring(0,8)]}),v.jsx("button",{onClick:()=>e("/studies"),style:{padding:"6px 12px",background:"var(--ws-bg-tertiary)",border:"1px solid var(--ws-border)",borderRadius:"4px",color:"var(--ws-text-secondary)",fontSize:"0.8rem",cursor:"pointer"},children:" Lista de Estudios"})]})]}),v.jsxs("aside",{className:"clinical-panel",children:[v.jsx(p9,{study:s,patientInfo:d}),v.jsx(g9,{modality:s.modality,detectedModality:s.detected_modality,classificationConfidence:s.classification_confidence,classificationDetails:s.classification_details}),v.jsx(v9,{modality:x,bodyRegion:p,pathologyType:g,onContextChange:h}),v.jsx(hH,{currentStage:s.pipeline_stage,status:s.status,progress:s.pipeline_progress,logs:s.logs})]}),v.jsx("main",{className:"diagnostic-area",children:v.jsx(eH,{studyId:String(s.id),modality:x,results:s.results||s.processing_result,slicesMeta:(s.results||s.processing_result)?.slices_meta,findingsPins:(s.results||s.processing_result)?.findings_pins})}),v.jsxs("aside",{className:"control-panel",children:[v.jsx(tH,{stats:c,modality:x}),v.jsx(rH,{modality:x,results:s.results||s.processing_result}),v.jsx(aH,{modality:x,results:s.results||s.processing_result,onExport:y}),v.jsxs("div",{className:"clinical-card",children:[v.jsx("div",{className:"clinical-card-header",children:v.jsx("span",{children:" Acciones"})}),v.jsx("div",{className:"clinical-card-body",children:v.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[v.jsx("button",{onClick:()=>l(),style:{padding:"10px",background:"var(--ws-bg-tertiary)",border:"1px solid var(--ws-border)",borderRadius:"6px",color:"var(--ws-text-primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:" Actualizar Estado"}),(s.results?.audit_report||s.processing_result?.audit_report)&&v.jsx("a",{href:`http://localhost:8000/api/studies/${s.id}/audit-report/`,target:"_blank",rel:"noopener noreferrer",style:{padding:"10px",background:"var(--ws-info)",border:"none",borderRadius:"6px",color:"white",textDecoration:"none",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:" Descargar Audit PDF"}),s.status==="FAILED"&&v.jsx("button",{onClick:()=>{},style:{padding:"10px",background:"var(--ws-warning)",border:"none",borderRadius:"6px",color:"black",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:" Reintentar Procesamiento"})]})})]})]})]})},pH=()=>v.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[v.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1"}),v.jsx("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1"}),v.jsx("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1"}),v.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1"}),v.jsx("line",{x1:"10",y1:"6.5",x2:"14",y2:"6.5"}),v.jsx("line",{x1:"6.5",y1:"10",x2:"6.5",y2:"14"}),v.jsx("line",{x1:"10",y1:"17.5",x2:"14",y2:"17.5"}),v.jsx("line",{x1:"17.5",y1:"10",x2:"17.5",y2:"14"})]}),gH=()=>{const i=bn(),[e]=cf(),[t]=Wo(),[n,s]=V.useState({files:[],isDragging:!1,uploadProgress:0,isUploading:!1,error:null}),[r,a]=V.useState("AUTO"),[l,c]=V.useState(""),[h,d]=V.useState(new Date().toISOString().split("T")[0]),f=V.useCallback(w=>{const C=Array.from(w).filter(E=>E.name.toLowerCase().endsWith(".dcm")||E.name.toLowerCase().endsWith(".dicom")||E.type==="application/dicom"||!E.name.includes("."));if(C.length===0){s(E=>({...E,error:"No se encontraron archivos DICOM vlidos"}));return}s(E=>({...E,files:[...E.files,...C],error:null}))},[]),p=V.useCallback(w=>{w.preventDefault(),s(S=>({...S,isDragging:!0}))},[]),g=V.useCallback(w=>{w.preventDefault(),s(S=>({...S,isDragging:!1}))},[]),y=V.useCallback(w=>{if(w.preventDefault(),s(S=>({...S,isDragging:!1})),w.dataTransfer.items){const S=[];for(let C=0;C<w.dataTransfer.items.length;C++){const E=w.dataTransfer.items[C];if(E.kind==="file"){const D=E.getAsFile();D&&S.push(D)}}f(S)}else f(w.dataTransfer.files)},[f]),x=V.useCallback(()=>{s(w=>({...w,files:[],error:null}))},[]),b=async()=>{if(n.files.length===0){s(w=>({...w,error:"Seleccione archivos DICOM para subir"}));return}s(w=>({...w,isUploading:!0,error:null,uploadProgress:0}));try{const w=new FormData;n.files.forEach(C=>{w.append("dicom_files",C)}),w.append("modality",r),w.append("patient_id",l||"ANON"),w.append("study_date",h),s(C=>({...C,uploadProgress:30}));const S=await e(w).unwrap();s(C=>({...C,uploadProgress:60})),await t(S.id).unwrap(),s(C=>({...C,uploadProgress:100})),setTimeout(()=>{i(`/workstation/${S.id}`)},500)}catch(w){const S=w;s(C=>({...C,error:S?.data?.message||S?.message||"Error al subir el estudio",isUploading:!1}))}};return v.jsxs("div",{style:{minHeight:"100vh",background:"var(--ws-bg-primary)",color:"var(--ws-text-primary)",fontFamily:"var(--ws-font-sans)",padding:"40px"},children:[v.jsx("style",{children:`
        :root {
          --ws-bg-primary: #0f172a;
          --ws-bg-secondary: #1e293b;
          --ws-bg-tertiary: #334155;
          --ws-text-primary: #f8fafc;
          --ws-text-secondary: #94a3b8;
          --ws-text-muted: #64748b;
          --ws-text-accent: #38bdf8;
          --ws-border: #334155;
          --ws-success: #22c55e;
          --ws-error: #ef4444;
          --ws-processing: #8b5cf6;
          --ws-font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
          --ws-font-mono: 'JetBrains Mono', monospace;
        }
      `}),v.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto"},children:[v.jsxs("div",{style:{textAlign:"center",marginBottom:"40px"},children:[v.jsx("h1",{style:{fontSize:"2rem",fontWeight:700,color:"var(--ws-text-accent)",marginBottom:"8px"},children:" Cargar Estudio DICOM"}),v.jsx("p",{style:{color:"var(--ws-text-secondary)"},children:"El sistema detectar automticamente la modalidad y regin anatmica"})]}),v.jsxs("div",{onDragOver:p,onDragLeave:g,onDrop:y,style:{border:`2px dashed ${n.isDragging?"var(--ws-text-accent)":"var(--ws-border)"}`,borderRadius:"12px",padding:"48px",textAlign:"center",background:n.isDragging?"rgba(56, 189, 248, 0.1)":"var(--ws-bg-secondary)",transition:"all 0.2s ease",marginBottom:"24px"},children:[v.jsx("div",{style:{fontSize:"4rem",marginBottom:"16px"},children:n.isDragging?"":""}),v.jsx("p",{style:{fontSize:"1.125rem",color:"var(--ws-text-primary)",marginBottom:"8px"},children:"Arrastre archivos DICOM aqu"}),v.jsx("p",{style:{color:"var(--ws-text-muted)",marginBottom:"16px"},children:"o"}),v.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[v.jsxs("label",{style:{display:"inline-block",padding:"12px 24px",background:"var(--ws-text-accent)",color:"var(--ws-bg-primary)",borderRadius:"8px",cursor:"pointer",fontWeight:600},children:[" Archivos",v.jsx("input",{type:"file",multiple:!0,style:{display:"none"},onChange:w=>w.target.files&&f(w.target.files)})]}),v.jsxs("label",{style:{display:"inline-block",padding:"12px 24px",background:"var(--ws-bg-tertiary)",border:"1px solid var(--ws-text-accent)",color:"var(--ws-text-accent)",borderRadius:"8px",cursor:"pointer",fontWeight:600},children:[" Carpeta",v.jsx("input",{type:"file",webkitdirectory:"",directory:"",multiple:!0,style:{display:"none"},onChange:w=>w.target.files&&f(w.target.files)})]})]})]}),n.files.length>0&&v.jsxs("div",{style:{background:"var(--ws-bg-secondary)",borderRadius:"12px",padding:"16px",marginBottom:"24px"},children:[v.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[v.jsxs("span",{style:{fontWeight:600},children:[" ",n.files.length," archivo(s) seleccionado(s)"]}),v.jsx("button",{onClick:x,style:{background:"transparent",border:"none",color:"var(--ws-error)",cursor:"pointer",fontSize:"0.875rem"},children:"Limpiar"})]}),v.jsxs("div",{style:{maxHeight:"150px",overflowY:"auto",fontSize:"0.875rem",color:"var(--ws-text-secondary)"},children:[n.files.slice(0,10).map((w,S)=>v.jsx("div",{style:{padding:"4px 0"},children:w.name},S)),n.files.length>10&&v.jsxs("div",{style:{color:"var(--ws-text-muted)",padding:"4px 0"},children:["... y ",n.files.length-10," archivo(s) ms"]})]})]}),v.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px",marginBottom:"24px"},children:[v.jsxs("div",{children:[v.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.875rem",color:"var(--ws-text-secondary)"},children:"Modalidad"}),v.jsxs("select",{value:r,onChange:w=>a(w.target.value),style:{width:"100%",padding:"12px",background:"var(--ws-bg-tertiary)",border:"1px solid var(--ws-border)",borderRadius:"8px",color:"var(--ws-text-primary)",fontSize:"0.875rem"},children:[v.jsx("option",{value:"AUTO",children:" Auto-detectar"}),v.jsx("option",{value:"MRI_DKI",children:" MRI DKI"}),v.jsx("option",{value:"CT_SMART",children:" CT Isquemia"}),v.jsx("option",{value:"CT_TEP",children:" CT TEP"})]})]}),v.jsxs("div",{children:[v.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.875rem",color:"var(--ws-text-secondary)"},children:"ID Paciente"}),v.jsx("input",{type:"text",value:l,onChange:w=>c(w.target.value),placeholder:"Automtico de DICOM",style:{width:"100%",padding:"12px",background:"var(--ws-bg-tertiary)",border:"1px solid var(--ws-border)",borderRadius:"8px",color:"var(--ws-text-primary)",fontSize:"0.875rem"}})]}),v.jsxs("div",{children:[v.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.875rem",color:"var(--ws-text-secondary)"},children:"Fecha de Estudio"}),v.jsx("input",{type:"date",value:h,onChange:w=>d(w.target.value),style:{width:"100%",padding:"12px",background:"var(--ws-bg-tertiary)",border:"1px solid var(--ws-border)",borderRadius:"8px",color:"var(--ws-text-primary)",fontSize:"0.875rem"}})]})]}),n.error&&v.jsxs("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid var(--ws-error)",borderRadius:"8px",padding:"12px 16px",marginBottom:"24px",color:"var(--ws-error)",display:"flex",alignItems:"center",gap:"8px"},children:[" ",n.error]}),n.isUploading&&v.jsxs("div",{style:{marginBottom:"24px"},children:[v.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px",fontSize:"0.875rem"},children:[v.jsx("span",{children:"Procesando..."}),v.jsxs("span",{children:[n.uploadProgress,"%"]})]}),v.jsx("div",{style:{height:"8px",background:"var(--ws-bg-tertiary)",borderRadius:"4px",overflow:"hidden"},children:v.jsx("div",{style:{height:"100%",width:`${n.uploadProgress}%`,background:"var(--ws-processing)",transition:"width 0.3s ease"}})})]}),v.jsx("button",{onClick:b,disabled:n.files.length===0||n.isUploading,style:{width:"100%",padding:"16px",background:n.files.length===0||n.isUploading?"var(--ws-bg-tertiary)":"var(--ws-success)",border:"none",borderRadius:"8px",color:n.files.length===0||n.isUploading?"var(--ws-text-muted)":"white",fontSize:"1rem",fontWeight:600,cursor:n.files.length===0||n.isUploading?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:n.isUploading?v.jsx(v.Fragment,{children:" Procesando..."}):v.jsx(v.Fragment,{children:" Iniciar Anlisis"})}),v.jsxs("div",{style:{marginTop:"32px",padding:"16px",background:"var(--ws-bg-secondary)",borderRadius:"8px",fontSize:"0.875rem",color:"var(--ws-text-secondary)"},children:[v.jsx("strong",{style:{color:"var(--ws-text-accent)"},children:" Deteccin Automtica:"}),v.jsxs("ul",{style:{marginTop:"8px",paddingLeft:"20px"},children:[v.jsx("li",{children:"El sistema analiza las etiquetas DICOM para detectar la modalidad"}),v.jsx("li",{children:"Se identifica automticamente: MRI DKI, CT TEP, CT Isquemia"}),v.jsx("li",{children:"La regin anatmica se infiere de BodyPartExamined"}),v.jsx("li",{children:"Puede forzar una modalidad especfica si lo desea"})]})]})]})]})},AH=()=>{const i=bn(),{data:e,isLoading:t,error:n,refetch:s}=of(),[r]=Ko(),[a,l]=V.useState("ALL"),[c,h]=V.useState("ALL"),[d,f]=V.useState(""),p=V.useMemo(()=>e?e.filter(b=>{if(a!=="ALL"&&(b.detected_modality||b.modality)!==a||c!=="ALL"&&b.status!==c)return!1;if(d){const w=d.toLowerCase();return b.patient_id.toLowerCase().includes(w)||b.id.toLowerCase().includes(w)||b.study_date.includes(w)}return!0}).sort((b,w)=>new Date(w.created_at).getTime()-new Date(b.created_at).getTime()):[],[e,a,c,d]),g=async(b,w)=>{w.stopPropagation(),window.confirm("Est seguro de eliminar este estudio?")&&await r(b)},y=b=>{switch(b.detected_modality||b.modality){case"MRI_DKI":return{label:"MRI DKI",icon:"",color:"#8b5cf6"};case"CT_SMART":return{label:"CT Isquemia",icon:"",color:"#06b6d4"};case"CT_TEP":return{label:"CT TEP",icon:"",color:"#ef4444"};default:return{label:"Auto",icon:"",color:"#64748b"}}},x=b=>{switch(b){case"COMPLETED":return{label:"Completado",icon:"",color:"#22c55e"};case"PROCESSING":return{label:"Procesando",icon:"",color:"#8b5cf6"};case"FAILED":return{label:"Error",icon:"",color:"#ef4444"};case"UPLOADED":return{label:"Pendiente",icon:"",color:"#f59e0b"};case"CLASSIFYING":return{label:"Clasificando",icon:"",color:"#3b82f6"};default:return{label:b,icon:"",color:"#64748b"}}};return v.jsxs("div",{style:{minHeight:"100vh",background:"#0f172a",color:"#f8fafc",fontFamily:"'Inter', sans-serif"},children:[v.jsxs("header",{style:{background:"#1e293b",borderBottom:"1px solid #334155",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[v.jsxs("div",{children:[v.jsx("h1",{style:{fontSize:"1.5rem",fontWeight:700,color:"#38bdf8",margin:0},children:" Lista de Estudios"}),v.jsxs("p",{style:{color:"#94a3b8",margin:"4px 0 0",fontSize:"0.875rem"},children:[p.length," estudio(s) encontrado(s)"]})]}),v.jsxs("div",{style:{display:"flex",gap:"12px"},children:[v.jsx("button",{onClick:()=>s(),style:{padding:"10px 16px",background:"#334155",border:"1px solid #475569",borderRadius:"8px",color:"#f8fafc",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:" Actualizar"}),v.jsx(ci,{to:"/upload",style:{padding:"10px 20px",background:"#22c55e",border:"none",borderRadius:"8px",color:"white",textDecoration:"none",fontWeight:600,display:"flex",alignItems:"center",gap:"6px"},children:" Nuevo Estudio"})]})]}),v.jsxs("div",{style:{background:"#1e293b",padding:"16px 24px",display:"flex",gap:"16px",alignItems:"center",flexWrap:"wrap"},children:[v.jsx("input",{type:"text",placeholder:" Buscar por ID, paciente o fecha...",value:d,onChange:b=>f(b.target.value),style:{padding:"10px 16px",background:"#334155",border:"1px solid #475569",borderRadius:"8px",color:"#f8fafc",width:"300px"}}),v.jsxs("select",{value:a,onChange:b=>l(b.target.value),style:{padding:"10px 16px",background:"#334155",border:"1px solid #475569",borderRadius:"8px",color:"#f8fafc"},children:[v.jsx("option",{value:"ALL",children:"Todas las modalidades"}),v.jsx("option",{value:"MRI_DKI",children:" MRI DKI"}),v.jsx("option",{value:"CT_SMART",children:" CT Isquemia"}),v.jsx("option",{value:"CT_TEP",children:" CT TEP"}),v.jsx("option",{value:"AUTO",children:" Auto-detectando"})]}),v.jsxs("select",{value:c,onChange:b=>h(b.target.value),style:{padding:"10px 16px",background:"#334155",border:"1px solid #475569",borderRadius:"8px",color:"#f8fafc"},children:[v.jsx("option",{value:"ALL",children:"Todos los estados"}),v.jsx("option",{value:"COMPLETED",children:" Completados"}),v.jsx("option",{value:"PROCESSING",children:" Procesando"}),v.jsx("option",{value:"FAILED",children:" Con error"}),v.jsx("option",{value:"UPLOADED",children:" Pendientes"})]})]}),v.jsx("main",{style:{padding:"24px"},children:t?v.jsxs("div",{style:{textAlign:"center",padding:"48px",color:"#94a3b8"},children:[v.jsx("div",{style:{fontSize:"3rem",marginBottom:"16px"},children:""}),"Cargando estudios..."]}):n?v.jsxs("div",{style:{textAlign:"center",padding:"48px",color:"#ef4444"},children:[v.jsx("div",{style:{fontSize:"3rem",marginBottom:"16px"},children:""}),"Error al cargar los estudios"]}):p.length===0?v.jsxs("div",{style:{textAlign:"center",padding:"48px",color:"#94a3b8"},children:[v.jsx("div",{style:{fontSize:"3rem",marginBottom:"16px"},children:""}),"No se encontraron estudios",v.jsx("div",{style:{marginTop:"16px"},children:v.jsx(ci,{to:"/upload",style:{color:"#38bdf8",textDecoration:"none"},children:" Cargar primer estudio"})})]}):v.jsx("div",{style:{display:"grid",gap:"12px"},children:p.map(b=>{const w=y(b),S=x(b.status);return v.jsxs("div",{onClick:()=>i(`/workstation/${b.id}`),style:{background:"#1e293b",border:"1px solid #334155",borderRadius:"12px",padding:"16px 20px",cursor:"pointer",display:"flex",alignItems:"center",gap:"20px",transition:"all 0.2s ease"},onMouseEnter:C=>{C.currentTarget.style.borderColor="#475569",C.currentTarget.style.background="#334155"},onMouseLeave:C=>{C.currentTarget.style.borderColor="#334155",C.currentTarget.style.background="#1e293b"},children:[v.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"12px",background:`${w.color}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",flexShrink:0},children:w.icon}),v.jsxs("div",{style:{flex:1},children:[v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"4px"},children:[v.jsx("span",{style:{fontWeight:600,fontSize:"1rem",color:"#f8fafc"},children:b.patient_id}),v.jsx("span",{style:{padding:"2px 8px",background:`${w.color}30`,color:w.color,borderRadius:"4px",fontSize:"0.7rem",fontWeight:600},children:w.label})]}),v.jsxs("div",{style:{color:"#64748b",fontSize:"0.8rem",fontFamily:"'JetBrains Mono', monospace"},children:["ID: ",String(b.id).substring(0,8)," "," ",b.study_date]})]}),(b.status==="PROCESSING"||b.status==="CLASSIFYING")&&v.jsxs("div",{style:{width:"120px"},children:[v.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.7rem",color:"#94a3b8",marginBottom:"4px"},children:[v.jsx("span",{children:b.pipeline_stage}),v.jsxs("span",{children:[b.pipeline_progress,"%"]})]}),v.jsx("div",{style:{height:"4px",background:"#334155",borderRadius:"2px",overflow:"hidden"},children:v.jsx("div",{style:{height:"100%",width:`${b.pipeline_progress}%`,background:"#8b5cf6"}})})]}),v.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 12px",background:`${S.color}20`,borderRadius:"20px",fontSize:"0.8rem",color:S.color,fontWeight:500},children:[S.icon," ",S.label]}),v.jsx("button",{onClick:C=>g(b.id,C),style:{padding:"8px",background:"transparent",border:"none",borderRadius:"6px",color:"#64748b",cursor:"pointer",opacity:.6},onMouseEnter:C=>{C.currentTarget.style.opacity="1",C.currentTarget.style.color="#ef4444"},onMouseLeave:C=>{C.currentTarget.style.opacity="0.6",C.currentTarget.style.color="#64748b"},title:"Eliminar estudio",children:""})]},b.id)})})})]})},V0=[{id:"CT_TEP",name:"CT_TEP",displayName:"CT Pulmonary Embolism (TEP)",domain:"Solid Pulmonary/Vascular Volume",domainStructures:["lung_parenchyma","pulmonary_arteries","pulmonary_veins","hilar_region","mediastinum"],color:"#e74c3c",steps:[{id:"tep-1",name:"1. VALIDATION",service:"CTValidationService.validate_series()",description:"Verify DICOM integrity and CT modality",substeps:["Check DICOM files exist","Verify modality = CT","Validate slice count"]},{id:"tep-2",name:"2. LOAD DICOM",service:"DicomService.load_ct_series()",description:"Load volume as 3D numpy array (HU values)",outputs:["volume (3D array)","affine matrix","spacing","KVP","mAs"]},{id:"tep-3",name:"3. DOMAIN MASK",service:"CTTEPEngine.get_domain_mask()",description:"Create anatomical constraint region (SOLID CONTAINER)",isNew:!0,substeps:["3a. Segment LUNG AIR seed (HU -950 to -400)","3b. Create SOLID CONTAINER (3D fill + ADAPTIVE closing)","3c. ADAPTIVE CLOSING: iterations = max(15, 10mm / pixel_spacing)","3d. DYNAMIC DIAPHRAGM: Stop when soft tissue (0-80HU) > 40%","3e. Apply Z-axis anatomical CROP (15% AND 2000 voxels)","3f. DILATE for hilar region (10 iter)","3g. SUBTRACT dilated BONE mask (HU>450, +5mm)","3h. ERODE 5mm from body surface (chest wall exclusion)","3i. ROI AUDIT LOG: Status every 50 slices"],outputs:["domain_mask","z_crop_info","diaphragm_info","bone_exclusion_info","surface_erosion_info"]},{id:"tep-3.5",name:"3.5 ROI SAFETY EROSION",service:"TEPProcessingService._apply_roi_safety_erosion()",description:"Anti-costal invasion buffer (DYNAMIC based on spacing)",isNew:!0,substeps:["3.5a. DYNAMIC EROSION: iterations = int(10mm / pixel_spacing)","3.5b. BONE BUFFER: Extra +5px dilation then subtract from ROI","3.5c. SANITY CHECK: If ROI < 20% original  REQUIRES_MANUAL_REVIEW"],outputs:["eroded_lung_mask","erosion_info","requires_manual_review flag"]},{id:"tep-4",name:"4. HU EXCLUSION MASKS",service:"TEPProcessingService._apply_hounsfield_masks()",description:"Remove bone and air from analysis",substeps:["Bone exclusion (HU > 450)","Air exclusion (HU < -900)","Bone dilation (5 iterations)"]},{id:"tep-5",name:"5. MEDIASTINAL CROP",service:"TEPProcessingService._crop_to_mediastinum()",description:"Focus on 250mm  250mm ROI centered on mediastinum"},{id:"tep-6",name:"6. CONTRAST CHECK",service:"TEPProcessingService._verify_contrast_enhancement()",description:"Verify adequate contrast in pulmonary arteries",substeps:["Mean arterial HU check (150-500)","Classify: OPTIMAL/GOOD/SUBOPTIMAL/INADEQUATE"],outputs:["contrast_quality","is_contrast_optimal"]},{id:"tep-7",name:"7. SEGMENTATION + DETECTION",service:"TEPProcessingService._detect_filling_defects_enhanced()",description:"Multi-criteria thrombus detection with scoring",isNew:!0,substeps:["7a. Segment Pulmonary Arteries (HU 150-500)","7b. HESSIAN PLATE FILTER: Compute Eigenvalues & Vesselness","7c. Remove Ribs: Plate Ratio (Ra) < 0.35 (Relaxed)","7d. Calculate MK (Mean Kurtosis) map","7e. Calculate FAC (Fractional Anisotropy) map","7f. VASCULAR COHERENCE: Structure Tensor analysis (CI)","7g. SCORING: HU=3pts, MK=1pt, FAC=1pt, Rupture(CI)=2pts","7h. NC MODE: Adaptive confidence scoring if non-contrast","7i. CONTRAST INHIBITOR: HU>220  Score=0","7j. LAPLACIAN BONE VALIDATION: gradient > 500HU  discard","7k. MORPHOMETRIC FILTER: Exclude Bronchi (Rugosity + Air-Core)","7l. SURFACE PHYSICS (Tenor): Validate Rugosity, FAC, Coherence"],outputs:["thrombus_mask","score_map","coherence_map","is_rib_artifact","findings[]"]},{id:"tep-8",name:"8. HEMODYNAMICS & VIRTUAL LYSIS",service:"TEPProcessingService (MART v3)",description:"Computational hemodynamics and intervention planning",isNew:!0,substeps:["8a. Estimacin de mPAP (Mean Pulmonary Arterial Pressure)","8b. Clculo de PVR (Resistencia Vascular Pulmonar)","8c. RV Impact Index (Sobrecarga Ventricular Derecha)","8d. VIRTUAL LYSIS: Simulate flow restoration (FAC recovery)","8e. Prioritize lesions by 'Rescue Potential'"],outputs:["estimated_mpap","pvr_wood_units","rv_impact_index","primary_intervention_target"]},{id:"tep-9",name:"9. QUANTIFICATION",service:"TEPProcessingService",description:"Calculate clinical metrics",outputs:["total_clot_volume","clot_count","obstruction%","qanadli_score"]},{id:"tep-10",name:"10. OUTPUT",service:"views.py + AuditReportService",description:"Save results and generate audit report",isNew:!0,substeps:["10a. Save heatmap.nii.gz (normal visualization)","10b. Save coherence_map.nii.gz (flow analysis)","10c. Save pseudocolor_map.nii.gz (density visualization)","10d. Generate audit.pdf report with Coherence Validation"],outputs:["heatmap.nii.gz","coherence_map.nii.gz","pseudocolor_map.nii.gz","pa_mask.nii.gz","thrombus_mask.nii.gz","audit.pdf"]}]},{id:"CT_SMART",name:"CT_SMART",displayName:"CT Brain Ischemia",domain:"Cerebral Tissue",domainStructures:["gray_matter","white_matter","ventricles","basal_ganglia"],color:"#3498db",steps:[{id:"smart-1",name:"1. VALIDATION",service:"CTValidationService",description:"Verify DICOM, CT modality, head region"},{id:"smart-2",name:"2. LOAD DICOM",service:"DicomService.load_ct_series()",description:"Load 3D volume (HU values)"},{id:"smart-3",name:"3. DOMAIN MASK",service:"CTIschemiaEngine.get_domain_mask()",description:"Brain extraction, skull removal",substeps:["Brain mask (HU 0-100)","Skull removal (HU>200)","Keep largest component","Fill holes"]},{id:"smart-4",name:"4. TISSUE SEGMENTATION",service:"CTIschemiaEngine",description:"Segment GM/WM",substeps:["Gray matter (HU 30-45)","White matter (HU 20-30)"]},{id:"smart-5",name:"5. TENSORIAL",service:"CTIschemiaEngine",description:"Texture features",substeps:["Shannon Entropy","GLCM (contrast, homogeneity)"]},{id:"smart-6",name:"6. DETECTION",service:"CTIschemiaEngine._detect_ischemia()",description:"Core + Penumbra detection",outputs:["core_mask","penumbra_mask"]},{id:"smart-7",name:"7. OUTPUT",service:"views.py",description:"Save maps",outputs:["entropy_map","heatmap","volumes"]}]},{id:"MRI_DKI",name:"MRI_DKI",displayName:"MRI Diffusion Kurtosis",domain:"Brain (White Matter)",domainStructures:["white_matter","gray_matter"],color:"#9b59b6",steps:[{id:"dki-1",name:"1. VALIDATION",service:"DicomValidationService",description:"Verify DWI parameters",substeps:["Check MR modality","Verify b-values","Check b0 + DWI"]},{id:"dki-2",name:"2. LOAD DICOM",service:"DicomService",description:"Load 4D volume",outputs:["4D volume","b-values","b-vectors"]},{id:"dki-3",name:"3. PREPROCESSING",service:"MRIDKIEngine",description:"Denoise + motion correction",substeps:["Brain mask","NLMeans denoising","Affine registration"]},{id:"dki-4",name:"4. DKI FITTING",service:"ProcessingService (DIPY)",description:"Fit DKI model",outputs:["MK map","FA map","MD map"]},{id:"dki-5",name:"5. QUANTIFICATION",service:"ProcessingService",description:"ROI statistics"},{id:"dki-6",name:"6. OUTPUT",service:"views.py",description:"Save maps",outputs:["mk_map.nii.gz","fa_map.nii.gz","md_map.nii.gz"]}]}],vH=()=>{const i=bn(),[e,t]=V.useState(null),[n,s]=V.useState(null),r=V.useCallback(c=>{const h=V0.find(d=>d.id===c);t(h||null)},[]),a=()=>v.jsxs("div",{className:"overview-section",children:[v.jsx("h2",{children:" Processing Flow Overview"}),v.jsxs("div",{className:"main-flow",children:[v.jsxs("div",{className:"flow-box start",children:[v.jsx("span",{className:"box-icon",children:""}),v.jsx("span",{className:"box-title",children:"DICOM Upload"}),v.jsx("span",{className:"box-subtitle",children:"POST /api/studies/"})]}),v.jsx("div",{className:"flow-arrow",children:""}),v.jsxs("div",{className:"flow-box process",children:[v.jsx("span",{className:"box-icon",children:""}),v.jsx("span",{className:"box-title",children:"Extract & Save"}),v.jsx("span",{className:"box-subtitle",children:"DicomService.extract_zip()"})]}),v.jsx("div",{className:"flow-arrow",children:""}),v.jsxs("div",{className:"flow-box process",children:[v.jsx("span",{className:"box-icon",children:""}),v.jsx("span",{className:"box-title",children:"Process Request"}),v.jsxs("span",{className:"box-subtitle",children:["POST /api/studies/","{id}","/process/"]})]}),v.jsx("div",{className:"flow-arrow",children:""}),v.jsxs("div",{className:"flow-box decision",children:[v.jsx("span",{className:"box-icon",children:""}),v.jsx("span",{className:"box-title",children:"Auto-Detection"}),v.jsx("span",{className:"box-subtitle",children:"DiscoveryService.classify_study()"})]}),v.jsxs("div",{className:"flow-arrow-split",children:[v.jsx("div",{className:"split-label left",children:"THORAX"}),v.jsx("div",{className:"split-label center",children:"HEAD"}),v.jsx("div",{className:"split-label right",children:"MRI+DWI"})]}),v.jsx("div",{className:"strategy-row",children:V0.map(c=>v.jsxs("div",{className:`flow-box strategy ${e?.id===c.id?"selected":""}`,style:{"--strategy-color":c.color},onClick:()=>r(c.id),children:[v.jsx("span",{className:"box-title",children:c.name}),v.jsxs("span",{className:"box-subtitle",children:[c.steps.length," steps"]}),v.jsx("span",{className:"click-hint",children:"Click "})]},c.id))}),v.jsx("div",{className:"flow-arrow-merge"}),v.jsx("div",{className:"flow-arrow",children:""}),v.jsxs("div",{className:"flow-box end",children:[v.jsx("span",{className:"box-icon",children:""}),v.jsx("span",{className:"box-title",children:"Save Results"}),v.jsx("span",{className:"box-subtitle",children:"ProcessingResult + NIfTI files"})]})]}),v.jsx("div",{className:"strategy-cards",children:V0.map(c=>v.jsxs("div",{className:`strategy-card ${e?.id===c.id?"selected":""}`,style:{borderColor:c.color},onClick:()=>r(c.id),children:[v.jsx("div",{className:"card-header",style:{backgroundColor:c.color},children:v.jsx("h3",{children:c.displayName})}),v.jsxs("div",{className:"card-body",children:[v.jsxs("p",{children:[v.jsx("strong",{children:"Domain:"})," ",c.domain]}),v.jsxs("p",{children:[v.jsx("strong",{children:"Steps:"})," ",c.steps.length]}),v.jsxs("div",{className:"structure-tags",children:[c.domainStructures.slice(0,3).map((h,d)=>v.jsx("span",{className:"tag",children:h},d)),c.domainStructures.length>3&&v.jsxs("span",{className:"tag more",children:["+",c.domainStructures.length-3]})]})]})]},c.id))})]}),l=()=>e?v.jsxs("div",{className:"detail-section",children:[v.jsx("button",{className:"back-btn",onClick:()=>t(null),children:" Back to Overview"}),v.jsxs("div",{className:"detail-header",style:{borderColor:e.color},children:[v.jsx("h2",{style:{color:e.color},children:e.displayName}),v.jsxs("p",{className:"domain-label",children:["Domain: ",v.jsx("strong",{children:e.domain})]}),v.jsx("div",{className:"structures",children:e.domainStructures.map((c,h)=>v.jsx("span",{className:"structure-tag",style:{backgroundColor:e.color},children:c},h))})]}),v.jsx("div",{className:"pipeline-vertical",children:e.steps.map((c,h)=>v.jsxs("div",{className:`step-card ${c.isNew?"is-new":""} ${n===c.id?"hovered":""}`,onMouseEnter:()=>s(c.id),onMouseLeave:()=>s(null),children:[h<e.steps.length-1&&v.jsx("div",{className:"connector",style:{backgroundColor:e.color}}),v.jsx("div",{className:"step-number",style:{backgroundColor:e.color},children:h+1}),v.jsxs("div",{className:"step-content",children:[v.jsxs("div",{className:"step-header",style:{borderLeftColor:e.color},children:[v.jsx("span",{className:"step-name",children:c.name}),c.isNew&&v.jsx("span",{className:"new-badge",children:" NEW"})]}),v.jsxs("div",{className:"step-body",children:[v.jsx("code",{className:"service-code",children:c.service}),v.jsx("p",{className:"step-desc",children:c.description}),c.substeps&&c.substeps.length>0&&v.jsxs("div",{className:"substeps",children:[v.jsx("strong",{children:"Sub-steps:"}),v.jsx("ul",{children:c.substeps.map((d,f)=>v.jsx("li",{children:d},f))})]}),c.outputs&&c.outputs.length>0&&v.jsxs("div",{className:"outputs",children:[v.jsx("strong",{children:"Outputs:"}),v.jsx("div",{className:"output-list",children:c.outputs.map((d,f)=>v.jsx("span",{className:"output-tag",children:d},f))})]})]})]})]},c.id))})]}):null;return v.jsxs("div",{className:"architecture-page",children:[v.jsxs("header",{className:"arch-header",children:[v.jsx("button",{className:"back-nav",onClick:()=>i("/studies"),children:" Back to Studies"}),v.jsx("h1",{children:" Radiomic Tensorial Workstation - Architecture"}),v.jsx("span",{className:"version",children:"v2.0"})]}),v.jsx("main",{className:"arch-main",children:e?l():a()}),v.jsx("footer",{className:"arch-footer",children:v.jsxs("p",{children:[" ",v.jsx("strong",{children:"Tip:"})," To add new processing steps, edit the"," ",v.jsx("code",{children:"STRATEGIES"})," array in"," ",v.jsx("code",{children:"src/pages/ArchitectureDiagram.tsx"})]})})]})};function yH(){return v.jsxs(uM,{children:[v.jsx(Di,{path:"/workstation/:studyId",element:v.jsx(mH,{})}),v.jsx(Di,{path:"/upload",element:v.jsx(gH,{})}),v.jsx(Di,{path:"/studies",element:v.jsx(AH,{})}),v.jsx(Di,{path:"/architecture",element:v.jsx(vH,{})}),v.jsx(Di,{path:"/",element:v.jsx(oM,{to:"/studies",replace:!0})}),v.jsxs(Di,{path:"/legacy",element:v.jsx(jR,{}),children:[v.jsx(Di,{index:!0,element:v.jsx($R,{})}),v.jsx(Di,{path:"mri/studies",element:v.jsx(Z8,{})}),v.jsx(Di,{path:"mri/upload",element:v.jsx(RN,{})}),v.jsx(Di,{path:"mri/studies/:id",element:v.jsx(xj,{})}),v.jsx(Di,{path:"ct/studies",element:v.jsx(wj,{})}),v.jsx(Di,{path:"ct/upload",element:v.jsx(Sj,{})}),v.jsx(Di,{path:"ct/studies/:id",element:v.jsx(Ej,{})}),v.jsx(Di,{path:"tep/studies",element:v.jsx(Tj,{})}),v.jsx(Di,{path:"tep/upload",element:v.jsx(Mj,{})}),v.jsx(Di,{path:"tep/studies/:id",element:v.jsx(m9,{})})]})]})}jE.createRoot(document.getElementById("root")).render(v.jsx(V.StrictMode,{children:v.jsx(nT,{store:G5,children:v.jsx(PM,{children:v.jsx(yH,{})})})}));
